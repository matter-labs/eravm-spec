<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>EraVM.sem.FarRevert</title>

  <script defer=""
  src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <link rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css" />
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.FarRevert</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span><br/>
<a class="idref" href="EraVM.ABI.html#"><span class="id" title="library">ABI</span></a><br/>
<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Bool.Bool.html#"><span class="id" title="library">Bool</span></a><br/>
<a class="idref" href="EraVM.CallStack.html#"><span class="id" title="library">CallStack</span></a><br/>
<a class="idref" href="EraVM.Coder.html#"><span class="id" title="library">Coder</span></a><br/>
<a class="idref" href="EraVM.Common.html#"><span class="id" title="library">Common</span></a><br/>
<a class="idref" href="EraVM.Flags.html#"><span class="id" title="library">Flags</span></a><br/>
<a class="idref" href="EraVM.GPR.html#"><span class="id" title="library">GPR</span></a><br/>
<a class="idref" href="EraVM.MemoryContext.html#"><span class="id" title="library">MemoryContext</span></a><br/>
<a class="idref" href="EraVM.MemoryManagement.html#"><span class="id" title="library">MemoryManagement</span></a><br/>
<a class="idref" href="EraVM.Pointer.html#"><span class="id" title="library">Pointer</span></a><br/>
<a class="idref" href="EraVM.PrimitiveValue.html#"><span class="id" title="library">PrimitiveValue</span></a><br/>
<a class="idref" href="EraVM.sem.SemanticCommon.html#"><span class="id" title="library">SemanticCommon</span></a><br/>
<a class="idref" href="EraVM.State.html#"><span class="id" title="library">State</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span><br/>
<a class="idref" href="EraVM.ABI.html#"><span class="id" title="module">ABI</span></a><br/>
<a class="idref" href="EraVM.ABI.FatPointerABI.html#"><span class="id" title="module">FatPointerABI</span></a><br/>
<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Bool.Bool.html#"><span class="id" title="module">Bool</span></a><br/>
<a class="idref" href="EraVM.CallStack.html#"><span class="id" title="module">CallStack</span></a><br/>
<a class="idref" href="EraVM.Coder.html#"><span class="id" title="module">Coder</span></a><br/>
<a class="idref" href="EraVM.Common.html#"><span class="id" title="module">Common</span></a><br/>
<a class="idref" href="EraVM.Flags.html#"><span class="id" title="module">Flags</span></a><br/>
<a class="idref" href="EraVM.GPR.html#"><span class="id" title="module">GPR</span></a><br/>
<a class="idref" href="EraVM.isa.CoreSet.html#"><span class="id" title="module">isa.CoreSet</span></a><br/>
<a class="idref" href="EraVM.MemoryContext.html#"><span class="id" title="module">MemoryContext</span></a><br/>
<a class="idref" href="EraVM.MemoryManagement.html#"><span class="id" title="module">MemoryManagement</span></a><br/>
<a class="idref" href="EraVM.Pointer.html#"><span class="id" title="module">Pointer</span></a><br/>
<a class="idref" href="EraVM.PrimitiveValue.html#"><span class="id" title="module">PrimitiveValue</span></a><br/>
<span class="id" title="module">RecordSetNotations</span><br/>
<a class="idref" href="EraVM.sem.SemanticCommon.html#"><span class="id" title="module">SemanticCommon</span></a><br/>
<a class="idref" href="EraVM.State.html#"><span class="id" title="module">State</span></a><br/>
<a class="idref" href="EraVM.sem.StepPanic.html#"><span class="id" title="module">StepPanic</span></a><br/>
.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="FarRevertDefinition" class="idref" href="#FarRevertDefinition"><span class="id" title="section">FarRevertDefinition</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Let</span> <a id="FarRevertDefinition.reserve" class="idref" href="#FarRevertDefinition.reserve"><span class="id" title="variable">reserve</span></a> <a id="regs:1" class="idref" href="#regs:1"><span class="id" title="binder">regs</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#regs:1"><span class="id" title="variable">regs</span></a>    <span class="id" title="notation"><|</span> <a class="idref" href="EraVM.GPR.html#r2"><span class="id" title="projection">r2</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="EraVM.State.html#reserved"><span class="id" title="definition">reserved</span></a> <span class="id" title="notation">|></span> <span class="id" title="notation"><|</span> <a class="idref" href="EraVM.GPR.html#r3"><span class="id" title="projection">r3</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="EraVM.State.html#reserved"><span class="id" title="definition">reserved</span></a> <span class="id" title="notation">|></span> <span class="id" title="notation"><|</span> <a class="idref" href="EraVM.GPR.html#r4"><span class="id" title="projection">r4</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="EraVM.State.html#reserved"><span class="id" title="definition">reserved</span></a> <span class="id" title="notation">|></span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_farrevert" class="idref" href="#step_farrevert"><span class="id" title="inductive">step_farrevert</span></a>: <a class="idref" href="EraVM.isa.CoreSet.html#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.Steps.html#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
&nbsp;&nbsp;</div>

<div class="doc"><h1
id="far-revert-return-from-recoverable-error-not-panicnormal-return">Far
revert (return from recoverable error, not panic/normal return)</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpFarRevert"><span
class="id" title="constructor">OpFarRevert</span></a></span> <span
class="inlinecode">(<span class="id" title="var">args</span>:</span>
<span
class="inlinecode"><a class="idref" href="EraVM.Addressing.html#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>ret.revert in1</code> aliased as <code>revert in1</code></p>
<p>An abnormal return from a far call. Will pop up current callframe,
give back unspent ergs and execute a currently active exception handler.
The register abi_reg describes a slice of memory passed to the external
caller.</p>
<p>Restores storage to the state before external call.</p>
<p>The assembler expands <code>revert</code> to <code>revert r1</code>;
<code>r1</code> is ignored by returns from near calls.</p>
<h2 id="semantic">Semantic</h2>
<ol type="1">
<li>Let <span class="math inline">E</span> be the address of the <span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#active_exception_handler"><span
class="id"
title="definition">active_exception_handler</span></a></span>.</li>
<li>Perform a <span
class="inlinecode"><a class="idref" href="EraVM.State.html#rollback"><span
class="id" title="inductive">rollback</span></a></span>.</li>
<li>Proceed with the same steps as <span class="inlinecode"><span
class="id" title="var">OpFarRetABI</span></span> (see <span
class="inlinecode"><a class="idref" href="EraVM.sem.FarRet.html#step_farret"><span
class="id" title="inductive">step_farret</span></a></span>).</li>
<li>Set PC to <span class="math inline">E</span>.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_RevertExt_heapvar" class="idref" href="#step_RevertExt_heapvar"><span class="id" title="constructor">step_RevertExt_heapvar</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="gs:4" class="idref" href="#gs:4"><span class="id" title="binder">gs</span></a> <a id="gs':5" class="idref" href="#gs':5"><span class="id" title="binder">gs'</span></a> <a id="pages:6" class="idref" href="#pages:6"><span class="id" title="binder">pages</span></a> <a id="cf:7" class="idref" href="#cf:7"><span class="id" title="binder">cf</span></a> <a id="caller_stack:8" class="idref" href="#caller_stack:8"><span class="id" title="binder">caller_stack</span></a> <a id="cs1:9" class="idref" href="#cs1:9"><span class="id" title="binder">cs1</span></a> <a id="cs2:10" class="idref" href="#cs2:10"><span class="id" title="binder">cs2</span></a> <a id="new_caller:11" class="idref" href="#new_caller:11"><span class="id" title="binder">new_caller</span></a> <a id="new_regs:12" class="idref" href="#new_regs:12"><span class="id" title="binder">new_regs</span></a> <a id="params:13" class="idref" href="#params:13"><span class="id" title="binder">params</span></a> <a id="out_ptr:14" class="idref" href="#out_ptr:14"><span class="id" title="binder">out_ptr</span></a> <a id="heap_type:15" class="idref" href="#heap_type:15"><span class="id" title="binder">heap_type</span></a> <a id="hspan:16" class="idref" href="#hspan:16"><span class="id" title="binder">hspan</span></a> <a id="___2:17" class="idref" href="#___2:17"><span class="id" title="binder">___2</span></a> <a id="___3:18" class="idref" href="#___3:18"><span class="id" title="binder">___3</span></a> <a id="___4:19" class="idref" href="#___4:19"><span class="id" title="binder">___4</span></a> <a id="_tag:20" class="idref" href="#_tag:20"><span class="id" title="binder">_tag</span></a> <a id="ptr_enc:21" class="idref" href="#ptr_enc:21"><span class="id" title="binder">ptr_enc</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cs0:22" class="idref" href="#cs0:22"><span class="id" title="binder">cs0</span></a> := <a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cf:7"><span class="id" title="variable">cf</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#caller_stack:8"><span class="id" title="variable">caller_stack</span></a>) <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#params:13"><span class="id" title="variable">params</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.MemoryManagement.html#ForwardNewFatPointer"><span class="id" title="constructor">ForwardNewFatPointer</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#heap_type:15"><span class="id" title="variable">heap_type</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#hspan:16"><span class="id" title="variable">hspan</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.MemoryManagement.html#paid_forward_new_fat_ptr"><span class="id" title="inductive">paid_forward_new_fat_ptr</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#heap_type:15"><span class="id" title="variable">heap_type</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#hspan:16"><span class="id" title="variable">hspan</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cs0:22"><span class="id" title="variable">cs0</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.FarRevert.html#out_ptr:14"><span class="id" title="variable">out_ptr</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cs1:9"><span class="id" title="variable">cs1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ergs_return_caller_and_drop"><span class="id" title="inductive">ergs_return_caller_and_drop</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cs1:9"><span class="id" title="variable">cs1</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cs2:10"><span class="id" title="variable">cs2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#new_caller:11"><span class="id" title="variable">new_caller</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.CallStack.html#pc_set"><span class="id" title="definition">pc_set</span></a> (<a class="idref" href="EraVM.CallStack.html#active_exception_handler"><span class="id" title="definition">active_exception_handler</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cs0:22"><span class="id" title="variable">cs0</span></a>) <a class="idref" href="EraVM.sem.FarRevert.html#cs2:10"><span class="id" title="variable">cs2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#rollback"><span class="id" title="inductive">rollback</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cf:7"><span class="id" title="variable">cf</span></a>.(<a class="idref" href="EraVM.CallStack.html#cf_saved_checkpoint"><span class="id" title="projection">cf_saved_checkpoint</span></a>) <a class="idref" href="EraVM.sem.FarRevert.html#gs:4"><span class="id" title="variable">gs</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#gs':5"><span class="id" title="variable">gs'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#ptr_enc:21"><span class="id" title="variable">ptr_enc</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.ABI.FatPointerABI.html#encode_fat_ptr_word"><span class="id" title="definition">encode_fat_ptr_word</span></a> <a class="idref" href="EraVM.Types.html#zero128"><span class="id" title="definition">zero128</span></a> (<a class="idref" href="EraVM.Pointer.html#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#out_ptr:14"><span class="id" title="variable">out_ptr</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#new_regs:12"><span class="id" title="variable">new_regs</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#FarRevertDefinition.reserve"><span class="id" title="variable">reserve</span></a> (<a class="idref" href="EraVM.State.html#regs_state_zero"><span class="id" title="definition">regs_state_zero</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="EraVM.GPR.html#r1"><span class="id" title="projection">r1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="EraVM.PrimitiveValue.html#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#ptr_enc:21"><span class="id" title="variable">ptr_enc</span></a> <span class="id" title="notation">|></span> )<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#step_farrevert:2"><span class="id" title="inductive">step_farrevert</span></a> (<a class="idref" href="EraVM.isa.CoreSet.html#OpFarRevert"><span class="id" title="constructor">OpFarRevert</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="EraVM.PrimitiveValue.html#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#_tag:20"><span class="id" title="variable">_tag</span></a> (<a class="idref" href="EraVM.ABI.FarRetABI.html#mk_params"><span class="id" title="constructor">FarRetABI.mk_params</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#params:13"><span class="id" title="variable">params</span></a>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_transient"><span class="id" title="projection">gs_transient</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="EraVM.sem.FarRevert.html#___2:17"><span class="id" title="variable">___2</span></a> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="EraVM.sem.FarRevert.html#cs0:22"><span class="id" title="variable">cs0</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="EraVM.sem.FarRevert.html#___3:18"><span class="id" title="variable">___3</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="EraVM.sem.FarRevert.html#___4:19"><span class="id" title="variable">___4</span></a>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="EraVM.sem.FarRevert.html#pages:6"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="EraVM.VMPanic.html#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_global"><span class="id" title="projection">gs_global</span></a>       := <a class="idref" href="EraVM.sem.FarRevert.html#gs:4"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_transient"><span class="id" title="projection">gs_transient</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="EraVM.Flags.html#flags_clear"><span class="id" title="definition">flags_clear</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="EraVM.sem.FarRevert.html#new_caller:11"><span class="id" title="variable">new_caller</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="EraVM.sem.FarRevert.html#new_regs:12"><span class="id" title="variable">new_regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="EraVM.Types.html#zero128"><span class="id" title="definition">zero128</span></a>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="EraVM.sem.FarRevert.html#pages:6"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="EraVM.VMPanic.html#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_global"><span class="id" title="projection">gs_global</span></a>       := <a class="idref" href="EraVM.sem.FarRevert.html#gs':5"><span class="id" title="variable">gs'</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;| <a id="step_RevertExt_ForwardFatPointer" class="idref" href="#step_RevertExt_ForwardFatPointer"><span class="id" title="constructor">step_RevertExt_ForwardFatPointer</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="pages:23" class="idref" href="#pages:23"><span class="id" title="binder">pages</span></a> <a id="cf:24" class="idref" href="#cf:24"><span class="id" title="binder">cf</span></a> <a id="caller_stack:25" class="idref" href="#caller_stack:25"><span class="id" title="binder">caller_stack</span></a> <a id="cs1:26" class="idref" href="#cs1:26"><span class="id" title="binder">cs1</span></a> <a id="cs2:27" class="idref" href="#cs2:27"><span class="id" title="binder">cs2</span></a> <a id="new_caller:28" class="idref" href="#new_caller:28"><span class="id" title="binder">new_caller</span></a> <a id="new_regs:29" class="idref" href="#new_regs:29"><span class="id" title="binder">new_regs</span></a> <a id="___2:30" class="idref" href="#___2:30"><span class="id" title="binder">___2</span></a> <a id="___3:31" class="idref" href="#___3:31"><span class="id" title="binder">___3</span></a> <a id="___4:32" class="idref" href="#___4:32"><span class="id" title="binder">___4</span></a> <a id="in_ptr:33" class="idref" href="#in_ptr:33"><span class="id" title="binder">in_ptr</span></a> <a id="out_ptr:34" class="idref" href="#out_ptr:34"><span class="id" title="binder">out_ptr</span></a> <a id="page:35" class="idref" href="#page:35"><span class="id" title="binder">page</span></a> <a id="params:36" class="idref" href="#params:36"><span class="id" title="binder">params</span></a> <a id="gs:37" class="idref" href="#gs:37"><span class="id" title="binder">gs</span></a> <a id="gs':38" class="idref" href="#gs':38"><span class="id" title="binder">gs'</span></a> <a id="ptr_enc:39" class="idref" href="#ptr_enc:39"><span class="id" title="binder">ptr_enc</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cs0:40" class="idref" href="#cs0:40"><span class="id" title="binder">cs0</span></a> := <a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cf:24"><span class="id" title="variable">cf</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#caller_stack:25"><span class="id" title="variable">caller_stack</span></a>) <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Panic&nbsp;if&nbsp;not&nbsp;a&nbsp;pointer&nbsp;*)</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#params:36"><span class="id" title="variable">params</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.MemoryManagement.html#ForwardExistingFatPointer"><span class="id" title="constructor">ForwardExistingFatPointer</span></a> (<a class="idref" href="EraVM.Pointer.html#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#in_ptr:33"><span class="id" title="variable">in_ptr</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#in_ptr:33"><span class="id" title="variable">in_ptr</span></a>.(<a class="idref" href="EraVM.Pointer.html#fp_page"><span class="id" title="projection">fp_page</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#page:35"><span class="id" title="variable">page</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.MemoryContext.html#page_older"><span class="id" title="definition">MemoryContext.page_older</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#page:35"><span class="id" title="variable">page</span></a> (<a class="idref" href="EraVM.CallStack.html#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cs0:40"><span class="id" title="variable">cs0</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.Pointer.html#validate"><span class="id" title="definition">validate</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#in_ptr:33"><span class="id" title="variable">in_ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.Pointer.html#no_exceptions"><span class="id" title="definition">no_exceptions</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.Pointer.html#fat_ptr_narrow"><span class="id" title="definition">fat_ptr_narrow</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#in_ptr:33"><span class="id" title="variable">in_ptr</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#out_ptr:34"><span class="id" title="variable">out_ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ergs_return_caller_and_drop"><span class="id" title="inductive">ergs_return_caller_and_drop</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cs1:26"><span class="id" title="variable">cs1</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cs2:27"><span class="id" title="variable">cs2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#new_caller:28"><span class="id" title="variable">new_caller</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.CallStack.html#pc_set"><span class="id" title="definition">pc_set</span></a> (<a class="idref" href="EraVM.CallStack.html#active_exception_handler"><span class="id" title="definition">active_exception_handler</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cs0:40"><span class="id" title="variable">cs0</span></a>) <a class="idref" href="EraVM.sem.FarRevert.html#cs2:27"><span class="id" title="variable">cs2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#ptr_enc:39"><span class="id" title="variable">ptr_enc</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.ABI.FatPointerABI.html#encode_fat_ptr_word"><span class="id" title="definition">encode_fat_ptr_word</span></a> <a class="idref" href="EraVM.Types.html#zero128"><span class="id" title="definition">zero128</span></a> (<a class="idref" href="EraVM.Pointer.html#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#out_ptr:34"><span class="id" title="variable">out_ptr</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#new_regs:29"><span class="id" title="variable">new_regs</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="notation">(</span><a class="idref" href="EraVM.sem.FarRevert.html#FarRevertDefinition.reserve"><span class="id" title="variable">reserve</span></a> <a class="idref" href="EraVM.State.html#regs_state_zero"><span class="id" title="definition">regs_state_zero</span></a><span class="id" title="notation">)</span> <span class="id" title="notation"><|</span> <a class="idref" href="EraVM.GPR.html#r1"><span class="id" title="projection">r1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="EraVM.PrimitiveValue.html#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#ptr_enc:39"><span class="id" title="variable">ptr_enc</span></a> <span class="id" title="notation">|></span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#rollback"><span class="id" title="inductive">rollback</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cf:24"><span class="id" title="variable">cf</span></a>.(<a class="idref" href="EraVM.CallStack.html#cf_saved_checkpoint"><span class="id" title="projection">cf_saved_checkpoint</span></a>) <a class="idref" href="EraVM.sem.FarRevert.html#gs:37"><span class="id" title="variable">gs</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#gs':38"><span class="id" title="variable">gs'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#step_farrevert:2"><span class="id" title="inductive">step_farrevert</span></a> (<a class="idref" href="EraVM.isa.CoreSet.html#OpFarRevert"><span class="id" title="constructor">OpFarRevert</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="EraVM.PrimitiveValue.html#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> (<a class="idref" href="EraVM.ABI.FarRetABI.html#mk_params"><span class="id" title="constructor">FarRetABI.mk_params</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#params:36"><span class="id" title="variable">params</span></a>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_transient"><span class="id" title="projection">gs_transient</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="EraVM.sem.FarRevert.html#___2:30"><span class="id" title="variable">___2</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="EraVM.sem.FarRevert.html#cs0:40"><span class="id" title="variable">cs0</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="EraVM.sem.FarRevert.html#___3:31"><span class="id" title="variable">___3</span></a> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="EraVM.sem.FarRevert.html#___4:32"><span class="id" title="variable">___4</span></a>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="EraVM.sem.FarRevert.html#pages:23"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="EraVM.VMPanic.html#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_global"><span class="id" title="projection">gs_global</span></a>       := <a class="idref" href="EraVM.sem.FarRevert.html#gs:37"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_transient"><span class="id" title="projection">gs_transient</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="EraVM.Flags.html#flags_clear"><span class="id" title="definition">flags_clear</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="EraVM.sem.FarRevert.html#new_caller:28"><span class="id" title="variable">new_caller</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="EraVM.sem.FarRevert.html#new_regs:29"><span class="id" title="variable">new_regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="EraVM.Types.html#zero128"><span class="id" title="definition">zero128</span></a>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="EraVM.sem.FarRevert.html#pages:23"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="EraVM.VMPanic.html#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_global"><span class="id" title="projection">gs_global</span></a>       := <a class="idref" href="EraVM.sem.FarRevert.html#gs':38"><span class="id" title="variable">gs'</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
<br/>
</div>

<div class="doc"><h2 id="affected-parts-of-vm-state">Affected parts of VM state</h2>
<ul>
<li>Flags are cleared.</li>
<li>Context register is zeroed (only returns from far calls).</li>
<li>Registers are cleared (only returns from far calls).</li>
<li>Execution stack:
<ul>
<li>Current frame is dropped.</li>
<li>Caller frame:
<ul>
<li>if a label is explicitly provided, and current frame is internal
(near call), then caller’s PC is overwritten with the label. Returns
from external calls ignore label, even if it is explicitly
provided.</li>
<li>Unspent ergs are given back to caller (but memory growth is paid
first).</li>
</ul></li>
</ul></li>
<li>Storage changes are reverted.</li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Abnormal returns from near/far calls when a recoverable error
happened. Use <code>panic</code> for irrecoverable errors.</li>
</ul>
<h2 id="similar-instructions">Similar instructions</h2>
<ul>
<li><code>ret</code> returns to the caller instead of executing an
exception handler.</li>
<li><code>panic</code> acts similar to <code>revert</code> but does not
let pass any data to the caller and sets an overflow flag, and burns
ergs in current frame.</li>
</ul>
<h2 id="panics">Panics</h2>
<ol type="1">
<li>Attempt to forward an existing fat pointer, but the value holding
<span class="inlinecode"><span class="id"
title="var">RetABI</span></span> is not tagged as a pointer.</li>
</ol>
</div>
<div class="code">
<br/>
<br/>
&nbsp;&nbsp;| <a id="step_RevertExt_ForwardFatPointer_requires_ptrtag" class="idref" href="#step_RevertExt_ForwardFatPointer_requires_ptrtag"><span class="id" title="constructor">step_RevertExt_ForwardFatPointer_requires_ptrtag</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cf:41" class="idref" href="#cf:41"><span class="id" title="binder">cf</span></a> <a id="caller_stack:42" class="idref" href="#caller_stack:42"><span class="id" title="binder">caller_stack</span></a> <a id="__:43" class="idref" href="#__:43"><span class="id" title="binder">__</span></a> <a id="params:44" class="idref" href="#params:44"><span class="id" title="binder">params</span></a> (<a id="s1:45" class="idref" href="#s1:45"><span class="id" title="binder">s1</span></a> <a id="s2:46" class="idref" href="#s2:46"><span class="id" title="binder">s2</span></a>:<a class="idref" href="EraVM.State.html#state"><span class="id" title="record">state</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cs0:47" class="idref" href="#cs0:47"><span class="id" title="binder">cs0</span></a> := <a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cf:41"><span class="id" title="variable">cf</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#caller_stack:42"><span class="id" title="variable">caller_stack</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#s1:45"><span class="id" title="variable">s1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cs0:47"><span class="id" title="variable">cs0</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#params:44"><span class="id" title="variable">params</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.ABI.FarRetABI.html#mk_params"><span class="id" title="constructor">FarRetABI.mk_params</span></a> (<a class="idref" href="EraVM.MemoryManagement.html#ForwardExistingFatPointer"><span class="id" title="constructor">ForwardExistingFatPointer</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#__:43"><span class="id" title="variable">__</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.StepPanic.html#step_panic"><span class="id" title="inductive">step_panic</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.VMPanic.html#RetABIExistingFatPointerWithoutTag"><span class="id" title="constructor">RetABIExistingFatPointerWithoutTag</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#s1:45"><span class="id" title="variable">s1</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#s2:46"><span class="id" title="variable">s2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#step_farrevert:2"><span class="id" title="inductive">step_farrevert</span></a> (<a class="idref" href="EraVM.isa.CoreSet.html#OpFarRevert"><span class="id" title="constructor">OpFarRevert</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="EraVM.PrimitiveValue.html#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#params:44"><span class="id" title="variable">params</span></a>))) <a class="idref" href="EraVM.sem.FarRevert.html#s1:45"><span class="id" title="variable">s1</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#s2:46"><span class="id" title="variable">s2</span></a><br/>
<br/>
</div>

<div class="doc"><ol start="2" type="1">
<li>Attempt to return a pointer created before the current callframe. It
is forbidden to pass a pointer to a contract in a far call and return it
back. Otherwise we could create a <span
class="inlinecode"><a class="idref" href="EraVM.Pointer.html#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span> <span
class="math inline">P</span> to a heap page of contract <span
class="math inline">A</span>, pass it to a contract <span
class="math inline">B</span>, return it back to <span
class="math inline">A</span>, and then modify the contents on the heap
page of <span class="math inline">A</span>. This way we will also modify
the memory <span class="inlinecode"><span class="id"
title="var">slice</span></span> associated with <span
class="math inline">P</span>.</li>
</ol>
<p>In other words, this is a situation where:</p>
<ul>
<li>caller makes far call to some contract;</li>
<li>callee does return-forward <span class="citation"
data-cites="calldataptr">@calldataptr</span>;</li>
<li>caller modifies calldata corresponding heap region, that leads to
modification of returndata.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_RevertExt_ForwardFatPointer_returning_older_pointer" class="idref" href="#step_RevertExt_ForwardFatPointer_returning_older_pointer"><span class="id" title="constructor">step_RevertExt_ForwardFatPointer_returning_older_pointer</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cf:48" class="idref" href="#cf:48"><span class="id" title="binder">cf</span></a> <a id="caller_stack:49" class="idref" href="#caller_stack:49"><span class="id" title="binder">caller_stack</span></a> <a id="in_ptr:50" class="idref" href="#in_ptr:50"><span class="id" title="binder">in_ptr</span></a> <a id="page:51" class="idref" href="#page:51"><span class="id" title="binder">page</span></a> <a id="params:52" class="idref" href="#params:52"><span class="id" title="binder">params</span></a> (<a id="s1:53" class="idref" href="#s1:53"><span class="id" title="binder">s1</span></a> <a id="s2:54" class="idref" href="#s2:54"><span class="id" title="binder">s2</span></a>:<a class="idref" href="EraVM.State.html#state"><span class="id" title="record">state</span></a>) ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cs0:55" class="idref" href="#cs0:55"><span class="id" title="binder">cs0</span></a> := <a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cf:48"><span class="id" title="variable">cf</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#caller_stack:49"><span class="id" title="variable">caller_stack</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#s1:53"><span class="id" title="variable">s1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cs0:55"><span class="id" title="variable">cs0</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#in_ptr:50"><span class="id" title="variable">in_ptr</span></a>.(<a class="idref" href="EraVM.Pointer.html#fp_page"><span class="id" title="projection">fp_page</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#page:51"><span class="id" title="variable">page</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.MemoryContext.html#page_older"><span class="id" title="definition">page_older</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#page:51"><span class="id" title="variable">page</span></a> (<a class="idref" href="EraVM.CallStack.html#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cs0:55"><span class="id" title="variable">cs0</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#params:52"><span class="id" title="variable">params</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.ABI.FarRetABI.html#mk_params"><span class="id" title="constructor">FarRetABI.mk_params</span></a> (<a class="idref" href="EraVM.MemoryManagement.html#ForwardExistingFatPointer"><span class="id" title="constructor">ForwardExistingFatPointer</span></a> (<a class="idref" href="EraVM.Pointer.html#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#in_ptr:50"><span class="id" title="variable">in_ptr</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.StepPanic.html#step_panic"><span class="id" title="inductive">step_panic</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.VMPanic.html#RetABIReturnsPointerCreatedByCaller"><span class="id" title="constructor">RetABIReturnsPointerCreatedByCaller</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#s1:53"><span class="id" title="variable">s1</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#s2:54"><span class="id" title="variable">s2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#step_farrevert:2"><span class="id" title="inductive">step_farrevert</span></a> (<a class="idref" href="EraVM.isa.CoreSet.html#OpFarRevert"><span class="id" title="constructor">OpFarRevert</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="EraVM.PrimitiveValue.html#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#params:52"><span class="id" title="variable">params</span></a>))) <a class="idref" href="EraVM.sem.FarRevert.html#s1:53"><span class="id" title="variable">s1</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#s2:54"><span class="id" title="variable">s2</span></a><br/>
</div>

<div class="doc"><ol start="3" type="1">
<li>Attempt to return a malformed pointer.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_RevertExt_ForwardFatPointer_returning_malformed_pointer" class="idref" href="#step_RevertExt_ForwardFatPointer_returning_malformed_pointer"><span class="id" title="constructor">step_RevertExt_ForwardFatPointer_returning_malformed_pointer</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cf:56" class="idref" href="#cf:56"><span class="id" title="binder">cf</span></a> <a id="caller_stack:57" class="idref" href="#caller_stack:57"><span class="id" title="binder">caller_stack</span></a> (<a id="in_ptr:58" class="idref" href="#in_ptr:58"><span class="id" title="binder">in_ptr</span></a>: <a class="idref" href="EraVM.Pointer.html#fat_ptr"><span class="id" title="record">fat_ptr</span></a>) <a id="params:59" class="idref" href="#params:59"><span class="id" title="binder">params</span></a> (<a id="s1:60" class="idref" href="#s1:60"><span class="id" title="binder">s1</span></a> <a id="s2:61" class="idref" href="#s2:61"><span class="id" title="binder">s2</span></a>:<a class="idref" href="EraVM.State.html#state"><span class="id" title="record">state</span></a>) ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cs0:62" class="idref" href="#cs0:62"><span class="id" title="binder">cs0</span></a> := <a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cf:56"><span class="id" title="variable">cf</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#caller_stack:57"><span class="id" title="variable">caller_stack</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#s1:60"><span class="id" title="variable">s1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cs0:62"><span class="id" title="variable">cs0</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.Pointer.html#validate"><span class="id" title="definition">validate</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#in_ptr:58"><span class="id" title="variable">in_ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'<>'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="EraVM.Pointer.html#no_exceptions"><span class="id" title="definition">no_exceptions</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#params:59"><span class="id" title="variable">params</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.ABI.FarRetABI.html#mk_params"><span class="id" title="constructor">FarRetABI.mk_params</span></a> (<a class="idref" href="EraVM.MemoryManagement.html#ForwardExistingFatPointer"><span class="id" title="constructor">ForwardExistingFatPointer</span></a> (<a class="idref" href="EraVM.Pointer.html#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#in_ptr:58"><span class="id" title="variable">in_ptr</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.StepPanic.html#step_panic"><span class="id" title="inductive">step_panic</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.VMPanic.html#FatPointerMalformed"><span class="id" title="constructor">FatPointerMalformed</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#s1:60"><span class="id" title="variable">s1</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#s2:61"><span class="id" title="variable">s2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#step_farrevert:2"><span class="id" title="inductive">step_farrevert</span></a> (<a class="idref" href="EraVM.isa.CoreSet.html#OpFarRevert"><span class="id" title="constructor">OpFarRevert</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="EraVM.PrimitiveValue.html#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#params:59"><span class="id" title="variable">params</span></a>))) <a class="idref" href="EraVM.sem.FarRevert.html#s1:60"><span class="id" title="variable">s1</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#s2:61"><span class="id" title="variable">s2</span></a><br/>
</div>

<div class="doc"><ol start="4" type="1">
<li>Attempt to return a new pointer but unable to pay for memory
growth.</li>
</ol>
</div>
<div class="code">
<br/>
| <a id="step_RevertExt_heapvar_growth_unaffordable" class="idref" href="#step_RevertExt_heapvar_growth_unaffordable"><span class="id" title="constructor">step_RevertExt_heapvar_growth_unaffordable</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cf:63" class="idref" href="#cf:63"><span class="id" title="binder">cf</span></a> <a id="caller_stack:64" class="idref" href="#caller_stack:64"><span class="id" title="binder">caller_stack</span></a> <a id="heap_type:65" class="idref" href="#heap_type:65"><span class="id" title="binder">heap_type</span></a> <a id="hspan:66" class="idref" href="#hspan:66"><span class="id" title="binder">hspan</span></a> <a id="params:67" class="idref" href="#params:67"><span class="id" title="binder">params</span></a> (<a id="s1:68" class="idref" href="#s1:68"><span class="id" title="binder">s1</span></a> <a id="s2:69" class="idref" href="#s2:69"><span class="id" title="binder">s2</span></a>:<a class="idref" href="EraVM.State.html#state"><span class="id" title="record">state</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cs0:70" class="idref" href="#cs0:70"><span class="id" title="binder">cs0</span></a> := <a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cf:63"><span class="id" title="variable">cf</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#caller_stack:64"><span class="id" title="variable">caller_stack</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#s1:68"><span class="id" title="variable">s1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cs0:70"><span class="id" title="variable">cs0</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#params:67"><span class="id" title="variable">params</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.ABI.FarRetABI.html#mk_params"><span class="id" title="constructor">FarRetABI.mk_params</span></a> (<a class="idref" href="EraVM.MemoryManagement.html#ForwardNewFatPointer"><span class="id" title="constructor">ForwardNewFatPointer</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#heap_type:65"><span class="id" title="variable">heap_type</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#hspan:66"><span class="id" title="variable">hspan</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.MemoryManagement.html#growth_to_span_unaffordable"><span class="id" title="inductive">growth_to_span_unaffordable</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#cs0:70"><span class="id" title="variable">cs0</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#heap_type:65"><span class="id" title="variable">heap_type</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#hspan:66"><span class="id" title="variable">hspan</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.StepPanic.html#step_panic"><span class="id" title="inductive">step_panic</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.VMPanic.html#FatPointerCreationUnaffordable"><span class="id" title="constructor">FatPointerCreationUnaffordable</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#s1:68"><span class="id" title="variable">s1</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#s2:69"><span class="id" title="variable">s2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.FarRevert.html#step_farrevert:2"><span class="id" title="inductive">step_farrevert</span></a> (<a class="idref" href="EraVM.isa.CoreSet.html#OpFarRevert"><span class="id" title="constructor">OpFarRevert</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="EraVM.PrimitiveValue.html#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#params:67"><span class="id" title="variable">params</span></a>))) <a class="idref" href="EraVM.sem.FarRevert.html#s1:68"><span class="id" title="variable">s1</span></a> <a class="idref" href="EraVM.sem.FarRevert.html#s2:69"><span class="id" title="variable">s2</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="EraVM.sem.FarRevert.html#FarRevertDefinition"><span class="id" title="section">FarRevertDefinition</span></a>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>