<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>EraVM.CallStack</title>

  <script defer=""
  src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <link rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css" />
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.CallStack</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">RecordSetNotations</span>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="EraVM.Common.html#"><span class="id" title="library">Common</span></a> <a class="idref" href="EraVM.Ergs.html#"><span class="id" title="library">Ergs</span></a> <a class="idref" href="EraVM.KernelMode.html#"><span class="id" title="library">KernelMode</span></a> <a class="idref" href="EraVM.memory.Depot.html#"><span class="id" title="library">memory.Depot</span></a> <a class="idref" href="EraVM.TransientMemory.html#"><span class="id" title="library">TransientMemory</span></a> <a class="idref" href="EraVM.MemoryContext.html#"><span class="id" title="library">MemoryContext</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="EraVM.Common.html#"><span class="id" title="module">Common</span></a> <a class="idref" href="EraVM.Ergs.html#"><span class="id" title="module">Ergs</span></a> <a class="idref" href="EraVM.KernelMode.html#"><span class="id" title="module">KernelMode</span></a> <a class="idref" href="EraVM.memory.Depot.html#"><span class="id" title="module">memory.Depot</span></a> <a class="idref" href="EraVM.TransientMemory.html#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="EraVM.MemoryContext.html#"><span class="id" title="module">MemoryContext</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Lists.List.html#"><span class="id" title="module">List</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Lists.List.html#ListNotations"><span class="id" title="module">ListNotations</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Callstack" class="idref" href="#Callstack"><span class="id" title="section">Callstack</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="CALLSTACK_LIMIT:1" class="idref" href="#CALLSTACK_LIMIT:1"><span class="id" title="binder">CALLSTACK_LIMIT</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="state_checkpoint:2" class="idref" href="#state_checkpoint:2"><span class="id" title="binder">state_checkpoint</span></a>: <span class="id" title="keyword">Type</span>} {<a id="ins:3" class="idref" href="#ins:3"><span class="id" title="binder">ins</span></a>: <span class="id" title="keyword">Type</span>} (<a id="ins_invalid:4" class="idref" href="#ins_invalid:4"><span class="id" title="binder">ins_invalid</span></a>: <a class="idref" href="EraVM.CallStack.html#ins:3"><span class="id" title="variable">ins</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="exception_handler" class="idref" href="#exception_handler"><span class="id" title="definition">exception_handler</span></a> := <a class="idref" href="EraVM.memory.PageTypes.html#code_address"><span class="id" title="definition">code_address</span></a>.<br/>

<br/>
</div>

<div class="doc"><h1 id="call-stack">Call stack</h1>
<p>EraVM operates with two stacks:</p>
<ol type="1">
<li>call stack, which supports function and contract execution</li>
<li>data stack, aiding in computations.</li>
</ol>
<p>Data stack has a role similar to the stack in JVM and other language
virtual machines. Call stack may be implemented in any way, but it is
separated from data stack. This section covers the call stack in
detail.</p>
<p>A <strong>stack frame</strong>, or <strong>call frame</strong>, is a
data structure representing a fragment of current execution environment
associated with a running instance of a contract or a function.</p>
<p>There are two types of stack frames:</p>
<ul>
<li>External frames <span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#ExternalCall"><span
class="id" title="constructor">ExternalCall</span></a></span>: created
on far calls (by instructions <span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpFarCall"><span
class="id" title="constructor">OpFarCall</span></a></span>, <span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpMimicCall"><span
class="id" title="constructor">OpMimicCall</span></a></span>, <span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span>).</li>
<li>Internal frames <span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#InternalCall"><span
class="id" title="constructor">InternalCall</span></a></span>: created
by near calls (by instruction <span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpNearCall"><span
class="id" title="constructor">OpNearCall</span></a></span>).</li>
</ul>
<p>Each external frame is <strong>associated</strong> with a contract
address. It means that it was created when the associated contract
address was far called. Naturally, each contract may be called many
times recursively, therefore at each moment of time any contract may
have multiple external frames associated to it.</p>
<p><strong><span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#callstack"><span
class="id" title="inductive">callstack</span></a></span></strong> is a
stack of a maximum of <span class="inlinecode"><span class="id"
title="var">CALLSTACK_LIMIT</span></span> stack frames. It is unrelated
to the <span
class="inlinecode"><a class="idref" href="EraVM.TransientMemory.html#stack_page"><span
class="id" title="definition">stack_page</span></a></span> which holds
data stack.</p>
<p>There is one callstack per execution, stored in <span
class="inlinecode"><a class="idref" href="EraVM.State.html#state"><span
class="id" title="record">state</span></a></span> in <span
class="inlinecode"><a class="idref" href="EraVM.State.html#gs_callstack"><span
class="id" title="projection">gs_callstack</span></a></span> field.</p>
<p>Internal call frames hold the following information:</p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#cf_exception_handler_location"><span
class="id"
title="projection">cf_exception_handler_location</span></a></span>: a
<span
class="inlinecode"><a class="idref" href="EraVM.memory.PageTypes.html#code_address"><span
class="id" title="definition">code_address</span></a></span> of an
exception handler. On revert or panic VM destroys the topmost frame and
jumps to this handler.</li>
<li><span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#cf_sp"><span
class="id" title="projection">cf_sp</span></a></span>: current
<strong>data stack</strong> pointer. The topmost element in data stack
is located at <span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#cf_sp"><span
class="id" title="projection">cf_sp</span></a>-1</span> in the currently
<span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#active_stackpage"><span
class="id" title="inductive">active_stackpage</span></a></span>.</li>
<li><span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#cf_ergs_remaining"><span
class="id" title="projection">cf_ergs_remaining</span></a></span>: ergs
allocated for the current function or contract. It decreases as VM
spends ergs for its operation.</li>
<li><span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#cf_saved_checkpoint"><span
class="id" title="projection">cf_saved_checkpoint</span></a></span> : a
snapshot of the state for a rollback. In case of panic or revert, the
state of storage and event queues will be restored.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="callstack_common" class="idref" href="#callstack_common"><span class="id" title="record">callstack_common</span></a> := <span class="id" title="var">mk_cf</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="cf_exception_handler_location" class="idref" href="#cf_exception_handler_location"><span class="id" title="projection">cf_exception_handler_location</span></a>: <a class="idref" href="EraVM.CallStack.html#exception_handler"><span class="id" title="definition">exception_handler</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="cf_sp" class="idref" href="#cf_sp"><span class="id" title="projection">cf_sp</span></a>: <a class="idref" href="EraVM.TransientMemory.html#stack_address"><span class="id" title="definition">stack_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="cf_pc" class="idref" href="#cf_pc"><span class="id" title="projection">cf_pc</span></a>: <a class="idref" href="EraVM.memory.PageTypes.html#code_address"><span class="id" title="definition">code_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="cf_ergs_remaining" class="idref" href="#cf_ergs_remaining"><span class="id" title="projection">cf_ergs_remaining</span></a>: <a class="idref" href="EraVM.Ergs.html#ergs"><span class="id" title="definition">ergs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="cf_saved_checkpoint" class="idref" href="#cf_saved_checkpoint"><span class="id" title="projection">cf_saved_checkpoint</span></a>: <a class="idref" href="EraVM.CallStack.html#Callstack.state_checkpoint"><span class="id" title="variable">state_checkpoint</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
</div>

<div class="doc"><p>External call frames hold the same information as internal.
Additionally, they hold:</p>
<ul>
<li><p>Three associated contract addresses:</p>
<ol type="1">
<li><span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#ecf_this_address"><span
class="id" title="projection">ecf_this_address</span></a></span> : the
stack frame was created when this contract was called.</li>
<li><span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#ecf_msg_sender"><span
class="id" title="projection">ecf_msg_sender</span></a></span> : the
stack frame was created when this contract invoked one of far call
instructions.</li>
<li><span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#ecf_code_address"><span
class="id" title="projection">ecf_code_address</span></a></span> : which
contract owns the code associated with the stack frame. It is not always
the same contract as <span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#ecf_this_address"><span
class="id" title="projection">ecf_this_address</span></a></span>.</li>
</ol></li>
<li><p><span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#ecf_mem_ctx"><span
class="id" title="projection">ecf_mem_ctx</span></a></span> : current
<span
class="inlinecode"><a class="idref" href="EraVM.MemoryContext.html#mem_ctx"><span
class="id" title="record">mem_ctx</span></a></span> holding ids of
active stack, heap variants, code, const pages and bounds of data
pages.</p></li>
<li><p>boolean <span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#ecf_is_static"><span
class="id" title="projection">ecf_is_static</span></a></span> : true if
the code associated with this frame is being executed in static
mode.</p></li>
<li><p><span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#ecf_context_u128_value"><span
class="id" title="projection">ecf_context_u128_value</span></a></span> :
captured value of <span
class="inlinecode"><a class="idref" href="EraVM.State.html#gs_context_u128"><span
class="id" title="projection">gs_context_u128</span></a></span>. It
represents a snapshot of the value of global register <span
class="inlinecode"><a class="idref" href="EraVM.State.html#gs_context_u128"><span
class="id" title="projection">gs_context_u128</span></a></span> in a
moment of far call to the current contract.</p></li>
<li><p><span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#ecf_shards"><span
class="id" title="projection">ecf_shards</span></a></span> : shards
associated with <span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#ecf_this_address"><span
class="id" title="projection">ecf_this_address</span></a></span>, <span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#ecf_msg_sender"><span
class="id" title="projection">ecf_msg_sender</span></a></span> and <span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#ecf_code_address"><span
class="id"
title="projection">ecf_code_address</span></a></span>.</p></li>
</ul>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="active_shards" class="idref" href="#active_shards"><span class="id" title="record">active_shards</span></a> := <span class="id" title="var">mk_shards</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="shard_this" class="idref" href="#shard_this"><span class="id" title="projection">shard_this</span></a>: <a class="idref" href="EraVM.memory.Depot.html#shard_id"><span class="id" title="definition">shard_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="shard_caller" class="idref" href="#shard_caller"><span class="id" title="projection">shard_caller</span></a>: <a class="idref" href="EraVM.memory.Depot.html#shard_id"><span class="id" title="definition">shard_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="shard_code" class="idref" href="#shard_code"><span class="id" title="projection">shard_code</span></a>: <a class="idref" href="EraVM.memory.Depot.html#shard_id"><span class="id" title="definition">shard_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="associated_contracts" class="idref" href="#associated_contracts"><span class="id" title="record">associated_contracts</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mk_assoc_contracts</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ecf_this_address" class="idref" href="#ecf_this_address"><span class="id" title="projection">ecf_this_address</span></a>: <a class="idref" href="EraVM.memory.Depot.html#contract_address"><span class="id" title="definition">contract_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ecf_msg_sender" class="idref" href="#ecf_msg_sender"><span class="id" title="projection">ecf_msg_sender</span></a>: <a class="idref" href="EraVM.memory.Depot.html#contract_address"><span class="id" title="definition">contract_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ecf_code_address" class="idref" href="#ecf_code_address"><span class="id" title="projection">ecf_code_address</span></a>: <a class="idref" href="EraVM.memory.Depot.html#contract_address"><span class="id" title="definition">contract_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="callstack_external" class="idref" href="#callstack_external"><span class="id" title="record">callstack_external</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mk_extcf</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ecf_associated" class="idref" href="#ecf_associated"><span class="id" title="projection">ecf_associated</span></a>:> <a class="idref" href="EraVM.CallStack.html#associated_contracts"><span class="id" title="record">associated_contracts</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ecf_mem_ctx" class="idref" href="#ecf_mem_ctx"><span class="id" title="projection">ecf_mem_ctx</span></a>: <a class="idref" href="EraVM.MemoryContext.html#mem_ctx"><span class="id" title="record">mem_ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ecf_is_static" class="idref" href="#ecf_is_static"><span class="id" title="projection">ecf_is_static</span></a>: <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>; <span class="comment">(*&nbsp;forbids&nbsp;any&nbsp;write-like&nbsp;"log"&nbsp;and&nbsp;so&nbsp;state&nbsp;modifications,&nbsp;event&nbsp;emissions,&nbsp;etc&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ecf_context_u128_value" class="idref" href="#ecf_context_u128_value"><span class="id" title="projection">ecf_context_u128_value</span></a>: <a class="idref" href="EraVM.Types.html#u128"><span class="id" title="definition">u128</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ecf_shards" class="idref" href="#ecf_shards"><span class="id" title="projection">ecf_shards</span></a>:> <a class="idref" href="EraVM.CallStack.html#active_shards"><span class="id" title="record">active_shards</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ecf_common" class="idref" href="#ecf_common"><span class="id" title="projection">ecf_common</span></a> :> <a class="idref" href="EraVM.CallStack.html#callstack_common"><span class="id" title="record">callstack_common</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="callstack" class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> :=<br/>
&nbsp;&nbsp;| <a id="InternalCall" class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> (<span class="id" title="var">_</span>: <a class="idref" href="EraVM.CallStack.html#callstack_common"><span class="id" title="record">callstack_common</span></a>) (<a id="tail:28" class="idref" href="#tail:28"><span class="id" title="binder">tail</span></a>: <a class="idref" href="EraVM.CallStack.html#callstack:26"><span class="id" title="inductive">callstack</span></a>): <a class="idref" href="EraVM.CallStack.html#callstack:26"><span class="id" title="inductive">callstack</span></a><br/>
&nbsp;&nbsp;| <a id="ExternalCall" class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> (<span class="id" title="var">_</span>: <a class="idref" href="EraVM.CallStack.html#callstack_external"><span class="id" title="record">callstack_external</span></a>) (<a id="tail:29" class="idref" href="#tail:29"><span class="id" title="binder">tail</span></a>: <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="EraVM.CallStack.html#callstack:26"><span class="id" title="inductive">callstack</span></a>): <a class="idref" href="EraVM.CallStack.html#callstack:26"><span class="id" title="inductive">callstack</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <a id="callstack_depth" class="idref" href="#callstack_depth"><span class="id" title="definition">callstack_depth</span></a> <a id="cf:30" class="idref" href="#cf:30"><span class="id" title="binder">cf</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">match</span> <a class="idref" href="EraVM.CallStack.html#cf:30"><span class="id" title="variable">cf</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.CallStack.html#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Lists.List.html#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ 1 <span class="id" title="notation">+</span> <a class="idref" href="EraVM.CallStack.html#callstack_depth:31"><span class="id" title="definition">callstack_depth</span></a> <span class="id" title="var">tail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <span class="id" title="var">x</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Lists.List.html#tail"><span class="id" title="abbreviation">tail</span></a>)=> 1 <span class="id" title="notation">+</span> <a class="idref" href="EraVM.CallStack.html#callstack_depth:31"><span class="id" title="definition">callstack_depth</span></a> <span class="id" title="var">tail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>)%<span class="id" title="var">nat</span>.<br/>

<br/>
</div>

<div class="doc"><h2 id="operation">Operation</h2>
<p>When the server starts forming a new block, it starts a new instance
of VM to execute the code called <span
class="inlinecode"><a class="idref" href="EraVM.Bootloader.html#Bootloader"><span
class="id" title="section">Bootloader</span></a></span>. Bootloader is a
contract with an address <span
class="inlinecode"><a class="idref" href="EraVM.Bootloader.html#BOOTLOADER_SYSTEM_CONTRACT_ADDRESS"><span
class="id"
title="definition">BOOTLOADER_SYSTEM_CONTRACT_ADDRESS</span></a></span>.
To support its execution, a corresponding <span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#ExternalCall"><span
class="id" title="constructor">ExternalCall</span></a></span> frame with
is pushed to the call stack.</p>
<p>Handling each transaction requires executing <span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpFarCall"><span
class="id" title="constructor">OpFarCall</span></a></span>, which pushes
another call frame to the callstack.</p>
<p>As the transaction is executed, call stack changes as follows:</p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpNearCall"><span
class="id" title="constructor">OpNearCall</span></a></span> pushes an
<span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#InternalCall"><span
class="id" title="constructor">InternalCall</span></a></span> frame to
callstack.</li>
<li><span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpFarCall"><span
class="id" title="constructor">OpFarCall</span></a></span>, <span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span>, or
<span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpMimicCall"><span
class="id" title="constructor">OpMimicCall</span></a></span> push an
<span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#ExternalCall"><span
class="id" title="constructor">ExternalCall</span></a></span> frame to
callstack.</li>
<li><span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpNearRetTo"><span
class="id" title="constructor">OpNearRetTo</span></a></span>, <span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpRevert"><span
class="id" title="constructor">OpRevert</span></a></span>, <span
class="inlinecode"><span class="id"
title="var">OpRevertTo</span></span>, <span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpPanic"><span
class="id" title="constructor">OpPanic</span></a></span>, <span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpRet"><span
class="id" title="constructor">OpRet</span></a></span> pop a frame from
callstack.</li>
</ul>
<p>Attempting to have more than <span class="inlinecode"><span
class="id" title="var">CALLSTACK_LIMIT</span></span> elements in
callstack will force the VM into panic.</p>
<p>Panics are equivalent to executing <span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpPanic"><span
class="id" title="constructor">OpPanic</span></a></span>, so they pop up
the topmost stack frame and pass the control to the exception handler,
specified in the popped frame.</p>
<p>Executing any instruction <span class="math inline">I</span> changes
the topmost frame:</p>
<ol type="1">
<li><span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#cf_pc"><span
class="id" title="projection">cf_pc</span></a></span> is incremented,
unless <span class="math inline">I</span> is <span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpJump"><span
class="id" title="constructor">OpJump</span></a></span> .</li>
<li><span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#cf_sp"><span
class="id" title="projection">cf_sp</span></a></span> may be modified if
<span class="math inline">I</span> affects the data stack pointer
through addressing modes <span
class="inlinecode"><a class="idref" href="EraVM.Addressing.html#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span> or <span
class="inlinecode"><a class="idref" href="EraVM.Addressing.html#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span>.</li>
<li><span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#cf_ergs_remaining"><span
class="id" title="projection">cf_ergs_remaining</span></a></span> is
decreased by the <strong>total cost</strong> of <span
class="math inline">I</span>. Total cost is a sum of <span
class="inlinecode"><a class="idref" href="EraVM.Ergs.html#base_cost"><span
class="id" title="definition">base_cost</span></a></span> and additional
costs, described by the small step predicates like <span
class="inlinecode"><a class="idref" href="EraVM.sem.Jump.html#step_jump"><span
class="id" title="inductive">step_jump</span></a></span>.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="stack_overflow" class="idref" href="#stack_overflow"><span class="id" title="definition">stack_overflow</span></a> (<a id="xstack:33" class="idref" href="#xstack:33"><span class="id" title="binder">xstack</span></a>:<a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Nat.html#ltb"><span class="id" title="definition">Nat.ltb</span></a> <a class="idref" href="EraVM.CallStack.html#Callstack.CALLSTACK_LIMIT"><span class="id" title="variable">CALLSTACK_LIMIT</span></a> (<a class="idref" href="EraVM.CallStack.html#callstack_depth"><span class="id" title="definition">callstack_depth</span></a> <a class="idref" href="EraVM.CallStack.html#xstack:33"><span class="id" title="variable">xstack</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="cfc" class="idref" href="#cfc"><span class="id" title="definition">cfc</span></a> (<a id="ef:34" class="idref" href="#ef:34"><span class="id" title="binder">ef</span></a>: <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="EraVM.CallStack.html#callstack_common"><span class="id" title="record">callstack_common</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="EraVM.CallStack.html#ef:34"><span class="id" title="variable">ef</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.CallStack.html#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <span class="id" title="var">x</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <span class="id" title="var">x</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="cfc_map" class="idref" href="#cfc_map"><span class="id" title="definition">cfc_map</span></a> (<a id="f:36" class="idref" href="#f:36"><span class="id" title="binder">f</span></a>:<a class="idref" href="EraVM.CallStack.html#callstack_common"><span class="id" title="record">callstack_common</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><a class="idref" href="EraVM.CallStack.html#callstack_common"><span class="id" title="record">callstack_common</span></a>) (<a id="ef:37" class="idref" href="#ef:37"><span class="id" title="binder">ef</span></a>: <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="EraVM.CallStack.html#ef:37"><span class="id" title="variable">ef</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.CallStack.html#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Lists.List.html#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <a class="idref" href="EraVM.CallStack.html#InternalCall"><span class="id" title="constructor">InternalCall</span></a> (<a class="idref" href="EraVM.CallStack.html#f:36"><span class="id" title="variable">f</span></a> <span class="id" title="var">x</span>) <span class="id" title="var">tail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Lists.List.html#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> (<span class="id" title="var">x</span> <span class="id" title="notation"><|</span> <a class="idref" href="EraVM.CallStack.html#ecf_common"><span class="id" title="projection">ecf_common</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="EraVM.CallStack.html#f:36"><span class="id" title="variable">f</span></a> <span class="id" title="notation">|></span>) <span class="id" title="var">tail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Callstack.ErgsManagement" class="idref" href="#Callstack.ErgsManagement"><span class="id" title="section">ErgsManagement</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="ergs_remaining" class="idref" href="#ergs_remaining"><span class="id" title="definition">ergs_remaining</span></a> (<a id="ef:39" class="idref" href="#ef:39"><span class="id" title="binder">ef</span></a>:<a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="EraVM.Ergs.html#ergs"><span class="id" title="definition">ergs</span></a> := (<a class="idref" href="EraVM.CallStack.html#cfc"><span class="id" title="definition">cfc</span></a> <a class="idref" href="EraVM.CallStack.html#ef:39"><span class="id" title="variable">ef</span></a>).(<a class="idref" href="EraVM.CallStack.html#cf_ergs_remaining"><span class="id" title="projection">cf_ergs_remaining</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="ergs_map" class="idref" href="#ergs_map"><span class="id" title="definition">ergs_map</span></a> (<a id="f:40" class="idref" href="#f:40"><span class="id" title="binder">f</span></a>: <a class="idref" href="EraVM.Ergs.html#ergs"><span class="id" title="definition">ergs</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><a class="idref" href="EraVM.Ergs.html#ergs"><span class="id" title="definition">ergs</span></a>) (<a id="ef:41" class="idref" href="#ef:41"><span class="id" title="binder">ef</span></a>:<a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <a class="idref" href="EraVM.CallStack.html#cfc_map"><span class="id" title="definition">cfc_map</span></a> (<span class="id" title="keyword">fun</span> <a id="x:42" class="idref" href="#x:42"><span class="id" title="binder">x</span></a> ⇒ <a class="idref" href="EraVM.CallStack.html#x:42"><span class="id" title="variable">x</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="EraVM.CallStack.html#cf_ergs_remaining"><span class="id" title="projection">cf_ergs_remaining</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="EraVM.CallStack.html#f:40"><span class="id" title="variable">f</span></a> <span class="id" title="notation">|></span>) <a class="idref" href="EraVM.CallStack.html#ef:41"><span class="id" title="variable">ef</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="ergs_set" class="idref" href="#ergs_set"><span class="id" title="definition">ergs_set</span></a> <a id="newergs:43" class="idref" href="#newergs:43"><span class="id" title="binder">newergs</span></a> := <a class="idref" href="EraVM.CallStack.html#ergs_map"><span class="id" title="definition">ergs_map</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="EraVM.CallStack.html#newergs:43"><span class="id" title="variable">newergs</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="ergs_return" class="idref" href="#ergs_return"><span class="id" title="inductive">ergs_return</span></a>: <a class="idref" href="EraVM.Ergs.html#ergs"><span class="id" title="definition">ergs</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="er_return" class="idref" href="#er_return"><span class="id" title="constructor">er_return</span></a>: <span class="id" title="keyword">∀</span> <a id="delta:46" class="idref" href="#delta:46"><span class="id" title="binder">delta</span></a> <a id="new_ergs:47" class="idref" href="#new_ergs:47"><span class="id" title="binder">new_ergs</span></a> <a id="ef:48" class="idref" href="#ef:48"><span class="id" title="binder">ef</span></a> <a id="ef':49" class="idref" href="#ef':49"><span class="id" title="binder">ef'</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#delta:46"><span class="id" title="variable">delta</span></a> <a class="idref" href="EraVM.Arith.html#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <a class="idref" href="EraVM.CallStack.html#ergs_remaining"><span class="id" title="definition">ergs_remaining</span></a> <a class="idref" href="EraVM.CallStack.html#ef:48"><span class="id" title="variable">ef</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="EraVM.CallStack.html#new_ergs:47"><span class="id" title="variable">new_ergs</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ef':49"><span class="id" title="variable">ef'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.CallStack.html#ergs_set"><span class="id" title="definition">ergs_set</span></a> <a class="idref" href="EraVM.CallStack.html#new_ergs:47"><span class="id" title="variable">new_ergs</span></a> <a class="idref" href="EraVM.CallStack.html#ef:48"><span class="id" title="variable">ef</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ergs_return:44"><span class="id" title="inductive">ergs_return</span></a> <a class="idref" href="EraVM.CallStack.html#delta:46"><span class="id" title="variable">delta</span></a> <a class="idref" href="EraVM.CallStack.html#ef:48"><span class="id" title="variable">ef</span></a> <a class="idref" href="EraVM.CallStack.html#ef':49"><span class="id" title="variable">ef'</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="ergs_return_caller_and_drop" class="idref" href="#ergs_return_caller_and_drop"><span class="id" title="inductive">ergs_return_caller_and_drop</span></a> : <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<a id="erc_internal" class="idref" href="#erc_internal"><span class="id" title="constructor">erc_internal</span></a>: <span class="id" title="keyword">∀</span> <a id="caller:52" class="idref" href="#caller:52"><span class="id" title="binder">caller</span></a> <a id="new_caller:53" class="idref" href="#new_caller:53"><span class="id" title="binder">new_caller</span></a> <a id="cf:54" class="idref" href="#cf:54"><span class="id" title="binder">cf</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ergs_return"><span class="id" title="inductive">ergs_return</span></a> (<a class="idref" href="EraVM.CallStack.html#ergs_remaining"><span class="id" title="definition">ergs_remaining</span></a> (<a class="idref" href="EraVM.CallStack.html#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="EraVM.CallStack.html#cf:54"><span class="id" title="variable">cf</span></a> <a class="idref" href="EraVM.CallStack.html#caller:52"><span class="id" title="variable">caller</span></a>)) <a class="idref" href="EraVM.CallStack.html#caller:52"><span class="id" title="variable">caller</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#new_caller:53"><span class="id" title="variable">new_caller</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ergs_return_caller_and_drop:50"><span class="id" title="inductive">ergs_return_caller_and_drop</span></a> (<a class="idref" href="EraVM.CallStack.html#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="EraVM.CallStack.html#cf:54"><span class="id" title="variable">cf</span></a> <a class="idref" href="EraVM.CallStack.html#caller:52"><span class="id" title="variable">caller</span></a>) <a class="idref" href="EraVM.CallStack.html#new_caller:53"><span class="id" title="variable">new_caller</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<a id="erc_external" class="idref" href="#erc_external"><span class="id" title="constructor">erc_external</span></a>: <span class="id" title="keyword">∀</span> <a id="caller:55" class="idref" href="#caller:55"><span class="id" title="binder">caller</span></a> <a id="new_caller:56" class="idref" href="#new_caller:56"><span class="id" title="binder">new_caller</span></a> <a id="cf:57" class="idref" href="#cf:57"><span class="id" title="binder">cf</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ergs_return"><span class="id" title="inductive">ergs_return</span></a> (<a class="idref" href="EraVM.CallStack.html#ergs_remaining"><span class="id" title="definition">ergs_remaining</span></a> (<a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="EraVM.CallStack.html#cf:57"><span class="id" title="variable">cf</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="EraVM.CallStack.html#caller:55"><span class="id" title="variable">caller</span></a>))) <a class="idref" href="EraVM.CallStack.html#caller:55"><span class="id" title="variable">caller</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#new_caller:56"><span class="id" title="variable">new_caller</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ergs_return_caller_and_drop:50"><span class="id" title="inductive">ergs_return_caller_and_drop</span></a> (<a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="EraVM.CallStack.html#cf:57"><span class="id" title="variable">cf</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="EraVM.CallStack.html#caller:55"><span class="id" title="variable">caller</span></a>)) <a class="idref" href="EraVM.CallStack.html#new_caller:56"><span class="id" title="variable">new_caller</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="ergs_reset" class="idref" href="#ergs_reset"><span class="id" title="definition">ergs_reset</span></a> := <a class="idref" href="EraVM.CallStack.html#ergs_set"><span class="id" title="definition">ergs_set</span></a> <a class="idref" href="EraVM.Types.html#zero32"><span class="id" title="definition">zero32</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="affordable" class="idref" href="#affordable"><span class="id" title="definition">affordable</span></a> (<a id="ef:58" class="idref" href="#ef:58"><span class="id" title="binder">ef</span></a>: <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a>) (<a id="e:59" class="idref" href="#e:59"><span class="id" title="binder">e</span></a>:<a class="idref" href="EraVM.Ergs.html#ergs"><span class="id" title="definition">ergs</span></a>): <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="EraVM.CallStack.html#ergs_remaining"><span class="id" title="definition">ergs_remaining</span></a> <a class="idref" href="EraVM.CallStack.html#ef:58"><span class="id" title="variable">ef</span></a> <a class="idref" href="EraVM.Arith.html#::ZMod_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="EraVM.CallStack.html#e:59"><span class="id" title="variable">e</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">paid</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">overflowed</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="pay" class="idref" href="#pay"><span class="id" title="inductive">pay</span></a> : <a class="idref" href="EraVM.Ergs.html#ergs"><span class="id" title="definition">ergs</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="pay_ergs" class="idref" href="#pay_ergs"><span class="id" title="constructor">pay_ergs</span></a> : <span class="id" title="keyword">∀</span> <a id="e:62" class="idref" href="#e:62"><span class="id" title="binder">e</span></a> <a id="ef:63" class="idref" href="#ef:63"><span class="id" title="binder">ef</span></a> <a id="paid:64" class="idref" href="#paid:64"><span class="id" title="binder">paid</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ergs_remaining"><span class="id" title="definition">ergs_remaining</span></a> <a class="idref" href="EraVM.CallStack.html#ef:63"><span class="id" title="variable">ef</span></a> <a class="idref" href="EraVM.Arith.html#::ZMod_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="EraVM.CallStack.html#e:62"><span class="id" title="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="EraVM.CallStack.html#paid:64"><span class="id" title="variable">paid</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#pay:60"><span class="id" title="inductive">pay</span></a> <a class="idref" href="EraVM.CallStack.html#e:62"><span class="id" title="variable">e</span></a> <a class="idref" href="EraVM.CallStack.html#ef:63"><span class="id" title="variable">ef</span></a> (<a class="idref" href="EraVM.CallStack.html#ergs_set"><span class="id" title="definition">ergs_set</span></a> <a class="idref" href="EraVM.CallStack.html#paid:64"><span class="id" title="variable">paid</span></a> <a class="idref" href="EraVM.CallStack.html#ef:63"><span class="id" title="variable">ef</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="EraVM.CallStack.html#Callstack.ErgsManagement"><span class="id" title="section">ErgsManagement</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Callstack.SP" class="idref" href="#Callstack.SP"><span class="id" title="section">SP</span></a>.<br/>
</div>

<div class="doc"><p>Fetching value of the stack pointer itself.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="sp_get" class="idref" href="#sp_get"><span class="id" title="definition">sp_get</span></a> (<a id="cf:65" class="idref" href="#cf:65"><span class="id" title="binder">cf</span></a>: <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="EraVM.TransientMemory.html#stack_address"><span class="id" title="definition">stack_address</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="EraVM.CallStack.html#cfc"><span class="id" title="definition">cfc</span></a> <a class="idref" href="EraVM.CallStack.html#cf:65"><span class="id" title="variable">cf</span></a>).(<a class="idref" href="EraVM.CallStack.html#cf_sp"><span class="id" title="projection">cf_sp</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="sp_map_extcall" class="idref" href="#sp_map_extcall"><span class="id" title="definition">sp_map_extcall</span></a> (<a id="f:66" class="idref" href="#f:66"><span class="id" title="binder">f</span></a>:<a class="idref" href="EraVM.TransientMemory.html#stack_address"><span class="id" title="definition">stack_address</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><a class="idref" href="EraVM.TransientMemory.html#stack_address"><span class="id" title="definition">stack_address</span></a>) <a id="ef:67" class="idref" href="#ef:67"><span class="id" title="binder">ef</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="EraVM.CallStack.html#ef:67"><span class="id" title="variable">ef</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="EraVM.CallStack.html#ecf_common"><span class="id" title="projection">ecf_common</span></a> <span class="id" title="notation">::=</span> <span class="id" title="keyword">fun</span> <a id="cf:68" class="idref" href="#cf:68"><span class="id" title="binder">cf</span></a> ⇒ <a class="idref" href="EraVM.CallStack.html#cf:68"><span class="id" title="variable">cf</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="EraVM.CallStack.html#cf_sp"><span class="id" title="projection">cf_sp</span></a> <span class="id" title="notation">::=</span>  <a class="idref" href="EraVM.CallStack.html#f:66"><span class="id" title="variable">f</span></a> <span class="id" title="notation">|></span> <span class="id" title="notation">|></span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="sp_map_extcall_spec" class="idref" href="#sp_map_extcall_spec"><span class="id" title="inductive">sp_map_extcall_spec</span></a> <a id="f:69" class="idref" href="#f:69"><span class="id" title="binder">f</span></a>: <a class="idref" href="EraVM.CallStack.html#callstack_external"><span class="id" title="record">callstack_external</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.CallStack.html#callstack_external"><span class="id" title="record">callstack_external</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="sme_apply" class="idref" href="#sme_apply"><span class="id" title="constructor">sme_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="a:72" class="idref" href="#a:72"><span class="id" title="binder">a</span></a> <a id="d:73" class="idref" href="#d:73"><span class="id" title="binder">d</span></a> <a id="e:74" class="idref" href="#e:74"><span class="id" title="binder">e</span></a> <a id="g:75" class="idref" href="#g:75"><span class="id" title="binder">g</span></a> <a id="h:76" class="idref" href="#h:76"><span class="id" title="binder">h</span></a> <a id="eh:77" class="idref" href="#eh:77"><span class="id" title="binder">eh</span></a> <a id="sp:78" class="idref" href="#sp:78"><span class="id" title="binder">sp</span></a> <a id="pc:79" class="idref" href="#pc:79"><span class="id" title="binder">pc</span></a> <a id="ss:80" class="idref" href="#ss:80"><span class="id" title="binder">ss</span></a> <a id="ergs:81" class="idref" href="#ergs:81"><span class="id" title="binder">ergs</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#sp_map_extcall_spec:70"><span class="id" title="inductive">sp_map_extcall_spec</span></a> <a class="idref" href="EraVM.CallStack.html#f:69"><span class="id" title="variable">f</span></a> (<a class="idref" href="EraVM.CallStack.html#mk_extcf"><span class="id" title="constructor">mk_extcf</span></a> <a class="idref" href="EraVM.CallStack.html#a:72"><span class="id" title="variable">a</span></a> <a class="idref" href="EraVM.CallStack.html#d:73"><span class="id" title="variable">d</span></a> <a class="idref" href="EraVM.CallStack.html#e:74"><span class="id" title="variable">e</span></a> <a class="idref" href="EraVM.CallStack.html#g:75"><span class="id" title="variable">g</span></a> <a class="idref" href="EraVM.CallStack.html#h:76"><span class="id" title="variable">h</span></a> (<a class="idref" href="EraVM.CallStack.html#mk_cf"><span class="id" title="constructor">mk_cf</span></a> <a class="idref" href="EraVM.CallStack.html#eh:77"><span class="id" title="variable">eh</span></a> <a class="idref" href="EraVM.CallStack.html#sp:78"><span class="id" title="variable">sp</span></a> <a class="idref" href="EraVM.CallStack.html#pc:79"><span class="id" title="variable">pc</span></a> <a class="idref" href="EraVM.CallStack.html#ergs:81"><span class="id" title="variable">ergs</span></a> <a class="idref" href="EraVM.CallStack.html#ss:80"><span class="id" title="variable">ss</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="EraVM.CallStack.html#mk_extcf"><span class="id" title="constructor">mk_extcf</span></a> <a class="idref" href="EraVM.CallStack.html#a:72"><span class="id" title="variable">a</span></a> <a class="idref" href="EraVM.CallStack.html#d:73"><span class="id" title="variable">d</span></a> <a class="idref" href="EraVM.CallStack.html#e:74"><span class="id" title="variable">e</span></a> <a class="idref" href="EraVM.CallStack.html#g:75"><span class="id" title="variable">g</span></a> <a class="idref" href="EraVM.CallStack.html#h:76"><span class="id" title="variable">h</span></a> (<a class="idref" href="EraVM.CallStack.html#mk_cf"><span class="id" title="constructor">mk_cf</span></a> <a class="idref" href="EraVM.CallStack.html#eh:77"><span class="id" title="variable">eh</span></a> (<a class="idref" href="EraVM.CallStack.html#f:69"><span class="id" title="variable">f</span></a> <a class="idref" href="EraVM.CallStack.html#sp:78"><span class="id" title="variable">sp</span></a>) <a class="idref" href="EraVM.CallStack.html#pc:79"><span class="id" title="variable">pc</span></a> <a class="idref" href="EraVM.CallStack.html#ergs:81"><span class="id" title="variable">ergs</span></a> <a class="idref" href="EraVM.CallStack.html#ss:80"><span class="id" title="variable">ss</span></a>)).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="sp_map_extcall_correct" class="idref" href="#sp_map_extcall_correct"><span class="id" title="lemma">sp_map_extcall_correct</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="f:82" class="idref" href="#f:82"><span class="id" title="binder">f</span></a> <a id="ef:83" class="idref" href="#ef:83"><span class="id" title="binder">ef</span></a>, <a class="idref" href="EraVM.CallStack.html#sp_map_extcall_spec"><span class="id" title="inductive">sp_map_extcall_spec</span></a> <a class="idref" href="EraVM.CallStack.html#f:82"><span class="id" title="variable">f</span></a> <a class="idref" href="EraVM.CallStack.html#ef:83"><span class="id" title="variable">ef</span></a> (<a class="idref" href="EraVM.CallStack.html#sp_map_extcall"><span class="id" title="definition">sp_map_extcall</span></a> <a class="idref" href="EraVM.CallStack.html#f:82"><span class="id" title="variable">f</span></a> <a class="idref" href="EraVM.CallStack.html#ef:83"><span class="id" title="variable">ef</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="sp_map" class="idref" href="#sp_map"><span class="id" title="definition">sp_map</span></a> (<a id="f:84" class="idref" href="#f:84"><span class="id" title="binder">f</span></a>:<a class="idref" href="EraVM.TransientMemory.html#stack_address"><span class="id" title="definition">stack_address</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><a class="idref" href="EraVM.TransientMemory.html#stack_address"><span class="id" title="definition">stack_address</span></a>) <a id="ef:85" class="idref" href="#ef:85"><span class="id" title="binder">ef</span></a> : <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="EraVM.CallStack.html#ef:85"><span class="id" title="variable">ef</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.CallStack.html#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Lists.List.html#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <a class="idref" href="EraVM.CallStack.html#InternalCall"><span class="id" title="constructor">InternalCall</span></a> (<span class="id" title="var">x</span> <span class="id" title="notation"><|</span> <a class="idref" href="EraVM.CallStack.html#cf_sp"><span class="id" title="projection">cf_sp</span></a> <span class="id" title="notation">::=</span>  <a class="idref" href="EraVM.CallStack.html#f:84"><span class="id" title="variable">f</span></a> <span class="id" title="notation">|></span>) <span class="id" title="var">tail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Lists.List.html#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> (<a class="idref" href="EraVM.CallStack.html#sp_map_extcall"><span class="id" title="definition">sp_map_extcall</span></a> <a class="idref" href="EraVM.CallStack.html#f:84"><span class="id" title="variable">f</span></a> <span class="id" title="var">x</span>) <span class="id" title="var">tail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="sp_update" class="idref" href="#sp_update"><span class="id" title="definition">sp_update</span></a> <a id="new_sp:87" class="idref" href="#new_sp:87"><span class="id" title="binder">new_sp</span></a> := <a class="idref" href="EraVM.CallStack.html#sp_map"><span class="id" title="definition">sp_map</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="EraVM.CallStack.html#new_sp:87"><span class="id" title="variable">new_sp</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="sp_map_spec" class="idref" href="#sp_map_spec"><span class="id" title="inductive">sp_map_spec</span></a> <a id="f:88" class="idref" href="#f:88"><span class="id" title="binder">f</span></a> : <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="usp_ext" class="idref" href="#usp_ext"><span class="id" title="constructor">usp_ext</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="ecf:91" class="idref" href="#ecf:91"><span class="id" title="binder">ecf</span></a> <a id="ecf':92" class="idref" href="#ecf':92"><span class="id" title="binder">ecf'</span></a> <a id="tail:93" class="idref" href="#tail:93"><span class="id" title="binder">tail</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#sp_map_extcall_spec"><span class="id" title="inductive">sp_map_extcall_spec</span></a> <a class="idref" href="EraVM.CallStack.html#f:88"><span class="id" title="variable">f</span></a> <a class="idref" href="EraVM.CallStack.html#ecf:91"><span class="id" title="variable">ecf</span></a> <a class="idref" href="EraVM.CallStack.html#ecf':92"><span class="id" title="variable">ecf'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#sp_map_spec:89"><span class="id" title="inductive">sp_map_spec</span></a> <a class="idref" href="EraVM.CallStack.html#f:88"><span class="id" title="variable">f</span></a> (<a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="EraVM.CallStack.html#ecf:91"><span class="id" title="variable">ecf</span></a> <a class="idref" href="EraVM.CallStack.html#tail:93"><span class="id" title="variable">tail</span></a>) (<a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="EraVM.CallStack.html#ecf':92"><span class="id" title="variable">ecf'</span></a> <a class="idref" href="EraVM.CallStack.html#tail:93"><span class="id" title="variable">tail</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="usp_int" class="idref" href="#usp_int"><span class="id" title="constructor">usp_int</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span>  <a id="eh:94" class="idref" href="#eh:94"><span class="id" title="binder">eh</span></a> <a id="sp:95" class="idref" href="#sp:95"><span class="id" title="binder">sp</span></a> <a id="pc:96" class="idref" href="#pc:96"><span class="id" title="binder">pc</span></a> <a id="ergs:97" class="idref" href="#ergs:97"><span class="id" title="binder">ergs</span></a> <a id="tail:98" class="idref" href="#tail:98"><span class="id" title="binder">tail</span></a> <a id="ss:99" class="idref" href="#ss:99"><span class="id" title="binder">ss</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#sp_map_spec:89"><span class="id" title="inductive">sp_map_spec</span></a> <a class="idref" href="EraVM.CallStack.html#f:88"><span class="id" title="variable">f</span></a> (<a class="idref" href="EraVM.CallStack.html#InternalCall"><span class="id" title="constructor">InternalCall</span></a> (<a class="idref" href="EraVM.CallStack.html#mk_cf"><span class="id" title="constructor">mk_cf</span></a> <a class="idref" href="EraVM.CallStack.html#eh:94"><span class="id" title="variable">eh</span></a> <a class="idref" href="EraVM.CallStack.html#sp:95"><span class="id" title="variable">sp</span></a> <a class="idref" href="EraVM.CallStack.html#pc:96"><span class="id" title="variable">pc</span></a> <a class="idref" href="EraVM.CallStack.html#ergs:97"><span class="id" title="variable">ergs</span></a> <a class="idref" href="EraVM.CallStack.html#ss:99"><span class="id" title="variable">ss</span></a> ) <a class="idref" href="EraVM.CallStack.html#tail:98"><span class="id" title="variable">tail</span></a>) (<a class="idref" href="EraVM.CallStack.html#InternalCall"><span class="id" title="constructor">InternalCall</span></a> (<a class="idref" href="EraVM.CallStack.html#mk_cf"><span class="id" title="constructor">mk_cf</span></a> <a class="idref" href="EraVM.CallStack.html#eh:94"><span class="id" title="variable">eh</span></a> (<a class="idref" href="EraVM.CallStack.html#f:88"><span class="id" title="variable">f</span></a> <a class="idref" href="EraVM.CallStack.html#sp:95"><span class="id" title="variable">sp</span></a>) <a class="idref" href="EraVM.CallStack.html#pc:96"><span class="id" title="variable">pc</span></a> <a class="idref" href="EraVM.CallStack.html#ergs:97"><span class="id" title="variable">ergs</span></a> <a class="idref" href="EraVM.CallStack.html#ss:99"><span class="id" title="variable">ss</span></a>) <a class="idref" href="EraVM.CallStack.html#tail:98"><span class="id" title="variable">tail</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="sp_map_spec_correct" class="idref" href="#sp_map_spec_correct"><span class="id" title="lemma">sp_map_spec_correct</span></a> <a id="f:100" class="idref" href="#f:100"><span class="id" title="binder">f</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="ef:101" class="idref" href="#ef:101"><span class="id" title="binder">ef</span></a>, <a class="idref" href="EraVM.CallStack.html#sp_map_spec"><span class="id" title="inductive">sp_map_spec</span></a> <a class="idref" href="EraVM.CallStack.html#f:100"><span class="id" title="variable">f</span></a> <a class="idref" href="EraVM.CallStack.html#ef:101"><span class="id" title="variable">ef</span></a> (<a class="idref" href="EraVM.CallStack.html#sp_map"><span class="id" title="definition">sp_map</span></a> <a class="idref" href="EraVM.CallStack.html#f:100"><span class="id" title="variable">f</span></a> <a class="idref" href="EraVM.CallStack.html#ef:101"><span class="id" title="variable">ef</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="EraVM.CallStack.html#Callstack.SP"><span class="id" title="section">SP</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Callstack.PC" class="idref" href="#Callstack.PC"><span class="id" title="section">PC</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="pc_get" class="idref" href="#pc_get"><span class="id" title="definition">pc_get</span></a> (<a id="ef:102" class="idref" href="#ef:102"><span class="id" title="binder">ef</span></a>: <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="EraVM.memory.PageTypes.html#code_address"><span class="id" title="definition">code_address</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="EraVM.CallStack.html#ef:102"><span class="id" title="variable">ef</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.CallStack.html#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <span class="id" title="var">cf</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">cf</span>.(<a class="idref" href="EraVM.CallStack.html#cf_pc"><span class="id" title="projection">cf_pc</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <span class="id" title="var">ef</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Lists.List.html#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <a class="idref" href="EraVM.CallStack.html#ef:102"><span class="id" title="variable">ef</span></a>.(<a class="idref" href="EraVM.CallStack.html#ecf_common"><span class="id" title="projection">ecf_common</span></a>).(<a class="idref" href="EraVM.CallStack.html#cf_pc"><span class="id" title="projection">cf_pc</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="pc_map" class="idref" href="#pc_map"><span class="id" title="definition">pc_map</span></a> <a id="f:104" class="idref" href="#f:104"><span class="id" title="binder">f</span></a> <a id="ef:105" class="idref" href="#ef:105"><span class="id" title="binder">ef</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="EraVM.CallStack.html#ef:105"><span class="id" title="variable">ef</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.CallStack.html#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Lists.List.html#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <a class="idref" href="EraVM.CallStack.html#InternalCall"><span class="id" title="constructor">InternalCall</span></a> (<span class="id" title="var">x</span> <span class="id" title="notation"><|</span> <a class="idref" href="EraVM.CallStack.html#cf_pc"><span class="id" title="projection">cf_pc</span></a> <span class="id" title="notation">::=</span>  <a class="idref" href="EraVM.CallStack.html#f:104"><span class="id" title="variable">f</span></a> <span class="id" title="notation">|></span>) <span class="id" title="var">tail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Lists.List.html#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> (<span class="id" title="var">x</span> <span class="id" title="notation"><|</span> <a class="idref" href="EraVM.CallStack.html#ecf_common"><span class="id" title="projection">ecf_common</span></a> <span class="id" title="notation">::=</span> <span class="id" title="keyword">fun</span> <a id="cf:107" class="idref" href="#cf:107"><span class="id" title="binder">cf</span></a> ⇒ <a class="idref" href="EraVM.CallStack.html#cf:107"><span class="id" title="variable">cf</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="EraVM.CallStack.html#cf_pc"><span class="id" title="projection">cf_pc</span></a> <span class="id" title="notation">::=</span>  <a class="idref" href="EraVM.CallStack.html#f:104"><span class="id" title="variable">f</span></a> <span class="id" title="notation">|></span> <span class="id" title="notation">|></span>) <span class="id" title="var">tail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="pc_set" class="idref" href="#pc_set"><span class="id" title="definition">pc_set</span></a> <a id="new:108" class="idref" href="#new:108"><span class="id" title="binder">new</span></a> := <a class="idref" href="EraVM.CallStack.html#pc_map"><span class="id" title="definition">pc_map</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="EraVM.CallStack.html#new:108"><span class="id" title="variable">new</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="pc_map_cfc_spec" class="idref" href="#pc_map_cfc_spec"><span class="id" title="inductive">pc_map_cfc_spec</span></a> <a id="f:109" class="idref" href="#f:109"><span class="id" title="binder">f</span></a> : <a class="idref" href="EraVM.CallStack.html#callstack_common"><span class="id" title="record">callstack_common</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.CallStack.html#callstack_common"><span class="id" title="record">callstack_common</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="upc_map" class="idref" href="#upc_map"><span class="id" title="constructor">upc_map</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="ehl:112" class="idref" href="#ehl:112"><span class="id" title="binder">ehl</span></a> <a id="sp:113" class="idref" href="#sp:113"><span class="id" title="binder">sp</span></a> <a id="ergs:114" class="idref" href="#ergs:114"><span class="id" title="binder">ergs</span></a> <a id="pc:115" class="idref" href="#pc:115"><span class="id" title="binder">pc</span></a> <a id="pc':116" class="idref" href="#pc':116"><span class="id" title="binder">pc'</span></a> <a id="ss:117" class="idref" href="#ss:117"><span class="id" title="binder">ss</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#f:109"><span class="id" title="variable">f</span></a> <a class="idref" href="EraVM.CallStack.html#pc:115"><span class="id" title="variable">pc</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.CallStack.html#pc':116"><span class="id" title="variable">pc'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#pc_map_cfc_spec:110"><span class="id" title="inductive">pc_map_cfc_spec</span></a> <a class="idref" href="EraVM.CallStack.html#f:109"><span class="id" title="variable">f</span></a> (<a class="idref" href="EraVM.CallStack.html#mk_cf"><span class="id" title="constructor">mk_cf</span></a> <a class="idref" href="EraVM.CallStack.html#ehl:112"><span class="id" title="variable">ehl</span></a> <a class="idref" href="EraVM.CallStack.html#sp:113"><span class="id" title="variable">sp</span></a> <a class="idref" href="EraVM.CallStack.html#pc:115"><span class="id" title="variable">pc</span></a> <a class="idref" href="EraVM.CallStack.html#ergs:114"><span class="id" title="variable">ergs</span></a> <a class="idref" href="EraVM.CallStack.html#ss:117"><span class="id" title="variable">ss</span></a>) (<a class="idref" href="EraVM.CallStack.html#mk_cf"><span class="id" title="constructor">mk_cf</span></a> <a class="idref" href="EraVM.CallStack.html#ehl:112"><span class="id" title="variable">ehl</span></a> <a class="idref" href="EraVM.CallStack.html#sp:113"><span class="id" title="variable">sp</span></a> <a class="idref" href="EraVM.CallStack.html#pc':116"><span class="id" title="variable">pc'</span></a> <a class="idref" href="EraVM.CallStack.html#ergs:114"><span class="id" title="variable">ergs</span></a> <a class="idref" href="EraVM.CallStack.html#ss:117"><span class="id" title="variable">ss</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="pc_map_extcall_spec" class="idref" href="#pc_map_extcall_spec"><span class="id" title="inductive">pc_map_extcall_spec</span></a> <a id="f:118" class="idref" href="#f:118"><span class="id" title="binder">f</span></a>: <a class="idref" href="EraVM.CallStack.html#callstack_external"><span class="id" title="record">callstack_external</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.CallStack.html#callstack_external"><span class="id" title="record">callstack_external</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="upe_update" class="idref" href="#upe_update"><span class="id" title="constructor">upe_update</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cf:121" class="idref" href="#cf:121"><span class="id" title="binder">cf</span></a> <a id="cf':122" class="idref" href="#cf':122"><span class="id" title="binder">cf'</span></a> <a id="ac:123" class="idref" href="#ac:123"><span class="id" title="binder">ac</span></a> <a id="memory:124" class="idref" href="#memory:124"><span class="id" title="binder">memory</span></a> <a id="is_static:125" class="idref" href="#is_static:125"><span class="id" title="binder">is_static</span></a> <a id="context_u128_value:126" class="idref" href="#context_u128_value:126"><span class="id" title="binder">context_u128_value</span></a> <a id="cc:127" class="idref" href="#cc:127"><span class="id" title="binder">cc</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#pc_map_cfc_spec"><span class="id" title="inductive">pc_map_cfc_spec</span></a> <a class="idref" href="EraVM.CallStack.html#f:118"><span class="id" title="variable">f</span></a> <a class="idref" href="EraVM.CallStack.html#cf:121"><span class="id" title="variable">cf</span></a> <a class="idref" href="EraVM.CallStack.html#cf':122"><span class="id" title="variable">cf'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#pc_map_extcall_spec:119"><span class="id" title="inductive">pc_map_extcall_spec</span></a> <a class="idref" href="EraVM.CallStack.html#f:118"><span class="id" title="variable">f</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="EraVM.CallStack.html#mk_extcf"><span class="id" title="constructor">mk_extcf</span></a> <a class="idref" href="EraVM.CallStack.html#ac:123"><span class="id" title="variable">ac</span></a> <a class="idref" href="EraVM.CallStack.html#memory:124"><span class="id" title="variable">memory</span></a> <a class="idref" href="EraVM.CallStack.html#is_static:125"><span class="id" title="variable">is_static</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#context_u128_value:126"><span class="id" title="variable">context_u128_value</span></a> <a class="idref" href="EraVM.CallStack.html#cc:127"><span class="id" title="variable">cc</span></a> <a class="idref" href="EraVM.CallStack.html#cf:121"><span class="id" title="variable">cf</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="EraVM.CallStack.html#mk_extcf"><span class="id" title="constructor">mk_extcf</span></a> <a class="idref" href="EraVM.CallStack.html#ac:123"><span class="id" title="variable">ac</span></a> <a class="idref" href="EraVM.CallStack.html#memory:124"><span class="id" title="variable">memory</span></a> <a class="idref" href="EraVM.CallStack.html#is_static:125"><span class="id" title="variable">is_static</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#context_u128_value:126"><span class="id" title="variable">context_u128_value</span></a> <a class="idref" href="EraVM.CallStack.html#cc:127"><span class="id" title="variable">cc</span></a> <a class="idref" href="EraVM.CallStack.html#cf':122"><span class="id" title="variable">cf'</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="pc_map_spec" class="idref" href="#pc_map_spec"><span class="id" title="inductive">pc_map_spec</span></a> <a id="f:128" class="idref" href="#f:128"><span class="id" title="binder">f</span></a> : <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="upc_ext" class="idref" href="#upc_ext"><span class="id" title="constructor">upc_ext</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="ecf:131" class="idref" href="#ecf:131"><span class="id" title="binder">ecf</span></a> <a id="ecf':132" class="idref" href="#ecf':132"><span class="id" title="binder">ecf'</span></a> <a id="tail:133" class="idref" href="#tail:133"><span class="id" title="binder">tail</span></a> ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#pc_map_extcall_spec"><span class="id" title="inductive">pc_map_extcall_spec</span></a> <a class="idref" href="EraVM.CallStack.html#f:128"><span class="id" title="variable">f</span></a> <a class="idref" href="EraVM.CallStack.html#ecf:131"><span class="id" title="variable">ecf</span></a> <a class="idref" href="EraVM.CallStack.html#ecf':132"><span class="id" title="variable">ecf'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#pc_map_spec:129"><span class="id" title="inductive">pc_map_spec</span></a> <a class="idref" href="EraVM.CallStack.html#f:128"><span class="id" title="variable">f</span></a> (<a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="EraVM.CallStack.html#ecf:131"><span class="id" title="variable">ecf</span></a> <a class="idref" href="EraVM.CallStack.html#tail:133"><span class="id" title="variable">tail</span></a>) (<a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="EraVM.CallStack.html#ecf':132"><span class="id" title="variable">ecf'</span></a> <a class="idref" href="EraVM.CallStack.html#tail:133"><span class="id" title="variable">tail</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="upc_int" class="idref" href="#upc_int"><span class="id" title="constructor">upc_int</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cf:134" class="idref" href="#cf:134"><span class="id" title="binder">cf</span></a> <a id="cf':135" class="idref" href="#cf':135"><span class="id" title="binder">cf'</span></a> <a id="tail:136" class="idref" href="#tail:136"><span class="id" title="binder">tail</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#pc_map_cfc_spec"><span class="id" title="inductive">pc_map_cfc_spec</span></a> <a class="idref" href="EraVM.CallStack.html#f:128"><span class="id" title="variable">f</span></a> <a class="idref" href="EraVM.CallStack.html#cf:134"><span class="id" title="variable">cf</span></a> <a class="idref" href="EraVM.CallStack.html#cf':135"><span class="id" title="variable">cf'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#pc_map_spec:129"><span class="id" title="inductive">pc_map_spec</span></a> <a class="idref" href="EraVM.CallStack.html#f:128"><span class="id" title="variable">f</span></a> (<a class="idref" href="EraVM.CallStack.html#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="EraVM.CallStack.html#cf:134"><span class="id" title="variable">cf</span></a> <a class="idref" href="EraVM.CallStack.html#tail:136"><span class="id" title="variable">tail</span></a>) (<a class="idref" href="EraVM.CallStack.html#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="EraVM.CallStack.html#cf':135"><span class="id" title="variable">cf'</span></a> <a class="idref" href="EraVM.CallStack.html#tail:136"><span class="id" title="variable">tail</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="pc_map_correct" class="idref" href="#pc_map_correct"><span class="id" title="lemma">pc_map_correct</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="ef:137" class="idref" href="#ef:137"><span class="id" title="binder">ef</span></a> <a id="f:138" class="idref" href="#f:138"><span class="id" title="binder">f</span></a>, <a class="idref" href="EraVM.CallStack.html#pc_map_spec"><span class="id" title="inductive">pc_map_spec</span></a> <a class="idref" href="EraVM.CallStack.html#f:138"><span class="id" title="variable">f</span></a> <a class="idref" href="EraVM.CallStack.html#ef:137"><span class="id" title="variable">ef</span></a> (<a class="idref" href="EraVM.CallStack.html#pc_map"><span class="id" title="definition">pc_map</span></a> <a class="idref" href="EraVM.CallStack.html#f:138"><span class="id" title="variable">f</span></a> <a class="idref" href="EraVM.CallStack.html#ef:137"><span class="id" title="variable">ef</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="EraVM.CallStack.html#Callstack.PC"><span class="id" title="section">PC</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Callstack.TopmostExternalFrame" class="idref" href="#Callstack.TopmostExternalFrame"><span class="id" title="section">TopmostExternalFrame</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <a id="active_extframe" class="idref" href="#active_extframe"><span class="id" title="definition">active_extframe</span></a> (<a id="ef:139" class="idref" href="#ef:139"><span class="id" title="binder">ef</span></a> : <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="EraVM.CallStack.html#callstack_external"><span class="id" title="record">callstack_external</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="EraVM.CallStack.html#ef:139"><span class="id" title="variable">ef</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.CallStack.html#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Lists.List.html#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <a class="idref" href="EraVM.CallStack.html#active_extframe:140"><span class="id" title="definition">active_extframe</span></a> <span class="id" title="var">tail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Lists.List.html#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="active_extframe_spec" class="idref" href="#active_extframe_spec"><span class="id" title="inductive">active_extframe_spec</span></a> : <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.CallStack.html#callstack_external"><span class="id" title="record">callstack_external</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="te_Top" class="idref" href="#te_Top"><span class="id" title="constructor">te_Top</span></a>: <span class="id" title="keyword">∀</span> <a id="x:144" class="idref" href="#x:144"><span class="id" title="binder">x</span></a> <a id="t:145" class="idref" href="#t:145"><span class="id" title="binder">t</span></a>, <a class="idref" href="EraVM.CallStack.html#active_extframe_spec:142"><span class="id" title="inductive">active_extframe_spec</span></a> (<a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="EraVM.CallStack.html#x:144"><span class="id" title="variable">x</span></a> <a class="idref" href="EraVM.CallStack.html#t:145"><span class="id" title="variable">t</span></a>) <a class="idref" href="EraVM.CallStack.html#x:144"><span class="id" title="variable">x</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="te_Deeper" class="idref" href="#te_Deeper"><span class="id" title="constructor">te_Deeper</span></a>: <span class="id" title="keyword">∀</span> <a id="c:146" class="idref" href="#c:146"><span class="id" title="binder">c</span></a> <a id="t:147" class="idref" href="#t:147"><span class="id" title="binder">t</span></a> <a id="f:148" class="idref" href="#f:148"><span class="id" title="binder">f</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#active_extframe_spec:142"><span class="id" title="inductive">active_extframe_spec</span></a> <a class="idref" href="EraVM.CallStack.html#t:147"><span class="id" title="variable">t</span></a> <a class="idref" href="EraVM.CallStack.html#f:148"><span class="id" title="variable">f</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.CallStack.html#active_extframe_spec:142"><span class="id" title="inductive">active_extframe_spec</span></a> (<a class="idref" href="EraVM.CallStack.html#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="EraVM.CallStack.html#c:146"><span class="id" title="variable">c</span></a> <a class="idref" href="EraVM.CallStack.html#t:147"><span class="id" title="variable">t</span></a>) <a class="idref" href="EraVM.CallStack.html#f:148"><span class="id" title="variable">f</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="active_extframe_correct" class="idref" href="#active_extframe_correct"><span class="id" title="lemma">active_extframe_correct</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="ef:149" class="idref" href="#ef:149"><span class="id" title="binder">ef</span></a>, <a class="idref" href="EraVM.CallStack.html#active_extframe_spec"><span class="id" title="inductive">active_extframe_spec</span></a> <a class="idref" href="EraVM.CallStack.html#ef:149"><span class="id" title="variable">ef</span></a> (<a class="idref" href="EraVM.CallStack.html#active_extframe"><span class="id" title="definition">active_extframe</span></a> <a class="idref" href="EraVM.CallStack.html#ef:149"><span class="id" title="variable">ef</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <a id="change_active_extframe" class="idref" href="#change_active_extframe"><span class="id" title="definition">change_active_extframe</span></a> <a id="f:150" class="idref" href="#f:150"><span class="id" title="binder">f</span></a> (<a id="ef:151" class="idref" href="#ef:151"><span class="id" title="binder">ef</span></a>:<a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="EraVM.CallStack.html#ef:151"><span class="id" title="variable">ef</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.CallStack.html#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Lists.List.html#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <a class="idref" href="EraVM.CallStack.html#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <span class="id" title="var">x</span> (<a class="idref" href="EraVM.CallStack.html#change_active_extframe:152"><span class="id" title="definition">change_active_extframe</span></a> <a class="idref" href="EraVM.CallStack.html#f:150"><span class="id" title="variable">f</span></a> <span class="id" title="var">tail</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Lists.List.html#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> (<a class="idref" href="EraVM.CallStack.html#f:150"><span class="id" title="variable">f</span></a> <span class="id" title="var">x</span>) <span class="id" title="var">tail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="change_active_extframe_spec" class="idref" href="#change_active_extframe_spec"><span class="id" title="inductive">change_active_extframe_spec</span></a> <a id="f:154" class="idref" href="#f:154"><span class="id" title="binder">f</span></a> : <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="ct_base" class="idref" href="#ct_base"><span class="id" title="constructor">ct_base</span></a>: <span class="id" title="keyword">∀</span> <a id="cf:157" class="idref" href="#cf:157"><span class="id" title="binder">cf</span></a> <a id="t:158" class="idref" href="#t:158"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#change_active_extframe_spec:155"><span class="id" title="inductive">change_active_extframe_spec</span></a> <a class="idref" href="EraVM.CallStack.html#f:154"><span class="id" title="variable">f</span></a> (<a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="EraVM.CallStack.html#cf:157"><span class="id" title="variable">cf</span></a> <a class="idref" href="EraVM.CallStack.html#t:158"><span class="id" title="variable">t</span></a>) (<a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> (<a class="idref" href="EraVM.CallStack.html#f:154"><span class="id" title="variable">f</span></a> <a class="idref" href="EraVM.CallStack.html#cf:157"><span class="id" title="variable">cf</span></a>) <a class="idref" href="EraVM.CallStack.html#t:158"><span class="id" title="variable">t</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="ct_ind" class="idref" href="#ct_ind"><span class="id" title="constructor">ct_ind</span></a>: <span class="id" title="keyword">∀</span> <a id="cf:159" class="idref" href="#cf:159"><span class="id" title="binder">cf</span></a> <a id="t:160" class="idref" href="#t:160"><span class="id" title="binder">t</span></a> <a id="t':161" class="idref" href="#t':161"><span class="id" title="binder">t'</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#change_active_extframe_spec:155"><span class="id" title="inductive">change_active_extframe_spec</span></a> <a class="idref" href="EraVM.CallStack.html#f:154"><span class="id" title="variable">f</span></a> <a class="idref" href="EraVM.CallStack.html#t:160"><span class="id" title="variable">t</span></a> <a class="idref" href="EraVM.CallStack.html#t':161"><span class="id" title="variable">t'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#change_active_extframe_spec:155"><span class="id" title="inductive">change_active_extframe_spec</span></a> <a class="idref" href="EraVM.CallStack.html#f:154"><span class="id" title="variable">f</span></a> (<a class="idref" href="EraVM.CallStack.html#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="EraVM.CallStack.html#cf:159"><span class="id" title="variable">cf</span></a> <a class="idref" href="EraVM.CallStack.html#t:160"><span class="id" title="variable">t</span></a>) (<a class="idref" href="EraVM.CallStack.html#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="EraVM.CallStack.html#cf:159"><span class="id" title="variable">cf</span></a> <a class="idref" href="EraVM.CallStack.html#t':161"><span class="id" title="variable">t'</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="change_active_extframe_correct" class="idref" href="#change_active_extframe_correct"><span class="id" title="lemma">change_active_extframe_correct</span></a> : <span class="id" title="keyword">∀</span> <a id="f:162" class="idref" href="#f:162"><span class="id" title="binder">f</span></a> <a id="ef:163" class="idref" href="#ef:163"><span class="id" title="binder">ef</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#change_active_extframe_spec"><span class="id" title="inductive">change_active_extframe_spec</span></a> <a class="idref" href="EraVM.CallStack.html#f:162"><span class="id" title="variable">f</span></a> <a class="idref" href="EraVM.CallStack.html#ef:163"><span class="id" title="variable">ef</span></a> (<a class="idref" href="EraVM.CallStack.html#change_active_extframe"><span class="id" title="definition">change_active_extframe</span></a> <a class="idref" href="EraVM.CallStack.html#f:162"><span class="id" title="variable">f</span></a> <a class="idref" href="EraVM.CallStack.html#ef:163"><span class="id" title="variable">ef</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="update_memory_context" class="idref" href="#update_memory_context"><span class="id" title="definition">update_memory_context</span></a> (<a id="ctx:164" class="idref" href="#ctx:164"><span class="id" title="binder">ctx</span></a>:<a class="idref" href="EraVM.MemoryContext.html#mem_ctx"><span class="id" title="record">mem_ctx</span></a>): <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#change_active_extframe"><span class="id" title="definition">change_active_extframe</span></a> (<span class="id" title="keyword">fun</span> <a id="ef:165" class="idref" href="#ef:165"><span class="id" title="binder">ef</span></a> ⇒ <a class="idref" href="EraVM.CallStack.html#ef:165"><span class="id" title="variable">ef</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="EraVM.CallStack.html#ecf_mem_ctx"><span class="id" title="projection">ecf_mem_ctx</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="EraVM.CallStack.html#ctx:164"><span class="id" title="variable">ctx</span></a> <span class="id" title="notation">|></span> ).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="revert_state" class="idref" href="#revert_state"><span class="id" title="definition">revert_state</span></a> (<a id="cs:166" class="idref" href="#cs:166"><span class="id" title="binder">cs</span></a>:<a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="EraVM.CallStack.html#Callstack.state_checkpoint"><span class="id" title="variable">state_checkpoint</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="EraVM.CallStack.html#cs:166"><span class="id" title="variable">cs</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.CallStack.html#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Lists.List.html#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <span class="id" title="var">x</span>.(<a class="idref" href="EraVM.CallStack.html#cf_saved_checkpoint"><span class="id" title="projection">cf_saved_checkpoint</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Lists.List.html#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <span class="id" title="var">x</span>.(<a class="idref" href="EraVM.CallStack.html#ecf_common"><span class="id" title="projection">ecf_common</span></a>).(<a class="idref" href="EraVM.CallStack.html#cf_saved_checkpoint"><span class="id" title="projection">cf_saved_checkpoint</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> .<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="current_shard" class="idref" href="#current_shard"><span class="id" title="definition">current_shard</span></a> <a id="xstack:168" class="idref" href="#xstack:168"><span class="id" title="binder">xstack</span></a> : <a class="idref" href="EraVM.memory.Depot.html#shard_id"><span class="id" title="definition">shard_id</span></a> := (<a class="idref" href="EraVM.CallStack.html#active_extframe"><span class="id" title="definition">active_extframe</span></a> <a class="idref" href="EraVM.CallStack.html#xstack:168"><span class="id" title="variable">xstack</span></a>).(<a class="idref" href="EraVM.CallStack.html#ecf_shards"><span class="id" title="projection">ecf_shards</span></a>).(<a class="idref" href="EraVM.CallStack.html#shard_this"><span class="id" title="projection">shard_this</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="current_contract" class="idref" href="#current_contract"><span class="id" title="definition">current_contract</span></a> <a id="xstack:169" class="idref" href="#xstack:169"><span class="id" title="binder">xstack</span></a> : <a class="idref" href="EraVM.memory.Depot.html#contract_address"><span class="id" title="definition">contract_address</span></a> := <a class="idref" href="EraVM.CallStack.html#ecf_this_address"><span class="id" title="projection">ecf_this_address</span></a> (<a class="idref" href="EraVM.CallStack.html#active_extframe"><span class="id" title="definition">active_extframe</span></a> <a class="idref" href="EraVM.CallStack.html#xstack:169"><span class="id" title="variable">xstack</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="EraVM.CallStack.html#Callstack.TopmostExternalFrame"><span class="id" title="section">TopmostExternalFrame</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Callstack.ActiveMemory" class="idref" href="#Callstack.ActiveMemory"><span class="id" title="section">ActiveMemory</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Callstack.ActiveMemory.ActivePageId" class="idref" href="#Callstack.ActiveMemory.ActivePageId"><span class="id" title="section">ActivePageId</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="ef:170" class="idref" href="#ef:170"><span class="id" title="binder">ef</span></a>:<a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a>) (<a id="active_extframe:171" class="idref" href="#active_extframe:171"><span class="id" title="binder">active_extframe</span></a> := <a class="idref" href="EraVM.CallStack.html#active_extframe"><span class="id" title="definition">active_extframe</span></a> <a class="idref" href="EraVM.CallStack.html#ef:170"><span class="id" title="variable">ef</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="get_mem_ctx" class="idref" href="#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a>: <a class="idref" href="EraVM.MemoryContext.html#mem_ctx"><span class="id" title="record">mem_ctx</span></a> := <a class="idref" href="EraVM.CallStack.html#Callstack.ActiveMemory.ActivePageId.active_extframe"><span class="id" title="variable">active_extframe</span></a>.(<a class="idref" href="EraVM.CallStack.html#ecf_mem_ctx"><span class="id" title="projection">ecf_mem_ctx</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="active_code_id" class="idref" href="#active_code_id"><span class="id" title="definition">active_code_id</span></a>: <a class="idref" href="EraVM.memory.Pages.html#page_id"><span class="id" title="definition">page_id</span></a> := <a class="idref" href="EraVM.CallStack.html#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a>.(<a class="idref" href="EraVM.MemoryContext.html#ctx_code_page_id"><span class="id" title="projection">ctx_code_page_id</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="active_stack_id" class="idref" href="#active_stack_id"><span class="id" title="definition">active_stack_id</span></a>: <a class="idref" href="EraVM.memory.Pages.html#page_id"><span class="id" title="definition">page_id</span></a> := <a class="idref" href="EraVM.CallStack.html#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a>.(<a class="idref" href="EraVM.MemoryContext.html#ctx_stack_page_id"><span class="id" title="projection">ctx_stack_page_id</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="active_const_id" class="idref" href="#active_const_id"><span class="id" title="definition">active_const_id</span></a>: <a class="idref" href="EraVM.memory.Pages.html#page_id"><span class="id" title="definition">page_id</span></a> := <a class="idref" href="EraVM.CallStack.html#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a>.(<a class="idref" href="EraVM.MemoryContext.html#ctx_const_page_id"><span class="id" title="projection">ctx_const_page_id</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="active_heap_id" class="idref" href="#active_heap_id"><span class="id" title="definition">active_heap_id</span></a> : <a class="idref" href="EraVM.memory.Pages.html#page_id"><span class="id" title="definition">page_id</span></a> := <a class="idref" href="EraVM.CallStack.html#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a>.(<a class="idref" href="EraVM.MemoryContext.html#ctx_heap_page_id"><span class="id" title="projection">ctx_heap_page_id</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="active_auxheap_id" class="idref" href="#active_auxheap_id"><span class="id" title="definition">active_auxheap_id</span></a> : <a class="idref" href="EraVM.memory.Pages.html#page_id"><span class="id" title="definition">page_id</span></a> := <a class="idref" href="EraVM.CallStack.html#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a>.(<a class="idref" href="EraVM.MemoryContext.html#ctx_auxheap_page_id"><span class="id" title="projection">ctx_auxheap_page_id</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="heap_bound" class="idref" href="#heap_bound"><span class="id" title="definition">heap_bound</span></a> := <a class="idref" href="EraVM.CallStack.html#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a>.(<a class="idref" href="EraVM.MemoryContext.html#ctx_heap_bound"><span class="id" title="projection">ctx_heap_bound</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="auxheap_bound" class="idref" href="#auxheap_bound"><span class="id" title="definition">auxheap_bound</span></a> := <a class="idref" href="EraVM.CallStack.html#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a>.(<a class="idref" href="EraVM.MemoryContext.html#ctx_auxheap_bound"><span class="id" title="projection">ctx_auxheap_bound</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="heap_variant_bound" class="idref" href="#heap_variant_bound"><span class="id" title="definition">heap_variant_bound</span></a> (<a id="page_type:172" class="idref" href="#page_type:172"><span class="id" title="binder">page_type</span></a>:<a class="idref" href="EraVM.memory.PageTypes.html#data_page_type"><span class="id" title="inductive">data_page_type</span></a>):  <a class="idref" href="EraVM.memory.PageTypes.html#mem_address"><span class="id" title="definition">mem_address</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="EraVM.CallStack.html#page_type:172"><span class="id" title="variable">page_type</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.memory.PageTypes.html#Heap"><span class="id" title="constructor">Heap</span></a> ⇒ <a class="idref" href="EraVM.CallStack.html#heap_bound"><span class="id" title="definition">heap_bound</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.memory.PageTypes.html#AuxHeap"><span class="id" title="constructor">AuxHeap</span></a> ⇒ <a class="idref" href="EraVM.CallStack.html#auxheap_bound"><span class="id" title="definition">auxheap_bound</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="heap_variant_page_id" class="idref" href="#heap_variant_page_id"><span class="id" title="definition">heap_variant_page_id</span></a> (<a id="page_type:174" class="idref" href="#page_type:174"><span class="id" title="binder">page_type</span></a>: <a class="idref" href="EraVM.memory.PageTypes.html#data_page_type"><span class="id" title="inductive">data_page_type</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="EraVM.memory.Pages.html#page_id"><span class="id" title="definition">page_id</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="EraVM.CallStack.html#page_type:174"><span class="id" title="variable">page_type</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.memory.PageTypes.html#Heap"><span class="id" title="constructor">Heap</span></a> ⇒ <a class="idref" href="EraVM.CallStack.html#active_heap_id"><span class="id" title="definition">active_heap_id</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="EraVM.memory.PageTypes.html#AuxHeap"><span class="id" title="constructor">AuxHeap</span></a> ⇒ <a class="idref" href="EraVM.CallStack.html#active_auxheap_id"><span class="id" title="definition">active_auxheap_id</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="EraVM.CallStack.html#Callstack.ActiveMemory.ActivePageId"><span class="id" title="section">ActivePageId</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Callstack.ActiveMemory.ActivePages" class="idref" href="#Callstack.ActiveMemory.ActivePages"><span class="id" title="section">ActivePages</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="code_page:176" class="idref" href="#code_page:176"><span class="id" title="binder">code_page</span></a> <a id="const_page:177" class="idref" href="#const_page:177"><span class="id" title="binder">const_page</span></a> <a id="data_page:178" class="idref" href="#data_page:178"><span class="id" title="binder">data_page</span></a> <a id="stack_page:179" class="idref" href="#stack_page:179"><span class="id" title="binder">stack_page</span></a>} (<a id="page_has_id:180" class="idref" href="#page_has_id:180"><span class="id" title="binder">page_has_id</span></a>: <a class="idref" href="EraVM.memory.Pages.html#page_id"><span class="id" title="definition">page_id</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> @<a class="idref" href="EraVM.memory.Pages.html#page"><span class="id" title="record">page</span></a> <a class="idref" href="EraVM.CallStack.html#code_page:176"><span class="id" title="variable">code_page</span></a> <a class="idref" href="EraVM.CallStack.html#const_page:177"><span class="id" title="variable">const_page</span></a> <a class="idref" href="EraVM.CallStack.html#data_page:178"><span class="id" title="variable">data_page</span></a> <a class="idref" href="EraVM.CallStack.html#stack_page:179"><span class="id" title="variable">stack_page</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="active_exception_handler" class="idref" href="#active_exception_handler"><span class="id" title="definition">active_exception_handler</span></a> (<a id="ef:181" class="idref" href="#ef:181"><span class="id" title="binder">ef</span></a>: <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="EraVM.CallStack.html#exception_handler"><span class="id" title="definition">exception_handler</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="EraVM.CallStack.html#cfc"><span class="id" title="definition">cfc</span></a> <a class="idref" href="EraVM.CallStack.html#ef:181"><span class="id" title="variable">ef</span></a>).(<a class="idref" href="EraVM.CallStack.html#cf_exception_handler_location"><span class="id" title="projection">cf_exception_handler_location</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="ef:182" class="idref" href="#ef:182"><span class="id" title="binder">ef</span></a>: <a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a>) (<a id="page_id:184" class="idref" href="#page_id:184"><span class="id" title="binder">page_id</span></a> := <span class="id" title="keyword">fun</span> <a id="i:183" class="idref" href="#i:183"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="EraVM.CallStack.html#Callstack.ActiveMemory.ActivePages.page_has_id"><span class="id" title="variable">page_has_id</span></a> (<a class="idref" href="EraVM.CallStack.html#i:183"><span class="id" title="variable">i</span></a> <a class="idref" href="EraVM.CallStack.html#ef:182"><span class="id" title="variable">ef</span></a>)).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="active_codepage" class="idref" href="#active_codepage"><span class="id" title="inductive">active_codepage</span></a> : <a class="idref" href="EraVM.CallStack.html#Callstack.ActiveMemory.ActivePages.code_page"><span class="id" title="variable">code_page</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a id="ap_active_code" class="idref" href="#ap_active_code"><span class="id" title="constructor">ap_active_code</span></a>: <span class="id" title="keyword">∀</span> <a id="codepage:187" class="idref" href="#codepage:187"><span class="id" title="binder">codepage</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#Callstack.ActiveMemory.ActivePages.page_id"><span class="id" title="variable">page_id</span></a> <a class="idref" href="EraVM.CallStack.html#active_code_id"><span class="id" title="definition">active_code_id</span></a> (<a class="idref" href="EraVM.memory.Pages.html#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="EraVM.memory.Pages.html#CodePage"><span class="id" title="constructor">CodePage</span></a> <a class="idref" href="EraVM.CallStack.html#codepage:187"><span class="id" title="variable">codepage</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#active_codepage:185"><span class="id" title="inductive">active_codepage</span></a> <a class="idref" href="EraVM.CallStack.html#codepage:187"><span class="id" title="variable">codepage</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="active_constpage" class="idref" href="#active_constpage"><span class="id" title="inductive">active_constpage</span></a> : <a class="idref" href="EraVM.CallStack.html#Callstack.ActiveMemory.ActivePages.const_page"><span class="id" title="variable">const_page</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a id="ap_active_const" class="idref" href="#ap_active_const"><span class="id" title="constructor">ap_active_const</span></a>: <span class="id" title="keyword">∀</span> <a id="constpage:190" class="idref" href="#constpage:190"><span class="id" title="binder">constpage</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#Callstack.ActiveMemory.ActivePages.page_id"><span class="id" title="variable">page_id</span></a>  <a class="idref" href="EraVM.CallStack.html#active_const_id"><span class="id" title="definition">active_const_id</span></a> (<a class="idref" href="EraVM.memory.Pages.html#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="EraVM.memory.Pages.html#ConstPage"><span class="id" title="constructor">ConstPage</span></a> <a class="idref" href="EraVM.CallStack.html#constpage:190"><span class="id" title="variable">constpage</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#active_constpage:188"><span class="id" title="inductive">active_constpage</span></a>  <a class="idref" href="EraVM.CallStack.html#constpage:190"><span class="id" title="variable">constpage</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="active_stackpage" class="idref" href="#active_stackpage"><span class="id" title="inductive">active_stackpage</span></a> : <a class="idref" href="EraVM.CallStack.html#Callstack.ActiveMemory.ActivePages.stack_page"><span class="id" title="variable">stack_page</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a id="ap_active_stack" class="idref" href="#ap_active_stack"><span class="id" title="constructor">ap_active_stack</span></a>: <span class="id" title="keyword">∀</span>  <a id="stackpage:193" class="idref" href="#stackpage:193"><span class="id" title="binder">stackpage</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#Callstack.ActiveMemory.ActivePages.page_id"><span class="id" title="variable">page_id</span></a> <a class="idref" href="EraVM.CallStack.html#active_stack_id"><span class="id" title="definition">active_stack_id</span></a> (<a class="idref" href="EraVM.memory.Pages.html#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="EraVM.memory.Pages.html#StackPage"><span class="id" title="constructor">StackPage</span></a> <a class="idref" href="EraVM.CallStack.html#stackpage:193"><span class="id" title="variable">stackpage</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#active_stackpage:191"><span class="id" title="inductive">active_stackpage</span></a> <a class="idref" href="EraVM.CallStack.html#stackpage:193"><span class="id" title="variable">stackpage</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="active_heappage" class="idref" href="#active_heappage"><span class="id" title="inductive">active_heappage</span></a> : <a class="idref" href="EraVM.CallStack.html#Callstack.ActiveMemory.ActivePages.data_page"><span class="id" title="variable">data_page</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a id="ap_active_heap" class="idref" href="#ap_active_heap"><span class="id" title="constructor">ap_active_heap</span></a>: <span class="id" title="keyword">∀</span> <a id="p:196" class="idref" href="#p:196"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#Callstack.ActiveMemory.ActivePages.page_id"><span class="id" title="variable">page_id</span></a> <a class="idref" href="EraVM.CallStack.html#active_heap_id"><span class="id" title="definition">active_heap_id</span></a> (<a class="idref" href="EraVM.memory.Pages.html#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="EraVM.memory.Pages.html#DataPage"><span class="id" title="constructor">DataPage</span></a> <a class="idref" href="EraVM.CallStack.html#p:196"><span class="id" title="variable">p</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#active_heappage:194"><span class="id" title="inductive">active_heappage</span></a> <a class="idref" href="EraVM.CallStack.html#p:196"><span class="id" title="variable">p</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="active_auxheappage" class="idref" href="#active_auxheappage"><span class="id" title="inductive">active_auxheappage</span></a> : <a class="idref" href="EraVM.CallStack.html#Callstack.ActiveMemory.ActivePages.data_page"><span class="id" title="variable">data_page</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a id="ap_active_auxheap" class="idref" href="#ap_active_auxheap"><span class="id" title="constructor">ap_active_auxheap</span></a>: <span class="id" title="keyword">∀</span> <a id="p:199" class="idref" href="#p:199"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#Callstack.ActiveMemory.ActivePages.page_id"><span class="id" title="variable">page_id</span></a> <a class="idref" href="EraVM.CallStack.html#active_auxheap_id"><span class="id" title="definition">active_auxheap_id</span></a> (<a class="idref" href="EraVM.memory.Pages.html#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="EraVM.memory.Pages.html#DataPage"><span class="id" title="constructor">DataPage</span></a> <a class="idref" href="EraVM.CallStack.html#p:199"><span class="id" title="variable">p</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#active_auxheappage:197"><span class="id" title="inductive">active_auxheappage</span></a> <a class="idref" href="EraVM.CallStack.html#p:199"><span class="id" title="variable">p</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="EraVM.CallStack.html#Callstack.ActiveMemory.ActivePages"><span class="id" title="section">ActivePages</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="EraVM.CallStack.html#Callstack.ActiveMemory"><span class="id" title="section">ActiveMemory</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="in_kernel_mode" class="idref" href="#in_kernel_mode"><span class="id" title="definition">in_kernel_mode</span></a> (<a id="ef:200" class="idref" href="#ef:200"><span class="id" title="binder">ef</span></a>:<a class="idref" href="EraVM.CallStack.html#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="ef:201" class="idref" href="#ef:201"><span class="id" title="binder">ef</span></a> := <a class="idref" href="EraVM.CallStack.html#active_extframe"><span class="id" title="definition">active_extframe</span></a> <a class="idref" href="EraVM.CallStack.html#ef:200"><span class="id" title="variable">ef</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.KernelMode.html#addr_is_kernel"><span class="id" title="definition">addr_is_kernel</span></a> <a class="idref" href="EraVM.CallStack.html#ef:201"><span class="id" title="variable">ef</span></a>.(<a class="idref" href="EraVM.CallStack.html#ecf_this_address"><span class="id" title="projection">ecf_this_address</span></a>).<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="EraVM.CallStack.html#Callstack"><span class="id" title="section">Callstack</span></a>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>