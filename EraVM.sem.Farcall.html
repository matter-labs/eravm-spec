<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>EraVM.sem.Farcall</title>

  <script defer=""
  src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <link rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css" />
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.Farcall</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span><br/>
<a class="idref" href="EraVM.ABI.html#"><span class="id" title="library">ABI</span></a><br/>
<a class="idref" href="EraVM.CallStack.html#"><span class="id" title="library">CallStack</span></a><br/>
<a class="idref" href="EraVM.Common.html#"><span class="id" title="library">Common</span></a><br/>
<a class="idref" href="EraVM.Decommitter.html#"><span class="id" title="library">Decommitter</span></a><br/>
<a class="idref" href="EraVM.Ergs.html#"><span class="id" title="library">Ergs</span></a><br/>
<a class="idref" href="EraVM.MemoryManagement.html#"><span class="id" title="library">MemoryManagement</span></a><br/>
<a class="idref" href="EraVM.MemoryOps.html#"><span class="id" title="library">MemoryOps</span></a><br/>
<a class="idref" href="EraVM.Pointer.html#"><span class="id" title="library">Pointer</span></a><br/>
<a class="idref" href="EraVM.sem.SemanticCommon.html#"><span class="id" title="library">SemanticCommon</span></a><br/>
<a class="idref" href="EraVM.State.html#"><span class="id" title="library">State</span></a><br/>
<a class="idref" href="EraVM.TransientMemory.html#"><span class="id" title="library">TransientMemory</span></a><br/>
<a class="idref" href="EraVM.isa.CoreSet.html#"><span class="id" title="library">isa.CoreSet</span></a><br/>
.<br/>

<br/>
<span class="id" title="keyword">Import</span><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ZArith.BinIntDef.html#Z"><span class="id" title="module">BinIntDef.Z</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Bool.Bool.html#"><span class="id" title="module">Bool</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Lists.List.html#"><span class="id" title="module">List</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Lists.List.html#ListNotations"><span class="id" title="module">ListNotations</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ZArith.ZArith.html#"><span class="id" title="module">ZArith</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.html#"><span class="id" title="module">ABI</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#"><span class="id" title="module">FarCallABI</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FatPointerABI.html#"><span class="id" title="module">FatPointerABI</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#"><span class="id" title="module">CallStack</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.Coder.html#"><span class="id" title="module">Coder</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.Common.html#"><span class="id" title="module">Common</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.Core.html#"><span class="id" title="module">Core</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.Decommitter.html#"><span class="id" title="module">Decommitter</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.Ergs.html#"><span class="id" title="module">Ergs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.Flags.html#"><span class="id" title="module">Flags</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.GPR.html#"><span class="id" title="module">GPR</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.KernelMode.html#"><span class="id" title="module">KernelMode</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.memory.Depot.html#"><span class="id" title="module">memory.Depot</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.MemoryBase.html#"><span class="id" title="module">MemoryBase</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.MemoryContext.html#"><span class="id" title="module">MemoryContext</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.MemoryManagement.html#"><span class="id" title="module">MemoryManagement</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.MemoryOps.html#"><span class="id" title="module">MemoryOps</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.PrimitiveValue.html#"><span class="id" title="module">PrimitiveValue</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="module">RecordSetNotations</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.SemanticCommon.html#"><span class="id" title="module">SemanticCommon</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.TransientMemory.html#"><span class="id" title="module">TransientMemory</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#"><span class="id" title="module">State</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.VersionedHash.html#"><span class="id" title="module">VersionedHash</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.isa.CoreSet.html#"><span class="id" title="module">isa.CoreSet</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="EraVM.Addressing.html#"><span class="id" title="module">Addressing</span></a><br/>
.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="EraVM.Addressing.html#Coercions"><span class="id" title="module">Addressing.Coercions</span></a>.<br/>

<br/>
<span class="id" title="keyword">Local Coercion</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ZArith.BinInt.html#Z.b2z"><span class="id" title="definition">Z.b2z</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ZArith.BinInt.html#Z.b2z"><span class="id" title="definition">:</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ZArith.BinInt.html#Z.b2z"><span class="id" title="definition">bool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ZArith.BinInt.html#Z.b2z"><span class="id" title="definition">>-></span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ZArith.BinInt.html#Z.b2z"><span class="id" title="definition">Z</span></a>.<br/>

<br/>
</div>

<div class="doc"><h1 id="far-calls">Far calls</h1>
<p>Far calls are calls to the code outside the current contract space.
This section describes three instructions to perform far calls:</p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpFarCall"><span
class="id" title="constructor">OpFarCall</span></a></span></li>
<li><span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span></li>
<li><span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpMimicCall"><span
class="id" title="constructor">OpMimicCall</span></a></span> (available
only in kernel mode)</li>
</ul>
<p>These instructions differ in the way they construct new frame.</p>
<p>The far call instructions have rich semantics; their full effect on
the VM state is described through the following main predicates:</p>
<ul>
<li><span class="inlinecode"><span class="id"
title="var">Semantics.step</span></span></li>
<li><span
class="inlinecode"><a class="idref" href="EraVM.Semantics.html#step"><span
class="id" title="inductive">step</span></a></span></li>
<li><span class="inlinecode"><span class="id"
title="var">fetch_operands</span></span></li>
<li><span
class="inlinecode"><a class="idref" href="EraVM.sem.Farcall.html#farcall"><span
class="id" title="inductive">farcall</span></a></span></li>
</ul>
<p>If you know about fetching operands for instructions and the
instruction fetching described in <span class="inlinecode"><span
class="id" title="var">Semantics.step</span></span>, start investigating
farcalls from the <span
class="inlinecode"><a class="idref" href="EraVM.sem.Farcall.html#farcall"><span
class="id" title="inductive">farcall</span></a></span> predicate.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Section</span> <a id="Parameters" class="idref" href="#Parameters"><span class="id" title="section">Parameters</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
</div>

<div class="doc"><h2 id="global-farcall-parameters">Global farcall parameters</h2>
<ol type="1">
<li><p>Initial preallocated stack space.</p>
<p>A far call creates a new context with a new stack page (and other
pages, see <span
class="inlinecode"><a class="idref" href="EraVM.memory.Pages.html#page_alloc"><span
class="id" title="definition">page_alloc</span></a></span>). The initial
SP value after a far call is set to <span
class="inlinecode"><a class="idref" href="EraVM.sem.Farcall.html#INITIAL_SP_ON_FAR_CALL"><span
class="id"
title="definition">INITIAL_SP_ON_FAR_CALL</span></a></span>.</p>
<p>Therefore, addresses in range from 0 inclusive to <span
class="inlinecode"><a class="idref" href="EraVM.sem.Farcall.html#INITIAL_SP_ON_FAR_CALL"><span
class="id" title="definition">INITIAL_SP_ON_FAR_CALL</span></a></span>
exclusive can be used as a scratch space.</p></li>
</ol>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="INITIAL_SP_ON_FAR_CALL" class="idref" href="#INITIAL_SP_ON_FAR_CALL"><span class="id" title="definition">INITIAL_SP_ON_FAR_CALL</span></a> : <a class="idref" href="EraVM.TransientMemory.html#stack_address"><span class="id" title="definition">stack_address</span></a> := <span class="id" title="definition">fromZ</span> 1024.<br/>

<br/>
</div>

<div class="doc"><ol start="2" type="1">
<li><p>Initial heap and auxheap pages bound.</p>
<p>The heap and auxheap pages start with <span
class="inlinecode"><a class="idref" href="EraVM.sem.Farcall.html#NEW_FRAME_MEMORY_STIPEND"><span
class="id" title="definition">NEW_FRAME_MEMORY_STIPEND</span></a></span>
bound. Growing them beyond this bound costs ergs.</p></li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="NEW_FRAME_MEMORY_STIPEND" class="idref" href="#NEW_FRAME_MEMORY_STIPEND"><span class="id" title="definition">NEW_FRAME_MEMORY_STIPEND</span></a> : <a class="idref" href="EraVM.memory.PageTypes.html#mem_address"><span class="id" title="definition">mem_address</span></a> := <span class="id" title="definition">fromZ</span> 1024.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="EraVM.sem.Farcall.html#Parameters"><span class="id" title="section">Parameters</span></a>.<br/>

<br/>
</div>

<div class="doc"><ol start="3" type="1">
<li><p>Maximal fraction of ergs allowed to pass.</p>
<p>It is not allowed to pass more than 63/64th of your remaining ergs to
a far call.</p></li>
</ol>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Definition</span> <a id="max_passable" class="idref" href="#max_passable"><span class="id" title="definition">max_passable</span></a> (<a id="remaining:1" class="idref" href="#remaining:1"><span class="id" title="binder">remaining</span></a>:<a class="idref" href="EraVM.Ergs.html#ergs"><span class="id" title="definition">ergs</span></a>) : <a class="idref" href="EraVM.Ergs.html#ergs"><span class="id" title="definition">ergs</span></a> := <span class="id" title="definition">fromZ</span> (<span class="id" title="definition">toZ</span> <a class="idref" href="EraVM.sem.Farcall.html#remaining:1"><span class="id" title="variable">remaining</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ZArith.BinInt.html#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> 63 <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ZArith.BinInt.html#d3c2652250c7a120d67ccc0e8f58ae75"><span class="id" title="notation">/</span></a> 64 ) %<span class="id" title="var">Z</span>.<br/>
<span class="id" title="keyword">Inductive</span> <a id="pass_allowed_ergs" class="idref" href="#pass_allowed_ergs"><span class="id" title="inductive">pass_allowed_ergs</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.Ergs.html#ergs"><span class="id" title="definition">ergs</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="EraVM.State.html#callstack"><span class="id" title="definition">callstack</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">)-></span></a> <a class="idref" href="EraVM.Ergs.html#ergs"><span class="id" title="definition">ergs</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="EraVM.State.html#callstack"><span class="id" title="definition">callstack</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
| <a id="pae_apply" class="idref" href="#pae_apply"><span class="id" title="constructor">pae_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="cs1:4" class="idref" href="#cs1:4"><span class="id" title="binder">cs1</span></a> <a id="cs2:5" class="idref" href="#cs2:5"><span class="id" title="binder">cs2</span></a> <a id="pass_ergs_query:6" class="idref" href="#pass_ergs_query:6"><span class="id" title="binder">pass_ergs_query</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="pass_ergs_actual:7" class="idref" href="#pass_ergs_actual:7"><span class="id" title="binder">pass_ergs_actual</span></a> := <a class="idref" href="EraVM.Arith.html#min"><span class="id" title="definition">min</span></a> (<a class="idref" href="EraVM.sem.Farcall.html#max_passable"><span class="id" title="definition">max_passable</span></a> (<a class="idref" href="EraVM.CallStack.html#ergs_remaining"><span class="id" title="definition">ergs_remaining</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs1:4"><span class="id" title="variable">cs1</span></a>)) <a class="idref" href="EraVM.sem.Farcall.html#pass_ergs_query:6"><span class="id" title="variable">pass_ergs_query</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#pay"><span class="id" title="inductive">pay</span></a> <a class="idref" href="EraVM.sem.Farcall.html#pass_ergs_actual:7"><span class="id" title="variable">pass_ergs_actual</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs1:4"><span class="id" title="variable">cs1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs2:5"><span class="id" title="variable">cs2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#pass_ergs_query:6"><span class="id" title="variable">pass_ergs_query</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'<>'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="EraVM.Types.html#zero32"><span class="id" title="definition">zero32</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#pass_allowed_ergs:2"><span class="id" title="inductive">pass_allowed_ergs</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#pass_ergs_query:6"><span class="id" title="variable">pass_ergs_query</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="EraVM.sem.Farcall.html#cs1:4"><span class="id" title="variable">cs1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#pass_ergs_actual:7"><span class="id" title="variable">pass_ergs_actual</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs2:5"><span class="id" title="variable">cs2</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
| <a id="pae_zero" class="idref" href="#pae_zero"><span class="id" title="constructor">pae_zero</span></a>: <span class="id" title="keyword">∀</span> <a id="cs1:8" class="idref" href="#cs1:8"><span class="id" title="binder">cs1</span></a> <a id="cs2:9" class="idref" href="#cs2:9"><span class="id" title="binder">cs2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="pass_ergs_actual:10" class="idref" href="#pass_ergs_actual:10"><span class="id" title="binder">pass_ergs_actual</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#max_passable"><span class="id" title="definition">max_passable</span></a> (<a class="idref" href="EraVM.CallStack.html#ergs_remaining"><span class="id" title="definition">ergs_remaining</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs1:8"><span class="id" title="variable">cs1</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#pay"><span class="id" title="inductive">pay</span></a> <a class="idref" href="EraVM.sem.Farcall.html#pass_ergs_actual:10"><span class="id" title="variable">pass_ergs_actual</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs1:8"><span class="id" title="variable">cs1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs2:9"><span class="id" title="variable">cs2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#pass_allowed_ergs:2"><span class="id" title="inductive">pass_allowed_ergs</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.Types.html#zero32"><span class="id" title="definition">zero32</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs1:8"><span class="id" title="variable">cs1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#pass_ergs_actual:10"><span class="id" title="variable">pass_ergs_actual</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs2:9"><span class="id" title="variable">cs2</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc"><h2 id="helpers">Helpers</h2>
<p>Far call creates a new execution context with new pages for:</p>
<ul>
<li>code</li>
<li>const (in the current implementation, const and code pages are the
same page).</li>
<li>stack</li>
<li>heap</li>
<li>auxheap</li>
</ul>
<p>The initial bounds for the new heap and auxheap pages are set to
<span
class="inlinecode"><a class="idref" href="EraVM.sem.Farcall.html#NEW_FRAME_MEMORY_STIPEND"><span
class="id"
title="definition">NEW_FRAME_MEMORY_STIPEND</span></a></span>.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Inductive</span> <a id="alloc_pages_extframe" class="idref" href="#alloc_pages_extframe"><span class="id" title="inductive">alloc_pages_extframe</span></a>:  <a class="idref" href="EraVM.memory.Pages.html#pages"><span class="id" title="definition">pages</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="EraVM.MemoryContext.html#mem_ctx"><span class="id" title="record">mem_ctx</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.State.html#code_page"><span class="id" title="definition">code_page</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.memory.PageTypes.html#const_page"><span class="id" title="definition">const_page</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.memory.Pages.html#pages"><span class="id" title="definition">pages</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="EraVM.MemoryContext.html#mem_ctx"><span class="id" title="record">mem_ctx</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
| <a id="ape_alloc" class="idref" href="#ape_alloc"><span class="id" title="constructor">ape_alloc</span></a>: <span class="id" title="keyword">∀</span> <a id="code:13" class="idref" href="#code:13"><span class="id" title="binder">code</span></a> <a id="const:14" class="idref" href="#const:14"><span class="id" title="binder">const</span></a> (<a id="mm:15" class="idref" href="#mm:15"><span class="id" title="binder">mm</span></a>:<a class="idref" href="EraVM.memory.Pages.html#pages"><span class="id" title="definition">pages</span></a>) <a id="ctx:16" class="idref" href="#ctx:16"><span class="id" title="binder">ctx</span></a> <a id="code_id:17" class="idref" href="#code_id:17"><span class="id" title="binder">code_id</span></a> <a id="const_id:18" class="idref" href="#const_id:18"><span class="id" title="binder">const_id</span></a> <a id="stack_id:19" class="idref" href="#stack_id:19"><span class="id" title="binder">stack_id</span></a> <a id="heap_id:20" class="idref" href="#heap_id:20"><span class="id" title="binder">heap_id</span></a> <a id="heap_aux_id:21" class="idref" href="#heap_aux_id:21"><span class="id" title="binder">heap_aux_id</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#code_id:17"><span class="id" title="variable">code_id</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Lists.List.html#length"><span class="id" title="abbreviation">List.length</span></a> <a class="idref" href="EraVM.sem.Farcall.html#mm:15"><span class="id" title="variable">mm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="EraVM.sem.Farcall.html#const_id:18"><span class="id" title="variable">const_id</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.sem.Farcall.html#code_id:17"><span class="id" title="variable">code_id</span></a> <span class="id" title="notation">+</span> 1)%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="EraVM.sem.Farcall.html#stack_id:19"><span class="id" title="variable">stack_id</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.sem.Farcall.html#code_id:17"><span class="id" title="variable">code_id</span></a> <span class="id" title="notation">+</span> 2)%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="EraVM.sem.Farcall.html#heap_id:20"><span class="id" title="variable">heap_id</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.sem.Farcall.html#code_id:17"><span class="id" title="variable">code_id</span></a> <span class="id" title="notation">+</span> 3)%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="EraVM.sem.Farcall.html#heap_aux_id:21"><span class="id" title="variable">heap_aux_id</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.sem.Farcall.html#code_id:17"><span class="id" title="variable">code_id</span></a> <span class="id" title="notation">+</span> 4)%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#alloc_pages_extframe:11"><span class="id" title="inductive">alloc_pages_extframe</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#mm:15"><span class="id" title="variable">mm</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="EraVM.sem.Farcall.html#ctx:16"><span class="id" title="variable">ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="EraVM.sem.Farcall.html#code:13"><span class="id" title="variable">code</span></a> <a class="idref" href="EraVM.sem.Farcall.html#const:14"><span class="id" title="variable">const</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#heap_aux_id:21"><span class="id" title="variable">heap_aux_id</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.memory.Pages.html#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="EraVM.memory.Pages.html#DataPage"><span class="id" title="constructor">DataPage</span></a> (<a class="idref" href="EraVM.MemoryBase.html#empty"><span class="id" title="definition">empty</span></a> <a class="idref" href="EraVM.memory.PageTypes.html#data_page_params"><span class="id" title="definition">data_page_params</span></a>))<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><span class="id" title="notation">::</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#heap_id:20"><span class="id" title="variable">heap_id</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.memory.Pages.html#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="EraVM.memory.Pages.html#DataPage"><span class="id" title="constructor">DataPage</span></a> (<a class="idref" href="EraVM.MemoryBase.html#empty"><span class="id" title="definition">empty</span></a> <span class="id" title="var">_</span>))<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><span class="id" title="notation">::</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#stack_id:19"><span class="id" title="variable">stack_id</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.memory.Pages.html#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="EraVM.memory.Pages.html#StackPage"><span class="id" title="constructor">StackPage</span></a> (<a class="idref" href="EraVM.MemoryBase.html#empty"><span class="id" title="definition">empty</span></a> <a class="idref" href="EraVM.TransientMemory.html#stack_page_params"><span class="id" title="definition">stack_page_params</span></a>))<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><span class="id" title="notation">::</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#const_id:18"><span class="id" title="variable">const_id</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,(</span></a><a class="idref" href="EraVM.memory.Pages.html#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="EraVM.memory.Pages.html#ConstPage"><span class="id" title="constructor">ConstPage</span></a> <a class="idref" href="EraVM.sem.Farcall.html#const:14"><span class="id" title="variable">const</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><span class="id" title="notation">::</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#code_id:17"><span class="id" title="variable">code_id</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.memory.Pages.html#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="EraVM.memory.Pages.html#CodePage"><span class="id" title="constructor">CodePage</span></a> <a class="idref" href="EraVM.sem.Farcall.html#code:13"><span class="id" title="variable">code</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><span class="id" title="notation">::</span><a class="idref" href="EraVM.sem.Farcall.html#mm:15"><span class="id" title="variable">mm</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">{|</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.MemoryContext.html#ctx_code_page_id"><span class="id" title="projection">ctx_code_page_id</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#code_id:17"><span class="id" title="variable">code_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.MemoryContext.html#ctx_const_page_id"><span class="id" title="projection">ctx_const_page_id</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#const_id:18"><span class="id" title="variable">const_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.MemoryContext.html#ctx_stack_page_id"><span class="id" title="projection">ctx_stack_page_id</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#stack_id:19"><span class="id" title="variable">stack_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.MemoryContext.html#ctx_heap_page_id"><span class="id" title="projection">ctx_heap_page_id</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#heap_id:20"><span class="id" title="variable">heap_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.MemoryContext.html#ctx_auxheap_page_id"><span class="id" title="projection">ctx_auxheap_page_id</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#heap_aux_id:21"><span class="id" title="variable">heap_aux_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.MemoryContext.html#ctx_heap_bound"><span class="id" title="projection">ctx_heap_bound</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#NEW_FRAME_MEMORY_STIPEND"><span class="id" title="definition">NEW_FRAME_MEMORY_STIPEND</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.MemoryContext.html#ctx_auxheap_bound"><span class="id" title="projection">ctx_auxheap_bound</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#NEW_FRAME_MEMORY_STIPEND"><span class="id" title="definition">NEW_FRAME_MEMORY_STIPEND</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">|}</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <a id="alloc_mem_extframe" class="idref" href="#alloc_mem_extframe"><span class="id" title="inductive">alloc_mem_extframe</span></a>: <a class="idref" href="EraVM.State.html#memory"><span class="id" title="definition">memory</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="EraVM.MemoryContext.html#mem_ctx"><span class="id" title="record">mem_ctx</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.State.html#code_page"><span class="id" title="definition">code_page</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.memory.PageTypes.html#const_page"><span class="id" title="definition">const_page</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.State.html#memory"><span class="id" title="definition">memory</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="EraVM.MemoryContext.html#mem_ctx"><span class="id" title="record">mem_ctx</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
| <a id="ame_apply" class="idref" href="#ame_apply"><span class="id" title="constructor">ame_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="p:24" class="idref" href="#p:24"><span class="id" title="binder">p</span></a> <a id="c:25" class="idref" href="#c:25"><span class="id" title="binder">c</span></a> <a id="p':26" class="idref" href="#p':26"><span class="id" title="binder">p'</span></a> <a id="c':27" class="idref" href="#c':27"><span class="id" title="binder">c'</span></a> <a id="code:28" class="idref" href="#code:28"><span class="id" title="binder">code</span></a> <a id="const:29" class="idref" href="#const:29"><span class="id" title="binder">const</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#alloc_pages_extframe"><span class="id" title="inductive">alloc_pages_extframe</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#p:24"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="EraVM.sem.Farcall.html#c:25"><span class="id" title="variable">c</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="EraVM.sem.Farcall.html#code:28"><span class="id" title="variable">code</span></a> <a class="idref" href="EraVM.sem.Farcall.html#const:29"><span class="id" title="variable">const</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#p':26"><span class="id" title="variable">p'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="EraVM.sem.Farcall.html#c':27"><span class="id" title="variable">c'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#alloc_mem_extframe:22"><span class="id" title="inductive">alloc_mem_extframe</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.memory.Pages.html#mk_pages"><span class="id" title="constructor">mk_pages</span></a> <a class="idref" href="EraVM.sem.Farcall.html#p:24"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="EraVM.sem.Farcall.html#c:25"><span class="id" title="variable">c</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="EraVM.sem.Farcall.html#code:28"><span class="id" title="variable">code</span></a> <a class="idref" href="EraVM.sem.Farcall.html#const:29"><span class="id" title="variable">const</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.memory.Pages.html#mk_pages"><span class="id" title="constructor">mk_pages</span></a> <a class="idref" href="EraVM.sem.Farcall.html#p':26"><span class="id" title="variable">p'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="EraVM.sem.Farcall.html#c':27"><span class="id" title="variable">c'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>Fetch code and pay the associated cost. If <span
class="inlinecode"><span class="id"
title="var">masking_allowed</span></span> is true and there is no code
associated with a given contract address, then the default AA code will
be fetched. See <span
class="inlinecode"><a class="idref" href="EraVM.Decommitter.html#code_fetch"><span
class="id" title="inductive">code_fetch</span></a></span>.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Inductive</span> <a id="paid_code_fetch_result" class="idref" href="#paid_code_fetch_result"><span class="id" title="inductive">paid_code_fetch_result</span></a> :=<br/>
| <a id="Fetched" class="idref" href="#Fetched"><span class="id" title="constructor">Fetched</span></a> : <a class="idref" href="EraVM.State.html#callstack"><span class="id" title="definition">callstack</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.State.html#code_page"><span class="id" title="definition">code_page</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.memory.PageTypes.html#const_page"><span class="id" title="definition">const_page</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.sem.Farcall.html#paid_code_fetch_result:30"><span class="id" title="inductive">paid_code_fetch_result</span></a><br/>
| <a id="CodeFetchInvalidVerisonedHashFormat" class="idref" href="#CodeFetchInvalidVerisonedHashFormat"><span class="id" title="constructor">CodeFetchInvalidVerisonedHashFormat</span></a> (<span class="id" title="var">_</span>:<a class="idref" href="EraVM.VersionedHash.html#versioned_hash"><span class="id" title="record">versioned_hash</span></a>)<br/>
| <a id="CodeFetchUnaffordable" class="idref" href="#CodeFetchUnaffordable"><span class="id" title="constructor">CodeFetchUnaffordable</span></a> (<a id="cost:32" class="idref" href="#cost:32"><span class="id" title="binder">cost</span></a>:<a class="idref" href="EraVM.Ergs.html#ergs"><span class="id" title="definition">ergs</span></a>)<br/>
.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <a id="paid_code_fetch" class="idref" href="#paid_code_fetch"><span class="id" title="inductive">paid_code_fetch</span></a> <a id="masking_allowed:33" class="idref" href="#masking_allowed:33"><span class="id" title="binder">masking_allowed</span></a> <a id="sid:34" class="idref" href="#sid:34"><span class="id" title="binder">sid</span></a>: <a class="idref" href="EraVM.memory.Depot.html#depot"><span class="id" title="definition">depot</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.State.html#decommitter"><span class="id" title="definition">decommitter</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.memory.Depot.html#contract_address"><span class="id" title="definition">contract_address</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.State.html#callstack"><span class="id" title="definition">callstack</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.sem.Farcall.html#paid_code_fetch_result"><span class="id" title="inductive">paid_code_fetch_result</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><span class="id" title="keyword">Prop</span> :=<br/>
| <a id="cfp_fetched" class="idref" href="#cfp_fetched"><span class="id" title="constructor">cfp_fetched</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="depot:37" class="idref" href="#depot:37"><span class="id" title="binder">depot</span></a> (<a id="codes:38" class="idref" href="#codes:38"><span class="id" title="binder">codes</span></a>:<a class="idref" href="EraVM.State.html#decommitter"><span class="id" title="definition">decommitter</span></a>) (<a id="dest_addr:39" class="idref" href="#dest_addr:39"><span class="id" title="binder">dest_addr</span></a>: <a class="idref" href="EraVM.memory.Depot.html#contract_address"><span class="id" title="definition">contract_address</span></a>) <a id="vhash:40" class="idref" href="#vhash:40"><span class="id" title="binder">vhash</span></a> <a id="dest_addr:41" class="idref" href="#dest_addr:41"><span class="id" title="binder">dest_addr</span></a> <a id="new_code_page:42" class="idref" href="#new_code_page:42"><span class="id" title="binder">new_code_page</span></a> <a id="new_const_page:43" class="idref" href="#new_const_page:43"><span class="id" title="binder">new_const_page</span></a> <a id="code_length:44" class="idref" href="#code_length:44"><span class="id" title="binder">code_length</span></a> <a id="cost__decomm:45" class="idref" href="#cost__decomm:45"><span class="id" title="binder">cost__decomm</span></a> <a id="cs0:46" class="idref" href="#cs0:46"><span class="id" title="binder">cs0</span></a> <a id="cs1:47" class="idref" href="#cs1:47"><span class="id" title="binder">cs1</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.Decommitter.html#code_fetch"><span class="id" title="inductive">code_fetch</span></a> <span class="id" title="var">_</span> <a class="idref" href="EraVM.sem.Farcall.html#depot:37"><span class="id" title="variable">depot</span></a> <a class="idref" href="EraVM.sem.Farcall.html#codes:38"><span class="id" title="variable">codes</span></a>.(<a class="idref" href="EraVM.Decommitter.html#cm_storage"><span class="id" title="projection">cm_storage</span></a> <span class="id" title="var">_</span>) <a class="idref" href="EraVM.sem.Farcall.html#sid:34"><span class="id" title="variable">sid</span></a> <a class="idref" href="EraVM.sem.Farcall.html#dest_addr:41"><span class="id" title="variable">dest_addr</span></a> <a class="idref" href="EraVM.sem.Farcall.html#masking_allowed:33"><span class="id" title="variable">masking_allowed</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#vhash:40"><span class="id" title="variable">vhash</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#new_code_page:42"><span class="id" title="variable">new_code_page</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="EraVM.sem.Farcall.html#new_const_page:43"><span class="id" title="variable">new_const_page</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">),</span></a> <a class="idref" href="EraVM.sem.Farcall.html#code_length:44"><span class="id" title="variable">code_length</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.Decommitter.html#decommitment_cost"><span class="id" title="inductive">decommitment_cost</span></a> <span class="id" title="var">_</span> <a class="idref" href="EraVM.sem.Farcall.html#codes:38"><span class="id" title="variable">codes</span></a> <a class="idref" href="EraVM.sem.Farcall.html#vhash:40"><span class="id" title="variable">vhash</span></a> <a class="idref" href="EraVM.sem.Farcall.html#code_length:44"><span class="id" title="variable">code_length</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cost__decomm:45"><span class="id" title="variable">cost__decomm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#pay"><span class="id" title="inductive">pay</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cost__decomm:45"><span class="id" title="variable">cost__decomm</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs0:46"><span class="id" title="variable">cs0</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs1:47"><span class="id" title="variable">cs1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#paid_code_fetch:35"><span class="id" title="inductive">paid_code_fetch</span></a> <a class="idref" href="EraVM.sem.Farcall.html#masking_allowed:33"><span class="id" title="variable">masking_allowed</span></a> <a class="idref" href="EraVM.sem.Farcall.html#sid:34"><span class="id" title="variable">sid</span></a> <a class="idref" href="EraVM.sem.Farcall.html#depot:37"><span class="id" title="variable">depot</span></a> <a class="idref" href="EraVM.sem.Farcall.html#codes:38"><span class="id" title="variable">codes</span></a> <a class="idref" href="EraVM.sem.Farcall.html#dest_addr:41"><span class="id" title="variable">dest_addr</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs0:46"><span class="id" title="variable">cs0</span></a> (<a class="idref" href="EraVM.sem.Farcall.html#Fetched"><span class="id" title="constructor">Fetched</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs1:47"><span class="id" title="variable">cs1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#new_code_page:42"><span class="id" title="variable">new_code_page</span></a> <a class="idref" href="EraVM.sem.Farcall.html#new_const_page:43"><span class="id" title="variable">new_const_page</span></a>)<br/>
| <a id="cfp_unaffordable" class="idref" href="#cfp_unaffordable"><span class="id" title="constructor">cfp_unaffordable</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="depot:48" class="idref" href="#depot:48"><span class="id" title="binder">depot</span></a> (<a id="codes:49" class="idref" href="#codes:49"><span class="id" title="binder">codes</span></a>:<a class="idref" href="EraVM.State.html#decommitter"><span class="id" title="definition">decommitter</span></a>) (<a id="dest_addr:50" class="idref" href="#dest_addr:50"><span class="id" title="binder">dest_addr</span></a>: <a class="idref" href="EraVM.memory.Depot.html#contract_address"><span class="id" title="definition">contract_address</span></a>) <a id="vhash:51" class="idref" href="#vhash:51"><span class="id" title="binder">vhash</span></a> <a id="dest_addr:52" class="idref" href="#dest_addr:52"><span class="id" title="binder">dest_addr</span></a> <a id="new_code_page:53" class="idref" href="#new_code_page:53"><span class="id" title="binder">new_code_page</span></a> <a id="new_const_page:54" class="idref" href="#new_const_page:54"><span class="id" title="binder">new_const_page</span></a> <a id="code_length:55" class="idref" href="#code_length:55"><span class="id" title="binder">code_length</span></a> <a id="cost__decomm:56" class="idref" href="#cost__decomm:56"><span class="id" title="binder">cost__decomm</span></a> <a id="cs0:57" class="idref" href="#cs0:57"><span class="id" title="binder">cs0</span></a> ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.Decommitter.html#code_fetch"><span class="id" title="inductive">code_fetch</span></a> <span class="id" title="var">_</span> <a class="idref" href="EraVM.sem.Farcall.html#depot:48"><span class="id" title="variable">depot</span></a> <a class="idref" href="EraVM.sem.Farcall.html#codes:49"><span class="id" title="variable">codes</span></a>.(<a class="idref" href="EraVM.Decommitter.html#cm_storage"><span class="id" title="projection">cm_storage</span></a> <span class="id" title="var">_</span>) <a class="idref" href="EraVM.sem.Farcall.html#sid:34"><span class="id" title="variable">sid</span></a> <a class="idref" href="EraVM.sem.Farcall.html#dest_addr:52"><span class="id" title="variable">dest_addr</span></a> <a class="idref" href="EraVM.sem.Farcall.html#masking_allowed:33"><span class="id" title="variable">masking_allowed</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#vhash:51"><span class="id" title="variable">vhash</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#new_code_page:53"><span class="id" title="variable">new_code_page</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="EraVM.sem.Farcall.html#new_const_page:54"><span class="id" title="variable">new_const_page</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">),</span></a> <a class="idref" href="EraVM.sem.Farcall.html#code_length:55"><span class="id" title="variable">code_length</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.Decommitter.html#decommitment_cost"><span class="id" title="inductive">decommitment_cost</span></a> <span class="id" title="var">_</span> <a class="idref" href="EraVM.sem.Farcall.html#codes:49"><span class="id" title="variable">codes</span></a> <a class="idref" href="EraVM.sem.Farcall.html#vhash:51"><span class="id" title="variable">vhash</span></a> <a class="idref" href="EraVM.sem.Farcall.html#code_length:55"><span class="id" title="variable">code_length</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cost__decomm:56"><span class="id" title="variable">cost__decomm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#affordable"><span class="id" title="definition">affordable</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs0:57"><span class="id" title="variable">cs0</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cost__decomm:56"><span class="id" title="variable">cost__decomm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#paid_code_fetch:35"><span class="id" title="inductive">paid_code_fetch</span></a> <a class="idref" href="EraVM.sem.Farcall.html#masking_allowed:33"><span class="id" title="variable">masking_allowed</span></a> <a class="idref" href="EraVM.sem.Farcall.html#sid:34"><span class="id" title="variable">sid</span></a> <a class="idref" href="EraVM.sem.Farcall.html#depot:48"><span class="id" title="variable">depot</span></a> <a class="idref" href="EraVM.sem.Farcall.html#codes:49"><span class="id" title="variable">codes</span></a> <a class="idref" href="EraVM.sem.Farcall.html#dest_addr:52"><span class="id" title="variable">dest_addr</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs0:57"><span class="id" title="variable">cs0</span></a> (<a class="idref" href="EraVM.sem.Farcall.html#CodeFetchUnaffordable"><span class="id" title="constructor">CodeFetchUnaffordable</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cost__decomm:56"><span class="id" title="variable">cost__decomm</span></a>)<br/>
<br/>
| <a id="cfp_invalid_hash" class="idref" href="#cfp_invalid_hash"><span class="id" title="constructor">cfp_invalid_hash</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="depot:58" class="idref" href="#depot:58"><span class="id" title="binder">depot</span></a> (<a id="codes:59" class="idref" href="#codes:59"><span class="id" title="binder">codes</span></a>:<a class="idref" href="EraVM.State.html#decommitter"><span class="id" title="definition">decommitter</span></a>) (<a id="dest_addr:60" class="idref" href="#dest_addr:60"><span class="id" title="binder">dest_addr</span></a>: <a class="idref" href="EraVM.memory.Depot.html#contract_address"><span class="id" title="definition">contract_address</span></a>) <a id="vhash:61" class="idref" href="#vhash:61"><span class="id" title="binder">vhash</span></a> <a id="dest_addr:62" class="idref" href="#dest_addr:62"><span class="id" title="binder">dest_addr</span></a> <a id="new_code_page:63" class="idref" href="#new_code_page:63"><span class="id" title="binder">new_code_page</span></a> <a id="new_const_page:64" class="idref" href="#new_const_page:64"><span class="id" title="binder">new_const_page</span></a> <a id="code_length:65" class="idref" href="#code_length:65"><span class="id" title="binder">code_length</span></a> <a id="cs0:66" class="idref" href="#cs0:66"><span class="id" title="binder">cs0</span></a> ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.Decommitter.html#code_fetch"><span class="id" title="inductive">code_fetch</span></a> <span class="id" title="var">_</span> <a class="idref" href="EraVM.sem.Farcall.html#depot:58"><span class="id" title="variable">depot</span></a> <a class="idref" href="EraVM.sem.Farcall.html#codes:59"><span class="id" title="variable">codes</span></a>.(<a class="idref" href="EraVM.Decommitter.html#cm_storage"><span class="id" title="projection">cm_storage</span></a> <span class="id" title="var">_</span>) <a class="idref" href="EraVM.sem.Farcall.html#sid:34"><span class="id" title="variable">sid</span></a> <a class="idref" href="EraVM.sem.Farcall.html#dest_addr:62"><span class="id" title="variable">dest_addr</span></a> <a class="idref" href="EraVM.sem.Farcall.html#masking_allowed:33"><span class="id" title="variable">masking_allowed</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#vhash:61"><span class="id" title="variable">vhash</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#new_code_page:63"><span class="id" title="variable">new_code_page</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="EraVM.sem.Farcall.html#new_const_page:64"><span class="id" title="variable">new_const_page</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">),</span></a> <a class="idref" href="EraVM.sem.Farcall.html#code_length:65"><span class="id" title="variable">code_length</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.VersionedHash.html#marker_valid"><span class="id" title="definition">marker_valid</span></a> (<a class="idref" href="EraVM.VersionedHash.html#extra_marker"><span class="id" title="projection">extra_marker</span></a> <a class="idref" href="EraVM.sem.Farcall.html#vhash:61"><span class="id" title="variable">vhash</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#paid_code_fetch:35"><span class="id" title="inductive">paid_code_fetch</span></a> <a class="idref" href="EraVM.sem.Farcall.html#masking_allowed:33"><span class="id" title="variable">masking_allowed</span></a> <a class="idref" href="EraVM.sem.Farcall.html#sid:34"><span class="id" title="variable">sid</span></a> <a class="idref" href="EraVM.sem.Farcall.html#depot:58"><span class="id" title="variable">depot</span></a> <a class="idref" href="EraVM.sem.Farcall.html#codes:59"><span class="id" title="variable">codes</span></a> <a class="idref" href="EraVM.sem.Farcall.html#dest_addr:62"><span class="id" title="variable">dest_addr</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs0:66"><span class="id" title="variable">cs0</span></a> (<a class="idref" href="EraVM.sem.Farcall.html#CodeFetchInvalidVerisonedHashFormat"><span class="id" title="constructor">CodeFetchInvalidVerisonedHashFormat</span></a> <a class="idref" href="EraVM.sem.Farcall.html#vhash:61"><span class="id" title="variable">vhash</span></a>)<br/>
.<br/>

<br/>
</div>

<div class="doc"><h2 id="system-calls">System calls</h2>
<p>A system call is a far call that satisfies the following
conditions:</p>
<ul>
<li>The destination is a kernel address.</li>
<li>The field <code>is_system</code> of <span class="inlinecode"><span
class="id" title="var">FarCall.params</span></span> passed through an
operand is set to 1.</li>
</ul>
</div>
<div class="code">
<br/>

<br/>
</div>

<div class="doc"><h1 id="far-call-instructions">Far call instructions</h1>
<h2 id="summary">Summary</h2>
<ul>
<li><p>Far calls are calls to the code outside the current contract
space.</p></li>
<li><p>Mimic calls are a kernel-only variation of far calls allowing to
mimic a call from any contract by impersonating an arbitrary caller and
putting an arbitrary address into the new callframe’s <span
class="inlinecode"><a class="idref" href="EraVM.CallStack.html#ecf_msg_sender"><span
class="id" title="projection">ecf_msg_sender</span></a></span>
field.</p></li>
<li><p>Delegate calls are a variation of far calls allowing to call a
contract with the current storage space.</p>
<p><strong>Example</strong>: Suppose we have contracts A,B,C. Contract A
called contract B normally, then contract B delegated to contract C.
Then C’s code will be executed in a context of B’s storage, as if
contract A called contract C. If contract C returns normally, the
execution will proceed from the next instruction of B after delegate
call. In case of <code>revert</code> or <code>panic</code> in C, all the
usual rules apply.</p></li>
</ul>
<h2 id="abstract-and-concrete-syntax">Abstract and concrete syntax</h2>
<ul>
<li><p><span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpFarCall"><span
class="id" title="constructor">OpFarCall</span></a></span>
<code>abi_params address handler is_static</code></p>
<ul>
<li><code>farcall        abi_reg, dest_addr</code></li>
<li><code>farcall        abi_reg, dest_addr, handler</code></li>
<li><code>farcall.static abi_reg, dest_addr</code></li>
<li><code>farcall.static abi_reg, dest_addr, handler</code></li>
<li><code>farcall.shard  abi_reg, dest_addr</code></li>
<li><code>farcall.shard  abi_reg, dest_addr, handler</code></li>
</ul></li>
<li><p><span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span>
abi_params address handler is_static`</p>
<ul>
<li><code>delegatecall        abi_reg, dest_addr</code></li>
<li><code>delegatecall        abi_reg, dest_addr, handler</code></li>
<li><code>delegatecall.static abi_reg, dest_addr</code></li>
<li><code>delegatecall.static abi_reg, dest_addr, handler</code></li>
<li><code>delegatecall.shard  abi_reg, dest_addr</code></li>
<li><code>delegatecall.shard  abi_reg, dest_addr, handler</code></li>
</ul></li>
<li><p><span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpMimicCall"><span
class="id" title="constructor">OpMimicCall</span></a></span>
<code>abi_params address handler is_static</code></p>
<ul>
<li><code>mimic        abi_reg, dest_addr</code></li>
<li><code>mimic        abi_reg, dest_addr, handler</code></li>
<li><code>mimic.static abi_reg, dest_addr</code></li>
<li><code>mimic.static abi_reg, dest_addr, handler</code></li>
<li><code>mimic.shard  abi_reg, dest_addr</code></li>
<li><code>mimic.shard  abi_reg, dest_addr, handler</code></li>
</ul></li>
<li><p><strong>static</strong> modifier marks the new execution stack
frame as ‘static’, preventing some instructions from being executed.
Calls from a static calls are automatically marked static.</p></li>
<li><p><strong>shard</strong> modifier allows calling code from other
shards. The shard ID will be taken from <code>abi_reg</code>.</p></li>
</ul>
<h2 id="semantic">Semantic</h2>
<ol type="1">
<li>Decode the structure <code>params</code> from
<code>abi_reg</code>:</li>
</ol>
<pre><code>   Inductive fwd_memory :=
     ForwardFatPointer (p:fat_ptr)
   | ForwardNewFatPointer (heap_var: data_page_type) (s:span).


  Record params :=
    mk_params {
        fwd_memory: fwd_memory;
        ergs_passed: ergs;
        shard_id: shard_id;
        constructor_call: bool;
        to_system: bool;
      }.</code></pre>
<ol start="3" type="1">
<li><p>Decommit code of the callee contract (formalized by <span
class="inlinecode"><a class="idref" href="EraVM.sem.Farcall.html#paid_code_fetch"><span
class="id" title="inductive">paid_code_fetch</span></a></span>):</p>
<ul>
<li><p>load the <span
class="inlinecode"><a class="idref" href="EraVM.VersionedHash.html#versioned_hash"><span
class="id" title="record">versioned_hash</span></a></span> of the called
code from the storage of a special contract located at <span
class="inlinecode"><a class="idref" href="EraVM.Decommitter.html#DEPLOYER_SYSTEM_CONTRACT_ADDRESS"><span
class="id"
title="definition">DEPLOYER_SYSTEM_CONTRACT_ADDRESS</span></a></span>.</p>
<pre><code>Inductive marker := CODE_AT_REST | YET_CONSTRUCTED | INVALID.

Record versioned_hash := mk_vhash {
                          code_length_in_words: u16;
                          extra_marker: marker;
                          partial_hash: BITS (28*bits_in_byte)%nat
                        }.</code></pre></li>
<li><p>for non-system calls, if there is no code stored for a provided
hash value, mask it into <span class="inlinecode"><span class="id"
title="var">VersionedHash.DEFAULT_AA_VHASH</span></span> and execute
<span class="inlinecode"><span class="id"
title="var">VersionedHash.DEFAULT_AA_CODE</span></span>.</p></li>
<li><p>if the code with such hash has not been accessed in the current
block, pay for decommitment.</p></li>
</ul></li>
<li><p>Forward data to the new frame (formalized by <span
class="inlinecode"><span class="id"
title="var">paid_forward_and_adjust_bounds</span></span>).</p>
<ul>
<li>If <span
class="inlinecode"><a class="idref" href="EraVM.ABI.FarCallABI.html#params"><span
class="id"
title="record">params</span></a>.(<a class="idref" href="EraVM.MemoryManagement.html#fwd_memory"><span
class="id" title="inductive">fwd_memory</span></a>)</span> is <span
class="inlinecode"><a class="idref" href="EraVM.MemoryManagement.html#ForwardExistingFatPointer"><span
class="id"
title="constructor">ForwardExistingFatPointer</span></a></span> <span
class="inlinecode"><span class="id" title="var">p</span></span>, we are
forwarding an existing fat pointer.
<ul>
<li>ensure that <code>abi_reg</code> is tagged as a pointer.</li>
<li>check the pointer validity;</li>
<li><span
class="inlinecode"><a class="idref" href="EraVM.Pointer.html#fat_ptr_narrow"><span
class="id" title="definition">fat_ptr_narrow</span></a></span> the
pointer;</li>
</ul></li>
<li>If <span
class="inlinecode"><a class="idref" href="EraVM.ABI.FarCallABI.html#params"><span
class="id"
title="record">params</span></a>.(<a class="idref" href="EraVM.MemoryManagement.html#fwd_memory"><span
class="id" title="inductive">fwd_memory</span></a>)</span> is <span
class="inlinecode"><a class="idref" href="EraVM.MemoryManagement.html#ForwardNewFatPointer"><span
class="id" title="constructor">ForwardNewFatPointer</span></a></span>
<span class="inlinecode"><span class="id"
title="var">variant</span></span> <span
class="inlinecode"><a class="idref" href="EraVM.Pointer.html#span"><span
class="id" title="record">span</span></a></span>, a new <span
class="inlinecode"><a class="idref" href="EraVM.Pointer.html#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span> is created. This
pointer refers to the provided <span
class="inlinecode"><a class="idref" href="EraVM.Pointer.html#span"><span
class="id" title="record">span</span></a></span> of specified heap
<code>variant</code>.</li>
</ul></li>
<li><p>Allocate new pages for code, constants, stack, heap and auxheap
(formalized by <span
class="inlinecode"><a class="idref" href="EraVM.sem.Farcall.html#alloc_pages_extframe"><span
class="id"
title="inductive">alloc_pages_extframe</span></a></span>).</p></li>
<li><p>Reserve ergs for the new external frame (formalized by <span
class="inlinecode"><a class="idref" href="EraVM.sem.Farcall.html#pass_allowed_ergs"><span
class="id" title="inductive">pass_allowed_ergs</span></a></span>).</p>
<ul>
<li>Maximum amount of ergs passed to an external call is 63/64 of ergs
allocated for the caller.</li>
<li>Attempting to pass more ergs will result in only passing the maximum
amount allowed.</li>
<li>Trying to pass 0 ergs will result in passing maximum amount of ergs
allowed.</li>
</ul></li>
<li><p>Clear the context register.</p></li>
<li><p>Clear flags.</p></li>
<li><p>Modify GPRs depending on the call being system or not (formalized
by <span
class="inlinecode"><a class="idref" href="EraVM.sem.Farcall.html#regs_effect"><span
class="id" title="definition">regs_effect</span></a></span>):</p>
<ul>
<li>Effect of a non-system call:
<ul>
<li>All registers are cleared.</li>
<li>Register <code>R1</code> is assigned a fat pointer to forward data
to the far call. See <span class="inlinecode"><span class="id"
title="var">paid_forward</span></span>.</li>
</ul></li>
<li>Effect of a system call:
<ul>
<li>Register <code>R1</code> is assigned a fat pointer to forward data
to the far call. See <span class="inlinecode"><span class="id"
title="var">paid_forward</span></span>.</li>
<li>Register <code>R2</code> is assigned a bit-value:
<ul>
<li>bit 1 indicates “this is a system call”</li>
<li>bit 0 indicates “this is a constructor call”</li>
</ul></li>
<li>Registers <code>r3</code>, <code>r4</code>, …, <code>r15</code> are
reserved; their pointer tags are cleared, but their values are
unchanged.</li>
<li>Registers <code>r14</code> and <code>r15</code> are cleared.</li>
</ul></li>
</ul></li>
</ol>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Definition</span> <a id="regs_effect" class="idref" href="#regs_effect"><span class="id" title="definition">regs_effect</span></a> <a id="regs:67" class="idref" href="#regs:67"><span class="id" title="binder">regs</span></a> (<a id="is_system:68" class="idref" href="#is_system:68"><span class="id" title="binder">is_system</span></a> <a id="is_ctor:69" class="idref" href="#is_ctor:69"><span class="id" title="binder">is_ctor</span></a>:<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>) <a id="ptr:70" class="idref" href="#ptr:70"><span class="id" title="binder">ptr</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="far_call_r2:74" class="idref" href="#far_call_r2:74"><span class="id" title="binder">far_call_r2</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="is_system_bit:71" class="idref" href="#is_system_bit:71"><span class="id" title="binder">is_system_bit</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ZArith.BinInt.html#Z.shiftl"><span class="id" title="definition">Z.shiftl</span></a> <a class="idref" href="EraVM.sem.Farcall.html#is_system:68"><span class="id" title="variable">is_system</span></a> 1 <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="is_ctor_bit:72" class="idref" href="#is_ctor_bit:72"><span class="id" title="binder">is_ctor_bit</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ZArith.BinInt.html#Z.shiftl"><span class="id" title="definition">Z.shiftl</span></a> <a class="idref" href="EraVM.sem.Farcall.html#is_ctor:69"><span class="id" title="variable">is_ctor</span></a> 0 <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="bits:73" class="idref" href="#bits:73"><span class="id" title="binder">bits</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ZArith.BinInt.html#Z.lor"><span class="id" title="definition">Z.lor</span></a> <a class="idref" href="EraVM.sem.Farcall.html#is_system_bit:71"><span class="id" title="variable">is_system_bit</span></a> <a class="idref" href="EraVM.sem.Farcall.html#is_ctor_bit:72"><span class="id" title="variable">is_ctor_bit</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.PrimitiveValue.html#IntValue"><span class="id" title="abbreviation">IntValue</span></a> (<span class="id" title="definition">fromZ</span> <a class="idref" href="EraVM.sem.Farcall.html#bits:73"><span class="id" title="variable">bits</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="EraVM.ABI.FatPointerABI.html#encode_fat_ptr_word"><span class="id" title="definition">encode_fat_ptr_word</span></a> <a class="idref" href="EraVM.Types.html#zero128"><span class="id" title="definition">zero128</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ptr:70"><span class="id" title="variable">ptr</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">enc_ptr</span> ⇒ <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="EraVM.sem.Farcall.html#is_system:68"><span class="id" title="variable">is_system</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#regs:67"><span class="id" title="variable">regs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="EraVM.GPR.html#r1"><span class="id" title="projection">r1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="EraVM.PrimitiveValue.html#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <span class="id" title="var">enc_ptr</span> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="EraVM.GPR.html#r2"><span class="id" title="projection">r2</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="EraVM.sem.Farcall.html#far_call_r2:74"><span class="id" title="variable">far_call_r2</span></a>      <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;system&nbsp;calls,&nbsp;preserve&nbsp;values&nbsp;in&nbsp;r3-r13&nbsp;but&nbsp;clear&nbsp;ptr&nbsp;tags&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="EraVM.GPR.html#r3"><span class="id" title="projection">r3</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="EraVM.PrimitiveValue.html#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="EraVM.GPR.html#r4"><span class="id" title="projection">r4</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="EraVM.PrimitiveValue.html#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="EraVM.GPR.html#r5"><span class="id" title="projection">r5</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="EraVM.PrimitiveValue.html#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="EraVM.GPR.html#r6"><span class="id" title="projection">r6</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="EraVM.PrimitiveValue.html#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="EraVM.GPR.html#r7"><span class="id" title="projection">r7</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="EraVM.PrimitiveValue.html#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="EraVM.GPR.html#r8"><span class="id" title="projection">r8</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="EraVM.PrimitiveValue.html#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="EraVM.GPR.html#r9"><span class="id" title="projection">r9</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="EraVM.PrimitiveValue.html#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="EraVM.GPR.html#r10"><span class="id" title="projection">r10</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="EraVM.PrimitiveValue.html#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="EraVM.GPR.html#r11"><span class="id" title="projection">r11</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="EraVM.PrimitiveValue.html#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="EraVM.GPR.html#r12"><span class="id" title="projection">r12</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="EraVM.PrimitiveValue.html#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="EraVM.GPR.html#r13"><span class="id" title="projection">r13</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="EraVM.PrimitiveValue.html#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;zero&nbsp;the&nbsp;rest&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="EraVM.GPR.html#r14"><span class="id" title="projection">r14</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="EraVM.PrimitiveValue.html#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="EraVM.Core.html#word0"><span class="id" title="definition">word0</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="EraVM.GPR.html#r15"><span class="id" title="projection">r15</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="EraVM.PrimitiveValue.html#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="EraVM.Core.html#word0"><span class="id" title="definition">word0</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#regs_state_zero"><span class="id" title="definition">regs_state_zero</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="EraVM.GPR.html#r1"><span class="id" title="projection">r1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="EraVM.PrimitiveValue.html#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <span class="id" title="var">enc_ptr</span> <span class="id" title="notation">|></span> <span class="id" title="notation"><|</span> <a class="idref" href="EraVM.GPR.html#r2"><span class="id" title="projection">r2</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="EraVM.sem.Farcall.html#far_call_r2:74"><span class="id" title="variable">far_call_r2</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc"><ol start="10" type="1">
<li><p>Form a new execution stack frame:</p>
<ul>
<li>the call is static if the current call is static, or if
<code>.is_static</code> modifier is applied to instruction;</li>
<li>set exception handler to <code>handler</code> address provided in
the instruction;</li>
<li>it is a checkpoint that saves all storage states;</li>
<li>start PC at 0;</li>
<li>start SP at <span
class="inlinecode"><a class="idref" href="EraVM.sem.Farcall.html#INITIAL_SP_ON_FAR_CALL"><span
class="id"
title="definition">INITIAL_SP_ON_FAR_CALL</span></a></span>;</li>
<li><code>this_address</code>,<code>msg_sender</code> and
<code>context</code> fields are affected by the <span
class="inlinecode"><a class="idref" href="EraVM.sem.Farcall.html#farcall_type"><span
class="id" title="inductive">farcall_type</span></a></span> as follows:
<ul>
<li>Normal far call sets:
<ul>
<li><code>this_address</code> &lt;- destination address;</li>
<li><code>msg_sender</code> &lt;- caller address;</li>
<li><code>context</code> &lt;- value of context register <span
class="inlinecode"><a class="idref" href="EraVM.State.html#gs_context_u128"><span
class="id" title="projection">gs_context_u128</span></a></span>.</li>
</ul></li>
<li>Delegate call sets:
<ul>
<li><code>this_address</code> &lt;- <span class="inlinecode"><span
class="id" title="var">this_address</span></span> of the current
frame;</li>
<li><code>msg_sender</code> &lt;- <span class="inlinecode"><span
class="id" title="var">msg_sender</span></span> of the current
frame;</li>
<li><code>context</code> &lt;- <span class="inlinecode"><span class="id"
title="var">context_u128</span></span> of the current frame.</li>
</ul></li>
<li>Mimic call sets:
<ul>
<li><code>this_address</code> &lt;- destination address;</li>
<li><code>msg_sender</code> &lt;- value of <code>r3</code>;</li>
<li><code>context</code> &lt;- value of context register <span
class="inlinecode"><a class="idref" href="EraVM.State.html#gs_context_u128"><span
class="id" title="projection">gs_context_u128</span></a></span>.</li>
</ul></li>
</ul></li>
</ul></li>
</ol>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Definition</span> <a id="CALL_IMPLICIT_PARAMETER_REG" class="idref" href="#CALL_IMPLICIT_PARAMETER_REG"><span class="id" title="definition">CALL_IMPLICIT_PARAMETER_REG</span></a> := <a class="idref" href="EraVM.GPR.html#R15"><span class="id" title="constructor">R15</span></a>.<br/>
<span class="id" title="keyword">Inductive</span> <a id="farcall_type" class="idref" href="#farcall_type"><span class="id" title="inductive">farcall_type</span></a> : <span class="id" title="keyword">Set</span> := <a id="Normal" class="idref" href="#Normal"><span class="id" title="constructor">Normal</span></a> | <a id="Mimic" class="idref" href="#Mimic"><span class="id" title="constructor">Mimic</span></a> | <a id="Delegate" class="idref" href="#Delegate"><span class="id" title="constructor">Delegate</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a id="select_this_address" class="idref" href="#select_this_address"><span class="id" title="definition">select_this_address</span></a> <a id="type:77" class="idref" href="#type:77"><span class="id" title="binder">type</span></a> (<a id="caller:78" class="idref" href="#caller:78"><span class="id" title="binder">caller</span></a> <a id="dest:79" class="idref" href="#dest:79"><span class="id" title="binder">dest</span></a>: <a class="idref" href="EraVM.memory.Depot.html#contract_address"><span class="id" title="definition">contract_address</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="EraVM.sem.Farcall.html#type:77"><span class="id" title="variable">type</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="EraVM.sem.Farcall.html#Normal"><span class="id" title="constructor">Normal</span></a> ⇒ <a class="idref" href="EraVM.sem.Farcall.html#dest:79"><span class="id" title="variable">dest</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="EraVM.sem.Farcall.html#Mimic"><span class="id" title="constructor">Mimic</span></a> ⇒ <a class="idref" href="EraVM.sem.Farcall.html#dest:79"><span class="id" title="variable">dest</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="EraVM.sem.Farcall.html#Delegate"><span class="id" title="constructor">Delegate</span></a> ⇒ <a class="idref" href="EraVM.sem.Farcall.html#caller:78"><span class="id" title="variable">caller</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="select_sender" class="idref" href="#select_sender"><span class="id" title="definition">select_sender</span></a> <a id="type:81" class="idref" href="#type:81"><span class="id" title="binder">type</span></a> (<a id="callers_caller:82" class="idref" href="#callers_caller:82"><span class="id" title="binder">callers_caller</span></a> <a id="caller:83" class="idref" href="#caller:83"><span class="id" title="binder">caller</span></a> : <a class="idref" href="EraVM.memory.Depot.html#contract_address"><span class="id" title="definition">contract_address</span></a>) <a id="regs:84" class="idref" href="#regs:84"><span class="id" title="binder">regs</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="EraVM.sem.Farcall.html#type:81"><span class="id" title="variable">type</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="EraVM.sem.Farcall.html#Normal"><span class="id" title="constructor">Normal</span></a> ⇒ <a class="idref" href="EraVM.sem.Farcall.html#caller:83"><span class="id" title="variable">caller</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="EraVM.sem.Farcall.html#Delegate"><span class="id" title="constructor">Delegate</span></a> ⇒ <a class="idref" href="EraVM.sem.Farcall.html#callers_caller:82"><span class="id" title="variable">callers_caller</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="EraVM.sem.Farcall.html#Mimic"><span class="id" title="constructor">Mimic</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="r15_value:86" class="idref" href="#r15_value:86"><span class="id" title="binder">r15_value</span></a> := (<a class="idref" href="EraVM.GPR.html#fetch_gpr"><span class="id" title="definition">fetch_gpr</span></a> <a class="idref" href="EraVM.sem.Farcall.html#regs:84"><span class="id" title="variable">regs</span></a> <a class="idref" href="EraVM.sem.Farcall.html#CALL_IMPLICIT_PARAMETER_REG"><span class="id" title="definition">CALL_IMPLICIT_PARAMETER_REG</span></a>).(<a class="idref" href="EraVM.PrimitiveValue.html#value"><span class="id" title="projection">value</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">low</span> <a class="idref" href="EraVM.memory.Depot.html#contract_address_bits"><span class="id" title="definition">contract_address_bits</span></a> <a class="idref" href="EraVM.sem.Farcall.html#r15_value:86"><span class="id" title="variable">r15_value</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="select_associated_contracts" class="idref" href="#select_associated_contracts"><span class="id" title="definition">select_associated_contracts</span></a> <a id="type:87" class="idref" href="#type:87"><span class="id" title="binder">type</span></a> <a id="regs:88" class="idref" href="#regs:88"><span class="id" title="binder">regs</span></a> (<a id="ac:89" class="idref" href="#ac:89"><span class="id" title="binder">ac</span></a>:<a class="idref" href="EraVM.CallStack.html#associated_contracts"><span class="id" title="record">associated_contracts</span></a>) (<a id="call_dest:90" class="idref" href="#call_dest:90"><span class="id" title="binder">call_dest</span></a>: <a class="idref" href="EraVM.memory.Depot.html#contract_address"><span class="id" title="definition">contract_address</span></a>): <a class="idref" href="EraVM.CallStack.html#associated_contracts"><span class="id" title="record">associated_contracts</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="EraVM.sem.Farcall.html#ac:89"><span class="id" title="variable">ac</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="EraVM.CallStack.html#mk_assoc_contracts"><span class="id" title="constructor">mk_assoc_contracts</span></a> <span class="id" title="var">this_address</span> <span class="id" title="var">msg_sender</span> <a class="idref" href="EraVM.memory.PageTypes.html#code_address"><span class="id" title="definition">code_address</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ecf_this_address"><span class="id" title="projection">ecf_this_address</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#select_this_address"><span class="id" title="definition">select_this_address</span></a> <a class="idref" href="EraVM.sem.Farcall.html#type:87"><span class="id" title="variable">type</span></a> <span class="id" title="var">this_address</span> <a class="idref" href="EraVM.sem.Farcall.html#call_dest:90"><span class="id" title="variable">call_dest</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ecf_msg_sender"><span class="id" title="projection">ecf_msg_sender</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#select_sender"><span class="id" title="definition">select_sender</span></a> <a class="idref" href="EraVM.sem.Farcall.html#type:87"><span class="id" title="variable">type</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ac:89"><span class="id" title="variable">ac</span></a>.(<a class="idref" href="EraVM.CallStack.html#ecf_msg_sender"><span class="id" title="projection">ecf_msg_sender</span></a>) <span class="id" title="var">this_address</span> <a class="idref" href="EraVM.sem.Farcall.html#regs:88"><span class="id" title="variable">regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ecf_code_address"><span class="id" title="projection">ecf_code_address</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#call_dest:90"><span class="id" title="variable">call_dest</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="select_ctx" class="idref" href="#select_ctx"><span class="id" title="definition">select_ctx</span></a> <a id="type:92" class="idref" href="#type:92"><span class="id" title="binder">type</span></a> (<a id="reg_ctx:93" class="idref" href="#reg_ctx:93"><span class="id" title="binder">reg_ctx</span></a> <a id="frame_ctx:94" class="idref" href="#frame_ctx:94"><span class="id" title="binder">frame_ctx</span></a>: <a class="idref" href="EraVM.Types.html#u128"><span class="id" title="definition">u128</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="EraVM.sem.Farcall.html#type:92"><span class="id" title="variable">type</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="EraVM.sem.Farcall.html#Normal"><span class="id" title="constructor">Normal</span></a> | <a class="idref" href="EraVM.sem.Farcall.html#Mimic"><span class="id" title="constructor">Mimic</span></a> ⇒ <a class="idref" href="EraVM.sem.Farcall.html#reg_ctx:93"><span class="id" title="variable">reg_ctx</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="EraVM.sem.Farcall.html#Delegate"><span class="id" title="constructor">Delegate</span></a> ⇒ <a class="idref" href="EraVM.sem.Farcall.html#frame_ctx:94"><span class="id" title="variable">frame_ctx</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="new_code_shard_id" class="idref" href="#new_code_shard_id"><span class="id" title="definition">new_code_shard_id</span></a> (<a id="is_call_shard:96" class="idref" href="#is_call_shard:96"><span class="id" title="binder">is_call_shard</span></a>:<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>)<br/>
&nbsp;&nbsp;(<a id="provided:97" class="idref" href="#provided:97"><span class="id" title="binder">provided</span></a> <a id="current_shard:98" class="idref" href="#current_shard:98"><span class="id" title="binder">current_shard</span></a>:<a class="idref" href="EraVM.memory.Depot.html#shard_id"><span class="id" title="definition">shard_id</span></a>) : <a class="idref" href="EraVM.memory.Depot.html#shard_id"><span class="id" title="definition">shard_id</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="EraVM.sem.Farcall.html#is_call_shard:96"><span class="id" title="variable">is_call_shard</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="EraVM.sem.Farcall.html#provided:97"><span class="id" title="variable">provided</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="EraVM.sem.Farcall.html#current_shard:98"><span class="id" title="variable">current_shard</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="select_shards" class="idref" href="#select_shards"><span class="id" title="definition">select_shards</span></a> (<a id="type:99" class="idref" href="#type:99"><span class="id" title="binder">type</span></a>: <a class="idref" href="EraVM.sem.Farcall.html#farcall_type"><span class="id" title="inductive">farcall_type</span></a>) (<a id="is_call_shard:100" class="idref" href="#is_call_shard:100"><span class="id" title="binder">is_call_shard</span></a>: <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>) (<a id="provided:101" class="idref" href="#provided:101"><span class="id" title="binder">provided</span></a>: <a class="idref" href="EraVM.memory.Depot.html#shard_id"><span class="id" title="definition">shard_id</span></a>) (<a id="ss:102" class="idref" href="#ss:102"><span class="id" title="binder">ss</span></a>: <a class="idref" href="EraVM.CallStack.html#active_shards"><span class="id" title="record">active_shards</span></a>) : <a class="idref" href="EraVM.CallStack.html#active_shards"><span class="id" title="record">active_shards</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="EraVM.sem.Farcall.html#ss:102"><span class="id" title="variable">ss</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="EraVM.CallStack.html#mk_shards"><span class="id" title="constructor">mk_shards</span></a> <span class="id" title="var">old_this</span> <span class="id" title="var">_</span> <span class="id" title="var">code</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_caller:104" class="idref" href="#new_caller:104"><span class="id" title="binder">new_caller</span></a> := <span class="id" title="var">old_this</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_code:105" class="idref" href="#new_code:105"><span class="id" title="binder">new_code</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#new_code_shard_id"><span class="id" title="definition">new_code_shard_id</span></a> <a class="idref" href="EraVM.sem.Farcall.html#is_call_shard:100"><span class="id" title="variable">is_call_shard</span></a> <a class="idref" href="EraVM.sem.Farcall.html#provided:101"><span class="id" title="variable">provided</span></a> <a class="idref" href="EraVM.sem.Farcall.html#new_caller:104"><span class="id" title="variable">new_caller</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_this:107" class="idref" href="#new_this:107"><span class="id" title="binder">new_this</span></a> := <span class="id" title="keyword">match</span> <a class="idref" href="EraVM.sem.Farcall.html#type:99"><span class="id" title="variable">type</span></a> <span class="id" title="keyword">with</span> | <a class="idref" href="EraVM.sem.Farcall.html#Delegate"><span class="id" title="constructor">Delegate</span></a> ⇒ <a class="idref" href="EraVM.sem.Farcall.html#new_caller:104"><span class="id" title="variable">new_caller</span></a> | <span class="id" title="var">_</span> ⇒ <a class="idref" href="EraVM.sem.Farcall.html#new_code:105"><span class="id" title="variable">new_code</span></a> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#shard_this"><span class="id" title="projection">shard_this</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#new_this:107"><span class="id" title="variable">new_this</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#shard_caller"><span class="id" title="projection">shard_caller</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#new_caller:104"><span class="id" title="variable">new_caller</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#shard_code"><span class="id" title="projection">shard_code</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#new_code:105"><span class="id" title="variable">new_code</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="FarCallDefinitions" class="idref" href="#FarCallDefinitions"><span class="id" title="section">FarCallDefinitions</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <a class="idref" href="EraVM.Pointer.html#"><span class="id" title="module">Pointer</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="type:108" class="idref" href="#type:108"><span class="id" title="binder">type</span></a>:<a class="idref" href="EraVM.sem.Farcall.html#farcall_type"><span class="id" title="inductive">farcall_type</span></a>) (<a id="is_static_call:109" class="idref" href="#is_static_call:109"><span class="id" title="binder">is_static_call</span></a> <a id="is_shard_provided:110" class="idref" href="#is_shard_provided:110"><span class="id" title="binder">is_shard_provided</span></a>:<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>) (<a id="dest:111" class="idref" href="#dest:111"><span class="id" title="binder">dest</span></a>:<a class="idref" href="EraVM.memory.Depot.html#contract_address"><span class="id" title="definition">contract_address</span></a>) (<a id="handler:112" class="idref" href="#handler:112"><span class="id" title="binder">handler</span></a>: <a class="idref" href="EraVM.memory.PageTypes.html#code_address"><span class="id" title="definition">code_address</span></a>) (<a id="gs:113" class="idref" href="#gs:113"><span class="id" title="binder">gs</span></a>:<a class="idref" href="EraVM.State.html#global_state"><span class="id" title="record">global_state</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="farcall" class="idref" href="#farcall"><span class="id" title="inductive">farcall</span></a> : @<a class="idref" href="EraVM.PrimitiveValue.html#primitive_value"><span class="id" title="record">primitive_value</span></a> <a class="idref" href="EraVM.ABI.FarCallABI.html#params"><span class="id" title="record">FarCallABI.params</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.Steps.html#tsmallstep"><span class="id" title="definition">tsmallstep</span></a> :=<br/>
<br/>
&nbsp;&nbsp;| <a id="farcall_fwd_existing_fatptr" class="idref" href="#farcall_fwd_existing_fatptr"><span class="id" title="constructor">farcall_fwd_existing_fatptr</span></a>: <span class="id" title="keyword">∀</span> <a id="flags:116" class="idref" href="#flags:116"><span class="id" title="binder">flags</span></a> <a id="old_regs:117" class="idref" href="#old_regs:117"><span class="id" title="binder">old_regs</span></a> <a id="old_pages:118" class="idref" href="#old_pages:118"><span class="id" title="binder">old_pages</span></a> <a id="cs0:119" class="idref" href="#cs0:119"><span class="id" title="binder">cs0</span></a> <a id="cs1:120" class="idref" href="#cs1:120"><span class="id" title="binder">cs1</span></a> <a id="new_caller_stack:121" class="idref" href="#new_caller_stack:121"><span class="id" title="binder">new_caller_stack</span></a> <a id="new_stack:122" class="idref" href="#new_stack:122"><span class="id" title="binder">new_stack</span></a>  <a id="reg_context_u128:123" class="idref" href="#reg_context_u128:123"><span class="id" title="binder">reg_context_u128</span></a> <a id="new_regs:124" class="idref" href="#new_regs:124"><span class="id" title="binder">new_regs</span></a> <a id="new_pages:125" class="idref" href="#new_pages:125"><span class="id" title="binder">new_pages</span></a> <a id="new_code_page:126" class="idref" href="#new_code_page:126"><span class="id" title="binder">new_code_page</span></a> <a id="new_const_page:127" class="idref" href="#new_const_page:127"><span class="id" title="binder">new_const_page</span></a> <a id="new_mem_ctx:128" class="idref" href="#new_mem_ctx:128"><span class="id" title="binder">new_mem_ctx</span></a> (<a id="in_ptr:129" class="idref" href="#in_ptr:129"><span class="id" title="binder">in_ptr</span></a> <a id="narrowed_ptr:130" class="idref" href="#narrowed_ptr:130"><span class="id" title="binder">narrowed_ptr</span></a>: <a class="idref" href="EraVM.Pointer.html#fat_ptr"><span class="id" title="record">fat_ptr</span></a>) <a id="abi_shard:131" class="idref" href="#abi_shard:131"><span class="id" title="binder">abi_shard</span></a> <a id="ergs_query:132" class="idref" href="#ergs_query:132"><span class="id" title="binder">ergs_query</span></a> <a id="ergs_actual:133" class="idref" href="#ergs_actual:133"><span class="id" title="binder">ergs_actual</span></a> <a id="is_syscall_query:134" class="idref" href="#is_syscall_query:134"><span class="id" title="binder">is_syscall_query</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="caller_extframe:135" class="idref" href="#caller_extframe:135"><span class="id" title="binder">caller_extframe</span></a> := <a class="idref" href="EraVM.CallStack.html#active_extframe"><span class="id" title="definition">active_extframe</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs0:119"><span class="id" title="variable">cs0</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="mem_ctx0:136" class="idref" href="#mem_ctx0:136"><span class="id" title="binder">mem_ctx0</span></a> := <a class="idref" href="EraVM.CallStack.html#ecf_mem_ctx"><span class="id" title="projection">ecf_mem_ctx</span></a> <a class="idref" href="EraVM.sem.Farcall.html#caller_extframe:135"><span class="id" title="variable">caller_extframe</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="is_system:137" class="idref" href="#is_system:137"><span class="id" title="binder">is_system</span></a> := <a class="idref" href="EraVM.KernelMode.html#addr_is_kernel"><span class="id" title="definition">addr_is_kernel</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a> <a class="idref" href="EraVM.sem.Farcall.html#is_syscall_query:134"><span class="id" title="variable">is_syscall_query</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="allow_masking:138" class="idref" href="#allow_masking:138"><span class="id" title="binder">allow_masking</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#negb"><span class="id" title="definition">negb</span></a> <a class="idref" href="EraVM.sem.Farcall.html#is_system:137"><span class="id" title="variable">is_system</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="callee_shard:139" class="idref" href="#callee_shard:139"><span class="id" title="binder">callee_shard</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.is_shard_provided"><span class="id" title="variable">is_shard_provided</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="EraVM.sem.Farcall.html#abi_shard:131"><span class="id" title="variable">abi_shard</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="EraVM.CallStack.html#current_shard"><span class="id" title="definition">current_shard</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs0:119"><span class="id" title="variable">cs0</span></a> <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#paid_code_fetch"><span class="id" title="inductive">paid_code_fetch</span></a> <a class="idref" href="EraVM.sem.Farcall.html#allow_masking:138"><span class="id" title="variable">allow_masking</span></a> <a class="idref" href="EraVM.sem.Farcall.html#callee_shard:139"><span class="id" title="variable">callee_shard</span></a> (<a class="idref" href="EraVM.State.html#gs_depot"><span class="id" title="projection">gs_depot</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>) (<a class="idref" href="EraVM.State.html#gs_contracts"><span class="id" title="projection">gs_contracts</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>) <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs0:119"><span class="id" title="variable">cs0</span></a> (<a class="idref" href="EraVM.sem.Farcall.html#Fetched"><span class="id" title="constructor">Fetched</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs1:120"><span class="id" title="variable">cs1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#new_code_page:126"><span class="id" title="variable">new_code_page</span></a> <a class="idref" href="EraVM.sem.Farcall.html#new_const_page:127"><span class="id" title="variable">new_const_page</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*!*)</span><a class="idref" href="EraVM.Pointer.html#validate"><span class="id" title="definition">validate</span></a> <a class="idref" href="EraVM.sem.Farcall.html#in_ptr:129"><span class="id" title="variable">in_ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.Pointer.html#no_exceptions"><span class="id" title="definition">no_exceptions</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*!*)</span><a class="idref" href="EraVM.Pointer.html#fat_ptr_narrow"><span class="id" title="definition">fat_ptr_narrow</span></a> <a class="idref" href="EraVM.sem.Farcall.html#in_ptr:129"><span class="id" title="variable">in_ptr</span></a> <a class="idref" href="EraVM.sem.Farcall.html#narrowed_ptr:130"><span class="id" title="variable">narrowed_ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#alloc_pages_extframe"><span class="id" title="inductive">alloc_pages_extframe</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#old_pages:118"><span class="id" title="variable">old_pages</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="EraVM.sem.Farcall.html#mem_ctx0:136"><span class="id" title="variable">mem_ctx0</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="EraVM.sem.Farcall.html#new_code_page:126"><span class="id" title="variable">new_code_page</span></a> <a class="idref" href="EraVM.sem.Farcall.html#new_const_page:127"><span class="id" title="variable">new_const_page</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#new_pages:125"><span class="id" title="variable">new_pages</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="EraVM.sem.Farcall.html#new_mem_ctx:128"><span class="id" title="variable">new_mem_ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#pass_allowed_ergs"><span class="id" title="inductive">pass_allowed_ergs</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#ergs_query:132"><span class="id" title="variable">ergs_query</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="EraVM.sem.Farcall.html#cs1:120"><span class="id" title="variable">cs1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#ergs_actual:133"><span class="id" title="variable">ergs_actual</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="EraVM.sem.Farcall.html#new_caller_stack:121"><span class="id" title="variable">new_caller_stack</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#new_stack:122"><span class="id" title="variable">new_stack</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ecf_associated"><span class="id" title="projection">ecf_associated</span></a>         := <a class="idref" href="EraVM.sem.Farcall.html#select_associated_contracts"><span class="id" title="definition">select_associated_contracts</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.type"><span class="id" title="variable">type</span></a> <a class="idref" href="EraVM.sem.Farcall.html#old_regs:117"><span class="id" title="variable">old_regs</span></a> <a class="idref" href="EraVM.sem.Farcall.html#caller_extframe:135"><span class="id" title="variable">caller_extframe</span></a>.(<a class="idref" href="EraVM.CallStack.html#ecf_associated"><span class="id" title="projection">ecf_associated</span></a>) <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ecf_context_u128_value"><span class="id" title="projection">ecf_context_u128_value</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#select_ctx"><span class="id" title="definition">select_ctx</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.type"><span class="id" title="variable">type</span></a> <a class="idref" href="EraVM.sem.Farcall.html#reg_context_u128:123"><span class="id" title="variable">reg_context_u128</span></a> <a class="idref" href="EraVM.sem.Farcall.html#caller_extframe:135"><span class="id" title="variable">caller_extframe</span></a>.(<a class="idref" href="EraVM.CallStack.html#ecf_context_u128_value"><span class="id" title="projection">ecf_context_u128_value</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ecf_shards"><span class="id" title="projection">ecf_shards</span></a>             := <a class="idref" href="EraVM.sem.Farcall.html#select_shards"><span class="id" title="definition">select_shards</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.type"><span class="id" title="variable">type</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.is_shard_provided"><span class="id" title="variable">is_shard_provided</span></a> <a class="idref" href="EraVM.sem.Farcall.html#abi_shard:131"><span class="id" title="variable">abi_shard</span></a> <a class="idref" href="EraVM.sem.Farcall.html#caller_extframe:135"><span class="id" title="variable">caller_extframe</span></a>.(<a class="idref" href="EraVM.CallStack.html#ecf_shards"><span class="id" title="projection">ecf_shards</span></a>);<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ecf_mem_ctx"><span class="id" title="projection">ecf_mem_ctx</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#new_mem_ctx:128"><span class="id" title="variable">new_mem_ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ecf_is_static"><span class="id" title="projection">ecf_is_static</span></a> :=  <a class="idref" href="EraVM.CallStack.html#ecf_is_static"><span class="id" title="projection">ecf_is_static</span></a> <a class="idref" href="EraVM.sem.Farcall.html#caller_extframe:135"><span class="id" title="variable">caller_extframe</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">||</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.is_static_call"><span class="id" title="variable">is_static_call</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ecf_common"><span class="id" title="projection">ecf_common</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#cf_exception_handler_location"><span class="id" title="projection">cf_exception_handler_location</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.handler"><span class="id" title="variable">handler</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#cf_sp"><span class="id" title="projection">cf_sp</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#INITIAL_SP_ON_FAR_CALL"><span class="id" title="definition">INITIAL_SP_ON_FAR_CALL</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#cf_pc"><span class="id" title="projection">cf_pc</span></a> := <a class="idref" href="EraVM.Types.html#zero16"><span class="id" title="definition">zero16</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#cf_ergs_remaining"><span class="id" title="projection">cf_ergs_remaining</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#ergs_actual:133"><span class="id" title="variable">ergs_actual</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#cf_saved_checkpoint"><span class="id" title="projection">cf_saved_checkpoint</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>.(<a class="idref" href="EraVM.State.html#gs_revertable"><span class="id" title="projection">gs_revertable</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|} (<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="EraVM.sem.Farcall.html#new_caller_stack:121"><span class="id" title="variable">new_caller_stack</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="EraVM.sem.Farcall.html#new_regs:124"><span class="id" title="variable">new_regs</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.sem.Farcall.html#regs_effect"><span class="id" title="definition">regs_effect</span></a> <a class="idref" href="EraVM.sem.Farcall.html#old_regs:117"><span class="id" title="variable">old_regs</span></a> <a class="idref" href="EraVM.sem.Farcall.html#is_system:137"><span class="id" title="variable">is_system</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<a class="idref" href="EraVM.Pointer.html#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="EraVM.sem.Farcall.html#narrowed_ptr:130"><span class="id" title="variable">narrowed_ptr</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#farcall:114"><span class="id" title="inductive">farcall</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="EraVM.PrimitiveValue.html#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> {|<br/>
<a class="idref" href="EraVM.ABI.FarCallABI.html#fwd_memory"><span class="id" title="projection">FarCallABI.fwd_memory</span></a>           := <a class="idref" href="EraVM.MemoryManagement.html#ForwardExistingFatPointer"><span class="id" title="constructor">ForwardExistingFatPointer</span></a> (<a class="idref" href="EraVM.Pointer.html#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="EraVM.sem.Farcall.html#in_ptr:129"><span class="id" title="variable">in_ptr</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#ergs_passed"><span class="id" title="projection">ergs_passed</span></a>          := <a class="idref" href="EraVM.sem.Farcall.html#ergs_query:132"><span class="id" title="variable">ergs_query</span></a>;<br/>
<a class="idref" href="EraVM.ABI.FarCallABI.html#shard_id"><span class="id" title="projection">FarCallABI.shard_id</span></a>     := <a class="idref" href="EraVM.sem.Farcall.html#abi_shard:131"><span class="id" title="variable">abi_shard</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#constructor_call"><span class="id" title="projection">constructor_call</span></a>     := <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#to_system"><span class="id" title="projection">to_system</span></a>            := <a class="idref" href="EraVM.sem.Farcall.html#is_syscall_query:134"><span class="id" title="variable">is_syscall_query</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="EraVM.sem.Farcall.html#flags:116"><span class="id" title="variable">flags</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="EraVM.sem.Farcall.html#old_regs:117"><span class="id" title="variable">old_regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="EraVM.sem.Farcall.html#old_pages:118"><span class="id" title="variable">old_pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="EraVM.sem.Farcall.html#cs0:119"><span class="id" title="variable">cs0</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#reg_context_u128:123"><span class="id" title="variable">reg_context_u128</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="EraVM.VMPanic.html#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="EraVM.Flags.html#flags_clear"><span class="id" title="definition">flags_clear</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="EraVM.sem.Farcall.html#new_regs:124"><span class="id" title="variable">new_regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="EraVM.sem.Farcall.html#new_pages:125"><span class="id" title="variable">new_pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="EraVM.sem.Farcall.html#new_stack:122"><span class="id" title="variable">new_stack</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="EraVM.Types.html#zero128"><span class="id" title="definition">zero128</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="EraVM.VMPanic.html#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
<br/>
&nbsp;&nbsp;| <a id="farcall_fwd_new_ptr" class="idref" href="#farcall_fwd_new_ptr"><span class="id" title="constructor">farcall_fwd_new_ptr</span></a>: <span class="id" title="keyword">∀</span> <a id="flags:140" class="idref" href="#flags:140"><span class="id" title="binder">flags</span></a> <a id="old_regs:141" class="idref" href="#old_regs:141"><span class="id" title="binder">old_regs</span></a> <a id="old_pages:142" class="idref" href="#old_pages:142"><span class="id" title="binder">old_pages</span></a> <a id="cs0:143" class="idref" href="#cs0:143"><span class="id" title="binder">cs0</span></a> <a id="cs1:144" class="idref" href="#cs1:144"><span class="id" title="binder">cs1</span></a> <a id="cs2:145" class="idref" href="#cs2:145"><span class="id" title="binder">cs2</span></a> <a id="new_regs:146" class="idref" href="#new_regs:146"><span class="id" title="binder">new_regs</span></a> <a id="new_caller_stack:147" class="idref" href="#new_caller_stack:147"><span class="id" title="binder">new_caller_stack</span></a> <a id="new_stack:148" class="idref" href="#new_stack:148"><span class="id" title="binder">new_stack</span></a> <a id="reg_context_u128:149" class="idref" href="#reg_context_u128:149"><span class="id" title="binder">reg_context_u128</span></a> <a id="new_pages:150" class="idref" href="#new_pages:150"><span class="id" title="binder">new_pages</span></a> <a id="new_code_page:151" class="idref" href="#new_code_page:151"><span class="id" title="binder">new_code_page</span></a> <a id="new_const_page:152" class="idref" href="#new_const_page:152"><span class="id" title="binder">new_const_page</span></a> <a id="new_mem_ctx:153" class="idref" href="#new_mem_ctx:153"><span class="id" title="binder">new_mem_ctx</span></a> <a id="abi_shard:154" class="idref" href="#abi_shard:154"><span class="id" title="binder">abi_shard</span></a> <a id="ergs_query:155" class="idref" href="#ergs_query:155"><span class="id" title="binder">ergs_query</span></a> <a id="ergs_actual:156" class="idref" href="#ergs_actual:156"><span class="id" title="binder">ergs_actual</span></a> <a id="is_syscall_query:157" class="idref" href="#is_syscall_query:157"><span class="id" title="binder">is_syscall_query</span></a> <a id="out_ptr:158" class="idref" href="#out_ptr:158"><span class="id" title="binder">out_ptr</span></a> <a id="in_span:159" class="idref" href="#in_span:159"><span class="id" title="binder">in_span</span></a> <a id="page_type:160" class="idref" href="#page_type:160"><span class="id" title="binder">page_type</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="is_system:161" class="idref" href="#is_system:161"><span class="id" title="binder">is_system</span></a> := <a class="idref" href="EraVM.KernelMode.html#addr_is_kernel"><span class="id" title="definition">addr_is_kernel</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a> <a class="idref" href="EraVM.sem.Farcall.html#is_syscall_query:157"><span class="id" title="variable">is_syscall_query</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="allow_masking:162" class="idref" href="#allow_masking:162"><span class="id" title="binder">allow_masking</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#negb"><span class="id" title="definition">negb</span></a> <a class="idref" href="EraVM.sem.Farcall.html#is_system:161"><span class="id" title="variable">is_system</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="callee_shard:163" class="idref" href="#callee_shard:163"><span class="id" title="binder">callee_shard</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.is_shard_provided"><span class="id" title="variable">is_shard_provided</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="EraVM.sem.Farcall.html#abi_shard:154"><span class="id" title="variable">abi_shard</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="EraVM.CallStack.html#current_shard"><span class="id" title="definition">current_shard</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs0:143"><span class="id" title="variable">cs0</span></a> <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#paid_code_fetch"><span class="id" title="inductive">paid_code_fetch</span></a> <a class="idref" href="EraVM.sem.Farcall.html#allow_masking:162"><span class="id" title="variable">allow_masking</span></a> <a class="idref" href="EraVM.sem.Farcall.html#callee_shard:163"><span class="id" title="variable">callee_shard</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>.(<a class="idref" href="EraVM.State.html#gs_revertable"><span class="id" title="projection">gs_revertable</span></a>).(<a class="idref" href="EraVM.State.html#gs_depot"><span class="id" title="projection">gs_depot</span></a>) <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>.(<a class="idref" href="EraVM.State.html#gs_contracts"><span class="id" title="projection">gs_contracts</span></a>) <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs0:143"><span class="id" title="variable">cs0</span></a> (<a class="idref" href="EraVM.sem.Farcall.html#Fetched"><span class="id" title="constructor">Fetched</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs1:144"><span class="id" title="variable">cs1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#new_code_page:151"><span class="id" title="variable">new_code_page</span></a> <a class="idref" href="EraVM.sem.Farcall.html#new_const_page:152"><span class="id" title="variable">new_const_page</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*!*)</span><a class="idref" href="EraVM.MemoryManagement.html#paid_forward_new_fat_ptr"><span class="id" title="inductive">paid_forward_new_fat_ptr</span></a> <a class="idref" href="EraVM.sem.Farcall.html#page_type:160"><span class="id" title="variable">page_type</span></a> <a class="idref" href="EraVM.sem.Farcall.html#in_span:159"><span class="id" title="variable">in_span</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs0:143"><span class="id" title="variable">cs0</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#out_ptr:158"><span class="id" title="variable">out_ptr</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs1:144"><span class="id" title="variable">cs1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="caller_extframe:164" class="idref" href="#caller_extframe:164"><span class="id" title="binder">caller_extframe</span></a> := <a class="idref" href="EraVM.CallStack.html#active_extframe"><span class="id" title="definition">active_extframe</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs2:145"><span class="id" title="variable">cs2</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="mem_ctx0:165" class="idref" href="#mem_ctx0:165"><span class="id" title="binder">mem_ctx0</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#caller_extframe:164"><span class="id" title="variable">caller_extframe</span></a>.(<a class="idref" href="EraVM.CallStack.html#ecf_mem_ctx"><span class="id" title="projection">ecf_mem_ctx</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#alloc_pages_extframe"><span class="id" title="inductive">alloc_pages_extframe</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#old_pages:142"><span class="id" title="variable">old_pages</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="EraVM.sem.Farcall.html#mem_ctx0:165"><span class="id" title="variable">mem_ctx0</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="EraVM.sem.Farcall.html#new_code_page:151"><span class="id" title="variable">new_code_page</span></a> <a class="idref" href="EraVM.sem.Farcall.html#new_const_page:152"><span class="id" title="variable">new_const_page</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#new_pages:150"><span class="id" title="variable">new_pages</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="EraVM.sem.Farcall.html#new_mem_ctx:153"><span class="id" title="variable">new_mem_ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#pass_allowed_ergs"><span class="id" title="inductive">pass_allowed_ergs</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#ergs_query:155"><span class="id" title="variable">ergs_query</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="EraVM.sem.Farcall.html#cs2:145"><span class="id" title="variable">cs2</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="EraVM.sem.Farcall.html#ergs_actual:156"><span class="id" title="variable">ergs_actual</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="EraVM.sem.Farcall.html#new_caller_stack:147"><span class="id" title="variable">new_caller_stack</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#new_stack:148"><span class="id" title="variable">new_stack</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.CallStack.html#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ecf_associated"><span class="id" title="projection">ecf_associated</span></a>         := <a class="idref" href="EraVM.sem.Farcall.html#select_associated_contracts"><span class="id" title="definition">select_associated_contracts</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.type"><span class="id" title="variable">type</span></a> <a class="idref" href="EraVM.sem.Farcall.html#old_regs:141"><span class="id" title="variable">old_regs</span></a> <a class="idref" href="EraVM.sem.Farcall.html#caller_extframe:164"><span class="id" title="variable">caller_extframe</span></a>.(<a class="idref" href="EraVM.CallStack.html#ecf_associated"><span class="id" title="projection">ecf_associated</span></a>) <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ecf_context_u128_value"><span class="id" title="projection">ecf_context_u128_value</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#select_ctx"><span class="id" title="definition">select_ctx</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.type"><span class="id" title="variable">type</span></a> <a class="idref" href="EraVM.sem.Farcall.html#reg_context_u128:149"><span class="id" title="variable">reg_context_u128</span></a> <a class="idref" href="EraVM.sem.Farcall.html#caller_extframe:164"><span class="id" title="variable">caller_extframe</span></a>.(<a class="idref" href="EraVM.CallStack.html#ecf_context_u128_value"><span class="id" title="projection">ecf_context_u128_value</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ecf_shards"><span class="id" title="projection">ecf_shards</span></a>             := <a class="idref" href="EraVM.sem.Farcall.html#select_shards"><span class="id" title="definition">select_shards</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.type"><span class="id" title="variable">type</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.is_shard_provided"><span class="id" title="variable">is_shard_provided</span></a> <a class="idref" href="EraVM.sem.Farcall.html#abi_shard:154"><span class="id" title="variable">abi_shard</span></a> <a class="idref" href="EraVM.sem.Farcall.html#caller_extframe:164"><span class="id" title="variable">caller_extframe</span></a>.(<a class="idref" href="EraVM.CallStack.html#ecf_shards"><span class="id" title="projection">ecf_shards</span></a>);<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ecf_mem_ctx"><span class="id" title="projection">ecf_mem_ctx</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#new_mem_ctx:153"><span class="id" title="variable">new_mem_ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ecf_is_static"><span class="id" title="projection">ecf_is_static</span></a> :=  <a class="idref" href="EraVM.CallStack.html#ecf_is_static"><span class="id" title="projection">ecf_is_static</span></a> <a class="idref" href="EraVM.sem.Farcall.html#caller_extframe:164"><span class="id" title="variable">caller_extframe</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">||</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.is_static_call"><span class="id" title="variable">is_static_call</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#ecf_common"><span class="id" title="projection">ecf_common</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#cf_exception_handler_location"><span class="id" title="projection">cf_exception_handler_location</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.handler"><span class="id" title="variable">handler</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#cf_sp"><span class="id" title="projection">cf_sp</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#INITIAL_SP_ON_FAR_CALL"><span class="id" title="definition">INITIAL_SP_ON_FAR_CALL</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#cf_pc"><span class="id" title="projection">cf_pc</span></a> := <a class="idref" href="EraVM.Types.html#zero16"><span class="id" title="definition">zero16</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#cf_ergs_remaining"><span class="id" title="projection">cf_ergs_remaining</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#ergs_actual:156"><span class="id" title="variable">ergs_actual</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#cf_saved_checkpoint"><span class="id" title="projection">cf_saved_checkpoint</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>.(<a class="idref" href="EraVM.State.html#gs_revertable"><span class="id" title="projection">gs_revertable</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|} (<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="EraVM.sem.Farcall.html#new_caller_stack:147"><span class="id" title="variable">new_caller_stack</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="EraVM.sem.Farcall.html#new_regs:146"><span class="id" title="variable">new_regs</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.sem.Farcall.html#regs_effect"><span class="id" title="definition">regs_effect</span></a> <a class="idref" href="EraVM.sem.Farcall.html#old_regs:141"><span class="id" title="variable">old_regs</span></a> <a class="idref" href="EraVM.sem.Farcall.html#is_system:161"><span class="id" title="variable">is_system</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<a class="idref" href="EraVM.Pointer.html#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="EraVM.sem.Farcall.html#out_ptr:158"><span class="id" title="variable">out_ptr</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#farcall:114"><span class="id" title="inductive">farcall</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="EraVM.PrimitiveValue.html#IntValue"><span class="id" title="abbreviation">IntValue</span></a> {|<br/>
<a class="idref" href="EraVM.ABI.FarCallABI.html#fwd_memory"><span class="id" title="projection">FarCallABI.fwd_memory</span></a>   := <a class="idref" href="EraVM.MemoryManagement.html#ForwardNewFatPointer"><span class="id" title="constructor">ForwardNewFatPointer</span></a> <a class="idref" href="EraVM.sem.Farcall.html#page_type:160"><span class="id" title="variable">page_type</span></a> <a class="idref" href="EraVM.sem.Farcall.html#in_span:159"><span class="id" title="variable">in_span</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#ergs_passed"><span class="id" title="projection">ergs_passed</span></a>          := <a class="idref" href="EraVM.sem.Farcall.html#ergs_query:155"><span class="id" title="variable">ergs_query</span></a>;<br/>
<a class="idref" href="EraVM.ABI.FarCallABI.html#shard_id"><span class="id" title="projection">FarCallABI.shard_id</span></a>     := <a class="idref" href="EraVM.sem.Farcall.html#abi_shard:154"><span class="id" title="variable">abi_shard</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#constructor_call"><span class="id" title="projection">constructor_call</span></a>     := <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#to_system"><span class="id" title="projection">to_system</span></a>            := <a class="idref" href="EraVM.sem.Farcall.html#is_syscall_query:157"><span class="id" title="variable">is_syscall_query</span></a>;<br/>
<span class="comment">(*!*)</span>   |})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="EraVM.sem.Farcall.html#flags:140"><span class="id" title="variable">flags</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="EraVM.sem.Farcall.html#old_regs:141"><span class="id" title="variable">old_regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="EraVM.sem.Farcall.html#old_pages:142"><span class="id" title="variable">old_pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="EraVM.sem.Farcall.html#cs0:143"><span class="id" title="variable">cs0</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="EraVM.sem.Farcall.html#reg_context_u128:149"><span class="id" title="variable">reg_context_u128</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="EraVM.VMPanic.html#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="EraVM.Flags.html#flags_clear"><span class="id" title="definition">flags_clear</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="EraVM.sem.Farcall.html#new_regs:146"><span class="id" title="variable">new_regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="EraVM.sem.Farcall.html#new_pages:150"><span class="id" title="variable">new_pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="EraVM.sem.Farcall.html#new_stack:148"><span class="id" title="variable">new_stack</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="EraVM.Types.html#zero128"><span class="id" title="definition">zero128</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.State.html#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="EraVM.VMPanic.html#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
</div>

<div class="doc"><h2 id="affected-parts-of-vm-state">Affected parts of VM state</h2>
<ul>
<li>flags are cleared</li>
<li>registers are affected as described by <span
class="inlinecode"><a class="idref" href="EraVM.sem.Farcall.html#regs_effect"><span
class="id" title="definition">regs_effect</span></a></span>.</li>
<li>new pages appear as described by <span
class="inlinecode"><a class="idref" href="EraVM.sem.Farcall.html#alloc_pages_extframe"><span
class="id"
title="inductive">alloc_pages_extframe</span></a></span>.</li>
<li>context register is zeroed.</li>
<li>execution stack is affected in a non-trivial way (see step 10 in
description for <span
class="inlinecode"><a class="idref" href="EraVM.sem.Farcall.html#farcall"><span
class="id" title="inductive">farcall</span></a></span>).</li>
</ul>
<h2 id="comparison-with-near-calls">Comparison with near calls</h2>
<ul>
<li>Far calls can not accept more than <span
class="inlinecode"><a class="idref" href="EraVM.sem.Farcall.html#max_passable"><span
class="id" title="definition">max_passable</span></a></span> ergs, while
near calls may accept all available ergs.</li>
<li>Abnormal returns from far calls through <span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpPanic"><span
class="id" title="constructor">OpPanic</span></a></span> or <span
class="inlinecode"><a class="idref" href="EraVM.isa.GeneratedMachISA.html#OpRevert"><span
class="id" title="constructor">OpRevert</span></a></span> roll back all
storage changes that occured during the contract execution.</li>
</ul>
<p>This includes exceptional situations when an error occured and the
current instruction is masked as <span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpPanic"><span
class="id" title="constructor">OpPanic</span></a></span>.</p>
<h2 id="usage">Usage</h2>
<ul>
<li>Calling other contracts</li>
<li>Calling precompiles Usually we call a system contract with assigned
precompile. It prepares data for a precompile, performs precompile call,
and returns the result.</li>
</ul>
<h2 id="encoding">Encoding</h2>
<ul>
<li>In the encoding, <span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span>, <span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpFarCall"><span
class="id" title="constructor">OpFarCall</span></a></span>, and <span
class="inlinecode"><a class="idref" href="EraVM.isa.Assembly.html#OpMimicCall"><span
class="id" title="constructor">OpMimicCall</span></a></span> share the
same opcode.</li>
</ul>
<h1 id="panics">Panics</h1>
<ol type="1">
<li>Attempting to pass an existing <span
class="inlinecode"><a class="idref" href="EraVM.Pointer.html#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span>, but the passed
value is not tagged as a pointer.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="farcall_fwd_existing_fatptr_notag" class="idref" href="#farcall_fwd_existing_fatptr_notag"><span class="id" title="constructor">farcall_fwd_existing_fatptr_notag</span></a>: <span class="id" title="keyword">∀</span> (<a id="ts1:166" class="idref" href="#ts1:166"><span class="id" title="binder">ts1</span></a> <a id="ts2:167" class="idref" href="#ts2:167"><span class="id" title="binder">ts2</span></a>:<a class="idref" href="EraVM.State.html#transient_state"><span class="id" title="record">transient_state</span></a>) <a id="___0:168" class="idref" href="#___0:168"><span class="id" title="binder">___0</span></a> <a id="___1:169" class="idref" href="#___1:169"><span class="id" title="binder">___1</span></a> <a id="___2:170" class="idref" href="#___2:170"><span class="id" title="binder">___2</span></a> <a id="___3:171" class="idref" href="#___3:171"><span class="id" title="binder">___3</span></a> <a id="___4:172" class="idref" href="#___4:172"><span class="id" title="binder">___4</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#ts2:167"><span class="id" title="variable">ts2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ts1:166"><span class="id" title="variable">ts1</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="EraVM.State.html#gs_status"><span class="id" title="projection">gs_status</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="EraVM.VMPanic.html#Panic"><span class="id" title="constructor">Panic</span></a> <a class="idref" href="EraVM.VMPanic.html#FarCallInputIsNotPointerWhenExpected"><span class="id" title="constructor">FarCallInputIsNotPointerWhenExpected</span></a> <span class="id" title="notation">|></span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#farcall:114"><span class="id" title="inductive">farcall</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="EraVM.PrimitiveValue.html#IntValue"><span class="id" title="abbreviation">IntValue</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#fwd_memory"><span class="id" title="projection">FarCallABI.fwd_memory</span></a>   := <a class="idref" href="EraVM.MemoryManagement.html#ForwardExistingFatPointer"><span class="id" title="constructor">ForwardExistingFatPointer</span></a> <a class="idref" href="EraVM.sem.Farcall.html#___0:168"><span class="id" title="variable">___0</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#ergs_passed"><span class="id" title="projection">ergs_passed</span></a>          := <a class="idref" href="EraVM.sem.Farcall.html#___1:169"><span class="id" title="variable">___1</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#shard_id"><span class="id" title="projection">FarCallABI.shard_id</span></a>     := <a class="idref" href="EraVM.sem.Farcall.html#___2:170"><span class="id" title="variable">___2</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#constructor_call"><span class="id" title="projection">constructor_call</span></a>     := <a class="idref" href="EraVM.sem.Farcall.html#___3:171"><span class="id" title="variable">___3</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#to_system"><span class="id" title="projection">to_system</span></a>            := <a class="idref" href="EraVM.sem.Farcall.html#___4:172"><span class="id" title="variable">___4</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}) <a class="idref" href="EraVM.sem.Farcall.html#ts1:166"><span class="id" title="variable">ts1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ts2:167"><span class="id" title="variable">ts2</span></a><br/>
</div>

<div class="doc"><ol start="2" type="1">
<li>The hash for the contract code (stored in the storage of <span
class="inlinecode"><a class="idref" href="EraVM.Decommitter.html#DEPLOYER_SYSTEM_CONTRACT_ADDRESS"><span
class="id"
title="definition">DEPLOYER_SYSTEM_CONTRACT_ADDRESS</span></a></span>)
is malformed.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="farcall_malformed_decommitment_hash" class="idref" href="#farcall_malformed_decommitment_hash"><span class="id" title="constructor">farcall_malformed_decommitment_hash</span></a>:  <span class="id" title="keyword">∀</span> <a id="cs0:173" class="idref" href="#cs0:173"><span class="id" title="binder">cs0</span></a> <a id="abi_shard:174" class="idref" href="#abi_shard:174"><span class="id" title="binder">abi_shard</span></a> <a id="is_syscall_query:175" class="idref" href="#is_syscall_query:175"><span class="id" title="binder">is_syscall_query</span></a> <a id="ts1:176" class="idref" href="#ts1:176"><span class="id" title="binder">ts1</span></a> <a id="ts2:177" class="idref" href="#ts2:177"><span class="id" title="binder">ts2</span></a> <a id="___1:178" class="idref" href="#___1:178"><span class="id" title="binder">___1</span></a> <a id="___2:179" class="idref" href="#___2:179"><span class="id" title="binder">___2</span></a> <a id="___3:180" class="idref" href="#___3:180"><span class="id" title="binder">___3</span></a> <a id="___4:181" class="idref" href="#___4:181"><span class="id" title="binder">___4</span></a> <a id="_tag:182" class="idref" href="#_tag:182"><span class="id" title="binder">_tag</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="is_system:183" class="idref" href="#is_system:183"><span class="id" title="binder">is_system</span></a> := <a class="idref" href="EraVM.KernelMode.html#addr_is_kernel"><span class="id" title="definition">addr_is_kernel</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a> <a class="idref" href="EraVM.sem.Farcall.html#is_syscall_query:175"><span class="id" title="variable">is_syscall_query</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="allow_masking:184" class="idref" href="#allow_masking:184"><span class="id" title="binder">allow_masking</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#negb"><span class="id" title="definition">negb</span></a> <a class="idref" href="EraVM.sem.Farcall.html#is_system:183"><span class="id" title="variable">is_system</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="callee_shard:185" class="idref" href="#callee_shard:185"><span class="id" title="binder">callee_shard</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.is_shard_provided"><span class="id" title="variable">is_shard_provided</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="EraVM.sem.Farcall.html#abi_shard:174"><span class="id" title="variable">abi_shard</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="EraVM.CallStack.html#current_shard"><span class="id" title="definition">current_shard</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs0:173"><span class="id" title="variable">cs0</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#paid_code_fetch"><span class="id" title="inductive">paid_code_fetch</span></a> <a class="idref" href="EraVM.sem.Farcall.html#allow_masking:184"><span class="id" title="variable">allow_masking</span></a> <a class="idref" href="EraVM.sem.Farcall.html#callee_shard:185"><span class="id" title="variable">callee_shard</span></a> (<a class="idref" href="EraVM.State.html#gs_depot"><span class="id" title="projection">gs_depot</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>) (<a class="idref" href="EraVM.State.html#gs_contracts"><span class="id" title="projection">gs_contracts</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>) <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs0:173"><span class="id" title="variable">cs0</span></a> (<a class="idref" href="EraVM.sem.Farcall.html#CodeFetchInvalidVerisonedHashFormat"><span class="id" title="constructor">CodeFetchInvalidVerisonedHashFormat</span></a> <a class="idref" href="EraVM.sem.Farcall.html#___4:181"><span class="id" title="variable">___4</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#ts2:177"><span class="id" title="variable">ts2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ts1:176"><span class="id" title="variable">ts1</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="EraVM.State.html#gs_status"><span class="id" title="projection">gs_status</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="EraVM.VMPanic.html#Panic"><span class="id" title="constructor">Panic</span></a> <a class="idref" href="EraVM.VMPanic.html#FarCallInvalidCodeHashFormat"><span class="id" title="constructor">FarCallInvalidCodeHashFormat</span></a> <span class="id" title="notation">|></span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#farcall:114"><span class="id" title="inductive">farcall</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="EraVM.PrimitiveValue.html#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="EraVM.sem.Farcall.html#_tag:182"><span class="id" title="variable">_tag</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#fwd_memory"><span class="id" title="projection">FarCallABI.fwd_memory</span></a>   := <a class="idref" href="EraVM.sem.Farcall.html#___1:178"><span class="id" title="variable">___1</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#ergs_passed"><span class="id" title="projection">ergs_passed</span></a>          := <a class="idref" href="EraVM.sem.Farcall.html#___2:179"><span class="id" title="variable">___2</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#shard_id"><span class="id" title="projection">FarCallABI.shard_id</span></a>     := <a class="idref" href="EraVM.sem.Farcall.html#abi_shard:174"><span class="id" title="variable">abi_shard</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#constructor_call"><span class="id" title="projection">constructor_call</span></a>     := <a class="idref" href="EraVM.sem.Farcall.html#___3:180"><span class="id" title="variable">___3</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#to_system"><span class="id" title="projection">to_system</span></a>            := <a class="idref" href="EraVM.sem.Farcall.html#is_syscall_query:175"><span class="id" title="variable">is_syscall_query</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#ts1:176"><span class="id" title="variable">ts1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ts2:177"><span class="id" title="variable">ts2</span></a><br/>
</div>

<div class="doc"><ol start="3" type="1">
<li>Not enough ergs to pay for code decommitment.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="farcall_decommitment_unaffordable" class="idref" href="#farcall_decommitment_unaffordable"><span class="id" title="constructor">farcall_decommitment_unaffordable</span></a>:  <span class="id" title="keyword">∀</span> <a id="cs0:186" class="idref" href="#cs0:186"><span class="id" title="binder">cs0</span></a> <a id="abi_shard:187" class="idref" href="#abi_shard:187"><span class="id" title="binder">abi_shard</span></a> <a id="is_syscall_query:188" class="idref" href="#is_syscall_query:188"><span class="id" title="binder">is_syscall_query</span></a> <a id="ts1:189" class="idref" href="#ts1:189"><span class="id" title="binder">ts1</span></a> <a id="ts2:190" class="idref" href="#ts2:190"><span class="id" title="binder">ts2</span></a>  <a id="___1:191" class="idref" href="#___1:191"><span class="id" title="binder">___1</span></a> <a id="___2:192" class="idref" href="#___2:192"><span class="id" title="binder">___2</span></a> <a id="___3:193" class="idref" href="#___3:193"><span class="id" title="binder">___3</span></a> <a id="___4:194" class="idref" href="#___4:194"><span class="id" title="binder">___4</span></a> <a id="_tag:195" class="idref" href="#_tag:195"><span class="id" title="binder">_tag</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="is_system:196" class="idref" href="#is_system:196"><span class="id" title="binder">is_system</span></a> := <a class="idref" href="EraVM.KernelMode.html#addr_is_kernel"><span class="id" title="definition">addr_is_kernel</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a> <a class="idref" href="EraVM.sem.Farcall.html#is_syscall_query:188"><span class="id" title="variable">is_syscall_query</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="allow_masking:197" class="idref" href="#allow_masking:197"><span class="id" title="binder">allow_masking</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#negb"><span class="id" title="definition">negb</span></a> <a class="idref" href="EraVM.sem.Farcall.html#is_system:196"><span class="id" title="variable">is_system</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="callee_shard:198" class="idref" href="#callee_shard:198"><span class="id" title="binder">callee_shard</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.is_shard_provided"><span class="id" title="variable">is_shard_provided</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="EraVM.sem.Farcall.html#abi_shard:187"><span class="id" title="variable">abi_shard</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="EraVM.CallStack.html#current_shard"><span class="id" title="definition">current_shard</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs0:186"><span class="id" title="variable">cs0</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#paid_code_fetch"><span class="id" title="inductive">paid_code_fetch</span></a> <a class="idref" href="EraVM.sem.Farcall.html#allow_masking:197"><span class="id" title="variable">allow_masking</span></a> <a class="idref" href="EraVM.sem.Farcall.html#callee_shard:198"><span class="id" title="variable">callee_shard</span></a> (<a class="idref" href="EraVM.State.html#gs_depot"><span class="id" title="projection">gs_depot</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>) (<a class="idref" href="EraVM.State.html#gs_contracts"><span class="id" title="projection">gs_contracts</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>) <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs0:186"><span class="id" title="variable">cs0</span></a> (<a class="idref" href="EraVM.sem.Farcall.html#CodeFetchUnaffordable"><span class="id" title="constructor">CodeFetchUnaffordable</span></a> <a class="idref" href="EraVM.sem.Farcall.html#___1:191"><span class="id" title="variable">___1</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#cs0:186"><span class="id" title="variable">cs0</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.State.html#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ts1:189"><span class="id" title="variable">ts1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#ts2:190"><span class="id" title="variable">ts2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ts1:189"><span class="id" title="variable">ts1</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="EraVM.State.html#gs_status"><span class="id" title="projection">gs_status</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="EraVM.VMPanic.html#Panic"><span class="id" title="constructor">Panic</span></a> <a class="idref" href="EraVM.VMPanic.html#FarCallNotEnoughErgsToDecommit"><span class="id" title="constructor">FarCallNotEnoughErgsToDecommit</span></a> <span class="id" title="notation">|></span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#farcall:114"><span class="id" title="inductive">farcall</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="EraVM.PrimitiveValue.html#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="EraVM.sem.Farcall.html#_tag:195"><span class="id" title="variable">_tag</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#fwd_memory"><span class="id" title="projection">FarCallABI.fwd_memory</span></a>   := <a class="idref" href="EraVM.sem.Farcall.html#___2:192"><span class="id" title="variable">___2</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#ergs_passed"><span class="id" title="projection">ergs_passed</span></a>          := <a class="idref" href="EraVM.sem.Farcall.html#___3:193"><span class="id" title="variable">___3</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#shard_id"><span class="id" title="projection">FarCallABI.shard_id</span></a>     := <a class="idref" href="EraVM.sem.Farcall.html#abi_shard:187"><span class="id" title="variable">abi_shard</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#constructor_call"><span class="id" title="projection">constructor_call</span></a>     := <a class="idref" href="EraVM.sem.Farcall.html#___4:194"><span class="id" title="variable">___4</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#to_system"><span class="id" title="projection">to_system</span></a>            := <a class="idref" href="EraVM.sem.Farcall.html#is_syscall_query:188"><span class="id" title="variable">is_syscall_query</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#ts1:189"><span class="id" title="variable">ts1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ts2:190"><span class="id" title="variable">ts2</span></a><br/>
</div>

<div class="doc"><ol start="4" type="1">
<li>Paid for decommitment; Returning a new fat pointer, but not enough
ergs to pay for memory growth.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="farcall_fwd_new_ptr_growth_unaffordable" class="idref" href="#farcall_fwd_new_ptr_growth_unaffordable"><span class="id" title="constructor">farcall_fwd_new_ptr_growth_unaffordable</span></a>: <span class="id" title="keyword">∀</span> <a id="cs0:199" class="idref" href="#cs0:199"><span class="id" title="binder">cs0</span></a> <a id="cs1:200" class="idref" href="#cs1:200"><span class="id" title="binder">cs1</span></a> <a id="___1:201" class="idref" href="#___1:201"><span class="id" title="binder">___1</span></a> <a id="___2:202" class="idref" href="#___2:202"><span class="id" title="binder">___2</span></a> <a id="abi_shard:203" class="idref" href="#abi_shard:203"><span class="id" title="binder">abi_shard</span></a> <a id="ergs_query:204" class="idref" href="#ergs_query:204"><span class="id" title="binder">ergs_query</span></a> <a id="is_syscall_query:205" class="idref" href="#is_syscall_query:205"><span class="id" title="binder">is_syscall_query</span></a> <a id="in_span:206" class="idref" href="#in_span:206"><span class="id" title="binder">in_span</span></a> <a id="page_type:207" class="idref" href="#page_type:207"><span class="id" title="binder">page_type</span></a> <a id="bound:208" class="idref" href="#bound:208"><span class="id" title="binder">bound</span></a> <a id="growth_query:209" class="idref" href="#growth_query:209"><span class="id" title="binder">growth_query</span></a> <a id="ts1:210" class="idref" href="#ts1:210"><span class="id" title="binder">ts1</span></a> <a id="ts2:211" class="idref" href="#ts2:211"><span class="id" title="binder">ts2</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="is_system:212" class="idref" href="#is_system:212"><span class="id" title="binder">is_system</span></a> := <a class="idref" href="EraVM.KernelMode.html#addr_is_kernel"><span class="id" title="definition">addr_is_kernel</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a> <a class="idref" href="EraVM.sem.Farcall.html#is_syscall_query:205"><span class="id" title="variable">is_syscall_query</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="allow_masking:213" class="idref" href="#allow_masking:213"><span class="id" title="binder">allow_masking</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#negb"><span class="id" title="definition">negb</span></a> <a class="idref" href="EraVM.sem.Farcall.html#is_system:212"><span class="id" title="variable">is_system</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="callee_shard:214" class="idref" href="#callee_shard:214"><span class="id" title="binder">callee_shard</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.is_shard_provided"><span class="id" title="variable">is_shard_provided</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="EraVM.sem.Farcall.html#abi_shard:203"><span class="id" title="variable">abi_shard</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="EraVM.CallStack.html#current_shard"><span class="id" title="definition">current_shard</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs0:199"><span class="id" title="variable">cs0</span></a> <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#paid_code_fetch"><span class="id" title="inductive">paid_code_fetch</span></a> <a class="idref" href="EraVM.sem.Farcall.html#allow_masking:213"><span class="id" title="variable">allow_masking</span></a> <a class="idref" href="EraVM.sem.Farcall.html#callee_shard:214"><span class="id" title="variable">callee_shard</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>.(<a class="idref" href="EraVM.State.html#gs_revertable"><span class="id" title="projection">gs_revertable</span></a>).(<a class="idref" href="EraVM.State.html#gs_depot"><span class="id" title="projection">gs_depot</span></a>) <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>.(<a class="idref" href="EraVM.State.html#gs_contracts"><span class="id" title="projection">gs_contracts</span></a>) <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs0:199"><span class="id" title="variable">cs0</span></a> (<a class="idref" href="EraVM.sem.Farcall.html#Fetched"><span class="id" title="constructor">Fetched</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs1:200"><span class="id" title="variable">cs1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#___1:201"><span class="id" title="variable">___1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#___2:202"><span class="id" title="variable">___2</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.Pointer.html#bound_of_span"><span class="id" title="inductive">bound_of_span</span></a> <a class="idref" href="EraVM.sem.Farcall.html#in_span:206"><span class="id" title="variable">in_span</span></a> <a class="idref" href="EraVM.sem.Farcall.html#page_type:207"><span class="id" title="variable">page_type</span></a> <a class="idref" href="EraVM.sem.Farcall.html#bound:208"><span class="id" title="variable">bound</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.MemoryManagement.html#growth_to_bound"><span class="id" title="inductive">growth_to_bound</span></a> <a class="idref" href="EraVM.sem.Farcall.html#bound:208"><span class="id" title="variable">bound</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs1:200"><span class="id" title="variable">cs1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#growth_query:209"><span class="id" title="variable">growth_query</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.CallStack.html#affordable"><span class="id" title="definition">affordable</span></a> <a class="idref" href="EraVM.sem.Farcall.html#cs1:200"><span class="id" title="variable">cs1</span></a> (<a class="idref" href="EraVM.MemoryManagement.html#cost_of_growth"><span class="id" title="definition">cost_of_growth</span></a> <a class="idref" href="EraVM.sem.Farcall.html#growth_query:209"><span class="id" title="variable">growth_query</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#cs0:199"><span class="id" title="variable">cs0</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.State.html#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ts1:210"><span class="id" title="variable">ts1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#ts2:211"><span class="id" title="variable">ts2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ts1:210"><span class="id" title="variable">ts1</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="EraVM.State.html#gs_status"><span class="id" title="projection">gs_status</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="EraVM.VMPanic.html#Panic"><span class="id" title="constructor">Panic</span></a> <a class="idref" href="EraVM.VMPanic.html#FarCallNotEnoughErgsToGrowMemory"><span class="id" title="constructor">FarCallNotEnoughErgsToGrowMemory</span></a> <span class="id" title="notation">|></span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#farcall:114"><span class="id" title="inductive">farcall</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="EraVM.PrimitiveValue.html#IntValue"><span class="id" title="abbreviation">IntValue</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#fwd_memory"><span class="id" title="projection">FarCallABI.fwd_memory</span></a>   := <a class="idref" href="EraVM.MemoryManagement.html#ForwardNewFatPointer"><span class="id" title="constructor">ForwardNewFatPointer</span></a> <a class="idref" href="EraVM.sem.Farcall.html#page_type:207"><span class="id" title="variable">page_type</span></a> <a class="idref" href="EraVM.sem.Farcall.html#in_span:206"><span class="id" title="variable">in_span</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#ergs_passed"><span class="id" title="projection">ergs_passed</span></a>          := <a class="idref" href="EraVM.sem.Farcall.html#ergs_query:204"><span class="id" title="variable">ergs_query</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#shard_id"><span class="id" title="projection">FarCallABI.shard_id</span></a>     := <a class="idref" href="EraVM.sem.Farcall.html#abi_shard:203"><span class="id" title="variable">abi_shard</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#constructor_call"><span class="id" title="projection">constructor_call</span></a>     := <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.ABI.FarCallABI.html#to_system"><span class="id" title="projection">to_system</span></a>            := <a class="idref" href="EraVM.sem.Farcall.html#is_syscall_query:205"><span class="id" title="variable">is_syscall_query</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#ts1:210"><span class="id" title="variable">ts1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ts2:211"><span class="id" title="variable">ts2</span></a><br/>
&nbsp;&nbsp;.<br/>
</div>

<div class="doc"><h2 id="not-formalized">Not formalized</h2>
<ul>
<li>system contracts + constructor calls + “call in now constructed
system contract” exception</li>
</ul>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="EraVM.sem.Farcall.html#FarCallDefinitions"><span class="id" title="section">FarCallDefinitions</span></a>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <a id="step_farcall" class="idref" href="#step_farcall"><span class="id" title="inductive">step_farcall</span></a> : <a class="idref" href="EraVM.isa.CoreSet.html#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="EraVM.Steps.html#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
<br/>
| <a id="step_farcall_normal" class="idref" href="#step_farcall_normal"><span class="id" title="constructor">step_farcall_normal</span></a>: <span class="id" title="keyword">∀</span> <a id="handler:217" class="idref" href="#handler:217"><span class="id" title="binder">handler</span></a> <a id="pv_abi:218" class="idref" href="#pv_abi:218"><span class="id" title="binder">pv_abi</span></a> (<a id="dest:219" class="idref" href="#dest:219"><span class="id" title="binder">dest</span></a>:<a class="idref" href="EraVM.Core.html#word"><span class="id" title="definition">word</span></a>) <a id="call_shard:220" class="idref" href="#call_shard:220"><span class="id" title="binder">call_shard</span></a> <a id="call_as_static:221" class="idref" href="#call_as_static:221"><span class="id" title="binder">call_as_static</span></a> <a id="s1:222" class="idref" href="#s1:222"><span class="id" title="binder">s1</span></a> <a id="s2:223" class="idref" href="#s2:223"><span class="id" title="binder">s2</span></a> <a id="ts1:224" class="idref" href="#ts1:224"><span class="id" title="binder">ts1</span></a> <a id="ts2:225" class="idref" href="#ts2:225"><span class="id" title="binder">ts2</span></a> (<a id="__:226" class="idref" href="#__:226"><span class="id" title="binder">__</span></a>:<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>),<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="dest_addr:227" class="idref" href="#dest_addr:227"><span class="id" title="binder">dest_addr</span></a> := <span class="id" title="definition">low</span> <a class="idref" href="EraVM.memory.Depot.html#contract_address_bits"><span class="id" title="definition">contract_address_bits</span></a> <a class="idref" href="EraVM.sem.Farcall.html#dest:219"><span class="id" title="variable">dest</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="handler_code_addr:228" class="idref" href="#handler_code_addr:228"><span class="id" title="binder">handler_code_addr</span></a> := <span class="id" title="definition">low</span> <a class="idref" href="EraVM.memory.PageTypes.html#code_address_bits"><span class="id" title="definition">code_address_bits</span></a> <a class="idref" href="EraVM.sem.Farcall.html#handler:217"><span class="id" title="variable">handler</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#farcall"><span class="id" title="inductive">farcall</span></a> <a class="idref" href="EraVM.sem.Farcall.html#Normal"><span class="id" title="constructor">Normal</span></a> <a class="idref" href="EraVM.sem.Farcall.html#call_as_static:221"><span class="id" title="variable">call_as_static</span></a> <a class="idref" href="EraVM.sem.Farcall.html#call_shard:220"><span class="id" title="variable">call_shard</span></a> <a class="idref" href="EraVM.sem.Farcall.html#dest_addr:227"><span class="id" title="variable">dest_addr</span></a> <a class="idref" href="EraVM.sem.Farcall.html#handler_code_addr:228"><span class="id" title="variable">handler_code_addr</span></a> <a class="idref" href="EraVM.sem.Farcall.html#s1:222"><span class="id" title="variable">s1</span></a>.(<a class="idref" href="EraVM.State.html#gs_global"><span class="id" title="projection">gs_global</span></a>) <a class="idref" href="EraVM.sem.Farcall.html#pv_abi:218"><span class="id" title="variable">pv_abi</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ts1:224"><span class="id" title="variable">ts1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ts2:225"><span class="id" title="variable">ts2</span></a>  <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.Steps.html#step_transient_only"><span class="id" title="inductive">step_transient_only</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ts1:224"><span class="id" title="variable">ts1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ts2:225"><span class="id" title="variable">ts2</span></a> <a class="idref" href="EraVM.sem.Farcall.html#s1:222"><span class="id" title="variable">s1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#s2:223"><span class="id" title="variable">s2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#step_farcall:215"><span class="id" title="inductive">step_farcall</span></a> (<a class="idref" href="EraVM.isa.CoreSet.html#OpFarCall"><span class="id" title="constructor">OpFarCall</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="EraVM.sem.Farcall.html#pv_abi:218"><span class="id" title="variable">pv_abi</span></a>) (<a class="idref" href="EraVM.PrimitiveValue.html#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="EraVM.sem.Farcall.html#__:226"><span class="id" title="variable">__</span></a> <a class="idref" href="EraVM.sem.Farcall.html#dest:219"><span class="id" title="variable">dest</span></a>) <a class="idref" href="EraVM.sem.Farcall.html#handler:217"><span class="id" title="variable">handler</span></a> <a class="idref" href="EraVM.sem.Farcall.html#call_shard:220"><span class="id" title="variable">call_shard</span></a> <a class="idref" href="EraVM.sem.Farcall.html#call_as_static:221"><span class="id" title="variable">call_as_static</span></a>) <a class="idref" href="EraVM.sem.Farcall.html#s1:222"><span class="id" title="variable">s1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#s2:223"><span class="id" title="variable">s2</span></a><br/>
| <a id="step_farcall_mimic" class="idref" href="#step_farcall_mimic"><span class="id" title="constructor">step_farcall_mimic</span></a>: <span class="id" title="keyword">∀</span> <a id="handler:229" class="idref" href="#handler:229"><span class="id" title="binder">handler</span></a> <a id="pv_abi:230" class="idref" href="#pv_abi:230"><span class="id" title="binder">pv_abi</span></a> (<a id="dest:231" class="idref" href="#dest:231"><span class="id" title="binder">dest</span></a>:<a class="idref" href="EraVM.Core.html#word"><span class="id" title="definition">word</span></a>) <a id="call_shard:232" class="idref" href="#call_shard:232"><span class="id" title="binder">call_shard</span></a> <a id="call_as_static:233" class="idref" href="#call_as_static:233"><span class="id" title="binder">call_as_static</span></a> <a id="s1:234" class="idref" href="#s1:234"><span class="id" title="binder">s1</span></a> <a id="s2:235" class="idref" href="#s2:235"><span class="id" title="binder">s2</span></a> <a id="ts1:236" class="idref" href="#ts1:236"><span class="id" title="binder">ts1</span></a> <a id="ts2:237" class="idref" href="#ts2:237"><span class="id" title="binder">ts2</span></a> (<a id="__:238" class="idref" href="#__:238"><span class="id" title="binder">__</span></a>:<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>),<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="dest_addr:239" class="idref" href="#dest_addr:239"><span class="id" title="binder">dest_addr</span></a> := <span class="id" title="definition">low</span> <a class="idref" href="EraVM.memory.Depot.html#contract_address_bits"><span class="id" title="definition">contract_address_bits</span></a> <a class="idref" href="EraVM.sem.Farcall.html#dest:231"><span class="id" title="variable">dest</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="handler_code_addr:240" class="idref" href="#handler_code_addr:240"><span class="id" title="binder">handler_code_addr</span></a> := <span class="id" title="definition">low</span> <a class="idref" href="EraVM.memory.PageTypes.html#code_address_bits"><span class="id" title="definition">code_address_bits</span></a> <a class="idref" href="EraVM.sem.Farcall.html#handler:229"><span class="id" title="variable">handler</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#farcall"><span class="id" title="inductive">farcall</span></a> <a class="idref" href="EraVM.sem.Farcall.html#Mimic"><span class="id" title="constructor">Mimic</span></a> <a class="idref" href="EraVM.sem.Farcall.html#call_as_static:233"><span class="id" title="variable">call_as_static</span></a> <a class="idref" href="EraVM.sem.Farcall.html#call_shard:232"><span class="id" title="variable">call_shard</span></a> <a class="idref" href="EraVM.sem.Farcall.html#dest_addr:239"><span class="id" title="variable">dest_addr</span></a> <a class="idref" href="EraVM.sem.Farcall.html#handler_code_addr:240"><span class="id" title="variable">handler_code_addr</span></a> <a class="idref" href="EraVM.sem.Farcall.html#s1:234"><span class="id" title="variable">s1</span></a>.(<a class="idref" href="EraVM.State.html#gs_global"><span class="id" title="projection">gs_global</span></a>) <a class="idref" href="EraVM.sem.Farcall.html#pv_abi:230"><span class="id" title="variable">pv_abi</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ts1:236"><span class="id" title="variable">ts1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ts2:237"><span class="id" title="variable">ts2</span></a>  <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.Steps.html#step_transient_only"><span class="id" title="inductive">step_transient_only</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ts1:236"><span class="id" title="variable">ts1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ts2:237"><span class="id" title="variable">ts2</span></a> <a class="idref" href="EraVM.sem.Farcall.html#s1:234"><span class="id" title="variable">s1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#s2:235"><span class="id" title="variable">s2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#step_farcall:215"><span class="id" title="inductive">step_farcall</span></a> (<a class="idref" href="EraVM.isa.CoreSet.html#OpMimicCall"><span class="id" title="constructor">OpMimicCall</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="EraVM.sem.Farcall.html#pv_abi:230"><span class="id" title="variable">pv_abi</span></a>) (<a class="idref" href="EraVM.PrimitiveValue.html#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="EraVM.sem.Farcall.html#__:238"><span class="id" title="variable">__</span></a> <a class="idref" href="EraVM.sem.Farcall.html#dest:231"><span class="id" title="variable">dest</span></a>) <a class="idref" href="EraVM.sem.Farcall.html#handler:229"><span class="id" title="variable">handler</span></a> <a class="idref" href="EraVM.sem.Farcall.html#call_shard:232"><span class="id" title="variable">call_shard</span></a> <a class="idref" href="EraVM.sem.Farcall.html#call_as_static:233"><span class="id" title="variable">call_as_static</span></a>) <a class="idref" href="EraVM.sem.Farcall.html#s1:234"><span class="id" title="variable">s1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#s2:235"><span class="id" title="variable">s2</span></a><br/>
| <a id="step_farcall_delegate" class="idref" href="#step_farcall_delegate"><span class="id" title="constructor">step_farcall_delegate</span></a>: <span class="id" title="keyword">∀</span> <a id="handler:241" class="idref" href="#handler:241"><span class="id" title="binder">handler</span></a> <a id="pv_abi:242" class="idref" href="#pv_abi:242"><span class="id" title="binder">pv_abi</span></a> (<a id="dest:243" class="idref" href="#dest:243"><span class="id" title="binder">dest</span></a>:<a class="idref" href="EraVM.Core.html#word"><span class="id" title="definition">word</span></a>) <a id="call_shard:244" class="idref" href="#call_shard:244"><span class="id" title="binder">call_shard</span></a> <a id="call_as_static:245" class="idref" href="#call_as_static:245"><span class="id" title="binder">call_as_static</span></a> <a id="s1:246" class="idref" href="#s1:246"><span class="id" title="binder">s1</span></a> <a id="s2:247" class="idref" href="#s2:247"><span class="id" title="binder">s2</span></a> <a id="ts1:248" class="idref" href="#ts1:248"><span class="id" title="binder">ts1</span></a> <a id="ts2:249" class="idref" href="#ts2:249"><span class="id" title="binder">ts2</span></a> (<a id="__:250" class="idref" href="#__:250"><span class="id" title="binder">__</span></a>:<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>),<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="dest_addr:251" class="idref" href="#dest_addr:251"><span class="id" title="binder">dest_addr</span></a> := <span class="id" title="definition">low</span> <a class="idref" href="EraVM.memory.Depot.html#contract_address_bits"><span class="id" title="definition">contract_address_bits</span></a> <a class="idref" href="EraVM.sem.Farcall.html#dest:243"><span class="id" title="variable">dest</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="handler_code_addr:252" class="idref" href="#handler_code_addr:252"><span class="id" title="binder">handler_code_addr</span></a> := <span class="id" title="definition">low</span> <a class="idref" href="EraVM.memory.PageTypes.html#code_address_bits"><span class="id" title="definition">code_address_bits</span></a> <a class="idref" href="EraVM.sem.Farcall.html#handler:241"><span class="id" title="variable">handler</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#farcall"><span class="id" title="inductive">farcall</span></a> <a class="idref" href="EraVM.sem.Farcall.html#Delegate"><span class="id" title="constructor">Delegate</span></a> <a class="idref" href="EraVM.sem.Farcall.html#call_as_static:245"><span class="id" title="variable">call_as_static</span></a> <a class="idref" href="EraVM.sem.Farcall.html#call_shard:244"><span class="id" title="variable">call_shard</span></a> <a class="idref" href="EraVM.sem.Farcall.html#dest_addr:251"><span class="id" title="variable">dest_addr</span></a> <a class="idref" href="EraVM.sem.Farcall.html#handler_code_addr:252"><span class="id" title="variable">handler_code_addr</span></a> <a class="idref" href="EraVM.sem.Farcall.html#s1:246"><span class="id" title="variable">s1</span></a>.(<a class="idref" href="EraVM.State.html#gs_global"><span class="id" title="projection">gs_global</span></a>) <a class="idref" href="EraVM.sem.Farcall.html#pv_abi:242"><span class="id" title="variable">pv_abi</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ts1:248"><span class="id" title="variable">ts1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ts2:249"><span class="id" title="variable">ts2</span></a>  <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.Steps.html#step_transient_only"><span class="id" title="inductive">step_transient_only</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ts1:248"><span class="id" title="variable">ts1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#ts2:249"><span class="id" title="variable">ts2</span></a> <a class="idref" href="EraVM.sem.Farcall.html#s1:246"><span class="id" title="variable">s1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#s2:247"><span class="id" title="variable">s2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Logic.html#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="EraVM.sem.Farcall.html#step_farcall:215"><span class="id" title="inductive">step_farcall</span></a> (<a class="idref" href="EraVM.isa.CoreSet.html#OpDelegateCall"><span class="id" title="constructor">OpDelegateCall</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18+alpha/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="EraVM.sem.Farcall.html#pv_abi:242"><span class="id" title="variable">pv_abi</span></a>) (<a class="idref" href="EraVM.PrimitiveValue.html#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="EraVM.sem.Farcall.html#__:250"><span class="id" title="variable">__</span></a> <a class="idref" href="EraVM.sem.Farcall.html#dest:243"><span class="id" title="variable">dest</span></a>) <a class="idref" href="EraVM.sem.Farcall.html#handler:241"><span class="id" title="variable">handler</span></a> <a class="idref" href="EraVM.sem.Farcall.html#call_shard:244"><span class="id" title="variable">call_shard</span></a> <a class="idref" href="EraVM.sem.Farcall.html#call_as_static:245"><span class="id" title="variable">call_as_static</span></a>) <a class="idref" href="EraVM.sem.Farcall.html#s1:246"><span class="id" title="variable">s1</span></a> <a class="idref" href="EraVM.sem.Farcall.html#s2:247"><span class="id" title="variable">s2</span></a><br/>
.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>