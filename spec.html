
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>EraVM ISA specification</title>

  <script defer=""
  src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <link rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css" />
</head>
<body>


<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.Introduction</h1>

<div class="code">
</div>

<div class="doc"><p>This is the specification of the instruction set of EraVM 1.4.1, a
language virtual machine for zkSync Era. It describes the virtual
machine’s architecture, instruction syntax and semantics, and some
elements of system protocol.</p>
<h1 id="table-of-contents">Table of contents</h1>
<ul>
<li><p><strong>Overview</strong></p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#Glossary"><span
class="id" title="section">Glossary</span></a></span> : a list of all
important recurring terms and notations defined in this document.</li>
<li><span
class="inlinecode"><a class="idref" href="#ArchOverview"><span
class="id" title="section">ArchOverview</span></a></span> : a bird’s eye
overview of EraVM architecture with links to more detailed descriptions
of its parts.</li>
<li><span
class="inlinecode"><a class="idref" href="#PrimitiveValue"><span
class="id" title="section">PrimitiveValue</span></a></span> : defines a
tagged 256-bit word datatype; can be an integer or a pointer.</li>
</ul></li>
<li><p><strong>EraVM Structure</strong></p>
<p><span
class="inlinecode"><a class="idref" href="#StateDefinitions"><span
class="id" title="section">StateDefinitions</span></a></span> collects
all system state, persistent and transient.</p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#Registers"><span
class="id" title="section">Registers</span></a></span> : a group of
isolated read/write memory cells available to all instructions.</li>
<li><span
class="inlinecode"><a class="idref" href="#Flags"><span
class="id" title="section">Flags</span></a></span> : special registers
showing the status of the latest computations.</li>
<li><span
class="inlinecode"><a class="idref" href="#Predication"><span
class="id" title="section">Predication</span></a></span> : how setting
flags makes EraVM skip of execute instructions.</li>
<li><span
class="inlinecode"><a class="idref" href="#Memory"><span
class="id" title="section">Memory</span></a></span> : transient memory
(heap, stack) for supporting computations and persistent storages of
contracts.</li>
<li><span
class="inlinecode"><a class="idref" href="#PointerDefinitions"><span
class="id" title="section">PointerDefinitions</span></a></span> :
definition of pointers to transient memory and operations on them.</li>
<li><span
class="inlinecode"><a class="idref" href="#Slices"><span
class="id" title="section">Slices</span></a></span> : how individual
pointers are restricted to selected subranges of memory addresses.</li>
<li><span
class="inlinecode"><a class="idref" href="#Callstack"><span
class="id" title="section">Callstack</span></a></span> : states of
running functions and contracts.</li>
<li><span
class="inlinecode"><a class="idref" href="#MemoryContext"><span
class="id" title="section">MemoryContext</span></a></span> : how new
transient memory is allocated when a contract is called.</li>
</ul></li>
<li><p><strong>Instruction Set</strong></p>
<ul>
<li><p><span
class="inlinecode"><a class="idref" href="#Addressing"><span
class="id" title="section">Addressing</span></a></span> : how
instructions can refer to their arguments.</p></li>
<li><p><span
class="inlinecode"><a class="idref" href="#AllResolution.Resolution"><span
class="id" title="section">Resolution</span></a></span> : how
instruction arguments are resolved to the operand values.</p></li>
<li><p><span
class="inlinecode"><a class="idref" href="#InstructionSets"><span
class="id" title="section">InstructionSets</span></a></span> : overview
of all layers of instruction set and their relations.</p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#Modifiers"><span
class="id" title="section">Modifiers</span></a></span> : recurring
modifiers supported by many instructions: <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span> and <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span>.</li>
<li><span
class="inlinecode"><a class="idref" href="#AssemblyInstructionSet"><span
class="id" title="section">AssemblyInstructionSet</span></a></span> :
<strong>instruction set exposed to assembly programmers</strong>.</li>
<li><span
class="inlinecode"><a class="idref" href="#CoreInstructionSet"><span
class="id" title="section">CoreInstructionSet</span></a></span> :
simplified instruction set used to define instruction semantic.</li>
<li><span
class="inlinecode"><a class="idref" href="#MachInstructionDefinition"><span
class="id" title="section">MachInstructionDefinition</span></a></span> :
layout of encoded assembly instructions.</li>
<li>Conversions between instruction sets: <span class="inlinecode"><span
class="id" title="var">asm_to_core</span></span> and <span
class="inlinecode"><a class="idref" href="#asm_to_mach"><span
class="id" title="definition">asm_to_mach</span></a></span>.</li>
</ul></li>
</ul></li>
<li><p><strong>EraVM operation</strong></p>
<ul>
<li><p><span
class="inlinecode"><a class="idref" href="#Ergs"><span
class="id" title="section">Ergs</span></a></span> : resource/gas system
and basic operation costs.</p></li>
<li><p><span
class="inlinecode"><a class="idref" href="#MemoryOps"><span
class="id" title="section">MemoryOps</span></a></span> : precise
formalization of memory writes and reads.</p></li>
<li><p><span
class="inlinecode"><a class="idref" href="#MemoryForwarding"><span
class="id" title="section">MemoryForwarding</span></a></span> : a
mechanism to pass memory slices between contracts.</p></li>
<li><p><span
class="inlinecode"><a class="idref" href="#Events"><span
class="id" title="section">Events</span></a></span> : different types of
events emitted when EraVM is operating.</p></li>
<li><p><span
class="inlinecode"><a class="idref" href="#KernelMode"><span
class="id" title="section">KernelMode</span></a></span> : privileged
mode of execution for system contracts allowing a restricted part of the
instructions set.</p></li>
<li><p><span
class="inlinecode"><a class="idref" href="#StaticMode"><span
class="id" title="section">StaticMode</span></a></span> : mode of
execution with limited effects on persistent state.</p></li>
<li><p><span
class="inlinecode"><a class="idref" href="#SmallStep"><span
class="id" title="section">SmallStep</span></a></span> : formal
semantics of instruction execution cycle, in small-step operational
style</p></li>
<li><p><span
class="inlinecode"><a class="idref" href="#Panics"><span
class="id" title="section">Panics</span></a></span> : a mechanism of
signaling irrecoverable errors and a list of situations where they
occur.</p></li>
</ul></li>
<li><p><strong>Instruction set semantic</strong></p>
<ul>
<li><p>Stack manipulation</p>
<ul>
<li><strong><code>SpAdd</code></strong> : <span
class="inlinecode"><a class="idref" href="#SpAddDefinition"><span
class="id" title="section">SpAddDefinition</span></a></span> : forward
stack pointer.</li>
<li><strong><code>SpSub</code></strong> : <span
class="inlinecode"><a class="idref" href="#SpSubDefinition"><span
class="id" title="section">SpSubDefinition</span></a></span> : rewind
stack pointer.</li>
</ul></li>
<li><p>Arithmetic</p>
<ul>
<li><strong><code>Add</code></strong> : <span
class="inlinecode"><a class="idref" href="#AddDefinition"><span
class="id" title="section">AddDefinition</span></a></span> :</li>
<li><strong><code>Sub</code></strong> : <span
class="inlinecode"><a class="idref" href="#SubDefinition"><span
class="id" title="section">SubDefinition</span></a></span> :</li>
<li><strong><code>Mul</code></strong> : <span
class="inlinecode"><a class="idref" href="#MulDefinition"><span
class="id" title="section">MulDefinition</span></a></span> :</li>
<li><strong><code>Div</code></strong> : <span
class="inlinecode"><a class="idref" href="#DivDefinition"><span
class="id" title="section">DivDefinition</span></a></span> :</li>
</ul></li>
<li><p>Bitwise logical</p>
<ul>
<li><strong><code>And</code></strong> : <span
class="inlinecode"><a class="idref" href="#AndDefinition"><span
class="id" title="section">AndDefinition</span></a></span> :</li>
<li><strong><code>Or</code></strong> : <span
class="inlinecode"><a class="idref" href="#OrDefinition"><span
class="id" title="section">OrDefinition</span></a></span> :</li>
<li><strong><code>Xor</code></strong> : <span
class="inlinecode"><a class="idref" href="#XorDefinition"><span
class="id" title="section">XorDefinition</span></a></span> :</li>
</ul></li>
<li><p>Bitwise shifts</p>
<ul>
<li><strong><code>Shl</code></strong> : <span
class="inlinecode"><a class="idref" href="#ShlDefinition"><span
class="id" title="section">ShlDefinition</span></a></span> : left
logical shift.</li>
<li><strong><code>Shr</code></strong> : <span
class="inlinecode"><a class="idref" href="#ShrDefinition"><span
class="id" title="section">ShrDefinition</span></a></span> : right
logical shift.</li>
<li><strong><code>Rol</code></strong> : <span
class="inlinecode"><a class="idref" href="#RolDefinition"><span
class="id" title="section">RolDefinition</span></a></span> : left
circular shift.</li>
<li><strong><code>Ror</code></strong> : <span
class="inlinecode"><a class="idref" href="#RorDefinition"><span
class="id" title="section">RorDefinition</span></a></span> : right
circular shift.</li>
</ul></li>
<li><p>Control flow</p>
<ul>
<li><p><strong><code>Nop</code></strong> : <span
class="inlinecode"><a class="idref" href="#NoOpDefinition"><span
class="id" title="section">NoOpDefinition</span></a></span> : do
nothing.</p></li>
<li><p><strong><code>Jump</code></strong> : <span
class="inlinecode"><a class="idref" href="#JumpDefinition"><span
class="id" title="section">JumpDefinition</span></a></span> : jump to
code (conditional jumps are implemented through <span
class="inlinecode"><a class="idref" href="#Predication"><span
class="id" title="section">Predication</span></a></span>).</p></li>
<li><p><strong><code>NearCall</code></strong> : <span
class="inlinecode"><a class="idref" href="#NearCallDefinition"><span
class="id" title="section">NearCallDefinition</span></a></span> : call a
function in the same contract.</p></li>
<li><p><strong><code>Ret</code> (from near call)</strong> : <span
class="inlinecode"><a class="idref" href="#NearRetDefinition"><span
class="id" title="section">NearRetDefinition</span></a></span> : when
used after near call, normal return to the call location, also returning
unspent ergs.</p></li>
<li><p><strong><code>Revert</code> (from near call)</strong> : <span
class="inlinecode"><a class="idref" href="#NearRevertDefinition"><span
class="id" title="section">NearRevertDefinition</span></a></span> : when
used after near call, return from near call due to a recoverable error,
return unspend ergs, roll back storage/events, execute exception
handler.</p></li>
<li><p><strong><code>NearRetTo</code></strong> : <span
class="inlinecode"><a class="idref" href="#NearRetToDefinition"><span
class="id" title="section">NearRetToDefinition</span></a></span> : Like
<code>Ret</code> but returns to explicit label.</p></li>
<li><p><strong><code>NearRevertTo</code></strong> : <span
class="inlinecode"><span class="id"
title="var">NearRevertToDefinition</span></span> : like
<code>NearRevert</code> but executes code at label instead of exception
handler.</p></li>
<li><p><strong><code>Panic</code></strong> : <span
class="inlinecode"><span class="id"
title="var">PanicDefinition</span></span> : trigger panic.</p></li>
<li><p><strong><code>NearPanicTo</code></strong> : <span
class="inlinecode"><a class="idref" href="#NearPanicToDefinition"><span
class="id" title="section">NearPanicToDefinition</span></a></span> :
trigger panic and return to label.</p></li>
<li><p><strong><code>Farcall</code></strong> : <span
class="inlinecode"><span class="id"
title="var">FarcallDefinition</span></span> : call a contract</p></li>
<li><p><strong><code>Ret</code> (from far call)</strong> : <span
class="inlinecode"><a class="idref" href="#FarRetDefinition"><span
class="id" title="section">FarRetDefinition</span></a></span> : when
used after far call, normal return to the call location, also returning
unspent ergs.</p></li>
<li><p><strong><code>Revert</code> (from far call)</strong> : <span
class="inlinecode"><a class="idref" href="#FarRevertDefinition"><span
class="id" title="section">FarRevertDefinition</span></a></span> : when
used after far call, recover (from an error), return unspend ergs, roll
back storage/events, execute exception handler.</p></li>
</ul></li>
<li><p>Operations with heaps</p>
<ul>
<li><strong><code>LoadPtr</code></strong> : <span
class="inlinecode"><a class="idref" href="#LoadPtrDefinition"><span
class="id" title="section">LoadPtrDefinition</span></a></span> : load
word by a fat pointer.</li>
<li><strong><code>LoadPtrInc</code></strong> : <span
class="inlinecode"><a class="idref" href="#LoadPtrIncDefinition"><span
class="id" title="section">LoadPtrIncDefinition</span></a></span> : like
<code>LoadPtr</code>, additionally return an incremented pointer.</li>
<li><strong><code>Load</code></strong> : <span
class="inlinecode"><a class="idref" href="#LoadDefinition"><span
class="id" title="section">LoadDefinition</span></a></span> : load word
from heap by a fat pointer.</li>
<li><strong><code>LoadInc</code></strong> : <span
class="inlinecode"><a class="idref" href="#LoadIncDefinition"><span
class="id" title="section">LoadIncDefinition</span></a></span> : like
<code>Load</code>, additionally return offset+32.</li>
<li><strong><code>Store</code></strong> : <span
class="inlinecode"><a class="idref" href="#StoreDefinition"><span
class="id" title="section">StoreDefinition</span></a></span> : store
word to heap by an offset.</li>
<li><strong><code>StoreInc</code></strong> : <span
class="inlinecode"><a class="idref" href="#StoreIncDefinition"><span
class="id" title="section">StoreIncDefinition</span></a></span> : like
<code>Store</code>, additionally return offset+32.</li>
</ul></li>
<li><p>Operations with static memory page (unique “heap”-like unbound
page, kernel-only)</p>
<ul>
<li><strong><code>StaticRead</code></strong> : <span
class="inlinecode"><a class="idref" href="#StaticReadDefinition"><span
class="id" title="section">StaticReadDefinition</span></a></span> : load
word from heap by a fat pointer.</li>
<li><strong><code>StaticReadInc</code></strong> : <span
class="inlinecode"><a class="idref" href="#StaticReadIncDefinition"><span
class="id" title="section">StaticReadIncDefinition</span></a></span> :
like <code>Load</code>, additionally return offset+32.</li>
<li><strong><code>StaticWrite</code></strong> : <span
class="inlinecode"><a class="idref" href="#StaticWriteDefinition"><span
class="id" title="section">StaticWriteDefinition</span></a></span> :
store word to heap by an offset.</li>
<li><strong><code>StaticWriteInc</code></strong> : <span
class="inlinecode"><a class="idref" href="#StaticWriteIncDefinition"><span
class="id" title="section">StaticWriteIncDefinition</span></a></span> :
like <code>Store</code>, additionally return offset+32.</li>
</ul></li>
<li><p>Operations with pointers</p>
<ul>
<li><strong><code>PtrAdd</code></strong> : <span
class="inlinecode"><a class="idref" href="#PtrAddDefinition"><span
class="id" title="section">PtrAddDefinition</span></a></span> :
increment pointer.</li>
<li><strong><code>PtrSub</code></strong> : <span
class="inlinecode"><a class="idref" href="#PtrSubDefinition"><span
class="id" title="section">PtrSubDefinition</span></a></span> :
decrement pointer.</li>
<li><strong><code>PtrShrink</code></strong> : <span
class="inlinecode"><a class="idref" href="#PtrShrinkDefinition"><span
class="id" title="section">PtrShrinkDefinition</span></a></span> :
restrict the range of addresses that a pointer can reference.</li>
<li><strong><code>PtrPack</code></strong> : <span
class="inlinecode"><a class="idref" href="#PtrPackDefinition"><span
class="id" title="section">PtrPackDefinition</span></a></span> : put
data in the unused high 128 bits of a pointer.</li>
</ul></li>
<li><p>Operations with storage</p>
<ul>
<li><strong><code>SStore</code></strong> : <span
class="inlinecode"><a class="idref" href="#SStoreDefinition"><span
class="id" title="section">SStoreDefinition</span></a></span> : store
value at a key in storage of the current contract.</li>
<li><strong><code>SLoad</code></strong> : <span
class="inlinecode"><a class="idref" href="#SLoadDefinition"><span
class="id" title="section">SLoadDefinition</span></a></span> : load
value by key from storage of the current contract.</li>
</ul></li>
<li><p>Operations with transient storage (resets after each
transaction)</p>
<ul>
<li><strong><code>TransientStore</code></strong> : <span
class="inlinecode"><a class="idref" href="#TransientStoreDefinition"><span
class="id" title="section">TransientStoreDefinition</span></a></span> :
store value at a key in transient storage of the current contract.</li>
<li><strong><code>TransientLoad</code></strong> : <span
class="inlinecode"><a class="idref" href="#TransientLoadDefinition"><span
class="id" title="section">TransientLoadDefinition</span></a></span> :
load value by key from transient storage of the current contract.</li>
</ul></li>
<li><p>Events and precompiles</p>
<ul>
<li><strong><code>OpEvent</code></strong> : <span
class="inlinecode"><span class="id"
title="var">OpEventDefinition</span></span> : emit an event.</li>
<li><strong><code>ToL1</code></strong> : <span
class="inlinecode"><a class="idref" href="#ToL1Definition"><span
class="id" title="section">ToL1Definition</span></a></span> : emit a
message to L1.</li>
<li><strong><code>PrecompileCall</code></strong> : <span
class="inlinecode"><a class="idref" href="#PrecompileCallDefinition"><span
class="id" title="section">PrecompileCallDefinition</span></a></span> :
call an extension of VM specific to currently executing system
contract.</li>
<li><strong><code>Context</code></strong> : <span
class="inlinecode"><span class="id"
title="var">ContextDefinition</span></span> : access the context
register and context captured value (used to emulate
<code>msg.value</code>).</li>
<li><strong><code>Contract</code></strong> : <span
class="inlinecode"><span class="id"
title="var">ContractDefinition</span></span> : access associated
contract addresses (current, caller, or code)</li>
<li><strong><code>VM</code></strong> : <span class="inlinecode"><span
class="id" title="var">VMDefinition</span></span> : access some parts of
VM execution state such as stack pointer.</li>
</ul></li>
</ul></li>
<li><p><strong>ABI</strong> (memory layouts of compound data structures
serialized to 256-bit words.)</p>
<ul>
<li><span class="inlinecode"><span class="id"
title="library">Coder</span></span> : general definitions of encoding,
decoding, composition and required properties.</li>
<li><span
class="inlinecode"><a class="idref" href="#NearCallABI"><span
class="id" title="section">NearCallABI</span></a></span></li>
<li><span
class="inlinecode"><a class="idref" href="#FatPointerABI"><span
class="id" title="section">FatPointerABI</span></a></span></li>
<li><span
class="inlinecode"><a class="idref" href="#FarCallABI"><span
class="id" title="section">FarCallABI</span></a></span></li>
<li><span
class="inlinecode"><a class="idref" href="#FarRetABI"><span
class="id" title="section">FarRetABI</span></a></span></li>
<li><span
class="inlinecode"><a class="idref" href="#MetaParametersABI"><span
class="id" title="section">MetaParametersABI</span></a></span> : layout
of result of <span class="inlinecode"><span class="id"
title="var">ContextMeta</span></span>.</li>
<li><span
class="inlinecode"><a class="idref" href="#PrecompileParametersABI"><span
class="id" title="section">PrecompileParametersABI</span></a></span> :
layout of result of <span class="inlinecode"><span class="id"
title="var">ContextMeta</span></span>.</li>
</ul></li>
<li><p><strong>Instruction encoding</strong></p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#EncodingTools"><span
class="id" title="section">EncodingTools</span></a></span> : binary
encoding of different parts of instruction layout.</li>
<li><span
class="inlinecode"><a class="idref" href="#encode_opcode"><span
class="id" title="definition">encode_opcode</span></a></span> : encoding
source/destination, addressing modes, and all modifiers as a single
11-bit opcode value.</li>
<li><span
class="inlinecode"><a class="idref" href="#MachEncoder"><span
class="id" title="section">MachEncoder</span></a></span> : the main
assembly instruction encoder definition.</li>
</ul></li>
<li><p><strong>Elements of protocol</strong></p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#Bootloader"><span
class="id" title="section">Bootloader</span></a></span> : a system
contract in charge of block construction.</li>
<li><span
class="inlinecode"><a class="idref" href="#Precompiles"><span
class="id" title="section">Precompiles</span></a></span> : extensions of
virtual machine.</li>
<li><span
class="inlinecode"><a class="idref" href="#VersionedHash"><span
class="id" title="section">VersionedHash</span></a></span> : used to
fetch the contract code.</li>
<li><span
class="inlinecode"><a class="idref" href="#Decommitter"><span
class="id" title="section">Decommitter</span></a></span> : fetches the
contract code.</li>
</ul></li>
</ul>
</div>
<div class="code">
<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.Glossary</h1>

<div class="code">
<span class="id" title="keyword">Section</span> <a id="Glossary" class="idref" href="#Glossary"><span class="id" title="section">Glossary</span></a>.<br/>
</div>

<div class="doc"><h1 id="notations">Notations</h1>
<ul>
<li><p>Definitional equality is denoted with <span
class="math inline">A:=B</span>. Its meaning is: <span
class="math inline">A</span> can be substituted with <span
class="math inline">B</span>.</p></li>
<li><p>Ranges of numbers are denoted as follows:</p>
<p><span class="math display">\mathit{[start, limit) := \{n | start \leq
n \lt limit\}}</span></p>
<p>In other words, start of the range is included, and limit is
excluded.</p></li>
<li><p>Accessing subranges of a binary representation of a number is
denoted with <span class="math inline">\{low, high\}</span>. For
example, this denotes a binary number obtained by taking bits from
128-th inclusive to to 256-th exclusive of the value <span
class="math inline">\mathit{op}</span>:</p>
<p><span class="math display">\mathit{op}\{128, 256\}</span></p></li>
<li><p>Concatenation of sequences of binary numbers is denoted with
<span class="math inline">\#\#</span></p>
<p>For example, the following denotes concatenating bit representations
of the numbers <span class="math inline">a</span> and <span
class="math inline">b</span>: <span class="math display">a \#\#
b</span></p></li>
</ul>
</div>
<div class="code">
<br/>

<br/>
</div>

<div class="doc"><h1 id="glossary">Glossary</h1>
<ul>
<li><strong>ABI</strong> – application binary interface. See <span
class="inlinecode"><a class="idref" href="#ABI"><span
class="id" title="definition">ABI</span></a></span>.</li>
<li><strong>Active external frame</strong> – the closest external frame
to the top of call stack. For example, in a callstack <span
class="inlinecode">(<a class="idref" href="#InternalCall"><span
class="id" title="constructor">InternalCall</span></a></span> <span
class="inlinecode"><span class="id" title="var"><em></span></span> <span
class="inlinecode">(<a class="idref" href="#InternalCall"><span
class="id" title="constructor">InternalCall</span></a></span>
<span class="inlinecode"><span class="id" title="var"></em></span></span>
<span
class="inlinecode">(<a class="idref" href="#ExternalCall"><span
class="id" title="constructor">ExternalCall</span></a></span> <span
class="inlinecode"><span class="id" title="var"><em></span></span> <span
class="inlinecode">(<a class="idref" href="#InternalCall"><span
class="id" title="constructor">InternalCall</span></a></span>
<span class="inlinecode"><span class="id" title="var"></em></span></span>
<span class="inlinecode">…))))</span> the active external frame will be
the third frame in stack. See <span
class="inlinecode"><a class="idref" href="#active_extframe"><span
class="id" title="definition">active_extframe</span></a></span>.</li>
<li><strong>Auxheap</strong> – one of two heap variants (heap and
auxheap), mostly used by system contracts. Executing one of far call
instructions creates a new external frame and allocates pages for code,
constants, data stack, heap and aux heap.</li>
<li><strong>Burning ergs</strong> – setting ergs to zero in topmost call
stack frame, external or internal. See <span
class="inlinecode"><a class="idref" href="#Ergs"><span
class="id" title="section">Ergs</span></a></span>.</li>
<li><strong>Callstack</strong> – a stack of context information.
Executing one of near call instructions pushes a frame of type <span
class="inlinecode"><a class="idref" href="#InternalCall"><span
class="id" title="constructor">InternalCall</span></a></span> to the
callstack, executing one of far call instructions pushes a frame of type
<span
class="inlinecode"><a class="idref" href="#ExternalCall"><span
class="id" title="constructor">ExternalCall</span></a></span>. See <span
class="inlinecode"><span class="id"
title="library">CallStack</span></span>.</li>
<li><strong>Checkpoint</strong> – see <span
class="inlinecode"><a class="idref" href="#state_checkpoint"><span
class="id" title="record">state_checkpoint</span></a></span>. Not to
confuse with EraVM snapshot.</li>
<li><strong>Code page</strong> – a read only page filled with <span
class="inlinecode"><span class="id"
title="var">instruction_predicated</span></span>. Created by far calls,
filled with code obtained from <span
class="inlinecode"><a class="idref" href="#Decommitter"><span
class="id" title="section">Decommitter</span></a></span>. See <span
class="inlinecode"><a class="idref" href="#code_page"><span
class="id" title="definition">code_page</span></a></span>.</li>
<li><strong>Const page</strong> – a read only page filled with constant
data. Created by far calls, filled with constants obtained from <span
class="inlinecode"><a class="idref" href="#Decommitter"><span
class="id" title="section">Decommitter</span></a></span>. Can be
implemented by putting constants to code pages instead. See <span
class="inlinecode"><a class="idref" href="#const_page"><span
class="id" title="definition">const_page</span></a></span>.</li>
<li><strong>Context instructions</strong> – instructions implemented as
variants of <code>context</code> machine instruction:
<ul>
<li><span class="inlinecode"><span class="id"
title="var">OpContextCaller</span></span></li>
<li><span class="inlinecode"><span class="id"
title="var">OpContextCodeAddress</span></span></li>
<li><span class="inlinecode"><span class="id"
title="var">OpContextErgsLeft</span></span></li>
<li><span class="inlinecode"><span class="id"
title="var">OpContextGetContextU128</span></span></li>
<li><span class="inlinecode"><span class="id"
title="var">OpContextIncrementTxNumber</span></span></li>
<li><span class="inlinecode"><span class="id"
title="var">OpContextMeta</span></span></li>
<li><span class="inlinecode"><span class="id"
title="var">OpContextSetContextU128</span></span></li>
<li><span class="inlinecode"><span class="id"
title="var">OpContextSetErgsPerPubdataByte</span></span></li>
<li><span class="inlinecode"><span class="id"
title="var">OpContextSp</span></span></li>
<li><span class="inlinecode"><span class="id"
title="var">OpContextThis</span></span></li>
</ul></li>
<li><strong>Running instance of a contract, or a function</strong> – a
set of memory pages, call stack frames, and other resources associated
with a running contract or function. They are distinct per
function/contract call.</li>
<li><strong>Current contract</strong> – contract currently being
executed. See <span
class="inlinecode"><a class="idref" href="#ecf_this_address"><span
class="id" title="projection">ecf_this_address</span></a></span> and
<span
class="inlinecode"><a class="idref" href="#active_extframe"><span
class="id" title="definition">active_extframe</span></a></span>.</li>
<li><strong>Current function</strong> – the most recent of functions
currently being executed.</li>
<li><strong>Data page</strong> – one of types of memory pages. See <span
class="inlinecode"><a class="idref" href="#data_page"><span
class="id" title="definition">data_page</span></a></span>.</li>
<li><strong>Data stack</strong> – a stack implicitly operated upon by
instructions using address modes like <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span> or <span
class="inlinecode"><a class="idref" href="#RelSP"><span
class="id" title="constructor">RelSP</span></a></span>. Located on pages
of type <span
class="inlinecode"><a class="idref" href="#stack_page"><span
class="id" title="definition">stack_page</span></a></span>. Every
contract instance has its own stack; functions invoked by <span
class="inlinecode"><a class="idref" href="#OpNearCall"><span
class="id" title="constructor">OpNearCall</span></a></span> share the
stack with their caller.</li>
<li><strong>Decommitter</strong> – a module responsible for storing
contract code and providing it upon query.</li>
<li><strong>Exception handler</strong> – a <span
class="inlinecode"><a class="idref" href="#code_address"><span
class="id" title="definition">code_address</span></a></span> of a piece
of code associated to a call stack frame. This code will be executed if
the corresponding function reverts or panics.</li>
<li><strong>External/internal frame, function/contract frame</strong>
–</li>
<li><strong>Far call</strong> – execution of one of the following
instructions: <span
class="inlinecode"><a class="idref" href="#OpFarCall"><span
class="id" title="constructor">OpFarCall</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpMimicCall"><span
class="id" title="constructor">OpMimicCall</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span>.</li>
<li><strong>Fat pointer</strong> – a full 128-bit <span
class="inlinecode"><a class="idref" href="#data_page"><span
class="id" title="definition">data_page</span></a></span> pointer
encoding page id, a span of addresses from some starting address and
with a specified length, and an offset inside this span. See <span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span>.</li>
<li><strong>GPR, general purpose register</strong> – one of 16 registers
<span class="inlinecode"><span class="id"
title="var">r0</span></span>–<span
class="inlinecode"><a class="idref" href="#r15"><span
class="id" title="projection">r15</span></a></span> containing primitive
values. Register <span class="inlinecode"><span class="id"
title="var">r0</span></span> is a constant register, can not be written
to and is read-only.</li>
<li><strong>Heap</strong> – one of two heap variants (heap and auxheap),
mostly used by system contracts. Executing one of far call instructions
creates a new external frame and allocates pages for code, constants,
data stack, heap and aux heap.</li>
<li><strong>Heap pointer</strong> – a pair of address in heap and a
limit; it is associated with a span <span class="math inline">[0;
limit)</span>. See <span
class="inlinecode"><a class="idref" href="#heap_ptr"><span
class="id" title="record">heap_ptr</span></a></span>.</li>
<li><strong>Heap variant</strong> – either Heap or Auxheap, depending on
the context.</li>
<li><strong>Integer value</strong> – a <span
class="inlinecode"><a class="idref" href="#primitive_value"><span
class="id" title="record">primitive_value</span></a></span> with a reset
pointer tag. See <span
class="inlinecode"><a class="idref" href="#IntValue"><span
class="id" title="abbreviation">IntValue</span></a></span>.</li>
<li><strong>L1</strong> – level-1, refers to the main Ethereum
blockchain, also known as the Ethereum Mainnet. Used to distinguish from
scaling solutions or Layer 2 solutions that aim to improve the
scalability and throughput of the Ethereum blockchain.</li>
<li><strong>Log instructions</strong> – variations of <code>log</code>
machine instruction: <span
class="inlinecode"><a class="idref" href="#OpSLoad"><span
class="id" title="constructor">OpSLoad</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpSStore"><span
class="id" title="constructor">OpSStore</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpEvent"><span
class="id" title="constructor">OpEvent</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpToL1Message"><span
class="id" title="constructor">OpToL1Message</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpPrecompileCall"><span
class="id" title="constructor">OpPrecompileCall</span></a></span>.</li>
<li><strong>Memory forwarding</strong> – a mechanism of sharing a
read-only fragment ofmemory between contracts. The memory fragment is
created from <span
class="inlinecode"><a class="idref" href="#span"><span
class="id" title="record">span</span></a></span> and described by <span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span>. This fragment can
be narrowed or shrunk as a result of far call or executing <span
class="inlinecode"><a class="idref" href="#OpPtrShrink"><span
class="id" title="constructor">OpPtrShrink</span></a></span>.</li>
<li><strong>Machine instruction</strong> – a low-level machine
instruction with a fixed format. The high-level <span
class="inlinecode"><span class="id"
title="var">instruction_predicated</span></span> is encoded to machine
instructions.</li>
<li><strong>Memory growth</strong> – a process, where an access to a
heap variant beyond its bound leads to increasing the bound and
payment.</li>
<li><strong>Narrowing a fat pointer</strong> – subtract a given number
from its length and add it to its start; it is guaranteed to not
overflow. See <span
class="inlinecode"><a class="idref" href="#fat_ptr_narrow"><span
class="id" title="definition">fat_ptr_narrow</span></a></span>. Used
when passing a fat pointer to a far call, or returning it from a
contract.</li>
<li><strong>Near call</strong> – calling a function that belongs to the
same contract.</li>
<li><strong>Operand</strong> – data or the address that is operated upon
by the instruction. It represents the input or output values used by the
instruction to perform a specific operation or computation. See <span
class="inlinecode"><a class="idref" href="#Addressing.InstructionArguments"><span
class="id" title="section">InstructionArguments</span></a></span>.</li>
<li><strong>Page</strong> – see <span
class="inlinecode"><a class="idref" href="#page_type"><span
class="id" title="inductive">page_type</span></a></span>.</li>
<li><strong>Pointer value</strong> – a <span
class="inlinecode"><a class="idref" href="#primitive_value"><span
class="id" title="record">primitive_value</span></a></span> with a set
pointer tag. May contain a fat pointer. See <span
class="inlinecode"><a class="idref" href="#PtrValue"><span
class="id" title="abbreviation">PtrValue</span></a></span>.</li>
<li><strong>Precompile call</strong> – an invokation of <span
class="inlinecode"><a class="idref" href="#OpPrecompileCall"><span
class="id" title="constructor">OpPrecompileCall</span></a></span>.
Precompiles are extensions of EraVM bound to one of the system
contracts. When this contract executes an instruction <span
class="inlinecode"><a class="idref" href="#OpPrecompileCall"><span
class="id" title="constructor">OpPrecompileCall</span></a></span>, EraVM
executes an algorithm specific to this contract. See <span
class="inlinecode"><a class="idref" href="#Precompiles"><span
class="id" title="section">Precompiles</span></a></span>.</li>
<li><strong>Precompile processor</strong> – a module responsible for
encoding the algorithms of precompile calls and executing them.</li>
<li><strong>Primitive value</strong> – a tagged word. See <span
class="inlinecode"><a class="idref" href="#primitive_value"><span
class="id" title="record">primitive_value</span></a></span>.</li>
<li><strong>Shrinking a fat pointer</strong> – subtract a given number
from its length; it is guaranteed to not overflow. See <span
class="inlinecode"><a class="idref" href="#fat_ptr_shrink"><span
class="id" title="definition">fat_ptr_shrink</span></a></span>.
Triggered by <span
class="inlinecode"><a class="idref" href="#OpPtrShrink"><span
class="id" title="constructor">OpPtrShrink</span></a></span>
instruction.</li>
<li><strong>Slice</strong> – see <span class="inlinecode"><span
class="id" title="var">slice</span></span>.</li>
<li><strong>Span</strong> – see <span
class="inlinecode"><a class="idref" href="#span"><span
class="id" title="record">span</span></a></span>.</li>
<li><strong>Stack page</strong> – a type of pages. See <span
class="inlinecode"><a class="idref" href="#stack_page"><span
class="id" title="definition">stack_page</span></a></span>.</li>
<li><strong>System contracts</strong> – contracts with addresses from 0
to <span
class="inlinecode"><a class="idref" href="#KERNEL_MODE_MAXADDR_LIMIT"><span
class="id"
title="definition">KERNEL_MODE_MAXADDR_LIMIT</span></a></span>. They are
executed in <span
class="inlinecode"><a class="idref" href="#KernelMode"><span
class="id" title="section">KernelMode</span></a></span>.</li>
<li><strong>Topmost callstack frame</strong> – the last frame pushed to
call stack.</li>
<li><strong>Word</strong> – 256-bit unsigned untagged integer
value.</li>
<li><strong>Address resolution</strong> – a matching between instruction
operands and locations using the supported address modes. See <span
class="inlinecode"><a class="idref" href="#resolve"><span
class="id" title="inductive">resolve</span></a></span>.</li>
<li><strong>Base cost</strong> – the fixed cost of executing
instruction, in ergs. Some instructions imply additional costs, e.g. far
calls may require paying for code decommitment.</li>
<li><strong>Bootloader</strong> – a system contract written in YUL in
charge of block construction.</li>
<li><strong>Cell</strong> – alias to “word”. Often used to distinguish
between values themselves and the memory locations holding them.</li>
<li><strong>Depot</strong> – all storages in all shards. See <span
class="inlinecode"><a class="idref" href="#depot"><span
class="id" title="definition">depot</span></a></span>.</li>
<li><strong>Ergs</strong> – resource spent on actions such as executing
instructions. See <span
class="inlinecode"><a class="idref" href="#Ergs"><span
class="id" title="section">Ergs</span></a></span>.</li>
<li><strong>Instruction predicate</strong> – see <span
class="inlinecode"><a class="idref" href="#Predication"><span
class="id" title="section">Predication</span></a></span>.</li>
<li><strong>Flag</strong> – see <span class="inlinecode"><span
class="id" title="var">flag_state</span></span>.</li>
<li><strong>Fully qualified address</strong> – see <span
class="inlinecode"><a class="idref" href="#fqa_key"><span
class="id" title="record">fqa_key</span></a></span>.</li>
<li><strong>Instruction</strong> – low-level command or operation that
is executed by a virtual machine to perform a specific task.
Instructions supported by EraVm are described by the type <span
class="inlinecode"><span class="id"
title="var">instruction_predicated</span></span>.</li>
<li><strong>Kernel mode</strong> – a mode of execution for system
contracts opening access to full instruction set, containing
instructions potentially harmful to the global state e.g. <span
class="inlinecode"><span class="id"
title="var">OpContextIncrementTxNumber</span></span>. See <span
class="inlinecode"><a class="idref" href="#KernelMode"><span
class="id" title="section">KernelMode</span></a></span>.</li>
<li><strong>Key</strong> – a 256-bit address of a cell in storage.</li>
<li><strong>Location</strong> – see <span
class="inlinecode"><a class="idref" href="#loc"><span
class="id" title="inductive">loc</span></a></span>.</li>
<li><strong>Panic</strong> – irrecoverable error. Handled by formally
executing <span
class="inlinecode"><a class="idref" href="#OpPanic"><span
class="id" title="constructor">OpPanic</span></a></span>.</li>
<li><strong>Revert</strong> – execution of <span
class="inlinecode"><a class="idref" href="#OpRevert"><span
class="id" title="constructor">OpRevert</span></a></span>, usually as a
consequence of recoverable error.</li>
<li><strong>Malformed transaction</strong> – a transaction rejected by
the bootloader. Handling it is the responsibility of the server that
controls EraVM.</li>
<li><strong>Predicate</strong> – see <span
class="inlinecode"><a class="idref" href="#Predication"><span
class="id" title="section">Predication</span></a></span>.</li>
<li><strong>Predication</strong> – see <span
class="inlinecode"><a class="idref" href="#Predication"><span
class="id" title="section">Predication</span></a></span>.</li>
<li><strong>Program counter</strong> – the <span
class="inlinecode"><a class="idref" href="#code_address"><span
class="id" title="definition">code_address</span></a></span> of the next
instruction to be executed. See <span
class="inlinecode"><a class="idref" href="#cf_pc"><span
class="id" title="projection">cf_pc</span></a></span>.</li>
<li><strong>Rollback</strong> – restoration of the <span
class="inlinecode"><a class="idref" href="#gs_revertable"><span
class="id" title="projection">gs_revertable</span></a></span> portion of
<span
class="inlinecode"><a class="idref" href="#state"><span
class="id" title="record">state</span></a></span> as a result of revert
or panic. The state is saved at every near or far call. See also <span
class="inlinecode"><a class="idref" href="#state_checkpoint"><span
class="id" title="record">state_checkpoint</span></a></span>.</li>
<li><strong>Shard</strong> – a collection of <span
class="inlinecode"><a class="idref" href="#storage"><span
class="id" title="definition">storage</span></a></span>s. See <span
class="inlinecode"><a class="idref" href="#shard"><span
class="id" title="definition">shard</span></a></span>.</li>
<li><strong>Snapshot</strong> – a copy of the full state of EraVM.
Server makes a snapshot of VM state every time a transaction is
successfully completed. When the bootloader encounters a malformed
transaction, it fails, and the server restarts EraVM from the most
recent snapshot, skipping this transaction.</li>
<li><strong>Server</strong> – a program that launches EraVM and controls
it. Feeds the transactions to the bootloader, provides decommitter and
other external modules, restarts EraVM from the latest snapshot in case
of malformed transactions.</li>
<li><strong>Stack pointer</strong> – the <span
class="inlinecode"><a class="idref" href="#stack_address"><span
class="id" title="definition">stack_address</span></a></span> where the
next element will be pushed. It is the address of the (top of the stack
+ 1).</li>
<li><strong>Static mode</strong> – see <span
class="inlinecode"><a class="idref" href="#StaticMode"><span
class="id" title="section">StaticMode</span></a></span>.</li>
<li><strong>Storage</strong> – see <span
class="inlinecode"><a class="idref" href="#storage"><span
class="id" title="definition">storage</span></a></span>.</li>
<li><strong>Total cost</strong> – a sum of <span
class="inlinecode"><a class="idref" href="#base_cost"><span
class="id" title="definition">base_cost</span></a></span> of an
instruction and all its additional costs.</li>
<li><strong>Versioned hash</strong> – a key used to retrieve the
contract code from decommitter. See <span
class="inlinecode"><a class="idref" href="#versioned_hash"><span
class="id" title="record">versioned_hash</span></a></span> and <span
class="inlinecode"><a class="idref" href="#Decommitter"><span
class="id" title="section">Decommitter</span></a></span>.</li>
<li><strong>VM</strong> – the same as EraVM, the abstract virtual
machine that this document specifies.</li>
</ul>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Glossary"><span class="id" title="section">Glossary</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.Core</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Common</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">ZArith</span></a> <a class="idref" href="#"><span class="id" title="module">Types</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Parameters" class="idref" href="#Parameters"><span class="id" title="section">Parameters</span></a>.<br/>
</div>

<div class="doc"><h1 id="eravm-architecture-overview">EraVM architecture overview</h1>
<p>EraVM is a 256-bit register-based language machine with two stacks
and dedicated memory for code, data, stack and constants.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="word_bits" class="idref" href="#word_bits"><span class="id" title="definition">word_bits</span></a>: <a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a> := 256.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="word" class="idref" href="#word"><span class="id" title="definition">word</span></a>: <span class="id" title="keyword">Type</span> := <span class="id" title="definition">BITS</span> <a class="idref" href="#word_bits"><span class="id" title="definition">word_bits</span></a>.<br/>
</div>

<div class="doc"><p><span
class="inlinecode"><a class="idref" href="#word0"><span
class="id" title="definition">word0</span></a></span> is a word with a
zero value.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="word0" class="idref" href="#word0"><span class="id" title="definition">word0</span></a>: <a class="idref" href="#word"><span class="id" title="definition">word</span></a> := <span class="id" title="definition">fromZ</span> 0%<span class="id" title="var">Z</span>.<br/>
</div>
<details><summary>Helpers </summary><div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="bytes_in_word" class="idref" href="#bytes_in_word"><span class="id" title="definition">bytes_in_word</span></a> : <a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a> := <a class="idref" href="#word_bits"><span class="id" title="definition">word_bits</span></a><a class="idref" href="#2e0d8202c5a48097752d760d3a1db6a7"><span class="id" title="notation">/</span></a><a class="idref" href="#bits_in_byte"><span class="id" title="definition">bits_in_byte</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="z_bytes_in_word" class="idref" href="#z_bytes_in_word"><span class="id" title="definition">z_bytes_in_word</span></a> : <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := <a class="idref" href="#Z.of_nat"><span class="id" title="definition">Z.of_nat</span></a> <a class="idref" href="#bytes_in_word"><span class="id" title="definition">bytes_in_word</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="word_to_bytes" class="idref" href="#word_to_bytes"><span class="id" title="definition">word_to_bytes</span></a> (<a id="w:1" class="idref" href="#w:1"><span class="id" title="binder">w</span></a>:<a class="idref" href="#u256"><span class="id" title="definition">u256</span></a>) : <span class="id" title="record">tuple.tuple_of</span> 32 <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a> := @<span class="id" title="definition">bitsToBytes</span> 32 <a class="idref" href="#w:1"><span class="id" title="variable">w</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="bytes_to_word" class="idref" href="#bytes_to_word"><span class="id" title="definition">bytes_to_word</span></a> (<a id="bs:2" class="idref" href="#bs:2"><span class="id" title="binder">bs</span></a>: <span class="id" title="record">tuple.tuple_of</span> 32 <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a>) : <a class="idref" href="#word"><span class="id" title="definition">word</span></a> := @<span class="id" title="definition">bytesToBits</span> <span class="id" title="var">_</span> <a class="idref" href="#bs:2"><span class="id" title="variable">bs</span></a>.<br/>

<br/>
</div>
</details><div class="code">
<span class="id" title="keyword">End</span> <a class="idref" href="#Parameters"><span class="id" title="section">Parameters</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="ArchOverview" class="idref" href="#ArchOverview"><span class="id" title="section">ArchOverview</span></a>.<br/>
</div>

<div class="doc"><p><img src="img/arch-overview.png" /></p>
<ul>
<li><strong>Memory</strong> provides access to transient memory pages.
See <span
class="inlinecode"><a class="idref" href="#Memory"><span
class="id" title="section">Memory</span></a></span>.</li>
<li><strong>Storage</strong> provides access to persistent storage with
two shards, each shard maps <span class="math inline">2^{160}</span>
contracts, to a key-value storage. See <span
class="inlinecode"><a class="idref" href="#Depot"><span
class="id" title="section">Depot</span></a></span>.</li>
<li><strong>EventSink</strong> collects events and messages to L1. See
<span
class="inlinecode"><a class="idref" href="#Events"><span
class="id" title="section">Events</span></a></span>.</li>
<li><strong>Precompile processor</strong> executes system
contract-specific extensions to the EraVM instruction set, called
precompiles, e.g. <code>keccak256</code>, <code>sha256</code>, and so
on. See <span
class="inlinecode"><a class="idref" href="#Precompiles"><span
class="id" title="section">Precompiles</span></a></span>.</li>
<li><strong>Decommitment processor</strong> stores and decommits the
code of contracts. See <span
class="inlinecode"><a class="idref" href="#Decommitter"><span
class="id" title="section">Decommitter</span></a></span>.</li>
</ul>
<h2 id="functions-and-contracts">Functions and contracts</h2>
<p>In EraVM, contracts are the coarse-grained execution units. Contracts
may have multiple <strong>functions</strong> in them; a contract may
execute its functions by using <strong>near call</strong> instruction
<span
class="inlinecode"><a class="idref" href="#OpNearCall"><span
class="id" title="constructor">OpNearCall</span></a></span>. A contract
may also call other contracts by using <strong>far call</strong>
instructions <span
class="inlinecode"><a class="idref" href="#OpFarCall"><span
class="id" title="constructor">OpFarCall</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpMimicCall"><span
class="id" title="constructor">OpMimicCall</span></a></span>, or <span
class="inlinecode"><a class="idref" href="#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span>.</p>
<p>A <strong>running instance</strong> of a function or a contract is a
piece of VM runtime state associated with the current execution of a
function or a contract, as described by <span
class="inlinecode"><a class="idref" href="#callstack"><span
class="id" title="inductive">callstack</span></a></span>.</p>
<p>EraVM allows recursive execution of functions and contracts. For
example, a contract <span class="math inline">A</span> calls a function
<span class="math inline">f_1</span> which calls a function <span
class="math inline">f_2</span> which calls a contract <span
class="math inline">B</span>, which calls a function <span
class="math inline">g_1</span>, which calls <span
class="math inline">A</span> again …</p>
<p><span class="math display">A \rightarrow f_1 \rightarrow f_2
\rightarrow B \rightarrow g_1 \rightarrow A \rightarrow \dots</span></p>
<p>During the execution of <span class="math inline">g_1</span>,
<strong>running instances</strong> of <span
class="math inline">A</span>, <span class="math inline">f_1</span>,
<span class="math inline">f_2</span> keep existing, waiting for the
control to return to them.</p>
<p>Executing a contract allocates memory pages dedicated to it (see
<span
class="inlinecode"><a class="idref" href="#alloc_pages_extframe"><span
class="id" title="inductive">alloc_pages_extframe</span></a></span>). In
a running instance of a contract, this contract’s functions share these
memory pages.</p>
<p>Contracts have more contract-specific state associated to them than
functions (compare <span
class="inlinecode"><a class="idref" href="#InternalCall"><span
class="id" title="constructor">InternalCall</span></a></span> and <span
class="inlinecode"><a class="idref" href="#ExternalCall"><span
class="id" title="constructor">ExternalCall</span></a></span>). However,
running instances of both functions and contracts have their own
exception handlers, program counters, stack pointers and allocated ergs
(see <span
class="inlinecode"><a class="idref" href="#callstack_common"><span
class="id" title="record">callstack_common</span></a></span>).</p>
<h2 id="execution-state">Execution state</h2>
<p>EraVM’s functionality is to sequentially execute instructions.</p>
<p>The main components of EraVM’s execution state are:</p>
<ul>
<li>256-bit tagged general-purpose registers R1–R15 and a reserved
constant register R0 holding 0. See <span
class="inlinecode"><a class="idref" href="#regs_state"><span
class="id" title="record">regs_state</span></a></span>.</li>
<li>Three flags: OverFlow/Less-Than, EQuals, Greater-Than. See <span
class="inlinecode"><a class="idref" href="#flags_state"><span
class="id" title="record">flags_state</span></a></span>.</li>
<li>Data stack containing tagged words. It is located on a dedicated
<span
class="inlinecode"><a class="idref" href="#stack_page"><span
class="id" title="definition">stack_page</span></a></span>.</li>
<li>Callstack, holding callframes, which contain such information as the
program counter, data stack pointer, ergs for the current
function/contract instance, current contract’s address, and so on. See
<span class="inlinecode"><span class="id"
title="library">CallStack</span></span>.</li>
<li>Frames in callstack; can be internal (belong to a function, near
called) frames or external frames (belong to a contract, far called,
richer state).</li>
<li>Read-only pages for constants and code, one per contract stack
frame.</li>
</ul>
<h2 id="instructions">Instructions</h2>
<p>The type <span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span> describes
the supported instructions.</p>
<p>All instructions are <span
class="inlinecode"><a class="idref" href="#predicated"><span
class="id" title="record">predicated</span></a></span>: they contain an
explicit condition related to the current flags state. If the condition
is satisfied, they are executed, otherwise they are skipped (but their
<span class="inlinecode"><span class="id"
title="var">basic_cost</span></span> is still paid).</p>
<p>Instructions accept data and return results in various formats:</p>
<ul>
<li>The formats of instruction operands are described in <span
class="inlinecode"><a class="idref" href="#Addressing"><span
class="id" title="section">Addressing</span></a></span>.</li>
<li>The address resolution to locations in memory/registers is described
in <span
class="inlinecode"><a class="idref" href="#resolve"><span
class="id" title="inductive">resolve</span></a></span></li>
<li>Reading and writing to memory is described in <span
class="inlinecode"><a class="idref" href="#MemoryOps"><span
class="id" title="section">MemoryOps</span></a></span>.</li>
</ul>
<h2 id="modes">Modes</h2>
<p>EraVM has two modes which can be independently turned on and off.</p>
<ol type="1">
<li>Kernel mode/User Mode</li>
</ol>
<p>First <span
class="inlinecode"><a class="idref" href="#KERNEL_MODE_MAXADDR_LIMIT"><span
class="id"
title="definition">KERNEL_MODE_MAXADDR_LIMIT</span></a></span> contracts
are marked as <strong>system contracts</strong>. EraVM executes them in
kernel mode, allowing an access to a richer instruction set, containing
instructions potentially harmful to the global state e.g. <span
class="inlinecode"><span class="id"
title="var">OpContextIncrementTxNumber</span></span>. See <span
class="inlinecode"><a class="idref" href="#KernelMode"><span
class="id" title="section">KernelMode</span></a></span>.</p>
<ol start="2" type="1">
<li><p>Static mode/Non-static mode</p>
<p>Intuitively, executing code in static mode aims at limiting its
effects on the global state, similar to executing pure functions.
Globally visible actions like emitting events or writing to storage are
forbidden in static mode. See <span
class="inlinecode"><a class="idref" href="#StaticMode"><span
class="id" title="section">StaticMode</span></a></span>.</p></li>
</ol>
<h2 id="ergs">Ergs</h2>
<p>Instructions and some other actions should be paid for with a
resource called <strong>ergs</strong>, similar to Ethereum’s gas. See
the overview in <span
class="inlinecode"><a class="idref" href="#Ergs"><span
class="id" title="section">Ergs</span></a></span>.</p>
<h2 id="operation">Operation</h2>
<p>The VM is started by a server that controls it and feeds the
transactions to the <span
class="inlinecode"><a class="idref" href="#Bootloader"><span
class="id" title="section">Bootloader</span></a></span>.</p>
<h3 id="context-of-eravm">Context of EraVM</h3>
<p>When the server needs to build a new batch, it starts an instance of
EraVM.</p>
<p>EraVM accepts three parameters:</p>
<ol type="1">
<li>Bootloader’s <span
class="inlinecode"><a class="idref" href="#versioned_hash"><span
class="id" title="record">versioned_hash</span></a></span>. It is used
to fetch the bootloader code from <span
class="inlinecode"><a class="idref" href="#Decommitter"><span
class="id" title="section">Decommitter</span></a></span>.</li>
<li>Default code hash <span
class="inlinecode"><a class="idref" href="#DEFAULT_AA_VHASH"><span
class="id" title="axiom">DEFAULT_AA_VHASH</span></a></span>. It is used
to fetch the default code from <span
class="inlinecode"><a class="idref" href="#Decommitter"><span
class="id" title="section">Decommitter</span></a></span> in case of a
far call to a contract without any associated code.</li>
<li>A boolean flag <code>is_porter_available</code>, to determine the
number of shards (two if zkPorter is available, one otherwise).</li>
</ol>
<p>Bootloader is a contract written in YUL in charge of block
construction. See <span
class="inlinecode"><a class="idref" href="#Bootloader"><span
class="id" title="section">Bootloader</span></a></span>.</p>
<p>EraVM retrives the code of bootloader from <span
class="inlinecode"><a class="idref" href="#Decommitter"><span
class="id" title="section">Decommitter</span></a></span> and proceeds
with sequential execution of instructions on the bootloader’s code
page.</p>
<h3 id="failures-and-rollbacks">Failures and rollbacks</h3>
<p>There are three types of behaviors triggered by execution
failures.</p>
<ol type="1">
<li><p>Skipping a malformed transaction. It is a mechanism implemented
by the server, external to EraVM. Server makes a snapshot of EraVM state
after completing every transaction. When the bootloader encounters a
malformed transaction, it fails, and the server restarts EraVM from the
most recent snapshot, skipping this transaction.</p>
<p>This behavior is specific to bootloader; the contract code has no
ways of invoking it.</p></li>
<li><p>Revert is triggered by the contract code explicitly by executing
<span
class="inlinecode"><a class="idref" href="#OpRevert"><span
class="id" title="constructor">OpRevert</span></a></span>. EraVM saves
its persistent state to <span
class="inlinecode"><a class="idref" href="#state_checkpoint"><span
class="id" title="record">state_checkpoint</span></a></span> on every
near or far call. If the contract code identifies a recoverable error,
it may execute <span
class="inlinecode"><a class="idref" href="#OpRevert"><span
class="id" title="constructor">OpRevert</span></a></span>. Then EraVM
rolls the storage and event queues back to the last <span
class="inlinecode"><a class="idref" href="#state_checkpoint"><span
class="id" title="record">state_checkpoint</span></a></span> and
executes the exception handler. See <span
class="inlinecode"><a class="idref" href="#rollback"><span
class="id" title="inductive">rollback</span></a></span>.</p></li>
<li><p>Panic is triggered either explicitly by executing <span
class="inlinecode"><a class="idref" href="#OpPanic"><span
class="id" title="constructor">OpPanic</span></a></span>/<span
class="inlinecode"><a class="idref" href="#OpNearPanicTo"><span
class="id" title="constructor">OpNearPanicTo</span></a></span>, or
internally when some execution invariants are violated. For example,
attempting to execute in user mode an instruction, which is exclusive to
kernel mode, results in panic.</p>
<p>On panic, the persistent state of EraVM is rolled back in the same
way as on revert. See <span
class="inlinecode"><a class="idref" href="#rollback"><span
class="id" title="inductive">rollback</span></a></span>.</p></li>
</ol>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#ArchOverview"><span class="id" title="section">ArchOverview</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a id="timestamp" class="idref" href="#timestamp"><span class="id" title="definition">timestamp</span></a> := <a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a id="tx_num" class="idref" href="#tx_num"><span class="id" title="definition">tx_num</span></a> := <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.PrimitiveValue</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Types</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="PrimitiveValue" class="idref" href="#PrimitiveValue"><span class="id" title="section">PrimitiveValue</span></a>.<br/>
</div>

<div class="doc"><h1 id="primitive-values">Primitive values</h1>
<p><strong>Primitive value</strong> is a tagged word. The tag <span
class="inlinecode"><a class="idref" href="#is_ptr"><span
class="id" title="projection">is_ptr</span></a></span> is a boolean.</p>
<ul>
<li>If <span
class="inlinecode"><a class="idref" href="#is_ptr"><span
class="id" title="projection">is_ptr</span></a></span> is set, it is
guaranteed that the lowest 128-bits of the word contain a serialized
<span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span>. Such values can be
used as operands in instructions that require pointer arguments, for
example, <span
class="inlinecode"><a class="idref" href="#OpPtrAdd"><span
class="id" title="constructor">OpPtrAdd</span></a></span>. The other
half (128 most significant bits) may hold meaningful data, e.g. when
forming a value according to FarCall ABI using <span
class="inlinecode"><span class="id"
title="var">Assembly.OpPtrPack</span></span> instruction.</li>
<li>If <span
class="inlinecode"><a class="idref" href="#is_ptr"><span
class="id" title="projection">is_ptr</span></a></span> is cleared, there
are no guarantees to its value. It may contain an integer, a
representation of a <span
class="inlinecode"><a class="idref" href="#heap_ptr"><span
class="id" title="record">heap_ptr</span></a></span>, a representation
of a <span
class="inlinecode"><a class="idref" href="#span"><span
class="id" title="record">span</span></a></span> of addresses, etc.</li>
</ul>
</div>
<div class="code">
<br/>

<br/>
<span class="id" title="keyword">Context</span> {<a id="word:1" class="idref" href="#word:1"><span class="id" title="binder">word</span></a>:<span class="id" title="keyword">Type</span>}.<br/>
<span class="id" title="keyword">Inductive</span> <a id="primitive_value" class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">mk_pv</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="is_ptr" class="idref" href="#is_ptr"><span class="id" title="projection">is_ptr</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="value" class="idref" href="#value"><span class="id" title="projection">value</span></a>: <a class="idref" href="#PrimitiveValue.word"><span class="id" title="variable">word</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
</div>

<div class="doc"><p>Only <span
class="inlinecode"><a class="idref" href="#Registers"><span
class="id" title="section">Registers</span></a></span> and <span
class="inlinecode"><a class="idref" href="#stack_page"><span
class="id" title="definition">stack_page</span></a></span>s hold
primitive values; other types of memory, including storage and heap
pages, contain non-tagged data.</p>
<p>Function <span
class="inlinecode"><a class="idref" href="#clear_pointer_tag"><span
class="id" title="definition">clear_pointer_tag</span></a></span> clears
the pointer tag of a primitive value.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Definition</span> <a id="clear_pointer_tag" class="idref" href="#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> (<a id="pv:5" class="idref" href="#pv:5"><span class="id" title="binder">pv</span></a>:<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a>): <a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#pv:5"><span class="id" title="variable">pv</span></a> <span class="id" title="keyword">with</span> | <a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">_</span> <a class="idref" href="#value"><span class="id" title="projection">value</span></a> ⇒ <a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a> <span class="id" title="var">value</span> <span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#PrimitiveValue"><span class="id" title="section">PrimitiveValue</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>For brevity, a primitive value is called <strong>a pointer
value</strong> if its tag is set, and <strong>integer value</strong>
otherwise.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Notation</span> <a id="IntValue" class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> := (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a>).<br/>
<span class="id" title="keyword">Notation</span> <a id="PtrValue" class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> := (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="pv0" class="idref" href="#pv0"><span class="id" title="definition">pv0</span></a> := <a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#zero256"><span class="id" title="definition">Types.zero256</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.State</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">ABI</span></a> <a class="idref" href="#"><span class="id" title="library">Core</span></a> <a class="idref" href="#"><span class="id" title="library">Decommitter</span></a> <a class="idref" href="#"><span class="id" title="library">GPR</span></a> <a class="idref" href="#"><span class="id" title="library">Ergs</span></a> <a class="idref" href="#"><span class="id" title="library">Event</span></a> <a class="idref" href="#"><span class="id" title="library">History</span></a> <a class="idref" href="#"><span class="id" title="library">CallStack</span></a> <a class="idref" href="#"><span class="id" title="library">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="library">VMPanic</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect</span> <span class="id" title="module">ssrfun</span> <span class="id" title="module">ssrbool</span> <span class="id" title="module">eqtype</span> <span class="id" title="module">ssreflect.tuple</span> <span class="id" title="module">zmodp</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">RecordSetNotations</span>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Flags</span></a> <a class="idref" href="#"><span class="id" title="module">ZArith</span></a> <a class="idref" href="#"><span class="id" title="module">ABI</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">GPR</span></a> <a class="idref" href="#"><span class="id" title="module">Ergs</span></a> <a class="idref" href="#"><span class="id" title="module">Event</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">History</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryBase</span></a> <a class="idref" href="#"><span class="id" title="module">memory.Depot</span></a> <a class="idref" href="#"><span class="id" title="module">Decommitter</span></a> <a class="idref" href="#"><span class="id" title="module">Predication</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">VMPanic</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="StateDefinitions" class="idref" href="#StateDefinitions"><span class="id" title="section">StateDefinitions</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="exception_handler" class="idref" href="#exception_handler"><span class="id" title="definition">exception_handler</span></a> := <a class="idref" href="#code_address"><span class="id" title="definition">code_address</span></a>.<br/>

<br/>
</div>
<details><summary>helpers </summary><div class="code">
<span class="id" title="keyword">Definition</span> <a id="instruction_invalid" class="idref" href="#instruction_invalid"><span class="id" title="definition">instruction_invalid</span></a> : <a class="idref" href="#predicated"><span class="id" title="record">predicated</span></a> <a class="idref" href="#asm_instruction"><span class="id" title="inductive">Assembly.asm_instruction</span></a> := <a class="idref" href="#invalid"><span class="id" title="definition">invalid</span></a> <a class="idref" href="#OpInvalid"><span class="id" title="constructor">Assembly.OpInvalid</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a id="decommitter" class="idref" href="#decommitter"><span class="id" title="definition">decommitter</span></a> := <a class="idref" href="#decommitter"><span class="id" title="record">decommitter</span></a> <a class="idref" href="#instruction_invalid"><span class="id" title="definition">instruction_invalid</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a id="code_page" class="idref" href="#code_page"><span class="id" title="definition">code_page</span></a> := <a class="idref" href="#code_page"><span class="id" title="record">code_page</span></a> <a class="idref" href="#instruction_invalid"><span class="id" title="definition">instruction_invalid</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a id="memory" class="idref" href="#memory"><span class="id" title="definition">memory</span></a> := @<a class="idref" href="#memory"><span class="id" title="record">memory</span></a> <a class="idref" href="#code_page"><span class="id" title="definition">code_page</span></a> <a class="idref" href="#const_page"><span class="id" title="definition">const_page</span></a> <a class="idref" href="#data_page"><span class="id" title="definition">data_page</span></a> <a class="idref" href="#stack_page"><span class="id" title="definition">stack_page</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a id="query" class="idref" href="#query"><span class="id" title="definition">query</span></a> := @<a class="idref" href="#query"><span class="id" title="inductive">query</span></a> <span class="id" title="notation">[</span> <span class="id" title="notation">eqType</span> <span class="id" title="notation">of</span> <a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a><span class="id" title="notation">]</span> <span class="id" title="notation">[</span><span class="id" title="notation">eqType</span> <span class="id" title="notation">of</span> <a class="idref" href="#params"><span class="id" title="record">PrecompileParametersABI.params</span></a><span class="id" title="notation">]</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="event" class="idref" href="#event"><span class="id" title="definition">event</span></a> := @<a class="idref" href="#event"><span class="id" title="record">event</span></a> <span class="id" title="notation">[</span> <span class="id" title="notation">eqType</span> <span class="id" title="notation">of</span> <a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a><span class="id" title="notation">]</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="page_has_id" class="idref" href="#page_has_id"><span class="id" title="definition">page_has_id</span></a> := @<a class="idref" href="#page_has_id"><span class="id" title="inductive">page_has_id</span></a> <a class="idref" href="#code_page"><span class="id" title="definition">code_page</span></a> <a class="idref" href="#const_page"><span class="id" title="definition">const_page</span></a> <a class="idref" href="#data_page"><span class="id" title="definition">data_page</span></a> <a class="idref" href="#stack_page"><span class="id" title="definition">stack_page</span></a>.<br/>

<br/>

<br/>
</div>
</details><div class="code">

<br/>
</div>

<div class="doc"><h1 id="eravm-state">EraVM state</h1>
<p>EraVM employs a <span
class="inlinecode"><a class="idref" href="#state"><span
class="id" title="record">state</span></a></span> that comprises the
following components:</p>
<ol type="1">
<li>The <span
class="inlinecode"><a class="idref" href="#global_state"><span
class="id" title="record">global_state</span></a></span> contains:</li>
</ol>
<ul>
<li><p>before 1.5: current price of publishing one byte of
<strong>pubdata</strong> to L1 <span
class="inlinecode"><a class="idref" href="#gs_current_ergs_per_pubdata_byte"><span
class="id"
title="projection">gs_current_ergs_per_pubdata_byte</span></a></span>.</p></li>
<li><p>since 1.5: of publishing one byte of <strong>pubdata</strong> to
L1 <span
class="inlinecode"><a class="idref" href="#gs_current_ergs_per_pubdata_byte"><span
class="id"
title="projection">gs_current_ergs_per_pubdata_byte</span></a></span>.</p></li>
<li><p>transaction number in the current block <span
class="inlinecode"><a class="idref" href="#gs_tx_number_in_block"><span
class="id"
title="projection">gs_tx_number_in_block</span></a></span></p></li>
<li><p>decommitter <span
class="inlinecode"><a class="idref" href="#gs_contracts"><span
class="id" title="projection">gs_contracts</span></a></span></p></li>
<li><p>a revertable part <span
class="inlinecode"><a class="idref" href="#state_checkpoint"><span
class="id" title="record">state_checkpoint</span></a></span>. It houses
the <strong>depot</strong> state, embodying all contracts storages
across all shards, as well as two queues for events and L1 messages.</p>
<p>Launching a contract (far call) or a function (near call) defines a
checkpoint. If a contract or a function reverts or panics, the state
rolls back to the latest snapshot (see <span
class="inlinecode"><a class="idref" href="#rollback"><span
class="id" title="inductive">rollback</span></a></span>).</p>
<p>The rollback may be implemented in any efficient way conforming to
this behavior.</p></li>
</ul>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Record</span> <a id="state_checkpoint" class="idref" href="#state_checkpoint"><span class="id" title="record">state_checkpoint</span></a> := {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a id="gs_depot" class="idref" href="#gs_depot"><span class="id" title="projection">gs_depot</span></a>: <a class="idref" href="#depot"><span class="id" title="definition">depot</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a id="gs_events" class="idref" href="#gs_events"><span class="id" title="projection">gs_events</span></a>: @<a class="idref" href="#history"><span class="id" title="definition">history</span></a> <span class="id" title="notation">[</span><span class="id" title="notation">eqType</span> <span class="id" title="notation">of</span> <a class="idref" href="#query"><span class="id" title="definition">query</span></a><span class="id" title="notation">]</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a id="gs_l1_msgs" class="idref" href="#gs_l1_msgs"><span class="id" title="projection">gs_l1_msgs</span></a>: @<a class="idref" href="#history"><span class="id" title="definition">history</span></a> <span class="id" title="notation">[</span><span class="id" title="notation">eqType</span> <span class="id" title="notation">of</span> <a class="idref" href="#event"><span class="id" title="definition">event</span></a><span class="id" title="notation">]</span>;<br/>
&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" title="keyword">Record</span> <a id="global_state" class="idref" href="#global_state"><span class="id" title="record">global_state</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">mk_gstate</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a id="gs_current_ergs_per_pubdata_byte" class="idref" href="#gs_current_ergs_per_pubdata_byte"><span class="id" title="projection">gs_current_ergs_per_pubdata_byte</span></a>: <a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a id="gs_tx_number_in_block" class="idref" href="#gs_tx_number_in_block"><span class="id" title="projection">gs_tx_number_in_block</span></a>: <a class="idref" href="#tx_num"><span class="id" title="definition">tx_num</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a id="gs_contracts" class="idref" href="#gs_contracts"><span class="id" title="projection">gs_contracts</span></a>: <a class="idref" href="#decommitter"><span class="id" title="definition">decommitter</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a id="gs_revertable" class="idref" href="#gs_revertable"><span class="id" title="projection">gs_revertable</span></a>:> <a class="idref" href="#state_checkpoint"><span class="id" title="record">state_checkpoint</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <a id="rollback" class="idref" href="#rollback"><span class="id" title="inductive">rollback</span></a> <a id="checkpoint:11" class="idref" href="#checkpoint:11"><span class="id" title="binder">checkpoint</span></a>: <a class="idref" href="#global_state"><span class="id" title="record">global_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#global_state"><span class="id" title="record">global_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
| <a id="rb_apply" class="idref" href="#rb_apply"><span class="id" title="constructor">rb_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="e:14" class="idref" href="#e:14"><span class="id" title="binder">e</span></a> <a id="tx:15" class="idref" href="#tx:15"><span class="id" title="binder">tx</span></a> <a id="ccs:16" class="idref" href="#ccs:16"><span class="id" title="binder">ccs</span></a> <a id="_cp:17" class="idref" href="#_cp:17"><span class="id" title="binder">_cp</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="#rollback:12"><span class="id" title="inductive">rollback</span></a> <a class="idref" href="#checkpoint:11"><span class="id" title="variable">checkpoint</span></a> (<a class="idref" href="#mk_gstate"><span class="id" title="constructor">mk_gstate</span></a> <a class="idref" href="#e:14"><span class="id" title="variable">e</span></a> <a class="idref" href="#tx:15"><span class="id" title="variable">tx</span></a> <a class="idref" href="#ccs:16"><span class="id" title="variable">ccs</span></a> <a class="idref" href="#_cp:17"><span class="id" title="variable">_cp</span></a>) (<a class="idref" href="#mk_gstate"><span class="id" title="constructor">mk_gstate</span></a> <a class="idref" href="#e:14"><span class="id" title="variable">e</span></a> <a class="idref" href="#tx:15"><span class="id" title="variable">tx</span></a> <a class="idref" href="#ccs:16"><span class="id" title="variable">ccs</span></a> <a class="idref" href="#checkpoint:11"><span class="id" title="variable">checkpoint</span></a>).<br/>

<br/>
</div>

<div class="doc"><ol start="2" type="1">
<li>The <span
class="inlinecode"><a class="idref" href="#transient_state"><span
class="id" title="record">transient_state</span></a></span> contains:
<ul>
<li>flags <span
class="inlinecode"><a class="idref" href="#gs_flags"><span
class="id" title="projection">gs_flags</span></a></span>: boolean values
representing some characteristics of the computation results. See <span
class="inlinecode"><a class="idref" href="#Flags"><span
class="id" title="section">Flags</span></a></span>.</li>
<li>general purpose registers <span
class="inlinecode"><a class="idref" href="#gs_regs"><span
class="id" title="projection">gs_regs</span></a></span>: 15 mutable
tagged words (primitive values) <span
class="inlinecode"><a class="idref" href="#r1"><span
class="id" title="projection">r1</span></a></span>–<span
class="inlinecode"><a class="idref" href="#r15"><span
class="id" title="projection">r15</span></a></span>, and a reserved
read-only zero valued <span class="inlinecode"><span class="id"
title="var">r0</span></span>. See <span
class="inlinecode"><a class="idref" href="#Registers"><span
class="id" title="section">Registers</span></a></span>.</li>
<li>all memory <span
class="inlinecode"><a class="idref" href="#gs_pages"><span
class="id" title="projection">gs_pages</span></a></span> allocated by
VM, including code pages, data stack pages, data pages for heap variants
etc. See <span
class="inlinecode"><a class="idref" href="#memory"><span
class="id" title="definition">memory</span></a></span>.</li>
<li><span
class="inlinecode"><a class="idref" href="#gs_callstack"><span
class="id" title="projection">gs_callstack</span></a></span>, where each
currently running contract and function has a stack frame. Note, that
program counter, data stack pointer, and the remaining ergs allocated
for the current function’s run are parts of a stack frame. See <span
class="inlinecode"><a class="idref" href="#Callstack"><span
class="id" title="section">Callstack</span></a></span>.</li>
<li>128-bit register <span
class="inlinecode"><a class="idref" href="#gs_context_u128"><span
class="id" title="projection">gs_context_u128</span></a></span>. Its
usage is detailed below.</li>
</ul></li>
</ol>
</div>
<div class="code">
<br/>
</div>
<details><summary>helpers </summary><div class="code">
<span class="id" title="keyword">Definition</span> <a id="callstack" class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a> := @<a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="#state_checkpoint"><span class="id" title="record">state_checkpoint</span></a>.<br/>
</div>
</details><div class="code">

<br/>
<span class="id" title="keyword">Record</span> <a id="transient_state" class="idref" href="#transient_state"><span class="id" title="record">transient_state</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">mk_transient_state</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="gs_flags" class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a> : <a class="idref" href="#flags_state"><span class="id" title="record">flags_state</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="gs_regs" class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>: <a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="gs_pages" class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>: <a class="idref" href="#memory"><span class="id" title="definition">memory</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="gs_callstack" class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>: <a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="gs_context_u128" class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a>: <a class="idref" href="#u128"><span class="id" title="definition">u128</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="gs_status" class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>: <a class="idref" href="#status"><span class="id" title="inductive">status</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" title="keyword">Record</span> <a id="state" class="idref" href="#state"><span class="id" title="record">state</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">mk_state</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="gs_transient" class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> :> <a class="idref" href="#transient_state"><span class="id" title="record">transient_state</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="gs_global" class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a> :> <a class="idref" href="#global_state"><span class="id" title="record">global_state</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
</div>

<div class="doc"><h2 id="context-register">Context register</h2>
<p>The 128-bit context value occurs in two places in EraVM:</p>
<ul>
<li>In the mutable <span
class="inlinecode"><a class="idref" href="#gs_context_u128"><span
class="id" title="projection">gs_context_u128</span></a></span>
register, forming a part of the EraVM state <span
class="inlinecode"><a class="idref" href="#state"><span
class="id" title="record">state</span></a></span>.</li>
<li>In the read-only <span
class="inlinecode"><a class="idref" href="#ecf_context_u128_value"><span
class="id" title="projection">ecf_context_u128_value</span></a></span>
of each external call stack frame <span
class="inlinecode"><a class="idref" href="#callstack_external"><span
class="id" title="record">callstack_external</span></a></span>.</li>
</ul>
<p>These values are distinct: the value in callstack is a snapshot of
the register <span
class="inlinecode"><a class="idref" href="#gs_context_u128"><span
class="id" title="projection">gs_context_u128</span></a></span> in a
moment of a far call.</p>
<p>The typical usage of the context value is as follows:</p>
<ol type="1">
<li>Set the value of <span
class="inlinecode"><a class="idref" href="#gs_context_u128"><span
class="id" title="projection">gs_context_u128</span></a></span> to <span
class="math inline">C</span> by executing the instruction <span
class="inlinecode"><span class="id"
title="var">OpContextSetContextU128</span></span>.</li>
<li>Launch a contract using one of the far call instructions. This
action pushes a new <span
class="inlinecode"><a class="idref" href="#callstack_external"><span
class="id" title="record">callstack_external</span></a></span> frame
<span class="math inline">F</span> onto the <span
class="inlinecode"><a class="idref" href="#gs_callstack"><span
class="id" title="projection">gs_callstack</span></a></span>. The value
of the <span class="math inline">F</span>’s field <span
class="inlinecode"><a class="idref" href="#ecf_context_u128_value"><span
class="id" title="projection">ecf_context_u128_value</span></a></span>
is equal to <span class="math inline">C</span>. In addition, far calls
reset <span
class="inlinecode"><a class="idref" href="#gs_context_u128"><span
class="id" title="projection">gs_context_u128</span></a></span> to
0.</li>
<li>Retrieve the context value by executing the instruction <span
class="inlinecode"><span class="id"
title="var">OpContextGetContextU128</span></span> to use it.</li>
<li>On contract code completion, the <span
class="inlinecode"><a class="idref" href="#gs_context_u128"><span
class="id" title="projection">gs_context_u128</span></a></span> is reset
to zero by either <span
class="inlinecode"><a class="idref" href="#OpRet"><span
class="id" title="constructor">OpRet</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpRevert"><span
class="id" title="constructor">OpRevert</span></a></span>, or <span
class="inlinecode"><a class="idref" href="#OpPanic"><span
class="id" title="constructor">OpPanic</span></a></span>.</li>
</ol>
<p>Note that setting the context register <span
class="inlinecode"><a class="idref" href="#gs_context_u128"><span
class="id" title="projection">gs_context_u128</span></a></span> is
forbidden in <span
class="inlinecode"><a class="idref" href="#StaticMode"><span
class="id" title="section">StaticMode</span></a></span>. See <span
class="inlinecode"><a class="idref" href="#forbidden_static"><span
class="id" title="definition">forbidden_static</span></a></span>.</p>
<p>Context is used to simulate <code>msg.value</code>, a Solidity
construction standing for the amount of wei sent in a transaction. The
system contract <code>MsgValueSimulator</code> is responsible for
ensuring that whenever this context value is set to <span
class="math inline">C</span>, there are indeed <span
class="math inline">C</span> wei transferred to the callee.</p>
</div>
<div class="code">
<br/>

<br/>

<br/>
</div>
<details><summary>Helpers </summary><div class="code">
<span class="id" title="keyword">Inductive</span> <a id="global_state_new_depot" class="idref" href="#global_state_new_depot"><span class="id" title="inductive">global_state_new_depot</span></a>: <a class="idref" href="#depot"><span class="id" title="definition">depot</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#global_state"><span class="id" title="record">global_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#global_state"><span class="id" title="record">global_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
| <a id="gsnd_apply" class="idref" href="#gsnd_apply"><span class="id" title="constructor">gsnd_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="current_ergs_per_pubdata_byte:30" class="idref" href="#current_ergs_per_pubdata_byte:30"><span class="id" title="binder">current_ergs_per_pubdata_byte</span></a> <a id="tx:31" class="idref" href="#tx:31"><span class="id" title="binder">tx</span></a> <a id="codes:32" class="idref" href="#codes:32"><span class="id" title="binder">codes</span></a> <a id="d:33" class="idref" href="#d:33"><span class="id" title="binder">d</span></a> <a id="evs:34" class="idref" href="#evs:34"><span class="id" title="binder">evs</span></a> <a id="l1s:35" class="idref" href="#l1s:35"><span class="id" title="binder">l1s</span></a> <a id="d':36" class="idref" href="#d':36"><span class="id" title="binder">d'</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="#global_state_new_depot:28"><span class="id" title="inductive">global_state_new_depot</span></a> <a class="idref" href="#d':36"><span class="id" title="variable">d'</span></a><br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_current_ergs_per_pubdata_byte"><span class="id" title="projection">gs_current_ergs_per_pubdata_byte</span></a> := <a class="idref" href="#current_ergs_per_pubdata_byte:30"><span class="id" title="variable">current_ergs_per_pubdata_byte</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_tx_number_in_block"><span class="id" title="projection">gs_tx_number_in_block</span></a> := <a class="idref" href="#tx:31"><span class="id" title="variable">tx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_contracts"><span class="id" title="projection">gs_contracts</span></a> := <a class="idref" href="#codes:32"><span class="id" title="variable">codes</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_revertable"><span class="id" title="projection">gs_revertable</span></a> := {| <a class="idref" href="#gs_depot"><span class="id" title="projection">gs_depot</span></a> := <a class="idref" href="#d:33"><span class="id" title="variable">d</span></a>; <a class="idref" href="#gs_events"><span class="id" title="projection">gs_events</span></a> := <a class="idref" href="#evs:34"><span class="id" title="variable">evs</span></a>; <a class="idref" href="#gs_l1_msgs"><span class="id" title="projection">gs_l1_msgs</span></a> := <a class="idref" href="#l1s:35"><span class="id" title="variable">l1s</span></a> |} ;<br/>
&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_current_ergs_per_pubdata_byte"><span class="id" title="projection">gs_current_ergs_per_pubdata_byte</span></a> := <a class="idref" href="#current_ergs_per_pubdata_byte:30"><span class="id" title="variable">current_ergs_per_pubdata_byte</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_tx_number_in_block"><span class="id" title="projection">gs_tx_number_in_block</span></a> := <a class="idref" href="#tx:31"><span class="id" title="variable">tx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_contracts"><span class="id" title="projection">gs_contracts</span></a> := <a class="idref" href="#codes:32"><span class="id" title="variable">codes</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_revertable"><span class="id" title="projection">gs_revertable</span></a> := {| <a class="idref" href="#gs_depot"><span class="id" title="projection">gs_depot</span></a> := <a class="idref" href="#d':36"><span class="id" title="variable">d'</span></a>; <a class="idref" href="#gs_events"><span class="id" title="projection">gs_events</span></a> := <a class="idref" href="#evs:34"><span class="id" title="variable">evs</span></a>; <a class="idref" href="#gs_l1_msgs"><span class="id" title="projection">gs_l1_msgs</span></a> := <a class="idref" href="#l1s:35"><span class="id" title="variable">l1s</span></a> |} ;<br/>
&nbsp;&nbsp;|}.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <a id="emit_event" class="idref" href="#emit_event"><span class="id" title="inductive">emit_event</span></a> <a id="e:37" class="idref" href="#e:37"><span class="id" title="binder">e</span></a>: <a class="idref" href="#global_state"><span class="id" title="record">global_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#global_state"><span class="id" title="record">global_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
| <a id="ee_apply" class="idref" href="#ee_apply"><span class="id" title="constructor">ee_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="current_ergs_per_pubdata_byte:40" class="idref" href="#current_ergs_per_pubdata_byte:40"><span class="id" title="binder">current_ergs_per_pubdata_byte</span></a> <a id="tx:41" class="idref" href="#tx:41"><span class="id" title="binder">tx</span></a> <a id="codes:42" class="idref" href="#codes:42"><span class="id" title="binder">codes</span></a> <a id="d:43" class="idref" href="#d:43"><span class="id" title="binder">d</span></a> <a id="evs:44" class="idref" href="#evs:44"><span class="id" title="binder">evs</span></a> <a id="l1s:45" class="idref" href="#l1s:45"><span class="id" title="binder">l1s</span></a> <a id="d':46" class="idref" href="#d':46"><span class="id" title="binder">d'</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="#emit_event:38"><span class="id" title="inductive">emit_event</span></a> <a class="idref" href="#e:37"><span class="id" title="variable">e</span></a><br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_current_ergs_per_pubdata_byte"><span class="id" title="projection">gs_current_ergs_per_pubdata_byte</span></a> := <a class="idref" href="#current_ergs_per_pubdata_byte:40"><span class="id" title="variable">current_ergs_per_pubdata_byte</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_tx_number_in_block"><span class="id" title="projection">gs_tx_number_in_block</span></a> := <a class="idref" href="#tx:41"><span class="id" title="variable">tx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_contracts"><span class="id" title="projection">gs_contracts</span></a> := <a class="idref" href="#codes:42"><span class="id" title="variable">codes</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_revertable"><span class="id" title="projection">gs_revertable</span></a> := {| <a class="idref" href="#gs_depot"><span class="id" title="projection">gs_depot</span></a> := <a class="idref" href="#d:43"><span class="id" title="variable">d</span></a>; <a class="idref" href="#gs_events"><span class="id" title="projection">gs_events</span></a> := <a class="idref" href="#evs:44"><span class="id" title="variable">evs</span></a>; <a class="idref" href="#gs_l1_msgs"><span class="id" title="projection">gs_l1_msgs</span></a> := <a class="idref" href="#l1s:45"><span class="id" title="variable">l1s</span></a> |} ;<br/>
&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_current_ergs_per_pubdata_byte"><span class="id" title="projection">gs_current_ergs_per_pubdata_byte</span></a> := <a class="idref" href="#current_ergs_per_pubdata_byte:40"><span class="id" title="variable">current_ergs_per_pubdata_byte</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_tx_number_in_block"><span class="id" title="projection">gs_tx_number_in_block</span></a> := <a class="idref" href="#tx:41"><span class="id" title="variable">tx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_contracts"><span class="id" title="projection">gs_contracts</span></a> := <a class="idref" href="#codes:42"><span class="id" title="variable">codes</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_revertable"><span class="id" title="projection">gs_revertable</span></a> := {| <a class="idref" href="#gs_depot"><span class="id" title="projection">gs_depot</span></a> := <a class="idref" href="#d':46"><span class="id" title="variable">d'</span></a>; <a class="idref" href="#gs_events"><span class="id" title="projection">gs_events</span></a> := <a class="idref" href="#e:37"><span class="id" title="variable">e</span></a><span class="id" title="notation">::</span><a class="idref" href="#evs:44"><span class="id" title="variable">evs</span></a>; <a class="idref" href="#gs_l1_msgs"><span class="id" title="projection">gs_l1_msgs</span></a> := <a class="idref" href="#l1s:45"><span class="id" title="variable">l1s</span></a> |} ;<br/>
&nbsp;&nbsp;|}.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <a id="emit_l1_msg" class="idref" href="#emit_l1_msg"><span class="id" title="inductive">emit_l1_msg</span></a> <a id="e:47" class="idref" href="#e:47"><span class="id" title="binder">e</span></a>: <a class="idref" href="#global_state"><span class="id" title="record">global_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#global_state"><span class="id" title="record">global_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
| <a id="eel1_apply" class="idref" href="#eel1_apply"><span class="id" title="constructor">eel1_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="current_ergs_per_pubdata_byte:50" class="idref" href="#current_ergs_per_pubdata_byte:50"><span class="id" title="binder">current_ergs_per_pubdata_byte</span></a> <a id="tx:51" class="idref" href="#tx:51"><span class="id" title="binder">tx</span></a> <a id="codes:52" class="idref" href="#codes:52"><span class="id" title="binder">codes</span></a> <a id="d:53" class="idref" href="#d:53"><span class="id" title="binder">d</span></a> <a id="evs:54" class="idref" href="#evs:54"><span class="id" title="binder">evs</span></a> <a id="l1s:55" class="idref" href="#l1s:55"><span class="id" title="binder">l1s</span></a> <a id="d':56" class="idref" href="#d':56"><span class="id" title="binder">d'</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="#emit_l1_msg:48"><span class="id" title="inductive">emit_l1_msg</span></a> <a class="idref" href="#e:47"><span class="id" title="variable">e</span></a><br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_current_ergs_per_pubdata_byte"><span class="id" title="projection">gs_current_ergs_per_pubdata_byte</span></a> := <a class="idref" href="#current_ergs_per_pubdata_byte:50"><span class="id" title="variable">current_ergs_per_pubdata_byte</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_tx_number_in_block"><span class="id" title="projection">gs_tx_number_in_block</span></a> := <a class="idref" href="#tx:51"><span class="id" title="variable">tx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_contracts"><span class="id" title="projection">gs_contracts</span></a> := <a class="idref" href="#codes:52"><span class="id" title="variable">codes</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_revertable"><span class="id" title="projection">gs_revertable</span></a> := {| <a class="idref" href="#gs_depot"><span class="id" title="projection">gs_depot</span></a> := <a class="idref" href="#d:53"><span class="id" title="variable">d</span></a>; <a class="idref" href="#gs_events"><span class="id" title="projection">gs_events</span></a> := <a class="idref" href="#evs:54"><span class="id" title="variable">evs</span></a>; <a class="idref" href="#gs_l1_msgs"><span class="id" title="projection">gs_l1_msgs</span></a> := <a class="idref" href="#l1s:55"><span class="id" title="variable">l1s</span></a> |} ;<br/>
&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_current_ergs_per_pubdata_byte"><span class="id" title="projection">gs_current_ergs_per_pubdata_byte</span></a> := <a class="idref" href="#current_ergs_per_pubdata_byte:50"><span class="id" title="variable">current_ergs_per_pubdata_byte</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_tx_number_in_block"><span class="id" title="projection">gs_tx_number_in_block</span></a> := <a class="idref" href="#tx:51"><span class="id" title="variable">tx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_contracts"><span class="id" title="projection">gs_contracts</span></a> := <a class="idref" href="#codes:52"><span class="id" title="variable">codes</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_revertable"><span class="id" title="projection">gs_revertable</span></a> := {| <a class="idref" href="#gs_depot"><span class="id" title="projection">gs_depot</span></a> := <a class="idref" href="#d':56"><span class="id" title="variable">d'</span></a>; <a class="idref" href="#gs_events"><span class="id" title="projection">gs_events</span></a> := <a class="idref" href="#evs:54"><span class="id" title="variable">evs</span></a>; <a class="idref" href="#gs_l1_msgs"><span class="id" title="projection">gs_l1_msgs</span></a> := <a class="idref" href="#e:47"><span class="id" title="variable">e</span></a><span class="id" title="notation">::</span><a class="idref" href="#l1s:55"><span class="id" title="variable">l1s</span></a> |} ;<br/>
&nbsp;&nbsp;|}.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <a id="tx_inc" class="idref" href="#tx_inc"><span class="id" title="inductive">tx_inc</span></a> : <a class="idref" href="#tx_num"><span class="id" title="definition">tx_num</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#tx_num"><span class="id" title="definition">tx_num</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> := | <a id="txi_apply" class="idref" href="#txi_apply"><span class="id" title="constructor">txi_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="n:59" class="idref" href="#n:59"><span class="id" title="binder">n</span></a> <a id="m:60" class="idref" href="#m:60"><span class="id" title="binder">m</span></a>, <a class="idref" href="#uinc_of"><span class="id" title="definition">uinc_of</span></a> <a class="idref" href="#n:59"><span class="id" title="variable">n</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#m:60"><span class="id" title="variable">m</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#tx_inc:57"><span class="id" title="inductive">tx_inc</span></a> <a class="idref" href="#n:59"><span class="id" title="variable">n</span></a> <a class="idref" href="#m:60"><span class="id" title="variable">m</span></a>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <a id="global_state_increment_tx" class="idref" href="#global_state_increment_tx"><span class="id" title="inductive">global_state_increment_tx</span></a> <a id="tx_mod:61" class="idref" href="#tx_mod:61"><span class="id" title="binder">tx_mod</span></a>: <a class="idref" href="#global_state"><span class="id" title="record">global_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#global_state"><span class="id" title="record">global_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
| <a id="gsit_apply" class="idref" href="#gsit_apply"><span class="id" title="constructor">gsit_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="current_ergs_per_pubdata_byte:64" class="idref" href="#current_ergs_per_pubdata_byte:64"><span class="id" title="binder">current_ergs_per_pubdata_byte</span></a> <a id="tx:65" class="idref" href="#tx:65"><span class="id" title="binder">tx</span></a> <a id="new_tx:66" class="idref" href="#new_tx:66"><span class="id" title="binder">new_tx</span></a> <a id="codes:67" class="idref" href="#codes:67"><span class="id" title="binder">codes</span></a> <a id="rev:68" class="idref" href="#rev:68"><span class="id" title="binder">rev</span></a> ,<br/>
&nbsp;&nbsp;<a class="idref" href="#tx_mod:61"><span class="id" title="variable">tx_mod</span></a> <a class="idref" href="#tx:65"><span class="id" title="variable">tx</span></a> <a class="idref" href="#new_tx:66"><span class="id" title="variable">new_tx</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#global_state_increment_tx:62"><span class="id" title="inductive">global_state_increment_tx</span></a> <a class="idref" href="#tx_mod:61"><span class="id" title="variable">tx_mod</span></a><br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_current_ergs_per_pubdata_byte"><span class="id" title="projection">gs_current_ergs_per_pubdata_byte</span></a> := <a class="idref" href="#current_ergs_per_pubdata_byte:64"><span class="id" title="variable">current_ergs_per_pubdata_byte</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_tx_number_in_block"><span class="id" title="projection">gs_tx_number_in_block</span></a> := <a class="idref" href="#tx:65"><span class="id" title="variable">tx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_contracts"><span class="id" title="projection">gs_contracts</span></a> := <a class="idref" href="#codes:67"><span class="id" title="variable">codes</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_revertable"><span class="id" title="projection">gs_revertable</span></a> := <a class="idref" href="#rev:68"><span class="id" title="variable">rev</span></a>;<br/>
&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_current_ergs_per_pubdata_byte"><span class="id" title="projection">gs_current_ergs_per_pubdata_byte</span></a> := <a class="idref" href="#current_ergs_per_pubdata_byte:64"><span class="id" title="variable">current_ergs_per_pubdata_byte</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_tx_number_in_block"><span class="id" title="projection">gs_tx_number_in_block</span></a> := <a class="idref" href="#new_tx:66"><span class="id" title="variable">new_tx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_contracts"><span class="id" title="projection">gs_contracts</span></a> := <a class="idref" href="#codes:67"><span class="id" title="variable">codes</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_revertable"><span class="id" title="projection">gs_revertable</span></a> := <a class="idref" href="#rev:68"><span class="id" title="variable">rev</span></a>;<br/>
&nbsp;&nbsp;|}.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#StateDefinitions"><span class="id" title="section">StateDefinitions</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="heap_variant_page_id" class="idref" href="#heap_variant_page_id"><span class="id" title="definition">heap_variant_page_id</span></a> (<a id="page_type:69" class="idref" href="#page_type:69"><span class="id" title="binder">page_type</span></a>: <a class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#page_type:69"><span class="id" title="variable">page_type</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#Heap"><span class="id" title="constructor">Heap</span></a> ⇒ @<a class="idref" href="#active_heap_id"><span class="id" title="definition">active_heap_id</span></a> <a class="idref" href="#state_checkpoint"><span class="id" title="record">state_checkpoint</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#AuxHeap"><span class="id" title="constructor">AuxHeap</span></a> ⇒ @<a class="idref" href="#active_auxheap_id"><span class="id" title="definition">active_auxheap_id</span></a> <a class="idref" href="#state_checkpoint"><span class="id" title="record">state_checkpoint</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="heap_variant_page" class="idref" href="#heap_variant_page"><span class="id" title="definition">heap_variant_page</span></a> (<a id="page_type:71" class="idref" href="#page_type:71"><span class="id" title="binder">page_type</span></a>: <a class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a>) (<a id="cs:72" class="idref" href="#cs:72"><span class="id" title="binder">cs</span></a>:<a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a>) (<a id="mem:73" class="idref" href="#mem:73"><span class="id" title="binder">mem</span></a>:<a class="idref" href="#memory"><span class="id" title="definition">memory</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#page_type:71"><span class="id" title="variable">page_type</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Heap"><span class="id" title="constructor">Heap</span></a> ⇒ <a class="idref" href="#active_heappage"><span class="id" title="inductive">active_heappage</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#AuxHeap"><span class="id" title="constructor">AuxHeap</span></a> ⇒  <a class="idref" href="#active_auxheappage"><span class="id" title="inductive">active_auxheappage</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> (<a class="idref" href="#page_has_id"><span class="id" title="definition">page_has_id</span></a> <a class="idref" href="#mem:73"><span class="id" title="variable">mem</span></a>) <a class="idref" href="#cs:72"><span class="id" title="variable">cs</span></a> .<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="heap_variant_id" class="idref" href="#heap_variant_id"><span class="id" title="definition">heap_variant_id</span></a> (<a id="page_type:75" class="idref" href="#page_type:75"><span class="id" title="binder">page_type</span></a>: <a class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a>)<br/>
&nbsp;&nbsp;:  <a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#page_type:75"><span class="id" title="variable">page_type</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#Heap"><span class="id" title="constructor">Heap</span></a> ⇒ @<a class="idref" href="#active_heap_id"><span class="id" title="definition">active_heap_id</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#AuxHeap"><span class="id" title="constructor">AuxHeap</span></a> ⇒ @<a class="idref" href="#active_auxheap_id"><span class="id" title="definition">active_auxheap_id</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="#state_checkpoint"><span class="id" title="record">state_checkpoint</span></a>.<br/>

<br/>
</div>
</details><div class="code">
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.GPR</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Core</span></a> <a class="idref" href="#"><span class="id" title="library">List</span></a> <a class="idref" href="#"><span class="id" title="library">PrimitiveValue</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Registers" class="idref" href="#Registers"><span class="id" title="section">Registers</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <span class="id" title="module">RecordSetNotations</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="pv:1" class="idref" href="#pv:1"><span class="id" title="binder">pv</span></a> := @<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> <a class="idref" href="#word"><span class="id" title="definition">Core.word</span></a>).<br/>

<br/>
</div>

<div class="doc"><h1 id="gpr-general-purpose-registers">GPR (General Purpose
Registers)</h1>
<p>EraVM has 15 mutable general purpose registers R1, R2, …, R15. They
hold <span
class="inlinecode"><a class="idref" href="#primitive_value"><span
class="id" title="record">primitive_value</span></a></span> <span
class="inlinecode"><a class="idref" href="#word"><span
class="id" title="definition">word</span></a></span>, so they are tagged
256-bit words. The tag is set when the register contains a fat pointer
in its 128 least significant bits (it may contain other useful data in
topmost 128-bits; this is used e.g. for encoding parameters of <span
class="inlinecode"><span class="id"
title="var">FarCall</span></span>).</p>
<p>Additionally, EraVM has one read-only, <strong>constant
register</strong> R0 which evaluates to <span
class="inlinecode"><a class="idref" href="#IntValue"><span
class="id" title="abbreviation">IntValue</span></a></span> <span
class="inlinecode">0</span>, that is, an untagged integer 0.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="reg_name" class="idref" href="#reg_name"><span class="id" title="inductive">reg_name</span></a> : <span class="id" title="keyword">Set</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a id="R0" class="idref" href="#R0"><span class="id" title="constructor">R0</span></a> | <a id="R1" class="idref" href="#R1"><span class="id" title="constructor">R1</span></a> | <a id="R2" class="idref" href="#R2"><span class="id" title="constructor">R2</span></a> | <a id="R3" class="idref" href="#R3"><span class="id" title="constructor">R3</span></a> | <a id="R4" class="idref" href="#R4"><span class="id" title="constructor">R4</span></a> | <a id="R5" class="idref" href="#R5"><span class="id" title="constructor">R5</span></a> | <a id="R6" class="idref" href="#R6"><span class="id" title="constructor">R6</span></a> | <a id="R7" class="idref" href="#R7"><span class="id" title="constructor">R7</span></a> | <a id="R8" class="idref" href="#R8"><span class="id" title="constructor">R8</span></a> | <a id="R9" class="idref" href="#R9"><span class="id" title="constructor">R9</span></a> | <a id="R10" class="idref" href="#R10"><span class="id" title="constructor">R10</span></a> | <a id="R11" class="idref" href="#R11"><span class="id" title="constructor">R11</span></a> | <a id="R12" class="idref" href="#R12"><span class="id" title="constructor">R12</span></a> | <a id="R13" class="idref" href="#R13"><span class="id" title="constructor">R13</span></a><br/>
&nbsp;&nbsp;| <a id="R14" class="idref" href="#R14"><span class="id" title="constructor">R14</span></a> | <a id="R15" class="idref" href="#R15"><span class="id" title="constructor">R15</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="regs_state" class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a> :=  <span class="id" title="var">mk_regs</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="r1" class="idref" href="#r1"><span class="id" title="projection">r1</span></a>   : <a class="idref" href="#Registers.pv"><span class="id" title="variable">pv</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="r2" class="idref" href="#r2"><span class="id" title="projection">r2</span></a>   : <a class="idref" href="#Registers.pv"><span class="id" title="variable">pv</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="r3" class="idref" href="#r3"><span class="id" title="projection">r3</span></a>   : <a class="idref" href="#Registers.pv"><span class="id" title="variable">pv</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="r4" class="idref" href="#r4"><span class="id" title="projection">r4</span></a>   : <a class="idref" href="#Registers.pv"><span class="id" title="variable">pv</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="r5" class="idref" href="#r5"><span class="id" title="projection">r5</span></a>   : <a class="idref" href="#Registers.pv"><span class="id" title="variable">pv</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="r6" class="idref" href="#r6"><span class="id" title="projection">r6</span></a>   : <a class="idref" href="#Registers.pv"><span class="id" title="variable">pv</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="r7" class="idref" href="#r7"><span class="id" title="projection">r7</span></a>   : <a class="idref" href="#Registers.pv"><span class="id" title="variable">pv</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="r8" class="idref" href="#r8"><span class="id" title="projection">r8</span></a>   : <a class="idref" href="#Registers.pv"><span class="id" title="variable">pv</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="r9" class="idref" href="#r9"><span class="id" title="projection">r9</span></a>   : <a class="idref" href="#Registers.pv"><span class="id" title="variable">pv</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="r10" class="idref" href="#r10"><span class="id" title="projection">r10</span></a>  : <a class="idref" href="#Registers.pv"><span class="id" title="variable">pv</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="r11" class="idref" href="#r11"><span class="id" title="projection">r11</span></a>  : <a class="idref" href="#Registers.pv"><span class="id" title="variable">pv</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="r12" class="idref" href="#r12"><span class="id" title="projection">r12</span></a>  : <a class="idref" href="#Registers.pv"><span class="id" title="variable">pv</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="r13" class="idref" href="#r13"><span class="id" title="projection">r13</span></a>  : <a class="idref" href="#Registers.pv"><span class="id" title="variable">pv</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="r14" class="idref" href="#r14"><span class="id" title="projection">r14</span></a>  : <a class="idref" href="#Registers.pv"><span class="id" title="variable">pv</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="r15" class="idref" href="#r15"><span class="id" title="projection">r15</span></a>  : <a class="idref" href="#Registers.pv"><span class="id" title="variable">pv</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>

<br/>
</div>

<div class="doc"><p>Function <span
class="inlinecode"><a class="idref" href="#fetch_gpr"><span
class="id" title="definition">fetch_gpr</span></a></span> loads a value
from register.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="fetch_gpr" class="idref" href="#fetch_gpr"><span class="id" title="definition">fetch_gpr</span></a> (<a id="rs:23" class="idref" href="#rs:23"><span class="id" title="binder">rs</span></a>:<a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a>) (<a id="r:24" class="idref" href="#r:24"><span class="id" title="binder">r</span></a>:<a class="idref" href="#reg_name"><span class="id" title="inductive">reg_name</span></a>) : <a class="idref" href="#Registers.pv"><span class="id" title="variable">pv</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#r:24"><span class="id" title="variable">r</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R0"><span class="id" title="constructor">R0</span></a> ⇒ <a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#word0"><span class="id" title="definition">word0</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R1"><span class="id" title="constructor">R1</span></a> ⇒ <a class="idref" href="#r1"><span class="id" title="projection">r1</span></a> <a class="idref" href="#rs:23"><span class="id" title="variable">rs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R2"><span class="id" title="constructor">R2</span></a> ⇒ <a class="idref" href="#r2"><span class="id" title="projection">r2</span></a> <a class="idref" href="#rs:23"><span class="id" title="variable">rs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R3"><span class="id" title="constructor">R3</span></a> ⇒ <a class="idref" href="#r3"><span class="id" title="projection">r3</span></a> <a class="idref" href="#rs:23"><span class="id" title="variable">rs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R4"><span class="id" title="constructor">R4</span></a> ⇒ <a class="idref" href="#r4"><span class="id" title="projection">r4</span></a> <a class="idref" href="#rs:23"><span class="id" title="variable">rs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R5"><span class="id" title="constructor">R5</span></a> ⇒ <a class="idref" href="#r5"><span class="id" title="projection">r5</span></a> <a class="idref" href="#rs:23"><span class="id" title="variable">rs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R6"><span class="id" title="constructor">R6</span></a> ⇒ <a class="idref" href="#r6"><span class="id" title="projection">r6</span></a> <a class="idref" href="#rs:23"><span class="id" title="variable">rs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R7"><span class="id" title="constructor">R7</span></a> ⇒ <a class="idref" href="#r7"><span class="id" title="projection">r7</span></a> <a class="idref" href="#rs:23"><span class="id" title="variable">rs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R8"><span class="id" title="constructor">R8</span></a> ⇒ <a class="idref" href="#r8"><span class="id" title="projection">r8</span></a> <a class="idref" href="#rs:23"><span class="id" title="variable">rs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R9"><span class="id" title="constructor">R9</span></a> ⇒ <a class="idref" href="#r9"><span class="id" title="projection">r9</span></a> <a class="idref" href="#rs:23"><span class="id" title="variable">rs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R10"><span class="id" title="constructor">R10</span></a> ⇒ <a class="idref" href="#r10"><span class="id" title="projection">r10</span></a> <a class="idref" href="#rs:23"><span class="id" title="variable">rs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R11"><span class="id" title="constructor">R11</span></a> ⇒ <a class="idref" href="#r11"><span class="id" title="projection">r11</span></a> <a class="idref" href="#rs:23"><span class="id" title="variable">rs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R12"><span class="id" title="constructor">R12</span></a> ⇒ <a class="idref" href="#r12"><span class="id" title="projection">r12</span></a> <a class="idref" href="#rs:23"><span class="id" title="variable">rs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R13"><span class="id" title="constructor">R13</span></a> ⇒ <a class="idref" href="#r13"><span class="id" title="projection">r13</span></a> <a class="idref" href="#rs:23"><span class="id" title="variable">rs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R14"><span class="id" title="constructor">R14</span></a> ⇒ <a class="idref" href="#r14"><span class="id" title="projection">r14</span></a> <a class="idref" href="#rs:23"><span class="id" title="variable">rs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R15"><span class="id" title="constructor">R15</span></a> ⇒ <a class="idref" href="#r15"><span class="id" title="projection">r15</span></a> <a class="idref" href="#rs:23"><span class="id" title="variable">rs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>
<details><summary>helpers </summary><div class="code">

<br/>
&nbsp;&nbsp;#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Instance</span> <a id="etaGPRs" class="idref" href="#etaGPRs"><span class="id" title="instance">etaGPRs</span></a> : <span class="id" title="class">Settable</span> <span class="id" title="var">_</span> := <span class="id" title="notation">settable</span><span class="id" title="notation">!</span> <a class="idref" href="#mk_regs"><span class="id" title="constructor">mk_regs</span></a> <span class="id" title="notation"><</span> <a class="idref" href="#r1"><span class="id" title="projection">r1</span></a><span class="id" title="notation">;</span> <a class="idref" href="#r2"><span class="id" title="projection">r2</span></a><span class="id" title="notation">;</span> <a class="idref" href="#r3"><span class="id" title="projection">r3</span></a><span class="id" title="notation">;</span> <a class="idref" href="#r4"><span class="id" title="projection">r4</span></a><span class="id" title="notation">;</span> <a class="idref" href="#r5"><span class="id" title="projection">r5</span></a><span class="id" title="notation">;</span> <a class="idref" href="#r6"><span class="id" title="projection">r6</span></a><span class="id" title="notation">;</span> <a class="idref" href="#r7"><span class="id" title="projection">r7</span></a><span class="id" title="notation">;</span> <a class="idref" href="#r8"><span class="id" title="projection">r8</span></a><span class="id" title="notation">;</span> <a class="idref" href="#r9"><span class="id" title="projection">r9</span></a><span class="id" title="notation">;</span> <a class="idref" href="#r10"><span class="id" title="projection">r10</span></a><span class="id" title="notation">;</span> <a class="idref" href="#r11"><span class="id" title="projection">r11</span></a><span class="id" title="notation">;</span> <a class="idref" href="#r12"><span class="id" title="projection">r12</span></a><span class="id" title="notation">;</span> <a class="idref" href="#r13"><span class="id" title="projection">r13</span></a><span class="id" title="notation">;</span> <a class="idref" href="#r14"><span class="id" title="projection">r14</span></a><span class="id" title="notation">;</span> <a class="idref" href="#r15"><span class="id" title="projection">r15</span></a> <span class="id" title="notation">></span>.<br/>
</div>

<div class="doc"><p>Predicate <span
class="inlinecode"><a class="idref" href="#store_gpr"><span
class="id" title="definition">store_gpr</span></a></span> stores value
to a general purpose register. Storing to <span
class="inlinecode"><a class="idref" href="#R0"><span
class="id" title="constructor">R0</span></a></span> is ignored.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="store_gpr" class="idref" href="#store_gpr"><span class="id" title="definition">store_gpr</span></a> (<a id="rs:26" class="idref" href="#rs:26"><span class="id" title="binder">rs</span></a>: <a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a>) (<a id="name:27" class="idref" href="#name:27"><span class="id" title="binder">name</span></a>: <a class="idref" href="#reg_name"><span class="id" title="inductive">reg_name</span></a>) (<a id="pv:28" class="idref" href="#pv:28"><span class="id" title="binder">pv</span></a>: <a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a>) : <a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#name:27"><span class="id" title="variable">name</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R0"><span class="id" title="constructor">R0</span></a> ⇒ <a class="idref" href="#rs:26"><span class="id" title="variable">rs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R1"><span class="id" title="constructor">R1</span></a> ⇒ <a class="idref" href="#rs:26"><span class="id" title="variable">rs</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#r1"><span class="id" title="projection">r1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#pv:28"><span class="id" title="variable">pv</span></a><span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R2"><span class="id" title="constructor">R2</span></a> ⇒ <a class="idref" href="#rs:26"><span class="id" title="variable">rs</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#r2"><span class="id" title="projection">r2</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#pv:28"><span class="id" title="variable">pv</span></a><span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R3"><span class="id" title="constructor">R3</span></a> ⇒ <a class="idref" href="#rs:26"><span class="id" title="variable">rs</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#r3"><span class="id" title="projection">r3</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#pv:28"><span class="id" title="variable">pv</span></a><span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R4"><span class="id" title="constructor">R4</span></a> ⇒ <a class="idref" href="#rs:26"><span class="id" title="variable">rs</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#r4"><span class="id" title="projection">r4</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#pv:28"><span class="id" title="variable">pv</span></a><span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R5"><span class="id" title="constructor">R5</span></a> ⇒ <a class="idref" href="#rs:26"><span class="id" title="variable">rs</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#r5"><span class="id" title="projection">r5</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#pv:28"><span class="id" title="variable">pv</span></a><span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R6"><span class="id" title="constructor">R6</span></a> ⇒ <a class="idref" href="#rs:26"><span class="id" title="variable">rs</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#r6"><span class="id" title="projection">r6</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#pv:28"><span class="id" title="variable">pv</span></a><span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R7"><span class="id" title="constructor">R7</span></a> ⇒ <a class="idref" href="#rs:26"><span class="id" title="variable">rs</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#r7"><span class="id" title="projection">r7</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#pv:28"><span class="id" title="variable">pv</span></a><span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R8"><span class="id" title="constructor">R8</span></a> ⇒ <a class="idref" href="#rs:26"><span class="id" title="variable">rs</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#r8"><span class="id" title="projection">r8</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#pv:28"><span class="id" title="variable">pv</span></a><span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R9"><span class="id" title="constructor">R9</span></a> ⇒ <a class="idref" href="#rs:26"><span class="id" title="variable">rs</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#r9"><span class="id" title="projection">r9</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#pv:28"><span class="id" title="variable">pv</span></a><span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R10"><span class="id" title="constructor">R10</span></a> ⇒<a class="idref" href="#rs:26"><span class="id" title="variable">rs</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#r10"><span class="id" title="projection">r10</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#pv:28"><span class="id" title="variable">pv</span></a><span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R11"><span class="id" title="constructor">R11</span></a> ⇒<a class="idref" href="#rs:26"><span class="id" title="variable">rs</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#r11"><span class="id" title="projection">r11</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#pv:28"><span class="id" title="variable">pv</span></a><span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R12"><span class="id" title="constructor">R12</span></a> ⇒<a class="idref" href="#rs:26"><span class="id" title="variable">rs</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#r12"><span class="id" title="projection">r12</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#pv:28"><span class="id" title="variable">pv</span></a><span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R13"><span class="id" title="constructor">R13</span></a> ⇒<a class="idref" href="#rs:26"><span class="id" title="variable">rs</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#r13"><span class="id" title="projection">r13</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#pv:28"><span class="id" title="variable">pv</span></a><span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R14"><span class="id" title="constructor">R14</span></a> ⇒<a class="idref" href="#rs:26"><span class="id" title="variable">rs</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#r14"><span class="id" title="projection">r14</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#pv:28"><span class="id" title="variable">pv</span></a><span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#R15"><span class="id" title="constructor">R15</span></a> ⇒<a class="idref" href="#rs:26"><span class="id" title="variable">rs</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#r15"><span class="id" title="projection">r15</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#pv:28"><span class="id" title="variable">pv</span></a><span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="reg_map" class="idref" href="#reg_map"><span class="id" title="definition">reg_map</span></a> <a id="f:30" class="idref" href="#f:30"><span class="id" title="binder">f</span></a> (<a id="rs:31" class="idref" href="#rs:31"><span class="id" title="binder">rs</span></a>:<a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a>) : <a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#rs:31"><span class="id" title="variable">rs</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_regs"><span class="id" title="constructor">mk_regs</span></a> <a class="idref" href="#r1"><span class="id" title="projection">r1</span></a> <a class="idref" href="#r2"><span class="id" title="projection">r2</span></a> <a class="idref" href="#r3"><span class="id" title="projection">r3</span></a> <a class="idref" href="#r4"><span class="id" title="projection">r4</span></a> <a class="idref" href="#r5"><span class="id" title="projection">r5</span></a> <a class="idref" href="#r6"><span class="id" title="projection">r6</span></a> <a class="idref" href="#r7"><span class="id" title="projection">r7</span></a> <a class="idref" href="#r8"><span class="id" title="projection">r8</span></a> <a class="idref" href="#r9"><span class="id" title="projection">r9</span></a> <a class="idref" href="#r10"><span class="id" title="projection">r10</span></a> <a class="idref" href="#r11"><span class="id" title="projection">r11</span></a> <a class="idref" href="#r12"><span class="id" title="projection">r12</span></a> <a class="idref" href="#r13"><span class="id" title="projection">r13</span></a> <a class="idref" href="#r14"><span class="id" title="projection">r14</span></a> <a class="idref" href="#r15"><span class="id" title="projection">r15</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( <a class="idref" href="#mk_regs"><span class="id" title="constructor">mk_regs</span></a> (<a class="idref" href="#f:30"><span class="id" title="variable">f</span></a> <span class="id" title="var">r1</span>) (<a class="idref" href="#f:30"><span class="id" title="variable">f</span></a> <span class="id" title="var">r2</span>) (<a class="idref" href="#f:30"><span class="id" title="variable">f</span></a> <span class="id" title="var">r3</span>) (<a class="idref" href="#f:30"><span class="id" title="variable">f</span></a> <span class="id" title="var">r4</span>) (<a class="idref" href="#f:30"><span class="id" title="variable">f</span></a> <span class="id" title="var">r5</span>) (<a class="idref" href="#f:30"><span class="id" title="variable">f</span></a> <span class="id" title="var">r6</span>) (<a class="idref" href="#f:30"><span class="id" title="variable">f</span></a> <span class="id" title="var">r7</span>) (<a class="idref" href="#f:30"><span class="id" title="variable">f</span></a> <span class="id" title="var">r8</span>) (<a class="idref" href="#f:30"><span class="id" title="variable">f</span></a> <span class="id" title="var">r9</span>) (<a class="idref" href="#f:30"><span class="id" title="variable">f</span></a> <span class="id" title="var">r10</span>) (<a class="idref" href="#f:30"><span class="id" title="variable">f</span></a> <span class="id" title="var">r11</span>) (<a class="idref" href="#f:30"><span class="id" title="variable">f</span></a> <span class="id" title="var">r12</span>) (<a class="idref" href="#f:30"><span class="id" title="variable">f</span></a> <span class="id" title="var">r13</span>) (<a class="idref" href="#f:30"><span class="id" title="variable">f</span></a> <span class="id" title="var">r14</span>) (<a class="idref" href="#f:30"><span class="id" title="variable">f</span></a> <span class="id" title="var">r15</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>
</details><div class="code">
<span class="id" title="keyword">End</span> <a class="idref" href="#Registers"><span class="id" title="section">Registers</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.Flags</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Bool</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Bool</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Flags" class="idref" href="#Flags"><span class="id" title="section">Flags</span></a>.<br/>

<br/>
</div>

<div class="doc"><h1 id="flags">Flags</h1>
<p>Flags are boolean values, which reflect certain characteristics of
the result of the last instruction.</p>
<p>It is commonly said that a flag is <strong>set</strong> if its value
is <span
class="inlinecode"><a class="idref" href="#true"><span
class="id" title="constructor">true</span></a></span>, and a flag is
<strong>cleared</strong> if its value is false.</p>
<p>In EraVM there are three flags:</p>
<ol type="1">
<li><span
class="inlinecode"><a class="idref" href="#OF_LT"><span
class="id" title="inductive">OF_LT</span></a></span> : overflow or less
than;</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="OF_LT" class="idref" href="#OF_LT"><span class="id" title="inductive">OF_LT</span></a> := <a id="Set_OF_LT" class="idref" href="#Set_OF_LT"><span class="id" title="constructor">Set_OF_LT</span></a> | <a id="Clear_OF_LT" class="idref" href="#Clear_OF_LT"><span class="id" title="constructor">Clear_OF_LT</span></a>.<br/>

<br/>
</div>

<div class="doc"><ol start="2" type="1">
<li><span
class="inlinecode"><a class="idref" href="#EQ"><span
class="id" title="inductive">EQ</span></a></span> : equals;</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="EQ" class="idref" href="#EQ"><span class="id" title="inductive">EQ</span></a> := <a id="Set_EQ" class="idref" href="#Set_EQ"><span class="id" title="constructor">Set_EQ</span></a> | <a id="Clear_EQ" class="idref" href="#Clear_EQ"><span class="id" title="constructor">Clear_EQ</span></a>.<br/>
</div>

<div class="doc"><ol start="3" type="1">
<li><span
class="inlinecode"><a class="idref" href="#GT"><span
class="id" title="inductive">GT</span></a></span> : greater than.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="GT" class="idref" href="#GT"><span class="id" title="inductive">GT</span></a> := <a id="Set_GT" class="idref" href="#Set_GT"><span class="id" title="constructor">Set_GT</span></a> | <a id="Clear_GT" class="idref" href="#Clear_GT"><span class="id" title="constructor">Clear_GT</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>More specifically:</p>
<ol type="1">
<li><span
class="inlinecode"><a class="idref" href="#OF_LT"><span
class="id" title="inductive">OF_LT</span></a></span> is set in the
following cases:
<ul>
<li>Overflow</li>
<li>Underflow</li>
<li>Division by zero</li>
<li>Panic, then when the exception handler starts execution, <span
class="inlinecode"><a class="idref" href="#OF_LT"><span
class="id" title="inductive">OF_LT</span></a></span> is set.</li>
</ul></li>
<li><span
class="inlinecode"><a class="idref" href="#EQ"><span
class="id" title="inductive">EQ</span></a></span> is set when the result
of a binary operation is zero.</li>
<li><span
class="inlinecode"><a class="idref" href="#GT"><span
class="id" title="inductive">GT</span></a></span> is set when the first
operand of a binary operation was greater than the second.</li>
</ol>
</div>
<div class="code">
<br/>

<br/>
</div>
<details><summary>Helpers </summary><div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="OF_LT_to_bool" class="idref" href="#OF_LT_to_bool"><span class="id" title="definition">OF_LT_to_bool</span></a> (<a id="f:7" class="idref" href="#f:7"><span class="id" title="binder">f</span></a>:<a class="idref" href="#OF_LT"><span class="id" title="inductive">OF_LT</span></a>) := <span class="id" title="keyword">if</span> <a class="idref" href="#f:7"><span class="id" title="variable">f</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="EQ_to_bool" class="idref" href="#EQ_to_bool"><span class="id" title="definition">EQ_to_bool</span></a> (<a id="f:8" class="idref" href="#f:8"><span class="id" title="binder">f</span></a>:<a class="idref" href="#EQ"><span class="id" title="inductive">EQ</span></a>) := <span class="id" title="keyword">if</span> <a class="idref" href="#f:8"><span class="id" title="variable">f</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="GT_to_bool" class="idref" href="#GT_to_bool"><span class="id" title="definition">GT_to_bool</span></a> (<a id="f:9" class="idref" href="#f:9"><span class="id" title="binder">f</span></a>:<a class="idref" href="#GT"><span class="id" title="inductive">GT</span></a>) := <span class="id" title="keyword">if</span> <a class="idref" href="#f:9"><span class="id" title="variable">f</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a>.<br/>

<br/>
&nbsp;&nbsp;#[<span class="id" title="var">reversible</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#OF_LT_to_bool"><span class="id" title="definition">Coercion</span></a> <a class="idref" href="#OF_LT_to_bool"><span class="id" title="definition">OF_LT_to_bool</span></a> <a class="idref" href="#OF_LT_to_bool"><span class="id" title="definition">:</span></a> <a class="idref" href="#OF_LT_to_bool"><span class="id" title="definition">OF_LT</span></a> <a class="idref" href="#OF_LT_to_bool"><span class="id" title="definition">>-></span></a> <a class="idref" href="#OF_LT_to_bool"><span class="id" title="definition">bool</span></a>.<br/>
&nbsp;&nbsp;#[<span class="id" title="var">reversible</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#EQ_to_bool"><span class="id" title="definition">Coercion</span></a> <a class="idref" href="#EQ_to_bool"><span class="id" title="definition">EQ_to_bool</span></a> <a class="idref" href="#EQ_to_bool"><span class="id" title="definition">:</span></a> <a class="idref" href="#EQ_to_bool"><span class="id" title="definition">EQ</span></a> <a class="idref" href="#EQ_to_bool"><span class="id" title="definition">>-></span></a> <a class="idref" href="#EQ_to_bool"><span class="id" title="definition">bool</span></a>.<br/>
&nbsp;&nbsp;#[<span class="id" title="var">reversible</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#GT_to_bool"><span class="id" title="definition">Coercion</span></a> <a class="idref" href="#GT_to_bool"><span class="id" title="definition">GT_to_bool</span></a> <a class="idref" href="#GT_to_bool"><span class="id" title="definition">:</span></a> <a class="idref" href="#GT_to_bool"><span class="id" title="definition">GT</span></a> <a class="idref" href="#GT_to_bool"><span class="id" title="definition">>-></span></a> <a class="idref" href="#GT_to_bool"><span class="id" title="definition">bool</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="EQ_of_bool" class="idref" href="#EQ_of_bool"><span class="id" title="definition">EQ_of_bool</span></a> (<a id="f:10" class="idref" href="#f:10"><span class="id" title="binder">f</span></a>:<a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>) := <span class="id" title="keyword">if</span> <a class="idref" href="#f:10"><span class="id" title="variable">f</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="#Set_EQ"><span class="id" title="constructor">Set_EQ</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="#Clear_EQ"><span class="id" title="constructor">Clear_EQ</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="OF_LT_of_bool" class="idref" href="#OF_LT_of_bool"><span class="id" title="definition">OF_LT_of_bool</span></a> (<a id="f:11" class="idref" href="#f:11"><span class="id" title="binder">f</span></a>:<a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>) := <span class="id" title="keyword">if</span> <a class="idref" href="#f:11"><span class="id" title="variable">f</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="#Set_OF_LT"><span class="id" title="constructor">Set_OF_LT</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="#Clear_OF_LT"><span class="id" title="constructor">Clear_OF_LT</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="GT_of_bool" class="idref" href="#GT_of_bool"><span class="id" title="definition">GT_of_bool</span></a> (<a id="f:12" class="idref" href="#f:12"><span class="id" title="binder">f</span></a>:<a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>) := <span class="id" title="keyword">if</span> <a class="idref" href="#f:12"><span class="id" title="variable">f</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="#Set_GT"><span class="id" title="constructor">Set_GT</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="#Clear_GT"><span class="id" title="constructor">Clear_GT</span></a>.<br/>

<br/>
</div>
</details><div class="code">

<br/>
</div>

<div class="doc"><p>State of three flags <span
class="inlinecode"><a class="idref" href="#flags_state"><span
class="id" title="record">flags_state</span></a></span> is stored in the
global <span
class="inlinecode"><a class="idref" href="#state"><span
class="id" title="record">state</span></a></span> in the field <span
class="inlinecode"><span class="id" title="var">gs_xstate</span></span>
in the field <span
class="inlinecode"><a class="idref" href="#gs_flags"><span
class="id" title="projection">gs_flags</span></a></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="flags_state" class="idref" href="#flags_state"><span class="id" title="record">flags_state</span></a> := <span class="id" title="var">mk_fs</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="fs_OF_LT" class="idref" href="#fs_OF_LT"><span class="id" title="projection">fs_OF_LT</span></a>: <a class="idref" href="#OF_LT"><span class="id" title="inductive">OF_LT</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="fs_EQ" class="idref" href="#fs_EQ"><span class="id" title="projection">fs_EQ</span></a>: <a class="idref" href="#EQ"><span class="id" title="inductive">EQ</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="fs_GT" class="idref" href="#fs_GT"><span class="id" title="projection">fs_GT</span></a>: <a class="idref" href="#GT"><span class="id" title="inductive">GT</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
</div>

<div class="doc"><h2 id="usage">Usage</h2>
<p>Flags are used to control the execution flow. See <span
class="inlinecode"><a class="idref" href="#Predication"><span
class="id" title="section">Predication</span></a></span>.</p>
</div>
<div class="code">
<br/>
</div>
<details><summary>Helpers </summary><div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="set_overflow" class="idref" href="#set_overflow"><span class="id" title="definition">set_overflow</span></a> <a id="fs:17" class="idref" href="#fs:17"><span class="id" title="binder">fs</span></a> := <span class="id" title="keyword">match</span> <a class="idref" href="#fs:17"><span class="id" title="variable">fs</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_fs"><span class="id" title="constructor">mk_fs</span></a> <span class="id" title="var">_</span> <a class="idref" href="#EQ"><span class="id" title="inductive">EQ</span></a> <a class="idref" href="#GT"><span class="id" title="inductive">GT</span></a> ⇒ <a class="idref" href="#mk_fs"><span class="id" title="constructor">mk_fs</span></a> <a class="idref" href="#Set_OF_LT"><span class="id" title="constructor">Set_OF_LT</span></a> <span class="id" title="var">EQ</span> <span class="id" title="var">GT</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="bflags" class="idref" href="#bflags"><span class="id" title="definition">bflags</span></a> (<a id="OF:19" class="idref" href="#OF:19"><span class="id" title="binder">OF</span></a> <a id="EQ:20" class="idref" href="#EQ:20"><span class="id" title="binder">EQ</span></a> <a id="GT:21" class="idref" href="#GT:21"><span class="id" title="binder">GT</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>) : <a class="idref" href="#flags_state"><span class="id" title="record">flags_state</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fs_OF_LT"><span class="id" title="projection">fs_OF_LT</span></a> := <a class="idref" href="#OF_LT_of_bool"><span class="id" title="definition">OF_LT_of_bool</span></a> <a class="idref" href="#OF:19"><span class="id" title="variable">OF</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fs_EQ"><span class="id" title="projection">fs_EQ</span></a> := <a class="idref" href="#EQ_of_bool"><span class="id" title="definition">EQ_of_bool</span></a> <a class="idref" href="#EQ:20"><span class="id" title="variable">EQ</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fs_GT"><span class="id" title="projection">fs_GT</span></a> := <a class="idref" href="#GT_of_bool"><span class="id" title="definition">GT_of_bool</span></a> <a class="idref" href="#GT:21"><span class="id" title="variable">GT</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
</div>
</details><div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="flags_clear" class="idref" href="#flags_clear"><span class="id" title="definition">flags_clear</span></a> : <a class="idref" href="#flags_state"><span class="id" title="record">flags_state</span></a> := <a class="idref" href="#mk_fs"><span class="id" title="constructor">mk_fs</span></a> <a class="idref" href="#Clear_OF_LT"><span class="id" title="constructor">Clear_OF_LT</span></a> <a class="idref" href="#Clear_EQ"><span class="id" title="constructor">Clear_EQ</span></a> <a class="idref" href="#Clear_GT"><span class="id" title="constructor">Clear_GT</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Flags"><span class="id" title="section">Flags</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.Predication</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Common</span></a> <a class="idref" href="#"><span class="id" title="library">Flags</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Flags</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">ssrbool</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Predication" class="idref" href="#Predication"><span class="id" title="section">Predication</span></a>.<br/>
</div>

<div class="doc"><h1 id="predication">Predication</h1>
<p>Every instruction on the <span
class="inlinecode"><a class="idref" href="#code_page"><span
class="id" title="definition">code_page</span></a></span> is predicated,
meaning it is augmented with a <span
class="inlinecode"><a class="idref" href="#predicate"><span
class="id" title="inductive">predicate</span></a></span>. A predicate
describes a condition on flags; if this condition is satisfied, then the
instruction is executed; otherwise, EraVM skips the instruction.</p>
<p>When an instruction is skipped, its base cost is still paid.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="predicate" class="idref" href="#predicate"><span class="id" title="inductive">predicate</span></a> : <span class="id" title="keyword">Set</span> :=<br/>
&nbsp;&nbsp;| <a id="IfAlways" class="idref" href="#IfAlways"><span class="id" title="constructor">IfAlways</span></a> | <a id="IfGT" class="idref" href="#IfGT"><span class="id" title="constructor">IfGT</span></a> | <a id="IfEQ" class="idref" href="#IfEQ"><span class="id" title="constructor">IfEQ</span></a> | <a id="IfLT" class="idref" href="#IfLT"><span class="id" title="constructor">IfLT</span></a> | <a id="IfGE" class="idref" href="#IfGE"><span class="id" title="constructor">IfGE</span></a> | <a id="IfLE" class="idref" href="#IfLE"><span class="id" title="constructor">IfLE</span></a> | <a id="IfNotEQ" class="idref" href="#IfNotEQ"><span class="id" title="constructor">IfNotEQ</span></a> | <a id="IfGTOrLT" class="idref" href="#IfGTOrLT"><span class="id" title="constructor">IfGTOrLT</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="predicate_holds" class="idref" href="#predicate_holds"><span class="id" title="definition">predicate_holds</span></a> (<a id="c:3" class="idref" href="#c:3"><span class="id" title="binder">c</span></a>:<a class="idref" href="#predicate"><span class="id" title="inductive">predicate</span></a>) (<a id="fs:4" class="idref" href="#fs:4"><span class="id" title="binder">fs</span></a>:<a class="idref" href="#flags_state"><span class="id" title="record">flags_state</span></a>) : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#c:3"><span class="id" title="variable">c</span></a>, <a class="idref" href="#fs:4"><span class="id" title="variable">fs</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#IfAlways"><span class="id" title="constructor">IfAlways</span></a>, <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#IfGT"><span class="id" title="constructor">IfGT</span></a>, <a class="idref" href="#mk_fs"><span class="id" title="constructor">mk_fs</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>  <a class="idref" href="#Set_GT"><span class="id" title="constructor">Set_GT</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#IfEQ"><span class="id" title="constructor">IfEQ</span></a>, <a class="idref" href="#mk_fs"><span class="id" title="constructor">mk_fs</span></a> <span class="id" title="var">_</span> <a class="idref" href="#Set_EQ"><span class="id" title="constructor">Set_EQ</span></a> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#IfLT"><span class="id" title="constructor">IfLT</span></a>, <a class="idref" href="#mk_fs"><span class="id" title="constructor">mk_fs</span></a> <a class="idref" href="#Set_OF_LT"><span class="id" title="constructor">Set_OF_LT</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#IfGE"><span class="id" title="constructor">IfGE</span></a>, <a class="idref" href="#mk_fs"><span class="id" title="constructor">mk_fs</span></a> <span class="id" title="var">_</span> <a class="idref" href="#Set_EQ"><span class="id" title="constructor">Set_EQ</span></a> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#IfGE"><span class="id" title="constructor">IfGE</span></a>, <a class="idref" href="#mk_fs"><span class="id" title="constructor">mk_fs</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="#Set_GT"><span class="id" title="constructor">Set_GT</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#IfLE"><span class="id" title="constructor">IfLE</span></a>, <a class="idref" href="#mk_fs"><span class="id" title="constructor">mk_fs</span></a> <span class="id" title="var">_</span> <a class="idref" href="#Set_EQ"><span class="id" title="constructor">Set_EQ</span></a> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#IfLE"><span class="id" title="constructor">IfLE</span></a>, <a class="idref" href="#mk_fs"><span class="id" title="constructor">mk_fs</span></a> <a class="idref" href="#Set_OF_LT"><span class="id" title="constructor">Set_OF_LT</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#IfNotEQ"><span class="id" title="constructor">IfNotEQ</span></a>, <a class="idref" href="#mk_fs"><span class="id" title="constructor">mk_fs</span></a> <span class="id" title="var">_</span> <a class="idref" href="#Clear_EQ"><span class="id" title="constructor">Clear_EQ</span></a> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#IfGTOrLT"><span class="id" title="constructor">IfGTOrLT</span></a>,<a class="idref" href="#mk_fs"><span class="id" title="constructor">mk_fs</span></a> <a class="idref" href="#Set_OF_LT"><span class="id" title="constructor">Set_OF_LT</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#IfGTOrLT"><span class="id" title="constructor">IfGTOrLT</span></a>,<a class="idref" href="#mk_fs"><span class="id" title="constructor">mk_fs</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="#Set_GT"><span class="id" title="constructor">Set_GT</span></a> ⇒ <a class="idref" href="#true"><span class="id" title="constructor">true</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>,<span class="id" title="var">_</span> ⇒ <a class="idref" href="#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="predicate_spec" class="idref" href="#predicate_spec"><span class="id" title="inductive">predicate_spec</span></a>:  <a class="idref" href="#predicate"><span class="id" title="inductive">predicate</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#flags_state"><span class="id" title="record">flags_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;| <a id="ac_Always" class="idref" href="#ac_Always"><span class="id" title="constructor">ac_Always</span></a>: <span class="id" title="keyword">∀</span> <a id="fs:9" class="idref" href="#fs:9"><span class="id" title="binder">fs</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#predicate_spec:7"><span class="id" title="inductive">predicate_spec</span></a> <a class="idref" href="#IfAlways"><span class="id" title="constructor">IfAlways</span></a> <a class="idref" href="#fs:9"><span class="id" title="variable">fs</span></a><br/>
<br/>
&nbsp;&nbsp;| <a id="ac_GT" class="idref" href="#ac_GT"><span class="id" title="constructor">ac_GT</span></a>: <span class="id" title="keyword">∀</span> <a id="of_lt:10" class="idref" href="#of_lt:10"><span class="id" title="binder">of_lt</span></a> <a id="eq:11" class="idref" href="#eq:11"><span class="id" title="binder">eq</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#predicate_spec:7"><span class="id" title="inductive">predicate_spec</span></a> <a class="idref" href="#IfGT"><span class="id" title="constructor">IfGT</span></a> (<a class="idref" href="#mk_fs"><span class="id" title="constructor">mk_fs</span></a> <a class="idref" href="#of_lt:10"><span class="id" title="variable">of_lt</span></a> <a class="idref" href="#eq:11"><span class="id" title="variable">eq</span></a> <a class="idref" href="#Set_GT"><span class="id" title="constructor">Set_GT</span></a>)<br/>
<br/>
&nbsp;&nbsp;| <a id="ac_EQ" class="idref" href="#ac_EQ"><span class="id" title="constructor">ac_EQ</span></a>: <span class="id" title="keyword">∀</span> <a id="of_lt:12" class="idref" href="#of_lt:12"><span class="id" title="binder">of_lt</span></a> <a id="gt:13" class="idref" href="#gt:13"><span class="id" title="binder">gt</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#predicate_spec:7"><span class="id" title="inductive">predicate_spec</span></a> <a class="idref" href="#IfEQ"><span class="id" title="constructor">IfEQ</span></a> (<a class="idref" href="#mk_fs"><span class="id" title="constructor">mk_fs</span></a> <a class="idref" href="#of_lt:12"><span class="id" title="variable">of_lt</span></a> <a class="idref" href="#Set_EQ"><span class="id" title="constructor">Set_EQ</span></a> <a class="idref" href="#gt:13"><span class="id" title="variable">gt</span></a>)<br/>
<br/>
&nbsp;&nbsp;| <a id="ac_LT" class="idref" href="#ac_LT"><span class="id" title="constructor">ac_LT</span></a>: <span class="id" title="keyword">∀</span> <a id="eq:14" class="idref" href="#eq:14"><span class="id" title="binder">eq</span></a> <a id="gt:15" class="idref" href="#gt:15"><span class="id" title="binder">gt</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#predicate_spec:7"><span class="id" title="inductive">predicate_spec</span></a> <a class="idref" href="#IfLT"><span class="id" title="constructor">IfLT</span></a> (<a class="idref" href="#mk_fs"><span class="id" title="constructor">mk_fs</span></a> <a class="idref" href="#Set_OF_LT"><span class="id" title="constructor">Set_OF_LT</span></a> <a class="idref" href="#eq:14"><span class="id" title="variable">eq</span></a> <a class="idref" href="#gt:15"><span class="id" title="variable">gt</span></a>)<br/>
<br/>
&nbsp;&nbsp;| <a id="ac_GE1" class="idref" href="#ac_GE1"><span class="id" title="constructor">ac_GE1</span></a>: <span class="id" title="keyword">∀</span> <a id="fs:16" class="idref" href="#fs:16"><span class="id" title="binder">fs</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#predicate_spec:7"><span class="id" title="inductive">predicate_spec</span></a> <a class="idref" href="#IfEQ"><span class="id" title="constructor">IfEQ</span></a> <a class="idref" href="#fs:16"><span class="id" title="variable">fs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#predicate_spec:7"><span class="id" title="inductive">predicate_spec</span></a> <a class="idref" href="#IfGE"><span class="id" title="constructor">IfGE</span></a> <a class="idref" href="#fs:16"><span class="id" title="variable">fs</span></a><br/>
<br/>
&nbsp;&nbsp;| <a id="ac_GE2" class="idref" href="#ac_GE2"><span class="id" title="constructor">ac_GE2</span></a>: <span class="id" title="keyword">∀</span> <a id="fs:17" class="idref" href="#fs:17"><span class="id" title="binder">fs</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#predicate_spec:7"><span class="id" title="inductive">predicate_spec</span></a> <a class="idref" href="#IfGT"><span class="id" title="constructor">IfGT</span></a> <a class="idref" href="#fs:17"><span class="id" title="variable">fs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#predicate_spec:7"><span class="id" title="inductive">predicate_spec</span></a> <a class="idref" href="#IfGE"><span class="id" title="constructor">IfGE</span></a> <a class="idref" href="#fs:17"><span class="id" title="variable">fs</span></a><br/>
<br/>
&nbsp;&nbsp;| <a id="ac_LE1" class="idref" href="#ac_LE1"><span class="id" title="constructor">ac_LE1</span></a>: <span class="id" title="keyword">∀</span> <a id="fs:18" class="idref" href="#fs:18"><span class="id" title="binder">fs</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#predicate_spec:7"><span class="id" title="inductive">predicate_spec</span></a> <a class="idref" href="#IfLT"><span class="id" title="constructor">IfLT</span></a> <a class="idref" href="#fs:18"><span class="id" title="variable">fs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#predicate_spec:7"><span class="id" title="inductive">predicate_spec</span></a> <a class="idref" href="#IfLE"><span class="id" title="constructor">IfLE</span></a> <a class="idref" href="#fs:18"><span class="id" title="variable">fs</span></a><br/>
&nbsp;&nbsp;| <a id="ac_LE2" class="idref" href="#ac_LE2"><span class="id" title="constructor">ac_LE2</span></a>: <span class="id" title="keyword">∀</span> <a id="fs:19" class="idref" href="#fs:19"><span class="id" title="binder">fs</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#predicate_spec:7"><span class="id" title="inductive">predicate_spec</span></a> <a class="idref" href="#IfEQ"><span class="id" title="constructor">IfEQ</span></a> <a class="idref" href="#fs:19"><span class="id" title="variable">fs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#predicate_spec:7"><span class="id" title="inductive">predicate_spec</span></a> <a class="idref" href="#IfLE"><span class="id" title="constructor">IfLE</span></a> <a class="idref" href="#fs:19"><span class="id" title="variable">fs</span></a><br/>
<br/>
&nbsp;&nbsp;| <a id="ac_NotEQ" class="idref" href="#ac_NotEQ"><span class="id" title="constructor">ac_NotEQ</span></a>: <span class="id" title="keyword">∀</span> <a id="of_lt:20" class="idref" href="#of_lt:20"><span class="id" title="binder">of_lt</span></a> <a id="gt:21" class="idref" href="#gt:21"><span class="id" title="binder">gt</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#predicate_spec:7"><span class="id" title="inductive">predicate_spec</span></a> <a class="idref" href="#IfNotEQ"><span class="id" title="constructor">IfNotEQ</span></a> (<a class="idref" href="#mk_fs"><span class="id" title="constructor">mk_fs</span></a> <a class="idref" href="#of_lt:20"><span class="id" title="variable">of_lt</span></a> <a class="idref" href="#Clear_EQ"><span class="id" title="constructor">Clear_EQ</span></a> <a class="idref" href="#gt:21"><span class="id" title="variable">gt</span></a>)<br/>
<br/>
&nbsp;&nbsp;| <a id="ac_IfGTOrLT1" class="idref" href="#ac_IfGTOrLT1"><span class="id" title="constructor">ac_IfGTOrLT1</span></a>: <span class="id" title="keyword">∀</span> <a id="fs:22" class="idref" href="#fs:22"><span class="id" title="binder">fs</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#predicate_spec:7"><span class="id" title="inductive">predicate_spec</span></a> <a class="idref" href="#IfGT"><span class="id" title="constructor">IfGT</span></a> <a class="idref" href="#fs:22"><span class="id" title="variable">fs</span></a><a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#predicate_spec:7"><span class="id" title="inductive">predicate_spec</span></a> <a class="idref" href="#IfGTOrLT"><span class="id" title="constructor">IfGTOrLT</span></a> <a class="idref" href="#fs:22"><span class="id" title="variable">fs</span></a><br/>
<br/>
&nbsp;&nbsp;| <a id="ac_IfGTOrLT2" class="idref" href="#ac_IfGTOrLT2"><span class="id" title="constructor">ac_IfGTOrLT2</span></a>: <span class="id" title="keyword">∀</span> <a id="fs:23" class="idref" href="#fs:23"><span class="id" title="binder">fs</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#predicate_spec:7"><span class="id" title="inductive">predicate_spec</span></a> <a class="idref" href="#IfLT"><span class="id" title="constructor">IfLT</span></a> <a class="idref" href="#fs:23"><span class="id" title="variable">fs</span></a><a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#predicate_spec:7"><span class="id" title="inductive">predicate_spec</span></a> <a class="idref" href="#IfGTOrLT"><span class="id" title="constructor">IfGTOrLT</span></a> <a class="idref" href="#fs:23"><span class="id" title="variable">fs</span></a><br/>
&nbsp;&nbsp;.<br/>
</div>
<details><summary>proofs </summary><div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Hint Constructors</span> <a class="idref" href="#predicate_spec"><span class="id" title="inductive">predicate_spec</span></a>:<span class="id" title="var">flags</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="predicate_holds_spec" class="idref" href="#predicate_holds_spec"><span class="id" title="lemma">predicate_holds_spec</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="c:24" class="idref" href="#c:24"><span class="id" title="binder">c</span></a> <a id="fs:25" class="idref" href="#fs:25"><span class="id" title="binder">fs</span></a>, <a class="idref" href="#predicate_holds"><span class="id" title="definition">predicate_holds</span></a> <a class="idref" href="#c:24"><span class="id" title="variable">c</span></a> <a class="idref" href="#fs:25"><span class="id" title="variable">fs</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'<->'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="#predicate_spec"><span class="id" title="inductive">predicate_spec</span></a> <a class="idref" href="#c:24"><span class="id" title="variable">c</span></a> <a class="idref" href="#fs:25"><span class="id" title="variable">fs</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">c</span>, <span class="id" title="var">fs</span> <span class="id" title="keyword">as</span> [[] [] []];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">flags</span>| <span class="id" title="tactic">inversion</span> 1; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>].<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="predicate_activated_dec" class="idref" href="#predicate_activated_dec"><span class="id" title="lemma">predicate_activated_dec</span></a>: <span class="id" title="keyword">∀</span> <a id="ec:26" class="idref" href="#ec:26"><span class="id" title="binder">ec</span></a> <a id="flags:27" class="idref" href="#flags:27"><span class="id" title="binder">flags</span></a>, <a class="idref" href="#decidable"><span class="id" title="definition">decidable</span></a> (<a class="idref" href="#predicate_spec"><span class="id" title="inductive">predicate_spec</span></a> <a class="idref" href="#ec:26"><span class="id" title="variable">ec</span></a> <a class="idref" href="#flags:27"><span class="id" title="variable">flags</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">ec</span> <span class="id" title="var">flags</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="#decidable"><span class="id" title="definition">decidable</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">ec</span>, <span class="id" title="var">flags</span> <span class="id" title="keyword">as</span> [[][][]]; <span class="id" title="tactic">solve</span> [<span class="id" title="tactic">left</span>;<span class="id" title="tactic">constructor</span>| <span class="id" title="tactic">right</span>;<span class="id" title="tactic">inversion</span> 1 | <span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">flags</span> | <span class="id" title="tactic">right</span>; <span class="id" title="tactic">inversion</span> 1; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>].<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>
</details><div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="predicated" class="idref" href="#predicated"><span class="id" title="record">predicated</span></a> (<a id="instruction:28" class="idref" href="#instruction:28"><span class="id" title="binder">instruction</span></a>:<span class="id" title="keyword">Type</span>): <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Ins</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ins_spec" class="idref" href="#ins_spec"><span class="id" title="projection">ins_spec</span></a>: <a class="idref" href="#instruction:28"><span class="id" title="variable">instruction</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ins_cond" class="idref" href="#ins_cond"><span class="id" title="projection">ins_cond</span></a>: <a class="idref" href="#predicate"><span class="id" title="inductive">predicate</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
</div>

<div class="doc"><p>Invalid instruction. It is a default value on <span
class="inlinecode"><a class="idref" href="#code_page"><span
class="id" title="definition">code_page</span></a></span>s. See <span
class="inlinecode"><a class="idref" href="#code_page"><span
class="id" title="definition">code_page</span></a></span>.</p>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="invalid" class="idref" href="#invalid"><span class="id" title="definition">invalid</span></a> {<a id="I:32" class="idref" href="#I:32"><span class="id" title="binder">I</span></a>} (<a id="ins:33" class="idref" href="#ins:33"><span class="id" title="binder">ins</span></a>:<a class="idref" href="#I:32"><span class="id" title="variable">I</span></a>) : <a class="idref" href="#predicated"><span class="id" title="record">predicated</span></a> <a class="idref" href="#I:32"><span class="id" title="variable">I</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_spec"><span class="id" title="projection">ins_spec</span></a> := <a class="idref" href="#ins:33"><span class="id" title="variable">ins</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_cond"><span class="id" title="projection">ins_cond</span></a>:= <a class="idref" href="#IfAlways"><span class="id" title="constructor">IfAlways</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Predication"><span class="id" title="section">Predication</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.TransientMemory</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="library">memory.Pages</span></a> <a class="idref" href="#"><span class="id" title="library">memory.PageTypes</span></a> <a class="idref" href="#"><span class="id" title="library">Pointer</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">memory.Pages</span></a> <a class="idref" href="#"><span class="id" title="module">memory.PageTypes</span></a> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a>.<br/>

<br/>
<span class="id" title="keyword">Export</span> <a class="idref" href="#"><span class="id" title="module">memory.Pages</span></a> <a class="idref" href="#"><span class="id" title="module">memory.PageTypes</span></a>.<br/>

<br/>
</div>

<div class="doc"><h1 id="informal-overview">Informal overview</h1>
<p>All memory available to the contract code can be divided into
transient and persistent memory.</p>
<ul>
<li><strong>Transient memory</strong> exists to enable computations and
does not persist between VM, like the main memory of personal
computers.</li>
<li><strong>Persistent memory</strong> exists as a storage of untagged
256-bit <span
class="inlinecode"><a class="idref" href="#word"><span
class="id" title="definition">word</span></a></span>s shared between the
network participants.</li>
</ul>
<p>Contract code uses transient memory to perform computations and uses
the storage to publish its results</p>
<h2 id="persistent-memory">Persistent memory</h2>
<p>The global persistent data structure is the <span
class="inlinecode"><a class="idref" href="#depot"><span
class="id" title="definition">depot</span></a></span>. It holds untagged
256-bit words.</p>
<p>Depot is split in two <span
class="inlinecode"><a class="idref" href="#shard"><span
class="id" title="definition">shard</span></a></span>s: one corresponds
to rollup, another to porter (see <span
class="inlinecode"><a class="idref" href="#shard_exists"><span
class="id" title="inductive">shard_exists</span></a></span>).</p>
<p>Each shard is a map from a <span
class="inlinecode"><a class="idref" href="#contract_address"><span
class="id" title="definition">contract_address</span></a></span> (160
bit, might be extended in future to up to 256 bits) to contract <span
class="inlinecode"><a class="idref" href="#storage"><span
class="id" title="definition">storage</span></a></span>.</p>
<p>Each contract <span
class="inlinecode"><a class="idref" href="#storage"><span
class="id" title="definition">storage</span></a></span> is a linear
mapping from <span class="math inline">2^{256}</span>
<strong>keys</strong> to 256-bit untagged words.</p>
<p>To address a word in any contract’s storage, it is sufficient to
know:</p>
<ul>
<li>shard</li>
<li>contract address</li>
<li>key</li>
</ul>
<p>See <span
class="inlinecode"><a class="idref" href="#fqa_key"><span
class="id" title="record">fqa_key</span></a></span>.</p>
<p>Contract has one independent storage per shard.</p>
<p>One shard is selected as currently active in <span
class="inlinecode"><a class="idref" href="#state"><span
class="id" title="record">state</span></a></span>.</p>
<p>Contract code is global and shared between shards.</p>
<h2 id="transient-memory">Transient memory</h2>
<p>Transient memory consists of <strong>pages</strong> (<span
class="inlinecode"><a class="idref" href="#page_type"><span
class="id" title="inductive">page_type</span></a></span>) holding data
or code. Each page holds <span class="math inline">2^{32}</span> bytes;
all bytes are initialized to zero at genesis.</p>
<p>New pages are allocated implicitly when the contract execution
starts; calling another contract allocates more pages. Pages persist for
as long as they are referenced from the live code.</p>
<p>Pages hold one of:</p>
<ul>
<li>data: <span class="math inline">2^{32}</span> byte-addressable data
for heap or auxheap; bounded, so reading or writing outside bounds leads
to a paid growth of available portion.</li>
<li>code: instruction-addressable, read-only;</li>
<li>constants: <span class="math inline">2^{16}</span> word-addressable,
read-only;</li>
<li>stack: <span class="math inline">2^{16}</span> words,
word-addressable, tagged words. When the execution of a contract starts,
the initial value of stack pointer is <span
class="inlinecode"><a class="idref" href="#INITIAL_SP_ON_FAR_CALL"><span
class="id"
title="definition">INITIAL_SP_ON_FAR_CALL</span></a></span>.</li>
</ul>
<p>The following describes all types of memory formally and with greater
detail.</p>
</div>
<div class="code">
<br/>

<br/>
</div>

<div class="doc"><p>The definition <span
class="inlinecode"><a class="idref" href="#vm_page"><span
class="id" title="definition">vm_page</span></a></span> collects the
specific types of pages used by EraVM semantic.</p>
</div>
<div class="code">
<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="stack_address" class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a> := <a class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a> <a class="idref" href="#pv0"><span class="id" title="definition">pv0</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a id="stack_address_bits" class="idref" href="#stack_address_bits"><span class="id" title="definition">stack_address_bits</span></a> := <a class="idref" href="#stack_address_bits"><span class="id" title="definition">stack_address_bits</span></a> <a class="idref" href="#pv0"><span class="id" title="definition">pv0</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a id="stack_page" class="idref" href="#stack_page"><span class="id" title="definition">stack_page</span></a> := <a class="idref" href="#stack_page"><span class="id" title="definition">stack_page</span></a> <a class="idref" href="#pv0"><span class="id" title="definition">pv0</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a id="stack_page_params" class="idref" href="#stack_page_params"><span class="id" title="definition">stack_page_params</span></a> := <a class="idref" href="#stack_page_params"><span class="id" title="definition">stack_page_params</span></a> <a class="idref" href="#pv0"><span class="id" title="definition">pv0</span></a>.<br/>

<br/>
#[<span class="id" title="var">global</span>]<br/>
&nbsp;&nbsp;<span class="id" title="var">Canonical</span> <a id="vm_page" class="idref" href="#vm_page"><span class="id" title="definition">vm_page</span></a> {<a id="instr:1" class="idref" href="#instr:1"><span class="id" title="binder">instr</span></a>} (<a id="inv:2" class="idref" href="#inv:2"><span class="id" title="binder">inv</span></a>:<a class="idref" href="#instr:1"><span class="id" title="variable">instr</span></a>) <a id="type:3" class="idref" href="#type:3"><span class="id" title="binder">type</span></a> : <a class="idref" href="#page"><span class="id" title="record">page</span></a> := @<a class="idref" href="#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="#code_page"><span class="id" title="record">code_page</span></a> <a class="idref" href="#inv:2"><span class="id" title="variable">inv</span></a>) <a class="idref" href="#const_page"><span class="id" title="definition">const_page</span></a> <a class="idref" href="#data_page"><span class="id" title="definition">data_page</span></a> <a class="idref" href="#stack_page"><span class="id" title="definition">stack_page</span></a> <a class="idref" href="#type:3"><span class="id" title="variable">type</span></a>.<br/>
#[<span class="id" title="var">global</span>]<br/>
&nbsp;&nbsp;<span class="id" title="var">Canonical</span> <a id="vm_mem" class="idref" href="#vm_mem"><span class="id" title="definition">vm_mem</span></a> {<a id="instr:4" class="idref" href="#instr:4"><span class="id" title="binder">instr</span></a>} (<a id="inv:5" class="idref" href="#inv:5"><span class="id" title="binder">inv</span></a>:<a class="idref" href="#instr:4"><span class="id" title="variable">instr</span></a>) <a id="type:6" class="idref" href="#type:6"><span class="id" title="binder">type</span></a> : <a class="idref" href="#memory"><span class="id" title="record">memory</span></a> := @<a class="idref" href="#mk_pages"><span class="id" title="constructor">mk_pages</span></a> (<a class="idref" href="#code_page"><span class="id" title="record">code_page</span></a> <a class="idref" href="#inv:5"><span class="id" title="variable">inv</span></a>) <a class="idref" href="#const_page"><span class="id" title="definition">const_page</span></a> <a class="idref" href="#data_page"><span class="id" title="definition">data_page</span></a> <a class="idref" href="#stack_page"><span class="id" title="definition">stack_page</span></a> <a class="idref" href="#type:6"><span class="id" title="variable">type</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.memory.Depot</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Core</span></a> <a class="idref" href="#"><span class="id" title="library">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="library">MemoryBase</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryBase</span></a> <a class="idref" href="#"><span class="id" title="module">BinInt</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Depot" class="idref" href="#Depot"><span class="id" title="section">Depot</span></a>.<br/>
</div>

<div class="doc"><h1 id="storage-of-a-contract">Storage of a contract</h1>
<p>A <strong>storage</strong> is a persistent linear mapping from <span
class="math inline">2^{256}</span> addresses to words.</p>
<p>Therefore, given a storage, each word storage is addressed through a
256-bit address.</p>
<p>In storage, individual bytes inside a word can not be addressed
directly: a load or a store happen on a word level.</p>
<p>Both word address in storage and word width are 256 bits.</p>
<p>All words in a storage are zero-initialized on genesis. Therefore,
reading storage word prior to writing yields zero. It is a well-defined
behavior.</p>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="storage_params" class="idref" href="#storage_params"><span class="id" title="definition">storage_params</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#addressable_block"><span class="id" title="projection">addressable_block</span></a> := <a class="idref" href="#word"><span class="id" title="definition">word</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#address_bits"><span class="id" title="projection">address_bits</span></a> := 256;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#default_value"><span class="id" title="projection">default_value</span></a> := <a class="idref" href="#word0"><span class="id" title="definition">word0</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#writable"><span class="id" title="projection">writable</span></a> := <a class="idref" href="#true"><span class="id" title="constructor">true</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="storage_address" class="idref" href="#storage_address"><span class="id" title="definition">storage_address</span></a> := <span class="id" title="definition">BITS</span> (<a class="idref" href="#address_bits"><span class="id" title="projection">address_bits</span></a> <a class="idref" href="#storage_params"><span class="id" title="definition">storage_params</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="storage" class="idref" href="#storage"><span class="id" title="definition">storage</span></a>: <span class="id" title="keyword">Type</span> := <a class="idref" href="#mem_parameterized"><span class="id" title="record">mem_parameterized</span></a> <a class="idref" href="#storage_params"><span class="id" title="definition">storage_params</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>Storage start blanks.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="storage_empty" class="idref" href="#storage_empty"><span class="id" title="definition">storage_empty</span></a> : <a class="idref" href="#storage"><span class="id" title="definition">storage</span></a> := <a class="idref" href="#empty"><span class="id" title="definition">empty</span></a> <a class="idref" href="#storage_params"><span class="id" title="definition">storage_params</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>Storage does not hold contract code, it is a responsibility of
decommittment processor <span
class="inlinecode"><a class="idref" href="#decommitter"><span
class="id" title="definition">decommitter</span></a></span>.</p>
<p>Storage is a part of a <span
class="inlinecode"><a class="idref" href="#shard"><span
class="id" title="definition">shard</span></a></span>, which is a part
of <span
class="inlinecode"><a class="idref" href="#depot"><span
class="id" title="definition">depot</span></a></span>.</p>
<p>One storage is selected as an active storage, it is the storage
corresponding to the <span
class="inlinecode"><a class="idref" href="#current_shard"><span
class="id" title="definition">current_shard</span></a></span> and <span
class="inlinecode"><a class="idref" href="#current_contract"><span
class="id" title="definition">current_contract</span></a></span>.</p>
<p>Use the instruction <span
class="inlinecode"><a class="idref" href="#OpSStore"><span
class="id" title="constructor">OpSStore</span></a></span> to write to
the active storage, <span
class="inlinecode"><a class="idref" href="#OpSLoad"><span
class="id" title="constructor">OpSLoad</span></a></span> to read from
the active storage.</p>
<h2 id="instructions">Instructions</h2>
<p>Instruction <span
class="inlinecode"><a class="idref" href="#OpSLoad"><span
class="id" title="constructor">OpSLoad</span></a></span> implements
reading from storage; instruction <span
class="inlinecode"><a class="idref" href="#OpSStore"><span
class="id" title="constructor">OpSStore</span></a></span> implements
writing to storage.</p>
<h2 id="memory-model">Memory model</h2>
<p>Storage has a sequentially-consistent, strong memory model. All
writes are atomic and immediately visible; reads are guaranteed to
return the last value written.</p>
<h1 id="shards-and-contracts">Shards and contracts</h1>
<p>A <strong>contract</strong> is uniquely identified by its 160-bit
address <span
class="inlinecode"><a class="idref" href="#contract_address"><span
class="id" title="definition">contract_address</span></a></span>. In
future, the address could be seamlessly extended to up to 256 bits.</p>
<p>A <strong>shard</strong> is a mapping of contract addresses to
storages.</p>
<p>Therefore, every contract is associated with as many storages as
there are shards.</p>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="shard_params" class="idref" href="#shard_params"><span class="id" title="definition">shard_params</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#addressable_block"><span class="id" title="projection">addressable_block</span></a> := <a class="idref" href="#storage"><span class="id" title="definition">storage</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#address_bits"><span class="id" title="projection">address_bits</span></a> := 160;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#default_value"><span class="id" title="projection">default_value</span></a> := <a class="idref" href="#storage_empty"><span class="id" title="definition">storage_empty</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#writable"><span class="id" title="projection">writable</span></a> := <a class="idref" href="#true"><span class="id" title="constructor">true</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="contract_address" class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a> := <a class="idref" href="#address"><span class="id" title="definition">address</span></a> <a class="idref" href="#shard_params"><span class="id" title="definition">shard_params</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="contract_address_bits" class="idref" href="#contract_address_bits"><span class="id" title="definition">contract_address_bits</span></a> := <a class="idref" href="#address_bits"><span class="id" title="projection">address_bits</span></a> <a class="idref" href="#shard_params"><span class="id" title="definition">shard_params</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="shard" class="idref" href="#shard"><span class="id" title="definition">shard</span></a> := <a class="idref" href="#mem_parameterized"><span class="id" title="record">mem_parameterized</span></a> <a class="idref" href="#shard_params"><span class="id" title="definition">shard_params</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>Contracts are also associated with code. The association is global
per depot and implemented by <span
class="inlinecode"><a class="idref" href="#Decommitter"><span
class="id" title="section">Decommitter</span></a></span>. Therefore, the
contract code is the same for all shards, but the storages of a contract
in different shards differ.</p>
<p>Unlike in Ethereum, there is only type of accounts capable of both
transacting coins and executing contracts.</p>
<p>Contracts with addresses in range from 0 (inclusive) to <span
class="inlinecode"><span class="id"
title="var">KERNEL_MODE_MAXADDR</span></span> (exclusive) are
<strong>system contracts</strong>; they are allowed to execute all
instructions.</p>
<h1 id="depot">Depot</h1>
<p><strong>Depot</strong> is a collection of shards. Depot is the global
storage of storages of all contracts.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="depot_params" class="idref" href="#depot_params"><span class="id" title="definition">depot_params</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#addressable_block"><span class="id" title="projection">addressable_block</span></a> := <a class="idref" href="#shard"><span class="id" title="definition">shard</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#address_bits"><span class="id" title="projection">address_bits</span></a> := 8;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#default_value"><span class="id" title="projection">default_value</span></a> := <a class="idref" href="#empty"><span class="id" title="definition">empty</span></a> <span class="id" title="var">_</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#writable"><span class="id" title="projection">writable</span></a> := <a class="idref" href="#true"><span class="id" title="constructor">true</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="depot" class="idref" href="#depot"><span class="id" title="definition">depot</span></a> := <a class="idref" href="#mem_parameterized"><span class="id" title="record">mem_parameterized</span></a> <a class="idref" href="#depot_params"><span class="id" title="definition">depot_params</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="shard_id" class="idref" href="#shard_id"><span class="id" title="definition">shard_id</span></a> := <span class="id" title="definition">BITS</span> (<a class="idref" href="#address_bits"><span class="id" title="projection">address_bits</span></a> <a class="idref" href="#depot_params"><span class="id" title="definition">depot_params</span></a>).<br/>
</div>

<div class="doc"><p>There are currently two shards: one for zkRollup, one for
zkPorter.</p>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="shard_exists" class="idref" href="#shard_exists"><span class="id" title="inductive">shard_exists</span></a>: <a class="idref" href="#shard_id"><span class="id" title="definition">shard_id</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="se_rollup" class="idref" href="#se_rollup"><span class="id" title="constructor">se_rollup</span></a>: <a class="idref" href="#shard_exists:1"><span class="id" title="inductive">shard_exists</span></a> (<span class="id" title="definition">fromZ</span> 0)<br/>
&nbsp;&nbsp;| <a id="se_porter" class="idref" href="#se_porter"><span class="id" title="constructor">se_porter</span></a>: <a class="idref" href="#shard_exists:1"><span class="id" title="inductive">shard_exists</span></a> (<span class="id" title="definition">fromZ</span> 1)<br/>
&nbsp;&nbsp;.<br/>

<br/>
</div>

<div class="doc"><p>The <strong>fully qualified address</strong> of a word in depot is a
triple:</p>
<p><span class="math inline">(\texttt{shard\_id}, \texttt{contract\_id}
, \texttt{key})</span></p>
<p>It is formalized by <span
class="inlinecode"><a class="idref" href="#fqa_key"><span
class="id" title="record">fqa_key</span></a></span>.</p>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="fqa_storage" class="idref" href="#fqa_storage"><span class="id" title="record">fqa_storage</span></a> := <span class="id" title="var">mk_fqa_storage</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="k_shard" class="idref" href="#k_shard"><span class="id" title="projection">k_shard</span></a>: <a class="idref" href="#shard_id"><span class="id" title="definition">shard_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="k_contract" class="idref" href="#k_contract"><span class="id" title="projection">k_contract</span></a>: <a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="fqa_key" class="idref" href="#fqa_key"><span class="id" title="record">fqa_key</span></a> := <span class="id" title="var">mk_fqa_key</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="k_storage" class="idref" href="#k_storage"><span class="id" title="projection">k_storage</span></a> :> <a class="idref" href="#fqa_storage"><span class="id" title="record">fqa_storage</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="k_key" class="idref" href="#k_key"><span class="id" title="projection">k_key</span></a>: <a class="idref" href="#storage_address"><span class="id" title="definition">storage_address</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="storage_get" class="idref" href="#storage_get"><span class="id" title="inductive">storage_get</span></a> (<a id="d:9" class="idref" href="#d:9"><span class="id" title="binder">d</span></a>: <a class="idref" href="#depot"><span class="id" title="definition">depot</span></a>): <a class="idref" href="#fqa_storage"><span class="id" title="record">fqa_storage</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#storage"><span class="id" title="definition">storage</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="sg_apply" class="idref" href="#sg_apply"><span class="id" title="constructor">sg_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="storage:12" class="idref" href="#storage:12"><span class="id" title="binder">storage</span></a> <a id="shard:13" class="idref" href="#shard:13"><span class="id" title="binder">shard</span></a> <a id="s:14" class="idref" href="#s:14"><span class="id" title="binder">s</span></a> <a id="c:15" class="idref" href="#c:15"><span class="id" title="binder">c</span></a> <a id="st:16" class="idref" href="#st:16"><span class="id" title="binder">st</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#shard_exists"><span class="id" title="inductive">shard_exists</span></a> <a class="idref" href="#s:14"><span class="id" title="variable">s</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#load_result"><span class="id" title="inductive">MemoryBase.load_result</span></a> <a class="idref" href="#depot_params"><span class="id" title="definition">depot_params</span></a> <a class="idref" href="#s:14"><span class="id" title="variable">s</span></a> <a class="idref" href="#d:9"><span class="id" title="variable">d</span></a> <a class="idref" href="#shard:13"><span class="id" title="variable">shard</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#load_result"><span class="id" title="inductive">MemoryBase.load_result</span></a> <a class="idref" href="#shard_params"><span class="id" title="definition">shard_params</span></a> <a class="idref" href="#c:15"><span class="id" title="variable">c</span></a> <a class="idref" href="#shard:13"><span class="id" title="variable">shard</span></a> <a class="idref" href="#storage:12"><span class="id" title="variable">storage</span></a>  <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#storage_get:10"><span class="id" title="inductive">storage_get</span></a> <a class="idref" href="#d:9"><span class="id" title="variable">d</span></a> (<a class="idref" href="#mk_fqa_storage"><span class="id" title="constructor">mk_fqa_storage</span></a> <a class="idref" href="#s:14"><span class="id" title="variable">s</span></a> <a class="idref" href="#c:15"><span class="id" title="variable">c</span></a>) <a class="idref" href="#st:16"><span class="id" title="variable">st</span></a> .<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="storage_read" class="idref" href="#storage_read"><span class="id" title="inductive">storage_read</span></a> (<a id="d:17" class="idref" href="#d:17"><span class="id" title="binder">d</span></a>: <a class="idref" href="#depot"><span class="id" title="definition">depot</span></a>): <a class="idref" href="#fqa_key"><span class="id" title="record">fqa_key</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="sr_apply" class="idref" href="#sr_apply"><span class="id" title="constructor">sr_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="storage:20" class="idref" href="#storage:20"><span class="id" title="binder">storage</span></a> <a id="sk:21" class="idref" href="#sk:21"><span class="id" title="binder">sk</span></a> <a id="c:22" class="idref" href="#c:22"><span class="id" title="binder">c</span></a> <a id="w:23" class="idref" href="#w:23"><span class="id" title="binder">w</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#storage_get"><span class="id" title="inductive">storage_get</span></a> <a class="idref" href="#d:17"><span class="id" title="variable">d</span></a> <a class="idref" href="#sk:21"><span class="id" title="variable">sk</span></a> <a class="idref" href="#storage:20"><span class="id" title="variable">storage</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#storage_read:18"><span class="id" title="inductive">storage_read</span></a> <a class="idref" href="#d:17"><span class="id" title="variable">d</span></a> (<a class="idref" href="#mk_fqa_key"><span class="id" title="constructor">mk_fqa_key</span></a> <a class="idref" href="#sk:21"><span class="id" title="variable">sk</span></a> <a class="idref" href="#c:22"><span class="id" title="variable">c</span></a>) <a class="idref" href="#w:23"><span class="id" title="variable">w</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="storage_write" class="idref" href="#storage_write"><span class="id" title="inductive">storage_write</span></a> (<a id="d:24" class="idref" href="#d:24"><span class="id" title="binder">d</span></a>: <a class="idref" href="#depot"><span class="id" title="definition">depot</span></a>): <a class="idref" href="#fqa_key"><span class="id" title="record">fqa_key</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#depot"><span class="id" title="definition">depot</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="sw_apply" class="idref" href="#sw_apply"><span class="id" title="constructor">sw_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="storage:27" class="idref" href="#storage:27"><span class="id" title="binder">storage</span></a> <a id="shard:28" class="idref" href="#shard:28"><span class="id" title="binder">shard</span></a> <a id="sk:29" class="idref" href="#sk:29"><span class="id" title="binder">sk</span></a> <a id="s:30" class="idref" href="#s:30"><span class="id" title="binder">s</span></a> <a id="c:31" class="idref" href="#c:31"><span class="id" title="binder">c</span></a> <a id="k:32" class="idref" href="#k:32"><span class="id" title="binder">k</span></a> <a id="w:33" class="idref" href="#w:33"><span class="id" title="binder">w</span></a>  <a id="shard':34" class="idref" href="#shard':34"><span class="id" title="binder">shard'</span></a> <a id="depot':35" class="idref" href="#depot':35"><span class="id" title="binder">depot'</span></a> <a id="storage':36" class="idref" href="#storage':36"><span class="id" title="binder">storage'</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#storage_get"><span class="id" title="inductive">storage_get</span></a> <a class="idref" href="#d:24"><span class="id" title="variable">d</span></a> <a class="idref" href="#sk:29"><span class="id" title="variable">sk</span></a> <a class="idref" href="#storage:27"><span class="id" title="variable">storage</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store_result"><span class="id" title="inductive">MemoryBase.store_result</span></a> <a class="idref" href="#storage_params"><span class="id" title="definition">storage_params</span></a> <a class="idref" href="#k:32"><span class="id" title="variable">k</span></a> <a class="idref" href="#storage:27"><span class="id" title="variable">storage</span></a> <a class="idref" href="#w:33"><span class="id" title="variable">w</span></a> <a class="idref" href="#storage':36"><span class="id" title="variable">storage'</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store_result"><span class="id" title="inductive">MemoryBase.store_result</span></a> <a class="idref" href="#shard_params"><span class="id" title="definition">shard_params</span></a> <a class="idref" href="#c:31"><span class="id" title="variable">c</span></a> <a class="idref" href="#shard:28"><span class="id" title="variable">shard</span></a> <a class="idref" href="#storage':36"><span class="id" title="variable">storage'</span></a> <a class="idref" href="#shard':34"><span class="id" title="variable">shard'</span></a>  <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store_result"><span class="id" title="inductive">MemoryBase.store_result</span></a> <a class="idref" href="#depot_params"><span class="id" title="definition">depot_params</span></a> <a class="idref" href="#s:30"><span class="id" title="variable">s</span></a> <a class="idref" href="#d:24"><span class="id" title="variable">d</span></a> <a class="idref" href="#shard':34"><span class="id" title="variable">shard'</span></a> <a class="idref" href="#depot':35"><span class="id" title="variable">depot'</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#storage_write:25"><span class="id" title="inductive">storage_write</span></a> <a class="idref" href="#d:24"><span class="id" title="variable">d</span></a> (<a class="idref" href="#mk_fqa_key"><span class="id" title="constructor">mk_fqa_key</span></a> <a class="idref" href="#sk:29"><span class="id" title="variable">sk</span></a> <a class="idref" href="#k:32"><span class="id" title="variable">k</span></a>) <a class="idref" href="#w:33"><span class="id" title="variable">w</span></a> <a class="idref" href="#depot':35"><span class="id" title="variable">depot'</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Depot"><span class="id" title="section">Depot</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.memory.Pages</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Common</span></a> <a class="idref" href="#"><span class="id" title="library">MemoryBase</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryBase</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Pages" class="idref" href="#Pages"><span class="id" title="section">Pages</span></a>.<br/>
</div>

<div class="doc"><h1 id="main-memory-transient">Main memory (transient)</h1>
<h2 id="memory-structure">Memory structure</h2>
<p>Contract execution routinely uses <strong>main memory</strong> to
hold instructions, stack, heaps, and constants.</p>
<p>When the execution of a contract starts, new pages are allocated
for:</p>
<ul>
<li>contract code: <span
class="inlinecode"><a class="idref" href="#code_page"><span
class="id" title="definition">code_page</span></a></span>, fetched by
decommitter; see <span
class="inlinecode"><a class="idref" href="#Decommitter"><span
class="id" title="section">Decommitter</span></a></span> and <span
class="inlinecode"><a class="idref" href="#FarCalls.FarCallDefinitions"><span
class="id" title="section">FarCallDefinitions</span></a></span>);</li>
<li>data stack: <span
class="inlinecode"><a class="idref" href="#stack_page"><span
class="id" title="definition">stack_page</span></a></span>;</li>
<li>heap: <span
class="inlinecode"><a class="idref" href="#data_page"><span
class="id" title="definition">data_page</span></a></span>;</li>
<li>aux_heap: <span
class="inlinecode"><a class="idref" href="#data_page"><span
class="id" title="definition">data_page</span></a></span>;</li>
<li>constants: <span
class="inlinecode"><a class="idref" href="#const_page"><span
class="id" title="definition">const_page</span></a></span>,
implementation may chose to allocate code and constants on the same
page.</li>
</ul>
<p>Therefore, the types of pages are: data pages, stack pages, constant
data pages, and code pages.</p>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="code_page:1" class="idref" href="#code_page:1"><span class="id" title="binder">code_page</span></a> <a id="const_page:2" class="idref" href="#const_page:2"><span class="id" title="binder">const_page</span></a> <a id="data_page:3" class="idref" href="#data_page:3"><span class="id" title="binder">data_page</span></a> <a id="stack_page:4" class="idref" href="#stack_page:4"><span class="id" title="binder">stack_page</span></a>: <span class="id" title="keyword">Type</span>}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="page_type" class="idref" href="#page_type"><span class="id" title="inductive">page_type</span></a> :=<br/>
&nbsp;&nbsp;| <a id="DataPage" class="idref" href="#DataPage"><span class="id" title="constructor">DataPage</span></a> : <a class="idref" href="#Pages.data_page"><span class="id" title="variable">data_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#page_type:5"><span class="id" title="inductive">page_type</span></a><br/>
&nbsp;&nbsp;| <a id="StackPage" class="idref" href="#StackPage"><span class="id" title="constructor">StackPage</span></a> : <a class="idref" href="#Pages.stack_page"><span class="id" title="variable">stack_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#page_type:5"><span class="id" title="inductive">page_type</span></a><br/>
&nbsp;&nbsp;| <a id="ConstPage" class="idref" href="#ConstPage"><span class="id" title="constructor">ConstPage</span></a> : <a class="idref" href="#Pages.const_page"><span class="id" title="variable">const_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#page_type:5"><span class="id" title="inductive">page_type</span></a><br/>
&nbsp;&nbsp;| <a id="CodePage" class="idref" href="#CodePage"><span class="id" title="constructor">CodePage</span></a> : <a class="idref" href="#Pages.code_page"><span class="id" title="variable">code_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#page_type:5"><span class="id" title="inductive">page_type</span></a><br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="page" class="idref" href="#page"><span class="id" title="record">page</span></a> := <span class="id" title="var">mk_page</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="type" class="idref" href="#type"><span class="id" title="projection">type</span></a>:> <a class="idref" href="#page_type"><span class="id" title="inductive">page_type</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
</div>

<div class="doc"><p><strong>Memory</strong> is a collection of pages <span
class="inlinecode"><a class="idref" href="#memory"><span
class="id" title="definition">memory</span></a></span>, each page is
attributed a unique identifier <span
class="inlinecode"><a class="idref" href="#page_id"><span
class="id" title="definition">page_id</span></a></span>. Pages persist
for as long as they can be read by some code; in presence of <span
class="inlinecode"><a class="idref" href="#PointerDefinitions.FatPointer"><span
class="id" title="section">FatPointer</span></a></span> the page
lifetime may exceed the lifetime of the frame that created it.</p>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="page_id" class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a> := <a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="pages" class="idref" href="#pages"><span class="id" title="definition">pages</span></a> := <a class="idref" href="#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#page"><span class="id" title="record">page</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="memory" class="idref" href="#memory"><span class="id" title="record">memory</span></a> := <span class="id" title="var">mk_pages</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="mem_pages" class="idref" href="#mem_pages"><span class="id" title="projection">mem_pages</span></a>:> <a class="idref" href="#pages"><span class="id" title="definition">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="page_has_id" class="idref" href="#page_has_id"><span class="id" title="inductive">page_has_id</span></a> : <a class="idref" href="#memory"><span class="id" title="record">memory</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#page"><span class="id" title="record">page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="mpid_select" class="idref" href="#mpid_select"><span class="id" title="constructor">mpid_select</span></a> : <span class="id" title="keyword">∀</span> <a id="mm:13" class="idref" href="#mm:13"><span class="id" title="binder">mm</span></a> <a id="id:14" class="idref" href="#id:14"><span class="id" title="binder">id</span></a> <a id="page:15" class="idref" href="#page:15"><span class="id" title="binder">page</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#In"><span class="id" title="definition">List.In</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#id:14"><span class="id" title="variable">id</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#page:15"><span class="id" title="variable">page</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#mm:13"><span class="id" title="variable">mm</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#page_has_id:11"><span class="id" title="inductive">page_has_id</span></a> (<a class="idref" href="#mk_pages"><span class="id" title="constructor">mk_pages</span></a> <a class="idref" href="#mm:13"><span class="id" title="variable">mm</span></a>) <a class="idref" href="#id:14"><span class="id" title="variable">id</span></a> <a class="idref" href="#page:15"><span class="id" title="variable">page</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>The set of identifiers has a complete linear order, ordering the
pages by the time of creation. The ability to distinguish older pages
from newer is necessary to prevent returning fat pointers to pages from
older frames. See e.g. <span class="inlinecode"></span> <span
class="inlinecode"><a class="idref" href="#step_RetExt_ForwardFatPointer"><span
class="id"
title="constructor">step_RetExt_ForwardFatPointer</span></a></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Pages.Order" class="idref" href="#Pages.Order"><span class="id" title="section">Order</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="page_ordering" class="idref" href="#page_ordering"><span class="id" title="definition">page_ordering</span></a> := <a class="idref" href="#leb"><span class="id" title="definition">Nat.leb</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="page_eq" class="idref" href="#page_eq"><span class="id" title="definition">page_eq</span></a> <a id="x:16" class="idref" href="#x:16"><span class="id" title="binder">x</span></a> <a id="y:17" class="idref" href="#y:17"><span class="id" title="binder">y</span></a> := <a class="idref" href="#page_ordering"><span class="id" title="definition">page_ordering</span></a> <a class="idref" href="#x:16"><span class="id" title="variable">x</span></a> <a class="idref" href="#y:17"><span class="id" title="variable">y</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a> <a class="idref" href="#page_ordering"><span class="id" title="definition">page_ordering</span></a> <a class="idref" href="#y:17"><span class="id" title="variable">y</span></a> <a class="idref" href="#x:16"><span class="id" title="variable">x</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="page_neq" class="idref" href="#page_neq"><span class="id" title="definition">page_neq</span></a> <a id="x:18" class="idref" href="#x:18"><span class="id" title="binder">x</span></a> <a id="y:19" class="idref" href="#y:19"><span class="id" title="binder">y</span></a> := <a class="idref" href="#negb"><span class="id" title="definition">negb</span></a> (<a class="idref" href="#page_eq"><span class="id" title="definition">page_eq</span></a> <a class="idref" href="#x:18"><span class="id" title="variable">x</span></a> <a class="idref" href="#y:19"><span class="id" title="variable">y</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="page_older" class="idref" href="#page_older"><span class="id" title="definition">page_older</span></a> (<a id="id1:20" class="idref" href="#id1:20"><span class="id" title="binder">id1</span></a> <a id="id2:21" class="idref" href="#id2:21"><span class="id" title="binder">id2</span></a>: <a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a>) : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#page_ordering"><span class="id" title="definition">page_ordering</span></a> <a class="idref" href="#id1:20"><span class="id" title="variable">id1</span></a> <a class="idref" href="#id2:21"><span class="id" title="variable">id2</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="#Pages.Order"><span class="id" title="section">Order</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>Predicate <span
class="inlinecode"><a class="idref" href="#page_replace"><span
class="id" title="inductive">page_replace</span></a></span> describes a
relation between two memories <span class="inlinecode"><span class="id"
title="var">m1</span></span> and <span class="inlinecode"><span
class="id" title="var">m2</span></span>, where <span
class="inlinecode"><span class="id" title="var">m2</span></span> is a
copy of <span class="inlinecode"><span class="id"
title="var">m1</span></span> but a page with it <span
class="inlinecode"><span class="id" title="var">id</span></span> is
replaced by another page <span class="inlinecode"><span class="id"
title="var">p</span></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="page_replace_list" class="idref" href="#page_replace_list"><span class="id" title="inductive">page_replace_list</span></a> (<a id="id:22" class="idref" href="#id:22"><span class="id" title="binder">id</span></a>:<a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a>) (<a id="p:23" class="idref" href="#p:23"><span class="id" title="binder">p</span></a>:<a class="idref" href="#page"><span class="id" title="record">page</span></a>): <a class="idref" href="#pages"><span class="id" title="definition">pages</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#pages"><span class="id" title="definition">pages</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="mm_replace_base" class="idref" href="#mm_replace_base"><span class="id" title="constructor">mm_replace_base</span></a>: <span class="id" title="keyword">∀</span> <a id="oldpage:26" class="idref" href="#oldpage:26"><span class="id" title="binder">oldpage</span></a> <a id="newpage:27" class="idref" href="#newpage:27"><span class="id" title="binder">newpage</span></a> <a id="tail:28" class="idref" href="#tail:28"><span class="id" title="binder">tail</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#page_replace_list:24"><span class="id" title="inductive">page_replace_list</span></a> <a class="idref" href="#id:22"><span class="id" title="variable">id</span></a> <a class="idref" href="#p:23"><span class="id" title="variable">p</span></a> (<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#id:22"><span class="id" title="variable">id</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#oldpage:26"><span class="id" title="variable">oldpage</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="#tail:28"><span class="id" title="variable">tail</span></a>) (<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#id:22"><span class="id" title="variable">id</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#newpage:27"><span class="id" title="variable">newpage</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="#tail:28"><span class="id" title="variable">tail</span></a>)<br/>
&nbsp;&nbsp;| <a id="mm_replace_ind" class="idref" href="#mm_replace_ind"><span class="id" title="constructor">mm_replace_ind</span></a>: <span class="id" title="keyword">∀</span> <a id="oldpage:29" class="idref" href="#oldpage:29"><span class="id" title="binder">oldpage</span></a> <a id="not_id:30" class="idref" href="#not_id:30"><span class="id" title="binder">not_id</span></a> <a id="tail:31" class="idref" href="#tail:31"><span class="id" title="binder">tail</span></a> <a id="tail':32" class="idref" href="#tail':32"><span class="id" title="binder">tail'</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#page_replace_list:24"><span class="id" title="inductive">page_replace_list</span></a> <a class="idref" href="#id:22"><span class="id" title="variable">id</span></a> <a class="idref" href="#p:23"><span class="id" title="variable">p</span></a> <a class="idref" href="#tail:31"><span class="id" title="variable">tail</span></a> <a class="idref" href="#tail':32"><span class="id" title="variable">tail'</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#id:22"><span class="id" title="variable">id</span></a> <a class="idref" href="#::type_scope:x_'<>'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="#not_id:30"><span class="id" title="variable">not_id</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#page_replace_list:24"><span class="id" title="inductive">page_replace_list</span></a> <a class="idref" href="#id:22"><span class="id" title="variable">id</span></a> <a class="idref" href="#p:23"><span class="id" title="variable">p</span></a> (<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#not_id:30"><span class="id" title="variable">not_id</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#oldpage:29"><span class="id" title="variable">oldpage</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="#tail:31"><span class="id" title="variable">tail</span></a>) (<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#not_id:30"><span class="id" title="variable">not_id</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#oldpage:29"><span class="id" title="variable">oldpage</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="#tail':32"><span class="id" title="variable">tail'</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="page_replace" class="idref" href="#page_replace"><span class="id" title="inductive">page_replace</span></a> (<a id="id:33" class="idref" href="#id:33"><span class="id" title="binder">id</span></a>:<a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a>) (<a id="p:34" class="idref" href="#p:34"><span class="id" title="binder">p</span></a>:<a class="idref" href="#page"><span class="id" title="record">page</span></a>): <a class="idref" href="#memory"><span class="id" title="record">memory</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#memory"><span class="id" title="record">memory</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="prl_apply" class="idref" href="#prl_apply"><span class="id" title="constructor">prl_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="ls:37" class="idref" href="#ls:37"><span class="id" title="binder">ls</span></a> <a id="ls':38" class="idref" href="#ls':38"><span class="id" title="binder">ls'</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#page_replace_list"><span class="id" title="inductive">page_replace_list</span></a> <a class="idref" href="#id:33"><span class="id" title="variable">id</span></a> <a class="idref" href="#p:34"><span class="id" title="variable">p</span></a> <a class="idref" href="#ls:37"><span class="id" title="variable">ls</span></a> <a class="idref" href="#ls':38"><span class="id" title="variable">ls'</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#page_replace:35"><span class="id" title="inductive">page_replace</span></a> <a class="idref" href="#id:33"><span class="id" title="variable">id</span></a> <a class="idref" href="#p:34"><span class="id" title="variable">p</span></a> (<a class="idref" href="#mk_pages"><span class="id" title="constructor">mk_pages</span></a> <a class="idref" href="#ls:37"><span class="id" title="variable">ls</span></a>) (<a class="idref" href="#mk_pages"><span class="id" title="constructor">mk_pages</span></a> <a class="idref" href="#ls':38"><span class="id" title="variable">ls'</span></a>).<br/>

<br/>
</div>

<div class="doc"><p>Function <span
class="inlinecode"><a class="idref" href="#page_alloc"><span
class="id" title="definition">page_alloc</span></a></span> creates a new
page in memory.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="page_alloc" class="idref" href="#page_alloc"><span class="id" title="definition">page_alloc</span></a> (<a id="p:39" class="idref" href="#p:39"><span class="id" title="binder">p</span></a>:<a class="idref" href="#page"><span class="id" title="record">page</span></a>) (<a id="m:40" class="idref" href="#m:40"><span class="id" title="binder">m</span></a>: <a class="idref" href="#memory"><span class="id" title="record">memory</span></a>) : <a class="idref" href="#memory"><span class="id" title="record">memory</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_id:41" class="idref" href="#new_id:41"><span class="id" title="binder">new_id</span></a> := <a class="idref" href="#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="#mem_pages"><span class="id" title="projection">mem_pages</span></a> <a class="idref" href="#m:40"><span class="id" title="variable">m</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#m:40"><span class="id" title="variable">m</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_pages"><span class="id" title="constructor">mk_pages</span></a> <a class="idref" href="#mem_pages"><span class="id" title="projection">mem_pages</span></a> ⇒ <a class="idref" href="#mk_pages"><span class="id" title="constructor">mk_pages</span></a> (<a class="idref" href="#cons"><span class="id" title="constructor">cons</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#new_id:41"><span class="id" title="variable">new_id</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#p:39"><span class="id" title="variable">p</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <span class="id" title="var">mem_pages</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Pages"><span class="id" title="section">Pages</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.memory.PageTypes</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">List</span></a> <a class="idref" href="#"><span class="id" title="library">Core</span></a> <a class="idref" href="#"><span class="id" title="library">MemoryBase</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryBase</span></a> <a class="idref" href="#"><span class="id" title="module">List</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Memory" class="idref" href="#Memory"><span class="id" title="section">Memory</span></a>.<br/>

<br/>
</div>

<div class="doc"><h3 id="data-pages">Data pages</h3>
<p>A <strong>data page</strong> contains individually addressable bytes.
Each data page holds <span class="math inline">2^{32}</span> bytes.</p>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="data_page_params" class="idref" href="#data_page_params"><span class="id" title="definition">data_page_params</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#addressable_block"><span class="id" title="projection">addressable_block</span></a> := <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#address_bits"><span class="id" title="projection">address_bits</span></a> := 32;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#default_value"><span class="id" title="projection">default_value</span></a> := <a class="idref" href="#zero8"><span class="id" title="definition">zero8</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#writable"><span class="id" title="projection">writable</span></a> := <a class="idref" href="#true"><span class="id" title="constructor">true</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="mem_address" class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a> := <a class="idref" href="#address"><span class="id" title="definition">address</span></a> <a class="idref" href="#data_page_params"><span class="id" title="definition">data_page_params</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="mem_address_zero" class="idref" href="#mem_address_zero"><span class="id" title="definition">mem_address_zero</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a> := <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="mem_address_bits" class="idref" href="#mem_address_bits"><span class="id" title="definition">mem_address_bits</span></a> := <a class="idref" href="#data_page_params"><span class="id" title="definition">data_page_params</span></a>.(<a class="idref" href="#address_bits"><span class="id" title="projection">address_bits</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="data_page" class="idref" href="#data_page"><span class="id" title="definition">data_page</span></a> := <a class="idref" href="#mem_parameterized"><span class="id" title="record">mem_parameterized</span></a> <a class="idref" href="#data_page_params"><span class="id" title="definition">data_page_params</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>There are currently two types of data pages:</p>
<ul>
<li><p><span
class="inlinecode"><a class="idref" href="#Heap"><span
class="id" title="constructor">Heap</span></a></span></p></li>
<li><p><span
class="inlinecode"><a class="idref" href="#AuxHeap"><span
class="id" title="constructor">AuxHeap</span></a></span>.</p>
<p>We call both of them <strong>heap variants</strong> for brevity, as
in almost all cases they are handled in a similar way.</p></li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="data_page_type" class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a> := <a id="Heap" class="idref" href="#Heap"><span class="id" title="constructor">Heap</span></a> | <a id="AuxHeap" class="idref" href="#AuxHeap"><span class="id" title="constructor">AuxHeap</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="page_bound" class="idref" href="#page_bound"><span class="id" title="definition">page_bound</span></a> := <a class="idref" href="#prod"><span class="id" title="inductive">prod</span></a> <a class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a> <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="growth" class="idref" href="#growth"><span class="id" title="definition">growth</span></a> (<a id="current_bound:3" class="idref" href="#current_bound:3"><span class="id" title="binder">current_bound</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>) (<a id="query_bound:4" class="idref" href="#query_bound:4"><span class="id" title="binder">query_bound</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#query_bound:4"><span class="id" title="variable">query_bound</span></a> <a class="idref" href="#::ZMod_scope:x_'<'_x"><span class="id" title="notation"><</span></a> <a class="idref" href="#current_bound:3"><span class="id" title="variable">current_bound</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="#query_bound:4"><span class="id" title="variable">query_bound</span></a> <a class="idref" href="#::ZMod_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="#current_bound:3"><span class="id" title="variable">current_bound</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
</div>

<div class="doc"><p>Note: only selected few instructions can access data pages:</p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#OpLoad"><span
class="id" title="constructor">OpLoad</span></a></span>/<span
class="inlinecode"><a class="idref" href="#OpLoadInc"><span
class="id" title="constructor">OpLoadInc</span></a></span></li>
<li><span
class="inlinecode"><a class="idref" href="#OpStore"><span
class="id" title="constructor">OpStore</span></a></span>/<span
class="inlinecode"><a class="idref" href="#OpStoreInc"><span
class="id" title="constructor">OpStoreInc</span></a></span></li>
<li><span
class="inlinecode"><a class="idref" href="#OpLoadPointer"><span
class="id" title="constructor">OpLoadPointer</span></a></span>/<span
class="inlinecode"><a class="idref" href="#OpLoadPointerInc"><span
class="id" title="constructor">OpLoadPointerInc</span></a></span></li>
</ul>
<p>Every byte on data pages has an address, but these instructions read
or store 32-byte words.</p>
<hr />
<p>Fat pointers <span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span> define slices of
data pages and allow passing them between contracts.</p>
<h3 id="stack-pages">Stack pages</h3>
<p>A <strong>stack page</strong> contains <span
class="math inline">2^{16}</span> primitive values (see <span
class="inlinecode"><a class="idref" href="#primitive_value"><span
class="id" title="record">primitive_value</span></a></span>). Reminder:
primitive values are tagged words.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="primitive_value:5" class="idref" href="#primitive_value:5"><span class="id" title="binder">primitive_value</span></a>: <span class="id" title="keyword">Type</span>} (<a id="pv0:6" class="idref" href="#pv0:6"><span class="id" title="binder">pv0</span></a>: <a class="idref" href="#primitive_value:5"><span class="id" title="variable">primitive_value</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="stack_page_params" class="idref" href="#stack_page_params"><span class="id" title="definition">stack_page_params</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#addressable_block"><span class="id" title="projection">addressable_block</span></a> := <a class="idref" href="#Memory.primitive_value"><span class="id" title="variable">primitive_value</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#address_bits"><span class="id" title="projection">address_bits</span></a> := 16;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#default_value"><span class="id" title="projection">default_value</span></a> := <a class="idref" href="#Memory.pv0"><span class="id" title="variable">pv0</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#writable"><span class="id" title="projection">writable</span></a> := <a class="idref" href="#true"><span class="id" title="constructor">true</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="stack_address" class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a> := <a class="idref" href="#address"><span class="id" title="definition">address</span></a> <a class="idref" href="#stack_page_params"><span class="id" title="definition">stack_page_params</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="stack_address_bits" class="idref" href="#stack_address_bits"><span class="id" title="definition">stack_address_bits</span></a> := <a class="idref" href="#stack_page_params"><span class="id" title="definition">stack_page_params</span></a>.(<a class="idref" href="#address_bits"><span class="id" title="projection">address_bits</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="stack_address_zero" class="idref" href="#stack_address_zero"><span class="id" title="definition">stack_address_zero</span></a>: <a class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a> := <a class="idref" href="#zero16"><span class="id" title="definition">zero16</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="stack_page" class="idref" href="#stack_page"><span class="id" title="definition">stack_page</span></a> := <a class="idref" href="#mem_parameterized"><span class="id" title="record">mem_parameterized</span></a> <a class="idref" href="#stack_page_params"><span class="id" title="definition">stack_page_params</span></a>.<br/>

<br/>
</div>

<div class="doc"><h4 id="data-stack-in-eravm">Data stack in EraVM</h4>
<p>There are two stacks in EraVM: call stack to support the execution of
functions and contracts, and data stack to facilitate computations. This
section details the data stack.</p>
<p>At each moment of execution, one stack page is active; it is
associated with the topmost of external frames, which belongs to the
contract currently being executed. See <span
class="inlinecode"><a class="idref" href="#active_extframe"><span
class="id" title="definition">active_extframe</span></a></span>, its
field <span
class="inlinecode"><a class="idref" href="#ecf_mem_ctx"><span
class="id" title="projection">ecf_mem_ctx</span></a></span> and subfield
<span
class="inlinecode"><a class="idref" href="#ctx_stack_page_id"><span
class="id" title="projection">ctx_stack_page_id</span></a></span>.</p>
<p>Each contract instance has an independent stack on a separate page.
Instead of zero, stack pointer on new stack pages start with a value
<span
class="inlinecode"><a class="idref" href="#INITIAL_SP_ON_FAR_CALL"><span
class="id" title="definition">INITIAL_SP_ON_FAR_CALL</span></a></span>.
Stack addresses in range [0; <span
class="inlinecode"><a class="idref" href="#INITIAL_SP_ON_FAR_CALL"><span
class="id" title="definition">INITIAL_SP_ON_FAR_CALL</span></a></span>)
can be used as a scratch space.</p>
<p>Topmost frame of the callstack, whether internal or external,
contains the stack pointer (SP) value <span
class="inlinecode"><a class="idref" href="#cf_sp"><span
class="id" title="projection">cf_sp</span></a></span>; which points to
the address after the topmost element of the stack. That means that the
topmost element of the stack is located in word number <span
class="math inline">(\mathit{SP}-1)</span> on the associated stack
page.</p>
<p>Data stack grows towards greater addresses. In other words, pushing
to stack increases stack pointer value, and popping elements decreases
stack pointer.</p>
<h3 id="const-pages">Const pages</h3>
<p>A <strong>const page</strong> contains <span
class="math inline">2^{16}</span> non tagged <span
class="inlinecode"><a class="idref" href="#word"><span
class="id" title="definition">word</span></a></span>s. They are not
writable.</p>
<p>Implementation may put constants and code on the same pages. In this
case, the bytes on the same virtual page can be addressed in two
ways:</p>
<ul>
<li>For instructions <span
class="inlinecode"><a class="idref" href="#OpJump"><span
class="id" title="constructor">OpJump</span></a></span> and <span
class="inlinecode"><a class="idref" href="#OpNearCall"><span
class="id" title="constructor">OpNearCall</span></a></span>, the code
addressing will be used: consecutive addresses correspond to 8-bytes
instructions.</li>
<li>For instructions like <span
class="inlinecode"><a class="idref" href="#OpAdd"><span
class="id" title="constructor">OpAdd</span></a></span> with <span
class="inlinecode"><a class="idref" href="#CodeAddr"><span
class="id" title="constructor">CodeAddr</span></a></span> addressing
mode, the const data addressing will be used: consecutive addresses
correspond to 32-bytes words.</li>
</ul>
<p>For example, <span
class="inlinecode"><a class="idref" href="#OpJump"><span
class="id" title="constructor">OpJump</span></a></span> <span
class="inlinecode">0</span>, <span
class="inlinecode"><a class="idref" href="#OpJump"><span
class="id" title="constructor">OpJump</span></a></span> <span
class="inlinecode">1</span>, <span
class="inlinecode"><a class="idref" href="#OpJump"><span
class="id" title="constructor">OpJump</span></a></span> <span
class="inlinecode">2</span>, <span
class="inlinecode"><a class="idref" href="#OpJump"><span
class="id" title="constructor">OpJump</span></a></span> <span
class="inlinecode">3</span> will refer to the first four instructions on
the page; their binary representations, put together, can be fetched by
addressing the const page’s 0-th word e.g. <span
class="inlinecode"><a class="idref" href="#OpAdd"><span
class="id" title="constructor">OpAdd</span></a></span> <span
class="inlinecode">(<a class="idref" href="#CodeAddr"><span
class="id" title="constructor">CodeAddr</span></a></span> <span
class="inlinecode"><a class="idref" href="#R0"><span
class="id" title="constructor">R0</span></a></span> <span
class="inlinecode"><span class="id" title="var">zero_16</span></span>
<span class="inlinecode">)</span> <span
class="inlinecode">(<a class="idref" href="#Reg"><span
class="id" title="constructor">Reg</span></a></span> <span
class="inlinecode"><a class="idref" href="#R0"><span
class="id" title="constructor">R0</span></a>)</span> <span
class="inlinecode">(<a class="idref" href="#Reg"><span
class="id" title="constructor">Reg</span></a></span> <span
class="inlinecode"><a class="idref" href="#R1"><span
class="id" title="constructor">R1</span></a>)</span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="const_address_bits" class="idref" href="#const_address_bits"><span class="id" title="definition">const_address_bits</span></a> := 16.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="const_page_params" class="idref" href="#const_page_params"><span class="id" title="definition">const_page_params</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#addressable_block"><span class="id" title="projection">addressable_block</span></a> := <a class="idref" href="#word"><span class="id" title="definition">word</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#address_bits"><span class="id" title="projection">address_bits</span></a> := <a class="idref" href="#const_address_bits"><span class="id" title="definition">const_address_bits</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#default_value"><span class="id" title="projection">default_value</span></a> := <a class="idref" href="#word0"><span class="id" title="definition">word0</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#writable"><span class="id" title="projection">writable</span></a> := <a class="idref" href="#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="const_address" class="idref" href="#const_address"><span class="id" title="definition">const_address</span></a> :=  <a class="idref" href="#address"><span class="id" title="definition">address</span></a> <a class="idref" href="#const_page_params"><span class="id" title="definition">const_page_params</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="const_page" class="idref" href="#const_page"><span class="id" title="definition">const_page</span></a> := <a class="idref" href="#mem_parameterized"><span class="id" title="record">mem_parameterized</span></a> <a class="idref" href="#const_page_params"><span class="id" title="definition">const_page_params</span></a>.<br/>

<br/>
</div>

<div class="doc"><h3 id="code-pages">Code pages</h3>
<p>A <strong>code page</strong> contains <span
class="math inline">2^{16}</span> instructions. They are not
writable.</p>
<p>On genesis, code pages are filled as follows:</p>
<ul>
<li>The contract code is places starting from the address 0.</li>
<li>The rest is filled with a value guaranteed to decode as <span
class="inlinecode"><a class="idref" href="#invalid"><span
class="id" title="definition">invalid</span></a></span>
instruction.</li>
</ul>
<p>Const pages can coincide with code pages.</p>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="ins_type:7" class="idref" href="#ins_type:7"><span class="id" title="binder">ins_type</span></a>: <span class="id" title="keyword">Type</span>} (<a id="invalid_ins:8" class="idref" href="#invalid_ins:8"><span class="id" title="binder">invalid_ins</span></a>: <a class="idref" href="#ins_type:7"><span class="id" title="variable">ins_type</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Implementation&nbsp;note:&nbsp;<span class="inlinecode"><span class="id" title="var">code_address</span></span>&nbsp;should&nbsp;be&nbsp;<span class="inlinecode"><span class="id" title="var">address</span></span> <span class="inlinecode"><span class="id" title="var">code_page_params</span></span>&nbsp;but&nbsp;we&nbsp;don't&nbsp;want&nbsp;to&nbsp;introduce<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dependency&nbsp;between&nbsp;code_address&nbsp;and&nbsp;instruction&nbsp;type&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="code_address_bits" class="idref" href="#code_address_bits"><span class="id" title="definition">code_address_bits</span></a> := 16.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="code_address" class="idref" href="#code_address"><span class="id" title="definition">code_address</span></a> := <span class="id" title="definition">BITS</span> <a class="idref" href="#code_address_bits"><span class="id" title="definition">code_address_bits</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="code_address_zero" class="idref" href="#code_address_zero"><span class="id" title="definition">code_address_zero</span></a>: <a class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a> := <a class="idref" href="#zero16"><span class="id" title="definition">zero16</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="code_page_params" class="idref" href="#code_page_params"><span class="id" title="definition">code_page_params</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#addressable_block"><span class="id" title="projection">addressable_block</span></a> := <a class="idref" href="#Memory.ins_type"><span class="id" title="variable">ins_type</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#address_bits"><span class="id" title="projection">address_bits</span></a> := <a class="idref" href="#code_address_bits"><span class="id" title="definition">code_address_bits</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#default_value"><span class="id" title="projection">default_value</span></a> := <a class="idref" href="#Memory.invalid_ins"><span class="id" title="variable">invalid_ins</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#writable"><span class="id" title="projection">writable</span></a> := <a class="idref" href="#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="code_page" class="idref" href="#code_page"><span class="id" title="record">code_page</span></a> := <span class="id" title="var">mk_code_page</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="cp_insns" class="idref" href="#cp_insns"><span class="id" title="projection">cp_insns</span></a>:> <a class="idref" href="#mem_parameterized"><span class="id" title="record">mem_parameterized</span></a> <a class="idref" href="#code_page_params"><span class="id" title="definition">code_page_params</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="code_length" class="idref" href="#code_length"><span class="id" title="definition">code_length</span></a> := <a class="idref" href="#code_address"><span class="id" title="definition">code_address</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Memory"><span class="id" title="section">Memory</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.Pointer</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">memory.Pages</span></a> <a class="idref" href="#"><span class="id" title="library">memory.PageTypes</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Arith</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryBase</span></a> <a class="idref" href="#"><span class="id" title="module">PageTypes</span></a> <a class="idref" href="#"><span class="id" title="module">Pages</span></a> <span class="id" title="module">RecordSetNotations</span> <a class="idref" href="#"><span class="id" title="module">BinInt</span></a> <span class="id" title="module">zmodp</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect.tuple</span> <span class="id" title="module">ssreflect.eqtype</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="PointerDefinitions" class="idref" href="#PointerDefinitions"><span class="id" title="section">PointerDefinitions</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="bytes_in_word:1" class="idref" href="#bytes_in_word:1"><span class="id" title="binder">bytes_in_word</span></a> := <a class="idref" href="#u32_of"><span class="id" title="definition">u32_of</span></a> <a class="idref" href="#z_bytes_in_word"><span class="id" title="definition">z_bytes_in_word</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
</div>

<div class="doc"><p>This library describes concepts related to <span
class="inlinecode"><a class="idref" href="#data_page"><span
class="id" title="definition">data_page</span></a></span>s: spans, heap
pointers, and fat pointers.</p>
<h1 id="span">Span</h1>
<p>A <strong>span</strong> is a range of addresses from <span
class="inlinecode"><a class="idref" href="#s_start"><span
class="id" title="projection">s_start</span></a></span> inclusive to
<span
class="inlinecode"><a class="idref" href="#s_start"><span
class="id" title="projection">s_start</span></a></span> <span
class="inlinecode">+</span> <span
class="inlinecode"><a class="idref" href="#s_length"><span
class="id" title="projection">s_length</span></a></span> exclusive. It
is not bound to a specific page.</p>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="span" class="idref" href="#span"><span class="id" title="record">span</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mk_span</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="s_start" class="idref" href="#s_start"><span class="id" title="projection">s_start</span></a> : <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="s_length" class="idref" href="#s_length"><span class="id" title="projection">s_length</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="span_empty" class="idref" href="#span_empty"><span class="id" title="definition">span_empty</span></a> := <a class="idref" href="#mk_span"><span class="id" title="constructor">mk_span</span></a> <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a> <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="span_limit" class="idref" href="#span_limit"><span class="id" title="inductive">span_limit</span></a>: <a class="idref" href="#span"><span class="id" title="record">span</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="sl_apply" class="idref" href="#sl_apply"><span class="id" title="constructor">sl_apply</span></a>:<span class="id" title="keyword">∀</span> <a id="start:7" class="idref" href="#start:7"><span class="id" title="binder">start</span></a> <a id="length:8" class="idref" href="#length:8"><span class="id" title="binder">length</span></a> <a id="limit:9" class="idref" href="#limit:9"><span class="id" title="binder">limit</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#limit:9"><span class="id" title="variable">limit</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#start:7"><span class="id" title="variable">start</span></a> <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <a class="idref" href="#length:8"><span class="id" title="variable">length</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#span_limit:5"><span class="id" title="inductive">span_limit</span></a> (<a class="idref" href="#mk_span"><span class="id" title="constructor">mk_span</span></a> <a class="idref" href="#start:7"><span class="id" title="variable">start</span></a> <a class="idref" href="#length:8"><span class="id" title="variable">length</span></a>) <a class="idref" href="#limit:9"><span class="id" title="variable">limit</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="bound_of_span" class="idref" href="#bound_of_span"><span class="id" title="inductive">bound_of_span</span></a> : <a class="idref" href="#span"><span class="id" title="record">span</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#page_bound"><span class="id" title="definition">page_bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="qos_apply" class="idref" href="#qos_apply"><span class="id" title="constructor">qos_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="s:12" class="idref" href="#s:12"><span class="id" title="binder">s</span></a> <a id="limit:13" class="idref" href="#limit:13"><span class="id" title="binder">limit</span></a> <a id="hv:14" class="idref" href="#hv:14"><span class="id" title="binder">hv</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#span_limit"><span class="id" title="inductive">span_limit</span></a> <a class="idref" href="#s:12"><span class="id" title="variable">s</span></a> <a class="idref" href="#limit:13"><span class="id" title="variable">limit</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bound_of_span:10"><span class="id" title="inductive">bound_of_span</span></a> <a class="idref" href="#s:12"><span class="id" title="variable">s</span></a> <a class="idref" href="#hv:14"><span class="id" title="variable">hv</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#hv:14"><span class="id" title="variable">hv</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#limit:13"><span class="id" title="variable">limit</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>
</div>

<div class="doc"><h2 id="usage">Usage</h2>
<p>Passing a span in <span class="inlinecode"><span class="id"
title="var">ForwardNewHeapPointer</span></span> as an argument to far
calls or far returns creates a <strong>fat pointer</strong>. The
required encoding is described by <span
class="inlinecode"><a class="idref" href="#FarRetABI"><span
class="id" title="section">FarRetABI</span></a></span> or <span
class="inlinecode"><a class="idref" href="#FarCallABI"><span
class="id" title="section">FarCallABI</span></a></span>. See <span
class="inlinecode"><a class="idref" href="#FarCalls.FarCallDefinitions"><span
class="id" title="section">FarCallDefinitions</span></a></span> and
<span class="inlinecode"><span class="id"
title="library">FarRet</span></span>.</p>
<p>See also: <span
class="inlinecode"><a class="idref" href="#Slices"><span
class="id" title="section">Slices</span></a></span>.</p>
<p>In EraVM, heap variants have a bound, stored in call stack frames
(see <span
class="inlinecode"><a class="idref" href="#ctx_heap_bound"><span
class="id" title="projection">ctx_heap_bound</span></a></span> of <span
class="inlinecode"><a class="idref" href="#ecf_mem_ctx"><span
class="id" title="projection">ecf_mem_ctx</span></a></span>). If memory
is accessed beyond this bound, the bound is adjusted and the growth
(difference between bounds) is paid in ergs. Definition <span
class="inlinecode"><a class="idref" href="#span_induced_growth"><span
class="id" title="inductive">span_induced_growth</span></a></span>
computes how many bytes should the user pay for.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="span_induced_growth" class="idref" href="#span_induced_growth"><span class="id" title="inductive">span_induced_growth</span></a>: <a class="idref" href="#span"><span class="id" title="record">span</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="gb_bytes" class="idref" href="#gb_bytes"><span class="id" title="constructor">gb_bytes</span></a>: <span class="id" title="keyword">∀</span> <a id="start:17" class="idref" href="#start:17"><span class="id" title="binder">start</span></a> <a id="length:18" class="idref" href="#length:18"><span class="id" title="binder">length</span></a> <a id="query_bound:19" class="idref" href="#query_bound:19"><span class="id" title="binder">query_bound</span></a> <a id="current_bound:20" class="idref" href="#current_bound:20"><span class="id" title="binder">current_bound</span></a> <a id="diff:21" class="idref" href="#diff:21"><span class="id" title="binder">diff</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#start:17"><span class="id" title="variable">start</span></a> <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <a class="idref" href="#length:18"><span class="id" title="variable">length</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#query_bound:19"><span class="id" title="variable">query_bound</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#diff:21"><span class="id" title="variable">diff</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#growth"><span class="id" title="definition">growth</span></a> <a class="idref" href="#current_bound:20"><span class="id" title="variable">current_bound</span></a> <a class="idref" href="#query_bound:19"><span class="id" title="variable">query_bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#span_induced_growth:15"><span class="id" title="inductive">span_induced_growth</span></a> (<a class="idref" href="#mk_span"><span class="id" title="constructor">mk_span</span></a> <a class="idref" href="#start:17"><span class="id" title="variable">start</span></a> <a class="idref" href="#length:18"><span class="id" title="variable">length</span></a>) <a class="idref" href="#current_bound:20"><span class="id" title="variable">current_bound</span></a> <a class="idref" href="#diff:21"><span class="id" title="variable">diff</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="PointerDefinitions.HeapPointer" class="idref" href="#PointerDefinitions.HeapPointer"><span class="id" title="section">HeapPointer</span></a>.<br/>
</div>

<div class="doc"><h1 id="heap-pointer">Heap pointer</h1>
<p>A <strong>heap pointer</strong> is an absolute address <span
class="inlinecode"><a class="idref" href="#hp_addr"><span
class="id" title="projection">hp_addr</span></a></span> on some data
page. Heap pointers are used in instructions:</p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#OpLoad"><span
class="id" title="constructor">OpLoad</span></a></span>/<span
class="inlinecode"><a class="idref" href="#OpLoadInc"><span
class="id" title="constructor">OpLoadInc</span></a></span></li>
<li><span
class="inlinecode"><a class="idref" href="#OpStore"><span
class="id" title="constructor">OpStore</span></a></span>/<span
class="inlinecode"><a class="idref" href="#OpStoreInc"><span
class="id" title="constructor">OpStoreInc</span></a></span></li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="heap_ptr" class="idref" href="#heap_ptr"><span class="id" title="record">heap_ptr</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mk_hptr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="hp_addr" class="idref" href="#hp_addr"><span class="id" title="projection">hp_addr</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="heap_ptr_empty" class="idref" href="#heap_ptr_empty"><span class="id" title="definition">heap_ptr_empty</span></a> : <a class="idref" href="#heap_ptr"><span class="id" title="record">heap_ptr</span></a> := <a class="idref" href="#mk_hptr"><span class="id" title="constructor">mk_hptr</span></a> <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="hp_resolves_to" class="idref" href="#hp_resolves_to"><span class="id" title="inductive">hp_resolves_to</span></a> : <a class="idref" href="#heap_ptr"><span class="id" title="record">heap_ptr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="tpr_apply" class="idref" href="#tpr_apply"><span class="id" title="constructor">tpr_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="addr:26" class="idref" href="#addr:26"><span class="id" title="binder">addr</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#hp_resolves_to:24"><span class="id" title="inductive">hp_resolves_to</span></a> (<a class="idref" href="#mk_hptr"><span class="id" title="constructor">mk_hptr</span></a> <a class="idref" href="#addr:26"><span class="id" title="variable">addr</span></a>) <a class="idref" href="#addr:26"><span class="id" title="variable">addr</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>Incrementing a heap pointer with <span
class="inlinecode"><a class="idref" href="#hp_inc"><span
class="id" title="inductive">hp_inc</span></a></span> increases its
offset by 32, the size of a word in bytes. This is used by instructions
<span
class="inlinecode"><a class="idref" href="#OpLoadInc"><span
class="id" title="constructor">OpLoadInc</span></a></span> and <span
class="inlinecode"><a class="idref" href="#OpStoreInc"><span
class="id" title="constructor">OpStoreInc</span></a></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="hp_inc" class="idref" href="#hp_inc"><span class="id" title="inductive">hp_inc</span></a> : <a class="idref" href="#heap_ptr"><span class="id" title="record">heap_ptr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#heap_ptr"><span class="id" title="record">heap_ptr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<a id="fpi_apply" class="idref" href="#fpi_apply"><span class="id" title="constructor">fpi_apply</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="ofs:29" class="idref" href="#ofs:29"><span class="id" title="binder">ofs</span></a> <a id="ofs':30" class="idref" href="#ofs':30"><span class="id" title="binder">ofs'</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ofs:29"><span class="id" title="variable">ofs</span></a> <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <a class="idref" href="#PointerDefinitions.bytes_in_word"><span class="id" title="variable">bytes_in_word</span></a>  <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#ofs':30"><span class="id" title="variable">ofs'</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#hp_inc:27"><span class="id" title="inductive">hp_inc</span></a> (<a class="idref" href="#mk_hptr"><span class="id" title="constructor">mk_hptr</span></a> <a class="idref" href="#ofs:29"><span class="id" title="variable">ofs</span></a>) (<a class="idref" href="#mk_hptr"><span class="id" title="constructor">mk_hptr</span></a> <a class="idref" href="#ofs':30"><span class="id" title="variable">ofs'</span></a> ).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="hp_inc_OF" class="idref" href="#hp_inc_OF"><span class="id" title="definition">hp_inc_OF</span></a> (<a id="hp:31" class="idref" href="#hp:31"><span class="id" title="binder">hp</span></a>: <a class="idref" href="#heap_ptr"><span class="id" title="record">heap_ptr</span></a>) : <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#heap_ptr"><span class="id" title="record">heap_ptr</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#hp:31"><span class="id" title="variable">hp</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_hptr"><span class="id" title="constructor">mk_hptr</span></a> <span class="id" title="var">ofs</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">ofs</span> <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <a class="idref" href="#PointerDefinitions.bytes_in_word"><span class="id" title="variable">bytes_in_word</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">ofs'</span><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#mk_hptr"><span class="id" title="constructor">mk_hptr</span></a> <span class="id" title="var">ofs'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <a class="idref" href="#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc"><h2 id="usage">Usage</h2>
<p>Heap pointers are used by the following instructions:</p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#OpLoad"><span
class="id" title="constructor">OpLoad</span></a></span>/<span
class="inlinecode"><a class="idref" href="#OpLoadInc"><span
class="id" title="constructor">OpLoadInc</span></a></span></li>
<li><span
class="inlinecode"><a class="idref" href="#OpStore"><span
class="id" title="constructor">OpStore</span></a></span>/<span
class="inlinecode"><a class="idref" href="#OpStoreInc"><span
class="id" title="constructor">OpStoreInc</span></a></span></li>
</ul>
<p>The layout of a heap pointer in a 256-bit word is described by <span
class="inlinecode"><a class="idref" href="#decode_heap_ptr"><span
class="id" title="definition">decode_heap_ptr</span></a></span>.</p>
<h2 id="relation-to-fat-pointers">Relation to fat pointers</h2>
<p>Heap pointers are bearing a similarity to fat pointers. They can be
thought about as fat pointers where:</p>
<ul>
<li>the span starts at 0;</li>
<li>an offset is the address;</li>
<li>length is the limit, and</li>
<li>page ID is ignored.</li>
</ul>
<p>Heap pointers are not necessarily tagged and do not receive any
special treatment from the VM’s side.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="#PointerDefinitions.HeapPointer"><span class="id" title="section">HeapPointer</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>Definition <span
class="inlinecode"><a class="idref" href="#free_ptr"><span
class="id" title="record">free_ptr</span></a></span> is auxiliary and is
only used to facilitate the definition of <span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="free_ptr" class="idref" href="#free_ptr"><span class="id" title="record">free_ptr</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mk_ptr</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="p_span" class="idref" href="#p_span"><span class="id" title="projection">p_span</span></a> :> <a class="idref" href="#span"><span class="id" title="record">span</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="p_offset" class="idref" href="#p_offset"><span class="id" title="projection">p_offset</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="fresh_ptr" class="idref" href="#fresh_ptr"><span class="id" title="definition">fresh_ptr</span></a> (<a id="s:36" class="idref" href="#s:36"><span class="id" title="binder">s</span></a>:<a class="idref" href="#span"><span class="id" title="record">span</span></a>) : <a class="idref" href="#free_ptr"><span class="id" title="record">free_ptr</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> <a class="idref" href="#s:36"><span class="id" title="variable">s</span></a> <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="validate_in_bounds" class="idref" href="#validate_in_bounds"><span class="id" title="definition">validate_in_bounds</span></a> (<a id="p:37" class="idref" href="#p:37"><span class="id" title="binder">p</span></a>:<a class="idref" href="#free_ptr"><span class="id" title="record">free_ptr</span></a>) : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> :=  <a class="idref" href="#p:37"><span class="id" title="variable">p</span></a>.(<a class="idref" href="#p_offset"><span class="id" title="projection">p_offset</span></a>) <a class="idref" href="#::ZMod_scope:x_'<'_x"><span class="id" title="notation"><</span></a> <a class="idref" href="#p:37"><span class="id" title="variable">p</span></a>.(<a class="idref" href="#s_length"><span class="id" title="projection">s_length</span></a>) .<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="ptr_resolves_to" class="idref" href="#ptr_resolves_to"><span class="id" title="inductive">ptr_resolves_to</span></a> : <a class="idref" href="#free_ptr"><span class="id" title="record">free_ptr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="upr_apply" class="idref" href="#upr_apply"><span class="id" title="constructor">upr_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="addr:40" class="idref" href="#addr:40"><span class="id" title="binder">addr</span></a> <a id="start:41" class="idref" href="#start:41"><span class="id" title="binder">start</span></a> <a id="ofs:42" class="idref" href="#ofs:42"><span class="id" title="binder">ofs</span></a> <a id="length:43" class="idref" href="#length:43"><span class="id" title="binder">length</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="#ofs:42"><span class="id" title="variable">ofs</span></a> <a class="idref" href="#::ZMod_scope:x_'<'_x"><span class="id" title="notation"><</span></a> <a class="idref" href="#length:43"><span class="id" title="variable">length</span></a><a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>  <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#addr:40"><span class="id" title="variable">addr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#start:41"><span class="id" title="variable">start</span></a> <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <a class="idref" href="#ofs:42"><span class="id" title="variable">ofs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ptr_resolves_to:38"><span class="id" title="inductive">ptr_resolves_to</span></a> (<a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> (<a class="idref" href="#mk_span"><span class="id" title="constructor">mk_span</span></a> <a class="idref" href="#start:41"><span class="id" title="variable">start</span></a> <a class="idref" href="#length:43"><span class="id" title="variable">length</span></a>) <a class="idref" href="#ofs:42"><span class="id" title="variable">ofs</span></a>) <a class="idref" href="#addr:40"><span class="id" title="variable">addr</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="word_upper_bound" class="idref" href="#word_upper_bound"><span class="id" title="inductive">word_upper_bound</span></a> : <a class="idref" href="#heap_ptr"><span class="id" title="record">heap_ptr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="qbu_apply" class="idref" href="#qbu_apply"><span class="id" title="constructor">qbu_apply</span></a> : <span class="id" title="keyword">∀</span> <a id="start:46" class="idref" href="#start:46"><span class="id" title="binder">start</span></a> <a id="upper_bound:47" class="idref" href="#upper_bound:47"><span class="id" title="binder">upper_bound</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="bytes_in_word:48" class="idref" href="#bytes_in_word:48"><span class="id" title="binder">bytes_in_word</span></a> := <span class="id" title="definition">fromNat</span> <a class="idref" href="#bytes_in_word"><span class="id" title="definition">Core.bytes_in_word</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#start:46"><span class="id" title="variable">start</span></a> <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <a class="idref" href="#bytes_in_word:48"><span class="id" title="variable">bytes_in_word</span></a>  <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#upper_bound:47"><span class="id" title="variable">upper_bound</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#word_upper_bound:44"><span class="id" title="inductive">word_upper_bound</span></a> (<a class="idref" href="#mk_hptr"><span class="id" title="constructor">mk_hptr</span></a> <a class="idref" href="#start:46"><span class="id" title="variable">start</span></a>) <a class="idref" href="#upper_bound:47"><span class="id" title="variable">upper_bound</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="PointerDefinitions.FatPointer" class="idref" href="#PointerDefinitions.FatPointer"><span class="id" title="section">FatPointer</span></a>.<br/>
</div>

<div class="doc"><h1 id="fat-pointer">Fat pointer</h1>
<p>A <strong>fat pointer</strong> defines an address inside a <span
class="inlinecode"><a class="idref" href="#span"><span
class="id" title="record">span</span></a></span> of a specific data
memory page <span
class="inlinecode"><a class="idref" href="#fp_page"><span
class="id" title="projection">fp_page</span></a></span>. We may denote
is as a 4-tuple: <span class="math inline">(\mathit{page, start, length,
offset})</span>. These four components are enough to unambiguously
identify a <strong><span class="inlinecode"><span class="id"
title="var">slice</span></span></strong> of a data memory page.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="fat_ptr" class="idref" href="#fat_ptr"><span class="id" title="record">fat_ptr</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mk_fat_ptr</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="fp_page" class="idref" href="#fp_page"><span class="id" title="projection">fp_page</span></a>: <a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="fp_ptr" class="idref" href="#fp_ptr"><span class="id" title="projection">fp_ptr</span></a> :> <a class="idref" href="#free_ptr"><span class="id" title="record">free_ptr</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
</div>

<div class="doc"><h2 id="usage">Usage</h2>
<ul>
<li><p>Fat pointers are used to pass read-only spans of <span
class="inlinecode"><a class="idref" href="#data_page"><span
class="id" title="definition">data_page</span></a></span>s between
contracts.</p></li>
<li><p>Fat pointers are created from spans by <span
class="inlinecode"><a class="idref" href="#OpFarCall"><span
class="id" title="constructor">OpFarCall</span></a></span>/<span
class="inlinecode"><a class="idref" href="#OpMimicCall"><span
class="id" title="constructor">OpMimicCall</span></a></span>/<span
class="inlinecode"><a class="idref" href="#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span> or
through <span
class="inlinecode"><a class="idref" href="#OpRet"><span
class="id" title="constructor">OpRet</span></a></span>/<span
class="inlinecode"><a class="idref" href="#OpRevert"><span
class="id" title="constructor">OpRevert</span></a></span>.</p>
<ul>
<li>Far calls accept a serialized instance of <span
class="inlinecode"><span class="id"
title="var">FarCall.params</span></span> in a register. If it contains a
span in <span
class="inlinecode"><a class="idref" href="#fwd_memory"><span
class="id" title="inductive">fwd_memory</span></a></span>, then when the
contract starts executing, <span
class="inlinecode"><a class="idref" href="#r1"><span
class="id" title="projection">r1</span></a></span> is assigned the fat
pointer obtained from the slice.</li>
<li>Far returns accept a serialized instance of <span
class="inlinecode"><span class="id"
title="var">FarRet.fwd_memory</span></span> in a register. If it
contains a span in <span
class="inlinecode"><a class="idref" href="#fwd_memory"><span
class="id" title="inductive">fwd_memory</span></a></span>, then after
return <span
class="inlinecode"><a class="idref" href="#r1"><span
class="id" title="projection">r1</span></a></span> is assigned the fat
pointer obtained from the slice.</li>
</ul></li>
<li><p>An existing fat pointer is passed by using <span
class="inlinecode"><a class="idref" href="#FarCallForwardPageType.ForwardFatPointer"><span
class="id"
title="definition">ForwardFatPointer</span></a></span>.</p></li>
</ul>
<p>Pointers may be created only by far calls (<span
class="inlinecode"><a class="idref" href="#OpFarCall"><span
class="id" title="constructor">OpFarCall</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpMimicCall"><span
class="id" title="constructor">OpMimicCall</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span>) or far
returns (<span
class="inlinecode"><a class="idref" href="#OpRet"><span
class="id" title="constructor">OpRet</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpRevert"><span
class="id" title="constructor">OpRevert</span></a></span>).</p>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="validation_exception" class="idref" href="#validation_exception"><span class="id" title="record">validation_exception</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mk_ptr_validation_exception</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ptr_deref_beyond_heap_range" class="idref" href="#ptr_deref_beyond_heap_range"><span class="id" title="projection">ptr_deref_beyond_heap_range</span></a> : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ptr_bad_span" class="idref" href="#ptr_bad_span"><span class="id" title="projection">ptr_bad_span</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="no_exceptions" class="idref" href="#no_exceptions"><span class="id" title="definition">no_exceptions</span></a> : <a class="idref" href="#validation_exception"><span class="id" title="record">validation_exception</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <a class="idref" href="#mk_ptr_validation_exception"><span class="id" title="constructor">mk_ptr_validation_exception</span></a> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="fat_ptr_nullable" class="idref" href="#fat_ptr_nullable"><span class="id" title="inductive">fat_ptr_nullable</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="NullPtr" class="idref" href="#NullPtr"><span class="id" title="constructor">NullPtr</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="NotNullPtr" class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> (<a id="ptr:66" class="idref" href="#ptr:66"><span class="id" title="binder">ptr</span></a>: <a class="idref" href="#fat_ptr"><span class="id" title="record">fat_ptr</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>

<br/>
</div>

<div class="doc"><p>A fat pointer <span class="math inline">(\mathit{page},
\mathit{start}, \mathit{length}, \mathit{offset})</span> is
<strong>invalid</strong> if:</p>
<ul>
<li><span
class="math inline">\mathit{start}_{\mathbb{N}}+\mathit{length}_{\mathbb{N}}
\geq 2^{32}</span>, or</li>
<li><span class="math inline">\mathit{offset} &gt;
\mathit{length}</span>.</li>
</ul>
<p>By a subscript <span class="math inline">\mathbb{N}</span> we denote
that we explicitly interpret <span
class="math inline">\mathit{start}</span> and <span
class="math inline">\mathit{length}</span> as natural numbers, and
addition on natural numbers does not overflow.</p>
<p>If <span class="math inline">\mathit{offset} =
\mathit{length}</span>, the span of the pointer is empty, but it is
still valid.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <span class="id" title="module">ssrbool</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="validate" class="idref" href="#validate"><span class="id" title="definition">validate</span></a> (<a id="p:67" class="idref" href="#p:67"><span class="id" title="binder">p</span></a>:<a class="idref" href="#free_ptr"><span class="id" title="record">free_ptr</span></a>) : <a class="idref" href="#validation_exception"><span class="id" title="record">validation_exception</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#p:67"><span class="id" title="variable">p</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> (<a class="idref" href="#mk_span"><span class="id" title="constructor">mk_span</span></a> <span class="id" title="var">start</span> <span class="id" title="var">len</span>) <span class="id" title="var">ofs</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ptr_deref_beyond_heap_range"><span class="id" title="projection">ptr_deref_beyond_heap_range</span></a> := <a class="idref" href="#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">start</span> <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <span class="id" title="var">len</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ptr_bad_span"><span class="id" title="projection">ptr_bad_span</span></a> := <span class="id" title="var">ofs</span> <a class="idref" href="#::ZMod_scope:x_'>'_x"><span class="id" title="notation">></span></a> <span class="id" title="var">len</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="is_trivial" class="idref" href="#is_trivial"><span class="id" title="definition">is_trivial</span></a> (<a id="p:69" class="idref" href="#p:69"><span class="id" title="binder">p</span></a>:<a class="idref" href="#free_ptr"><span class="id" title="record">free_ptr</span></a>) := <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><a class="idref" href="#p:69"><span class="id" title="variable">p</span></a>.(<a class="idref" href="#s_length"><span class="id" title="projection">s_length</span></a>) <span class="id" title="notation">==</span> <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a><a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><a class="idref" href="#p:69"><span class="id" title="variable">p</span></a>.(<a class="idref" href="#p_offset"><span class="id" title="projection">p_offset</span></a>) <span class="id" title="notation">==</span> <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a><a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc"><p><strong>Narrowing a fat pointer</strong> moves its <span
class="math inline">\mathit{start}</span> to where <span
class="math inline">\mathit{start} + \mathit{offset}</span> was, and
sets <span class="math inline">\mathit{offset}</span> to zero:</p>
<p><span class="math inline">(\mathit{page}, \mathit{start},
\mathit{length}, \mathit{offset}) \mapsto (\mathit{page},
\mathit{start}+\mathit{offset}, \mathit{length}-\mathit{offset},
0)</span></p>
<p><img src="img/ptr-narrowing.svg" /></p>
<p>A fat pointer is automatically narrowed in two situations:</p>
<ul>
<li>by far calls with forwarding mode <span
class="inlinecode"><a class="idref" href="#FarCallForwardPageType.ForwardFatPointer"><span
class="id" title="definition">ForwardFatPointer</span></a></span>;</li>
<li>by returns from far calls with forwarding mode <span
class="inlinecode"><a class="idref" href="#FarCallForwardPageType.ForwardFatPointer"><span
class="id" title="definition">ForwardFatPointer</span></a></span>.</li>
</ul>
<p><strong>Attention</strong>: <strong>shrinking</strong> and
<strong>narrowing</strong> far pointers are different. See <span
class="inlinecode"><a class="idref" href="#fat_ptr_shrink"><span
class="id" title="definition">fat_ptr_shrink</span></a></span> and <span
class="inlinecode"><a class="idref" href="#fat_ptr_narrow"><span
class="id" title="definition">fat_ptr_narrow</span></a></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="free_ptr_narrow" class="idref" href="#free_ptr_narrow"><span class="id" title="inductive">free_ptr_narrow</span></a>: <a class="idref" href="#free_ptr"><span class="id" title="record">free_ptr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#free_ptr"><span class="id" title="record">free_ptr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="tps_narrow" class="idref" href="#tps_narrow"><span class="id" title="constructor">tps_narrow</span></a>: <span class="id" title="keyword">∀</span> <a id="start:72" class="idref" href="#start:72"><span class="id" title="binder">start</span></a> <a id="start':73" class="idref" href="#start':73"><span class="id" title="binder">start'</span></a> <a id="length:74" class="idref" href="#length:74"><span class="id" title="binder">length</span></a> <a id="length':75" class="idref" href="#length':75"><span class="id" title="binder">length'</span></a> <a id="ofs:76" class="idref" href="#ofs:76"><span class="id" title="binder">ofs</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#validate"><span class="id" title="definition">validate</span></a> (<a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> (<a class="idref" href="#mk_span"><span class="id" title="constructor">mk_span</span></a> <a class="idref" href="#start:72"><span class="id" title="variable">start</span></a> <a class="idref" href="#length:74"><span class="id" title="variable">length</span></a>) <a class="idref" href="#ofs:76"><span class="id" title="variable">ofs</span></a>) <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#no_exceptions"><span class="id" title="definition">no_exceptions</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#start:72"><span class="id" title="variable">start</span></a> <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <a class="idref" href="#ofs:76"><span class="id" title="variable">ofs</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#start':73"><span class="id" title="variable">start'</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#length:74"><span class="id" title="variable">length</span></a> <a class="idref" href="#::ZMod_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="#ofs:76"><span class="id" title="variable">ofs</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#length':75"><span class="id" title="variable">length'</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#free_ptr_narrow:70"><span class="id" title="inductive">free_ptr_narrow</span></a> (<a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> (<a class="idref" href="#mk_span"><span class="id" title="constructor">mk_span</span></a> <a class="idref" href="#start:72"><span class="id" title="variable">start</span></a> <a class="idref" href="#length:74"><span class="id" title="variable">length</span></a>) <a class="idref" href="#ofs:76"><span class="id" title="variable">ofs</span></a>) (<a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> (<a class="idref" href="#mk_span"><span class="id" title="constructor">mk_span</span></a> <a class="idref" href="#start':73"><span class="id" title="variable">start'</span></a> <a class="idref" href="#length':75"><span class="id" title="variable">length'</span></a>) <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="fat_ptr_narrow" class="idref" href="#fat_ptr_narrow"><span class="id" title="definition">fat_ptr_narrow</span></a> := <a class="idref" href="#fat_ptr_liftP"><span class="id" title="inductive">fat_ptr_liftP</span></a> <a class="idref" href="#free_ptr_narrow"><span class="id" title="inductive">free_ptr_narrow</span></a>.<br/>

<br/>
</div>

<div class="doc"><p><strong>Shrinking a fat pointer</strong> with <span
class="inlinecode"><a class="idref" href="#fat_ptr_shrink"><span
class="id" title="definition">fat_ptr_shrink</span></a></span> subtracts
a given number <span class="inlinecode"><span class="id"
title="var">diff</span></span> from its length; it is guaranteed to not
overflow.</p>
<p>Shrinking may result in a pointer with <span
class="math inline">\mathit{offset}&gt;\mathit{length}</span>, but such
pointer will not resolve to a memory location.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="free_ptr_shrink" class="idref" href="#free_ptr_shrink"><span class="id" title="inductive">free_ptr_shrink</span></a> (<a id="diff:77" class="idref" href="#diff:77"><span class="id" title="binder">diff</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>) : <a class="idref" href="#free_ptr"><span class="id" title="record">free_ptr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#free_ptr"><span class="id" title="record">free_ptr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="tptl_apply" class="idref" href="#tptl_apply"><span class="id" title="constructor">tptl_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="start:80" class="idref" href="#start:80"><span class="id" title="binder">start</span></a> <a id="ofs:81" class="idref" href="#ofs:81"><span class="id" title="binder">ofs</span></a> <a id="length:82" class="idref" href="#length:82"><span class="id" title="binder">length</span></a> <a id="length':83" class="idref" href="#length':83"><span class="id" title="binder">length'</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#length:82"><span class="id" title="variable">length</span></a> <a class="idref" href="#::ZMod_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="#diff:77"><span class="id" title="variable">diff</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#length':83"><span class="id" title="variable">length'</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#free_ptr_shrink:78"><span class="id" title="inductive">free_ptr_shrink</span></a> <a class="idref" href="#diff:77"><span class="id" title="variable">diff</span></a> (<a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> (<a class="idref" href="#mk_span"><span class="id" title="constructor">mk_span</span></a> <a class="idref" href="#start:80"><span class="id" title="variable">start</span></a> <a class="idref" href="#length:82"><span class="id" title="variable">length</span></a>) <a class="idref" href="#ofs:81"><span class="id" title="variable">ofs</span></a>) (<a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> (<a class="idref" href="#mk_span"><span class="id" title="constructor">mk_span</span></a> <a class="idref" href="#start:80"><span class="id" title="variable">start</span></a> <a class="idref" href="#length':83"><span class="id" title="variable">length'</span></a>) <a class="idref" href="#ofs:81"><span class="id" title="variable">ofs</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="free_ptr_shrink_OF" class="idref" href="#free_ptr_shrink_OF"><span class="id" title="definition">free_ptr_shrink_OF</span></a> (<a id="diff:84" class="idref" href="#diff:84"><span class="id" title="binder">diff</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>) : <a class="idref" href="#free_ptr"><span class="id" title="record">free_ptr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#free_ptr"><span class="id" title="record">free_ptr</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="fp:85" class="idref" href="#fp:85"><span class="id" title="binder">fp</span></a> ⇒ <span class="id" title="keyword">match</span> <a class="idref" href="#fp:85"><span class="id" title="variable">fp</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> (<a class="idref" href="#mk_span"><span class="id" title="constructor">mk_span</span></a> <span class="id" title="var">start</span> <a class="idref" href="#length"><span class="id" title="definition">length</span></a>) <a class="idref" href="#p_offset"><span class="id" title="projection">p_offset</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">length</span> <a class="idref" href="#::ZMod_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="#diff:84"><span class="id" title="variable">diff</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">length'</span><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> (<a class="idref" href="#mk_span"><span class="id" title="constructor">mk_span</span></a> <span class="id" title="var">start</span> <span class="id" title="var">length'</span>) <span class="id" title="var">p_offset</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <a class="idref" href="#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="fat_ptr_shrink" class="idref" href="#fat_ptr_shrink"><span class="id" title="definition">fat_ptr_shrink</span></a> <a id="diff:87" class="idref" href="#diff:87"><span class="id" title="binder">diff</span></a> := <a class="idref" href="#fat_ptr_liftP"><span class="id" title="inductive">fat_ptr_liftP</span></a> (<a class="idref" href="#free_ptr_shrink"><span class="id" title="inductive">free_ptr_shrink</span></a> <a class="idref" href="#diff:87"><span class="id" title="variable">diff</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="fat_ptr_shrink_OF" class="idref" href="#fat_ptr_shrink_OF"><span class="id" title="definition">fat_ptr_shrink_OF</span></a> <a id="diff:88" class="idref" href="#diff:88"><span class="id" title="binder">diff</span></a> := <a class="idref" href="#fat_ptr_opt_map"><span class="id" title="definition">fat_ptr_opt_map</span></a> (<a class="idref" href="#free_ptr_shrink_OF"><span class="id" title="definition">free_ptr_shrink_OF</span></a> <a class="idref" href="#diff:88"><span class="id" title="variable">diff</span></a>).<br/>
</div>

<div class="doc"><p>Incrementing a fat pointer with <span class="inlinecode"><span
class="id" title="var">fp_inc</span></span> increases its offset by 32,
the size of a word in bytes. This is used by the instruction <span
class="inlinecode"><a class="idref" href="#OpLoadPointerInc"><span
class="id" title="constructor">OpLoadPointerInc</span></a></span>.</p>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="ptr_inc_OF" class="idref" href="#ptr_inc_OF"><span class="id" title="definition">ptr_inc_OF</span></a> (<a id="p:89" class="idref" href="#p:89"><span class="id" title="binder">p</span></a>: <a class="idref" href="#free_ptr"><span class="id" title="record">free_ptr</span></a>) : <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#free_ptr"><span class="id" title="record">free_ptr</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#p:89"><span class="id" title="variable">p</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> <span class="id" title="var">s</span> <span class="id" title="var">ofs</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">ofs</span> <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <a class="idref" href="#PointerDefinitions.bytes_in_word"><span class="id" title="variable">bytes_in_word</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">ofs'</span><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> <span class="id" title="var">s</span> <span class="id" title="var">ofs'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <a class="idref" href="#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="ptr_inc" class="idref" href="#ptr_inc"><span class="id" title="inductive">ptr_inc</span></a> : <a class="idref" href="#free_ptr"><span class="id" title="record">free_ptr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#free_ptr"><span class="id" title="record">free_ptr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<a id="fpf_apply" class="idref" href="#fpf_apply"><span class="id" title="constructor">fpf_apply</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="ofs:93" class="idref" href="#ofs:93"><span class="id" title="binder">ofs</span></a> <a id="ofs':94" class="idref" href="#ofs':94"><span class="id" title="binder">ofs'</span></a> <a id="s:95" class="idref" href="#s:95"><span class="id" title="binder">s</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ofs:93"><span class="id" title="variable">ofs</span></a> <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <a class="idref" href="#PointerDefinitions.bytes_in_word"><span class="id" title="variable">bytes_in_word</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#ofs':94"><span class="id" title="variable">ofs'</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ptr_inc:91"><span class="id" title="inductive">ptr_inc</span></a> (<a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> <a class="idref" href="#s:95"><span class="id" title="variable">s</span></a> <a class="idref" href="#ofs:93"><span class="id" title="variable">ofs</span></a>) (<a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> <a class="idref" href="#s:95"><span class="id" title="variable">s</span></a> <a class="idref" href="#ofs':94"><span class="id" title="variable">ofs'</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="fat_ptr_inc" class="idref" href="#fat_ptr_inc"><span class="id" title="definition">fat_ptr_inc</span></a> := <a class="idref" href="#fat_ptr_liftP"><span class="id" title="inductive">fat_ptr_liftP</span></a> <a class="idref" href="#ptr_inc"><span class="id" title="inductive">ptr_inc</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="fat_ptr_inc_OF" class="idref" href="#fat_ptr_inc_OF"><span class="id" title="definition">fat_ptr_inc_OF</span></a> := <a class="idref" href="#fat_ptr_opt_map"><span class="id" title="definition">fat_ptr_opt_map</span></a> <a class="idref" href="#ptr_inc_OF"><span class="id" title="definition">ptr_inc_OF</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="#PointerDefinitions.FatPointer"><span class="id" title="section">FatPointer</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#PointerDefinitions"><span class="id" title="section">PointerDefinitions</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.Slice</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Pointer</span></a> <a class="idref" href="#"><span class="id" title="library">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="library">lib.PMap_ext</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Slices" class="idref" href="#Slices"><span class="id" title="section">Slices</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Bool</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryBase</span></a> <span class="id" title="module">RecordSetNotations</span> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">PMap_ext</span></a>.<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
</div>

<div class="doc"><h1 id="slice">Slice</h1>
<p>Data slice is a virtual memory page holding a read-only fragment of a
<span
class="inlinecode"><a class="idref" href="#data_page"><span
class="id" title="definition">data_page</span></a></span>.</p>
<p>Accesses through a fat pointer should be in bounds of its span.
However, loads by fat pointer return words, not individual bytes, so it
is important to cut off parts of the memory page outside the pointer’s
span.</p>
<p>For example, suppose <span class="math inline">P</span> is a fat
pointer <span class="math inline">(page, 0, 33, 10)</span>. Reading
32-byte <span
class="inlinecode"><a class="idref" href="#word"><span
class="id" title="definition">word</span></a></span> yields bytes from
the offset 10-th to 42-th (excluded). However, the span of <span
class="math inline">P</span> is <span class="math inline">[0,33)</span>
so the bytes from 33-th to 42-th are outside of this span. EraVM treats
the bytes outside <span class="math inline">P</span>’s span as if they
were zeros.</p>
<p>More generally, suppose <span class="math inline">P:=(\mathit{page,
start, length, offset})</span> is a fat pointer. Accesses through <span
class="inlinecode"><a class="idref" href="#OpLoadPtr"><span
class="id" title="constructor">OpLoadPtr</span></a></span> and <span
class="inlinecode"><span class="id"
title="var">OpLoadPtrInc</span></span> return 32-byte words starting at
an address <span class="math inline">\mathit{start + offset}</span>.</p>
<p>However, a 32-byte <span
class="inlinecode"><a class="idref" href="#word"><span
class="id" title="definition">word</span></a></span> spans across
addresses in range <span class="math inline">[\mathit{start + offset,
start + offset + 32})</span> and therefore can surpass the upper bound
<span class="math inline">\mathit{start + length})</span> if <span
class="math inline">\mathit{length-offset} \leq 32</span>.</p>
<p>Reading past <span class="math inline">\mathit{start+offset}</span>
yields zero bytes. In other words, attempting to read a word that spans
across the pointer bound <span class="math inline">\mathit{start +
offset}</span> will return zero bytes for the addresses <span
class="math inline">[\mathit{start+length, start+offset+32})</span>.</p>
</div>
<div class="code">
<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="data_page_slice_params" class="idref" href="#data_page_slice_params"><span class="id" title="definition">data_page_slice_params</span></a> := <a class="idref" href="#data_page_params"><span class="id" title="definition">data_page_params</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#writable"><span class="id" title="projection">writable</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a> <span class="id" title="notation">|></span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="data_slice" class="idref" href="#data_slice"><span class="id" title="definition">data_slice</span></a> := <a class="idref" href="#mem_parameterized"><span class="id" title="record">mem_parameterized</span></a> <a class="idref" href="#data_page_slice_params"><span class="id" title="definition">data_page_slice_params</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="do_slice_page" class="idref" href="#do_slice_page"><span class="id" title="definition">do_slice_page</span></a> (<a id="from_incl:1" class="idref" href="#from_incl:1"><span class="id" title="binder">from_incl</span></a> <a id="to_excl:2" class="idref" href="#to_excl:2"><span class="id" title="binder">to_excl</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>) (<a id="m:3" class="idref" href="#m:3"><span class="id" title="binder">m</span></a>:<a class="idref" href="#data_page"><span class="id" title="definition">data_page</span></a>) : <a class="idref" href="#data_slice"><span class="id" title="definition">data_slice</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="from_key:4" class="idref" href="#from_key:4"><span class="id" title="binder">from_key</span></a> := <a class="idref" href="#addr_to_key"><span class="id" title="definition">MemoryBase.addr_to_key</span></a> <span class="id" title="var">_</span> <a class="idref" href="#from_incl:1"><span class="id" title="variable">from_incl</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="to_key:5" class="idref" href="#to_key:5"><span class="id" title="binder">to_key</span></a> := <a class="idref" href="#addr_to_key"><span class="id" title="definition">MemoryBase.addr_to_key</span></a> <span class="id" title="var">_</span> <a class="idref" href="#to_excl:2"><span class="id" title="variable">to_excl</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="contents:6" class="idref" href="#contents:6"><span class="id" title="binder">contents</span></a> := <a class="idref" href="#pmap_slice"><span class="id" title="definition">pmap_slice</span></a> <a class="idref" href="#m:3"><span class="id" title="variable">m</span></a> <a class="idref" href="#from_key:4"><span class="id" title="variable">from_key</span></a> <a class="idref" href="#to_key:5"><span class="id" title="variable">to_key</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="#mk_mem"><span class="id" title="constructor">mk_mem</span></a> <a class="idref" href="#data_page_slice_params"><span class="id" title="definition">data_page_slice_params</span></a> <a class="idref" href="#contents:6"><span class="id" title="variable">contents</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>Predicate <span
class="inlinecode"><a class="idref" href="#slice_page"><span
class="id" title="inductive">slice_page</span></a></span> describes a
slice visible to a fat pointer.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Inductive</span> <a id="slice_page" class="idref" href="#slice_page"><span class="id" title="inductive">slice_page</span></a> (<a id="m:7" class="idref" href="#m:7"><span class="id" title="binder">m</span></a>:<a class="idref" href="#data_page"><span class="id" title="definition">data_page</span></a>) : <a class="idref" href="#span"><span class="id" title="record">span</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#data_slice"><span class="id" title="definition">data_slice</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
| <a id="sfp_apply" class="idref" href="#sfp_apply"><span class="id" title="constructor">sfp_apply</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="start:10" class="idref" href="#start:10"><span class="id" title="binder">start</span></a> <a id="length:11" class="idref" href="#length:11"><span class="id" title="binder">length</span></a> <a id="upper_bound:12" class="idref" href="#upper_bound:12"><span class="id" title="binder">upper_bound</span></a> <a id="readonly_slice:13" class="idref" href="#readonly_slice:13"><span class="id" title="binder">readonly_slice</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#start:10"><span class="id" title="variable">start</span></a> <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <a class="idref" href="#length:11"><span class="id" title="variable">length</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#upper_bound:12"><span class="id" title="variable">upper_bound</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#do_slice_page"><span class="id" title="definition">do_slice_page</span></a> <a class="idref" href="#start:10"><span class="id" title="variable">start</span></a> <a class="idref" href="#upper_bound:12"><span class="id" title="variable">upper_bound</span></a>  <a class="idref" href="#m:7"><span class="id" title="variable">m</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#readonly_slice:13"><span class="id" title="variable">readonly_slice</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#slice_page:8"><span class="id" title="inductive">slice_page</span></a> <a class="idref" href="#m:7"><span class="id" title="variable">m</span></a> (<a class="idref" href="#mk_span"><span class="id" title="constructor">mk_span</span></a> <a class="idref" href="#start:10"><span class="id" title="variable">start</span></a> <a class="idref" href="#length:11"><span class="id" title="variable">length</span></a>) <a class="idref" href="#readonly_slice:13"><span class="id" title="variable">readonly_slice</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Slices"><span class="id" title="section">Slices</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.CallStack</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">RecordSetNotations</span>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Common</span></a> <a class="idref" href="#"><span class="id" title="library">Ergs</span></a> <a class="idref" href="#"><span class="id" title="library">KernelMode</span></a> <a class="idref" href="#"><span class="id" title="library">memory.Depot</span></a> <a class="idref" href="#"><span class="id" title="library">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="library">MemoryContext</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Ergs</span></a> <a class="idref" href="#"><span class="id" title="module">KernelMode</span></a> <a class="idref" href="#"><span class="id" title="module">memory.Depot</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryContext</span></a> <a class="idref" href="#"><span class="id" title="module">List</span></a> <a class="idref" href="#ListNotations"><span class="id" title="module">ListNotations</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Callstack" class="idref" href="#Callstack"><span class="id" title="section">Callstack</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="CALLSTACK_LIMIT:1" class="idref" href="#CALLSTACK_LIMIT:1"><span class="id" title="binder">CALLSTACK_LIMIT</span></a> : <a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="state_checkpoint:2" class="idref" href="#state_checkpoint:2"><span class="id" title="binder">state_checkpoint</span></a>: <span class="id" title="keyword">Type</span>} {<a id="ins:3" class="idref" href="#ins:3"><span class="id" title="binder">ins</span></a>: <span class="id" title="keyword">Type</span>} (<a id="ins_invalid:4" class="idref" href="#ins_invalid:4"><span class="id" title="binder">ins_invalid</span></a>: <a class="idref" href="#ins:3"><span class="id" title="variable">ins</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="exception_handler" class="idref" href="#exception_handler"><span class="id" title="definition">exception_handler</span></a> := <a class="idref" href="#code_address"><span class="id" title="definition">code_address</span></a>.<br/>

<br/>
</div>

<div class="doc"><h1 id="call-stack">Call stack</h1>
<p>EraVM operates with two stacks:</p>
<ol type="1">
<li>call stack, which supports function and contract execution</li>
<li>data stack, aiding in computations.</li>
</ol>
<p>Data stack has a role similar to the stack in JVM and other language
virtual machines. Call stack may be implemented in any way, but it is
separated from data stack. This section covers the call stack in
detail.</p>
<p>A <strong>stack frame</strong>, or <strong>call frame</strong>, is a
data structure representing a fragment of current execution environment
associated with a running instance of a contract or a function.</p>
<p>There are two types of stack frames:</p>
<ul>
<li>External frames <span
class="inlinecode"><a class="idref" href="#ExternalCall"><span
class="id" title="constructor">ExternalCall</span></a></span>: created
on far calls (by instructions <span
class="inlinecode"><a class="idref" href="#OpFarCall"><span
class="id" title="constructor">OpFarCall</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpMimicCall"><span
class="id" title="constructor">OpMimicCall</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span>).</li>
<li>Internal frames <span
class="inlinecode"><a class="idref" href="#InternalCall"><span
class="id" title="constructor">InternalCall</span></a></span>: created
by near calls (by instruction <span
class="inlinecode"><a class="idref" href="#OpNearCall"><span
class="id" title="constructor">OpNearCall</span></a></span>).</li>
</ul>
<p>Each external frame is <strong>associated</strong> with a contract
address. It means that it was created when the associated contract
address was far called. Naturally, each contract may be called many
times recursively, therefore at each moment of time any contract may
have multiple external frames associated to it.</p>
<p><strong><span
class="inlinecode"><a class="idref" href="#callstack"><span
class="id" title="inductive">callstack</span></a></span></strong> is a
stack of a maximum of <span class="inlinecode"><span class="id"
title="var">CALLSTACK_LIMIT</span></span> stack frames. It is unrelated
to the <span
class="inlinecode"><a class="idref" href="#stack_page"><span
class="id" title="definition">stack_page</span></a></span> which holds
data stack.</p>
<p>There is one callstack per execution, stored in <span
class="inlinecode"><a class="idref" href="#state"><span
class="id" title="record">state</span></a></span> in <span
class="inlinecode"><a class="idref" href="#gs_callstack"><span
class="id" title="projection">gs_callstack</span></a></span> field.</p>
<p>Internal call frames hold the following information:</p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#cf_exception_handler_location"><span
class="id"
title="projection">cf_exception_handler_location</span></a></span>: a
<span
class="inlinecode"><a class="idref" href="#code_address"><span
class="id" title="definition">code_address</span></a></span> of an
exception handler. On revert or panic VM destroys the topmost frame and
jumps to this handler.</li>
<li><span
class="inlinecode"><a class="idref" href="#cf_sp"><span
class="id" title="projection">cf_sp</span></a></span>: current
<strong>data stack</strong> pointer. The topmost element in data stack
is located at <span
class="inlinecode"><a class="idref" href="#cf_sp"><span
class="id" title="projection">cf_sp</span></a>-1</span> in the currently
<span
class="inlinecode"><a class="idref" href="#active_stackpage"><span
class="id" title="inductive">active_stackpage</span></a></span>.</li>
<li><span
class="inlinecode"><a class="idref" href="#cf_ergs_remaining"><span
class="id" title="projection">cf_ergs_remaining</span></a></span>: ergs
allocated for the current function or contract. It decreases as VM
spends ergs for its operation.</li>
<li><span
class="inlinecode"><a class="idref" href="#cf_saved_checkpoint"><span
class="id" title="projection">cf_saved_checkpoint</span></a></span> : a
snapshot of the state for a rollback. In case of panic or revert, the
state of storage and event queues will be restored.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="callstack_common" class="idref" href="#callstack_common"><span class="id" title="record">callstack_common</span></a> := <span class="id" title="var">mk_cf</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="cf_exception_handler_location" class="idref" href="#cf_exception_handler_location"><span class="id" title="projection">cf_exception_handler_location</span></a>: <a class="idref" href="#exception_handler"><span class="id" title="definition">exception_handler</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="cf_sp" class="idref" href="#cf_sp"><span class="id" title="projection">cf_sp</span></a>: <a class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="cf_pc" class="idref" href="#cf_pc"><span class="id" title="projection">cf_pc</span></a>: <a class="idref" href="#code_address"><span class="id" title="definition">code_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="cf_ergs_remaining" class="idref" href="#cf_ergs_remaining"><span class="id" title="projection">cf_ergs_remaining</span></a>: <a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="cf_saved_checkpoint" class="idref" href="#cf_saved_checkpoint"><span class="id" title="projection">cf_saved_checkpoint</span></a>: <a class="idref" href="#Callstack.state_checkpoint"><span class="id" title="variable">state_checkpoint</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
</div>

<div class="doc"><p>External call frames hold the same information as internal.
Additionally, they hold:</p>
<ul>
<li><p>Three associated contract addresses:</p>
<ol type="1">
<li><span
class="inlinecode"><a class="idref" href="#ecf_this_address"><span
class="id" title="projection">ecf_this_address</span></a></span> : the
stack frame was created when this contract was called.</li>
<li><span
class="inlinecode"><a class="idref" href="#ecf_msg_sender"><span
class="id" title="projection">ecf_msg_sender</span></a></span> : the
stack frame was created when this contract invoked one of far call
instructions.</li>
<li><span
class="inlinecode"><a class="idref" href="#ecf_code_address"><span
class="id" title="projection">ecf_code_address</span></a></span> : which
contract owns the code associated with the stack frame. It is not always
the same contract as <span
class="inlinecode"><a class="idref" href="#ecf_this_address"><span
class="id" title="projection">ecf_this_address</span></a></span>.</li>
</ol></li>
<li><p><span
class="inlinecode"><a class="idref" href="#ecf_mem_ctx"><span
class="id" title="projection">ecf_mem_ctx</span></a></span> : current
<span
class="inlinecode"><a class="idref" href="#mem_ctx"><span
class="id" title="record">mem_ctx</span></a></span> holding ids of
active stack, heap variants, code, const pages and bounds of data
pages.</p></li>
<li><p>boolean <span
class="inlinecode"><a class="idref" href="#ecf_is_static"><span
class="id" title="projection">ecf_is_static</span></a></span> : true if
the code associated with this frame is being executed in static
mode.</p></li>
<li><p><span
class="inlinecode"><a class="idref" href="#ecf_context_u128_value"><span
class="id" title="projection">ecf_context_u128_value</span></a></span> :
captured value of <span
class="inlinecode"><a class="idref" href="#gs_context_u128"><span
class="id" title="projection">gs_context_u128</span></a></span>. It
represents a snapshot of the value of global register <span
class="inlinecode"><a class="idref" href="#gs_context_u128"><span
class="id" title="projection">gs_context_u128</span></a></span> in a
moment of far call to the current contract.</p></li>
<li><p><span
class="inlinecode"><a class="idref" href="#ecf_shards"><span
class="id" title="projection">ecf_shards</span></a></span> : shards
associated with <span
class="inlinecode"><a class="idref" href="#ecf_this_address"><span
class="id" title="projection">ecf_this_address</span></a></span>, <span
class="inlinecode"><a class="idref" href="#ecf_msg_sender"><span
class="id" title="projection">ecf_msg_sender</span></a></span> and <span
class="inlinecode"><a class="idref" href="#ecf_code_address"><span
class="id"
title="projection">ecf_code_address</span></a></span>.</p></li>
</ul>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="active_shards" class="idref" href="#active_shards"><span class="id" title="record">active_shards</span></a> := <span class="id" title="var">mk_shards</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="shard_this" class="idref" href="#shard_this"><span class="id" title="projection">shard_this</span></a>: <a class="idref" href="#shard_id"><span class="id" title="definition">shard_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="shard_caller" class="idref" href="#shard_caller"><span class="id" title="projection">shard_caller</span></a>: <a class="idref" href="#shard_id"><span class="id" title="definition">shard_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="shard_code" class="idref" href="#shard_code"><span class="id" title="projection">shard_code</span></a>: <a class="idref" href="#shard_id"><span class="id" title="definition">shard_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="associated_contracts" class="idref" href="#associated_contracts"><span class="id" title="record">associated_contracts</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mk_assoc_contracts</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ecf_this_address" class="idref" href="#ecf_this_address"><span class="id" title="projection">ecf_this_address</span></a>: <a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ecf_msg_sender" class="idref" href="#ecf_msg_sender"><span class="id" title="projection">ecf_msg_sender</span></a>: <a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ecf_code_address" class="idref" href="#ecf_code_address"><span class="id" title="projection">ecf_code_address</span></a>: <a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="callstack_external" class="idref" href="#callstack_external"><span class="id" title="record">callstack_external</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mk_extcf</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ecf_associated" class="idref" href="#ecf_associated"><span class="id" title="projection">ecf_associated</span></a>:> <a class="idref" href="#associated_contracts"><span class="id" title="record">associated_contracts</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ecf_mem_ctx" class="idref" href="#ecf_mem_ctx"><span class="id" title="projection">ecf_mem_ctx</span></a>: <a class="idref" href="#mem_ctx"><span class="id" title="record">mem_ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ecf_is_static" class="idref" href="#ecf_is_static"><span class="id" title="projection">ecf_is_static</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>; <span class="comment">(*&nbsp;forbids&nbsp;any&nbsp;write-like&nbsp;"log"&nbsp;and&nbsp;so&nbsp;state&nbsp;modifications,&nbsp;event&nbsp;emissions,&nbsp;etc&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ecf_context_u128_value" class="idref" href="#ecf_context_u128_value"><span class="id" title="projection">ecf_context_u128_value</span></a>: <a class="idref" href="#u128"><span class="id" title="definition">u128</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ecf_shards" class="idref" href="#ecf_shards"><span class="id" title="projection">ecf_shards</span></a>:> <a class="idref" href="#active_shards"><span class="id" title="record">active_shards</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ecf_common" class="idref" href="#ecf_common"><span class="id" title="projection">ecf_common</span></a> :> <a class="idref" href="#callstack_common"><span class="id" title="record">callstack_common</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="callstack" class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> :=<br/>
&nbsp;&nbsp;| <a id="InternalCall" class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> (<span class="id" title="var">_</span>: <a class="idref" href="#callstack_common"><span class="id" title="record">callstack_common</span></a>) (<a id="tail:28" class="idref" href="#tail:28"><span class="id" title="binder">tail</span></a>: <a class="idref" href="#callstack:26"><span class="id" title="inductive">callstack</span></a>): <a class="idref" href="#callstack:26"><span class="id" title="inductive">callstack</span></a><br/>
&nbsp;&nbsp;| <a id="ExternalCall" class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> (<span class="id" title="var">_</span>: <a class="idref" href="#callstack_external"><span class="id" title="record">callstack_external</span></a>) (<a id="tail:29" class="idref" href="#tail:29"><span class="id" title="binder">tail</span></a>: <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#callstack:26"><span class="id" title="inductive">callstack</span></a>): <a class="idref" href="#callstack:26"><span class="id" title="inductive">callstack</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <a id="callstack_depth" class="idref" href="#callstack_depth"><span class="id" title="definition">callstack_depth</span></a> <a id="cf:30" class="idref" href="#cf:30"><span class="id" title="binder">cf</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">match</span> <a class="idref" href="#cf:30"><span class="id" title="variable">cf</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ 1 <span class="id" title="notation">+</span> <a class="idref" href="#callstack_depth:31"><span class="id" title="definition">callstack_depth</span></a> <span class="id" title="var">tail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <span class="id" title="var">x</span> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#tail"><span class="id" title="abbreviation">tail</span></a>)=> 1 <span class="id" title="notation">+</span> <a class="idref" href="#callstack_depth:31"><span class="id" title="definition">callstack_depth</span></a> <span class="id" title="var">tail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> ⇒ 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>)%<span class="id" title="var">nat</span>.<br/>

<br/>
</div>

<div class="doc"><h2 id="operation">Operation</h2>
<p>When the server starts forming a new block, it starts a new instance
of VM to execute the code called <span
class="inlinecode"><a class="idref" href="#Bootloader"><span
class="id" title="section">Bootloader</span></a></span>. Bootloader is a
contract with an address <span
class="inlinecode"><a class="idref" href="#BOOTLOADER_SYSTEM_CONTRACT_ADDRESS"><span
class="id"
title="definition">BOOTLOADER_SYSTEM_CONTRACT_ADDRESS</span></a></span>.
To support its execution, a corresponding <span
class="inlinecode"><a class="idref" href="#ExternalCall"><span
class="id" title="constructor">ExternalCall</span></a></span> frame with
is pushed to the call stack.</p>
<p>Handling each transaction requires executing <span
class="inlinecode"><a class="idref" href="#OpFarCall"><span
class="id" title="constructor">OpFarCall</span></a></span>, which pushes
another call frame to the callstack.</p>
<p>As the transaction is executed, call stack changes as follows:</p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#OpNearCall"><span
class="id" title="constructor">OpNearCall</span></a></span> pushes an
<span
class="inlinecode"><a class="idref" href="#InternalCall"><span
class="id" title="constructor">InternalCall</span></a></span> frame to
callstack.</li>
<li><span
class="inlinecode"><a class="idref" href="#OpFarCall"><span
class="id" title="constructor">OpFarCall</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span>, or
<span
class="inlinecode"><a class="idref" href="#OpMimicCall"><span
class="id" title="constructor">OpMimicCall</span></a></span> push an
<span
class="inlinecode"><a class="idref" href="#ExternalCall"><span
class="id" title="constructor">ExternalCall</span></a></span> frame to
callstack.</li>
<li><span
class="inlinecode"><a class="idref" href="#OpNearRetTo"><span
class="id" title="constructor">OpNearRetTo</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpRevert"><span
class="id" title="constructor">OpRevert</span></a></span>, <span
class="inlinecode"><span class="id"
title="var">OpRevertTo</span></span>, <span
class="inlinecode"><a class="idref" href="#OpPanic"><span
class="id" title="constructor">OpPanic</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpRet"><span
class="id" title="constructor">OpRet</span></a></span> pop a frame from
callstack.</li>
</ul>
<p>Attempting to have more than <span class="inlinecode"><span
class="id" title="var">CALLSTACK_LIMIT</span></span> elements in
callstack will force the VM into panic.</p>
<p>Panics are equivalent to executing <span
class="inlinecode"><a class="idref" href="#OpPanic"><span
class="id" title="constructor">OpPanic</span></a></span>, so they pop up
the topmost stack frame and pass the control to the exception handler,
specified in the popped frame.</p>
<p>Executing any instruction <span class="math inline">I</span> changes
the topmost frame:</p>
<ol type="1">
<li><span
class="inlinecode"><a class="idref" href="#cf_pc"><span
class="id" title="projection">cf_pc</span></a></span> is incremented,
unless <span class="math inline">I</span> is <span
class="inlinecode"><a class="idref" href="#OpJump"><span
class="id" title="constructor">OpJump</span></a></span> .</li>
<li><span
class="inlinecode"><a class="idref" href="#cf_sp"><span
class="id" title="projection">cf_sp</span></a></span> may be modified if
<span class="math inline">I</span> affects the data stack pointer
through addressing modes <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span> or <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span>.</li>
<li><span
class="inlinecode"><a class="idref" href="#cf_ergs_remaining"><span
class="id" title="projection">cf_ergs_remaining</span></a></span> is
decreased by the <strong>total cost</strong> of <span
class="math inline">I</span>. Total cost is a sum of <span
class="inlinecode"><a class="idref" href="#base_cost"><span
class="id" title="definition">base_cost</span></a></span> and additional
costs, described by the small step predicates like <span
class="inlinecode"><a class="idref" href="#step_jump"><span
class="id" title="inductive">step_jump</span></a></span>.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="stack_overflow" class="idref" href="#stack_overflow"><span class="id" title="definition">stack_overflow</span></a> (<a id="xstack:33" class="idref" href="#xstack:33"><span class="id" title="binder">xstack</span></a>:<a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ltb"><span class="id" title="definition">Nat.ltb</span></a> <a class="idref" href="#Callstack.CALLSTACK_LIMIT"><span class="id" title="variable">CALLSTACK_LIMIT</span></a> (<a class="idref" href="#callstack_depth"><span class="id" title="definition">callstack_depth</span></a> <a class="idref" href="#xstack:33"><span class="id" title="variable">xstack</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="cfc" class="idref" href="#cfc"><span class="id" title="definition">cfc</span></a> (<a id="ef:34" class="idref" href="#ef:34"><span class="id" title="binder">ef</span></a>: <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="#callstack_common"><span class="id" title="record">callstack_common</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#ef:34"><span class="id" title="variable">ef</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <span class="id" title="var">x</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <span class="id" title="var">x</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="cfc_map" class="idref" href="#cfc_map"><span class="id" title="definition">cfc_map</span></a> (<a id="f:36" class="idref" href="#f:36"><span class="id" title="binder">f</span></a>:<a class="idref" href="#callstack_common"><span class="id" title="record">callstack_common</span></a><a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><a class="idref" href="#callstack_common"><span class="id" title="record">callstack_common</span></a>) (<a id="ef:37" class="idref" href="#ef:37"><span class="id" title="binder">ef</span></a>: <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#ef:37"><span class="id" title="variable">ef</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> (<a class="idref" href="#f:36"><span class="id" title="variable">f</span></a> <span class="id" title="var">x</span>) <span class="id" title="var">tail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> (<span class="id" title="var">x</span> <span class="id" title="notation"><|</span> <a class="idref" href="#ecf_common"><span class="id" title="projection">ecf_common</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="#f:36"><span class="id" title="variable">f</span></a> <span class="id" title="notation">|></span>) <span class="id" title="var">tail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Callstack.ErgsManagement" class="idref" href="#Callstack.ErgsManagement"><span class="id" title="section">ErgsManagement</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="ergs_remaining" class="idref" href="#ergs_remaining"><span class="id" title="definition">ergs_remaining</span></a> (<a id="ef:39" class="idref" href="#ef:39"><span class="id" title="binder">ef</span></a>:<a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a> := (<a class="idref" href="#cfc"><span class="id" title="definition">cfc</span></a> <a class="idref" href="#ef:39"><span class="id" title="variable">ef</span></a>).(<a class="idref" href="#cf_ergs_remaining"><span class="id" title="projection">cf_ergs_remaining</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="ergs_map" class="idref" href="#ergs_map"><span class="id" title="definition">ergs_map</span></a> (<a id="f:40" class="idref" href="#f:40"><span class="id" title="binder">f</span></a>: <a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a><a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a>) (<a id="ef:41" class="idref" href="#ef:41"><span class="id" title="binder">ef</span></a>:<a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <a class="idref" href="#cfc_map"><span class="id" title="definition">cfc_map</span></a> (<span class="id" title="keyword">fun</span> <a id="x:42" class="idref" href="#x:42"><span class="id" title="binder">x</span></a> ⇒ <a class="idref" href="#x:42"><span class="id" title="variable">x</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#cf_ergs_remaining"><span class="id" title="projection">cf_ergs_remaining</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="#f:40"><span class="id" title="variable">f</span></a> <span class="id" title="notation">|></span>) <a class="idref" href="#ef:41"><span class="id" title="variable">ef</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="ergs_set" class="idref" href="#ergs_set"><span class="id" title="definition">ergs_set</span></a> <a id="newergs:43" class="idref" href="#newergs:43"><span class="id" title="binder">newergs</span></a> := <a class="idref" href="#ergs_map"><span class="id" title="definition">ergs_map</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#newergs:43"><span class="id" title="variable">newergs</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="ergs_return" class="idref" href="#ergs_return"><span class="id" title="inductive">ergs_return</span></a>: <a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="er_return" class="idref" href="#er_return"><span class="id" title="constructor">er_return</span></a>: <span class="id" title="keyword">∀</span> <a id="delta:46" class="idref" href="#delta:46"><span class="id" title="binder">delta</span></a> <a id="new_ergs:47" class="idref" href="#new_ergs:47"><span class="id" title="binder">new_ergs</span></a> <a id="ef:48" class="idref" href="#ef:48"><span class="id" title="binder">ef</span></a> <a id="ef':49" class="idref" href="#ef':49"><span class="id" title="binder">ef'</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#delta:46"><span class="id" title="variable">delta</span></a> <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <a class="idref" href="#ergs_remaining"><span class="id" title="definition">ergs_remaining</span></a> <a class="idref" href="#ef:48"><span class="id" title="variable">ef</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#new_ergs:47"><span class="id" title="variable">new_ergs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ef':49"><span class="id" title="variable">ef'</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ergs_set"><span class="id" title="definition">ergs_set</span></a> <a class="idref" href="#new_ergs:47"><span class="id" title="variable">new_ergs</span></a> <a class="idref" href="#ef:48"><span class="id" title="variable">ef</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_return:44"><span class="id" title="inductive">ergs_return</span></a> <a class="idref" href="#delta:46"><span class="id" title="variable">delta</span></a> <a class="idref" href="#ef:48"><span class="id" title="variable">ef</span></a> <a class="idref" href="#ef':49"><span class="id" title="variable">ef'</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="ergs_return_caller_and_drop" class="idref" href="#ergs_return_caller_and_drop"><span class="id" title="inductive">ergs_return_caller_and_drop</span></a> : <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<a id="erc_internal" class="idref" href="#erc_internal"><span class="id" title="constructor">erc_internal</span></a>: <span class="id" title="keyword">∀</span> <a id="caller:52" class="idref" href="#caller:52"><span class="id" title="binder">caller</span></a> <a id="new_caller:53" class="idref" href="#new_caller:53"><span class="id" title="binder">new_caller</span></a> <a id="cf:54" class="idref" href="#cf:54"><span class="id" title="binder">cf</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_return"><span class="id" title="inductive">ergs_return</span></a> (<a class="idref" href="#ergs_remaining"><span class="id" title="definition">ergs_remaining</span></a> (<a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="#cf:54"><span class="id" title="variable">cf</span></a> <a class="idref" href="#caller:52"><span class="id" title="variable">caller</span></a>)) <a class="idref" href="#caller:52"><span class="id" title="variable">caller</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_caller:53"><span class="id" title="variable">new_caller</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_return_caller_and_drop:50"><span class="id" title="inductive">ergs_return_caller_and_drop</span></a> (<a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="#cf:54"><span class="id" title="variable">cf</span></a> <a class="idref" href="#caller:52"><span class="id" title="variable">caller</span></a>) <a class="idref" href="#new_caller:53"><span class="id" title="variable">new_caller</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<a id="erc_external" class="idref" href="#erc_external"><span class="id" title="constructor">erc_external</span></a>: <span class="id" title="keyword">∀</span> <a id="caller:55" class="idref" href="#caller:55"><span class="id" title="binder">caller</span></a> <a id="new_caller:56" class="idref" href="#new_caller:56"><span class="id" title="binder">new_caller</span></a> <a id="cf:57" class="idref" href="#cf:57"><span class="id" title="binder">cf</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_return"><span class="id" title="inductive">ergs_return</span></a> (<a class="idref" href="#ergs_remaining"><span class="id" title="definition">ergs_remaining</span></a> (<a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="#cf:57"><span class="id" title="variable">cf</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#caller:55"><span class="id" title="variable">caller</span></a>))) <a class="idref" href="#caller:55"><span class="id" title="variable">caller</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_caller:56"><span class="id" title="variable">new_caller</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_return_caller_and_drop:50"><span class="id" title="inductive">ergs_return_caller_and_drop</span></a> (<a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="#cf:57"><span class="id" title="variable">cf</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#caller:55"><span class="id" title="variable">caller</span></a>)) <a class="idref" href="#new_caller:56"><span class="id" title="variable">new_caller</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="ergs_reset" class="idref" href="#ergs_reset"><span class="id" title="definition">ergs_reset</span></a> := <a class="idref" href="#ergs_set"><span class="id" title="definition">ergs_set</span></a> <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="affordable" class="idref" href="#affordable"><span class="id" title="definition">affordable</span></a> (<a id="ef:58" class="idref" href="#ef:58"><span class="id" title="binder">ef</span></a>: <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a>) (<a id="e:59" class="idref" href="#e:59"><span class="id" title="binder">e</span></a>:<a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a>): <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#ergs_remaining"><span class="id" title="definition">ergs_remaining</span></a> <a class="idref" href="#ef:58"><span class="id" title="variable">ef</span></a> <a class="idref" href="#::ZMod_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="#e:59"><span class="id" title="variable">e</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">paid</span><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> ⇒ <a class="idref" href="#true"><span class="id" title="constructor">true</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#true"><span class="id" title="constructor">true</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">overflowed</span><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> ⇒ <a class="idref" href="#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="pay" class="idref" href="#pay"><span class="id" title="inductive">pay</span></a> : <a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="pay_ergs" class="idref" href="#pay_ergs"><span class="id" title="constructor">pay_ergs</span></a> : <span class="id" title="keyword">∀</span> <a id="e:62" class="idref" href="#e:62"><span class="id" title="binder">e</span></a> <a id="ef:63" class="idref" href="#ef:63"><span class="id" title="binder">ef</span></a> <a id="paid:64" class="idref" href="#paid:64"><span class="id" title="binder">paid</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_remaining"><span class="id" title="definition">ergs_remaining</span></a> <a class="idref" href="#ef:63"><span class="id" title="variable">ef</span></a> <a class="idref" href="#::ZMod_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="#e:62"><span class="id" title="variable">e</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#paid:64"><span class="id" title="variable">paid</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pay:60"><span class="id" title="inductive">pay</span></a> <a class="idref" href="#e:62"><span class="id" title="variable">e</span></a> <a class="idref" href="#ef:63"><span class="id" title="variable">ef</span></a> (<a class="idref" href="#ergs_set"><span class="id" title="definition">ergs_set</span></a> <a class="idref" href="#paid:64"><span class="id" title="variable">paid</span></a> <a class="idref" href="#ef:63"><span class="id" title="variable">ef</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="#Callstack.ErgsManagement"><span class="id" title="section">ErgsManagement</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Callstack.SP" class="idref" href="#Callstack.SP"><span class="id" title="section">SP</span></a>.<br/>
</div>

<div class="doc"><p>Fetching value of the stack pointer itself.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="sp_get" class="idref" href="#sp_get"><span class="id" title="definition">sp_get</span></a> (<a id="cf:65" class="idref" href="#cf:65"><span class="id" title="binder">cf</span></a>: <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#cfc"><span class="id" title="definition">cfc</span></a> <a class="idref" href="#cf:65"><span class="id" title="variable">cf</span></a>).(<a class="idref" href="#cf_sp"><span class="id" title="projection">cf_sp</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="sp_map_extcall" class="idref" href="#sp_map_extcall"><span class="id" title="definition">sp_map_extcall</span></a> (<a id="f:66" class="idref" href="#f:66"><span class="id" title="binder">f</span></a>:<a class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a><a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><a class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a>) <a id="ef:67" class="idref" href="#ef:67"><span class="id" title="binder">ef</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#ef:67"><span class="id" title="variable">ef</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#ecf_common"><span class="id" title="projection">ecf_common</span></a> <span class="id" title="notation">::=</span> <span class="id" title="keyword">fun</span> <a id="cf:68" class="idref" href="#cf:68"><span class="id" title="binder">cf</span></a> ⇒ <a class="idref" href="#cf:68"><span class="id" title="variable">cf</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#cf_sp"><span class="id" title="projection">cf_sp</span></a> <span class="id" title="notation">::=</span>  <a class="idref" href="#f:66"><span class="id" title="variable">f</span></a> <span class="id" title="notation">|></span> <span class="id" title="notation">|></span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="sp_map_extcall_spec" class="idref" href="#sp_map_extcall_spec"><span class="id" title="inductive">sp_map_extcall_spec</span></a> <a id="f:69" class="idref" href="#f:69"><span class="id" title="binder">f</span></a>: <a class="idref" href="#callstack_external"><span class="id" title="record">callstack_external</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#callstack_external"><span class="id" title="record">callstack_external</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="sme_apply" class="idref" href="#sme_apply"><span class="id" title="constructor">sme_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="a:72" class="idref" href="#a:72"><span class="id" title="binder">a</span></a> <a id="d:73" class="idref" href="#d:73"><span class="id" title="binder">d</span></a> <a id="e:74" class="idref" href="#e:74"><span class="id" title="binder">e</span></a> <a id="g:75" class="idref" href="#g:75"><span class="id" title="binder">g</span></a> <a id="h:76" class="idref" href="#h:76"><span class="id" title="binder">h</span></a> <a id="eh:77" class="idref" href="#eh:77"><span class="id" title="binder">eh</span></a> <a id="sp:78" class="idref" href="#sp:78"><span class="id" title="binder">sp</span></a> <a id="pc:79" class="idref" href="#pc:79"><span class="id" title="binder">pc</span></a> <a id="ss:80" class="idref" href="#ss:80"><span class="id" title="binder">ss</span></a> <a id="ergs:81" class="idref" href="#ergs:81"><span class="id" title="binder">ergs</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#sp_map_extcall_spec:70"><span class="id" title="inductive">sp_map_extcall_spec</span></a> <a class="idref" href="#f:69"><span class="id" title="variable">f</span></a> (<a class="idref" href="#mk_extcf"><span class="id" title="constructor">mk_extcf</span></a> <a class="idref" href="#a:72"><span class="id" title="variable">a</span></a> <a class="idref" href="#d:73"><span class="id" title="variable">d</span></a> <a class="idref" href="#e:74"><span class="id" title="variable">e</span></a> <a class="idref" href="#g:75"><span class="id" title="variable">g</span></a> <a class="idref" href="#h:76"><span class="id" title="variable">h</span></a> (<a class="idref" href="#mk_cf"><span class="id" title="constructor">mk_cf</span></a> <a class="idref" href="#eh:77"><span class="id" title="variable">eh</span></a> <a class="idref" href="#sp:78"><span class="id" title="variable">sp</span></a> <a class="idref" href="#pc:79"><span class="id" title="variable">pc</span></a> <a class="idref" href="#ergs:81"><span class="id" title="variable">ergs</span></a> <a class="idref" href="#ss:80"><span class="id" title="variable">ss</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#mk_extcf"><span class="id" title="constructor">mk_extcf</span></a> <a class="idref" href="#a:72"><span class="id" title="variable">a</span></a> <a class="idref" href="#d:73"><span class="id" title="variable">d</span></a> <a class="idref" href="#e:74"><span class="id" title="variable">e</span></a> <a class="idref" href="#g:75"><span class="id" title="variable">g</span></a> <a class="idref" href="#h:76"><span class="id" title="variable">h</span></a> (<a class="idref" href="#mk_cf"><span class="id" title="constructor">mk_cf</span></a> <a class="idref" href="#eh:77"><span class="id" title="variable">eh</span></a> (<a class="idref" href="#f:69"><span class="id" title="variable">f</span></a> <a class="idref" href="#sp:78"><span class="id" title="variable">sp</span></a>) <a class="idref" href="#pc:79"><span class="id" title="variable">pc</span></a> <a class="idref" href="#ergs:81"><span class="id" title="variable">ergs</span></a> <a class="idref" href="#ss:80"><span class="id" title="variable">ss</span></a>)).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="sp_map_extcall_correct" class="idref" href="#sp_map_extcall_correct"><span class="id" title="lemma">sp_map_extcall_correct</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="f:82" class="idref" href="#f:82"><span class="id" title="binder">f</span></a> <a id="ef:83" class="idref" href="#ef:83"><span class="id" title="binder">ef</span></a>, <a class="idref" href="#sp_map_extcall_spec"><span class="id" title="inductive">sp_map_extcall_spec</span></a> <a class="idref" href="#f:82"><span class="id" title="variable">f</span></a> <a class="idref" href="#ef:83"><span class="id" title="variable">ef</span></a> (<a class="idref" href="#sp_map_extcall"><span class="id" title="definition">sp_map_extcall</span></a> <a class="idref" href="#f:82"><span class="id" title="variable">f</span></a> <a class="idref" href="#ef:83"><span class="id" title="variable">ef</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="sp_map" class="idref" href="#sp_map"><span class="id" title="definition">sp_map</span></a> (<a id="f:84" class="idref" href="#f:84"><span class="id" title="binder">f</span></a>:<a class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a><a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><a class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a>) <a id="ef:85" class="idref" href="#ef:85"><span class="id" title="binder">ef</span></a> : <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#ef:85"><span class="id" title="variable">ef</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> (<span class="id" title="var">x</span> <span class="id" title="notation"><|</span> <a class="idref" href="#cf_sp"><span class="id" title="projection">cf_sp</span></a> <span class="id" title="notation">::=</span>  <a class="idref" href="#f:84"><span class="id" title="variable">f</span></a> <span class="id" title="notation">|></span>) <span class="id" title="var">tail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> (<a class="idref" href="#sp_map_extcall"><span class="id" title="definition">sp_map_extcall</span></a> <a class="idref" href="#f:84"><span class="id" title="variable">f</span></a> <span class="id" title="var">x</span>) <span class="id" title="var">tail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="sp_update" class="idref" href="#sp_update"><span class="id" title="definition">sp_update</span></a> <a id="new_sp:87" class="idref" href="#new_sp:87"><span class="id" title="binder">new_sp</span></a> := <a class="idref" href="#sp_map"><span class="id" title="definition">sp_map</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#new_sp:87"><span class="id" title="variable">new_sp</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="sp_map_spec" class="idref" href="#sp_map_spec"><span class="id" title="inductive">sp_map_spec</span></a> <a id="f:88" class="idref" href="#f:88"><span class="id" title="binder">f</span></a> : <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="usp_ext" class="idref" href="#usp_ext"><span class="id" title="constructor">usp_ext</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="ecf:91" class="idref" href="#ecf:91"><span class="id" title="binder">ecf</span></a> <a id="ecf':92" class="idref" href="#ecf':92"><span class="id" title="binder">ecf'</span></a> <a id="tail:93" class="idref" href="#tail:93"><span class="id" title="binder">tail</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#sp_map_extcall_spec"><span class="id" title="inductive">sp_map_extcall_spec</span></a> <a class="idref" href="#f:88"><span class="id" title="variable">f</span></a> <a class="idref" href="#ecf:91"><span class="id" title="variable">ecf</span></a> <a class="idref" href="#ecf':92"><span class="id" title="variable">ecf'</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#sp_map_spec:89"><span class="id" title="inductive">sp_map_spec</span></a> <a class="idref" href="#f:88"><span class="id" title="variable">f</span></a> (<a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="#ecf:91"><span class="id" title="variable">ecf</span></a> <a class="idref" href="#tail:93"><span class="id" title="variable">tail</span></a>) (<a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="#ecf':92"><span class="id" title="variable">ecf'</span></a> <a class="idref" href="#tail:93"><span class="id" title="variable">tail</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="usp_int" class="idref" href="#usp_int"><span class="id" title="constructor">usp_int</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span>  <a id="eh:94" class="idref" href="#eh:94"><span class="id" title="binder">eh</span></a> <a id="sp:95" class="idref" href="#sp:95"><span class="id" title="binder">sp</span></a> <a id="pc:96" class="idref" href="#pc:96"><span class="id" title="binder">pc</span></a> <a id="ergs:97" class="idref" href="#ergs:97"><span class="id" title="binder">ergs</span></a> <a id="tail:98" class="idref" href="#tail:98"><span class="id" title="binder">tail</span></a> <a id="ss:99" class="idref" href="#ss:99"><span class="id" title="binder">ss</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#sp_map_spec:89"><span class="id" title="inductive">sp_map_spec</span></a> <a class="idref" href="#f:88"><span class="id" title="variable">f</span></a> (<a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> (<a class="idref" href="#mk_cf"><span class="id" title="constructor">mk_cf</span></a> <a class="idref" href="#eh:94"><span class="id" title="variable">eh</span></a> <a class="idref" href="#sp:95"><span class="id" title="variable">sp</span></a> <a class="idref" href="#pc:96"><span class="id" title="variable">pc</span></a> <a class="idref" href="#ergs:97"><span class="id" title="variable">ergs</span></a> <a class="idref" href="#ss:99"><span class="id" title="variable">ss</span></a> ) <a class="idref" href="#tail:98"><span class="id" title="variable">tail</span></a>) (<a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> (<a class="idref" href="#mk_cf"><span class="id" title="constructor">mk_cf</span></a> <a class="idref" href="#eh:94"><span class="id" title="variable">eh</span></a> (<a class="idref" href="#f:88"><span class="id" title="variable">f</span></a> <a class="idref" href="#sp:95"><span class="id" title="variable">sp</span></a>) <a class="idref" href="#pc:96"><span class="id" title="variable">pc</span></a> <a class="idref" href="#ergs:97"><span class="id" title="variable">ergs</span></a> <a class="idref" href="#ss:99"><span class="id" title="variable">ss</span></a>) <a class="idref" href="#tail:98"><span class="id" title="variable">tail</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="sp_map_spec_correct" class="idref" href="#sp_map_spec_correct"><span class="id" title="lemma">sp_map_spec_correct</span></a> <a id="f:100" class="idref" href="#f:100"><span class="id" title="binder">f</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="ef:101" class="idref" href="#ef:101"><span class="id" title="binder">ef</span></a>, <a class="idref" href="#sp_map_spec"><span class="id" title="inductive">sp_map_spec</span></a> <a class="idref" href="#f:100"><span class="id" title="variable">f</span></a> <a class="idref" href="#ef:101"><span class="id" title="variable">ef</span></a> (<a class="idref" href="#sp_map"><span class="id" title="definition">sp_map</span></a> <a class="idref" href="#f:100"><span class="id" title="variable">f</span></a> <a class="idref" href="#ef:101"><span class="id" title="variable">ef</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="#Callstack.SP"><span class="id" title="section">SP</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Callstack.PC" class="idref" href="#Callstack.PC"><span class="id" title="section">PC</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="pc_get" class="idref" href="#pc_get"><span class="id" title="definition">pc_get</span></a> (<a id="ef:102" class="idref" href="#ef:102"><span class="id" title="binder">ef</span></a>: <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="#code_address"><span class="id" title="definition">code_address</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#ef:102"><span class="id" title="variable">ef</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <span class="id" title="var">cf</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">cf</span>.(<a class="idref" href="#cf_pc"><span class="id" title="projection">cf_pc</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <span class="id" title="var">ef</span> <a class="idref" href="#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <a class="idref" href="#ef:102"><span class="id" title="variable">ef</span></a>.(<a class="idref" href="#ecf_common"><span class="id" title="projection">ecf_common</span></a>).(<a class="idref" href="#cf_pc"><span class="id" title="projection">cf_pc</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="pc_map" class="idref" href="#pc_map"><span class="id" title="definition">pc_map</span></a> <a id="f:104" class="idref" href="#f:104"><span class="id" title="binder">f</span></a> <a id="ef:105" class="idref" href="#ef:105"><span class="id" title="binder">ef</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#ef:105"><span class="id" title="variable">ef</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> (<span class="id" title="var">x</span> <span class="id" title="notation"><|</span> <a class="idref" href="#cf_pc"><span class="id" title="projection">cf_pc</span></a> <span class="id" title="notation">::=</span>  <a class="idref" href="#f:104"><span class="id" title="variable">f</span></a> <span class="id" title="notation">|></span>) <span class="id" title="var">tail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> (<span class="id" title="var">x</span> <span class="id" title="notation"><|</span> <a class="idref" href="#ecf_common"><span class="id" title="projection">ecf_common</span></a> <span class="id" title="notation">::=</span> <span class="id" title="keyword">fun</span> <a id="cf:107" class="idref" href="#cf:107"><span class="id" title="binder">cf</span></a> ⇒ <a class="idref" href="#cf:107"><span class="id" title="variable">cf</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#cf_pc"><span class="id" title="projection">cf_pc</span></a> <span class="id" title="notation">::=</span>  <a class="idref" href="#f:104"><span class="id" title="variable">f</span></a> <span class="id" title="notation">|></span> <span class="id" title="notation">|></span>) <span class="id" title="var">tail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="pc_set" class="idref" href="#pc_set"><span class="id" title="definition">pc_set</span></a> <a id="new:108" class="idref" href="#new:108"><span class="id" title="binder">new</span></a> := <a class="idref" href="#pc_map"><span class="id" title="definition">pc_map</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#new:108"><span class="id" title="variable">new</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="pc_map_cfc_spec" class="idref" href="#pc_map_cfc_spec"><span class="id" title="inductive">pc_map_cfc_spec</span></a> <a id="f:109" class="idref" href="#f:109"><span class="id" title="binder">f</span></a> : <a class="idref" href="#callstack_common"><span class="id" title="record">callstack_common</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#callstack_common"><span class="id" title="record">callstack_common</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="upc_map" class="idref" href="#upc_map"><span class="id" title="constructor">upc_map</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="ehl:112" class="idref" href="#ehl:112"><span class="id" title="binder">ehl</span></a> <a id="sp:113" class="idref" href="#sp:113"><span class="id" title="binder">sp</span></a> <a id="ergs:114" class="idref" href="#ergs:114"><span class="id" title="binder">ergs</span></a> <a id="pc:115" class="idref" href="#pc:115"><span class="id" title="binder">pc</span></a> <a id="pc':116" class="idref" href="#pc':116"><span class="id" title="binder">pc'</span></a> <a id="ss:117" class="idref" href="#ss:117"><span class="id" title="binder">ss</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#f:109"><span class="id" title="variable">f</span></a> <a class="idref" href="#pc:115"><span class="id" title="variable">pc</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#pc':116"><span class="id" title="variable">pc'</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pc_map_cfc_spec:110"><span class="id" title="inductive">pc_map_cfc_spec</span></a> <a class="idref" href="#f:109"><span class="id" title="variable">f</span></a> (<a class="idref" href="#mk_cf"><span class="id" title="constructor">mk_cf</span></a> <a class="idref" href="#ehl:112"><span class="id" title="variable">ehl</span></a> <a class="idref" href="#sp:113"><span class="id" title="variable">sp</span></a> <a class="idref" href="#pc:115"><span class="id" title="variable">pc</span></a> <a class="idref" href="#ergs:114"><span class="id" title="variable">ergs</span></a> <a class="idref" href="#ss:117"><span class="id" title="variable">ss</span></a>) (<a class="idref" href="#mk_cf"><span class="id" title="constructor">mk_cf</span></a> <a class="idref" href="#ehl:112"><span class="id" title="variable">ehl</span></a> <a class="idref" href="#sp:113"><span class="id" title="variable">sp</span></a> <a class="idref" href="#pc':116"><span class="id" title="variable">pc'</span></a> <a class="idref" href="#ergs:114"><span class="id" title="variable">ergs</span></a> <a class="idref" href="#ss:117"><span class="id" title="variable">ss</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="pc_map_extcall_spec" class="idref" href="#pc_map_extcall_spec"><span class="id" title="inductive">pc_map_extcall_spec</span></a> <a id="f:118" class="idref" href="#f:118"><span class="id" title="binder">f</span></a>: <a class="idref" href="#callstack_external"><span class="id" title="record">callstack_external</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#callstack_external"><span class="id" title="record">callstack_external</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="upe_update" class="idref" href="#upe_update"><span class="id" title="constructor">upe_update</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cf:121" class="idref" href="#cf:121"><span class="id" title="binder">cf</span></a> <a id="cf':122" class="idref" href="#cf':122"><span class="id" title="binder">cf'</span></a> <a id="ac:123" class="idref" href="#ac:123"><span class="id" title="binder">ac</span></a> <a id="memory:124" class="idref" href="#memory:124"><span class="id" title="binder">memory</span></a> <a id="is_static:125" class="idref" href="#is_static:125"><span class="id" title="binder">is_static</span></a> <a id="context_u128_value:126" class="idref" href="#context_u128_value:126"><span class="id" title="binder">context_u128_value</span></a> <a id="cc:127" class="idref" href="#cc:127"><span class="id" title="binder">cc</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pc_map_cfc_spec"><span class="id" title="inductive">pc_map_cfc_spec</span></a> <a class="idref" href="#f:118"><span class="id" title="variable">f</span></a> <a class="idref" href="#cf:121"><span class="id" title="variable">cf</span></a> <a class="idref" href="#cf':122"><span class="id" title="variable">cf'</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pc_map_extcall_spec:119"><span class="id" title="inductive">pc_map_extcall_spec</span></a> <a class="idref" href="#f:118"><span class="id" title="variable">f</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#mk_extcf"><span class="id" title="constructor">mk_extcf</span></a> <a class="idref" href="#ac:123"><span class="id" title="variable">ac</span></a> <a class="idref" href="#memory:124"><span class="id" title="variable">memory</span></a> <a class="idref" href="#is_static:125"><span class="id" title="variable">is_static</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#context_u128_value:126"><span class="id" title="variable">context_u128_value</span></a> <a class="idref" href="#cc:127"><span class="id" title="variable">cc</span></a> <a class="idref" href="#cf:121"><span class="id" title="variable">cf</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#mk_extcf"><span class="id" title="constructor">mk_extcf</span></a> <a class="idref" href="#ac:123"><span class="id" title="variable">ac</span></a> <a class="idref" href="#memory:124"><span class="id" title="variable">memory</span></a> <a class="idref" href="#is_static:125"><span class="id" title="variable">is_static</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#context_u128_value:126"><span class="id" title="variable">context_u128_value</span></a> <a class="idref" href="#cc:127"><span class="id" title="variable">cc</span></a> <a class="idref" href="#cf':122"><span class="id" title="variable">cf'</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="pc_map_spec" class="idref" href="#pc_map_spec"><span class="id" title="inductive">pc_map_spec</span></a> <a id="f:128" class="idref" href="#f:128"><span class="id" title="binder">f</span></a> : <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="upc_ext" class="idref" href="#upc_ext"><span class="id" title="constructor">upc_ext</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="ecf:131" class="idref" href="#ecf:131"><span class="id" title="binder">ecf</span></a> <a id="ecf':132" class="idref" href="#ecf':132"><span class="id" title="binder">ecf'</span></a> <a id="tail:133" class="idref" href="#tail:133"><span class="id" title="binder">tail</span></a> ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pc_map_extcall_spec"><span class="id" title="inductive">pc_map_extcall_spec</span></a> <a class="idref" href="#f:128"><span class="id" title="variable">f</span></a> <a class="idref" href="#ecf:131"><span class="id" title="variable">ecf</span></a> <a class="idref" href="#ecf':132"><span class="id" title="variable">ecf'</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pc_map_spec:129"><span class="id" title="inductive">pc_map_spec</span></a> <a class="idref" href="#f:128"><span class="id" title="variable">f</span></a> (<a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="#ecf:131"><span class="id" title="variable">ecf</span></a> <a class="idref" href="#tail:133"><span class="id" title="variable">tail</span></a>) (<a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="#ecf':132"><span class="id" title="variable">ecf'</span></a> <a class="idref" href="#tail:133"><span class="id" title="variable">tail</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="upc_int" class="idref" href="#upc_int"><span class="id" title="constructor">upc_int</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cf:134" class="idref" href="#cf:134"><span class="id" title="binder">cf</span></a> <a id="cf':135" class="idref" href="#cf':135"><span class="id" title="binder">cf'</span></a> <a id="tail:136" class="idref" href="#tail:136"><span class="id" title="binder">tail</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pc_map_cfc_spec"><span class="id" title="inductive">pc_map_cfc_spec</span></a> <a class="idref" href="#f:128"><span class="id" title="variable">f</span></a> <a class="idref" href="#cf:134"><span class="id" title="variable">cf</span></a> <a class="idref" href="#cf':135"><span class="id" title="variable">cf'</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pc_map_spec:129"><span class="id" title="inductive">pc_map_spec</span></a> <a class="idref" href="#f:128"><span class="id" title="variable">f</span></a> (<a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="#cf:134"><span class="id" title="variable">cf</span></a> <a class="idref" href="#tail:136"><span class="id" title="variable">tail</span></a>) (<a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="#cf':135"><span class="id" title="variable">cf'</span></a> <a class="idref" href="#tail:136"><span class="id" title="variable">tail</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="pc_map_correct" class="idref" href="#pc_map_correct"><span class="id" title="lemma">pc_map_correct</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="ef:137" class="idref" href="#ef:137"><span class="id" title="binder">ef</span></a> <a id="f:138" class="idref" href="#f:138"><span class="id" title="binder">f</span></a>, <a class="idref" href="#pc_map_spec"><span class="id" title="inductive">pc_map_spec</span></a> <a class="idref" href="#f:138"><span class="id" title="variable">f</span></a> <a class="idref" href="#ef:137"><span class="id" title="variable">ef</span></a> (<a class="idref" href="#pc_map"><span class="id" title="definition">pc_map</span></a> <a class="idref" href="#f:138"><span class="id" title="variable">f</span></a> <a class="idref" href="#ef:137"><span class="id" title="variable">ef</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="#Callstack.PC"><span class="id" title="section">PC</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Callstack.TopmostExternalFrame" class="idref" href="#Callstack.TopmostExternalFrame"><span class="id" title="section">TopmostExternalFrame</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <a id="active_extframe" class="idref" href="#active_extframe"><span class="id" title="definition">active_extframe</span></a> (<a id="ef:139" class="idref" href="#ef:139"><span class="id" title="binder">ef</span></a> : <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="#callstack_external"><span class="id" title="record">callstack_external</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#ef:139"><span class="id" title="variable">ef</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <span class="id" title="var">_</span> <a class="idref" href="#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <a class="idref" href="#active_extframe:140"><span class="id" title="definition">active_extframe</span></a> <span class="id" title="var">tail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="active_extframe_spec" class="idref" href="#active_extframe_spec"><span class="id" title="inductive">active_extframe_spec</span></a> : <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#callstack_external"><span class="id" title="record">callstack_external</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="te_Top" class="idref" href="#te_Top"><span class="id" title="constructor">te_Top</span></a>: <span class="id" title="keyword">∀</span> <a id="x:144" class="idref" href="#x:144"><span class="id" title="binder">x</span></a> <a id="t:145" class="idref" href="#t:145"><span class="id" title="binder">t</span></a>, <a class="idref" href="#active_extframe_spec:142"><span class="id" title="inductive">active_extframe_spec</span></a> (<a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="#x:144"><span class="id" title="variable">x</span></a> <a class="idref" href="#t:145"><span class="id" title="variable">t</span></a>) <a class="idref" href="#x:144"><span class="id" title="variable">x</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="te_Deeper" class="idref" href="#te_Deeper"><span class="id" title="constructor">te_Deeper</span></a>: <span class="id" title="keyword">∀</span> <a id="c:146" class="idref" href="#c:146"><span class="id" title="binder">c</span></a> <a id="t:147" class="idref" href="#t:147"><span class="id" title="binder">t</span></a> <a id="f:148" class="idref" href="#f:148"><span class="id" title="binder">f</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#active_extframe_spec:142"><span class="id" title="inductive">active_extframe_spec</span></a> <a class="idref" href="#t:147"><span class="id" title="variable">t</span></a> <a class="idref" href="#f:148"><span class="id" title="variable">f</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#active_extframe_spec:142"><span class="id" title="inductive">active_extframe_spec</span></a> (<a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="#c:146"><span class="id" title="variable">c</span></a> <a class="idref" href="#t:147"><span class="id" title="variable">t</span></a>) <a class="idref" href="#f:148"><span class="id" title="variable">f</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="active_extframe_correct" class="idref" href="#active_extframe_correct"><span class="id" title="lemma">active_extframe_correct</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="ef:149" class="idref" href="#ef:149"><span class="id" title="binder">ef</span></a>, <a class="idref" href="#active_extframe_spec"><span class="id" title="inductive">active_extframe_spec</span></a> <a class="idref" href="#ef:149"><span class="id" title="variable">ef</span></a> (<a class="idref" href="#active_extframe"><span class="id" title="definition">active_extframe</span></a> <a class="idref" href="#ef:149"><span class="id" title="variable">ef</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <a id="change_active_extframe" class="idref" href="#change_active_extframe"><span class="id" title="definition">change_active_extframe</span></a> <a id="f:150" class="idref" href="#f:150"><span class="id" title="binder">f</span></a> (<a id="ef:151" class="idref" href="#ef:151"><span class="id" title="binder">ef</span></a>:<a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#ef:151"><span class="id" title="variable">ef</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <span class="id" title="var">x</span> (<a class="idref" href="#change_active_extframe:152"><span class="id" title="definition">change_active_extframe</span></a> <a class="idref" href="#f:150"><span class="id" title="variable">f</span></a> <span class="id" title="var">tail</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> (<a class="idref" href="#f:150"><span class="id" title="variable">f</span></a> <span class="id" title="var">x</span>) <span class="id" title="var">tail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="change_active_extframe_spec" class="idref" href="#change_active_extframe_spec"><span class="id" title="inductive">change_active_extframe_spec</span></a> <a id="f:154" class="idref" href="#f:154"><span class="id" title="binder">f</span></a> : <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="ct_base" class="idref" href="#ct_base"><span class="id" title="constructor">ct_base</span></a>: <span class="id" title="keyword">∀</span> <a id="cf:157" class="idref" href="#cf:157"><span class="id" title="binder">cf</span></a> <a id="t:158" class="idref" href="#t:158"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#change_active_extframe_spec:155"><span class="id" title="inductive">change_active_extframe_spec</span></a> <a class="idref" href="#f:154"><span class="id" title="variable">f</span></a> (<a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="#cf:157"><span class="id" title="variable">cf</span></a> <a class="idref" href="#t:158"><span class="id" title="variable">t</span></a>) (<a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> (<a class="idref" href="#f:154"><span class="id" title="variable">f</span></a> <a class="idref" href="#cf:157"><span class="id" title="variable">cf</span></a>) <a class="idref" href="#t:158"><span class="id" title="variable">t</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="ct_ind" class="idref" href="#ct_ind"><span class="id" title="constructor">ct_ind</span></a>: <span class="id" title="keyword">∀</span> <a id="cf:159" class="idref" href="#cf:159"><span class="id" title="binder">cf</span></a> <a id="t:160" class="idref" href="#t:160"><span class="id" title="binder">t</span></a> <a id="t':161" class="idref" href="#t':161"><span class="id" title="binder">t'</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#change_active_extframe_spec:155"><span class="id" title="inductive">change_active_extframe_spec</span></a> <a class="idref" href="#f:154"><span class="id" title="variable">f</span></a> <a class="idref" href="#t:160"><span class="id" title="variable">t</span></a> <a class="idref" href="#t':161"><span class="id" title="variable">t'</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#change_active_extframe_spec:155"><span class="id" title="inductive">change_active_extframe_spec</span></a> <a class="idref" href="#f:154"><span class="id" title="variable">f</span></a> (<a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="#cf:159"><span class="id" title="variable">cf</span></a> <a class="idref" href="#t:160"><span class="id" title="variable">t</span></a>) (<a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="#cf:159"><span class="id" title="variable">cf</span></a> <a class="idref" href="#t':161"><span class="id" title="variable">t'</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="change_active_extframe_correct" class="idref" href="#change_active_extframe_correct"><span class="id" title="lemma">change_active_extframe_correct</span></a> : <span class="id" title="keyword">∀</span> <a id="f:162" class="idref" href="#f:162"><span class="id" title="binder">f</span></a> <a id="ef:163" class="idref" href="#ef:163"><span class="id" title="binder">ef</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#change_active_extframe_spec"><span class="id" title="inductive">change_active_extframe_spec</span></a> <a class="idref" href="#f:162"><span class="id" title="variable">f</span></a> <a class="idref" href="#ef:163"><span class="id" title="variable">ef</span></a> (<a class="idref" href="#change_active_extframe"><span class="id" title="definition">change_active_extframe</span></a> <a class="idref" href="#f:162"><span class="id" title="variable">f</span></a> <a class="idref" href="#ef:163"><span class="id" title="variable">ef</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="update_memory_context" class="idref" href="#update_memory_context"><span class="id" title="definition">update_memory_context</span></a> (<a id="ctx:164" class="idref" href="#ctx:164"><span class="id" title="binder">ctx</span></a>:<a class="idref" href="#mem_ctx"><span class="id" title="record">mem_ctx</span></a>): <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#change_active_extframe"><span class="id" title="definition">change_active_extframe</span></a> (<span class="id" title="keyword">fun</span> <a id="ef:165" class="idref" href="#ef:165"><span class="id" title="binder">ef</span></a> ⇒ <a class="idref" href="#ef:165"><span class="id" title="variable">ef</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#ecf_mem_ctx"><span class="id" title="projection">ecf_mem_ctx</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#ctx:164"><span class="id" title="variable">ctx</span></a> <span class="id" title="notation">|></span> ).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="revert_state" class="idref" href="#revert_state"><span class="id" title="definition">revert_state</span></a> (<a id="cs:166" class="idref" href="#cs:166"><span class="id" title="binder">cs</span></a>:<a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="#Callstack.state_checkpoint"><span class="id" title="variable">state_checkpoint</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#cs:166"><span class="id" title="variable">cs</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <span class="id" title="var">x</span>.(<a class="idref" href="#cf_saved_checkpoint"><span class="id" title="projection">cf_saved_checkpoint</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <span class="id" title="var">x</span> <a class="idref" href="#tail"><span class="id" title="abbreviation">tail</span></a> ⇒ <span class="id" title="var">x</span>.(<a class="idref" href="#ecf_common"><span class="id" title="projection">ecf_common</span></a>).(<a class="idref" href="#cf_saved_checkpoint"><span class="id" title="projection">cf_saved_checkpoint</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> .<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="current_shard" class="idref" href="#current_shard"><span class="id" title="definition">current_shard</span></a> <a id="xstack:168" class="idref" href="#xstack:168"><span class="id" title="binder">xstack</span></a> : <a class="idref" href="#shard_id"><span class="id" title="definition">shard_id</span></a> := (<a class="idref" href="#active_extframe"><span class="id" title="definition">active_extframe</span></a> <a class="idref" href="#xstack:168"><span class="id" title="variable">xstack</span></a>).(<a class="idref" href="#ecf_shards"><span class="id" title="projection">ecf_shards</span></a>).(<a class="idref" href="#shard_this"><span class="id" title="projection">shard_this</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="current_contract" class="idref" href="#current_contract"><span class="id" title="definition">current_contract</span></a> <a id="xstack:169" class="idref" href="#xstack:169"><span class="id" title="binder">xstack</span></a> : <a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a> := <a class="idref" href="#ecf_this_address"><span class="id" title="projection">ecf_this_address</span></a> (<a class="idref" href="#active_extframe"><span class="id" title="definition">active_extframe</span></a> <a class="idref" href="#xstack:169"><span class="id" title="variable">xstack</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="#Callstack.TopmostExternalFrame"><span class="id" title="section">TopmostExternalFrame</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Callstack.ActiveMemory" class="idref" href="#Callstack.ActiveMemory"><span class="id" title="section">ActiveMemory</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Callstack.ActiveMemory.ActivePageId" class="idref" href="#Callstack.ActiveMemory.ActivePageId"><span class="id" title="section">ActivePageId</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="ef:170" class="idref" href="#ef:170"><span class="id" title="binder">ef</span></a>:<a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a>) (<a id="active_extframe:171" class="idref" href="#active_extframe:171"><span class="id" title="binder">active_extframe</span></a> := <a class="idref" href="#active_extframe"><span class="id" title="definition">active_extframe</span></a> <a class="idref" href="#ef:170"><span class="id" title="variable">ef</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="get_mem_ctx" class="idref" href="#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a>: <a class="idref" href="#mem_ctx"><span class="id" title="record">mem_ctx</span></a> := <a class="idref" href="#Callstack.ActiveMemory.ActivePageId.active_extframe"><span class="id" title="variable">active_extframe</span></a>.(<a class="idref" href="#ecf_mem_ctx"><span class="id" title="projection">ecf_mem_ctx</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="active_code_id" class="idref" href="#active_code_id"><span class="id" title="definition">active_code_id</span></a>: <a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a> := <a class="idref" href="#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a>.(<a class="idref" href="#ctx_code_page_id"><span class="id" title="projection">ctx_code_page_id</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="active_stack_id" class="idref" href="#active_stack_id"><span class="id" title="definition">active_stack_id</span></a>: <a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a> := <a class="idref" href="#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a>.(<a class="idref" href="#ctx_stack_page_id"><span class="id" title="projection">ctx_stack_page_id</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="active_const_id" class="idref" href="#active_const_id"><span class="id" title="definition">active_const_id</span></a>: <a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a> := <a class="idref" href="#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a>.(<a class="idref" href="#ctx_const_page_id"><span class="id" title="projection">ctx_const_page_id</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="active_heap_id" class="idref" href="#active_heap_id"><span class="id" title="definition">active_heap_id</span></a> : <a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a> := <a class="idref" href="#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a>.(<a class="idref" href="#ctx_heap_page_id"><span class="id" title="projection">ctx_heap_page_id</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="active_auxheap_id" class="idref" href="#active_auxheap_id"><span class="id" title="definition">active_auxheap_id</span></a> : <a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a> := <a class="idref" href="#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a>.(<a class="idref" href="#ctx_auxheap_page_id"><span class="id" title="projection">ctx_auxheap_page_id</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="heap_bound" class="idref" href="#heap_bound"><span class="id" title="definition">heap_bound</span></a> := <a class="idref" href="#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a>.(<a class="idref" href="#ctx_heap_bound"><span class="id" title="projection">ctx_heap_bound</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="auxheap_bound" class="idref" href="#auxheap_bound"><span class="id" title="definition">auxheap_bound</span></a> := <a class="idref" href="#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a>.(<a class="idref" href="#ctx_auxheap_bound"><span class="id" title="projection">ctx_auxheap_bound</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="heap_variant_bound" class="idref" href="#heap_variant_bound"><span class="id" title="definition">heap_variant_bound</span></a> (<a id="page_type:172" class="idref" href="#page_type:172"><span class="id" title="binder">page_type</span></a>:<a class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a>):  <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#page_type:172"><span class="id" title="variable">page_type</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Heap"><span class="id" title="constructor">Heap</span></a> ⇒ <a class="idref" href="#heap_bound"><span class="id" title="definition">heap_bound</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#AuxHeap"><span class="id" title="constructor">AuxHeap</span></a> ⇒ <a class="idref" href="#auxheap_bound"><span class="id" title="definition">auxheap_bound</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="heap_variant_page_id" class="idref" href="#heap_variant_page_id"><span class="id" title="definition">heap_variant_page_id</span></a> (<a id="page_type:174" class="idref" href="#page_type:174"><span class="id" title="binder">page_type</span></a>: <a class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#page_type:174"><span class="id" title="variable">page_type</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Heap"><span class="id" title="constructor">Heap</span></a> ⇒ <a class="idref" href="#active_heap_id"><span class="id" title="definition">active_heap_id</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#AuxHeap"><span class="id" title="constructor">AuxHeap</span></a> ⇒ <a class="idref" href="#active_auxheap_id"><span class="id" title="definition">active_auxheap_id</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="#Callstack.ActiveMemory.ActivePageId"><span class="id" title="section">ActivePageId</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Callstack.ActiveMemory.ActivePages" class="idref" href="#Callstack.ActiveMemory.ActivePages"><span class="id" title="section">ActivePages</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="code_page:176" class="idref" href="#code_page:176"><span class="id" title="binder">code_page</span></a> <a id="const_page:177" class="idref" href="#const_page:177"><span class="id" title="binder">const_page</span></a> <a id="data_page:178" class="idref" href="#data_page:178"><span class="id" title="binder">data_page</span></a> <a id="stack_page:179" class="idref" href="#stack_page:179"><span class="id" title="binder">stack_page</span></a>} (<a id="page_has_id:180" class="idref" href="#page_has_id:180"><span class="id" title="binder">page_has_id</span></a>: <a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> @<a class="idref" href="#page"><span class="id" title="record">page</span></a> <a class="idref" href="#code_page:176"><span class="id" title="variable">code_page</span></a> <a class="idref" href="#const_page:177"><span class="id" title="variable">const_page</span></a> <a class="idref" href="#data_page:178"><span class="id" title="variable">data_page</span></a> <a class="idref" href="#stack_page:179"><span class="id" title="variable">stack_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="active_exception_handler" class="idref" href="#active_exception_handler"><span class="id" title="definition">active_exception_handler</span></a> (<a id="ef:181" class="idref" href="#ef:181"><span class="id" title="binder">ef</span></a>: <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="#exception_handler"><span class="id" title="definition">exception_handler</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#cfc"><span class="id" title="definition">cfc</span></a> <a class="idref" href="#ef:181"><span class="id" title="variable">ef</span></a>).(<a class="idref" href="#cf_exception_handler_location"><span class="id" title="projection">cf_exception_handler_location</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="ef:182" class="idref" href="#ef:182"><span class="id" title="binder">ef</span></a>: <a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a>) (<a id="page_id:184" class="idref" href="#page_id:184"><span class="id" title="binder">page_id</span></a> := <span class="id" title="keyword">fun</span> <a id="i:183" class="idref" href="#i:183"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#Callstack.ActiveMemory.ActivePages.page_has_id"><span class="id" title="variable">page_has_id</span></a> (<a class="idref" href="#i:183"><span class="id" title="variable">i</span></a> <a class="idref" href="#ef:182"><span class="id" title="variable">ef</span></a>)).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="active_codepage" class="idref" href="#active_codepage"><span class="id" title="inductive">active_codepage</span></a> : <a class="idref" href="#Callstack.ActiveMemory.ActivePages.code_page"><span class="id" title="variable">code_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a id="ap_active_code" class="idref" href="#ap_active_code"><span class="id" title="constructor">ap_active_code</span></a>: <span class="id" title="keyword">∀</span> <a id="codepage:187" class="idref" href="#codepage:187"><span class="id" title="binder">codepage</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Callstack.ActiveMemory.ActivePages.page_id"><span class="id" title="variable">page_id</span></a> <a class="idref" href="#active_code_id"><span class="id" title="definition">active_code_id</span></a> (<a class="idref" href="#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="#CodePage"><span class="id" title="constructor">CodePage</span></a> <a class="idref" href="#codepage:187"><span class="id" title="variable">codepage</span></a>)) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#active_codepage:185"><span class="id" title="inductive">active_codepage</span></a> <a class="idref" href="#codepage:187"><span class="id" title="variable">codepage</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="active_constpage" class="idref" href="#active_constpage"><span class="id" title="inductive">active_constpage</span></a> : <a class="idref" href="#Callstack.ActiveMemory.ActivePages.const_page"><span class="id" title="variable">const_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a id="ap_active_const" class="idref" href="#ap_active_const"><span class="id" title="constructor">ap_active_const</span></a>: <span class="id" title="keyword">∀</span> <a id="constpage:190" class="idref" href="#constpage:190"><span class="id" title="binder">constpage</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Callstack.ActiveMemory.ActivePages.page_id"><span class="id" title="variable">page_id</span></a>  <a class="idref" href="#active_const_id"><span class="id" title="definition">active_const_id</span></a> (<a class="idref" href="#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="#ConstPage"><span class="id" title="constructor">ConstPage</span></a> <a class="idref" href="#constpage:190"><span class="id" title="variable">constpage</span></a>)) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#active_constpage:188"><span class="id" title="inductive">active_constpage</span></a>  <a class="idref" href="#constpage:190"><span class="id" title="variable">constpage</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="active_stackpage" class="idref" href="#active_stackpage"><span class="id" title="inductive">active_stackpage</span></a> : <a class="idref" href="#Callstack.ActiveMemory.ActivePages.stack_page"><span class="id" title="variable">stack_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a id="ap_active_stack" class="idref" href="#ap_active_stack"><span class="id" title="constructor">ap_active_stack</span></a>: <span class="id" title="keyword">∀</span>  <a id="stackpage:193" class="idref" href="#stackpage:193"><span class="id" title="binder">stackpage</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Callstack.ActiveMemory.ActivePages.page_id"><span class="id" title="variable">page_id</span></a> <a class="idref" href="#active_stack_id"><span class="id" title="definition">active_stack_id</span></a> (<a class="idref" href="#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="#StackPage"><span class="id" title="constructor">StackPage</span></a> <a class="idref" href="#stackpage:193"><span class="id" title="variable">stackpage</span></a>)) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#active_stackpage:191"><span class="id" title="inductive">active_stackpage</span></a> <a class="idref" href="#stackpage:193"><span class="id" title="variable">stackpage</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="active_heappage" class="idref" href="#active_heappage"><span class="id" title="inductive">active_heappage</span></a> : <a class="idref" href="#Callstack.ActiveMemory.ActivePages.data_page"><span class="id" title="variable">data_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a id="ap_active_heap" class="idref" href="#ap_active_heap"><span class="id" title="constructor">ap_active_heap</span></a>: <span class="id" title="keyword">∀</span> <a id="p:196" class="idref" href="#p:196"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Callstack.ActiveMemory.ActivePages.page_id"><span class="id" title="variable">page_id</span></a> <a class="idref" href="#active_heap_id"><span class="id" title="definition">active_heap_id</span></a> (<a class="idref" href="#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="#DataPage"><span class="id" title="constructor">DataPage</span></a> <a class="idref" href="#p:196"><span class="id" title="variable">p</span></a>)) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#active_heappage:194"><span class="id" title="inductive">active_heappage</span></a> <a class="idref" href="#p:196"><span class="id" title="variable">p</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="active_auxheappage" class="idref" href="#active_auxheappage"><span class="id" title="inductive">active_auxheappage</span></a> : <a class="idref" href="#Callstack.ActiveMemory.ActivePages.data_page"><span class="id" title="variable">data_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a id="ap_active_auxheap" class="idref" href="#ap_active_auxheap"><span class="id" title="constructor">ap_active_auxheap</span></a>: <span class="id" title="keyword">∀</span> <a id="p:199" class="idref" href="#p:199"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Callstack.ActiveMemory.ActivePages.page_id"><span class="id" title="variable">page_id</span></a> <a class="idref" href="#active_auxheap_id"><span class="id" title="definition">active_auxheap_id</span></a> (<a class="idref" href="#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="#DataPage"><span class="id" title="constructor">DataPage</span></a> <a class="idref" href="#p:199"><span class="id" title="variable">p</span></a>)) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#active_auxheappage:197"><span class="id" title="inductive">active_auxheappage</span></a> <a class="idref" href="#p:199"><span class="id" title="variable">p</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="#Callstack.ActiveMemory.ActivePages"><span class="id" title="section">ActivePages</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="#Callstack.ActiveMemory"><span class="id" title="section">ActiveMemory</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="in_kernel_mode" class="idref" href="#in_kernel_mode"><span class="id" title="definition">in_kernel_mode</span></a> (<a id="ef:200" class="idref" href="#ef:200"><span class="id" title="binder">ef</span></a>:<a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a>) : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="ef:201" class="idref" href="#ef:201"><span class="id" title="binder">ef</span></a> := <a class="idref" href="#active_extframe"><span class="id" title="definition">active_extframe</span></a> <a class="idref" href="#ef:200"><span class="id" title="variable">ef</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#addr_is_kernel"><span class="id" title="definition">addr_is_kernel</span></a> <a class="idref" href="#ef:201"><span class="id" title="variable">ef</span></a>.(<a class="idref" href="#ecf_this_address"><span class="id" title="projection">ecf_this_address</span></a>).<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Callstack"><span class="id" title="section">Callstack</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.MemoryContext</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">memory.Pages</span></a> <a class="idref" href="#"><span class="id" title="library">memory.PageTypes</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">memory.Pages</span></a> <a class="idref" href="#"><span class="id" title="module">memory.PageTypes</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="MemoryContext" class="idref" href="#MemoryContext"><span class="id" title="section">MemoryContext</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <span class="id" title="module">RecordSetNotations</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <span class="id" title="module">seq</span> <a class="idref" href="#"><span class="id" title="module">Arith</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
</div>

<div class="doc"><h1 id="memory-context">Memory context</h1>
<p>Creation of an external frame leads to allocation of pages for code,
constant data, stack, and heap variants (see <span
class="inlinecode"><a class="idref" href="#alloc_pages_extframe"><span
class="id"
title="inductive">alloc_pages_extframe</span></a></span>).</p>
<p><strong>Memory context</strong> is a collection of pages associated
with a contract’s frame, plus the bounds for heap variants. It is stored
in <span
class="inlinecode"><a class="idref" href="#ecf_mem_ctx"><span
class="id" title="projection">ecf_mem_ctx</span></a></span> field of
<span
class="inlinecode"><a class="idref" href="#ExternalCall"><span
class="id" title="constructor">ExternalCall</span></a></span> frame.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="mem_ctx" class="idref" href="#mem_ctx"><span class="id" title="record">mem_ctx</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mk_mem_ctx</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ctx_code_page_id" class="idref" href="#ctx_code_page_id"><span class="id" title="projection">ctx_code_page_id</span></a>:  <a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ctx_const_page_id" class="idref" href="#ctx_const_page_id"><span class="id" title="projection">ctx_const_page_id</span></a>:  <a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ctx_stack_page_id" class="idref" href="#ctx_stack_page_id"><span class="id" title="projection">ctx_stack_page_id</span></a>:  <a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ctx_heap_page_id" class="idref" href="#ctx_heap_page_id"><span class="id" title="projection">ctx_heap_page_id</span></a>:  <a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ctx_auxheap_page_id" class="idref" href="#ctx_auxheap_page_id"><span class="id" title="projection">ctx_auxheap_page_id</span></a>:  <a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ctx_heap_bound" class="idref" href="#ctx_heap_bound"><span class="id" title="projection">ctx_heap_bound</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ctx_auxheap_bound" class="idref" href="#ctx_auxheap_bound"><span class="id" title="projection">ctx_auxheap_bound</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
</div>

<div class="doc"><p>The exact values of identifiers of pages in <span
class="inlinecode"><a class="idref" href="#mem_ctx"><span
class="id" title="record">mem_ctx</span></a></span> are not guaranteed,
neither is their order.</p>
<p>However, pages are ordered according to the order of creation (see
<span
class="inlinecode"><a class="idref" href="#page_older"><span
class="id" title="definition">page_older</span></a></span>).</p>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="list_mem_ctx" class="idref" href="#list_mem_ctx"><span class="id" title="definition">list_mem_ctx</span></a> (<a id="ap:9" class="idref" href="#ap:9"><span class="id" title="binder">ap</span></a>:<a class="idref" href="#mem_ctx"><span class="id" title="record">mem_ctx</span></a>) : <a class="idref" href="#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#ap:9"><span class="id" title="variable">ap</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_mem_ctx"><span class="id" title="constructor">mk_mem_ctx</span></a> <span class="id" title="var">code_id</span> <span class="id" title="var">const_id</span> <span class="id" title="var">stack_id</span> <span class="id" title="var">heap_id</span> <span class="id" title="var">auxheap_id</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">[::</span> <span class="id" title="var">code_id</span><span class="id" title="notation">;</span> <span class="id" title="var">const_id</span><span class="id" title="notation">;</span><span class="id" title="var">stack_id</span><span class="id" title="notation">;</span><span class="id" title="var">heap_id</span><span class="id" title="notation">;</span><span class="id" title="var">auxheap_id</span><span class="id" title="notation">]</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="page_older" class="idref" href="#page_older"><span class="id" title="definition">page_older</span></a> (<a id="id:11" class="idref" href="#id:11"><span class="id" title="binder">id</span></a>: <a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a>) (<a id="mps:12" class="idref" href="#mps:12"><span class="id" title="binder">mps</span></a>: <a class="idref" href="#mem_ctx"><span class="id" title="record">mem_ctx</span></a>) : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#forallb"><span class="id" title="definition">List.forallb</span></a> (<a class="idref" href="#page_older"><span class="id" title="definition">page_older</span></a> <a class="idref" href="#id:11"><span class="id" title="variable">id</span></a>) (<a class="idref" href="#list_mem_ctx"><span class="id" title="definition">list_mem_ctx</span></a> <a class="idref" href="#mps:12"><span class="id" title="variable">mps</span></a>).<br/>

<br/>
</div>

<div class="doc"><p>Function <span
class="inlinecode"><a class="idref" href="#is_active_page"><span
class="id" title="definition">is_active_page</span></a></span> returns
<span
class="inlinecode"><a class="idref" href="#true"><span
class="id" title="constructor">true</span></a></span> if memory page
<span class="inlinecode"><span class="id" title="var">id</span></span>
belongs to the context <span class="inlinecode"><span class="id"
title="var">c</span></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="is_active_page" class="idref" href="#is_active_page"><span class="id" title="definition">is_active_page</span></a> (<a id="c:13" class="idref" href="#c:13"><span class="id" title="binder">c</span></a>:<a class="idref" href="#mem_ctx"><span class="id" title="record">mem_ctx</span></a>) (<a id="id:14" class="idref" href="#id:14"><span class="id" title="binder">id</span></a>: <a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a>) : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#existsb"><span class="id" title="definition">List.existsb</span></a> (<a class="idref" href="#page_eq"><span class="id" title="definition">page_eq</span></a> <a class="idref" href="#id:14"><span class="id" title="variable">id</span></a>) (<a class="idref" href="#list_mem_ctx"><span class="id" title="definition">list_mem_ctx</span></a> <a class="idref" href="#c:13"><span class="id" title="variable">c</span></a>).<br/>

<br/>

<br/>
</div>

<div class="doc"><p>If an instruction addresses a heap variant outside of its bounds, the
bound of this heap variant is adjusted to include the used address.
Predicates <span
class="inlinecode"><a class="idref" href="#grow_heap_page"><span
class="id" title="inductive">grow_heap_page</span></a></span>, <span
class="inlinecode"><a class="idref" href="#grow_auxheap_page"><span
class="id" title="inductive">grow_auxheap_page</span></a></span>, <span
class="inlinecode"><a class="idref" href="#grow_heap_variant"><span
class="id" title="inductive">grow_heap_variant</span></a></span> are
relating memory contexts where a heap variant is grown.</p>
<p><strong>WARNING: KNOWN DIVERGENCE (in versions prior to
v1.4.1)</strong></p>
<p>In earlier implementations, if heap/auxheap was grown inside a near
call, the parent’s heap/auxheap bound may be restored after
<code>ret</code> as if no growth happened. Since v 1.4.1 the
implementation conforms to the spec.</p>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="grow_heap_page" class="idref" href="#grow_heap_page"><span class="id" title="inductive">grow_heap_page</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#mem_ctx"><span class="id" title="record">mem_ctx</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#mem_ctx"><span class="id" title="record">mem_ctx</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="gp_heap" class="idref" href="#gp_heap"><span class="id" title="constructor">gp_heap</span></a>: <span class="id" title="keyword">∀</span> <a id="ap:17" class="idref" href="#ap:17"><span class="id" title="binder">ap</span></a> <a id="new_bound:18" class="idref" href="#new_bound:18"><span class="id" title="binder">new_bound</span></a> <a id="diff:19" class="idref" href="#diff:19"><span class="id" title="binder">diff</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ap:17"><span class="id" title="variable">ap</span></a>.(<a class="idref" href="#ctx_heap_bound"><span class="id" title="projection">ctx_heap_bound</span></a>) <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <a class="idref" href="#diff:19"><span class="id" title="variable">diff</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#new_bound:18"><span class="id" title="variable">new_bound</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#grow_heap_page:15"><span class="id" title="inductive">grow_heap_page</span></a> <a class="idref" href="#diff:19"><span class="id" title="variable">diff</span></a> <a class="idref" href="#ap:17"><span class="id" title="variable">ap</span></a> (<a class="idref" href="#ap:17"><span class="id" title="variable">ap</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#ctx_heap_bound"><span class="id" title="projection">ctx_heap_bound</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#new_bound:18"><span class="id" title="variable">new_bound</span></a> <span class="id" title="notation">|></span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="grow_auxheap_page" class="idref" href="#grow_auxheap_page"><span class="id" title="inductive">grow_auxheap_page</span></a> : <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#mem_ctx"><span class="id" title="record">mem_ctx</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#mem_ctx"><span class="id" title="record">mem_ctx</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="gp_auxheap" class="idref" href="#gp_auxheap"><span class="id" title="constructor">gp_auxheap</span></a>: <span class="id" title="keyword">∀</span> <a id="ap:22" class="idref" href="#ap:22"><span class="id" title="binder">ap</span></a> <a id="new_bound:23" class="idref" href="#new_bound:23"><span class="id" title="binder">new_bound</span></a> <a id="diff:24" class="idref" href="#diff:24"><span class="id" title="binder">diff</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ap:22"><span class="id" title="variable">ap</span></a>.(<a class="idref" href="#ctx_auxheap_bound"><span class="id" title="projection">ctx_auxheap_bound</span></a>) <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <a class="idref" href="#diff:24"><span class="id" title="variable">diff</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#new_bound:23"><span class="id" title="variable">new_bound</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#grow_auxheap_page:20"><span class="id" title="inductive">grow_auxheap_page</span></a> <a class="idref" href="#diff:24"><span class="id" title="variable">diff</span></a> <a class="idref" href="#ap:22"><span class="id" title="variable">ap</span></a> (<a class="idref" href="#ap:22"><span class="id" title="variable">ap</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#ctx_auxheap_bound"><span class="id" title="projection">ctx_auxheap_bound</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#new_bound:23"><span class="id" title="variable">new_bound</span></a> <span class="id" title="notation">|></span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="grow_heap_variant" class="idref" href="#grow_heap_variant"><span class="id" title="inductive">grow_heap_variant</span></a>: <a class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#mem_ctx"><span class="id" title="record">mem_ctx</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#mem_ctx"><span class="id" title="record">mem_ctx</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="ghv_heap" class="idref" href="#ghv_heap"><span class="id" title="constructor">ghv_heap</span></a>: <span class="id" title="keyword">∀</span> <a id="diff:27" class="idref" href="#diff:27"><span class="id" title="binder">diff</span></a> <a id="ap:28" class="idref" href="#ap:28"><span class="id" title="binder">ap</span></a> <a id="ap':29" class="idref" href="#ap':29"><span class="id" title="binder">ap'</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#grow_heap_page"><span class="id" title="inductive">grow_heap_page</span></a> <a class="idref" href="#diff:27"><span class="id" title="variable">diff</span></a> <a class="idref" href="#ap:28"><span class="id" title="variable">ap</span></a> <a class="idref" href="#ap':29"><span class="id" title="variable">ap'</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#grow_heap_variant:25"><span class="id" title="inductive">grow_heap_variant</span></a> <a class="idref" href="#Heap"><span class="id" title="constructor">Heap</span></a> <a class="idref" href="#diff:27"><span class="id" title="variable">diff</span></a> <a class="idref" href="#ap:28"><span class="id" title="variable">ap</span></a> <a class="idref" href="#ap':29"><span class="id" title="variable">ap'</span></a><br/>
&nbsp;&nbsp;| <a id="ghv_auxheap" class="idref" href="#ghv_auxheap"><span class="id" title="constructor">ghv_auxheap</span></a>: <span class="id" title="keyword">∀</span> <a id="diff:30" class="idref" href="#diff:30"><span class="id" title="binder">diff</span></a> <a id="ap:31" class="idref" href="#ap:31"><span class="id" title="binder">ap</span></a> <a id="ap':32" class="idref" href="#ap':32"><span class="id" title="binder">ap'</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#grow_auxheap_page"><span class="id" title="inductive">grow_auxheap_page</span></a> <a class="idref" href="#diff:30"><span class="id" title="variable">diff</span></a> <a class="idref" href="#ap:31"><span class="id" title="variable">ap</span></a> <a class="idref" href="#ap':32"><span class="id" title="variable">ap'</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#grow_heap_variant:25"><span class="id" title="inductive">grow_heap_variant</span></a> <a class="idref" href="#AuxHeap"><span class="id" title="constructor">AuxHeap</span></a> <a class="idref" href="#diff:30"><span class="id" title="variable">diff</span></a> <a class="idref" href="#ap:31"><span class="id" title="variable">ap</span></a> <a class="idref" href="#ap':32"><span class="id" title="variable">ap'</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#MemoryContext"><span class="id" title="section">MemoryContext</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.PointerErasure</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Common</span></a> <a class="idref" href="#"><span class="id" title="library">Pointer</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a>.<br/>

<br/>
</div>

<div class="doc"><h1 id="pointer-erasure-since-v1.4.1">Pointer Erasure (since
v1.4.1)</h1>
<p>Recall that <span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span> contain four
fields:</p>
<pre><code>Record fat_ptr_layout := mk_fat_ptr_layout {
                              length: u32;
                              start: u32;
                              page: u32;
                              offset: u32;
                            }.</code></pre>
<p>In kernel mode, these fields are observable by all instructions, even
by those that work with integers.</p>
<p>In user mode, <span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span> are opaque: if an
instruction expects an integer (with a cleared <span
class="inlinecode"><a class="idref" href="#is_ptr"><span
class="id" title="projection">is_ptr</span></a></span> tag), and it is
provided a pointer instead (with a set <span
class="inlinecode"><a class="idref" href="#is_ptr"><span
class="id" title="projection">is_ptr</span></a></span> tag), the pointer
value is downcast to the integer before the instruction is able to
observe it.</p>
<p>The downcasting zeroes the fields <span
class="inlinecode"><a class="idref" href="#page"><span
class="id" title="projection">page</span></a></span> and <span
class="inlinecode"><a class="idref" href="#start"><span
class="id" title="projection">start</span></a></span>.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Section</span> <a id="PointerErasure" class="idref" href="#PointerErasure"><span class="id" title="section">PointerErasure</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="is_kernel_mode:1" class="idref" href="#is_kernel_mode:1"><span class="id" title="binder">is_kernel_mode</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="span_erase" class="idref" href="#span_erase"><span class="id" title="definition">span_erase</span></a> (<a id="s:2" class="idref" href="#s:2"><span class="id" title="binder">s</span></a>:<a class="idref" href="#span"><span class="id" title="record">span</span></a>) : <a class="idref" href="#span"><span class="id" title="record">span</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#PointerErasure.is_kernel_mode"><span class="id" title="variable">is_kernel_mode</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="#s:2"><span class="id" title="variable">s</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#s:2"><span class="id" title="variable">s</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_span"><span class="id" title="constructor">mk_span</span></a> <span class="id" title="var">start</span> <span class="id" title="var">len</span> ⇒ <a class="idref" href="#mk_span"><span class="id" title="constructor">mk_span</span></a> <span class="id" title="notation">#</span> 0 <span class="id" title="var">len</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="free_ptr_erase" class="idref" href="#free_ptr_erase"><span class="id" title="definition">free_ptr_erase</span></a> (<a id="fp:4" class="idref" href="#fp:4"><span class="id" title="binder">fp</span></a>: <a class="idref" href="#free_ptr"><span class="id" title="record">free_ptr</span></a>) : <a class="idref" href="#free_ptr"><span class="id" title="record">free_ptr</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#PointerErasure.is_kernel_mode"><span class="id" title="variable">is_kernel_mode</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="#fp:4"><span class="id" title="variable">fp</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#fp:4"><span class="id" title="variable">fp</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> <span class="id" title="var">s</span> <span class="id" title="var">ofs</span> ⇒ <a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> (<a class="idref" href="#span_erase"><span class="id" title="definition">span_erase</span></a> <span class="id" title="var">s</span>) <span class="id" title="var">ofs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="fat_ptr_erase" class="idref" href="#fat_ptr_erase"><span class="id" title="definition">fat_ptr_erase</span></a> (<a id="fp:6" class="idref" href="#fp:6"><span class="id" title="binder">fp</span></a>:<a class="idref" href="#fat_ptr"><span class="id" title="record">fat_ptr</span></a>) : <a class="idref" href="#fat_ptr"><span class="id" title="record">fat_ptr</span></a>:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#PointerErasure.is_kernel_mode"><span class="id" title="variable">is_kernel_mode</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="#fp:6"><span class="id" title="variable">fp</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#fp:6"><span class="id" title="variable">fp</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_fat_ptr"><span class="id" title="constructor">mk_fat_ptr</span></a> <span class="id" title="var">page</span> <span class="id" title="var">ptr</span> ⇒ <a class="idref" href="#mk_fat_ptr"><span class="id" title="constructor">mk_fat_ptr</span></a> 0%<span class="id" title="var">nat</span> (<a class="idref" href="#free_ptr_erase"><span class="id" title="definition">free_ptr_erase</span></a> <span class="id" title="var">ptr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="fat_ptr_nullable_erase" class="idref" href="#fat_ptr_nullable_erase"><span class="id" title="definition">fat_ptr_nullable_erase</span></a> (<a id="fp:8" class="idref" href="#fp:8"><span class="id" title="binder">fp</span></a>:<a class="idref" href="#fat_ptr_nullable"><span class="id" title="inductive">fat_ptr_nullable</span></a>) : <a class="idref" href="#fat_ptr_nullable"><span class="id" title="inductive">fat_ptr_nullable</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#PointerErasure.is_kernel_mode"><span class="id" title="variable">is_kernel_mode</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="#fp:8"><span class="id" title="variable">fp</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#fp:8"><span class="id" title="variable">fp</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#NullPtr"><span class="id" title="constructor">NullPtr</span></a> ⇒ <a class="idref" href="#NullPtr"><span class="id" title="constructor">NullPtr</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <span class="id" title="var">fp</span> ⇒ <a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> (<a class="idref" href="#fat_ptr_erase"><span class="id" title="definition">fat_ptr_erase</span></a> <a class="idref" href="#fp:8"><span class="id" title="variable">fp</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#PointerErasure"><span class="id" title="section">PointerErasure</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.Binding</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">RecordSetNotations</span>.<br/>
<span class="id" title="keyword">Require</span><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">ABI</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">Addressing</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">CallStack</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">Core</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">Coder</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">GPR</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">isa.CoreSet</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">Pointer</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">PointerErasure</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">PrimitiveValue</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">State</span></a>.<br/>
<span class="id" title="keyword">Import</span><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">ABI</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">FatPointerABI</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Addressing</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Coercions"><span class="id" title="module">Addressing.Coercions</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">CallStack</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Coder</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Core</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">GPR</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">MemoryOps</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Pointer</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">PointerErasure</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">State</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Types</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="OperandBinding" class="idref" href="#OperandBinding"><span class="id" title="section">OperandBinding</span></a>.<br/>

<br/>
</div>

<div class="doc"><h1 id="binding-operands-in-core-instructions">Binding operands in core
instructions</h1>
<p>The instructions from <span
class="inlinecode"><a class="idref" href="#CoreInstructionSet"><span
class="id" title="section">CoreInstructionSet</span></a></span> are
parameterized with an instance of <span
class="inlinecode"><a class="idref" href="#descr"><span
class="id" title="record">descr</span></a></span>, specifying the exact
types of their operands. This allows for <span
class="inlinecode"><a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span> definition to
be reused:</p>
<ul>
<li>the <span
class="inlinecode"><a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span> <span
class="inlinecode"><a class="idref" href="#decoded"><span
class="id" title="definition">decoded</span></a></span> are instructions
decoded from <span class="inlinecode"><span class="id"
title="var">Assembly.asm_instruction</span></span>. They contain
descriptions of operand sources and destinations, e.g. register or
various memory locations.</li>
<li>the <span
class="inlinecode"><a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span> <span
class="inlinecode"><a class="idref" href="#bound"><span
class="id" title="definition">bound</span></a></span> are instructions
that contain the values fetched, stored, and with decoding/encoding
already performed. It allows to bind these values equationally inside
the spec clauses such as <span
class="inlinecode"><a class="idref" href="#step_add"><span
class="id" title="inductive">step_add</span></a></span>.</li>
</ul>
<p>The rest of this section is technical; refer to <span
class="inlinecode"><a class="idref" href="#bind_fat_ptr"><span
class="id" title="inductive">bind_fat_ptr</span></a></span> and similar
predicates to see how the compound instruction arguments are encoded and
decoded for small step relations, e.g. <span
class="inlinecode"><a class="idref" href="#step_ptradd"><span
class="id" title="inductive">step_ptradd</span></a></span> for <span
class="inlinecode"><a class="idref" href="#OpPtrAdd"><span
class="id" title="constructor">OpPtrAdd</span></a></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;#[<span class="id" title="var">global</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Canonical</span> <span class="id" title="keyword">Structure</span> <a id="bound" class="idref" href="#bound"><span class="id" title="definition">bound</span></a>: <a class="idref" href="#descr"><span class="id" title="record">descr</span></a> :=<br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#src_pv"><span class="id" title="projection">src_pv</span></a> := @<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> <a class="idref" href="#word"><span class="id" title="definition">Core.word</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#src_fat_ptr"><span class="id" title="projection">src_fat_ptr</span></a> := <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (@<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> (<a class="idref" href="#u128"><span class="id" title="definition">u128</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#fat_ptr_nullable"><span class="id" title="inductive">fat_ptr_nullable</span></a>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#src_heap_ptr"><span class="id" title="projection">src_heap_ptr</span></a> := <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (@<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> (<a class="idref" href="#u224"><span class="id" title="definition">u224</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#heap_ptr"><span class="id" title="record">heap_ptr</span></a>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#src_farcall_params"><span class="id" title="projection">src_farcall_params</span></a> := <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (@<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> <a class="idref" href="#params"><span class="id" title="record">FarCallABI.params</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#src_nearcall_params"><span class="id" title="projection">src_nearcall_params</span></a> := <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (@<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> (<a class="idref" href="#u224"><span class="id" title="definition">u224</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#params"><span class="id" title="record">NearCallABI.params</span></a>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#src_ret_params"><span class="id" title="projection">src_ret_params</span></a> := <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (@<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> <a class="idref" href="#params"><span class="id" title="record">FarRetABI.params</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#src_precompile_params"><span class="id" title="projection">src_precompile_params</span></a> := <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (@<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> <a class="idref" href="#params"><span class="id" title="record">PrecompileParametersABI.params</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#dest_pv"><span class="id" title="projection">dest_pv</span></a> := @<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> <a class="idref" href="#word"><span class="id" title="definition">Core.word</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#dest_heap_ptr"><span class="id" title="projection">dest_heap_ptr</span></a> := <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (@<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> (<a class="idref" href="#u224"><span class="id" title="definition">u224</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#heap_ptr"><span class="id" title="record">heap_ptr</span></a>) );<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#dest_fat_ptr"><span class="id" title="projection">dest_fat_ptr</span></a> := <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (@<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> (<a class="idref" href="#u128"><span class="id" title="definition">u128</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#fat_ptr_nullable"><span class="id" title="inductive">fat_ptr_nullable</span></a>) );<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#dest_meta_params"><span class="id" title="projection">dest_meta_params</span></a> := <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (@<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> (<a class="idref" href="#params"><span class="id" title="record">MetaParametersABI.params</span></a> ));<br/>
&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;.<br/>

<br/>
</div>

<div class="doc"><p>Knowing the call stack, memory pages and registers are enough to bind
any value appearing in <span
class="inlinecode"><a class="idref" href="#CoreInstructionSet"><span
class="id" title="section">CoreInstructionSet</span></a></span>;
additionally, kernel mode affects it: pointer erasure only happens in
user mode.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="binding_state" class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> := <span class="id" title="var">mk_bind_st</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="bs_is_kernel_mode" class="idref" href="#bs_is_kernel_mode"><span class="id" title="projection">bs_is_kernel_mode</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="bs_cs" class="idref" href="#bs_cs"><span class="id" title="projection">bs_cs</span></a>: <a class="idref" href="#callstack"><span class="id" title="definition">State.callstack</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="bs_regs" class="idref" href="#bs_regs"><span class="id" title="projection">bs_regs</span></a>: <a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="bs_mem" class="idref" href="#bs_mem"><span class="id" title="projection">bs_mem</span></a>: <a class="idref" href="#memory"><span class="id" title="definition">State.memory</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="bind_any_src" class="idref" href="#bind_any_src"><span class="id" title="inductive">bind_any_src</span></a>: <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> @<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="bind_any_src_apply" class="idref" href="#bind_any_src_apply"><span class="id" title="constructor">bind_any_src_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="regs:8" class="idref" href="#regs:8"><span class="id" title="binder">regs</span></a> (<a id="mem:9" class="idref" href="#mem:9"><span class="id" title="binder">mem</span></a>:<a class="idref" href="#memory"><span class="id" title="definition">State.memory</span></a>) (<a id="cs:10" class="idref" href="#cs:10"><span class="id" title="binder">cs</span></a> <a id="cs':11" class="idref" href="#cs':11"><span class="id" title="binder">cs'</span></a>:<a class="idref" href="#callstack"><span class="id" title="definition">State.callstack</span></a>) (<a id="op:12" class="idref" href="#op:12"><span class="id" title="binder">op</span></a>:<a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) (<a id="v:13" class="idref" href="#v:13"><span class="id" title="binder">v</span></a>:@<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a>) (<a id="is_k:14" class="idref" href="#is_k:14"><span class="id" title="binder">is_k</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#load"><span class="id" title="inductive">load</span></a> <span class="id" title="var">_</span> <a class="idref" href="#regs:8"><span class="id" title="variable">regs</span></a> <a class="idref" href="#cs:10"><span class="id" title="variable">cs</span></a> <a class="idref" href="#mem:9"><span class="id" title="variable">mem</span></a> <a class="idref" href="#op:12"><span class="id" title="variable">op</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#cs':11"><span class="id" title="variable">cs'</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#v:13"><span class="id" title="variable">v</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_any_src:6"><span class="id" title="inductive">bind_any_src</span></a> (<a class="idref" href="#mk_bind_st"><span class="id" title="constructor">mk_bind_st</span></a> <a class="idref" href="#is_k:14"><span class="id" title="variable">is_k</span></a> <a class="idref" href="#cs:10"><span class="id" title="variable">cs</span></a> <a class="idref" href="#regs:8"><span class="id" title="variable">regs</span></a> <a class="idref" href="#mem:9"><span class="id" title="variable">mem</span></a>) (<a class="idref" href="#mk_bind_st"><span class="id" title="constructor">mk_bind_st</span></a> <a class="idref" href="#is_k:14"><span class="id" title="variable">is_k</span></a> <a class="idref" href="#cs':11"><span class="id" title="variable">cs'</span></a> <a class="idref" href="#regs:8"><span class="id" title="variable">regs</span></a> <a class="idref" href="#mem:9"><span class="id" title="variable">mem</span></a>) <a class="idref" href="#op:12"><span class="id" title="variable">op</span></a> <a class="idref" href="#v:13"><span class="id" title="variable">v</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>To bind a <span
class="inlinecode"><a class="idref" href="#src_pv"><span
class="id" title="projection">src_pv</span></a></span> type of
instruction operand, load its value and apply the effects of <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span> addressing
mode. Additionally, if the instruction expects an integer, but gets a
pointer with a tag, the pointer erasure happens (since v.1.4.1).</p>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="bind_src" class="idref" href="#bind_src"><span class="id" title="inductive">bind_src</span></a>: <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> @<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="bind_src_int_apply" class="idref" href="#bind_src_int_apply"><span class="id" title="constructor">bind_src_int_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="regs:17" class="idref" href="#regs:17"><span class="id" title="binder">regs</span></a> (<a id="mem:18" class="idref" href="#mem:18"><span class="id" title="binder">mem</span></a>:<a class="idref" href="#memory"><span class="id" title="definition">State.memory</span></a>) (<a id="cs:19" class="idref" href="#cs:19"><span class="id" title="binder">cs</span></a> <a id="cs':20" class="idref" href="#cs':20"><span class="id" title="binder">cs'</span></a>:<a class="idref" href="#callstack"><span class="id" title="definition">State.callstack</span></a>) (<a id="op:21" class="idref" href="#op:21"><span class="id" title="binder">op</span></a>:<a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) (<a id="v:22" class="idref" href="#v:22"><span class="id" title="binder">v</span></a>:<a class="idref" href="#word"><span class="id" title="definition">word</span></a>) (<a id="is_k:23" class="idref" href="#is_k:23"><span class="id" title="binder">is_k</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_any_src"><span class="id" title="inductive">bind_any_src</span></a> (<a class="idref" href="#mk_bind_st"><span class="id" title="constructor">mk_bind_st</span></a> <a class="idref" href="#is_k:23"><span class="id" title="variable">is_k</span></a> <a class="idref" href="#cs:19"><span class="id" title="variable">cs</span></a> <a class="idref" href="#regs:17"><span class="id" title="variable">regs</span></a> <a class="idref" href="#mem:18"><span class="id" title="variable">mem</span></a>) (<a class="idref" href="#mk_bind_st"><span class="id" title="constructor">mk_bind_st</span></a> <a class="idref" href="#is_k:23"><span class="id" title="variable">is_k</span></a> <a class="idref" href="#cs':20"><span class="id" title="variable">cs'</span></a> <a class="idref" href="#regs:17"><span class="id" title="variable">regs</span></a> <a class="idref" href="#mem:18"><span class="id" title="variable">mem</span></a>) <a class="idref" href="#op:21"><span class="id" title="variable">op</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#v:22"><span class="id" title="variable">v</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_src:15"><span class="id" title="inductive">bind_src</span></a> (<a class="idref" href="#mk_bind_st"><span class="id" title="constructor">mk_bind_st</span></a> <a class="idref" href="#is_k:23"><span class="id" title="variable">is_k</span></a> <a class="idref" href="#cs:19"><span class="id" title="variable">cs</span></a> <a class="idref" href="#regs:17"><span class="id" title="variable">regs</span></a> <a class="idref" href="#mem:18"><span class="id" title="variable">mem</span></a>) (<a class="idref" href="#mk_bind_st"><span class="id" title="constructor">mk_bind_st</span></a> <a class="idref" href="#is_k:23"><span class="id" title="variable">is_k</span></a> <a class="idref" href="#cs':20"><span class="id" title="variable">cs'</span></a> <a class="idref" href="#regs:17"><span class="id" title="variable">regs</span></a> <a class="idref" href="#mem:18"><span class="id" title="variable">mem</span></a>) <a class="idref" href="#op:21"><span class="id" title="variable">op</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#v:22"><span class="id" title="variable">v</span></a>)<br/>
<br/>
&nbsp;&nbsp;| <a id="bind_src_ptr_apply" class="idref" href="#bind_src_ptr_apply"><span class="id" title="constructor">bind_src_ptr_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="regs:24" class="idref" href="#regs:24"><span class="id" title="binder">regs</span></a> (<a id="mem:25" class="idref" href="#mem:25"><span class="id" title="binder">mem</span></a>:<a class="idref" href="#memory"><span class="id" title="definition">State.memory</span></a>) (<a id="cs:26" class="idref" href="#cs:26"><span class="id" title="binder">cs</span></a> <a id="cs':27" class="idref" href="#cs':27"><span class="id" title="binder">cs'</span></a>:<a class="idref" href="#callstack"><span class="id" title="definition">State.callstack</span></a>) (<a id="op:28" class="idref" href="#op:28"><span class="id" title="binder">op</span></a>:<a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) (<a id="v:29" class="idref" href="#v:29"><span class="id" title="binder">v</span></a> <a id="v':30" class="idref" href="#v':30"><span class="id" title="binder">v'</span></a>:<a class="idref" href="#word"><span class="id" title="definition">word</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="decoded:31" class="idref" href="#decoded:31"><span class="id" title="binder">decoded</span></a> <a id="decoded_erased:32" class="idref" href="#decoded_erased:32"><span class="id" title="binder">decoded_erased</span></a>: <a class="idref" href="#fat_ptr_nullable"><span class="id" title="inductive">fat_ptr_nullable</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="encoded_erased:33" class="idref" href="#encoded_erased:33"><span class="id" title="binder">encoded_erased</span></a> <a id="high128:34" class="idref" href="#high128:34"><span class="id" title="binder">high128</span></a>: <a class="idref" href="#u128"><span class="id" title="definition">u128</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="is_k:35" class="idref" href="#is_k:35"><span class="id" title="binder">is_k</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_any_src"><span class="id" title="inductive">bind_any_src</span></a> (<a class="idref" href="#mk_bind_st"><span class="id" title="constructor">mk_bind_st</span></a> <a class="idref" href="#is_k:35"><span class="id" title="variable">is_k</span></a> <a class="idref" href="#cs:26"><span class="id" title="variable">cs</span></a> <a class="idref" href="#regs:24"><span class="id" title="variable">regs</span></a> <a class="idref" href="#mem:25"><span class="id" title="variable">mem</span></a>) (<a class="idref" href="#mk_bind_st"><span class="id" title="constructor">mk_bind_st</span></a> <a class="idref" href="#is_k:35"><span class="id" title="variable">is_k</span></a> <a class="idref" href="#cs':27"><span class="id" title="variable">cs'</span></a> <a class="idref" href="#regs:24"><span class="id" title="variable">regs</span></a> <a class="idref" href="#mem:25"><span class="id" title="variable">mem</span></a>) <a class="idref" href="#op:28"><span class="id" title="variable">op</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#v:29"><span class="id" title="variable">v</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high128:34"><span class="id" title="variable">high128</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#decoded:31"><span class="id" title="variable">decoded</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#decode_fat_ptr_word"><span class="id" title="definition">decode_fat_ptr_word</span></a> <a class="idref" href="#v:29"><span class="id" title="variable">v</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#decoded_erased:32"><span class="id" title="variable">decoded_erased</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#fat_ptr_nullable_erase"><span class="id" title="definition">fat_ptr_nullable_erase</span></a> <a class="idref" href="#is_k:35"><span class="id" title="variable">is_k</span></a> <a class="idref" href="#decoded:31"><span class="id" title="variable">decoded</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#encoded_erased:33"><span class="id" title="variable">encoded_erased</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#encode_fat_ptr"><span class="id" title="definition">encode_fat_ptr</span></a> <a class="idref" href="#decoded:31"><span class="id" title="variable">decoded</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#v':30"><span class="id" title="variable">v'</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#high128:34"><span class="id" title="variable">high128</span></a> <span class="id" title="notation">##</span> <a class="idref" href="#encoded_erased:33"><span class="id" title="variable">encoded_erased</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_src:15"><span class="id" title="inductive">bind_src</span></a> (<a class="idref" href="#mk_bind_st"><span class="id" title="constructor">mk_bind_st</span></a> <a class="idref" href="#is_k:35"><span class="id" title="variable">is_k</span></a> <a class="idref" href="#cs:26"><span class="id" title="variable">cs</span></a> <a class="idref" href="#regs:24"><span class="id" title="variable">regs</span></a> <a class="idref" href="#mem:25"><span class="id" title="variable">mem</span></a>) (<a class="idref" href="#mk_bind_st"><span class="id" title="constructor">mk_bind_st</span></a> <a class="idref" href="#is_k:35"><span class="id" title="variable">is_k</span></a> <a class="idref" href="#cs':27"><span class="id" title="variable">cs'</span></a> <a class="idref" href="#regs:24"><span class="id" title="variable">regs</span></a> <a class="idref" href="#mem:25"><span class="id" title="variable">mem</span></a>) <a class="idref" href="#op:28"><span class="id" title="variable">op</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#v':30"><span class="id" title="variable">v'</span></a>)<br/>
&nbsp;&nbsp;.<br/>

<br/>
</div>

<div class="doc"><p>To bind a <span
class="inlinecode"><a class="idref" href="#dest_pv"><span
class="id" title="projection">dest_pv</span></a></span> type of
instruction operand, store its value and apply the effects of <span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span> addressing
mode.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="bind_dest" class="idref" href="#bind_dest"><span class="id" title="inductive">bind_dest</span></a>: <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a>  <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="bind_dest_apply" class="idref" href="#bind_dest_apply"><span class="id" title="constructor">bind_dest_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="regs:38" class="idref" href="#regs:38"><span class="id" title="binder">regs</span></a> <a id="mem:39" class="idref" href="#mem:39"><span class="id" title="binder">mem</span></a> <a id="cs:40" class="idref" href="#cs:40"><span class="id" title="binder">cs</span></a> <a id="regs':41" class="idref" href="#regs':41"><span class="id" title="binder">regs'</span></a> <a id="mem':42" class="idref" href="#mem':42"><span class="id" title="binder">mem'</span></a> <a id="cs':43" class="idref" href="#cs':43"><span class="id" title="binder">cs'</span></a> <a id="op:44" class="idref" href="#op:44"><span class="id" title="binder">op</span></a> <a id="val:45" class="idref" href="#val:45"><span class="id" title="binder">val</span></a> <a id="is_k:46" class="idref" href="#is_k:46"><span class="id" title="binder">is_k</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store"><span class="id" title="inductive">store</span></a> <span class="id" title="var">_</span> <a class="idref" href="#regs:38"><span class="id" title="variable">regs</span></a> <a class="idref" href="#cs:40"><span class="id" title="variable">cs</span></a> <a class="idref" href="#mem:39"><span class="id" title="variable">mem</span></a> <a class="idref" href="#op:44"><span class="id" title="variable">op</span></a> <a class="idref" href="#val:45"><span class="id" title="variable">val</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#regs':41"><span class="id" title="variable">regs'</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#mem':42"><span class="id" title="variable">mem'</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#cs':43"><span class="id" title="variable">cs'</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_dest:36"><span class="id" title="inductive">bind_dest</span></a> (<a class="idref" href="#mk_bind_st"><span class="id" title="constructor">mk_bind_st</span></a> <a class="idref" href="#is_k:46"><span class="id" title="variable">is_k</span></a> <a class="idref" href="#cs:40"><span class="id" title="variable">cs</span></a> <a class="idref" href="#regs:38"><span class="id" title="variable">regs</span></a> <a class="idref" href="#mem:39"><span class="id" title="variable">mem</span></a>) (<a class="idref" href="#mk_bind_st"><span class="id" title="constructor">mk_bind_st</span></a> <a class="idref" href="#is_k:46"><span class="id" title="variable">is_k</span></a> <a class="idref" href="#cs':43"><span class="id" title="variable">cs'</span></a> <a class="idref" href="#regs':41"><span class="id" title="variable">regs'</span></a> <a class="idref" href="#mem':42"><span class="id" title="variable">mem'</span></a>) <a class="idref" href="#op:44"><span class="id" title="variable">op</span></a> <a class="idref" href="#val:45"><span class="id" title="variable">val</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>To bind <span
class="inlinecode"><a class="idref" href="#src_fat_ptr"><span
class="id" title="projection">src_fat_ptr</span></a></span> or any other
compound value encoded in a binary form, bind both the encoded and
decoded value.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="bind_fat_ptr" class="idref" href="#bind_fat_ptr"><span class="id" title="inductive">bind_fat_ptr</span></a>: <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (@<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> (<a class="idref" href="#u128"><span class="id" title="definition">u128</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#fat_ptr_nullable"><span class="id" title="inductive">fat_ptr_nullable</span></a>)) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="bind_fat_ptr_apply" class="idref" href="#bind_fat_ptr_apply"><span class="id" title="constructor">bind_fat_ptr_apply</span></a> : <span class="id" title="keyword">∀</span> <a id="op:49" class="idref" href="#op:49"><span class="id" title="binder">op</span></a> <a id="v:50" class="idref" href="#v:50"><span class="id" title="binder">v</span></a> <a id="s:51" class="idref" href="#s:51"><span class="id" title="binder">s</span></a> <a id="s':52" class="idref" href="#s':52"><span class="id" title="binder">s'</span></a> <a id="decoded:53" class="idref" href="#decoded:53"><span class="id" title="binder">decoded</span></a> <a id="high128:54" class="idref" href="#high128:54"><span class="id" title="binder">high128</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_src"><span class="id" title="inductive">bind_src</span></a> <a class="idref" href="#s:51"><span class="id" title="variable">s</span></a> <a class="idref" href="#s':52"><span class="id" title="variable">s'</span></a> <a class="idref" href="#op:49"><span class="id" title="variable">op</span></a> <a class="idref" href="#v:50"><span class="id" title="variable">v</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high128:54"><span class="id" title="variable">high128</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#decoded:53"><span class="id" title="variable">decoded</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#decode_fat_ptr_word"><span class="id" title="definition">decode_fat_ptr_word</span></a> <a class="idref" href="#v:50"><span class="id" title="variable">v</span></a>.(<a class="idref" href="#value"><span class="id" title="projection">value</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_fat_ptr:47"><span class="id" title="inductive">bind_fat_ptr</span></a> <a class="idref" href="#s:51"><span class="id" title="variable">s</span></a> <a class="idref" href="#s':52"><span class="id" title="variable">s'</span></a> <a class="idref" href="#op:49"><span class="id" title="variable">op</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high128:54"><span class="id" title="variable">high128</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#decoded:53"><span class="id" title="variable">decoded</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>))<br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="bind_heap_ptr" class="idref" href="#bind_heap_ptr"><span class="id" title="inductive">bind_heap_ptr</span></a>: <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (@<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> (<a class="idref" href="#u224"><span class="id" title="definition">u224</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#heap_ptr"><span class="id" title="record">heap_ptr</span></a>)) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="bind_heap_ptr_apply" class="idref" href="#bind_heap_ptr_apply"><span class="id" title="constructor">bind_heap_ptr_apply</span></a> : <span class="id" title="keyword">∀</span> <a id="op:57" class="idref" href="#op:57"><span class="id" title="binder">op</span></a> <a id="v:58" class="idref" href="#v:58"><span class="id" title="binder">v</span></a> <a id="s:59" class="idref" href="#s:59"><span class="id" title="binder">s</span></a> <a id="s':60" class="idref" href="#s':60"><span class="id" title="binder">s'</span></a> <a id="decoded:61" class="idref" href="#decoded:61"><span class="id" title="binder">decoded</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_src"><span class="id" title="inductive">bind_src</span></a> <a class="idref" href="#s:59"><span class="id" title="variable">s</span></a> <a class="idref" href="#s':60"><span class="id" title="variable">s'</span></a> <a class="idref" href="#op:57"><span class="id" title="variable">op</span></a> <a class="idref" href="#v:58"><span class="id" title="variable">v</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#decoded:61"><span class="id" title="variable">decoded</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#decode_heap_ptr"><span class="id" title="definition">decode_heap_ptr</span></a> <a class="idref" href="#v:58"><span class="id" title="variable">v</span></a>.(<a class="idref" href="#value"><span class="id" title="projection">value</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_heap_ptr:55"><span class="id" title="inductive">bind_heap_ptr</span></a> <a class="idref" href="#s:59"><span class="id" title="variable">s</span></a> <a class="idref" href="#s':60"><span class="id" title="variable">s'</span></a> <a class="idref" href="#op:57"><span class="id" title="variable">op</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#decoded:61"><span class="id" title="variable">decoded</span></a>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="bind_farcall_params" class="idref" href="#bind_farcall_params"><span class="id" title="inductive">bind_farcall_params</span></a>: <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (@<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> <a class="idref" href="#params"><span class="id" title="record">FarCallABI.params</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="bind_farcall_params_apply" class="idref" href="#bind_farcall_params_apply"><span class="id" title="constructor">bind_farcall_params_apply</span></a> : <span class="id" title="keyword">∀</span> <a id="op:64" class="idref" href="#op:64"><span class="id" title="binder">op</span></a> <a id="v:65" class="idref" href="#v:65"><span class="id" title="binder">v</span></a> <a id="s:66" class="idref" href="#s:66"><span class="id" title="binder">s</span></a> <a id="s':67" class="idref" href="#s':67"><span class="id" title="binder">s'</span></a> <a id="decoded:68" class="idref" href="#decoded:68"><span class="id" title="binder">decoded</span></a> <a id="tag:69" class="idref" href="#tag:69"><span class="id" title="binder">tag</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_src"><span class="id" title="inductive">bind_src</span></a> <a class="idref" href="#s:66"><span class="id" title="variable">s</span></a> <a class="idref" href="#s':67"><span class="id" title="variable">s'</span></a> <a class="idref" href="#op:64"><span class="id" title="variable">op</span></a> <a class="idref" href="#v:65"><span class="id" title="variable">v</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#decoded:68"><span class="id" title="variable">decoded</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#coder"><span class="id" title="definition">FarCallABI.coder</span></a>.(<a class="idref" href="#decode"><span class="id" title="projection">decode</span></a>) <a class="idref" href="#v:65"><span class="id" title="variable">v</span></a>.(<a class="idref" href="#value"><span class="id" title="projection">value</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_farcall_params:62"><span class="id" title="inductive">bind_farcall_params</span></a> <a class="idref" href="#s:66"><span class="id" title="variable">s</span></a> <a class="idref" href="#s':67"><span class="id" title="variable">s'</span></a> <a class="idref" href="#op:64"><span class="id" title="variable">op</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#tag:69"><span class="id" title="variable">tag</span></a> (<a class="idref" href="#decoded:68"><span class="id" title="variable">decoded</span></a>)))<br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="bind_nearcall_params" class="idref" href="#bind_nearcall_params"><span class="id" title="inductive">bind_nearcall_params</span></a>: <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (@<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> (<a class="idref" href="#u224"><span class="id" title="definition">u224</span></a><a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#params"><span class="id" title="record">NearCallABI.params</span></a>)) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="bind_nearcall_params_apply" class="idref" href="#bind_nearcall_params_apply"><span class="id" title="constructor">bind_nearcall_params_apply</span></a> : <span class="id" title="keyword">∀</span> <a id="op:72" class="idref" href="#op:72"><span class="id" title="binder">op</span></a> <a id="v:73" class="idref" href="#v:73"><span class="id" title="binder">v</span></a> <a id="s:74" class="idref" href="#s:74"><span class="id" title="binder">s</span></a> <a id="s':75" class="idref" href="#s':75"><span class="id" title="binder">s'</span></a> <a id="decoded:76" class="idref" href="#decoded:76"><span class="id" title="binder">decoded</span></a> <a id="tag:77" class="idref" href="#tag:77"><span class="id" title="binder">tag</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_src"><span class="id" title="inductive">bind_src</span></a> <a class="idref" href="#s:74"><span class="id" title="variable">s</span></a> <a class="idref" href="#s':75"><span class="id" title="variable">s'</span></a> <a class="idref" href="#op:72"><span class="id" title="variable">op</span></a> <a class="idref" href="#v:73"><span class="id" title="variable">v</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#decoded:76"><span class="id" title="variable">decoded</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#decode_word"><span class="id" title="definition">NearCallABI.decode_word</span></a> <a class="idref" href="#v:73"><span class="id" title="variable">v</span></a>.(<a class="idref" href="#value"><span class="id" title="projection">value</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_nearcall_params:70"><span class="id" title="inductive">bind_nearcall_params</span></a> <a class="idref" href="#s:74"><span class="id" title="variable">s</span></a> <a class="idref" href="#s':75"><span class="id" title="variable">s'</span></a> <a class="idref" href="#op:72"><span class="id" title="variable">op</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#tag:77"><span class="id" title="variable">tag</span></a> <a class="idref" href="#decoded:76"><span class="id" title="variable">decoded</span></a>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="bind_farret_params" class="idref" href="#bind_farret_params"><span class="id" title="inductive">bind_farret_params</span></a>: <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (@<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> <a class="idref" href="#params"><span class="id" title="record">FarRetABI.params</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="bind_farret_params_apply" class="idref" href="#bind_farret_params_apply"><span class="id" title="constructor">bind_farret_params_apply</span></a> : <span class="id" title="keyword">∀</span> <a id="op:80" class="idref" href="#op:80"><span class="id" title="binder">op</span></a> <a id="v:81" class="idref" href="#v:81"><span class="id" title="binder">v</span></a> <a id="s:82" class="idref" href="#s:82"><span class="id" title="binder">s</span></a> <a id="s':83" class="idref" href="#s':83"><span class="id" title="binder">s'</span></a> <a id="decoded:84" class="idref" href="#decoded:84"><span class="id" title="binder">decoded</span></a> <a id="tag:85" class="idref" href="#tag:85"><span class="id" title="binder">tag</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_src"><span class="id" title="inductive">bind_src</span></a> <a class="idref" href="#s:82"><span class="id" title="variable">s</span></a> <a class="idref" href="#s':83"><span class="id" title="variable">s'</span></a> <a class="idref" href="#op:80"><span class="id" title="variable">op</span></a> <a class="idref" href="#v:81"><span class="id" title="variable">v</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#decoded:84"><span class="id" title="variable">decoded</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#coder"><span class="id" title="definition">FarRetABI.coder</span></a>.(<a class="idref" href="#decode"><span class="id" title="projection">decode</span></a>) <a class="idref" href="#v:81"><span class="id" title="variable">v</span></a>.(<a class="idref" href="#value"><span class="id" title="projection">value</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_farret_params:78"><span class="id" title="inductive">bind_farret_params</span></a> <a class="idref" href="#s:82"><span class="id" title="variable">s</span></a> <a class="idref" href="#s':83"><span class="id" title="variable">s'</span></a> <a class="idref" href="#op:80"><span class="id" title="variable">op</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#tag:85"><span class="id" title="variable">tag</span></a> <a class="idref" href="#decoded:84"><span class="id" title="variable">decoded</span></a>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="bind_precompile_params" class="idref" href="#bind_precompile_params"><span class="id" title="inductive">bind_precompile_params</span></a>: <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (@<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> <a class="idref" href="#params"><span class="id" title="record">PrecompileParametersABI.params</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="bind_precompile_params_apply" class="idref" href="#bind_precompile_params_apply"><span class="id" title="constructor">bind_precompile_params_apply</span></a> : <span class="id" title="keyword">∀</span> <a id="op:88" class="idref" href="#op:88"><span class="id" title="binder">op</span></a> <a id="v:89" class="idref" href="#v:89"><span class="id" title="binder">v</span></a> <a id="s:90" class="idref" href="#s:90"><span class="id" title="binder">s</span></a> <a id="s':91" class="idref" href="#s':91"><span class="id" title="binder">s'</span></a> <a id="decoded:92" class="idref" href="#decoded:92"><span class="id" title="binder">decoded</span></a> <a id="tag:93" class="idref" href="#tag:93"><span class="id" title="binder">tag</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_src"><span class="id" title="inductive">bind_src</span></a> <a class="idref" href="#s:90"><span class="id" title="variable">s</span></a> <a class="idref" href="#s':91"><span class="id" title="variable">s'</span></a> <a class="idref" href="#op:88"><span class="id" title="variable">op</span></a> <a class="idref" href="#v:89"><span class="id" title="variable">v</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#decoded:92"><span class="id" title="variable">decoded</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ABI"><span class="id" title="axiom">PrecompileParametersABI.ABI</span></a>.(<a class="idref" href="#decode"><span class="id" title="projection">decode</span></a>) <a class="idref" href="#v:89"><span class="id" title="variable">v</span></a>.(<a class="idref" href="#value"><span class="id" title="projection">value</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_precompile_params:86"><span class="id" title="inductive">bind_precompile_params</span></a> <a class="idref" href="#s:90"><span class="id" title="variable">s</span></a> <a class="idref" href="#s':91"><span class="id" title="variable">s'</span></a> <a class="idref" href="#op:88"><span class="id" title="variable">op</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#tag:93"><span class="id" title="variable">tag</span></a> <a class="idref" href="#decoded:92"><span class="id" title="variable">decoded</span></a>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="bind_dest_fat_ptr" class="idref" href="#bind_dest_fat_ptr"><span class="id" title="inductive">bind_dest_fat_ptr</span></a>: <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (@<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> (<a class="idref" href="#u128"><span class="id" title="definition">u128</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#fat_ptr_nullable"><span class="id" title="inductive">fat_ptr_nullable</span></a>) ) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="bind_dest_fat_ptr_apply" class="idref" href="#bind_dest_fat_ptr_apply"><span class="id" title="constructor">bind_dest_fat_ptr_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="s:96" class="idref" href="#s:96"><span class="id" title="binder">s</span></a> <a id="s':97" class="idref" href="#s':97"><span class="id" title="binder">s'</span></a> <a id="op:98" class="idref" href="#op:98"><span class="id" title="binder">op</span></a> <a id="encoded:99" class="idref" href="#encoded:99"><span class="id" title="binder">encoded</span></a> <a id="ptr:100" class="idref" href="#ptr:100"><span class="id" title="binder">ptr</span></a> (<a id="high128:101" class="idref" href="#high128:101"><span class="id" title="binder">high128</span></a>:<a class="idref" href="#u128"><span class="id" title="definition">u128</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_dest"><span class="id" title="inductive">bind_dest</span></a> <a class="idref" href="#s:96"><span class="id" title="variable">s</span></a> <a class="idref" href="#s':97"><span class="id" title="variable">s'</span></a> <a class="idref" href="#op:98"><span class="id" title="variable">op</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#encoded:99"><span class="id" title="variable">encoded</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#encode_fat_ptr_word"><span class="id" title="definition">encode_fat_ptr_word</span></a> <a class="idref" href="#high128:101"><span class="id" title="variable">high128</span></a> <a class="idref" href="#ptr:100"><span class="id" title="variable">ptr</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#encoded:99"><span class="id" title="variable">encoded</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_dest_fat_ptr:94"><span class="id" title="inductive">bind_dest_fat_ptr</span></a> <a class="idref" href="#s:96"><span class="id" title="variable">s</span></a> <a class="idref" href="#s':97"><span class="id" title="variable">s'</span></a> <a class="idref" href="#op:98"><span class="id" title="variable">op</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high128:101"><span class="id" title="variable">high128</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#ptr:100"><span class="id" title="variable">ptr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>))<br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="bind_dest_heap_ptr" class="idref" href="#bind_dest_heap_ptr"><span class="id" title="inductive">bind_dest_heap_ptr</span></a>: <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (@<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> (<a class="idref" href="#u224"><span class="id" title="definition">u224</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#heap_ptr"><span class="id" title="record">heap_ptr</span></a>) ) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="bind_dest_heap_ptr_apply" class="idref" href="#bind_dest_heap_ptr_apply"><span class="id" title="constructor">bind_dest_heap_ptr_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="s:104" class="idref" href="#s:104"><span class="id" title="binder">s</span></a> <a id="s':105" class="idref" href="#s':105"><span class="id" title="binder">s'</span></a> <a id="op:106" class="idref" href="#op:106"><span class="id" title="binder">op</span></a> (<a id="encoded:107" class="idref" href="#encoded:107"><span class="id" title="binder">encoded</span></a>:<a class="idref" href="#word"><span class="id" title="definition">word</span></a>) <a id="high224:108" class="idref" href="#high224:108"><span class="id" title="binder">high224</span></a> <a id="hptr:109" class="idref" href="#hptr:109"><span class="id" title="binder">hptr</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_dest"><span class="id" title="inductive">bind_dest</span></a> <a class="idref" href="#s:104"><span class="id" title="variable">s</span></a> <a class="idref" href="#s':105"><span class="id" title="variable">s'</span></a> <a class="idref" href="#op:106"><span class="id" title="variable">op</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#encoded:107"><span class="id" title="variable">encoded</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#encode_heap_ptr_word"><span class="id" title="definition">encode_heap_ptr_word</span></a> <a class="idref" href="#high224:108"><span class="id" title="variable">high224</span></a> <a class="idref" href="#hptr:109"><span class="id" title="variable">hptr</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#encoded:107"><span class="id" title="variable">encoded</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_dest_heap_ptr:102"><span class="id" title="inductive">bind_dest_heap_ptr</span></a> <a class="idref" href="#s:104"><span class="id" title="variable">s</span></a> <a class="idref" href="#s':105"><span class="id" title="variable">s'</span></a> <a class="idref" href="#op:106"><span class="id" title="variable">op</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high224:108"><span class="id" title="variable">high224</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#hptr:109"><span class="id" title="variable">hptr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>))<br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="bind_dest_meta_params" class="idref" href="#bind_dest_meta_params"><span class="id" title="inductive">bind_dest_meta_params</span></a>: <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (@<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> (<a class="idref" href="#params"><span class="id" title="record">MetaParametersABI.params</span></a>)) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="bind_dest_meta_params_apply" class="idref" href="#bind_dest_meta_params_apply"><span class="id" title="constructor">bind_dest_meta_params_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="s:112" class="idref" href="#s:112"><span class="id" title="binder">s</span></a> <a id="s':113" class="idref" href="#s':113"><span class="id" title="binder">s'</span></a> <a id="op:114" class="idref" href="#op:114"><span class="id" title="binder">op</span></a> <a id="encoded:115" class="idref" href="#encoded:115"><span class="id" title="binder">encoded</span></a> <a id="params:116" class="idref" href="#params:116"><span class="id" title="binder">params</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_dest"><span class="id" title="inductive">bind_dest</span></a> <a class="idref" href="#s:112"><span class="id" title="variable">s</span></a> <a class="idref" href="#s':113"><span class="id" title="variable">s'</span></a> <a class="idref" href="#op:114"><span class="id" title="variable">op</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#encoded:115"><span class="id" title="variable">encoded</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#coder"><span class="id" title="definition">MetaParametersABI.coder</span></a>.(<a class="idref" href="#encode"><span class="id" title="projection">encode</span></a>) <a class="idref" href="#params:116"><span class="id" title="variable">params</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#encoded:115"><span class="id" title="variable">encoded</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_dest_meta_params:110"><span class="id" title="inductive">bind_dest_meta_params</span></a> <a class="idref" href="#s:112"><span class="id" title="variable">s</span></a> <a class="idref" href="#s':113"><span class="id" title="variable">s'</span></a> <a class="idref" href="#op:114"><span class="id" title="variable">op</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#params:116"><span class="id" title="variable">params</span></a>))<br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="bind_relation" class="idref" href="#bind_relation"><span class="id" title="definition">bind_relation</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mf_src_pv"><span class="id" title="projection">mf_src_pv</span></a> := <a class="idref" href="#bind_src"><span class="id" title="inductive">bind_src</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mf_src_fat_ptr"><span class="id" title="projection">mf_src_fat_ptr</span></a> := <a class="idref" href="#bind_fat_ptr"><span class="id" title="inductive">bind_fat_ptr</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mf_src_heap_ptr"><span class="id" title="projection">mf_src_heap_ptr</span></a> := <a class="idref" href="#bind_heap_ptr"><span class="id" title="inductive">bind_heap_ptr</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mf_src_farcall_params"><span class="id" title="projection">mf_src_farcall_params</span></a> := <a class="idref" href="#bind_farcall_params"><span class="id" title="inductive">bind_farcall_params</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mf_src_nearcall_params"><span class="id" title="projection">mf_src_nearcall_params</span></a> := <a class="idref" href="#bind_nearcall_params"><span class="id" title="inductive">bind_nearcall_params</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mf_src_ret_params"><span class="id" title="projection">mf_src_ret_params</span></a> := <a class="idref" href="#bind_farret_params"><span class="id" title="inductive">bind_farret_params</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mf_src_precompile_params"><span class="id" title="projection">mf_src_precompile_params</span></a> := <a class="idref" href="#bind_precompile_params"><span class="id" title="inductive">bind_precompile_params</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mf_dest_pv"><span class="id" title="projection">mf_dest_pv</span></a> := <a class="idref" href="#bind_dest"><span class="id" title="inductive">bind_dest</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mf_dest_fat_ptr"><span class="id" title="projection">mf_dest_fat_ptr</span></a> := <a class="idref" href="#bind_dest_fat_ptr"><span class="id" title="inductive">bind_dest_fat_ptr</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mf_dest_heap_ptr"><span class="id" title="projection">mf_dest_heap_ptr</span></a> := <a class="idref" href="#bind_dest_heap_ptr"><span class="id" title="inductive">bind_dest_heap_ptr</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mf_dest_meta_params"><span class="id" title="projection">mf_dest_meta_params</span></a> := <a class="idref" href="#bind_dest_meta_params"><span class="id" title="inductive">bind_dest_meta_params</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
&nbsp;&nbsp;#[<span class="id" title="var">local</span>]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="get_binding_state_ts" class="idref" href="#get_binding_state_ts"><span class="id" title="definition">get_binding_state_ts</span></a> (<a id="s:117" class="idref" href="#s:117"><span class="id" title="binder">s</span></a>: <a class="idref" href="#transient_state"><span class="id" title="record">transient_state</span></a>) : <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bs_is_kernel_mode"><span class="id" title="projection">bs_is_kernel_mode</span></a> := <a class="idref" href="#in_kernel_mode"><span class="id" title="definition">in_kernel_mode</span></a> (<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s:117"><span class="id" title="variable">s</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bs_regs"><span class="id" title="projection">bs_regs</span></a> := <a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a> <a class="idref" href="#s:117"><span class="id" title="variable">s</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bs_mem"><span class="id" title="projection">bs_mem</span></a>  := <a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a> <a class="idref" href="#s:117"><span class="id" title="variable">s</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bs_cs"><span class="id" title="projection">bs_cs</span></a>   := <a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s:117"><span class="id" title="variable">s</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
&nbsp;&nbsp;#[<span class="id" title="var">local</span>]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="get_binding_state" class="idref" href="#get_binding_state"><span class="id" title="definition">get_binding_state</span></a> (<a id="s:118" class="idref" href="#s:118"><span class="id" title="binder">s</span></a>: <a class="idref" href="#state"><span class="id" title="record">state</span></a>) : <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> := <a class="idref" href="#get_binding_state_ts"><span class="id" title="definition">get_binding_state_ts</span></a> <a class="idref" href="#s:118"><span class="id" title="variable">s</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="relate_transient_states" class="idref" href="#relate_transient_states"><span class="id" title="inductive">relate_transient_states</span></a> (<a id="P:119" class="idref" href="#P:119"><span class="id" title="binder">P</span></a>: <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>): <a class="idref" href="#transient_state"><span class="id" title="record">transient_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#transient_state"><span class="id" title="record">transient_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="rts_apply" class="idref" href="#rts_apply"><span class="id" title="constructor">rts_apply</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="ts1:122" class="idref" href="#ts1:122"><span class="id" title="binder">ts1</span></a> <a id="ts2:123" class="idref" href="#ts2:123"><span class="id" title="binder">ts2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#P:119"><span class="id" title="variable">P</span></a> (<a class="idref" href="#get_binding_state_ts"><span class="id" title="definition">get_binding_state_ts</span></a> <a class="idref" href="#ts1:122"><span class="id" title="variable">ts1</span></a>) (<a class="idref" href="#get_binding_state_ts"><span class="id" title="definition">get_binding_state_ts</span></a> <a class="idref" href="#ts2:123"><span class="id" title="variable">ts2</span></a>)<a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#relate_transient_states:120"><span class="id" title="inductive">relate_transient_states</span></a> <a class="idref" href="#P:119"><span class="id" title="variable">P</span></a> <a class="idref" href="#ts1:122"><span class="id" title="variable">ts1</span></a> <a class="idref" href="#ts2:123"><span class="id" title="variable">ts2</span></a>.<br/>

<br/>
&nbsp;&nbsp;#[<span class="id" title="var">local</span>]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="merge_binding_transient_state" class="idref" href="#merge_binding_transient_state"><span class="id" title="definition">merge_binding_transient_state</span></a>: <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#transient_state"><span class="id" title="record">transient_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#transient_state"><span class="id" title="record">transient_state</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="bs:124" class="idref" href="#bs:124"><span class="id" title="binder">bs</span></a> <a id="s1:125" class="idref" href="#s1:125"><span class="id" title="binder">s1</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#bs:124"><span class="id" title="variable">bs</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_bind_st"><span class="id" title="constructor">mk_bind_st</span></a> <span class="id" title="var">_</span> <span class="id" title="var">cs</span> <span class="id" title="var">regs</span> <span class="id" title="var">gmem</span> ⇒ <a class="idref" href="#s1:125"><span class="id" title="variable">s1</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>      <span class="id" title="notation">:=</span> <span class="id" title="var">regs</span> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>     <span class="id" title="notation">:=</span> <span class="id" title="var">gmem</span> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <span class="id" title="notation">:=</span> <span class="id" title="var">cs</span>   <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;#[<span class="id" title="var">local</span>]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="merge_binding_state" class="idref" href="#merge_binding_state"><span class="id" title="definition">merge_binding_state</span></a> : <a class="idref" href="#state"><span class="id" title="record">state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#state"><span class="id" title="record">state</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="s1:127" class="idref" href="#s1:127"><span class="id" title="binder">s1</span></a> <a id="bs:128" class="idref" href="#bs:128"><span class="id" title="binder">bs</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#bs:128"><span class="id" title="variable">bs</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_bind_st"><span class="id" title="constructor">mk_bind_st</span></a> <span class="id" title="var">_</span> <span class="id" title="var">cs</span> <span class="id" title="var">regs</span> <span class="id" title="var">gmem</span> ⇒ <a class="idref" href="#s1:127"><span class="id" title="variable">s1</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="#merge_binding_transient_state"><span class="id" title="definition">merge_binding_transient_state</span></a> <a class="idref" href="#bs:128"><span class="id" title="variable">bs</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;#[<span class="id" title="var">local</span>]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="bind_operands_binding_state" class="idref" href="#bind_operands_binding_state"><span class="id" title="definition">bind_operands_binding_state</span></a> (<a id="s1:130" class="idref" href="#s1:130"><span class="id" title="binder">s1</span></a> <a id="s2:131" class="idref" href="#s2:131"><span class="id" title="binder">s2</span></a>: <a class="idref" href="#binding_state"><span class="id" title="record">binding_state</span></a>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate"><span class="id" title="inductive">ins_srelate</span></a> <a class="idref" href="#bind_relation"><span class="id" title="definition">bind_relation</span></a> <a class="idref" href="#s1:130"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:131"><span class="id" title="variable">s2</span></a> .<br/>

<br/>
</div>

<div class="doc"><p>The definition <span
class="inlinecode"><a class="idref" href="#bind_operands"><span
class="id" title="definition">bind_operands</span></a></span> relates
two <span
class="inlinecode"><a class="idref" href="#transient_state"><span
class="id" title="record">transient_state</span></a></span>s before and
after binding, and two instructions:</p>
<ul>
<li><span class="math inline">i_1</span> is a decoded instruction
obtained by applying <span
class="inlinecode"><a class="idref" href="#to_core"><span
class="id" title="definition">to_core</span></a></span> to <span
class="inlinecode"><span class="id"
title="var">Assembly.asm_instruction</span></span>;</li>
<li><span class="math inline">i_2</span> is a bound instruction where
fetching and storing values, as well as encoding and decoding are
abstracted.</li>
</ul>
<p>The values of operands in <span class="math inline">i_2</span> can be
further bound by relations, see e.g. <span
class="inlinecode"><a class="idref" href="#step_add"><span
class="id" title="inductive">step_add</span></a></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;#[<span class="id" title="var">global</span>]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="bind_operands" class="idref" href="#bind_operands"><span class="id" title="definition">bind_operands</span></a> (<a id="s1:132" class="idref" href="#s1:132"><span class="id" title="binder">s1</span></a> <a id="s2:133" class="idref" href="#s2:133"><span class="id" title="binder">s2</span></a>:<a class="idref" href="#transient_state"><span class="id" title="record">transient_state</span></a>) (<a id="i1:134" class="idref" href="#i1:134"><span class="id" title="binder">i1</span></a>: @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a>) (<a id="i2:135" class="idref" href="#i2:135"><span class="id" title="binder">i2</span></a>: @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#bound"><span class="id" title="definition">bound</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#relate_transient_states"><span class="id" title="inductive">relate_transient_states</span></a> (<span class="id" title="keyword">fun</span> <a id="bs1:136" class="idref" href="#bs1:136"><span class="id" title="binder">bs1</span></a> <a id="bs2:137" class="idref" href="#bs2:137"><span class="id" title="binder">bs2</span></a> ⇒ <a class="idref" href="#bind_operands_binding_state"><span class="id" title="definition">bind_operands_binding_state</span></a> <a class="idref" href="#bs1:136"><span class="id" title="variable">bs1</span></a> <a class="idref" href="#bs2:137"><span class="id" title="variable">bs2</span></a> <a class="idref" href="#i1:134"><span class="id" title="variable">i1</span></a> <a class="idref" href="#i2:135"><span class="id" title="variable">i2</span></a>) <a class="idref" href="#s1:132"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:133"><span class="id" title="variable">s2</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#OperandBinding"><span class="id" title="section">OperandBinding</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.History</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Common</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="History" class="idref" href="#History"><span class="id" title="section">History</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect</span> <span class="id" title="module">ssrfun</span> <span class="id" title="module">ssrbool</span> <span class="id" title="module">eqtype</span> <span class="id" title="module">ssreflect.tuple</span> <span class="id" title="module">seq</span>.<br/>
</div>

<div class="doc"><h1 id="history">History</h1>
<p><strong>History</strong> is a data structure supporting appending
elements of type <span class="inlinecode"><span class="id"
title="var">T</span></span> to it.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="T:1" class="idref" href="#T:1"><span class="id" title="binder">T</span></a>:<span class="id" title="abbreviation">eqType</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="history" class="idref" href="#history"><span class="id" title="definition">history</span></a> := <span class="id" title="abbreviation">seq</span> <a class="idref" href="#History.T"><span class="id" title="variable">T</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="l:2" class="idref" href="#l:2"><span class="id" title="binder">l</span></a>:<a class="idref" href="#history"><span class="id" title="definition">history</span></a>).<br/>

<br/>
</div>

<div class="doc"><p><span
class="inlinecode"><a class="idref" href="#history"><span
class="id" title="definition">history</span></a></span> supports
checking if an element is contained in it.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="contains" class="idref" href="#contains"><span class="id" title="definition">contains</span></a> (<a id="elem:3" class="idref" href="#elem:3"><span class="id" title="binder">elem</span></a>:<a class="idref" href="#History.T"><span class="id" title="variable">T</span></a>): <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> := <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <span class="id" title="definition">has</span> (<span class="id" title="keyword">fun</span> <a id="e:4" class="idref" href="#e:4"><span class="id" title="binder">e</span></a> ⇒ <a class="idref" href="#e:4"><span class="id" title="variable">e</span></a> <span class="id" title="notation">==</span> <a class="idref" href="#elem:3"><span class="id" title="variable">elem</span></a>) <a class="idref" href="#History.l"><span class="id" title="variable">l</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#History"><span class="id" title="section">History</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.Event</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">mathcomp</span> <span class="id" title="keyword">Require</span> <span class="id" title="library">ssreflect</span> <span class="id" title="library">ssrfun</span> <span class="id" title="library">ssrbool</span> <span class="id" title="library">eqtype</span> <span class="id" title="library">tuple</span> <span class="id" title="library">zmodp</span>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Core</span></a> <a class="idref" href="#"><span class="id" title="library">memory.Depot</span></a> <a class="idref" href="#"><span class="id" title="library">TransientMemory</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">memory.Depot</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Events" class="idref" href="#Events"><span class="id" title="section">Events</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect</span> <span class="id" title="module">ssreflect.tuple</span> <span class="id" title="module">ssreflect.eqtype</span> <span class="id" title="module">ssrbool</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="contract_address:1" class="idref" href="#contract_address:1"><span class="id" title="binder">contract_address</span></a> <a id="precompile_params:2" class="idref" href="#precompile_params:2"><span class="id" title="binder">precompile_params</span></a>: <span class="id" title="abbreviation">eqType</span>}.<br/>

<br/>
</div>

<div class="doc"><h1 id="events">Events</h1>
<p>VM interfaces with two queues:</p>
<ol type="1">
<li>L1 <span
class="inlinecode"><a class="idref" href="#l1_msg"><span
class="id" title="definition">l1_msg</span></a></span> events (see <span
class="inlinecode"><a class="idref" href="#gs_l1_msgs"><span
class="id" title="projection">gs_l1_msgs</span></a></span>), emitted by
<span
class="inlinecode"><a class="idref" href="#OpToL1Message"><span
class="id" title="constructor">OpToL1Message</span></a></span>.</li>
<li>L2 <span class="inlinecode"><span class="id"
title="var">events</span></span> events (see <span
class="inlinecode"><a class="idref" href="#gs_events"><span
class="id" title="projection">gs_events</span></a></span>), emitted by
<span
class="inlinecode"><a class="idref" href="#OpEvent"><span
class="id" title="constructor">OpEvent</span></a></span>.</li>
</ol>
<p>These queues are subject to <span
class="inlinecode"><a class="idref" href="#rollback"><span
class="id" title="inductive">rollback</span></a></span>s: in case of
revert or panic, the events emitted during the function or contract
execution are rolled back.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="event" class="idref" href="#event"><span class="id" title="record">event</span></a> := {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ev_shard_id" class="idref" href="#ev_shard_id"><span class="id" title="projection">ev_shard_id</span></a>: <a class="idref" href="#shard_id"><span class="id" title="definition">shard_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ev_is_first" class="idref" href="#ev_is_first"><span class="id" title="projection">ev_is_first</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ev_tx_number_in_block" class="idref" href="#ev_tx_number_in_block"><span class="id" title="projection">ev_tx_number_in_block</span></a>: <a class="idref" href="#tx_num"><span class="id" title="definition">tx_num</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ev_address" class="idref" href="#ev_address"><span class="id" title="projection">ev_address</span></a>: <a class="idref" href="#Events.contract_address"><span class="id" title="variable">contract_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ev_key" class="idref" href="#ev_key"><span class="id" title="projection">ev_key</span></a>: <a class="idref" href="#word"><span class="id" title="definition">word</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ev_value" class="idref" href="#ev_value"><span class="id" title="projection">ev_value</span></a>: <a class="idref" href="#word"><span class="id" title="definition">word</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
</div>
<details><summary>equality on events </summary><div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="ev_eqn" class="idref" href="#ev_eqn"><span class="id" title="definition">ev_eqn</span></a> (<a id="x:10" class="idref" href="#x:10"><span class="id" title="binder">x</span></a> <a id="y:11" class="idref" href="#y:11"><span class="id" title="binder">y</span></a>:<a class="idref" href="#event"><span class="id" title="record">event</span></a>) : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#x:10"><span class="id" title="variable">x</span></a>,<a class="idref" href="#y:11"><span class="id" title="variable">y</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Build_event"><span class="id" title="constructor">Build_event</span></a> <span class="id" title="var">ev_shard_id1</span> <span class="id" title="var">ev_is_first1</span> <span class="id" title="var">ev_tx_number_in_block1</span> <span class="id" title="var">ev_address1</span> <span class="id" title="var">ev_key1</span> <span class="id" title="var">ev_value1</span> ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Build_event"><span class="id" title="constructor">Build_event</span></a> <span class="id" title="var">ev_shard_id2</span> <span class="id" title="var">ev_is_first2</span> <span class="id" title="var">ev_tx_number_in_block2</span> <span class="id" title="var">ev_address2</span> <span class="id" title="var">ev_key2</span> <span class="id" title="var">ev_value2</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><span class="id" title="var">ev_shard_id1</span> <span class="id" title="notation">==</span> <span class="id" title="var">ev_shard_id2</span> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><span class="id" title="var">ev_is_first1</span> <span class="id" title="notation">==</span> <span class="id" title="var">ev_is_first2</span><a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><span class="id" title="var">ev_tx_number_in_block1</span> <span class="id" title="notation">==</span> <span class="id" title="var">ev_tx_number_in_block2</span><a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><span class="id" title="var">ev_address1</span> <span class="id" title="notation">==</span> <span class="id" title="var">ev_address2</span><a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><span class="id" title="var">ev_key1</span> <span class="id" title="notation">==</span> <span class="id" title="var">ev_key2</span><a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><span class="id" title="var">ev_value1</span> <span class="id" title="notation">==</span> <span class="id" title="var">ev_value2</span><a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="ev_eqnP" class="idref" href="#ev_eqnP"><span class="id" title="lemma">ev_eqnP</span></a> : <span class="id" title="definition">Equality.axiom</span> <a class="idref" href="#ev_eqn"><span class="id" title="definition">ev_eqn</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">move</span> ⇒ [<span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> <span class="id" title="var">d</span> <span class="id" title="var">e</span> <span class="id" title="var">g</span>] [<span class="id" title="var">a'</span> <span class="id" title="var">b'</span> <span class="id" title="var">c'</span> <span class="id" title="var">d'</span> <span class="id" title="var">e'</span> <span class="id" title="var">g'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Local Ltac</span> <span class="id" title="var">orelse</span> <span class="id" title="var">H</span> := <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span>! <a class="idref" href="#andb_false_r"><span class="id" title="lemma">Bool.andb_false_r</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">injection</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">eq_refl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">a</span> <span class="id" title="notation">==</span> <span class="id" title="var">a'</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">H1</span>; [<span class="id" title="tactic">move</span>: (<span class="id" title="lemma">eqP</span> <span class="id" title="var">H1</span>) ⇒ → | <span class="id" title="tactic">by</span> <span class="id" title="var">orelse</span> <span class="id" title="var">H1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">b</span> <span class="id" title="notation">==</span> <span class="id" title="var">b'</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">H2</span>; [<span class="id" title="tactic">move</span>: (<span class="id" title="lemma">eqP</span> <span class="id" title="var">H2</span>) ⇒ → | <span class="id" title="tactic">by</span> <span class="id" title="var">orelse</span> <span class="id" title="var">H2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">c</span> <span class="id" title="notation">==</span> <span class="id" title="var">c'</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">H3</span>; [<span class="id" title="tactic">move</span>: (<span class="id" title="lemma">eqP</span> <span class="id" title="var">H3</span>) ⇒ → | <span class="id" title="tactic">by</span> <span class="id" title="var">orelse</span> <span class="id" title="var">H3</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">d</span> <span class="id" title="notation">==</span> <span class="id" title="var">d'</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">H4</span>; [<span class="id" title="tactic">move</span>: (<span class="id" title="lemma">eqP</span> <span class="id" title="var">H4</span>) ⇒ → | <span class="id" title="tactic">by</span> <span class="id" title="var">orelse</span> <span class="id" title="var">H4</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">e</span> <span class="id" title="notation">==</span> <span class="id" title="var">e'</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">H5</span>; [<span class="id" title="tactic">move</span>: (<span class="id" title="lemma">eqP</span> <span class="id" title="var">H5</span>) ⇒ → | <span class="id" title="tactic">by</span> <span class="id" title="var">orelse</span> <span class="id" title="var">H5</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">g</span> <span class="id" title="notation">==</span> <span class="id" title="var">g'</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">H6</span>; [<span class="id" title="tactic">move</span>: (<span class="id" title="lemma">eqP</span> <span class="id" title="var">H6</span>) ⇒ → | <span class="id" title="tactic">by</span> <span class="id" title="var">orelse</span> <span class="id" title="var">H6</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">eq_refl</span>; <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Canonical</span> <a id="ev_eqMixin" class="idref" href="#ev_eqMixin"><span class="id" title="definition">ev_eqMixin</span></a> := <span class="id" title="abbreviation">EqMixin</span> <a class="idref" href="#ev_eqnP"><span class="id" title="lemma">ev_eqnP</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Canonical</span> <a id="ev_eqType" class="idref" href="#ev_eqType"><span class="id" title="definition">ev_eqType</span></a> := <span class="id" title="keyword">Eval</span> <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="abbreviation">EqType</span> <span class="id" title="var">_</span> <a class="idref" href="#ev_eqMixin"><span class="id" title="definition">ev_eqMixin</span></a>.<br/>
</div>
</details><div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="l1_msg" class="idref" href="#l1_msg"><span class="id" title="definition">l1_msg</span></a> := <a class="idref" href="#event"><span class="id" title="record">event</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="precompile_query" class="idref" href="#precompile_query"><span class="id" title="record">precompile_query</span></a> := {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="q_tx_number_in_block" class="idref" href="#q_tx_number_in_block"><span class="id" title="projection">q_tx_number_in_block</span></a>: <a class="idref" href="#tx_num"><span class="id" title="definition">tx_num</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="q_shard_id" class="idref" href="#q_shard_id"><span class="id" title="projection">q_shard_id</span></a>: <a class="idref" href="#shard_id"><span class="id" title="definition">shard_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="q_contract_address" class="idref" href="#q_contract_address"><span class="id" title="projection">q_contract_address</span></a>: <a class="idref" href="#Events.contract_address"><span class="id" title="variable">contract_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="q_key" class="idref" href="#q_key"><span class="id" title="projection">q_key</span></a>: <a class="idref" href="#Events.precompile_params"><span class="id" title="variable">precompile_params</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
</div>
<details><summary>equality on precompile queries </summary><div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="pq_eqn" class="idref" href="#pq_eqn"><span class="id" title="definition">pq_eqn</span></a> (<a id="x:19" class="idref" href="#x:19"><span class="id" title="binder">x</span></a> <a id="y:20" class="idref" href="#y:20"><span class="id" title="binder">y</span></a>:<a class="idref" href="#precompile_query"><span class="id" title="record">precompile_query</span></a>) : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#x:19"><span class="id" title="variable">x</span></a>,<a class="idref" href="#y:20"><span class="id" title="variable">y</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Build_precompile_query"><span class="id" title="constructor">Build_precompile_query</span></a> <span class="id" title="var">q_tx_number_in_block1</span> <span class="id" title="var">q_shard_id1</span> <span class="id" title="var">q_contract_address1</span> <span class="id" title="var">q_key1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Build_precompile_query"><span class="id" title="constructor">Build_precompile_query</span></a> <span class="id" title="var">q_tx_number_in_block2</span> <span class="id" title="var">q_shard_id2</span> <span class="id" title="var">q_contract_address2</span> <span class="id" title="var">q_key2</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><span class="id" title="var">q_tx_number_in_block1</span> <span class="id" title="notation">==</span> <span class="id" title="var">q_tx_number_in_block2</span><a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><span class="id" title="var">q_shard_id1</span> <span class="id" title="notation">==</span> <span class="id" title="var">q_shard_id2</span><a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><span class="id" title="var">q_contract_address1</span> <span class="id" title="notation">==</span> <span class="id" title="var">q_contract_address2</span><a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)&&</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><span class="id" title="var">q_key1</span> <span class="id" title="notation">==</span> <span class="id" title="var">q_key2</span><a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> .<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="pq_eqnP" class="idref" href="#pq_eqnP"><span class="id" title="lemma">pq_eqnP</span></a> : <span class="id" title="definition">Equality.axiom</span> <a class="idref" href="#pq_eqn"><span class="id" title="definition">pq_eqn</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">move</span> ⇒ [<span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> <span class="id" title="var">d</span>] [<span class="id" title="var">a'</span> <span class="id" title="var">b'</span> <span class="id" title="var">c'</span> <span class="id" title="var">d'</span>] =>//=.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">a</span> <span class="id" title="notation">==</span> <span class="id" title="var">a'</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">H1</span>; <span class="id" title="tactic">move</span>: <span class="id" title="var">H1</span>; <span class="id" title="var">last</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">injection</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">move</span>: <span class="id" title="var">H1</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">eq_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">move</span> /<span class="id" title="lemma">eqP</span> ⇒ → //=.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">b</span> <span class="id" title="notation">==</span> <span class="id" title="var">b'</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">H2</span>; [| <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">injection</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">eq_refl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">c</span> <span class="id" title="notation">==</span> <span class="id" title="var">c'</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">H3</span>; [| <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> ! <a class="idref" href="#andb_false_r"><span class="id" title="lemma">Bool.andb_false_r</span></a>; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">injection</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">eq_refl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">d</span> <span class="id" title="notation">==</span> <span class="id" title="var">d'</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">H4</span>; [| <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> ! <a class="idref" href="#andb_false_r"><span class="id" title="lemma">Bool.andb_false_r</span></a>; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">injection</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">eq_refl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H4</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">move</span>: <span class="id" title="var">H2</span> (<span class="id" title="lemma">eqP</span> <span class="id" title="var">H2</span>) ⇒ → → //=. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> (<span class="id" title="lemma">eqP</span> <span class="id" title="var">H3</span>) (<span class="id" title="lemma">eqP</span> <span class="id" title="var">H4</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Canonical</span> <a id="pq_eqMixin" class="idref" href="#pq_eqMixin"><span class="id" title="definition">pq_eqMixin</span></a> := <span class="id" title="abbreviation">EqMixin</span> <a class="idref" href="#pq_eqnP"><span class="id" title="lemma">pq_eqnP</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Canonical</span> <a id="pq_eqType" class="idref" href="#pq_eqType"><span class="id" title="definition">pq_eqType</span></a> := <span class="id" title="keyword">Eval</span> <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="abbreviation">EqType</span> <span class="id" title="var">_</span> <a class="idref" href="#pq_eqMixin"><span class="id" title="definition">pq_eqMixin</span></a>.<br/>

<br/>
</div>
</details><div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="query" class="idref" href="#query"><span class="id" title="inductive">query</span></a> :=<br/>
&nbsp;&nbsp;| <a id="EventQuery" class="idref" href="#EventQuery"><span class="id" title="constructor">EventQuery</span></a> : <a class="idref" href="#event"><span class="id" title="record">event</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#query:23"><span class="id" title="inductive">query</span></a><br/>
&nbsp;&nbsp;| <a id="L1MsgQuery" class="idref" href="#L1MsgQuery"><span class="id" title="constructor">L1MsgQuery</span></a> : <a class="idref" href="#l1_msg"><span class="id" title="definition">l1_msg</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#query:23"><span class="id" title="inductive">query</span></a><br/>
&nbsp;&nbsp;| <a id="PrecompileQuery" class="idref" href="#PrecompileQuery"><span class="id" title="constructor">PrecompileQuery</span></a> : <a class="idref" href="#precompile_query"><span class="id" title="record">precompile_query</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#query:23"><span class="id" title="inductive">query</span></a>.<br/>

<br/>
</div>
<details><summary>equality on queries </summary><div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="query_eqn" class="idref" href="#query_eqn"><span class="id" title="definition">query_eqn</span></a> (<a id="x:25" class="idref" href="#x:25"><span class="id" title="binder">x</span></a> <a id="y:26" class="idref" href="#y:26"><span class="id" title="binder">y</span></a>: <a class="idref" href="#query"><span class="id" title="inductive">query</span></a>) : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#x:25"><span class="id" title="variable">x</span></a>,<a class="idref" href="#y:26"><span class="id" title="variable">y</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#EventQuery"><span class="id" title="constructor">EventQuery</span></a> <span class="id" title="var">x</span>, <a class="idref" href="#EventQuery"><span class="id" title="constructor">EventQuery</span></a> <span class="id" title="var">y</span> ⇒ <a class="idref" href="#x:25"><span class="id" title="variable">x</span></a> <span class="id" title="notation">==</span> <a class="idref" href="#y:26"><span class="id" title="variable">y</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#L1MsgQuery"><span class="id" title="constructor">L1MsgQuery</span></a> <span class="id" title="var">x</span>, <a class="idref" href="#L1MsgQuery"><span class="id" title="constructor">L1MsgQuery</span></a> <span class="id" title="var">y</span> ⇒ <a class="idref" href="#x:25"><span class="id" title="variable">x</span></a> <span class="id" title="notation">==</span> <a class="idref" href="#y:26"><span class="id" title="variable">y</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#PrecompileQuery"><span class="id" title="constructor">PrecompileQuery</span></a> <span class="id" title="var">x</span>, <a class="idref" href="#PrecompileQuery"><span class="id" title="constructor">PrecompileQuery</span></a> <span class="id" title="var">y</span> ⇒ <a class="idref" href="#x:25"><span class="id" title="variable">x</span></a> <span class="id" title="notation">==</span> <a class="idref" href="#y:26"><span class="id" title="variable">y</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>,<span class="id" title="var">_</span> ⇒ <a class="idref" href="#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="query_eqnP" class="idref" href="#query_eqnP"><span class="id" title="lemma">query_eqnP</span></a> : <span class="id" title="definition">Equality.axiom</span> <a class="idref" href="#query_eqn"><span class="id" title="definition">query_eqn</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="#query_eqn"><span class="id" title="definition">query_eqn</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">move</span> ⇒ <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>, <span class="id" title="var">y</span> =>//; <span class="id" title="tactic">try</span>  <span class="id" title="tactic">destruct</span> (<span class="id" title="var">_</span> <span class="id" title="notation">==</span> <span class="id" title="var">_</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">Heq</span>; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">by</span> <span class="id" title="var">done</span>); <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">move</span> /<span class="id" title="lemma">eqP</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>; <span class="id" title="tactic">by</span> [<span class="id" title="tactic">subst</span>|<span class="id" title="tactic">injection</span>].<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Canonical</span> <a id="query_eqMixin" class="idref" href="#query_eqMixin"><span class="id" title="definition">query_eqMixin</span></a> := <span class="id" title="abbreviation">EqMixin</span> <a class="idref" href="#query_eqnP"><span class="id" title="lemma">query_eqnP</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Canonical</span> <a id="query_eqType" class="idref" href="#query_eqType"><span class="id" title="definition">query_eqType</span></a> := <span class="id" title="keyword">Eval</span> <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="abbreviation">EqType</span> <span class="id" title="var">_</span> <a class="idref" href="#query_eqMixin"><span class="id" title="definition">query_eqMixin</span></a>.<br/>
</div>
</details><div class="code">
&nbsp;&nbsp;<span class="comment">(*&nbsp;todo:&nbsp;probably&nbsp;these&nbsp;structures&nbsp;can&nbsp;be&nbsp;redesigned&nbsp;*)</span><br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Events"><span class="id" title="section">Events</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.MemoryBase</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Bits</span> <span class="id" title="keyword">Require</span> <span class="id" title="library">spec</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">BinNums</span></a> <a class="idref" href="#"><span class="id" title="library">FMapPositive</span></a> <a class="idref" href="#"><span class="id" title="library">ZArith</span></a>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Common</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="MemoryBase" class="idref" href="#MemoryBase"><span class="id" title="section">MemoryBase</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">BinNums</span></a> <a class="idref" href="#"><span class="id" title="module">ZArith</span></a> <span class="id" title="module">spec</span> <a class="idref" href="#"><span class="id" title="module">FMapPositive</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>Memory is modeled as a mapping from addresses (integers of <span
class="inlinecode"><a class="idref" href="#address_bits"><span
class="id" title="projection">address_bits</span></a></span> bits) to
values of type <span
class="inlinecode"><a class="idref" href="#addressable_block"><span
class="id" title="projection">addressable_block</span></a></span>.
Unmapped addresses are mapped to the <span
class="inlinecode"><a class="idref" href="#default_value"><span
class="id" title="projection">default_value</span></a></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="mem_descr" class="idref" href="#mem_descr"><span class="id" title="record">mem_descr</span></a> := <span class="id" title="var">mk_mem_descr</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="addressable_block" class="idref" href="#addressable_block"><span class="id" title="projection">addressable_block</span></a>: <span class="id" title="keyword">Type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="default_value" class="idref" href="#default_value"><span class="id" title="projection">default_value</span></a>: <a class="idref" href="#addressable_block:2"><span class="id" title="method">addressable_block</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="address_bits" class="idref" href="#address_bits"><span class="id" title="projection">address_bits</span></a>: <a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="writable" class="idref" href="#writable"><span class="id" title="projection">writable</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="mem_params:6" class="idref" href="#mem_params:6"><span class="id" title="binder">mem_params</span></a>: <a class="idref" href="#mem_descr"><span class="id" title="record">mem_descr</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="default_value:7" class="idref" href="#default_value:7"><span class="id" title="binder">default_value</span></a> := <a class="idref" href="#mem_params:6"><span class="id" title="variable">mem_params</span></a>.(<a class="idref" href="#default_value"><span class="id" title="projection">default_value</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="address_bits:8" class="idref" href="#address_bits:8"><span class="id" title="binder">address_bits</span></a> := <a class="idref" href="#mem_params:6"><span class="id" title="variable">mem_params</span></a>.(<a class="idref" href="#address_bits"><span class="id" title="projection">address_bits</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="addressable_block:9" class="idref" href="#addressable_block:9"><span class="id" title="binder">addressable_block</span></a> := <a class="idref" href="#mem_params:6"><span class="id" title="variable">mem_params</span></a>.(<a class="idref" href="#addressable_block"><span class="id" title="projection">addressable_block</span></a>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="AX_ADDRESS_BITS_GT_0" class="idref" href="#AX_ADDRESS_BITS_GT_0"><span class="id" title="axiom">AX_ADDRESS_BITS_GT_0</span></a>: <a class="idref" href="#MemoryBase.address_bits"><span class="id" title="variable">address_bits</span></a> <a class="idref" href="#::type_scope:x_'<>'_x"><span class="id" title="notation">≠</span></a> 0.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="address" class="idref" href="#address"><span class="id" title="definition">address</span></a> := <span class="id" title="definition">BITS</span> <a class="idref" href="#MemoryBase.address_bits"><span class="id" title="variable">address_bits</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="mem_parameterized" class="idref" href="#mem_parameterized"><span class="id" title="record">mem_parameterized</span></a> : <span class="id" title="keyword">Type</span> := <span class="id" title="var">mk_mem</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="contents" class="idref" href="#contents"><span class="id" title="projection">contents</span></a> :> <a class="idref" href="#PositiveMap.t"><span class="id" title="definition">PositiveMap.t</span></a> <a class="idref" href="#MemoryBase.addressable_block"><span class="id" title="variable">addressable_block</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
</div>

<div class="doc"><p>We use a map from positive numbers implemented as a tree to store
values in memory. However, address space starts at zero. Therefore,
having an address <span class="math inline">A</span> we map it to the
key <span class="math inline">K(A)</span> as follows:</p>
<p><span class="math display">K(A):= A + 1</span></p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Program Definition</span> <a id="addr_to_key" class="idref" href="#addr_to_key"><span class="id" title="definition">addr_to_key</span></a> (<a id="addr:13" class="idref" href="#addr:13"><span class="id" title="binder">addr</span></a>: <a class="idref" href="#address"><span class="id" title="definition">address</span></a>): <a class="idref" href="#positive"><span class="id" title="inductive">positive</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#MemoryBase.address_bits"><span class="id" title="variable">address_bits</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 0 ⇒ <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">bts</span> ⇒ <span class="id" title="keyword">fun</span> <a id="Heq:15" class="idref" href="#Heq:15"><span class="id" title="binder">Heq</span></a> ⇒ <a class="idref" href="#Z.to_pos"><span class="id" title="definition">Z.to_pos</span></a> (<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">(</span></a>@<span class="id" title="definition">toZ</span> <span class="id" title="var">bts</span> <a class="idref" href="#addr:13"><span class="id" title="variable">addr</span></a><a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">)</span></a> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> (@<a class="idref" href="#eq_refl"><span class="id" title="constructor">eq_refl</span></a> <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a>).<br/>

<br/>
</div>

<div class="doc"><p>All memory addresses are initialized to the default value at memory
genesis.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="load" class="idref" href="#load"><span class="id" title="definition">load</span></a> (<a id="addr:16" class="idref" href="#addr:16"><span class="id" title="binder">addr</span></a> : <a class="idref" href="#address"><span class="id" title="definition">address</span></a>) (<a id="m:17" class="idref" href="#m:17"><span class="id" title="binder">m</span></a> : <a class="idref" href="#mem_parameterized"><span class="id" title="record">mem_parameterized</span></a>) : <a class="idref" href="#MemoryBase.addressable_block"><span class="id" title="variable">addressable_block</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#PositiveMap.find"><span class="id" title="definition">PositiveMap.find</span></a> (<a class="idref" href="#addr_to_key"><span class="id" title="definition">addr_to_key</span></a> <a class="idref" href="#addr:16"><span class="id" title="variable">addr</span></a>) <a class="idref" href="#m:17"><span class="id" title="variable">m</span></a>.(<a class="idref" href="#contents"><span class="id" title="projection">contents</span></a>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="#MemoryBase.default_value"><span class="id" title="variable">default_value</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">v</span> ⇒ <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="store" class="idref" href="#store"><span class="id" title="definition">store</span></a> (<a id="val:18" class="idref" href="#val:18"><span class="id" title="binder">val</span></a>:<a class="idref" href="#MemoryBase.addressable_block"><span class="id" title="variable">addressable_block</span></a>) (<a id="addr:19" class="idref" href="#addr:19"><span class="id" title="binder">addr</span></a> : <a class="idref" href="#address"><span class="id" title="definition">address</span></a>) (<a id="m:20" class="idref" href="#m:20"><span class="id" title="binder">m</span></a> : <a class="idref" href="#mem_parameterized"><span class="id" title="record">mem_parameterized</span></a>) : <a class="idref" href="#mem_parameterized"><span class="id" title="record">mem_parameterized</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mk_mem"><span class="id" title="constructor">mk_mem</span></a> (<a class="idref" href="#PositiveMap.add"><span class="id" title="definition">PositiveMap.add</span></a> (<a class="idref" href="#addr_to_key"><span class="id" title="definition">addr_to_key</span></a> <a class="idref" href="#addr:19"><span class="id" title="variable">addr</span></a>) <a class="idref" href="#val:18"><span class="id" title="variable">val</span></a> <a class="idref" href="#m:20"><span class="id" title="variable">m</span></a>).<br/>

<br/>
</div>

<div class="doc"><p>An empty memory.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="empty" class="idref" href="#empty"><span class="id" title="definition">empty</span></a> := <a class="idref" href="#mk_mem"><span class="id" title="constructor">mk_mem</span></a> (<a class="idref" href="#PositiveMap.empty"><span class="id" title="definition">PositiveMap.empty</span></a> <a class="idref" href="#MemoryBase.addressable_block"><span class="id" title="variable">addressable_block</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="load_result" class="idref" href="#load_result"><span class="id" title="inductive">load_result</span></a> (<a id="addr:21" class="idref" href="#addr:21"><span class="id" title="binder">addr</span></a>: <a class="idref" href="#address"><span class="id" title="definition">address</span></a>) (<a id="m:22" class="idref" href="#m:22"><span class="id" title="binder">m</span></a>: <a class="idref" href="#mem_parameterized"><span class="id" title="record">mem_parameterized</span></a>) (<a id="v:23" class="idref" href="#v:23"><span class="id" title="binder">v</span></a>:<a class="idref" href="#MemoryBase.addressable_block"><span class="id" title="variable">addressable_block</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="LoadResultOK" class="idref" href="#LoadResultOK"><span class="id" title="constructor">LoadResultOK</span></a>: <a class="idref" href="#load"><span class="id" title="definition">load</span></a> <a class="idref" href="#addr:21"><span class="id" title="variable">addr</span></a> <a class="idref" href="#m:22"><span class="id" title="variable">m</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#v:23"><span class="id" title="variable">v</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#load_result:24"><span class="id" title="inductive">load_result</span></a> <a class="idref" href="#addr:21"><span class="id" title="variable">addr</span></a> <a class="idref" href="#m:22"><span class="id" title="variable">m</span></a> <a class="idref" href="#v:23"><span class="id" title="variable">v</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="store_result" class="idref" href="#store_result"><span class="id" title="inductive">store_result</span></a> (<a id="addr:26" class="idref" href="#addr:26"><span class="id" title="binder">addr</span></a>: <a class="idref" href="#address"><span class="id" title="definition">address</span></a>) (<a id="m:27" class="idref" href="#m:27"><span class="id" title="binder">m</span></a> : <a class="idref" href="#mem_parameterized"><span class="id" title="record">mem_parameterized</span></a>) (<a id="v:28" class="idref" href="#v:28"><span class="id" title="binder">v</span></a>:<a class="idref" href="#MemoryBase.addressable_block"><span class="id" title="variable">addressable_block</span></a>) (<a id="m':29" class="idref" href="#m':29"><span class="id" title="binder">m'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="#mem_parameterized"><span class="id" title="record">mem_parameterized</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="StoreResultOK" class="idref" href="#StoreResultOK"><span class="id" title="constructor">StoreResultOK</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#writable"><span class="id" title="projection">writable</span></a> <a class="idref" href="#MemoryBase.mem_params"><span class="id" title="variable">mem_params</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store"><span class="id" title="definition">store</span></a> <a class="idref" href="#v:28"><span class="id" title="variable">v</span></a> <a class="idref" href="#addr:26"><span class="id" title="variable">addr</span></a> <a class="idref" href="#m:27"><span class="id" title="variable">m</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#m':29"><span class="id" title="variable">m'</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#store_result:30"><span class="id" title="inductive">store_result</span></a> <a class="idref" href="#addr:26"><span class="id" title="variable">addr</span></a> <a class="idref" href="#m:27"><span class="id" title="variable">m</span></a> <a class="idref" href="#v:28"><span class="id" title="variable">v</span></a> <a class="idref" href="#m':29"><span class="id" title="variable">m'</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>Heap variants are byte-addressable, but reads and words operate on
256-bit <span
class="inlinecode"><a class="idref" href="#word"><span
class="id" title="definition">word</span></a></span>s. Multicell loads
return <span class="inlinecode"><span class="id"
title="var">len</span></span> consecutive bytes from memory <span
class="inlinecode"><span class="id" title="var">m</span></span> at an
address <span class="inlinecode"><span class="id"
title="var">a</span></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Arith</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">bits_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <a id="load_multicell" class="idref" href="#load_multicell"><span class="id" title="definition">load_multicell</span></a> (<a id="a:32" class="idref" href="#a:32"><span class="id" title="binder">a</span></a>:<a class="idref" href="#address"><span class="id" title="definition">address</span></a>) (<a id="len:33" class="idref" href="#len:33"><span class="id" title="binder">len</span></a>:<a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>) (<a id="m:34" class="idref" href="#m:34"><span class="id" title="binder">m</span></a>:<a class="idref" href="#mem_parameterized"><span class="id" title="record">mem_parameterized</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (<a class="idref" href="#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="#MemoryBase.addressable_block"><span class="id" title="variable">addressable_block</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#len:33"><span class="id" title="variable">len</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#O"><span class="id" title="constructor">O</span></a> ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#nil"><span class="id" title="constructor">nil</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">lft</span> ⇒ <span class="id" title="keyword">let</span> <a id="value:37" class="idref" href="#value:37"><span class="id" title="binder">value</span></a> := <a class="idref" href="#load"><span class="id" title="definition">load</span></a> <a class="idref" href="#a:32"><span class="id" title="variable">a</span></a> <a class="idref" href="#m:34"><span class="id" title="variable">m</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<a id="overflow:38" class="idref" href="#overflow:38"><span class="id" title="binder">overflow</span></a>, <a id="nextaddr:39" class="idref" href="#nextaddr:39"><span class="id" title="binder">nextaddr</span></a>) := <a class="idref" href="#uadd_of"><span class="id" title="definition">uadd_of</span></a> <a class="idref" href="#a:32"><span class="id" title="variable">a</span></a> (<span class="id" title="definition">fromZ</span> 1) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#overflow:38"><span class="id" title="variable">overflow</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#load_multicell:35"><span class="id" title="definition">load_multicell</span></a> <a class="idref" href="#nextaddr:39"><span class="id" title="variable">nextaddr</span></a> <span class="id" title="var">lft</span> <a class="idref" href="#m:34"><span class="id" title="variable">m</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">tail</span> ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#cons"><span class="id" title="constructor">cons</span></a> <a class="idref" href="#value:37"><span class="id" title="variable">value</span></a> <span class="id" title="var">tail</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="load_multicell_result" class="idref" href="#load_multicell_result"><span class="id" title="inductive">load_multicell_result</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#address"><span class="id" title="definition">address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">∀</span> <a id="len:40" class="idref" href="#len:40"><span class="id" title="binder">len</span></a>: <a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>, <a class="idref" href="#mem_parameterized"><span class="id" title="record">mem_parameterized</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="#MemoryBase.addressable_block"><span class="id" title="variable">addressable_block</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="lmr_end" class="idref" href="#lmr_end"><span class="id" title="constructor">lmr_end</span></a> : <span class="id" title="keyword">∀</span> <a id="a:43" class="idref" href="#a:43"><span class="id" title="binder">a</span></a> <a id="m:44" class="idref" href="#m:44"><span class="id" title="binder">m</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#load_multicell_result:41"><span class="id" title="inductive">load_multicell_result</span></a> <a class="idref" href="#a:43"><span class="id" title="variable">a</span></a> 0%<span class="id" title="var">nat</span> <a class="idref" href="#m:44"><span class="id" title="variable">m</span></a> <a class="idref" href="#nil"><span class="id" title="constructor">nil</span></a><br/>
<br/>
&nbsp;&nbsp;| <a id="lmr_progress" class="idref" href="#lmr_progress"><span class="id" title="constructor">lmr_progress</span></a>: <span class="id" title="keyword">∀</span> <a id="addr:45" class="idref" href="#addr:45"><span class="id" title="binder">addr</span></a> <a id="nextaddr:46" class="idref" href="#nextaddr:46"><span class="id" title="binder">nextaddr</span></a> <a id="mem:47" class="idref" href="#mem:47"><span class="id" title="binder">mem</span></a> <a id="value:48" class="idref" href="#value:48"><span class="id" title="binder">value</span></a> <a id="n:49" class="idref" href="#n:49"><span class="id" title="binder">n</span></a> <a id="tail:50" class="idref" href="#tail:50"><span class="id" title="binder">tail</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#nextaddr:46"><span class="id" title="variable">nextaddr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#uinc_of"><span class="id" title="definition">uinc_of</span></a> <a class="idref" href="#addr:45"><span class="id" title="variable">addr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#load_result"><span class="id" title="inductive">load_result</span></a> <a class="idref" href="#addr:45"><span class="id" title="variable">addr</span></a> <a class="idref" href="#mem:47"><span class="id" title="variable">mem</span></a> <a class="idref" href="#value:48"><span class="id" title="variable">value</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#load_multicell_result:41"><span class="id" title="inductive">load_multicell_result</span></a> <a class="idref" href="#nextaddr:46"><span class="id" title="variable">nextaddr</span></a> <a class="idref" href="#n:49"><span class="id" title="variable">n</span></a> <a class="idref" href="#mem:47"><span class="id" title="variable">mem</span></a> <a class="idref" href="#tail:50"><span class="id" title="variable">tail</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#load_multicell_result:41"><span class="id" title="inductive">load_multicell_result</span></a> <a class="idref" href="#addr:45"><span class="id" title="variable">addr</span></a> (<a class="idref" href="#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="#n:49"><span class="id" title="variable">n</span></a>) <a class="idref" href="#mem:47"><span class="id" title="variable">mem</span></a> (<a class="idref" href="#cons"><span class="id" title="constructor">cons</span></a> <a class="idref" href="#value:48"><span class="id" title="variable">value</span></a> <a class="idref" href="#tail:50"><span class="id" title="variable">tail</span></a>)<br/>
<br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="load_multicell_spec" class="idref" href="#load_multicell_spec"><span class="id" title="lemma">load_multicell_spec</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="a:51" class="idref" href="#a:51"><span class="id" title="binder">a</span></a> <a id="len:52" class="idref" href="#len:52"><span class="id" title="binder">len</span></a> <a id="m:53" class="idref" href="#m:53"><span class="id" title="binder">m</span></a> <a id="ls:54" class="idref" href="#ls:54"><span class="id" title="binder">ls</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#load_multicell"><span class="id" title="definition">load_multicell</span></a> <a class="idref" href="#a:51"><span class="id" title="variable">a</span></a> <a class="idref" href="#len:52"><span class="id" title="variable">len</span></a> <a class="idref" href="#m:53"><span class="id" title="variable">m</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#ls:54"><span class="id" title="variable">ls</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#load_multicell_result"><span class="id" title="inductive">load_multicell_result</span></a> <a class="idref" href="#a:51"><span class="id" title="variable">a</span></a> <a class="idref" href="#len:52"><span class="id" title="variable">len</span></a> <a class="idref" href="#m:53"><span class="id" title="variable">m</span></a> <a class="idref" href="#ls:54"><span class="id" title="variable">ls</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="load_multicell_result_size" class="idref" href="#load_multicell_result_size"><span class="id" title="lemma">load_multicell_result_size</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="tl:55" class="idref" href="#tl:55"><span class="id" title="binder">tl</span></a> <a id="a:56" class="idref" href="#a:56"><span class="id" title="binder">a</span></a> <a id="m:57" class="idref" href="#m:57"><span class="id" title="binder">m</span></a> <a id="v:58" class="idref" href="#v:58"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#load_multicell_result"><span class="id" title="inductive">load_multicell_result</span></a> <a class="idref" href="#a:56"><span class="id" title="variable">a</span></a> <a class="idref" href="#tl:55"><span class="id" title="variable">tl</span></a> <a class="idref" href="#m:57"><span class="id" title="variable">m</span></a> <a class="idref" href="#v:58"><span class="id" title="variable">v</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">seq.size</span> <a class="idref" href="#v:58"><span class="id" title="variable">v</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#tl:55"><span class="id" title="variable">tl</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>Similarly, <span
class="inlinecode"><a class="idref" href="#store_multicell"><span
class="id" title="definition">store_multicell</span></a></span> accepts
a list of values and puts them in memory starting from the address <span
class="inlinecode"><span class="id" title="var">a</span></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <span class="id" title="module">seq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <a id="store_multicell" class="idref" href="#store_multicell"><span class="id" title="definition">store_multicell</span></a> (<a id="a:59" class="idref" href="#a:59"><span class="id" title="binder">a</span></a>:<a class="idref" href="#address"><span class="id" title="definition">address</span></a>) (<a id="vals:60" class="idref" href="#vals:60"><span class="id" title="binder">vals</span></a>: <a class="idref" href="#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="#MemoryBase.addressable_block"><span class="id" title="variable">addressable_block</span></a>) (<a id="m:61" class="idref" href="#m:61"><span class="id" title="binder">m</span></a>:<a class="idref" href="#mem_parameterized"><span class="id" title="record">mem_parameterized</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#mem_parameterized"><span class="id" title="record">mem_parameterized</span></a>  :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#writable"><span class="id" title="projection">writable</span></a> <a class="idref" href="#MemoryBase.mem_params"><span class="id" title="variable">mem_params</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#vals:60"><span class="id" title="variable">vals</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="notation">[::]</span> ⇒  <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#m:61"><span class="id" title="variable">m</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">v</span> <span class="id" title="notation">::</span> <span class="id" title="var">tail</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="stored:64" class="idref" href="#stored:64"><span class="id" title="binder">stored</span></a> := <a class="idref" href="#store"><span class="id" title="definition">store</span></a> <span class="id" title="var">v</span> <a class="idref" href="#a:59"><span class="id" title="variable">a</span></a> <a class="idref" href="#m:61"><span class="id" title="variable">m</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<a id="overflow:65" class="idref" href="#overflow:65"><span class="id" title="binder">overflow</span></a>, <a id="nextaddr:66" class="idref" href="#nextaddr:66"><span class="id" title="binder">nextaddr</span></a>) := <a class="idref" href="#uinc_of"><span class="id" title="definition">uinc_of</span></a> <a class="idref" href="#a:59"><span class="id" title="variable">a</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#overflow:65"><span class="id" title="variable">overflow</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store_multicell:62"><span class="id" title="definition">store_multicell</span></a> <a class="idref" href="#nextaddr:66"><span class="id" title="variable">nextaddr</span></a> <span class="id" title="var">tail</span> <a class="idref" href="#stored:64"><span class="id" title="variable">stored</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="#None"><span class="id" title="constructor">None</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="store_multicell_result" class="idref" href="#store_multicell_result"><span class="id" title="inductive">store_multicell_result</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#address"><span class="id" title="definition">address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="#MemoryBase.addressable_block"><span class="id" title="variable">addressable_block</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#mem_parameterized"><span class="id" title="record">mem_parameterized</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#mem_parameterized"><span class="id" title="record">mem_parameterized</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="smr_end" class="idref" href="#smr_end"><span class="id" title="constructor">smr_end</span></a> : <span class="id" title="keyword">∀</span> <a id="a:69" class="idref" href="#a:69"><span class="id" title="binder">a</span></a> <a id="m:70" class="idref" href="#m:70"><span class="id" title="binder">m</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#writable"><span class="id" title="projection">writable</span></a> <a class="idref" href="#MemoryBase.mem_params"><span class="id" title="variable">mem_params</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store_multicell_result:67"><span class="id" title="inductive">store_multicell_result</span></a> <a class="idref" href="#a:69"><span class="id" title="variable">a</span></a> <span class="id" title="notation">[::]</span> <a class="idref" href="#m:70"><span class="id" title="variable">m</span></a> <a class="idref" href="#m:70"><span class="id" title="variable">m</span></a><br/>
<br/>
&nbsp;&nbsp;| <a id="smr_progress" class="idref" href="#smr_progress"><span class="id" title="constructor">smr_progress</span></a>: <span class="id" title="keyword">∀</span> <a id="addr:71" class="idref" href="#addr:71"><span class="id" title="binder">addr</span></a> <a id="nextaddr:72" class="idref" href="#nextaddr:72"><span class="id" title="binder">nextaddr</span></a> <a id="mem:73" class="idref" href="#mem:73"><span class="id" title="binder">mem</span></a> <a id="mem':74" class="idref" href="#mem':74"><span class="id" title="binder">mem'</span></a> <a id="mem'':75" class="idref" href="#mem'':75"><span class="id" title="binder">mem''</span></a> <a id="value:76" class="idref" href="#value:76"><span class="id" title="binder">value</span></a> <a id="tail:77" class="idref" href="#tail:77"><span class="id" title="binder">tail</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#writable"><span class="id" title="projection">writable</span></a> <a class="idref" href="#MemoryBase.mem_params"><span class="id" title="variable">mem_params</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#nextaddr:72"><span class="id" title="variable">nextaddr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#uinc_of"><span class="id" title="definition">uinc_of</span></a> <a class="idref" href="#addr:71"><span class="id" title="variable">addr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store_result"><span class="id" title="inductive">store_result</span></a> <a class="idref" href="#addr:71"><span class="id" title="variable">addr</span></a> <a class="idref" href="#mem:73"><span class="id" title="variable">mem</span></a> <a class="idref" href="#value:76"><span class="id" title="variable">value</span></a> <a class="idref" href="#mem':74"><span class="id" title="variable">mem'</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store_multicell_result:67"><span class="id" title="inductive">store_multicell_result</span></a> <a class="idref" href="#nextaddr:72"><span class="id" title="variable">nextaddr</span></a> <a class="idref" href="#tail:77"><span class="id" title="variable">tail</span></a> <a class="idref" href="#mem':74"><span class="id" title="variable">mem'</span></a> <a class="idref" href="#mem'':75"><span class="id" title="variable">mem''</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store_multicell_result:67"><span class="id" title="inductive">store_multicell_result</span></a> <a class="idref" href="#addr:71"><span class="id" title="variable">addr</span></a> (<a class="idref" href="#value:76"><span class="id" title="variable">value</span></a><span class="id" title="notation">::</span><a class="idref" href="#tail:77"><span class="id" title="variable">tail</span></a>)  <a class="idref" href="#mem:73"><span class="id" title="variable">mem</span></a> <a class="idref" href="#mem'':75"><span class="id" title="variable">mem''</span></a><br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="store_multicell_spec" class="idref" href="#store_multicell_spec"><span class="id" title="lemma">store_multicell_spec</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="ls:78" class="idref" href="#ls:78"><span class="id" title="binder">ls</span></a> <a id="a:79" class="idref" href="#a:79"><span class="id" title="binder">a</span></a> <a id="m:80" class="idref" href="#m:80"><span class="id" title="binder">m</span></a> <a id="m':81" class="idref" href="#m':81"><span class="id" title="binder">m'</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store_multicell"><span class="id" title="definition">store_multicell</span></a> <a class="idref" href="#a:79"><span class="id" title="variable">a</span></a> <a class="idref" href="#ls:78"><span class="id" title="variable">ls</span></a> <a class="idref" href="#m:80"><span class="id" title="variable">m</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#m':81"><span class="id" title="variable">m'</span></a>  <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store_multicell_result"><span class="id" title="inductive">store_multicell_result</span></a> <a class="idref" href="#a:79"><span class="id" title="variable">a</span></a> <a class="idref" href="#ls:78"><span class="id" title="variable">ls</span></a> <a class="idref" href="#m:80"><span class="id" title="variable">m</span></a> <a class="idref" href="#m':81"><span class="id" title="variable">m'</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#MemoryBase"><span class="id" title="section">MemoryBase</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.MemoryOps</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Addressing</span></a> <a class="idref" href="#"><span class="id" title="library">Core</span></a> <a class="idref" href="#"><span class="id" title="library">Common</span></a> <a class="idref" href="#"><span class="id" title="library">List</span></a> <a class="idref" href="#"><span class="id" title="library">Pointer</span></a> <a class="idref" href="#"><span class="id" title="library">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="library">Resolution</span></a> <a class="idref" href="#"><span class="id" title="library">Slice</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect</span> <span class="id" title="module">eqtype</span>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Addressing</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">ZArith</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">GPR</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryBase</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a> <a class="idref" href="#"><span class="id" title="module">Resolution</span></a> <a class="idref" href="#"><span class="id" title="module">Slice</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a>.<br/>
<span class="id" title="keyword">Section</span> <a id="MemoryOps" class="idref" href="#MemoryOps"><span class="id" title="section">MemoryOps</span></a>.<br/>

<br/>
</div>

<div class="doc"><h1 id="data-loading-and-storing">Data loading and storing</h1>
<p>This section formalizes reading from memory or registers (<span
class="inlinecode"><a class="idref" href="#fetch"><span
class="id" title="inductive">fetch</span></a></span>) and writing to
memory or registers (<span
class="inlinecode"><a class="idref" href="#store"><span
class="id" title="inductive">store</span></a></span>).</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <a class="idref" href="#Coercions"><span class="id" title="module">Addressing.Coercions</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="instruction:1" class="idref" href="#instruction:1"><span class="id" title="binder">instruction</span></a>: <span class="id" title="keyword">Type</span>} (<a id="instruction_invalid:2" class="idref" href="#instruction_invalid:2"><span class="id" title="binder">instruction_invalid</span></a>:<a class="idref" href="#instruction:1"><span class="id" title="variable">instruction</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<a id="state_checkpoint:3" class="idref" href="#state_checkpoint:3"><span class="id" title="binder">state_checkpoint</span></a>: <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="callstack:4" class="idref" href="#callstack:4"><span class="id" title="binder">callstack</span></a>:= @<a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="#state_checkpoint:3"><span class="id" title="variable">state_checkpoint</span></a>)<br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="MemoryOps.FetchStore" class="idref" href="#MemoryOps.FetchStore"><span class="id" title="section">FetchStore</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="memory:5" class="idref" href="#memory:5"><span class="id" title="binder">memory</span></a> :=  @<a class="idref" href="#memory"><span class="id" title="record">memory</span></a> (@<a class="idref" href="#code_page"><span class="id" title="record">code_page</span></a> <a class="idref" href="#MemoryOps.instruction"><span class="id" title="variable">instruction</span></a> <a class="idref" href="#MemoryOps.instruction_invalid"><span class="id" title="variable">instruction_invalid</span></a>) <a class="idref" href="#const_page"><span class="id" title="definition">const_page</span></a> <a class="idref" href="#data_page"><span class="id" title="definition">data_page</span></a> <a class="idref" href="#stack_page"><span class="id" title="definition">stack_page</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="regs:6" class="idref" href="#regs:6"><span class="id" title="binder">regs</span></a>: <a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a>) (<a id="cs:7" class="idref" href="#cs:7"><span class="id" title="binder">cs</span></a>: <a class="idref" href="#MemoryOps.callstack"><span class="id" title="variable">callstack</span></a>) (<a id="mem:8" class="idref" href="#mem:8"><span class="id" title="binder">mem</span></a>: <a class="idref" href="#MemoryOps.FetchStore.memory"><span class="id" title="variable">memory</span></a>) .<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="fetch_result" class="idref" href="#fetch_result"><span class="id" title="inductive">fetch_result</span></a> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="FetchIns" class="idref" href="#FetchIns"><span class="id" title="constructor">FetchIns</span></a> (<a id="ins:11" class="idref" href="#ins:11"><span class="id" title="binder">ins</span></a>: <a class="idref" href="#MemoryOps.instruction"><span class="id" title="variable">instruction</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="FetchPV" class="idref" href="#FetchPV"><span class="id" title="constructor">FetchPV</span></a> (<a id="pv:12" class="idref" href="#pv:12"><span class="id" title="binder">pv</span></a>: @<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="fetch" class="idref" href="#fetch"><span class="id" title="inductive">fetch</span></a>: <a class="idref" href="#loc"><span class="id" title="inductive">loc</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#fetch_result"><span class="id" title="inductive">fetch_result</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="fetch_reg" class="idref" href="#fetch_reg"><span class="id" title="constructor">fetch_reg</span></a>: <span class="id" title="keyword">∀</span> <a id="name:15" class="idref" href="#name:15"><span class="id" title="binder">name</span></a> <a id="reg_val:16" class="idref" href="#reg_val:16"><span class="id" title="binder">reg_val</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#reg_val:16"><span class="id" title="variable">reg_val</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#fetch_gpr"><span class="id" title="definition">fetch_gpr</span></a> <a class="idref" href="#MemoryOps.FetchStore.regs"><span class="id" title="variable">regs</span></a> <a class="idref" href="#name:15"><span class="id" title="variable">name</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fetch:13"><span class="id" title="inductive">fetch</span></a> (<a class="idref" href="#LocReg"><span class="id" title="constructor">LocReg</span></a> <a class="idref" href="#name:15"><span class="id" title="variable">name</span></a>) (<a class="idref" href="#FetchPV"><span class="id" title="constructor">FetchPV</span></a> <a class="idref" href="#reg_val:16"><span class="id" title="variable">reg_val</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="fetch_imm" class="idref" href="#fetch_imm"><span class="id" title="constructor">fetch_imm</span></a>: <span class="id" title="keyword">∀</span> <a id="imm:17" class="idref" href="#imm:17"><span class="id" title="binder">imm</span></a> <a id="imm':18" class="idref" href="#imm':18"><span class="id" title="binder">imm'</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fetch:13"><span class="id" title="inductive">fetch</span></a> (<a class="idref" href="#LocImm"><span class="id" title="constructor">LocImm</span></a> <a class="idref" href="#imm:17"><span class="id" title="variable">imm</span></a>) (<a class="idref" href="#FetchPV"><span class="id" title="constructor">FetchPV</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#imm':18"><span class="id" title="variable">imm'</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="fetch_stackaddr" class="idref" href="#fetch_stackaddr"><span class="id" title="constructor">fetch_stackaddr</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="stackpage:19" class="idref" href="#stackpage:19"><span class="id" title="binder">stackpage</span></a> (<a id="value:20" class="idref" href="#value:20"><span class="id" title="binder">value</span></a>: <a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a>) <a id="addr:21" class="idref" href="#addr:21"><span class="id" title="binder">addr</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#active_stackpage"><span class="id" title="inductive">active_stackpage</span></a> (<a class="idref" href="#page_has_id"><span class="id" title="inductive">page_has_id</span></a> <a class="idref" href="#MemoryOps.FetchStore.mem"><span class="id" title="variable">mem</span></a>) <a class="idref" href="#MemoryOps.FetchStore.cs"><span class="id" title="variable">cs</span></a> <a class="idref" href="#stackpage:19"><span class="id" title="variable">stackpage</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#load_result"><span class="id" title="inductive">MemoryBase.load_result</span></a> <span class="id" title="var">_</span> <a class="idref" href="#addr:21"><span class="id" title="variable">addr</span></a> <a class="idref" href="#stackpage:19"><span class="id" title="variable">stackpage</span></a> <a class="idref" href="#value:20"><span class="id" title="variable">value</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fetch:13"><span class="id" title="inductive">fetch</span></a> (<a class="idref" href="#LocStackAddress"><span class="id" title="constructor">LocStackAddress</span></a> <a class="idref" href="#addr:21"><span class="id" title="variable">addr</span></a>) (<a class="idref" href="#FetchPV"><span class="id" title="constructor">FetchPV</span></a> <a class="idref" href="#value:20"><span class="id" title="variable">value</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="fetch_codeaddr" class="idref" href="#fetch_codeaddr"><span class="id" title="constructor">fetch_codeaddr</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="codepage:22" class="idref" href="#codepage:22"><span class="id" title="binder">codepage</span></a> <a id="addr:23" class="idref" href="#addr:23"><span class="id" title="binder">addr</span></a> <a id="ins:24" class="idref" href="#ins:24"><span class="id" title="binder">ins</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#active_codepage"><span class="id" title="inductive">active_codepage</span></a> (<a class="idref" href="#page_has_id"><span class="id" title="inductive">page_has_id</span></a> <a class="idref" href="#MemoryOps.FetchStore.mem"><span class="id" title="variable">mem</span></a>) <a class="idref" href="#MemoryOps.FetchStore.cs"><span class="id" title="variable">cs</span></a> <a class="idref" href="#codepage:22"><span class="id" title="variable">codepage</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#load_result"><span class="id" title="inductive">load_result</span></a> <span class="id" title="var">_</span> <a class="idref" href="#addr:23"><span class="id" title="variable">addr</span></a> <a class="idref" href="#codepage:22"><span class="id" title="variable">codepage</span></a> <a class="idref" href="#ins:24"><span class="id" title="variable">ins</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fetch:13"><span class="id" title="inductive">fetch</span></a> (<a class="idref" href="#LocCodeAddr"><span class="id" title="constructor">LocCodeAddr</span></a> <a class="idref" href="#addr:23"><span class="id" title="variable">addr</span></a>) (<a class="idref" href="#FetchIns"><span class="id" title="constructor">FetchIns</span></a> <a class="idref" href="#ins:24"><span class="id" title="variable">ins</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="fetch_constaddr" class="idref" href="#fetch_constaddr"><span class="id" title="constructor">fetch_constaddr</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="constpage:25" class="idref" href="#constpage:25"><span class="id" title="binder">constpage</span></a> <a id="addr:26" class="idref" href="#addr:26"><span class="id" title="binder">addr</span></a> <a id="value:27" class="idref" href="#value:27"><span class="id" title="binder">value</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#active_constpage"><span class="id" title="inductive">active_constpage</span></a> (<a class="idref" href="#page_has_id"><span class="id" title="inductive">page_has_id</span></a> <a class="idref" href="#MemoryOps.FetchStore.mem"><span class="id" title="variable">mem</span></a>) <a class="idref" href="#MemoryOps.FetchStore.cs"><span class="id" title="variable">cs</span></a> <a class="idref" href="#constpage:25"><span class="id" title="variable">constpage</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#load_result"><span class="id" title="inductive">load_result</span></a> <span class="id" title="var">_</span> <a class="idref" href="#addr:26"><span class="id" title="variable">addr</span></a> <a class="idref" href="#constpage:25"><span class="id" title="variable">constpage</span></a> <a class="idref" href="#value:27"><span class="id" title="variable">value</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fetch:13"><span class="id" title="inductive">fetch</span></a> (<a class="idref" href="#LocConstAddr"><span class="id" title="constructor">LocConstAddr</span></a> <a class="idref" href="#addr:26"><span class="id" title="variable">addr</span></a>) (<a class="idref" href="#FetchPV"><span class="id" title="constructor">FetchPV</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#value:27"><span class="id" title="variable">value</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="next_ins" class="idref" href="#next_ins"><span class="id" title="definition">next_ins</span></a> := <a class="idref" href="#LocCodeAddr"><span class="id" title="constructor">LocCodeAddr</span></a> (<a class="idref" href="#pc_get"><span class="id" title="definition">pc_get</span></a> <a class="idref" href="#MemoryOps.FetchStore.cs"><span class="id" title="variable">cs</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="fetch_instr" class="idref" href="#fetch_instr"><span class="id" title="definition">fetch_instr</span></a> := <a class="idref" href="#fetch"><span class="id" title="inductive">fetch</span></a> <a class="idref" href="#next_ins"><span class="id" title="definition">next_ins</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="store_loc" class="idref" href="#store_loc"><span class="id" title="inductive">store_loc</span></a>: <a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#loc"><span class="id" title="inductive">loc</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">(</span></a><a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#MemoryOps.FetchStore.memory"><span class="id" title="variable">memory</span></a><a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="store_lreg" class="idref" href="#store_lreg"><span class="id" title="constructor">store_lreg</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="new_regs:30" class="idref" href="#new_regs:30"><span class="id" title="binder">new_regs</span></a> <a id="reg_name:31" class="idref" href="#reg_name:31"><span class="id" title="binder">reg_name</span></a> <a id="value:32" class="idref" href="#value:32"><span class="id" title="binder">value</span></a> <a id="mem:33" class="idref" href="#mem:33"><span class="id" title="binder">mem</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store_gpr"><span class="id" title="definition">store_gpr</span></a> <a class="idref" href="#MemoryOps.FetchStore.regs"><span class="id" title="variable">regs</span></a> <a class="idref" href="#reg_name:31"><span class="id" title="variable">reg_name</span></a> <a class="idref" href="#value:32"><span class="id" title="variable">value</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#new_regs:30"><span class="id" title="variable">new_regs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store_loc:28"><span class="id" title="inductive">store_loc</span></a> <a class="idref" href="#value:32"><span class="id" title="variable">value</span></a> (<a class="idref" href="#LocReg"><span class="id" title="constructor">LocReg</span></a> <a class="idref" href="#reg_name:31"><span class="id" title="variable">reg_name</span></a>) <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#new_regs:30"><span class="id" title="variable">new_regs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#mem:33"><span class="id" title="variable">mem</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="store_lstackaddr" class="idref" href="#store_lstackaddr"><span class="id" title="constructor">store_lstackaddr</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="new_mem:34" class="idref" href="#new_mem:34"><span class="id" title="binder">new_mem</span></a> <a id="stackpage:35" class="idref" href="#stackpage:35"><span class="id" title="binder">stackpage</span></a> <a id="addr:36" class="idref" href="#addr:36"><span class="id" title="binder">addr</span></a> <a id="value:37" class="idref" href="#value:37"><span class="id" title="binder">value</span></a> <a id="pid:38" class="idref" href="#pid:38"><span class="id" title="binder">pid</span></a> <a id="new_stackpage:39" class="idref" href="#new_stackpage:39"><span class="id" title="binder">new_stackpage</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#active_stackpage"><span class="id" title="inductive">active_stackpage</span></a> (<a class="idref" href="#page_has_id"><span class="id" title="inductive">page_has_id</span></a> <a class="idref" href="#MemoryOps.FetchStore.mem"><span class="id" title="variable">mem</span></a>) <a class="idref" href="#MemoryOps.FetchStore.cs"><span class="id" title="variable">cs</span></a> <a class="idref" href="#stackpage:35"><span class="id" title="variable">stackpage</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store_result"><span class="id" title="inductive">store_result</span></a> <span class="id" title="var">_</span> <a class="idref" href="#addr:36"><span class="id" title="variable">addr</span></a> <a class="idref" href="#stackpage:35"><span class="id" title="variable">stackpage</span></a> <a class="idref" href="#value:37"><span class="id" title="variable">value</span></a> <a class="idref" href="#new_stackpage:39"><span class="id" title="variable">new_stackpage</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#page_replace"><span class="id" title="inductive">page_replace</span></a> <a class="idref" href="#pid:38"><span class="id" title="variable">pid</span></a> (<a class="idref" href="#StackPage"><span class="id" title="constructor">StackPage</span></a> <a class="idref" href="#new_stackpage:39"><span class="id" title="variable">new_stackpage</span></a>) <a class="idref" href="#MemoryOps.FetchStore.mem"><span class="id" title="variable">mem</span></a> <a class="idref" href="#new_mem:34"><span class="id" title="variable">new_mem</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store_loc:28"><span class="id" title="inductive">store_loc</span></a> <a class="idref" href="#value:37"><span class="id" title="variable">value</span></a> (<a class="idref" href="#LocStackAddress"><span class="id" title="constructor">LocStackAddress</span></a> <a class="idref" href="#addr:36"><span class="id" title="variable">addr</span></a>) <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#MemoryOps.FetchStore.regs"><span class="id" title="variable">regs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#new_mem:34"><span class="id" title="variable">new_mem</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>

<br/>
</div>

<div class="doc"><p>Loading a primitive value from registers or memory, applying effects
of <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span> if
necessary.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="load" class="idref" href="#load"><span class="id" title="inductive">load</span></a>: <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#MemoryOps.callstack"><span class="id" title="variable">callstack</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="ld_apply" class="idref" href="#ld_apply"><span class="id" title="constructor">ld_apply</span></a> : <span class="id" title="keyword">∀</span> (<a id="arg:42" class="idref" href="#arg:42"><span class="id" title="binder">arg</span></a>:<a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) <a id="loc:43" class="idref" href="#loc:43"><span class="id" title="binder">loc</span></a> <a id="res:44" class="idref" href="#res:44"><span class="id" title="binder">res</span></a> <a id="new_cs:45" class="idref" href="#new_cs:45"><span class="id" title="binder">new_cs</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#resolve_apply"><span class="id" title="inductive">resolve_apply</span></a> <a class="idref" href="#MemoryOps.FetchStore.regs"><span class="id" title="variable">regs</span></a> <a class="idref" href="#MemoryOps.FetchStore.cs"><span class="id" title="variable">cs</span></a> <a class="idref" href="#arg:42"><span class="id" title="variable">arg</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#new_cs:45"><span class="id" title="variable">new_cs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#loc:43"><span class="id" title="variable">loc</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fetch"><span class="id" title="inductive">fetch</span></a> <a class="idref" href="#loc:43"><span class="id" title="variable">loc</span></a> (<a class="idref" href="#FetchPV"><span class="id" title="constructor">FetchPV</span></a> <a class="idref" href="#res:44"><span class="id" title="variable">res</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#load:40"><span class="id" title="inductive">load</span></a> <a class="idref" href="#arg:42"><span class="id" title="variable">arg</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#new_cs:45"><span class="id" title="variable">new_cs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#res:44"><span class="id" title="variable">res</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>A special version of <span
class="inlinecode"><a class="idref" href="#load"><span
class="id" title="inductive">load</span></a></span> for registers
because it has less potential effects on the state, which makes it
easier and more precise.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="load_reg" class="idref" href="#load_reg"><span class="id" title="inductive">load_reg</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="ldr_apply" class="idref" href="#ldr_apply"><span class="id" title="constructor">ldr_apply</span></a> : <span class="id" title="keyword">∀</span>  <a id="loc:48" class="idref" href="#loc:48"><span class="id" title="binder">loc</span></a> <a id="res:49" class="idref" href="#res:49"><span class="id" title="binder">res</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fetch_gpr"><span class="id" title="definition">fetch_gpr</span></a> <a class="idref" href="#MemoryOps.FetchStore.regs"><span class="id" title="variable">regs</span></a> <a class="idref" href="#loc:48"><span class="id" title="variable">loc</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#res:49"><span class="id" title="variable">res</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#load_reg:46"><span class="id" title="inductive">load_reg</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <a class="idref" href="#loc:48"><span class="id" title="variable">loc</span></a>) <a class="idref" href="#res:49"><span class="id" title="variable">res</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="load_int" class="idref" href="#load_int"><span class="id" title="definition">load_int</span></a> <a id="a:50" class="idref" href="#a:50"><span class="id" title="binder">a</span></a> <a id="cs:51" class="idref" href="#cs:51"><span class="id" title="binder">cs</span></a> <a id="w:52" class="idref" href="#w:52"><span class="id" title="binder">w</span></a> := <a class="idref" href="#load"><span class="id" title="inductive">load</span></a> <a class="idref" href="#a:50"><span class="id" title="variable">a</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#cs:51"><span class="id" title="variable">cs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#w:52"><span class="id" title="variable">w</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="load_reg_int" class="idref" href="#load_reg_int"><span class="id" title="definition">load_reg_int</span></a> <a id="a:53" class="idref" href="#a:53"><span class="id" title="binder">a</span></a> <a id="w:54" class="idref" href="#w:54"><span class="id" title="binder">w</span></a> := <a class="idref" href="#load_reg"><span class="id" title="inductive">load_reg</span></a> <a class="idref" href="#a:53"><span class="id" title="variable">a</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#w:54"><span class="id" title="variable">w</span></a>).<br/>

<br/>
</div>

<div class="doc"><p>Storing a primitive value to registers or memory, applying effects of
<span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span> if
necessary.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="store" class="idref" href="#store"><span class="id" title="inductive">store</span></a>: <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#MemoryOps.FetchStore.memory"><span class="id" title="variable">memory</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#MemoryOps.callstack"><span class="id" title="variable">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="st_apply" class="idref" href="#st_apply"><span class="id" title="constructor">st_apply</span></a>: <span class="id" title="keyword">∀</span> (<a id="arg:57" class="idref" href="#arg:57"><span class="id" title="binder">arg</span></a>:<a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a>) <a id="loc:58" class="idref" href="#loc:58"><span class="id" title="binder">loc</span></a> <a id="new_regs:59" class="idref" href="#new_regs:59"><span class="id" title="binder">new_regs</span></a> <a id="new_mem:60" class="idref" href="#new_mem:60"><span class="id" title="binder">new_mem</span></a> <a id="new_cs:61" class="idref" href="#new_cs:61"><span class="id" title="binder">new_cs</span></a> <a id="pv:62" class="idref" href="#pv:62"><span class="id" title="binder">pv</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#resolve_apply"><span class="id" title="inductive">resolve_apply</span></a> <a class="idref" href="#MemoryOps.FetchStore.regs"><span class="id" title="variable">regs</span></a> <a class="idref" href="#MemoryOps.FetchStore.cs"><span class="id" title="variable">cs</span></a> <a class="idref" href="#arg:57"><span class="id" title="variable">arg</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#new_cs:61"><span class="id" title="variable">new_cs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#loc:58"><span class="id" title="variable">loc</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store_loc"><span class="id" title="inductive">store_loc</span></a> <a class="idref" href="#pv:62"><span class="id" title="variable">pv</span></a> <a class="idref" href="#loc:58"><span class="id" title="variable">loc</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#new_regs:59"><span class="id" title="variable">new_regs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#new_mem:60"><span class="id" title="variable">new_mem</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store:55"><span class="id" title="inductive">store</span></a> <a class="idref" href="#arg:57"><span class="id" title="variable">arg</span></a> <a class="idref" href="#pv:62"><span class="id" title="variable">pv</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#new_regs:59"><span class="id" title="variable">new_regs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#new_mem:60"><span class="id" title="variable">new_mem</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#new_cs:61"><span class="id" title="variable">new_cs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>A special version of <span
class="inlinecode"><a class="idref" href="#store"><span
class="id" title="inductive">store</span></a></span> for registers
because it has less potential effects on the state, which makes it
easier and more precise.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="store_reg" class="idref" href="#store_reg"><span class="id" title="inductive">store_reg</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="sr_apply" class="idref" href="#sr_apply"><span class="id" title="constructor">sr_apply</span></a>: <span class="id" title="keyword">∀</span> (<a id="arg:65" class="idref" href="#arg:65"><span class="id" title="binder">arg</span></a>:<a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>) <a id="loc:66" class="idref" href="#loc:66"><span class="id" title="binder">loc</span></a> <a id="new_regs:67" class="idref" href="#new_regs:67"><span class="id" title="binder">new_regs</span></a>  <a id="pv:68" class="idref" href="#pv:68"><span class="id" title="binder">pv</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store_gpr"><span class="id" title="definition">store_gpr</span></a> <a class="idref" href="#MemoryOps.FetchStore.regs"><span class="id" title="variable">regs</span></a> <a class="idref" href="#loc:66"><span class="id" title="variable">loc</span></a> <a class="idref" href="#pv:68"><span class="id" title="variable">pv</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#new_regs:67"><span class="id" title="variable">new_regs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store_reg:63"><span class="id" title="inductive">store_reg</span></a> <a class="idref" href="#arg:65"><span class="id" title="variable">arg</span></a> <a class="idref" href="#pv:68"><span class="id" title="variable">pv</span></a> <a class="idref" href="#new_regs:67"><span class="id" title="variable">new_regs</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="store_int" class="idref" href="#store_int"><span class="id" title="definition">store_int</span></a> <a id="a:69" class="idref" href="#a:69"><span class="id" title="binder">a</span></a> <a id="w:70" class="idref" href="#w:70"><span class="id" title="binder">w</span></a> <a id="rs:71" class="idref" href="#rs:71"><span class="id" title="binder">rs</span></a> <a id="m:72" class="idref" href="#m:72"><span class="id" title="binder">m</span></a> <a id="cs:73" class="idref" href="#cs:73"><span class="id" title="binder">cs</span></a> := <a class="idref" href="#store"><span class="id" title="inductive">store</span></a> <a class="idref" href="#a:69"><span class="id" title="variable">a</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#w:70"><span class="id" title="variable">w</span></a>) <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#rs:71"><span class="id" title="variable">rs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#m:72"><span class="id" title="variable">m</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#cs:73"><span class="id" title="variable">cs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="#MemoryOps.FetchStore"><span class="id" title="section">FetchStore</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="loads" class="idref" href="#loads"><span class="id" title="inductive">loads</span></a> (<a id="regs:74" class="idref" href="#regs:74"><span class="id" title="binder">regs</span></a>:<a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a>) (<a id="cs:75" class="idref" href="#cs:75"><span class="id" title="binder">cs</span></a>:<a class="idref" href="#MemoryOps.callstack"><span class="id" title="variable">callstack</span></a>) (<a id="mem:76" class="idref" href="#mem:76"><span class="id" title="binder">mem</span></a>:<a class="idref" href="#memory"><span class="id" title="record">memory</span></a>) : <a class="idref" href="#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#MemoryOps.callstack"><span class="id" title="variable">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="rsl_nil" class="idref" href="#rsl_nil"><span class="id" title="constructor">rsl_nil</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#loads:77"><span class="id" title="inductive">loads</span></a> <a class="idref" href="#regs:74"><span class="id" title="variable">regs</span></a> <a class="idref" href="#cs:75"><span class="id" title="variable">cs</span></a> <a class="idref" href="#mem:76"><span class="id" title="variable">mem</span></a> <a class="idref" href="#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="#cs:75"><span class="id" title="variable">cs</span></a><br/>
<br/>
&nbsp;&nbsp;| <a id="rsl_cons" class="idref" href="#rsl_cons"><span class="id" title="constructor">rsl_cons</span></a>: <span class="id" title="keyword">∀</span> (<a id="arg:79" class="idref" href="#arg:79"><span class="id" title="binder">arg</span></a>:<a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) <a id="pv:80" class="idref" href="#pv:80"><span class="id" title="binder">pv</span></a> (<a id="tail:81" class="idref" href="#tail:81"><span class="id" title="binder">tail</span></a>: <a class="idref" href="#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a>)) <a id="cs1:82" class="idref" href="#cs1:82"><span class="id" title="binder">cs1</span></a> <a id="cs2:83" class="idref" href="#cs2:83"><span class="id" title="binder">cs2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#load"><span class="id" title="inductive">load</span></a> <a class="idref" href="#regs:74"><span class="id" title="variable">regs</span></a> <a class="idref" href="#cs:75"><span class="id" title="variable">cs</span></a> <a class="idref" href="#mem:76"><span class="id" title="variable">mem</span></a> <a class="idref" href="#arg:79"><span class="id" title="variable">arg</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#cs1:82"><span class="id" title="variable">cs1</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#pv:80"><span class="id" title="variable">pv</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#loads:77"><span class="id" title="inductive">loads</span></a> <a class="idref" href="#regs:74"><span class="id" title="variable">regs</span></a> <a class="idref" href="#cs1:82"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#mem:76"><span class="id" title="variable">mem</span></a> <a class="idref" href="#tail:81"><span class="id" title="variable">tail</span></a> <a class="idref" href="#cs2:83"><span class="id" title="variable">cs2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#loads:77"><span class="id" title="inductive">loads</span></a> <a class="idref" href="#regs:74"><span class="id" title="variable">regs</span></a> <a class="idref" href="#cs:75"><span class="id" title="variable">cs</span></a> <a class="idref" href="#mem:76"><span class="id" title="variable">mem</span></a> (<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#arg:79"><span class="id" title="variable">arg</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#pv:80"><span class="id" title="variable">pv</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="#tail:81"><span class="id" title="variable">tail</span></a>) <a class="idref" href="#cs2:83"><span class="id" title="variable">cs2</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="load_regs" class="idref" href="#load_regs"><span class="id" title="inductive">load_regs</span></a> (<a id="regs:84" class="idref" href="#regs:84"><span class="id" title="binder">regs</span></a>:<a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a>) : <a class="idref" href="#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="rslr_nil" class="idref" href="#rslr_nil"><span class="id" title="constructor">rslr_nil</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#load_regs:85"><span class="id" title="inductive">load_regs</span></a> <a class="idref" href="#regs:84"><span class="id" title="variable">regs</span></a>  <a class="idref" href="#nil"><span class="id" title="constructor">nil</span></a><br/>
<br/>
&nbsp;&nbsp;| <a id="rslr_cons" class="idref" href="#rslr_cons"><span class="id" title="constructor">rslr_cons</span></a>: <span class="id" title="keyword">∀</span> (<a id="arg:87" class="idref" href="#arg:87"><span class="id" title="binder">arg</span></a>:<a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>) <a id="pv:88" class="idref" href="#pv:88"><span class="id" title="binder">pv</span></a> (<a id="tail:89" class="idref" href="#tail:89"><span class="id" title="binder">tail</span></a>: <a class="idref" href="#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#load_reg"><span class="id" title="inductive">load_reg</span></a> <a class="idref" href="#regs:84"><span class="id" title="variable">regs</span></a> <a class="idref" href="#arg:87"><span class="id" title="variable">arg</span></a> <a class="idref" href="#pv:88"><span class="id" title="variable">pv</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#load_regs:85"><span class="id" title="inductive">load_regs</span></a> <a class="idref" href="#regs:84"><span class="id" title="variable">regs</span></a> <a class="idref" href="#tail:89"><span class="id" title="variable">tail</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#load_regs:85"><span class="id" title="inductive">load_regs</span></a> <a class="idref" href="#regs:84"><span class="id" title="variable">regs</span></a> (<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#arg:87"><span class="id" title="variable">arg</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#pv:88"><span class="id" title="variable">pv</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="#tail:89"><span class="id" title="variable">tail</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="stores" class="idref" href="#stores"><span class="id" title="inductive">stores</span></a> (<a id="regs:90" class="idref" href="#regs:90"><span class="id" title="binder">regs</span></a>:<a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a>) (<a id="cs:91" class="idref" href="#cs:91"><span class="id" title="binder">cs</span></a>:<a class="idref" href="#MemoryOps.callstack"><span class="id" title="variable">callstack</span></a>) (<a id="mem:92" class="idref" href="#mem:92"><span class="id" title="binder">mem</span></a>:<a class="idref" href="#memory"><span class="id" title="record">memory</span></a>) : <a class="idref" href="#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">(</span></a><a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#memory"><span class="id" title="record">memory</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#MemoryOps.callstack"><span class="id" title="variable">callstack</span></a><a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="rss_nil" class="idref" href="#rss_nil"><span class="id" title="constructor">rss_nil</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#stores:93"><span class="id" title="inductive">stores</span></a> <a class="idref" href="#regs:90"><span class="id" title="variable">regs</span></a> <a class="idref" href="#cs:91"><span class="id" title="variable">cs</span></a> <a class="idref" href="#mem:92"><span class="id" title="variable">mem</span></a> <a class="idref" href="#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#regs:90"><span class="id" title="variable">regs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#mem:92"><span class="id" title="variable">mem</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#cs:91"><span class="id" title="variable">cs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;| <a id="rss_cons" class="idref" href="#rss_cons"><span class="id" title="constructor">rss_cons</span></a>: <span class="id" title="keyword">∀</span> (<a id="arg:95" class="idref" href="#arg:95"><span class="id" title="binder">arg</span></a>:<a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a>) <a id="pv:96" class="idref" href="#pv:96"><span class="id" title="binder">pv</span></a> (<a id="tail:97" class="idref" href="#tail:97"><span class="id" title="binder">tail</span></a>: <a class="idref" href="#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a>)) <a id="regs1:98" class="idref" href="#regs1:98"><span class="id" title="binder">regs1</span></a> <a id="mem1:99" class="idref" href="#mem1:99"><span class="id" title="binder">mem1</span></a> <a id="cs1:100" class="idref" href="#cs1:100"><span class="id" title="binder">cs1</span></a> <a id="regs2:101" class="idref" href="#regs2:101"><span class="id" title="binder">regs2</span></a> <a id="mem2:102" class="idref" href="#mem2:102"><span class="id" title="binder">mem2</span></a> <a id="cs2:103" class="idref" href="#cs2:103"><span class="id" title="binder">cs2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store"><span class="id" title="inductive">store</span></a> <a class="idref" href="#regs:90"><span class="id" title="variable">regs</span></a> <a class="idref" href="#cs:91"><span class="id" title="variable">cs</span></a> <a class="idref" href="#mem:92"><span class="id" title="variable">mem</span></a> <a class="idref" href="#arg:95"><span class="id" title="variable">arg</span></a> <a class="idref" href="#pv:96"><span class="id" title="variable">pv</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#regs1:98"><span class="id" title="variable">regs1</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#mem1:99"><span class="id" title="variable">mem1</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#cs1:100"><span class="id" title="variable">cs1</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#stores:93"><span class="id" title="inductive">stores</span></a> <a class="idref" href="#regs1:98"><span class="id" title="variable">regs1</span></a> <a class="idref" href="#cs1:100"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#mem1:99"><span class="id" title="variable">mem1</span></a> <a class="idref" href="#tail:97"><span class="id" title="variable">tail</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#regs2:101"><span class="id" title="variable">regs2</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#mem2:102"><span class="id" title="variable">mem2</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#cs2:103"><span class="id" title="variable">cs2</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#stores:93"><span class="id" title="inductive">stores</span></a> <a class="idref" href="#regs:90"><span class="id" title="variable">regs</span></a> <a class="idref" href="#cs:91"><span class="id" title="variable">cs</span></a> <a class="idref" href="#mem:92"><span class="id" title="variable">mem</span></a> (<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#arg:95"><span class="id" title="variable">arg</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#pv:96"><span class="id" title="variable">pv</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="#tail:97"><span class="id" title="variable">tail</span></a>) <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#regs2:101"><span class="id" title="variable">regs2</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#mem2:102"><span class="id" title="variable">mem2</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#cs2:103"><span class="id" title="variable">cs2</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="store_regs" class="idref" href="#store_regs"><span class="id" title="inductive">store_regs</span></a> (<a id="regs:104" class="idref" href="#regs:104"><span class="id" title="binder">regs</span></a>:<a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a>) : <a class="idref" href="#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="rssr_nil" class="idref" href="#rssr_nil"><span class="id" title="constructor">rssr_nil</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store_regs:105"><span class="id" title="inductive">store_regs</span></a> <a class="idref" href="#regs:104"><span class="id" title="variable">regs</span></a> <a class="idref" href="#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="#regs:104"><span class="id" title="variable">regs</span></a><br/>
&nbsp;&nbsp;| <a id="rssr_cons" class="idref" href="#rssr_cons"><span class="id" title="constructor">rssr_cons</span></a>: <span class="id" title="keyword">∀</span> (<a id="arg:107" class="idref" href="#arg:107"><span class="id" title="binder">arg</span></a>:<a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>) <a id="pv:108" class="idref" href="#pv:108"><span class="id" title="binder">pv</span></a> (<a id="tail:109" class="idref" href="#tail:109"><span class="id" title="binder">tail</span></a>: <a class="idref" href="#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a>)) <a id="regs1:110" class="idref" href="#regs1:110"><span class="id" title="binder">regs1</span></a> <a id="regs2:111" class="idref" href="#regs2:111"><span class="id" title="binder">regs2</span></a> ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store_reg"><span class="id" title="inductive">store_reg</span></a> <a class="idref" href="#regs:104"><span class="id" title="variable">regs</span></a> <a class="idref" href="#arg:107"><span class="id" title="variable">arg</span></a> <a class="idref" href="#pv:108"><span class="id" title="variable">pv</span></a> <a class="idref" href="#regs1:110"><span class="id" title="variable">regs1</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store_regs:105"><span class="id" title="inductive">store_regs</span></a> <a class="idref" href="#regs1:110"><span class="id" title="variable">regs1</span></a> <a class="idref" href="#tail:109"><span class="id" title="variable">tail</span></a> <a class="idref" href="#regs2:111"><span class="id" title="variable">regs2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store_regs:105"><span class="id" title="inductive">store_regs</span></a> <a class="idref" href="#regs:104"><span class="id" title="variable">regs</span></a> (<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#arg:107"><span class="id" title="variable">arg</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#pv:108"><span class="id" title="variable">pv</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="#tail:109"><span class="id" title="variable">tail</span></a>) <a class="idref" href="#regs2:111"><span class="id" title="variable">regs2</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#MemoryOps"><span class="id" title="section">MemoryOps</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Multibyte" class="idref" href="#Multibyte"><span class="id" title="section">Multibyte</span></a>.<br/>
</div>

<div class="doc"><h1 id="multibyte-loads-and-stores">Multibyte loads and stores</h1>
<p>Instructions such as <span
class="inlinecode"><a class="idref" href="#OpStore"><span
class="id" title="constructor">OpStore</span></a></span> and <span
class="inlinecode"><a class="idref" href="#OpLoadPointer"><span
class="id" title="constructor">OpLoadPointer</span></a></span> operate
with a byte addressable <span
class="inlinecode"><a class="idref" href="#data_page"><span
class="id" title="definition">data_page</span></a></span>s, but load or
store 256-bit <span
class="inlinecode"><a class="idref" href="#word"><span
class="id" title="definition">word</span></a></span>s. Therefore, their
effects are formalized separately.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="endianness" class="idref" href="#endianness"><span class="id" title="inductive">endianness</span></a> := <a id="LittleEndian" class="idref" href="#LittleEndian"><span class="id" title="constructor">LittleEndian</span></a> | <a id="BigEndian" class="idref" href="#BigEndian"><span class="id" title="constructor">BigEndian</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="e:114" class="idref" href="#e:114"><span class="id" title="binder">e</span></a>:<a class="idref" href="#endianness"><span class="id" title="inductive">endianness</span></a>) (<a id="mem:115" class="idref" href="#mem:115"><span class="id" title="binder">mem</span></a>:<a class="idref" href="#data_page"><span class="id" title="definition">data_page</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="mb_load_word" class="idref" href="#mb_load_word"><span class="id" title="definition">mb_load_word</span></a> (<a id="addr:116" class="idref" href="#addr:116"><span class="id" title="binder">addr</span></a>:<a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>) :<a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="mb_load_result" class="idref" href="#mb_load_result"><span class="id" title="inductive">mb_load_result</span></a> : <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="mldr_apply" class="idref" href="#mldr_apply"><span class="id" title="constructor">mldr_apply</span></a>: <span class="id" title="keyword">∀</span> (<a id="addr:129" class="idref" href="#addr:129"><span class="id" title="binder">addr</span></a>:<a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>) <a id="res:130" class="idref" href="#res:130"><span class="id" title="binder">res</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mb_load_word"><span class="id" title="definition">mb_load_word</span></a> <a class="idref" href="#addr:129"><span class="id" title="variable">addr</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#res:130"><span class="id" title="variable">res</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mb_load_result:127"><span class="id" title="inductive">mb_load_result</span></a> <a class="idref" href="#addr:129"><span class="id" title="variable">addr</span></a> <a class="idref" href="#res:130"><span class="id" title="variable">res</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="mb_store_word" class="idref" href="#mb_store_word"><span class="id" title="definition">mb_store_word</span></a> (<a id="addr:131" class="idref" href="#addr:131"><span class="id" title="binder">addr</span></a>:<a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>) (<a id="val:132" class="idref" href="#val:132"><span class="id" title="binder">val</span></a>: <a class="idref" href="#word"><span class="id" title="definition">word</span></a>) : <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#data_page"><span class="id" title="definition">data_page</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="ls:134" class="idref" href="#ls:134"><span class="id" title="binder">ls</span></a> := <span class="id" title="keyword">match</span> <a class="idref" href="#Multibyte.e"><span class="id" title="variable">e</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#LittleEndian"><span class="id" title="constructor">LittleEndian</span></a> ⇒ <a class="idref" href="#word_to_bytes"><span class="id" title="definition">word_to_bytes</span></a> <a class="idref" href="#val:132"><span class="id" title="variable">val</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#BigEndian"><span class="id" title="constructor">BigEndian</span></a> ⇒<span class="id" title="definition">tuple.rev_tuple</span> (<a class="idref" href="#word_to_bytes"><span class="id" title="definition">word_to_bytes</span></a> <a class="idref" href="#val:132"><span class="id" title="variable">val</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#store_multicell"><span class="id" title="definition">store_multicell</span></a> <span class="id" title="var">_</span> <a class="idref" href="#addr:131"><span class="id" title="variable">addr</span></a> (<span class="id" title="projection">tuple.tval</span> <a class="idref" href="#ls:134"><span class="id" title="variable">ls</span></a>) <a class="idref" href="#Multibyte.mem"><span class="id" title="variable">mem</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="mb_store_word_result" class="idref" href="#mb_store_word_result"><span class="id" title="inductive">mb_store_word_result</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#data_page"><span class="id" title="definition">data_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="sdr_apply" class="idref" href="#sdr_apply"><span class="id" title="constructor">sdr_apply</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="addr:137" class="idref" href="#addr:137"><span class="id" title="binder">addr</span></a> <a id="val:138" class="idref" href="#val:138"><span class="id" title="binder">val</span></a> <a id="page':139" class="idref" href="#page':139"><span class="id" title="binder">page'</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mb_store_word"><span class="id" title="definition">mb_store_word</span></a> <a class="idref" href="#addr:137"><span class="id" title="variable">addr</span></a> <a class="idref" href="#val:138"><span class="id" title="variable">val</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#page':139"><span class="id" title="variable">page'</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mb_store_word_result:135"><span class="id" title="inductive">mb_store_word_result</span></a> <a class="idref" href="#addr:137"><span class="id" title="variable">addr</span></a> <a class="idref" href="#val:138"><span class="id" title="variable">val</span></a> <a class="idref" href="#page':139"><span class="id" title="variable">page'</span></a>.<br/>

<br/>
</div>

<div class="doc"><h2 id="reading-from-memory-slices">Reading from memory slices</h2>
<p>Reading from <span class="inlinecode"><span class="id"
title="var">slice</span></span> is particular in the following way: if
the accessed word passes over bounds, the bytes below the bound are
formally assigned zeros. See <span
class="inlinecode"><a class="idref" href="#Slices"><span
class="id" title="section">Slices</span></a></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="mb_load_slice_word" class="idref" href="#mb_load_slice_word"><span class="id" title="definition">mb_load_slice_word</span></a> (<a id="slc:140" class="idref" href="#slc:140"><span class="id" title="binder">slc</span></a>:<a class="idref" href="#data_slice"><span class="id" title="definition">data_slice</span></a>) (<a id="addr:141" class="idref" href="#addr:141"><span class="id" title="binder">addr</span></a>:<a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>) :<a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="mb_load_slice_result" class="idref" href="#mb_load_slice_result"><span class="id" title="inductive">mb_load_slice_result</span></a> (<a id="slc:152" class="idref" href="#slc:152"><span class="id" title="binder">slc</span></a>:<a class="idref" href="#data_slice"><span class="id" title="definition">data_slice</span></a>): <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="mlsr_apply" class="idref" href="#mlsr_apply"><span class="id" title="constructor">mlsr_apply</span></a>: <span class="id" title="keyword">∀</span> (<a id="addr:155" class="idref" href="#addr:155"><span class="id" title="binder">addr</span></a>:<a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>) <a id="res:156" class="idref" href="#res:156"><span class="id" title="binder">res</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mb_load_slice_word"><span class="id" title="definition">mb_load_slice_word</span></a> <a class="idref" href="#slc:152"><span class="id" title="variable">slc</span></a> <a class="idref" href="#addr:155"><span class="id" title="variable">addr</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#res:156"><span class="id" title="variable">res</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mb_load_slice_result:153"><span class="id" title="inductive">mb_load_slice_result</span></a> <a class="idref" href="#slc:152"><span class="id" title="variable">slc</span></a> <a class="idref" href="#addr:155"><span class="id" title="variable">addr</span></a> <a class="idref" href="#res:156"><span class="id" title="variable">res</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Multibyte"><span class="id" title="section">Multibyte</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.MemoryManagement</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">CallStack</span></a> <a class="idref" href="#"><span class="id" title="library">Ergs</span></a> <a class="idref" href="#"><span class="id" title="library">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="library">Pointer</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryContext</span></a> <a class="idref" href="#"><span class="id" title="module">Ergs</span></a> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="MemoryForwarding" class="idref" href="#MemoryForwarding"><span class="id" title="section">MemoryForwarding</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="state_checkpoint:1" class="idref" href="#state_checkpoint:1"><span class="id" title="binder">state_checkpoint</span></a>: <span class="id" title="keyword">Type</span>} (<a id="callstack:2" class="idref" href="#callstack:2"><span class="id" title="binder">callstack</span></a>:=@<a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="#state_checkpoint:1"><span class="id" title="variable">state_checkpoint</span></a>).<br/>

<br/>
</div>

<div class="doc"><h1 id="memory-forwarding">Memory forwarding</h1>
<p>Contracts communicate by passing each other <span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span>. Far returns and far
calls are able to:</p>
<ul>
<li>create them <span
class="inlinecode"><a class="idref" href="#ForwardNewFatPointer"><span
class="id"
title="constructor">ForwardNewFatPointer</span></a></span></li>
<li>reuse existing pointers <span
class="inlinecode"><a class="idref" href="#ForwardExistingFatPointer"><span
class="id"
title="constructor">ForwardExistingFatPointer</span></a></span>.</li>
</ul>
<p>They chose the action based on an instance of <span
class="inlinecode"><a class="idref" href="#fwd_memory"><span
class="id" title="inductive">fwd_memory</span></a></span> passed through
ABIs.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="fwd_memory" class="idref" href="#fwd_memory"><span class="id" title="inductive">fwd_memory</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a id="ForwardExistingFatPointer" class="idref" href="#ForwardExistingFatPointer"><span class="id" title="constructor">ForwardExistingFatPointer</span></a> (<a id="p:5" class="idref" href="#p:5"><span class="id" title="binder">p</span></a>:<a class="idref" href="#fat_ptr_nullable"><span class="id" title="inductive">fat_ptr_nullable</span></a>)<br/>
&nbsp;&nbsp;| <a id="ForwardNewFatPointer" class="idref" href="#ForwardNewFatPointer"><span class="id" title="constructor">ForwardNewFatPointer</span></a> (<a id="heap_var:6" class="idref" href="#heap_var:6"><span class="id" title="binder">heap_var</span></a>: <a class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a>) (<a id="s:7" class="idref" href="#s:7"><span class="id" title="binder">s</span></a>:<a class="idref" href="#span"><span class="id" title="record">span</span></a>).<br/>

<br/>
</div>

<div class="doc"><ul>
<li>A fat pointer defines a <span class="inlinecode"><span class="id"
title="var">slice</span></span> of memory and provides a read-only
access to it.</li>
<li>Fat pointers are created from a slice of heap or auxheap of a
current contract.</li>
<li>If the <span
class="inlinecode"><a class="idref" href="#span"><span
class="id" title="record">span</span></a></span> of a new fat pointer
crosses the heap boundary <span
class="inlinecode"><a class="idref" href="#heap_variant_bound"><span
class="id" title="definition">heap_variant_bound</span></a></span> then
the heap has to grow, and that difference has to be paid for.</li>
<li><span
class="inlinecode"><a class="idref" href="#growth_query"><span
class="id" title="definition">growth_query</span></a></span> defines by
how much a a heap variant should be grown.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="growth_query" class="idref" href="#growth_query"><span class="id" title="definition">growth_query</span></a> := @<a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (<a class="idref" href="#prod"><span class="id" title="inductive">prod</span></a> <a class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a> <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="cost_of_growth" class="idref" href="#cost_of_growth"><span class="id" title="definition">cost_of_growth</span></a> (<a id="diff:8" class="idref" href="#diff:8"><span class="id" title="binder">diff</span></a>:<a class="idref" href="#growth_query"><span class="id" title="definition">growth_query</span></a>) : <a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#diff:8"><span class="id" title="variable">diff</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">x</span><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> ⇒ <a class="idref" href="#growth_cost"><span class="id" title="definition">Ergs.growth_cost</span></a> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> ⇒  <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="growth_to_bound" class="idref" href="#growth_to_bound"><span class="id" title="inductive">growth_to_bound</span></a>: <a class="idref" href="#page_bound"><span class="id" title="definition">page_bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#MemoryForwarding.callstack"><span class="id" title="variable">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#growth_query"><span class="id" title="definition">growth_query</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="goq_grow" class="idref" href="#goq_grow"><span class="id" title="constructor">goq_grow</span></a>: <span class="id" title="keyword">∀</span> (<a id="hv:12" class="idref" href="#hv:12"><span class="id" title="binder">hv</span></a>:<a class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a>) (<a id="cs:13" class="idref" href="#cs:13"><span class="id" title="binder">cs</span></a>: <a class="idref" href="#MemoryForwarding.callstack"><span class="id" title="variable">callstack</span></a>) <a id="diff:14" class="idref" href="#diff:14"><span class="id" title="binder">diff</span></a> <a id="query:15" class="idref" href="#query:15"><span class="id" title="binder">query</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="current_bound:16" class="idref" href="#current_bound:16"><span class="id" title="binder">current_bound</span></a> : <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a> := <a class="idref" href="#heap_variant_bound"><span class="id" title="definition">heap_variant_bound</span></a> <a class="idref" href="#cs:13"><span class="id" title="variable">cs</span></a> <a class="idref" href="#hv:12"><span class="id" title="variable">hv</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#query:15"><span class="id" title="variable">query</span></a> <a class="idref" href="#::ZMod_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="#current_bound:16"><span class="id" title="variable">current_bound</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#diff:14"><span class="id" title="variable">diff</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#growth_to_bound:10"><span class="id" title="inductive">growth_to_bound</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#hv:12"><span class="id" title="variable">hv</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#query:15"><span class="id" title="variable">query</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#cs:13"><span class="id" title="variable">cs</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#hv:12"><span class="id" title="variable">hv</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#diff:14"><span class="id" title="variable">diff</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)<br/>
&nbsp;&nbsp;| <a id="goq_nogrow" class="idref" href="#goq_nogrow"><span class="id" title="constructor">goq_nogrow</span></a>: <span class="id" title="keyword">∀</span> <a id="hv:17" class="idref" href="#hv:17"><span class="id" title="binder">hv</span></a> (<a id="cs:18" class="idref" href="#cs:18"><span class="id" title="binder">cs</span></a>: <a class="idref" href="#MemoryForwarding.callstack"><span class="id" title="variable">callstack</span></a>) <a id="__:19" class="idref" href="#__:19"><span class="id" title="binder">__</span></a> <a id="query:20" class="idref" href="#query:20"><span class="id" title="binder">query</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="current_bound:21" class="idref" href="#current_bound:21"><span class="id" title="binder">current_bound</span></a> := <a class="idref" href="#heap_variant_bound"><span class="id" title="definition">heap_variant_bound</span></a> <a class="idref" href="#cs:18"><span class="id" title="variable">cs</span></a> <a class="idref" href="#hv:17"><span class="id" title="variable">hv</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#query:20"><span class="id" title="variable">query</span></a> <a class="idref" href="#::ZMod_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="#current_bound:21"><span class="id" title="variable">current_bound</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#true"><span class="id" title="constructor">true</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#__:19"><span class="id" title="variable">__</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#growth_to_bound:10"><span class="id" title="inductive">growth_to_bound</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#hv:17"><span class="id" title="variable">hv</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#query:20"><span class="id" title="variable">query</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#cs:18"><span class="id" title="variable">cs</span></a> <a class="idref" href="#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="grow" class="idref" href="#grow"><span class="id" title="inductive">grow</span></a>: <a class="idref" href="#growth_query"><span class="id" title="definition">growth_query</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#MemoryForwarding.callstack"><span class="id" title="variable">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#MemoryForwarding.callstack"><span class="id" title="variable">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="gr_grow" class="idref" href="#gr_grow"><span class="id" title="constructor">gr_grow</span></a>: <span class="id" title="keyword">∀</span> <a id="hv:24" class="idref" href="#hv:24"><span class="id" title="binder">hv</span></a> <a id="cs1:25" class="idref" href="#cs1:25"><span class="id" title="binder">cs1</span></a> <a id="cs2:26" class="idref" href="#cs2:26"><span class="id" title="binder">cs2</span></a> <a id="diff:27" class="idref" href="#diff:27"><span class="id" title="binder">diff</span></a> <a id="new_apages:28" class="idref" href="#new_apages:28"><span class="id" title="binder">new_apages</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="apages:29" class="idref" href="#apages:29"><span class="id" title="binder">apages</span></a> := <a class="idref" href="#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a> <a class="idref" href="#cs1:25"><span class="id" title="variable">cs1</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#grow_heap_variant"><span class="id" title="inductive">grow_heap_variant</span></a> <a class="idref" href="#hv:24"><span class="id" title="variable">hv</span></a> <a class="idref" href="#diff:27"><span class="id" title="variable">diff</span></a> <a class="idref" href="#apages:29"><span class="id" title="variable">apages</span></a> <a class="idref" href="#new_apages:28"><span class="id" title="variable">new_apages</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#cs2:26"><span class="id" title="variable">cs2</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#update_memory_context"><span class="id" title="definition">update_memory_context</span></a> <a class="idref" href="#new_apages:28"><span class="id" title="variable">new_apages</span></a> <a class="idref" href="#cs1:25"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#grow:22"><span class="id" title="inductive">grow</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#hv:24"><span class="id" title="variable">hv</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#diff:27"><span class="id" title="variable">diff</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) <a class="idref" href="#cs1:25"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#cs2:26"><span class="id" title="variable">cs2</span></a><br/>
&nbsp;&nbsp;| <a id="gr_nogrow" class="idref" href="#gr_nogrow"><span class="id" title="constructor">gr_nogrow</span></a>: <span class="id" title="keyword">∀</span> <a id="cs:30" class="idref" href="#cs:30"><span class="id" title="binder">cs</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#grow:22"><span class="id" title="inductive">grow</span></a> <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="#cs:30"><span class="id" title="variable">cs</span></a> <a class="idref" href="#cs:30"><span class="id" title="variable">cs</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="bound_grow_pay" class="idref" href="#bound_grow_pay"><span class="id" title="inductive">bound_grow_pay</span></a>: <a class="idref" href="#page_bound"><span class="id" title="definition">page_bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#MemoryForwarding.callstack"><span class="id" title="variable">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#MemoryForwarding.callstack"><span class="id" title="variable">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="bgp_apply" class="idref" href="#bgp_apply"><span class="id" title="constructor">bgp_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="bound:33" class="idref" href="#bound:33"><span class="id" title="binder">bound</span></a> <a id="query:34" class="idref" href="#query:34"><span class="id" title="binder">query</span></a> <a id="cs1:35" class="idref" href="#cs1:35"><span class="id" title="binder">cs1</span></a> <a id="cs2:36" class="idref" href="#cs2:36"><span class="id" title="binder">cs2</span></a> <a id="cs3:37" class="idref" href="#cs3:37"><span class="id" title="binder">cs3</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#growth_to_bound"><span class="id" title="inductive">growth_to_bound</span></a> <a class="idref" href="#bound:33"><span class="id" title="variable">bound</span></a> <a class="idref" href="#cs1:35"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#query:34"><span class="id" title="variable">query</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pay"><span class="id" title="inductive">pay</span></a> (<a class="idref" href="#cost_of_growth"><span class="id" title="definition">cost_of_growth</span></a> <a class="idref" href="#query:34"><span class="id" title="variable">query</span></a>) <a class="idref" href="#cs1:35"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#cs2:36"><span class="id" title="variable">cs2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#grow"><span class="id" title="inductive">grow</span></a> <a class="idref" href="#query:34"><span class="id" title="variable">query</span></a> <a class="idref" href="#cs2:36"><span class="id" title="variable">cs2</span></a> <a class="idref" href="#cs3:37"><span class="id" title="variable">cs3</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bound_grow_pay:31"><span class="id" title="inductive">bound_grow_pay</span></a> <a class="idref" href="#bound:33"><span class="id" title="variable">bound</span></a> <a class="idref" href="#cs1:35"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#cs3:37"><span class="id" title="variable">cs3</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="span_grow_pay" class="idref" href="#span_grow_pay"><span class="id" title="inductive">span_grow_pay</span></a>: <a class="idref" href="#span"><span class="id" title="record">span</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#MemoryForwarding.callstack"><span class="id" title="variable">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#MemoryForwarding.callstack"><span class="id" title="variable">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="sgp_apply" class="idref" href="#sgp_apply"><span class="id" title="constructor">sgp_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="s:40" class="idref" href="#s:40"><span class="id" title="binder">s</span></a> <a id="hv:41" class="idref" href="#hv:41"><span class="id" title="binder">hv</span></a> <a id="cs1:42" class="idref" href="#cs1:42"><span class="id" title="binder">cs1</span></a> <a id="cs2:43" class="idref" href="#cs2:43"><span class="id" title="binder">cs2</span></a> <a id="bound:44" class="idref" href="#bound:44"><span class="id" title="binder">bound</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bound_of_span"><span class="id" title="inductive">bound_of_span</span></a> <a class="idref" href="#s:40"><span class="id" title="variable">s</span></a> <a class="idref" href="#hv:41"><span class="id" title="variable">hv</span></a> <a class="idref" href="#bound:44"><span class="id" title="variable">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bound_grow_pay"><span class="id" title="inductive">bound_grow_pay</span></a> <a class="idref" href="#bound:44"><span class="id" title="variable">bound</span></a> <a class="idref" href="#cs1:42"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#cs2:43"><span class="id" title="variable">cs2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#span_grow_pay:38"><span class="id" title="inductive">span_grow_pay</span></a> <a class="idref" href="#s:40"><span class="id" title="variable">s</span></a> <a class="idref" href="#hv:41"><span class="id" title="variable">hv</span></a> <a class="idref" href="#cs1:42"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#cs2:43"><span class="id" title="variable">cs2</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="paid_forward_new_fat_ptr" class="idref" href="#paid_forward_new_fat_ptr"><span class="id" title="inductive">paid_forward_new_fat_ptr</span></a>: <a class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#span"><span class="id" title="record">span</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#MemoryForwarding.callstack"><span class="id" title="variable">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#fat_ptr"><span class="id" title="record">fat_ptr</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#MemoryForwarding.callstack"><span class="id" title="variable">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="pfnfp_apply" class="idref" href="#pfnfp_apply"><span class="id" title="constructor">pfnfp_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="s:47" class="idref" href="#s:47"><span class="id" title="binder">s</span></a> <a id="heap_id:48" class="idref" href="#heap_id:48"><span class="id" title="binder">heap_id</span></a> <a id="type:49" class="idref" href="#type:49"><span class="id" title="binder">type</span></a> <a id="cs0:50" class="idref" href="#cs0:50"><span class="id" title="binder">cs0</span></a> <a id="cs1:51" class="idref" href="#cs1:51"><span class="id" title="binder">cs1</span></a> ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#span_grow_pay"><span class="id" title="inductive">span_grow_pay</span></a> <a class="idref" href="#s:47"><span class="id" title="variable">s</span></a> <a class="idref" href="#type:49"><span class="id" title="variable">type</span></a> <a class="idref" href="#cs0:50"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#cs1:51"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#heap_id:48"><span class="id" title="variable">heap_id</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#heap_variant_page_id"><span class="id" title="definition">heap_variant_page_id</span></a> <a class="idref" href="#cs0:50"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#type:49"><span class="id" title="variable">type</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#paid_forward_new_fat_ptr:45"><span class="id" title="inductive">paid_forward_new_fat_ptr</span></a> <a class="idref" href="#type:49"><span class="id" title="variable">type</span></a> <a class="idref" href="#s:47"><span class="id" title="variable">s</span></a> <a class="idref" href="#cs0:50"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#mk_fat_ptr"><span class="id" title="constructor">mk_fat_ptr</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#heap_id:48"><span class="id" title="variable">heap_id</span></a>) (<a class="idref" href="#fresh_ptr"><span class="id" title="definition">fresh_ptr</span></a> <a class="idref" href="#s:47"><span class="id" title="variable">s</span></a>)<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#cs1:51"><span class="id" title="variable">cs1</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="growth_to_bound_unaffordable" class="idref" href="#growth_to_bound_unaffordable"><span class="id" title="inductive">growth_to_bound_unaffordable</span></a> (<a id="cs:52" class="idref" href="#cs:52"><span class="id" title="binder">cs</span></a>:<a class="idref" href="#MemoryForwarding.callstack"><span class="id" title="variable">callstack</span></a>) <a id="bound:53" class="idref" href="#bound:53"><span class="id" title="binder">bound</span></a> : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="gtb_apply" class="idref" href="#gtb_apply"><span class="id" title="constructor">gtb_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="query:56" class="idref" href="#query:56"><span class="id" title="binder">query</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#growth_to_bound"><span class="id" title="inductive">growth_to_bound</span></a> <a class="idref" href="#bound:53"><span class="id" title="variable">bound</span></a> <a class="idref" href="#cs:52"><span class="id" title="variable">cs</span></a> <a class="idref" href="#query:56"><span class="id" title="variable">query</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#affordable"><span class="id" title="definition">affordable</span></a> <a class="idref" href="#cs:52"><span class="id" title="variable">cs</span></a> (<a class="idref" href="#cost_of_growth"><span class="id" title="definition">cost_of_growth</span></a> <a class="idref" href="#query:56"><span class="id" title="variable">query</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#growth_to_bound_unaffordable:54"><span class="id" title="inductive">growth_to_bound_unaffordable</span></a> <a class="idref" href="#cs:52"><span class="id" title="variable">cs</span></a> <a class="idref" href="#bound:53"><span class="id" title="variable">bound</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="growth_to_span_unaffordable" class="idref" href="#growth_to_span_unaffordable"><span class="id" title="inductive">growth_to_span_unaffordable</span></a> (<a id="cs:57" class="idref" href="#cs:57"><span class="id" title="binder">cs</span></a>:<a class="idref" href="#MemoryForwarding.callstack"><span class="id" title="variable">callstack</span></a>) <a id="heap_type:58" class="idref" href="#heap_type:58"><span class="id" title="binder">heap_type</span></a> <a id="hspan:59" class="idref" href="#hspan:59"><span class="id" title="binder">hspan</span></a> : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="gts_apply" class="idref" href="#gts_apply"><span class="id" title="constructor">gts_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="bound:62" class="idref" href="#bound:62"><span class="id" title="binder">bound</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bound_of_span"><span class="id" title="inductive">bound_of_span</span></a> <a class="idref" href="#hspan:59"><span class="id" title="variable">hspan</span></a> <a class="idref" href="#heap_type:58"><span class="id" title="variable">heap_type</span></a> <a class="idref" href="#bound:62"><span class="id" title="variable">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#growth_to_bound_unaffordable"><span class="id" title="inductive">growth_to_bound_unaffordable</span></a> <a class="idref" href="#cs:57"><span class="id" title="variable">cs</span></a> <a class="idref" href="#bound:62"><span class="id" title="variable">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#growth_to_span_unaffordable:60"><span class="id" title="inductive">growth_to_span_unaffordable</span></a> <a class="idref" href="#cs:57"><span class="id" title="variable">cs</span></a> <a class="idref" href="#heap_type:58"><span class="id" title="variable">heap_type</span></a> <a class="idref" href="#hspan:59"><span class="id" title="variable">hspan</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#MemoryForwarding"><span class="id" title="section">MemoryForwarding</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.Addressing</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Common</span></a> <a class="idref" href="#"><span class="id" title="library">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="library">GPR</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">GPR</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Addressing" class="idref" href="#Addressing"><span class="id" title="section">Addressing</span></a>.<br/>
</div>

<div class="doc"><h1 id="addressing-modes">Addressing modes</h1>
<p>This section describes the addressing modes in <span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span>. Section
<span
class="inlinecode"><a class="idref" href="#Addressing.InstructionArguments"><span
class="id" title="section">InstructionArguments</span></a></span>
describes the types of the instruction arguments; each type corresponds
to one or multiple possible addressing modes. Assembly instruction
formats with the types of their arguments are described by <span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span>.</p>
<p>Core instructions <span
class="inlinecode"><a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span> <span
class="inlinecode"><a class="idref" href="#decoded"><span
class="id" title="definition">decoded</span></a></span> have different
types of operands detailed by <span
class="inlinecode"><a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span> and <span
class="inlinecode"><a class="idref" href="#decoded"><span
class="id" title="definition">decoded</span></a></span>.</p>
<p><strong>Operands</strong> are entities operated upon by instructions.
They serve as sources of data, or as destinations for the results of the
instruction execution.</p>
<p><strong>Addressing mode</strong> refers to the way in which an
instruction specifies the location of data that needs to be accessed or
operated upon.</p>
<p>Abstract EraVM supports 8 addressing modes. Some of them only support
reading (indicated by “in”), or writing (indicated by “out”).</p>
<ol type="1">
<li><p>Register (in/out).</p>
<p><em>Concrete syntax example</em>. Use <code>r1</code> as a
source:</p>
<pre><code>add r1, r0, r3</code></pre></li>
<li><p>Imm (in)</p>
<p><em>Concrete syntax example</em>. Use immediate <code>42</code> as a
source:</p>
<pre><code>add 42, r0, r3</code></pre></li>
<li><p>Code page, relative to GPR (in)</p>
<p><em>Concrete syntax example</em>. Use 42-th <span
class="inlinecode"><a class="idref" href="#word"><span
class="id" title="definition">word</span></a></span> on the code page as
a source:</p>
<pre><code>add code[42], r0, r3</code></pre>
<p>Note: words are enumerated starting at 0, each word contains 4
instructions, adjacent words are disjoint.</p></li>
<li><p>Const page, relative to GPR (in)</p>
<p>Currently, the concrete syntax is absent because code and constant
pages coincide in current EraVM implementation. Use the following
instead:</p>
<pre><code>add code[42], r0, r3</code></pre></li>
<li><p>Stack page, relative to GPR (in/out)</p>
<p><em>Concrete syntax example</em>. Use <code>(r1+42)</code>-th <span
class="inlinecode"><a class="idref" href="#word"><span
class="id" title="definition">word</span></a></span> on the stack page
as a source has two equivalent forms:</p>
<pre><code>add stack[r1+42], r0, r3
add stack=[r1+42], r0, r3</code></pre></li>
<li><p>Stack page, relative to GPR and SP (in/out)</p>
<p><em>Concrete syntax example</em>. Use <code>(r1+42)</code>-th <span
class="inlinecode"><a class="idref" href="#word"><span
class="id" title="definition">word</span></a></span> relative to SP on
the stack page as a source:</p>
<pre><code>add stack-[r1+42], r0, r3</code></pre>
<p>Note, that the following form is forbidden:</p>
<pre><code>add stack+[r1+42], r0, r3</code></pre></li>
<li><p>Stack page, relative to GPR and SP, with decreasing SP (in)</p>
<p><em>Concrete syntax example</em>. Use <code>SP-(r1+42)</code>-th
<span
class="inlinecode"><a class="idref" href="#word"><span
class="id" title="definition">word</span></a></span> on the stack page
as a source:</p>
<pre><code>add stack-=[r1+42], r0, r3</code></pre>
<p>Note, that the following form is forbidden:</p>
<pre><code>add stack+=[r1+42], r0, r3</code></pre></li>
<li><p>Stack page, relative to GPR and SP, with increasing SP (out)</p>
<p><em>Concrete syntax example</em>. Use <code>SP+(r1+42)</code>-th
<span
class="inlinecode"><a class="idref" href="#word"><span
class="id" title="definition">word</span></a></span> on the stack page
as a destination:</p>
<pre><code>add r3, r0, stack+=[r1+42]</code></pre></li>
</ol>
<p>Note that the current implementation encodes some of these modes in
the same way e.g. mode 7 and mode 8 only differ by <em>in</em> or
<em>out</em> position.</p>
<p>Predicate <span
class="inlinecode"><a class="idref" href="#resolve"><span
class="id" title="inductive">resolve</span></a></span> formalizes
resolving operands to immediate values, registers and memory
locations.</p>
<p><span
class="inlinecode"><a class="idref" href="#MemoryOps"><span
class="id" title="section">MemoryOps</span></a></span> formalizes
reading and writing to locations.</p>
<ol type="1">
<li><p><strong>Register addressing</strong> (in/out)</p>
<ul>
<li><p>Refers to one of General Purpose Registers (GPR).</p></li>
<li><p><em>Concrete syntax example</em>. Use <code>r1</code> as a
source:</p>
<pre><code>add r1, r0, r3</code></pre></li>
</ul></li>
</ol>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="reg_io" class="idref" href="#reg_io"><span class="id" title="inductive">reg_io</span></a> : <span class="id" title="keyword">Type</span> := <a id="Reg" class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> (<a id="reg:3" class="idref" href="#reg:3"><span class="id" title="binder">reg</span></a>:<a class="idref" href="#reg_name"><span class="id" title="inductive">reg_name</span></a>).<br/>

<br/>
</div>

<div class="doc"><ol start="2" type="1">
<li><p><strong>Immediate 16-bit value</strong> (in)</p>
<ul>
<li><p><em>Concrete syntax example</em>. Use immediate <code>42</code>
as a source:</p>
<pre><code>add 42, r0, r3</code></pre>
<p>Note that negative imm operands may be supported by the assembler,
for example:</p>
<pre><code>add -42, r0, r3</code></pre></li>
</ul></li>
</ol>
<p>However, the implementation will have to proceed as follows:</p>
<ul>
<li>put a negative immediate <code>-42</code> on a const page to an
address <span class="math inline">C</span>, as a 2’s complement, 256-bit
wide;</li>
<li>using the <span
class="inlinecode"><a class="idref" href="#const_in"><span
class="id" title="inductive">const_in</span></a></span> addessing mode,
address the <span class="math inline">C</span>-th constant, as in the
following pseudocode:</li>
</ul>
<pre><code>add code[C], r0, r3</code></pre>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="imm_in" class="idref" href="#imm_in"><span class="id" title="inductive">imm_in</span></a> : <span class="id" title="keyword">Type</span> := <a id="Imm" class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> (<a id="imm:6" class="idref" href="#imm:6"><span class="id" title="binder">imm</span></a>: <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a>).<br/>

<br/>
</div>

<div class="doc"><ol start="3" type="1">
<li><p><strong>Address on a code page, relative to a GPR</strong>
(in)</p>
<ul>
<li><p>Resolved to <span class="math inline">\mathit{(reg + imm) \mod
2^{16}}</span>. See <span
class="inlinecode"><a class="idref" href="#rslv_code"><span
class="id" title="constructor">rslv_code</span></a></span>.</p></li>
<li><p>Code and const pages may coincide in the implementation.</p></li>
<li><p><em>Concrete syntax example</em>. Use 42-th <span
class="inlinecode"><a class="idref" href="#word"><span
class="id" title="definition">word</span></a></span> on the code page as
a source:</p>
<pre><code>add code[42], r0, r3</code></pre>
<p>Note: words are enumerated starting at 0, each word contains 4
instructions, adjacent words are disjoint.</p></li>
</ul></li>
</ol>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="code_in" class="idref" href="#code_in"><span class="id" title="inductive">code_in</span></a> : <span class="id" title="keyword">Type</span> := <a id="CodeAddr" class="idref" href="#CodeAddr"><span class="id" title="constructor">CodeAddr</span></a> (<a id="reg:9" class="idref" href="#reg:9"><span class="id" title="binder">reg</span></a>:<a class="idref" href="#reg_name"><span class="id" title="inductive">reg_name</span></a>) (<a id="imm:10" class="idref" href="#imm:10"><span class="id" title="binder">imm</span></a>:<a class="idref" href="#code_address"><span class="id" title="definition">code_address</span></a>).<br/>

<br/>
</div>

<div class="doc"><ol start="4" type="1">
<li><p><strong>Address on a const page, relative to a GPR</strong>
(in)</p>
<ul>
<li><p>Resolved to <span class="math inline">\mathit{(reg + imm) \mod
2^{16}}</span>. See <span
class="inlinecode"><a class="idref" href="#rslv_const"><span
class="id" title="constructor">rslv_const</span></a></span>.</p></li>
<li><p>Code and const pages may coincide.</p></li>
<li><p>Currently, the concrete syntax is absent because code and
constant pages coincide in current EraVM implementation. Use the
following instead:</p>
<pre><code>add code[42], r0, r3</code></pre></li>
</ul></li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="const_in" class="idref" href="#const_in"><span class="id" title="inductive">const_in</span></a>: <span class="id" title="keyword">Type</span> := <a id="ConstAddr" class="idref" href="#ConstAddr"><span class="id" title="constructor">ConstAddr</span></a> (<a id="reg:13" class="idref" href="#reg:13"><span class="id" title="binder">reg</span></a>:<a class="idref" href="#reg_name"><span class="id" title="inductive">reg_name</span></a>) (<a id="imm:14" class="idref" href="#imm:14"><span class="id" title="binder">imm</span></a>:<a class="idref" href="#code_address"><span class="id" title="definition">code_address</span></a>).<br/>

<br/>
</div>

<div class="doc"><ol start="5" type="1">
<li><p><strong>Address on a stack page, relative to a GPR</strong>
(in/out)</p>
<ul>
<li><p>Resolved to <span class="math inline">\mathit{(reg + imm)\mod
2^{16}}</span>. See <span
class="inlinecode"><a class="idref" href="#rslv_stack_abs"><span
class="id"
title="constructor">rslv_stack_abs</span></a></span>.</p></li>
<li><p><em>Concrete syntax example</em>. Use <code>(r1+42)</code>-th
<span
class="inlinecode"><a class="idref" href="#word"><span
class="id" title="definition">word</span></a></span> on the stack page
as a source has two equivalent forms:</p>
<pre><code>add stack[r1+42], r0, r3
add stack=[r1+42], r0, r3</code></pre></li>
</ul></li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="stack_io" class="idref" href="#stack_io"><span class="id" title="inductive">stack_io</span></a> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <a id="Absolute" class="idref" href="#Absolute"><span class="id" title="constructor">Absolute</span></a> (<a id="reg:17" class="idref" href="#reg:17"><span class="id" title="binder">reg</span></a>:<a class="idref" href="#reg_name"><span class="id" title="inductive">reg_name</span></a>) (<a id="imm:18" class="idref" href="#imm:18"><span class="id" title="binder">imm</span></a>: <a class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a>)<br/>
<br/>
&nbsp;&nbsp;</div>

<div class="doc"><ol start="6" type="1">
<li><p><strong>Address on a stack page, relative to SP and
GPR</strong></p>
<ul>
<li><p>Resolved to <span class="math inline">\mathit{(SP - (reg +
imm))\mod 2^{16}}</span>. See <span
class="inlinecode"><a class="idref" href="#rslv_stack_rel"><span
class="id"
title="constructor">rslv_stack_rel</span></a></span>.</p></li>
<li><p>Unlike <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span>, the direction
of offset does not change depending on read/write.</p></li>
<li><p><em>Concrete syntax example</em>. Use <code>(r1+42)</code>-th
<span
class="inlinecode"><a class="idref" href="#word"><span
class="id" title="definition">word</span></a></span> relative to SP on
the stack page as a source:</p>
<pre><code>add stack-[r1+42], r0, r3</code></pre>
<p>Note, that the following form is forbidden:</p>
<pre><code>add stack+[r1+42], r0, r3</code></pre></li>
</ul></li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="RelSP" class="idref" href="#RelSP"><span class="id" title="constructor">RelSP</span></a>    (<a id="reg:19" class="idref" href="#reg:19"><span class="id" title="binder">reg</span></a>:<a class="idref" href="#reg_name"><span class="id" title="inductive">reg_name</span></a>) (<a id="offset:20" class="idref" href="#offset:20"><span class="id" title="binder">offset</span></a>: <a class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a>)<br/>
&nbsp;&nbsp;.<br/>

<br/>
</div>

<div class="doc"><ol start="7" type="1">
<li><p><strong>Stack page, relative to GPR and SP, accompanied by
decreasing SP (in).</strong></p>
<ul>
<li><p>A generalized version of <code>pop</code> operation.</p></li>
<li><p>Resolved to <span class="math inline">\mathit{(SP - (reg +
imm))\mod 2^{16}}</span>. See <span
class="inlinecode"><a class="idref" href="#rslv_stack_rel"><span
class="id"
title="constructor">rslv_stack_rel</span></a></span>.</p></li>
<li><p>Additionally, after the resolution, SP is modified:
<code>SP -= (reg + imm)</code>.</p></li>
<li><p><em>Concrete syntax example</em>. Use <code>SP-(r1+42)</code>-th
<span
class="inlinecode"><a class="idref" href="#word"><span
class="id" title="definition">word</span></a></span> on the stack page
as a source:</p>
<pre><code>add stack-=[r1+42], r0, r3</code></pre>
<p>Note, that the following form is forbidden:</p>
<pre><code>add stack+=[r1+42], r0, r3</code></pre></li>
</ul></li>
</ol>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="stack_in_only" class="idref" href="#stack_in_only"><span class="id" title="inductive">stack_in_only</span></a> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <a id="RelSpPop" class="idref" href="#RelSpPop"><span class="id" title="constructor">RelSpPop</span></a> (<a id="reg:23" class="idref" href="#reg:23"><span class="id" title="binder">reg</span></a>:<a class="idref" href="#reg_name"><span class="id" title="inductive">reg_name</span></a>) (<a id="offset:24" class="idref" href="#offset:24"><span class="id" title="binder">offset</span></a>: <a class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a>)<br/>
&nbsp;&nbsp;.<br/>

<br/>
</div>

<div class="doc"><ol start="8" type="1">
<li><p><strong>Stack page, relative to GPR and SP, accompanied by
increasing SP (out).</strong></p>
<ul>
<li><p>A generalized version of <code>push</code> operation.</p></li>
<li><p>Resolved to <span class="math inline">\mathit{(SP + (reg +
imm))\mod 2^{16}}</span>.</p></li>
<li><p>Additionally, after the resolution, SP is modified:
<code>SP += (reg + imm)</code>.</p></li>
<li><p><em>Concrete syntax example</em>. Use <code>SP+(r1+42)</code>-th
<span
class="inlinecode"><a class="idref" href="#word"><span
class="id" title="definition">word</span></a></span> on the stack page
as a destination:</p>
<pre><code>add r3, r0, stack+=[r1+42]</code></pre></li>
</ul>
<p><strong>WARNING: KNOWN DIVERGENCE (in versions prior to
v1.4.1)</strong> implementation of earlier versions diverged from the
described spec:</p>
<ul>
<li>Implementation: the write happens to the new SP address</li>
<li>Specification: the write happens to the old SP address</li>
</ul>
<p>Since v 1.4.1 the implementation conforms to the spec.</p></li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="stack_out_only" class="idref" href="#stack_out_only"><span class="id" title="inductive">stack_out_only</span></a> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <a id="RelSpPush" class="idref" href="#RelSpPush"><span class="id" title="constructor">RelSpPush</span></a> (<a id="reg:27" class="idref" href="#reg:27"><span class="id" title="binder">reg</span></a>:<a class="idref" href="#reg_name"><span class="id" title="inductive">reg_name</span></a>) (<a id="offset:28" class="idref" href="#offset:28"><span class="id" title="binder">offset</span></a>: <a class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a>)<br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Addressing.InstructionArguments" class="idref" href="#Addressing.InstructionArguments"><span class="id" title="section">InstructionArguments</span></a>.<br/>
</div>

<div class="doc"><h1 id="operand-types">Operand types</h1>
<p>This section details the types of operand for <span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span>. The
types of operands for <span
class="inlinecode"><a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span> are different
and detailed by <span
class="inlinecode"><a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span>, <span
class="inlinecode"><a class="idref" href="#descr"><span
class="id" title="record">descr</span></a></span>, <span
class="inlinecode"><a class="idref" href="#decoded"><span
class="id" title="definition">decoded</span></a></span> and <span
class="inlinecode"><a class="idref" href="#bound"><span
class="id" title="definition">bound</span></a></span>.</p>
<p>Instruction may have <em>input</em> and <em>output</em> operands.</p>
<ul>
<li><p>There are three types of input operands:</p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a></span> : read from a
GPR.</li>
<li><span
class="inlinecode"><a class="idref" href="#in_any"><span
class="id" title="inductive">in_any</span></a></span> : read from reg,
immediate value, or any memory. May be a generalized pop <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span>.</li>
<li><span
class="inlinecode"><a class="idref" href="#in_regimm"><span
class="id" title="inductive">in_regimm</span></a></span> read from
either reg or immmediate value.</li>
</ul></li>
<li><p>There are two types of input operands:</p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a></span> : store to a
GPR.</li>
<li><span
class="inlinecode"><a class="idref" href="#out_any"><span
class="id" title="inductive">out_any</span></a></span> : store to a GPR
or any writable memory location. May be a generalized push <span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span>.</li>
</ul></li>
</ul>
<p>To describe these types, we create a hierarchy of subtypes ordered by
inclusion (see <span
class="inlinecode"><a class="idref" href="#Coercions"><span
class="id" title="module">Coercions</span></a></span>).</p>
<p>We denote input arguments as <span
class="math inline">\mathit{in_1}</span>, <span
class="math inline">\mathit{in_2}</span>, and output arguments as <span
class="math inline">\mathit{out_1}</span>, <span
class="math inline">\mathit{out_2}</span>. Many instructions have 2
input arguments and 1 output argument. The encoding limits the number of
arguments of type <span
class="inlinecode"><a class="idref" href="#in_any"><span
class="id" title="inductive">in_any</span></a></span> and <span
class="inlinecode"><a class="idref" href="#out_any"><span
class="id" title="inductive">out_any</span></a></span>:</p>
<ul>
<li>For each instruction, there can be no more one argument of type
<span
class="inlinecode"><a class="idref" href="#in_any"><span
class="id" title="inductive">in_any</span></a></span>.</li>
<li>For each instruction, there can be no more one argument of type
<span
class="inlinecode"><a class="idref" href="#out_any"><span
class="id" title="inductive">out_any</span></a></span>.</li>
</ul>
<p>It is allowed to have both <span
class="inlinecode"><a class="idref" href="#in_any"><span
class="id" title="inductive">in_any</span></a></span> and <span
class="inlinecode"><a class="idref" href="#out_any"><span
class="id" title="inductive">out_any</span></a></span> in the same
instruction.</p>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="stack_in" class="idref" href="#stack_in"><span class="id" title="inductive">stack_in</span></a> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="StackInOnly" class="idref" href="#StackInOnly"><span class="id" title="constructor">StackInOnly</span></a> (<a id="arg:31" class="idref" href="#arg:31"><span class="id" title="binder">arg</span></a>: <a class="idref" href="#stack_in_only"><span class="id" title="inductive">stack_in_only</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="StackInAny" class="idref" href="#StackInAny"><span class="id" title="constructor">StackInAny</span></a> (<a id="arg:32" class="idref" href="#arg:32"><span class="id" title="binder">arg</span></a>: <a class="idref" href="#stack_io"><span class="id" title="inductive">stack_io</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="stack_out" class="idref" href="#stack_out"><span class="id" title="inductive">stack_out</span></a>: <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="StackOutOnly" class="idref" href="#StackOutOnly"><span class="id" title="constructor">StackOutOnly</span></a> (<a id="arg:35" class="idref" href="#arg:35"><span class="id" title="binder">arg</span></a>: <a class="idref" href="#stack_out_only"><span class="id" title="inductive">stack_out_only</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="StackOutAny" class="idref" href="#StackOutAny"><span class="id" title="constructor">StackOutAny</span></a> (<a id="arg:36" class="idref" href="#arg:36"><span class="id" title="binder">arg</span></a>: <a class="idref" href="#stack_io"><span class="id" title="inductive">stack_io</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="stack_any" class="idref" href="#stack_any"><span class="id" title="inductive">stack_any</span></a> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="StackAnyIO" class="idref" href="#StackAnyIO"><span class="id" title="constructor">StackAnyIO</span></a> (<a id="arg:39" class="idref" href="#arg:39"><span class="id" title="binder">arg</span></a>: <a class="idref" href="#stack_io"><span class="id" title="inductive">stack_io</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="StackAnyIn" class="idref" href="#StackAnyIn"><span class="id" title="constructor">StackAnyIn</span></a> (<a id="arg:40" class="idref" href="#arg:40"><span class="id" title="binder">arg</span></a>: <a class="idref" href="#stack_in_only"><span class="id" title="inductive">stack_in_only</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="StackAnyOut" class="idref" href="#StackAnyOut"><span class="id" title="constructor">StackAnyOut</span></a> (<a id="arg:41" class="idref" href="#arg:41"><span class="id" title="binder">arg</span></a>: <a class="idref" href="#stack_out_only"><span class="id" title="inductive">stack_out_only</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>

<br/>
</div>
<details><summary>Utility conversions, click to unfold </summary><div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="stack_in_to_any" class="idref" href="#stack_in_to_any"><span class="id" title="definition">stack_in_to_any</span></a> (<a id="s:42" class="idref" href="#s:42"><span class="id" title="binder">s</span></a>:<a class="idref" href="#stack_in"><span class="id" title="inductive">stack_in</span></a>) : <a class="idref" href="#stack_any"><span class="id" title="inductive">stack_any</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#s:42"><span class="id" title="variable">s</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#StackInOnly"><span class="id" title="constructor">StackInOnly</span></a> <span class="id" title="var">arg</span> ⇒ <a class="idref" href="#StackAnyIn"><span class="id" title="constructor">StackAnyIn</span></a> <span class="id" title="var">arg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#StackInAny"><span class="id" title="constructor">StackInAny</span></a> <span class="id" title="var">arg</span> ⇒ <a class="idref" href="#StackAnyIO"><span class="id" title="constructor">StackAnyIO</span></a> <span class="id" title="var">arg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="stack_out_to_any" class="idref" href="#stack_out_to_any"><span class="id" title="definition">stack_out_to_any</span></a> (<a id="s:44" class="idref" href="#s:44"><span class="id" title="binder">s</span></a>:<a class="idref" href="#stack_out"><span class="id" title="inductive">stack_out</span></a>) : <a class="idref" href="#stack_any"><span class="id" title="inductive">stack_any</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#s:44"><span class="id" title="variable">s</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#StackOutOnly"><span class="id" title="constructor">StackOutOnly</span></a> <span class="id" title="var">arg</span> ⇒ <a class="idref" href="#StackAnyOut"><span class="id" title="constructor">StackAnyOut</span></a> <span class="id" title="var">arg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#StackOutAny"><span class="id" title="constructor">StackOutAny</span></a> <span class="id" title="var">arg</span> ⇒ <a class="idref" href="#StackAnyIO"><span class="id" title="constructor">StackAnyIO</span></a> <span class="id" title="var">arg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>
</details><div class="code">

<br/>
</div>

<div class="doc"><p>The <span
class="inlinecode"><a class="idref" href="#any"><span
class="id" title="inductive">any</span></a></span> auxiliary argument
type allows for all addressing modes; it never occurs in instructions
but is used to <span
class="inlinecode"><a class="idref" href="#resolve"><span
class="id" title="inductive">resolve</span></a></span> argument
locations.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="any" class="idref" href="#any"><span class="id" title="inductive">any</span></a> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="AnyReg" class="idref" href="#AnyReg"><span class="id" title="constructor">AnyReg</span></a>  : <a class="idref" href="#reg_io"><span class="id" title="inductive">reg_io</span></a>   <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#any:46"><span class="id" title="inductive">any</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="AnyImm" class="idref" href="#AnyImm"><span class="id" title="constructor">AnyImm</span></a>  : <a class="idref" href="#imm_in"><span class="id" title="inductive">imm_in</span></a>   <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#any:46"><span class="id" title="inductive">any</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="AnyStack" class="idref" href="#AnyStack"><span class="id" title="constructor">AnyStack</span></a>: <a class="idref" href="#stack_any"><span class="id" title="inductive">stack_any</span></a><a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#any:46"><span class="id" title="inductive">any</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="AnyCode" class="idref" href="#AnyCode"><span class="id" title="constructor">AnyCode</span></a> : <a class="idref" href="#code_in"><span class="id" title="inductive">code_in</span></a>  <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#any:46"><span class="id" title="inductive">any</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="AnyConst" class="idref" href="#AnyConst"><span class="id" title="constructor">AnyConst</span></a>: <a class="idref" href="#const_in"><span class="id" title="inductive">const_in</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#any:46"><span class="id" title="inductive">any</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>

<br/>
</div>

<div class="doc"><h2 id="input-arguments">Input arguments</h2>
<p>Instructions may have no more than two input arguments.</p>
<p>Usually, <span class="math inline">\mathit{in_1}</span> supports any
types of arguments, except for <span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="in_any" class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="InReg" class="idref" href="#InReg"><span class="id" title="constructor">InReg</span></a>  : <a class="idref" href="#reg_io"><span class="id" title="inductive">reg_io</span></a>   <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#in_any:48"><span class="id" title="inductive">in_any</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="InImm" class="idref" href="#InImm"><span class="id" title="constructor">InImm</span></a>  : <a class="idref" href="#imm_in"><span class="id" title="inductive">imm_in</span></a>   <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#in_any:48"><span class="id" title="inductive">in_any</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="InStack" class="idref" href="#InStack"><span class="id" title="constructor">InStack</span></a>: <a class="idref" href="#stack_in"><span class="id" title="inductive">stack_in</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#in_any:48"><span class="id" title="inductive">in_any</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="InCode" class="idref" href="#InCode"><span class="id" title="constructor">InCode</span></a> : <a class="idref" href="#code_in"><span class="id" title="inductive">code_in</span></a>  <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#in_any:48"><span class="id" title="inductive">in_any</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="InConst" class="idref" href="#InConst"><span class="id" title="constructor">InConst</span></a>: <a class="idref" href="#const_in"><span class="id" title="inductive">const_in</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#in_any:48"><span class="id" title="inductive">in_any</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>

<br/>
</div>
<details><summary>Inclusion function </summary><div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="in_any_incl" class="idref" href="#in_any_incl"><span class="id" title="definition">in_any_incl</span></a> (<a id="ia:50" class="idref" href="#ia:50"><span class="id" title="binder">ia</span></a>: <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) : <a class="idref" href="#any"><span class="id" title="inductive">any</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#ia:50"><span class="id" title="variable">ia</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#InReg"><span class="id" title="constructor">InReg</span></a> <span class="id" title="var">x</span> ⇒ <a class="idref" href="#AnyReg"><span class="id" title="constructor">AnyReg</span></a> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#InImm"><span class="id" title="constructor">InImm</span></a> <span class="id" title="var">x</span> ⇒ <a class="idref" href="#AnyImm"><span class="id" title="constructor">AnyImm</span></a> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#InStack"><span class="id" title="constructor">InStack</span></a> <span class="id" title="var">x</span> ⇒ <a class="idref" href="#AnyStack"><span class="id" title="constructor">AnyStack</span></a> (<a class="idref" href="#stack_in_to_any"><span class="id" title="definition">stack_in_to_any</span></a> <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#InCode"><span class="id" title="constructor">InCode</span></a> <span class="id" title="var">x</span> ⇒ <a class="idref" href="#AnyCode"><span class="id" title="constructor">AnyCode</span></a> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#InConst"><span class="id" title="constructor">InConst</span></a> <span class="id" title="var">x</span> ⇒ <a class="idref" href="#AnyConst"><span class="id" title="constructor">AnyConst</span></a> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>
</details><div class="code">

<br/>
</div>

<div class="doc"><p>Usually, <span class="math inline">\mathit{in_2}</span> supports only
arguments in GPRs.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="in_reg" class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a> : <span class="id" title="keyword">Type</span> := <a class="idref" href="#reg_io"><span class="id" title="inductive">reg_io</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>In exotic cases, an input argument may either be a register, or an
immediate value, but not anything else.</p>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="in_regimm" class="idref" href="#in_regimm"><span class="id" title="inductive">in_regimm</span></a> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="RegImmR" class="idref" href="#RegImmR"><span class="id" title="constructor">RegImmR</span></a> : <a class="idref" href="#reg_io"><span class="id" title="inductive">reg_io</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#in_regimm:52"><span class="id" title="inductive">in_regimm</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="RegImmI" class="idref" href="#RegImmI"><span class="id" title="constructor">RegImmI</span></a> : <a class="idref" href="#imm_in"><span class="id" title="inductive">imm_in</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#in_regimm:52"><span class="id" title="inductive">in_regimm</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>

<br/>
</div>
<details><summary>Inclusion function </summary><div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="in_regimm_incl" class="idref" href="#in_regimm_incl"><span class="id" title="definition">in_regimm_incl</span></a> (<a id="ri:54" class="idref" href="#ri:54"><span class="id" title="binder">ri</span></a>: <a class="idref" href="#in_regimm"><span class="id" title="inductive">in_regimm</span></a>) : <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#ri:54"><span class="id" title="variable">ri</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#RegImmR"><span class="id" title="constructor">RegImmR</span></a> <span class="id" title="var">r</span> ⇒ <a class="idref" href="#InReg"><span class="id" title="constructor">InReg</span></a> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#RegImmI"><span class="id" title="constructor">RegImmI</span></a> <span class="id" title="var">i</span> ⇒ <a class="idref" href="#InImm"><span class="id" title="constructor">InImm</span></a> <span class="id" title="var">i</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>
</details><div class="code">

<br/>
</div>

<div class="doc"><h2 id="output-arguments">Output arguments</h2>
<p>Instructions may have no more than two output arguments.</p>
<p>Output arguments can not be immediate values.</p>
<p>A single immediate value is not sufficient to identify a memory cell,
because we have multiple pages (see <span
class="inlinecode"><a class="idref" href="#page"><span
class="id" title="projection">page</span></a></span>).</p>
<p>Out arguments can not resolve to the addresses of constants or
instructions, because <span
class="inlinecode"><a class="idref" href="#code_page"><span
class="id" title="definition">code_page</span></a></span> and <span
class="inlinecode"><a class="idref" href="#const_page"><span
class="id" title="definition">const_page</span></a></span> are not
writable.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="out_any" class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="OutReg" class="idref" href="#OutReg"><span class="id" title="constructor">OutReg</span></a>  : <a class="idref" href="#reg_io"><span class="id" title="inductive">reg_io</span></a>    <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#out_any:56"><span class="id" title="inductive">out_any</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a id="OutStack" class="idref" href="#OutStack"><span class="id" title="constructor">OutStack</span></a>: <a class="idref" href="#stack_out"><span class="id" title="inductive">stack_out</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#out_any:56"><span class="id" title="inductive">out_any</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>

<br/>
</div>
<details><summary>Inclusion function </summary><div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="out_any_incl" class="idref" href="#out_any_incl"><span class="id" title="definition">out_any_incl</span></a> (<a id="ia:58" class="idref" href="#ia:58"><span class="id" title="binder">ia</span></a>: <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a>) : <a class="idref" href="#any"><span class="id" title="inductive">any</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#ia:58"><span class="id" title="variable">ia</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OutReg"><span class="id" title="constructor">OutReg</span></a> <span class="id" title="var">x</span> ⇒ <a class="idref" href="#AnyReg"><span class="id" title="constructor">AnyReg</span></a> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OutStack"><span class="id" title="constructor">OutStack</span></a> <span class="id" title="var">x</span> ⇒ <a class="idref" href="#AnyStack"><span class="id" title="constructor">AnyStack</span></a> (<a class="idref" href="#stack_out_to_any"><span class="id" title="definition">stack_out_to_any</span></a> <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>
</details><div class="code">

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="out_reg" class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a> : <span class="id" title="keyword">Type</span> := <a class="idref" href="#reg_io"><span class="id" title="inductive">reg_io</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="#Addressing.InstructionArguments"><span class="id" title="section">InstructionArguments</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Addressing"><span class="id" title="section">Addressing</span></a>.<br/>
</div>

<div class="doc"><p>Therefore, we do not define <span class="inlinecode"><span class="id"
title="var">out_regimm</span></span>, because it is impossible to write
to immediate values.</p>
</div>
<div class="code">
<br/>

<br/>
<span class="id" title="keyword">Module</span> <a id="Coercions" class="idref" href="#Coercions"><span class="id" title="module">Coercions</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Coercion</span> <a class="idref" href="#in_any_incl"><span class="id" title="definition">in_any_incl</span></a><a class="idref" href="#in_any_incl"><span class="id" title="definition">:</span></a> <a class="idref" href="#in_any_incl"><span class="id" title="definition">in_any</span></a> <a class="idref" href="#in_any_incl"><span class="id" title="definition">>-></span></a> <a class="idref" href="#in_any_incl"><span class="id" title="definition">any</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Coercion</span> <a class="idref" href="#out_any_incl"><span class="id" title="definition">out_any_incl</span></a> <a class="idref" href="#out_any_incl"><span class="id" title="definition">:</span></a> <a class="idref" href="#out_any_incl"><span class="id" title="definition">out_any</span></a> <a class="idref" href="#out_any_incl"><span class="id" title="definition">>-></span></a> <a class="idref" href="#out_any_incl"><span class="id" title="definition">any</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Coercion</span> <a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <a class="idref" href="#Imm"><span class="id" title="constructor">:</span></a>  <a class="idref" href="#Imm"><span class="id" title="constructor">u16</span></a> <a class="idref" href="#Imm"><span class="id" title="constructor">>-></span></a> <a class="idref" href="#Imm"><span class="id" title="constructor">imm_in</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Coercion</span> <a class="idref" href="#InReg"><span class="id" title="constructor">InReg</span></a> <a class="idref" href="#InReg"><span class="id" title="constructor">:</span></a>  <a class="idref" href="#InReg"><span class="id" title="constructor">reg_io</span></a> <a class="idref" href="#InReg"><span class="id" title="constructor">>-></span></a> <a class="idref" href="#InReg"><span class="id" title="constructor">in_any</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Coercion</span> <a class="idref" href="#InImm"><span class="id" title="constructor">InImm</span></a> <a class="idref" href="#InImm"><span class="id" title="constructor">:</span></a>  <a class="idref" href="#InImm"><span class="id" title="constructor">imm_in</span></a> <a class="idref" href="#InImm"><span class="id" title="constructor">>-></span></a> <a class="idref" href="#InImm"><span class="id" title="constructor">in_any</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Coercion</span> <a class="idref" href="#InStack"><span class="id" title="constructor">InStack</span></a><a class="idref" href="#InStack"><span class="id" title="constructor">:</span></a> <a class="idref" href="#InStack"><span class="id" title="constructor">stack_in</span></a> <a class="idref" href="#InStack"><span class="id" title="constructor">>-></span></a> <a class="idref" href="#InStack"><span class="id" title="constructor">in_any</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Coercion</span> <a class="idref" href="#InCode"><span class="id" title="constructor">InCode</span></a><a class="idref" href="#InCode"><span class="id" title="constructor">:</span></a>  <a class="idref" href="#InCode"><span class="id" title="constructor">code_in</span></a> <a class="idref" href="#InCode"><span class="id" title="constructor">>-></span></a> <a class="idref" href="#InCode"><span class="id" title="constructor">in_any</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Coercion</span> <a class="idref" href="#InConst"><span class="id" title="constructor">InConst</span></a><a class="idref" href="#InConst"><span class="id" title="constructor">:</span></a>  <a class="idref" href="#InConst"><span class="id" title="constructor">const_in</span></a> <a class="idref" href="#InConst"><span class="id" title="constructor">>-></span></a> <a class="idref" href="#InConst"><span class="id" title="constructor">in_any</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Coercion</span> <a class="idref" href="#StackInOnly"><span class="id" title="constructor">StackInOnly</span></a><a class="idref" href="#StackInOnly"><span class="id" title="constructor">:</span></a> <a class="idref" href="#StackInOnly"><span class="id" title="constructor">stack_in_only</span></a> <a class="idref" href="#StackInOnly"><span class="id" title="constructor">>-></span></a> <a class="idref" href="#StackInOnly"><span class="id" title="constructor">stack_in</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Coercion</span> <a class="idref" href="#stack_in_to_any"><span class="id" title="definition">stack_in_to_any</span></a><a class="idref" href="#stack_in_to_any"><span class="id" title="definition">:</span></a> <a class="idref" href="#stack_in_to_any"><span class="id" title="definition">stack_in</span></a> <a class="idref" href="#stack_in_to_any"><span class="id" title="definition">>-></span></a> <a class="idref" href="#stack_in_to_any"><span class="id" title="definition">stack_any</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Coercion</span> <a class="idref" href="#OutReg"><span class="id" title="constructor">OutReg</span></a> <a class="idref" href="#OutReg"><span class="id" title="constructor">:</span></a> <a class="idref" href="#OutReg"><span class="id" title="constructor">reg_io</span></a> <a class="idref" href="#OutReg"><span class="id" title="constructor">>-></span></a> <a class="idref" href="#OutReg"><span class="id" title="constructor">out_any</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Coercion</span> <a class="idref" href="#OutStack"><span class="id" title="constructor">OutStack</span></a><a class="idref" href="#OutStack"><span class="id" title="constructor">:</span></a> <a class="idref" href="#OutStack"><span class="id" title="constructor">stack_out</span></a> <a class="idref" href="#OutStack"><span class="id" title="constructor">>-></span></a> <a class="idref" href="#OutStack"><span class="id" title="constructor">out_any</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Coercion</span> <a class="idref" href="#AnyStack"><span class="id" title="constructor">AnyStack</span></a><a class="idref" href="#AnyStack"><span class="id" title="constructor">:</span></a> <a class="idref" href="#AnyStack"><span class="id" title="constructor">stack_any</span></a> <a class="idref" href="#AnyStack"><span class="id" title="constructor">>-></span></a> <a class="idref" href="#AnyStack"><span class="id" title="constructor">any</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Coercion</span> <a class="idref" href="#StackOutOnly"><span class="id" title="constructor">StackOutOnly</span></a><a class="idref" href="#StackOutOnly"><span class="id" title="constructor">:</span></a> <a class="idref" href="#StackOutOnly"><span class="id" title="constructor">stack_out_only</span></a> <a class="idref" href="#StackOutOnly"><span class="id" title="constructor">>-></span></a> <a class="idref" href="#StackOutOnly"><span class="id" title="constructor">stack_out</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Coercion</span> <a class="idref" href="#in_regimm_incl"><span class="id" title="definition">in_regimm_incl</span></a><a class="idref" href="#in_regimm_incl"><span class="id" title="definition">:</span></a> <a class="idref" href="#in_regimm_incl"><span class="id" title="definition">in_regimm</span></a> <a class="idref" href="#in_regimm_incl"><span class="id" title="definition">>-></span></a> <a class="idref" href="#in_regimm_incl"><span class="id" title="definition">in_any</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Coercion</span> <a class="idref" href="#StackInAny"><span class="id" title="constructor">StackInAny</span></a> <a class="idref" href="#StackInAny"><span class="id" title="constructor">:</span></a> <a class="idref" href="#StackInAny"><span class="id" title="constructor">stack_io</span></a> <a class="idref" href="#StackInAny"><span class="id" title="constructor">>-></span></a> <a class="idref" href="#StackInAny"><span class="id" title="constructor">stack_in</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Coercion</span> <a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <a class="idref" href="#Reg"><span class="id" title="constructor">:</span></a> <a class="idref" href="#Reg"><span class="id" title="constructor">reg_name</span></a> <a class="idref" href="#Reg"><span class="id" title="constructor">>-></span></a> <a class="idref" href="#Reg"><span class="id" title="constructor">reg_io</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Coercions"><span class="id" title="module">Coercions</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.Resolution</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Core</span></a> <a class="idref" href="#"><span class="id" title="library">Addressing</span></a> <a class="idref" href="#"><span class="id" title="library">CallStack</span></a> .<br/>

<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect</span> <span class="id" title="module">ssrfun</span> <span class="id" title="module">ssrbool</span> <span class="id" title="module">eqtype</span> <span class="id" title="module">ssreflect.tuple</span>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Addressing</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">ZArith</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">GPR</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="AllResolution" class="idref" href="#AllResolution"><span class="id" title="section">AllResolution</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="AllResolution.AddressingUtils" class="idref" href="#AllResolution.AddressingUtils"><span class="id" title="section">AddressingUtils</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">MemoryBase</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
</div>

<div class="doc"><p>Predicate <span
class="inlinecode"><a class="idref" href="#reg_rel"><span
class="id" title="inductive">reg_rel</span></a></span> implements the
resolution for register-based relative addressing. Its specializations
implement relative addressing for:</p>
<ul>
<li>the <span
class="inlinecode"><a class="idref" href="#code_page"><span
class="id" title="definition">code_page</span></a></span>: <span
class="inlinecode"><a class="idref" href="#reg_rel_code"><span
class="id" title="definition">reg_rel_code</span></a></span>;</li>
<li>the <span
class="inlinecode"><a class="idref" href="#const_page"><span
class="id" title="definition">const_page</span></a></span>: <span
class="inlinecode"><a class="idref" href="#reg_rel_const"><span
class="id" title="definition">reg_rel_const</span></a></span>;</li>
<li>the <span
class="inlinecode"><a class="idref" href="#stack_page"><span
class="id" title="definition">stack_page</span></a></span>: <span
class="inlinecode"><a class="idref" href="#reg_rel_const"><span
class="id" title="definition">reg_rel_const</span></a></span>;</li>
</ul>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Inductive&nbsp;equal_bits&nbsp;{n&nbsp;m}&nbsp;(x&nbsp;:BITS&nbsp;n)&nbsp;(y:&nbsp;BITS&nbsp;m)&nbsp;(H:&nbsp;n&nbsp;=&nbsp;m)&nbsp;:&nbsp;Prop&nbsp;:=&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="low16" class="idref" href="#low16"><span class="id" title="definition">low16</span></a> (<a id="w:1" class="idref" href="#w:1"><span class="id" title="binder">w</span></a>: <a class="idref" href="#word"><span class="id" title="definition">word</span></a>) : <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> := <span class="id" title="definition">low</span> 16 <a class="idref" href="#w:1"><span class="id" title="variable">w</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="low32" class="idref" href="#low32"><span class="id" title="definition">low32</span></a> (<a id="w:2" class="idref" href="#w:2"><span class="id" title="binder">w</span></a>: <a class="idref" href="#word"><span class="id" title="definition">word</span></a>) : <a class="idref" href="#u32"><span class="id" title="definition">u32</span></a> := <span class="id" title="definition">low</span> 32 <a class="idref" href="#w:2"><span class="id" title="variable">w</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="reg_rel" class="idref" href="#reg_rel"><span class="id" title="inductive">reg_rel</span></a> : <a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#reg_name"><span class="id" title="inductive">reg_name</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="rca_code_pp" class="idref" href="#rca_code_pp"><span class="id" title="constructor">rca_code_pp</span></a>: <span class="id" title="keyword">∀</span> <a id="regs:5" class="idref" href="#regs:5"><span class="id" title="binder">regs</span></a> <a id="reg:6" class="idref" href="#reg:6"><span class="id" title="binder">reg</span></a> <a id="reg_val:7" class="idref" href="#reg_val:7"><span class="id" title="binder">reg_val</span></a> <a id="base:8" class="idref" href="#base:8"><span class="id" title="binder">base</span></a> <a id="ofs:9" class="idref" href="#ofs:9"><span class="id" title="binder">ofs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="abs:10" class="idref" href="#abs:10"><span class="id" title="binder">abs</span></a> <a id="OF_ignored:11" class="idref" href="#OF_ignored:11"><span class="id" title="binder">OF_ignored</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fetch_gpr"><span class="id" title="definition">fetch_gpr</span></a> <a class="idref" href="#regs:5"><span class="id" title="variable">regs</span></a> <a class="idref" href="#reg:6"><span class="id" title="variable">reg</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#reg_val:7"><span class="id" title="variable">reg_val</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#base:8"><span class="id" title="variable">base</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#low16"><span class="id" title="definition">low16</span></a> <a class="idref" href="#reg_val:7"><span class="id" title="variable">reg_val</span></a>  <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#base:8"><span class="id" title="variable">base</span></a> <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <a class="idref" href="#ofs:9"><span class="id" title="variable">ofs</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#OF_ignored:11"><span class="id" title="variable">OF_ignored</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#abs:10"><span class="id" title="variable">abs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#reg_rel:3"><span class="id" title="inductive">reg_rel</span></a> <a class="idref" href="#regs:5"><span class="id" title="variable">regs</span></a> <a class="idref" href="#reg:6"><span class="id" title="variable">reg</span></a> <a class="idref" href="#ofs:9"><span class="id" title="variable">ofs</span></a> <a class="idref" href="#abs:10"><span class="id" title="variable">abs</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="reg_rel_code" class="idref" href="#reg_rel_code"><span class="id" title="definition">reg_rel_code</span></a> : <a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#reg_name"><span class="id" title="inductive">reg_name</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#code_address"><span class="id" title="definition">code_address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <a class="idref" href="#reg_rel"><span class="id" title="inductive">reg_rel</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="reg_rel_const" class="idref" href="#reg_rel_const"><span class="id" title="definition">reg_rel_const</span></a> : <a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#reg_name"><span class="id" title="inductive">reg_name</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#const_address"><span class="id" title="definition">const_address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <a class="idref" href="#reg_rel"><span class="id" title="inductive">reg_rel</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="reg_rel_stack" class="idref" href="#reg_rel_stack"><span class="id" title="definition">reg_rel_stack</span></a> : <a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#reg_name"><span class="id" title="inductive">reg_name</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <a class="idref" href="#reg_rel"><span class="id" title="inductive">reg_rel</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>Note: in <span
class="inlinecode"><a class="idref" href="#sp_displ"><span
class="id" title="definition">sp_displ</span></a></span>, <span
class="inlinecode"><span class="id" title="keyword">delta</span></span>
<span class="inlinecode">=</span> <span class="inlinecode"><span
class="id" title="var">reg</span></span> <span
class="inlinecode">+</span> <span class="inlinecode"><span class="id"
title="var">imm</span></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="sp_displ" class="idref" href="#sp_displ"><span class="id" title="definition">sp_displ</span></a>: <a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#reg_name"><span class="id" title="inductive">reg_name</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> := <a class="idref" href="#reg_rel_stack"><span class="id" title="definition">reg_rel_stack</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#AllResolution.AddressingUtils"><span class="id" title="section">AddressingUtils</span></a>.<br/>

<br/>
</div>

<div class="doc"><h1 id="address-resolution">Address resolution</h1>
<p>Instructions have multiple ways of addressing data, i.e. immediate
16-bit values, GPRs, absolute or relative addresses in stack etc. They
are described in section <span
class="inlinecode"><a class="idref" href="#Addressing"><span
class="id" title="section">Addressing</span></a></span> by types such as
<span
class="inlinecode"><a class="idref" href="#in_any"><span
class="id" title="inductive">in_any</span></a></span>, <span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a></span>, and so on.</p>
<p><strong>Location</strong> stands for a source and/or destination for
data, addressable by instructions.</p>
<p><strong>Address resolution</strong> is a matching between instruction
operands and locations using the supported address modes.</p>
<p>There are five main locations that instructions can address:</p>
<ol type="1">
<li>Immediate data: the operand is provided directly as an unsigned
16-bit integer value.</li>
<li>Register: data can be fetched or stored to general purpose registers
<span class="inlinecode"><a class="idref" href="#r1"><span
class="id" title="projection">r1</span></a></span>–<span
class="inlinecode"><a class="idref" href="#r15"><span
class="id" title="projection">r15</span></a></span>.</li>
<li>Stack address: data can be fetched or stored to stack.</li>
<li>Code address: instructions can be fetched from a code page.</li>
<li>Constant address: data can be fetched from a read-only page holding
constant words.</li>
</ol>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Inductive</span> <a id="loc" class="idref" href="#loc"><span class="id" title="inductive">loc</span></a> : <span class="id" title="keyword">Type</span> :=<br/>
| <a id="LocImm" class="idref" href="#LocImm"><span class="id" title="constructor">LocImm</span></a>: <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a>  <a class="idref" href="#loc:12"><span class="id" title="inductive">loc</span></a><br/>
| <a id="LocReg" class="idref" href="#LocReg"><span class="id" title="constructor">LocReg</span></a> : <a class="idref" href="#reg_name"><span class="id" title="inductive">reg_name</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a>  <a class="idref" href="#loc:12"><span class="id" title="inductive">loc</span></a><br/>
| <a id="LocStackAddress" class="idref" href="#LocStackAddress"><span class="id" title="constructor">LocStackAddress</span></a>: <a class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#loc:12"><span class="id" title="inductive">loc</span></a><br/>
| <a id="LocCodeAddr" class="idref" href="#LocCodeAddr"><span class="id" title="constructor">LocCodeAddr</span></a>: <a class="idref" href="#code_address"><span class="id" title="definition">code_address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#loc:12"><span class="id" title="inductive">loc</span></a><br/>
| <a id="LocConstAddr" class="idref" href="#LocConstAddr"><span class="id" title="constructor">LocConstAddr</span></a>: <a class="idref" href="#const_address"><span class="id" title="definition">const_address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a>  <a class="idref" href="#loc:12"><span class="id" title="inductive">loc</span></a><br/>
.<br/>
</div>

<div class="doc"><p>Additionally, data can be fetched and stored to data pages; this
process is more complicated and requires putting in registers specially
formed pointers <span
class="inlinecode"><a class="idref" href="#heap_ptr"><span
class="id" title="record">heap_ptr</span></a></span>.</p>
</div>
<div class="code">
<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="AllResolution.Resolution" class="idref" href="#AllResolution.Resolution"><span class="id" title="section">Resolution</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <a class="idref" href="#Coercions"><span class="id" title="module">Addressing.Coercions</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
</div>

<div class="doc"><p>Resolution of <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span> and <span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span> addressing
modes modifies the stack pointer. This, and possible future effects, is
described by <span
class="inlinecode"><a class="idref" href="#resolve_effect"><span
class="id" title="inductive">resolve_effect</span></a></span>
predicate.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="resolve_effect" class="idref" href="#resolve_effect"><span class="id" title="inductive">resolve_effect</span></a> := | <a id="NoEffect" class="idref" href="#NoEffect"><span class="id" title="constructor">NoEffect</span></a> | <a id="NewSP" class="idref" href="#NewSP"><span class="id" title="constructor">NewSP</span></a> (<a id="val:16" class="idref" href="#val:16"><span class="id" title="binder">val</span></a>: <a class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="resolve_result" class="idref" href="#resolve_result"><span class="id" title="record">resolve_result</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mk_resolved</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="effect" class="idref" href="#effect"><span class="id" title="projection">effect</span></a>: <a class="idref" href="#resolve_effect"><span class="id" title="inductive">resolve_effect</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="location" class="idref" href="#location"><span class="id" title="projection">location</span></a>:> <a class="idref" href="#loc"><span class="id" title="inductive">loc</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="state_checkpoint:20" class="idref" href="#state_checkpoint:20"><span class="id" title="binder">state_checkpoint</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="callstack:21" class="idref" href="#callstack:21"><span class="id" title="binder">callstack</span></a> := @<a class="idref" href="#callstack"><span class="id" title="inductive">callstack</span></a> <a class="idref" href="#state_checkpoint:20"><span class="id" title="variable">state_checkpoint</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="rs:22" class="idref" href="#rs:22"><span class="id" title="binder">rs</span></a>:<a class="idref" href="#regs_state"><span class="id" title="record">regs_state</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="cs:23" class="idref" href="#cs:23"><span class="id" title="binder">cs</span></a>: <a class="idref" href="#callstack:21"><span class="id" title="variable">callstack</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="sp:24" class="idref" href="#sp:24"><span class="id" title="binder">sp</span></a>:= <a class="idref" href="#sp_get"><span class="id" title="definition">sp_get</span></a> <a class="idref" href="#cs:23"><span class="id" title="variable">cs</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Reserved Notation</span> "[[ resolved ]]" (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 9, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Reserved Notation</span> "[[ resolved ; 'SP' <- newsp ]]" (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 9, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Declare Scope</span> <span class="id" title="var">Resolution_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Resolution_scope</span>.<br/>

<br/>
</div>

<div class="doc"><p>Address resolution is formalized by the predicate <span
class="inlinecode"><a class="idref" href="#resolve"><span
class="id" title="inductive">resolve</span></a></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="resolve" class="idref" href="#resolve"><span class="id" title="inductive">resolve</span></a> : <a class="idref" href="#any"><span class="id" title="inductive">any</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#resolve_result"><span class="id" title="record">resolve_result</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>Registers and immediate values are resolved to themselves.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="rslv_reg" class="idref" href="#rslv_reg"><span class="id" title="constructor">rslv_reg</span></a> : <span class="id" title="keyword">∀</span> <a id="reg:27" class="idref" href="#reg:27"><span class="id" title="binder">reg</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#resolve:25"><span class="id" title="inductive">resolve</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <a class="idref" href="#reg:27"><span class="id" title="variable">reg</span></a>) <a class="idref" href="#70f929f759656cee2cd7908f0e055073"><span class="id" title="notation">[[</span></a> <a class="idref" href="#LocReg"><span class="id" title="constructor">LocReg</span></a> <a class="idref" href="#reg:27"><span class="id" title="variable">reg</span></a> <a class="idref" href="#70f929f759656cee2cd7908f0e055073"><span class="id" title="notation">]]</span></a><br/>
  | <a id="rslv_imm" class="idref" href="#rslv_imm"><span class="id" title="constructor">rslv_imm</span></a>: <span class="id" title="keyword">∀</span> <a id="imm:28" class="idref" href="#imm:28"><span class="id" title="binder">imm</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#resolve:25"><span class="id" title="inductive">resolve</span></a>  (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <a class="idref" href="#imm:28"><span class="id" title="variable">imm</span></a>) <a class="idref" href="#70f929f759656cee2cd7908f0e055073"><span class="id" title="notation">[[</span></a> <a class="idref" href="#LocImm"><span class="id" title="constructor">LocImm</span></a> <a class="idref" href="#imm:28"><span class="id" title="variable">imm</span></a> <a class="idref" href="#70f929f759656cee2cd7908f0e055073"><span class="id" title="notation">]]</span></a><br/>
</div>

<div class="doc"><ul>
<li><span
class="inlinecode"><a class="idref" href="#Absolute"><span
class="id" title="constructor">Absolute</span></a></span> : Absolute
stack addressing with a general purpose register and an immediate
displacement is resolved to <span
class="math inline">\mathit{reg}+\mathit{imm}</span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="rslv_stack_abs" class="idref" href="#rslv_stack_abs"><span class="id" title="constructor">rslv_stack_abs</span></a>: <span class="id" title="keyword">∀</span> <a id="regs:29" class="idref" href="#regs:29"><span class="id" title="binder">regs</span></a> <a id="reg:30" class="idref" href="#reg:30"><span class="id" title="binder">reg</span></a> <a id="imm:31" class="idref" href="#imm:31"><span class="id" title="binder">imm</span></a> <a id="abs:32" class="idref" href="#abs:32"><span class="id" title="binder">abs</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#reg_rel_stack"><span class="id" title="definition">reg_rel_stack</span></a> <a class="idref" href="#regs:29"><span class="id" title="variable">regs</span></a> <a class="idref" href="#reg:30"><span class="id" title="variable">reg</span></a> <a class="idref" href="#imm:31"><span class="id" title="variable">imm</span></a> <a class="idref" href="#abs:32"><span class="id" title="variable">abs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#resolve:25"><span class="id" title="inductive">resolve</span></a>  (<a class="idref" href="#Absolute"><span class="id" title="constructor">Absolute</span></a> <a class="idref" href="#reg:30"><span class="id" title="variable">reg</span></a> <a class="idref" href="#imm:31"><span class="id" title="variable">imm</span></a>) <a class="idref" href="#70f929f759656cee2cd7908f0e055073"><span class="id" title="notation">[[</span></a> <a class="idref" href="#LocStackAddress"><span class="id" title="constructor">LocStackAddress</span></a> <a class="idref" href="#abs:32"><span class="id" title="variable">abs</span></a> <a class="idref" href="#70f929f759656cee2cd7908f0e055073"><span class="id" title="notation">]]</span></a><br/>
</div>

<div class="doc"><ul>
<li><span
class="inlinecode"><a class="idref" href="#RelSP"><span
class="id" title="constructor">RelSP</span></a></span> : Addressing
relative to SP with a general purpose register and an immediate
displacement is resolved to <span
class="math inline">\mathit{sp}-(\mathit{reg}+\mathit{imm})</span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="rslv_stack_rel" class="idref" href="#rslv_stack_rel"><span class="id" title="constructor">rslv_stack_rel</span></a>: <span class="id" title="keyword">∀</span> <a id="reg:33" class="idref" href="#reg:33"><span class="id" title="binder">reg</span></a> <a id="ofs:34" class="idref" href="#ofs:34"><span class="id" title="binder">ofs</span></a> <a id="delta_sp:35" class="idref" href="#delta_sp:35"><span class="id" title="binder">delta_sp</span></a> <a id="sp_rel:36" class="idref" href="#sp_rel:36"><span class="id" title="binder">sp_rel</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#sp_displ"><span class="id" title="definition">sp_displ</span></a> <a class="idref" href="#AllResolution.Resolution.rs"><span class="id" title="variable">rs</span></a> <a class="idref" href="#reg:33"><span class="id" title="variable">reg</span></a> <a class="idref" href="#ofs:34"><span class="id" title="variable">ofs</span></a> <a class="idref" href="#delta_sp:35"><span class="id" title="variable">delta_sp</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#sp_rel:36"><span class="id" title="variable">sp_rel</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#AllResolution.Resolution.sp"><span class="id" title="variable">sp</span></a> <a class="idref" href="#::ZMod_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="#delta_sp:35"><span class="id" title="variable">delta_sp</span></a><a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#resolve:25"><span class="id" title="inductive">resolve</span></a>  (<a class="idref" href="#RelSP"><span class="id" title="constructor">RelSP</span></a> <a class="idref" href="#reg:33"><span class="id" title="variable">reg</span></a> <a class="idref" href="#ofs:34"><span class="id" title="variable">ofs</span></a>) <a class="idref" href="#70f929f759656cee2cd7908f0e055073"><span class="id" title="notation">[[</span></a> <a class="idref" href="#LocStackAddress"><span class="id" title="constructor">LocStackAddress</span></a> <a class="idref" href="#sp_rel:36"><span class="id" title="variable">sp_rel</span></a> <a class="idref" href="#70f929f759656cee2cd7908f0e055073"><span class="id" title="notation">]]</span></a><br/>
<br/>
</div>

<div class="doc"><ul>
<li><p><span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span> :
<strong>Reading</strong> relative to SP with a general purpose register
and an immediate displacement, <strong>and SP decrement</strong>, is
resolved to <span
class="math inline">\mathit{sp}-(\mathit{reg}+\mathit{imm})</span>;
additionally, SP is assigned the same value <span
class="math inline">\mathit{sp}-(\mathit{reg}+\mathit{imm})</span>. The
new SP value will then be used for the resolution of other operands.</p>
<p>In other words, it is equivalent to a sequence of two actions:</p>
<ol type="1">
<li>SP = SP - (reg + imm)</li>
<li>[SP] -&gt; result</li>
</ol>
<p>In other words, it is equivalent to:</p>
<ol type="1">
<li>pop the stack (reg + imm - 1) times, discard these values</li>
<li>pop value from stack and return it</li>
</ol></li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="rslv_stack_gpop" class="idref" href="#rslv_stack_gpop"><span class="id" title="constructor">rslv_stack_gpop</span></a>: <span class="id" title="keyword">∀</span> <a id="reg:37" class="idref" href="#reg:37"><span class="id" title="binder">reg</span></a> <a id="ofs:38" class="idref" href="#ofs:38"><span class="id" title="binder">ofs</span></a> <a id="delta_sp:39" class="idref" href="#delta_sp:39"><span class="id" title="binder">delta_sp</span></a> <a id="new_sp:40" class="idref" href="#new_sp:40"><span class="id" title="binder">new_sp</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#sp_displ"><span class="id" title="definition">sp_displ</span></a> <a class="idref" href="#AllResolution.Resolution.rs"><span class="id" title="variable">rs</span></a> <a class="idref" href="#reg:37"><span class="id" title="variable">reg</span></a> <a class="idref" href="#ofs:38"><span class="id" title="variable">ofs</span></a> <a class="idref" href="#delta_sp:39"><span class="id" title="variable">delta_sp</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#new_sp:40"><span class="id" title="variable">new_sp</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#AllResolution.Resolution.sp"><span class="id" title="variable">sp</span></a> <a class="idref" href="#::ZMod_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="#delta_sp:39"><span class="id" title="variable">delta_sp</span></a><a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#resolve:25"><span class="id" title="inductive">resolve</span></a>  (<a class="idref" href="#RelSpPop"><span class="id" title="constructor">RelSpPop</span></a> <a class="idref" href="#reg:37"><span class="id" title="variable">reg</span></a> <a class="idref" href="#ofs:38"><span class="id" title="variable">ofs</span></a>) <a class="idref" href="#f9fd17f50504ec964e85a617f4de02ef"><span class="id" title="notation">[[</span></a> <a class="idref" href="#LocStackAddress"><span class="id" title="constructor">LocStackAddress</span></a> <a class="idref" href="#new_sp:40"><span class="id" title="variable">new_sp</span></a> <a class="idref" href="#f9fd17f50504ec964e85a617f4de02ef"><span class="id" title="notation">;</span></a> <a class="idref" href="#f9fd17f50504ec964e85a617f4de02ef"><span class="id" title="notation">SP</span></a> <a class="idref" href="#f9fd17f50504ec964e85a617f4de02ef"><span class="id" title="notation"><-</span></a> <a class="idref" href="#new_sp:40"><span class="id" title="variable">new_sp</span></a> <a class="idref" href="#f9fd17f50504ec964e85a617f4de02ef"><span class="id" title="notation">]]</span></a><br/>
<br/>
</div>

<div class="doc"><ul>
<li><p><span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span> :
<strong>Writing</strong> relative to SP with a general purpose register
and an immediate displacement, <strong>and SP increment</strong>, is
resolved to <strong>the current value of SP</strong>. Additionally, SP
is assigned a new value <span
class="math inline">\mathit{sp}+(\mathit{reg}+\mathit{imm})</span>. The
new SP value will then be used for the resolution of other operands.</p>
<p>In other words, it is equivalent to a sequence of two actions:</p>
<ol type="1">
<li>[SP] &lt;- input value</li>
<li>SP = SP + (reg + imm)</li>
</ol>
<p>In other words, it is equivalent to:</p>
<ol type="1">
<li>push the input value to the stack</li>
<li>allocate (reg+imm-1) slots in stack</li>
</ol></li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="rslv_stack_gpush" class="idref" href="#rslv_stack_gpush"><span class="id" title="constructor">rslv_stack_gpush</span></a>: <span class="id" title="keyword">∀</span> <a id="reg:41" class="idref" href="#reg:41"><span class="id" title="binder">reg</span></a> <a id="ofs:42" class="idref" href="#ofs:42"><span class="id" title="binder">ofs</span></a> <a id="delta_sp:43" class="idref" href="#delta_sp:43"><span class="id" title="binder">delta_sp</span></a> <a id="new_sp:44" class="idref" href="#new_sp:44"><span class="id" title="binder">new_sp</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#sp_displ"><span class="id" title="definition">sp_displ</span></a> <a class="idref" href="#AllResolution.Resolution.rs"><span class="id" title="variable">rs</span></a> <a class="idref" href="#reg:41"><span class="id" title="variable">reg</span></a> <a class="idref" href="#ofs:42"><span class="id" title="variable">ofs</span></a> <a class="idref" href="#delta_sp:43"><span class="id" title="variable">delta_sp</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#new_sp:44"><span class="id" title="variable">new_sp</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#AllResolution.Resolution.sp"><span class="id" title="variable">sp</span></a> <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <a class="idref" href="#delta_sp:43"><span class="id" title="variable">delta_sp</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#resolve:25"><span class="id" title="inductive">resolve</span></a>  (<a class="idref" href="#RelSpPush"><span class="id" title="constructor">RelSpPush</span></a> <a class="idref" href="#reg:41"><span class="id" title="variable">reg</span></a> <a class="idref" href="#ofs:42"><span class="id" title="variable">ofs</span></a>) <a class="idref" href="#f9fd17f50504ec964e85a617f4de02ef"><span class="id" title="notation">[[</span></a> <a class="idref" href="#LocStackAddress"><span class="id" title="constructor">LocStackAddress</span></a> <a class="idref" href="#AllResolution.Resolution.sp"><span class="id" title="variable">sp</span></a> <a class="idref" href="#f9fd17f50504ec964e85a617f4de02ef"><span class="id" title="notation">;</span></a> <a class="idref" href="#f9fd17f50504ec964e85a617f4de02ef"><span class="id" title="notation">SP</span></a> <a class="idref" href="#f9fd17f50504ec964e85a617f4de02ef"><span class="id" title="notation"><-</span></a> <a class="idref" href="#new_sp:44"><span class="id" title="variable">new_sp</span></a> <a class="idref" href="#f9fd17f50504ec964e85a617f4de02ef"><span class="id" title="notation">]]</span></a><br/>
<br/>
&nbsp;&nbsp;| <a id="rslv_code" class="idref" href="#rslv_code"><span class="id" title="constructor">rslv_code</span></a>: <span class="id" title="keyword">∀</span> <a id="reg:45" class="idref" href="#reg:45"><span class="id" title="binder">reg</span></a> <a id="abs_imm:46" class="idref" href="#abs_imm:46"><span class="id" title="binder">abs_imm</span></a> <a id="addr:47" class="idref" href="#addr:47"><span class="id" title="binder">addr</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#reg_rel_code"><span class="id" title="definition">reg_rel_code</span></a> <a class="idref" href="#AllResolution.Resolution.rs"><span class="id" title="variable">rs</span></a> <a class="idref" href="#reg:45"><span class="id" title="variable">reg</span></a> <a class="idref" href="#abs_imm:46"><span class="id" title="variable">abs_imm</span></a> <a class="idref" href="#addr:47"><span class="id" title="variable">addr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#resolve:25"><span class="id" title="inductive">resolve</span></a>  (<a class="idref" href="#CodeAddr"><span class="id" title="constructor">CodeAddr</span></a> <a class="idref" href="#reg:45"><span class="id" title="variable">reg</span></a> <a class="idref" href="#abs_imm:46"><span class="id" title="variable">abs_imm</span></a>) <a class="idref" href="#70f929f759656cee2cd7908f0e055073"><span class="id" title="notation">[[</span></a> <a class="idref" href="#LocCodeAddr"><span class="id" title="constructor">LocCodeAddr</span></a> <a class="idref" href="#addr:47"><span class="id" title="variable">addr</span></a> <a class="idref" href="#70f929f759656cee2cd7908f0e055073"><span class="id" title="notation">]]</span></a><br/>
  | <a id="rslv_const" class="idref" href="#rslv_const"><span class="id" title="constructor">rslv_const</span></a>: <span class="id" title="keyword">∀</span> <a id="reg:48" class="idref" href="#reg:48"><span class="id" title="binder">reg</span></a> <a id="abs_imm:49" class="idref" href="#abs_imm:49"><span class="id" title="binder">abs_imm</span></a> <a id="addr:50" class="idref" href="#addr:50"><span class="id" title="binder">addr</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#reg_rel_const"><span class="id" title="definition">reg_rel_const</span></a> <a class="idref" href="#AllResolution.Resolution.rs"><span class="id" title="variable">rs</span></a> <a class="idref" href="#reg:48"><span class="id" title="variable">reg</span></a> <a class="idref" href="#abs_imm:49"><span class="id" title="variable">abs_imm</span></a> <a class="idref" href="#addr:50"><span class="id" title="variable">addr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#resolve:25"><span class="id" title="inductive">resolve</span></a>  (<a class="idref" href="#ConstAddr"><span class="id" title="constructor">ConstAddr</span></a> <a class="idref" href="#reg:48"><span class="id" title="variable">reg</span></a> <a class="idref" href="#abs_imm:49"><span class="id" title="variable">abs_imm</span></a>) <a class="idref" href="#70f929f759656cee2cd7908f0e055073"><span class="id" title="notation">[[</span></a> <a class="idref" href="#LocConstAddr"><span class="id" title="constructor">LocConstAddr</span></a> <a class="idref" href="#addr:50"><span class="id" title="variable">addr</span></a> <a class="idref" href="#70f929f759656cee2cd7908f0e055073"><span class="id" title="notation">]]</span></a><br/>
  <span class="id" title="keyword">where</span><br/>
&nbsp;&nbsp;"[[ resolved ]]" := (<a class="idref" href="#mk_resolved"><span class="id" title="constructor">mk_resolved</span></a> <a class="idref" href="#NoEffect"><span class="id" title="constructor">NoEffect</span></a> <span class="id" title="var">resolved</span>) : <span class="id" title="var">Resolution_scope</span><br/>
&nbsp;&nbsp;<span class="id" title="var">and</span><br/>
&nbsp;&nbsp;"[[ resolved ; 'SP' <- newsp ]]" := (<a class="idref" href="#mk_resolved"><span class="id" title="constructor">mk_resolved</span></a> (<a class="idref" href="#NewSP"><span class="id" title="constructor">NewSP</span></a> <span class="id" title="var">newsp</span>) <span class="id" title="var">resolved</span>) : <span class="id" title="var">Resolution_scope</span>.<br/>

<br/>
</div>

<div class="doc"><p>Note: the reason of the asymmetry between <span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span> and <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span> is because
they are generalizations of <code>push</code> and <code>pop</code>
operations.</p>
<p>Consider a stack implemented as an array with a pointer. Suppose
that, like in EraVM, SP points the the next address after the last value
in stack; in other words, the topmost element in the stack is located at
<span class="math inline">\mathit{sp}-1</span>. Then <code>push</code>
and <code>pop</code> can be implemented in the following way:</p>
<ul>
<li><p>Push:</p>
<ol type="1">
<li>[SP] &lt;- new_value</li>
<li>SP = SP + 1</li>
</ol></li>
<li><p>Pop:</p>
<ol type="1">
<li>SP = SP - 1</li>
<li>[SP] -&gt; result</li>
</ol></li>
</ul>
<p>This asymmetry naturally generalizes to <span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span> and <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span>.</p>
<h2 id="using-relsppop-and-relsppush-in-one-instruction">Using <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span> and <span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span> in one
instruction</h2>
<p>Suppose an instruction is using both <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span> and <span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span>, then both
effects are applied in order:</p>
<ul>
<li>First, the “in” effect of <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span>.</li>
<li>Then, the “out” effect of <span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span>, where SP is
already changed by <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span>.</li>
<li>If the instruction accesses SP, both effects will be applied prior
to the instruction-specific logic.</li>
</ul>
<p>See an example in <span class="inlinecode"><span class="id"
title="var">sem.ModSP.step</span></span>.</p>
<p>Predicate <span
class="inlinecode"><a class="idref" href="#apply_effects"><span
class="id" title="inductive">apply_effects</span></a></span> formalizes
the application of address resolution side effects to the state. In the
current state of EraVM, only SP modifications are allowed, therefore the
effect is limited to the topmost frame of callstack, which holds the
current value of sp in <span
class="inlinecode"><a class="idref" href="#cf_sp"><span
class="id" title="projection">cf_sp</span></a></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="apply_effects" class="idref" href="#apply_effects"><span class="id" title="inductive">apply_effects</span></a> : <a class="idref" href="#resolve_effect"><span class="id" title="inductive">resolve_effect</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#AllResolution.Resolution.callstack"><span class="id" title="variable">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="ae_none" class="idref" href="#ae_none"><span class="id" title="constructor">ae_none</span></a>: <span class="id" title="keyword">∀</span> <a id="s:53" class="idref" href="#s:53"><span class="id" title="binder">s</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#apply_effects:51"><span class="id" title="inductive">apply_effects</span></a> <a class="idref" href="#NoEffect"><span class="id" title="constructor">NoEffect</span></a> <a class="idref" href="#s:53"><span class="id" title="variable">s</span></a><br/>
&nbsp;&nbsp;| <a id="ae_sp" class="idref" href="#ae_sp"><span class="id" title="constructor">ae_sp</span></a>: <span class="id" title="keyword">∀</span>  <a id="cs':54" class="idref" href="#cs':54"><span class="id" title="binder">cs'</span></a> <a id="new_sp:55" class="idref" href="#new_sp:55"><span class="id" title="binder">new_sp</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#sp_map_spec"><span class="id" title="inductive">sp_map_spec</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#new_sp:55"><span class="id" title="variable">new_sp</span></a>) <a class="idref" href="#AllResolution.Resolution.cs"><span class="id" title="variable">cs</span></a> <a class="idref" href="#cs':54"><span class="id" title="variable">cs'</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#apply_effects:51"><span class="id" title="inductive">apply_effects</span></a> (<a class="idref" href="#NewSP"><span class="id" title="constructor">NewSP</span></a> <a class="idref" href="#new_sp:55"><span class="id" title="variable">new_sp</span></a>) <a class="idref" href="#cs':54"><span class="id" title="variable">cs'</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="resolve_apply" class="idref" href="#resolve_apply"><span class="id" title="inductive">resolve_apply</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="#any"><span class="id" title="inductive">any</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">(</span></a><a class="idref" href="#AllResolution.Resolution.callstack"><span class="id" title="variable">callstack</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#loc"><span class="id" title="inductive">loc</span></a><a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="ra_no_effect" class="idref" href="#ra_no_effect"><span class="id" title="constructor">ra_no_effect</span></a> : <span class="id" title="keyword">∀</span> <a id="arg:58" class="idref" href="#arg:58"><span class="id" title="binder">arg</span></a> <a id="loc:59" class="idref" href="#loc:59"><span class="id" title="binder">loc</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#resolve"><span class="id" title="inductive">resolve</span></a> <a class="idref" href="#arg:58"><span class="id" title="variable">arg</span></a> <a class="idref" href="#70f929f759656cee2cd7908f0e055073"><span class="id" title="notation">[[</span></a> <a class="idref" href="#loc:59"><span class="id" title="variable">loc</span></a> <a class="idref" href="#70f929f759656cee2cd7908f0e055073"><span class="id" title="notation">]]</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#resolve_apply:56"><span class="id" title="inductive">resolve_apply</span></a> <a class="idref" href="#arg:58"><span class="id" title="variable">arg</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#AllResolution.Resolution.cs"><span class="id" title="variable">cs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#loc:59"><span class="id" title="variable">loc</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;| <a id="ra_effect" class="idref" href="#ra_effect"><span class="id" title="constructor">ra_effect</span></a> : <span class="id" title="keyword">∀</span> <a id="cs':60" class="idref" href="#cs':60"><span class="id" title="binder">cs'</span></a> <a id="arg:61" class="idref" href="#arg:61"><span class="id" title="binder">arg</span></a> <a id="loc:62" class="idref" href="#loc:62"><span class="id" title="binder">loc</span></a> <a id="new_sp:63" class="idref" href="#new_sp:63"><span class="id" title="binder">new_sp</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#resolve"><span class="id" title="inductive">resolve</span></a> <a class="idref" href="#arg:61"><span class="id" title="variable">arg</span></a> <a class="idref" href="#f9fd17f50504ec964e85a617f4de02ef"><span class="id" title="notation">[[</span></a> <a class="idref" href="#loc:62"><span class="id" title="variable">loc</span></a> <a class="idref" href="#f9fd17f50504ec964e85a617f4de02ef"><span class="id" title="notation">;</span></a> <a class="idref" href="#f9fd17f50504ec964e85a617f4de02ef"><span class="id" title="notation">SP</span></a> <a class="idref" href="#f9fd17f50504ec964e85a617f4de02ef"><span class="id" title="notation"><-</span></a> <a class="idref" href="#new_sp:63"><span class="id" title="variable">new_sp</span></a> <a class="idref" href="#f9fd17f50504ec964e85a617f4de02ef"><span class="id" title="notation">]]</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#sp_map_spec"><span class="id" title="inductive">sp_map_spec</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#new_sp:63"><span class="id" title="variable">new_sp</span></a>) <a class="idref" href="#AllResolution.Resolution.cs"><span class="id" title="variable">cs</span></a> <a class="idref" href="#cs':60"><span class="id" title="variable">cs'</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#resolve_apply:56"><span class="id" title="inductive">resolve_apply</span></a> <a class="idref" href="#arg:61"><span class="id" title="variable">arg</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#cs':60"><span class="id" title="variable">cs'</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#loc:62"><span class="id" title="variable">loc</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#AllResolution.Resolution"><span class="id" title="section">Resolution</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#AllResolution"><span class="id" title="section">AllResolution</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.isa.Instructions</h1>

<div class="code">
<span class="id" title="keyword">Section</span> <a id="InstructionSets" class="idref" href="#InstructionSets"><span class="id" title="section">InstructionSets</span></a>.<br/>
</div>

<div class="doc"><h1 id="eravm-instruction-sets">EraVM instruction sets</h1>
<p><em>Note</em> If you are interested in the instruction set exposed to
the assembly programmer, skim this section quickly and then proceed to
<span
class="inlinecode"><a class="idref" href="#AssemblyInstructionSet"><span
class="id" title="section">AssemblyInstructionSet</span></a></span>,
<span
class="inlinecode"><a class="idref" href="#CoreInstructionSet"><span
class="id" title="section">CoreInstructionSet</span></a></span> and
<span
class="inlinecode"><a class="idref" href="#to_core"><span
class="id" title="definition">to_core</span></a></span>.</p>
<p>The spec introduces the following layers of abstraction for the
instruction set, from lowest level to the highest level:</p>
<ol type="1">
<li><p>Binary encoding (as <span class="inlinecode"><span class="id"
title="definition">BITS</span></span> <span class="inlinecode">64</span>
type instances). Binary encoded instructions, each instruction is 64-bit
wide.</p>
<p>The exact type for such instructions is <span
class="inlinecode"><span class="id"
title="definition">BITS</span></span> <span
class="inlinecode">64</span>.</p>
<p>The definition <span
class="inlinecode"><a class="idref" href="#encode_mach_instruction"><span
class="id" title="definition">encode_mach_instruction</span></a></span>
formalizes the encoding algorithm. It depends on <span
class="inlinecode"><a class="idref" href="#encode_predicate"><span
class="id" title="definition">encode_predicate</span></a></span> and
<span
class="inlinecode"><a class="idref" href="#encode_opcode"><span
class="id" title="definition">encode_opcode</span></a></span>.</p>
<p>The encoding is an injection, because most instructions ignore the
values of some instruction fields such as <span
class="inlinecode"><a class="idref" href="#op_dst1"><span
class="id" title="projection">op_dst1</span></a></span>.</p></li>
<li><p>Low-level machine instructions <span
class="inlinecode"><a class="idref" href="#mach_instruction"><span
class="id" title="record">mach_instruction</span></a></span>.</p>
<ul>
<li>Fixed format with two input operands, two output operands, two
immediate values.</li>
<li>Restricted sources/destinations (e.g. second input can only be
fetched from registers), instructions may ignore some instruction
fields.</li>
</ul></li>
<li><p>Assembly instructions (see section <span
class="inlinecode"><a class="idref" href="#AssemblyInstructionSet"><span
class="id"
title="section">AssemblyInstructionSet</span></a></span>).</p>
<p>An assembly instruction is an instance of <span
class="inlinecode"><a class="idref" href="#predicated"><span
class="id" title="record">predicated</span></a></span> <span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span>. The type
<span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span> defines
instruction format with the exact operand types and all their supported
modifiers.</p>
<p>The instruction semantic is defined for these instructions; see <span
class="inlinecode"><a class="idref" href="#step"><span
class="id" title="inductive">step</span></a></span> in section <span
class="inlinecode"><a class="idref" href="#SmallStep"><span
class="id" title="section">SmallStep</span></a></span>.</p>
<p>The following abstraction levels simplify the definition of
instruction semantic but are invisible for assembly programmer.</p></li>
</ol>
<hr />
<ol start="4" type="1">
<li><p>Core instructions (see the type <span
class="inlinecode"><a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span> in section
<span
class="inlinecode"><a class="idref" href="#CoreInstructionSet"><span
class="id" title="section">CoreInstructionSet</span></a></span>). The
exact type for such instructions is <span
class="inlinecode"><a class="idref" href="#predicated"><span
class="id" title="record">predicated</span></a></span> <span
class="inlinecode">(<a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span> <span
class="inlinecode"><a class="idref" href="#decoded"><span
class="id" title="definition">decoded</span></a>)</span>.</p>
<p>A simplified instruction set where the <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span> modifier is
applied and there are no restrictions on the operand sources or
destinations, such as “the second input operand may only be fetched from
register”. Because of fewer restrictions, the definitions are more
uniform. The translation from <span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span> to <span
class="inlinecode"><a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span> is
implemented in section <span
class="inlinecode"><a class="idref" href="#AssemblyToCore"><span
class="id" title="section">AssemblyToCore</span></a></span>.</p>
<p>Additionally, the type <span
class="inlinecode"><a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span> describes the
meaningful operand types for instructions after decoding, e.g. <span
class="inlinecode"><a class="idref" href="#OpRet"><span
class="id" title="constructor">OpRet</span></a></span> loads an operand
from a register, but then deserializes it into a compound value. The
types of such compound values are explicitly provided by <span
class="inlinecode"><a class="idref" href="#bound"><span
class="id" title="definition">bound</span></a></span> definition.</p>
<p>The type <span
class="inlinecode"><a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span> describes a
schema of core instructions; this schema can be specialized to
describe:</p>
<ul>
<li>fetched and decoded instruction <span
class="inlinecode"><a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span> <span
class="inlinecode"><a class="idref" href="#decoded"><span
class="id" title="definition">decoded</span></a></span>;</li>
<li>an instruction where input and output operands are bound to the
memory locations <span
class="inlinecode"><a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span> <span
class="inlinecode"><a class="idref" href="#bound"><span
class="id" title="definition">bound</span></a></span>. This abstracts
loading and storing operands, and their serialization/deserialization in
case of ABI encoded instruction parameters.</li>
</ul>
<p>Adding a layer of <span
class="inlinecode"><a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span> <span
class="inlinecode"><a class="idref" href="#bound"><span
class="id" title="definition">bound</span></a></span> allows describing
instruction semantics as if instructions were accepting structural
values directly, omitting fetching values, binary encoding and
decoding.</p>
<ul>
<li>See <span
class="inlinecode"><a class="idref" href="#step_add"><span
class="id" title="inductive">step_add</span></a></span> for an example
of how instruction-specific semantic is defined omitting loading and
storing details.</li>
<li>See <span class="inlinecode"><span class="id"
title="var">step_ContextMeta</span></span> for an example of how
instruction-specific semantic is defined omitting not only loading and
storing, but also serialization/deserialization details.</li>
<li>See <span
class="inlinecode"><a class="idref" href="#OperandBinding"><span
class="id" title="section">OperandBinding</span></a></span> for the
details of binding, e.g. <span
class="inlinecode"><a class="idref" href="#bind_farret_params"><span
class="id" title="inductive">bind_farret_params</span></a></span>
describes how <span
class="inlinecode"><a class="idref" href="#OpRet"><span
class="id" title="constructor">OpRet</span></a></span>’s ABI parameters
are deserialized.</li>
</ul></li>
</ol>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#InstructionSets"><span class="id" title="section">InstructionSets</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.isa.Modifiers</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Flags</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Flags</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Modifiers" class="idref" href="#Modifiers"><span class="id" title="section">Modifiers</span></a>.<br/>

<br/>
</div>

<div class="doc"><h1 id="instruction-modifiers">Instruction modifiers</h1>
<p>There are two modifiers common between multiple <span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span>:
<code>swap</code> and <code>set_flags</code>.</p>
<h2 id="swap-modifier">Swap modifier</h2>
<p>This modifier, when applied, swaps two input operands. Definition
<span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span> shows
which instructions support it.</p>
<p>Input operands usually have different addressing modes, e.g. the
divisor in <span class="inlinecode"><span class="id"
title="var">Assembly.OpDiv</span></span> may be only fetched from
registers, not memory. Applying <code>swap</code> modifier allows to
fetch rather the divisor from memory, and the divident can be fetched
from register.</p>
<p>The function <span
class="inlinecode"><a class="idref" href="#to_core"><span
class="id" title="definition">to_core</span></a></span> transforms <span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span> into a
core <span
class="inlinecode"><a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span> and applies
the <code>swap</code> modifier.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="mod_swap" class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a> := <a id="Swap" class="idref" href="#Swap"><span class="id" title="constructor">Swap</span></a> | <a id="NoSwap" class="idref" href="#NoSwap"><span class="id" title="constructor">NoSwap</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="apply_swap" class="idref" href="#apply_swap"><span class="id" title="definition">apply_swap</span></a> {<a id="T:3" class="idref" href="#T:3"><span class="id" title="binder">T</span></a>} (<a id="md:4" class="idref" href="#md:4"><span class="id" title="binder">md</span></a>: <a class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a>) (<a id="a:5" class="idref" href="#a:5"><span class="id" title="binder">a</span></a> <a id="b:6" class="idref" href="#b:6"><span class="id" title="binder">b</span></a>:<a class="idref" href="#T:3"><span class="id" title="variable">T</span></a>) : <a class="idref" href="#T:3"><span class="id" title="variable">T</span></a><a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a><a class="idref" href="#T:3"><span class="id" title="variable">T</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#md:4"><span class="id" title="variable">md</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#NoSwap"><span class="id" title="constructor">NoSwap</span></a> ⇒ <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#a:5"><span class="id" title="variable">a</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#b:6"><span class="id" title="variable">b</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Swap"><span class="id" title="constructor">Swap</span></a> ⇒ <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#b:6"><span class="id" title="variable">b</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#a:5"><span class="id" title="variable">a</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc"><h2 id="set-flags">Set flags</h2>
<p>Only instructions <em>with the modifier <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span> set</em>
may change the state of flags in <span
class="inlinecode"><a class="idref" href="#gs_flags"><span
class="id" title="projection">gs_flags</span></a></span>. Therefore, if
<span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span> is not set,
it is guaranteed that the instruction will not change the flags
state.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="mod_set_flags" class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a> := <a id="SetFlags" class="idref" href="#SetFlags"><span class="id" title="constructor">SetFlags</span></a> | <a id="PreserveFlags" class="idref" href="#PreserveFlags"><span class="id" title="constructor">PreserveFlags</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>If set flags modifier <span class="inlinecode"><span class="id"
title="var">md</span></span> is set, preserve the old flags state <span
class="inlinecode"><span class="id" title="var">f</span></span>;
otherwise, return the new state <span class="inlinecode"><span
class="id" title="var">f’</span></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="apply_set_flags" class="idref" href="#apply_set_flags"><span class="id" title="definition">apply_set_flags</span></a> (<a id="md:10" class="idref" href="#md:10"><span class="id" title="binder">md</span></a>: <a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>) (<a id="f:11" class="idref" href="#f:11"><span class="id" title="binder">f</span></a> <a id="f':12" class="idref" href="#f':12"><span class="id" title="binder">f'</span></a>:<a class="idref" href="#flags_state"><span class="id" title="record">flags_state</span></a>) : <a class="idref" href="#flags_state"><span class="id" title="record">flags_state</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#md:10"><span class="id" title="variable">md</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#SetFlags"><span class="id" title="constructor">SetFlags</span></a> ⇒ <a class="idref" href="#f':12"><span class="id" title="variable">f'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#PreserveFlags"><span class="id" title="constructor">PreserveFlags</span></a> ⇒ <a class="idref" href="#f:11"><span class="id" title="variable">f</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Modifiers"><span class="id" title="section">Modifiers</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.isa.Assembly</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Addressing</span></a> <a class="idref" href="#"><span class="id" title="library">Common</span></a> <a class="idref" href="#"><span class="id" title="library">memory.Depot</span></a> <a class="idref" href="#"><span class="id" title="library">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="library">Pointer</span></a> <a class="idref" href="#"><span class="id" title="library">Predication</span></a> <a class="idref" href="#"><span class="id" title="library">isa.Modifiers</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Addressing</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">memory.Depot</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a> <a class="idref" href="#"><span class="id" title="module">Predication</span></a> <a class="idref" href="#"><span class="id" title="module">Modifiers</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="AssemblyInstructionSet" class="idref" href="#AssemblyInstructionSet"><span class="id" title="section">AssemblyInstructionSet</span></a>.<br/>
</div>

<div class="doc"><h1 id="eravm-assembly-instruction-set">EraVM assembly instruction
set</h1>
<p>This section describes an instruction set <span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span> which is
a target for compiler.</p>
<p>The type <span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span> defines
instruction format with the precise types of their operands, and all
their supported modifiers. This set is a slice in the middle of the
abstractions hierarchy:</p>
<ul>
<li>The next lower level is machine instructions. The assembly encodes
<span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span> to the
lower-level machine instructions which are then mapped to their binary
encodings.</li>
<li>The next higher level are <strong>core instructions</strong>
described in section <span
class="inlinecode"><a class="idref" href="#CoreInstructionSet"><span
class="id" title="section">CoreInstructionSet</span></a></span>. These
instructions have are simplified formats, impose less constraints on the
operand sources and destinations, and do not support the <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span> modifier.</li>
</ul>
<p>For all practical purposes, the reader of the specification should
start at this level, unless their interest is in lower-level encoding
details. The encoding layout is formalized by <span
class="inlinecode"><a class="idref" href="#mach_instruction"><span
class="id" title="record">mach_instruction</span></a></span> type, which
is then serialized to binary by <span
class="inlinecode"><a class="idref" href="#encode_mach_instruction"><span
class="id"
title="definition">encode_mach_instruction</span></a></span>.</p>
<p>The function <span
class="inlinecode"><a class="idref" href="#base_cost"><span
class="id" title="definition">base_cost</span></a></span> defines the
basic costs of each instruction in <strong><span
class="inlinecode"><a class="idref" href="#ergs"><span
class="id" title="definition">ergs</span></a></span></strong>.</p>
<p>Note: in future (past VM 1.5) the output operand for <span
class="inlinecode"><a class="idref" href="#OpJump"><span
class="id" title="constructor">OpJump</span></a></span> may gain full
addressing mode, i.e. its type will be <span
class="inlinecode"><a class="idref" href="#out_any"><span
class="id" title="inductive">out_any</span></a></span>.</p>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="asm_instruction" class="idref" href="#asm_instruction"><span class="id" title="inductive">asm_instruction</span></a>: <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <a id="OpInvalid" class="idref" href="#OpInvalid"><span class="id" title="constructor">OpInvalid</span></a><br/>
&nbsp;&nbsp;| <a id="OpNoOp" class="idref" href="#OpNoOp"><span class="id" title="constructor">OpNoOp</span></a><br/>
&nbsp;&nbsp;| <a id="OpSpAdd" class="idref" href="#OpSpAdd"><span class="id" title="constructor">OpSpAdd</span></a>       (<a id="in1:3" class="idref" href="#in1:3"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>) (<a id="ofs:4" class="idref" href="#ofs:4"><span class="id" title="binder">ofs</span></a>: <a class="idref" href="#imm_in"><span class="id" title="inductive">imm_in</span></a>)  <span class="comment">(*&nbsp;encoded&nbsp;as&nbsp;NoOp&nbsp;with&nbsp;out_1&nbsp;in&nbsp;address&nbsp;mode&nbsp;<span class="inlinecode"><span class="id" title="var">Addressing.RelSpPush</span></span>*)</span><br/>
&nbsp;&nbsp;| <a id="OpSpSub" class="idref" href="#OpSpSub"><span class="id" title="constructor">OpSpSub</span></a>       (<a id="in1:5" class="idref" href="#in1:5"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>) (<a id="ofs:6" class="idref" href="#ofs:6"><span class="id" title="binder">ofs</span></a>: <a class="idref" href="#imm_in"><span class="id" title="inductive">imm_in</span></a>)  <span class="comment">(*&nbsp;encoded&nbsp;as&nbsp;NoOp&nbsp;with&nbsp;in_1&nbsp;&nbsp;in&nbsp;address&nbsp;mode&nbsp;<span class="inlinecode"><span class="id" title="var">Addressing.RelSpPop</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a id="OpJump" class="idref" href="#OpJump"><span class="id" title="constructor">OpJump</span></a>        (<a id="dest:7" class="idref" href="#dest:7"><span class="id" title="binder">dest</span></a>: <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) (<a id="ret_addr:8" class="idref" href="#ret_addr:8"><span class="id" title="binder">ret_addr</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpAnd" class="idref" href="#OpAnd"><span class="id" title="constructor">OpAnd</span></a>         (<a id="in1:9" class="idref" href="#in1:9"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) (<a id="in2:10" class="idref" href="#in2:10"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)  (<a id="out1:11" class="idref" href="#out1:11"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a>)                  (<a id="flags:12" class="idref" href="#flags:12"><span class="id" title="binder">flags</span></a>:<a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpOr" class="idref" href="#OpOr"><span class="id" title="constructor">OpOr</span></a>          (<a id="in1:13" class="idref" href="#in1:13"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) (<a id="in2:14" class="idref" href="#in2:14"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)  (<a id="out1:15" class="idref" href="#out1:15"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a>)                  (<a id="flags:16" class="idref" href="#flags:16"><span class="id" title="binder">flags</span></a>:<a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpXor" class="idref" href="#OpXor"><span class="id" title="constructor">OpXor</span></a>         (<a id="in1:17" class="idref" href="#in1:17"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) (<a id="in2:18" class="idref" href="#in2:18"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)  (<a id="out1:19" class="idref" href="#out1:19"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a>)                  (<a id="flags:20" class="idref" href="#flags:20"><span class="id" title="binder">flags</span></a>:<a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpAdd" class="idref" href="#OpAdd"><span class="id" title="constructor">OpAdd</span></a>         (<a id="in1:21" class="idref" href="#in1:21"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) (<a id="in2:22" class="idref" href="#in2:22"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)  (<a id="out1:23" class="idref" href="#out1:23"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a>)                  (<a id="flags:24" class="idref" href="#flags:24"><span class="id" title="binder">flags</span></a>:<a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpSub" class="idref" href="#OpSub"><span class="id" title="constructor">OpSub</span></a>         (<a id="in1:25" class="idref" href="#in1:25"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) (<a id="in2:26" class="idref" href="#in2:26"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)  (<a id="out1:27" class="idref" href="#out1:27"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a>)  (<a id="swap:28" class="idref" href="#swap:28"><span class="id" title="binder">swap</span></a>:<a class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a>) (<a id="flags:29" class="idref" href="#flags:29"><span class="id" title="binder">flags</span></a>:<a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
<br/>
&nbsp;&nbsp;| <a id="OpShl" class="idref" href="#OpShl"><span class="id" title="constructor">OpShl</span></a>         (<a id="in1:30" class="idref" href="#in1:30"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) (<a id="in2:31" class="idref" href="#in2:31"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)  (<a id="out1:32" class="idref" href="#out1:32"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a>)  (<a id="swap:33" class="idref" href="#swap:33"><span class="id" title="binder">swap</span></a>:<a class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a>)  (<a id="flags:34" class="idref" href="#flags:34"><span class="id" title="binder">flags</span></a>:<a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpShr" class="idref" href="#OpShr"><span class="id" title="constructor">OpShr</span></a>         (<a id="in1:35" class="idref" href="#in1:35"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) (<a id="in2:36" class="idref" href="#in2:36"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)  (<a id="out1:37" class="idref" href="#out1:37"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a>)  (<a id="swap:38" class="idref" href="#swap:38"><span class="id" title="binder">swap</span></a>:<a class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a>)  (<a id="flags:39" class="idref" href="#flags:39"><span class="id" title="binder">flags</span></a>:<a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpRol" class="idref" href="#OpRol"><span class="id" title="constructor">OpRol</span></a>         (<a id="in1:40" class="idref" href="#in1:40"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) (<a id="in2:41" class="idref" href="#in2:41"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)  (<a id="out1:42" class="idref" href="#out1:42"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a>)  (<a id="swap:43" class="idref" href="#swap:43"><span class="id" title="binder">swap</span></a>:<a class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a>)  (<a id="flags:44" class="idref" href="#flags:44"><span class="id" title="binder">flags</span></a>:<a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpRor" class="idref" href="#OpRor"><span class="id" title="constructor">OpRor</span></a>         (<a id="in1:45" class="idref" href="#in1:45"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) (<a id="in2:46" class="idref" href="#in2:46"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)  (<a id="out1:47" class="idref" href="#out1:47"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a>)  (<a id="swap:48" class="idref" href="#swap:48"><span class="id" title="binder">swap</span></a>:<a class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a>)  (<a id="flags:49" class="idref" href="#flags:49"><span class="id" title="binder">flags</span></a>:<a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
<br/>
&nbsp;&nbsp;| <a id="OpMul" class="idref" href="#OpMul"><span class="id" title="constructor">OpMul</span></a>         (<a id="in1:50" class="idref" href="#in1:50"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) (<a id="in2:51" class="idref" href="#in2:51"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)  (<a id="out1:52" class="idref" href="#out1:52"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a>) (<a id="out2:53" class="idref" href="#out2:53"><span class="id" title="binder">out2</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>)                 (<a id="flags:54" class="idref" href="#flags:54"><span class="id" title="binder">flags</span></a>:<a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpDiv" class="idref" href="#OpDiv"><span class="id" title="constructor">OpDiv</span></a>         (<a id="in1:55" class="idref" href="#in1:55"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) (<a id="in2:56" class="idref" href="#in2:56"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)  (<a id="out1:57" class="idref" href="#out1:57"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a>) (<a id="out2:58" class="idref" href="#out2:58"><span class="id" title="binder">out2</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>) (<a id="swap:59" class="idref" href="#swap:59"><span class="id" title="binder">swap</span></a>:<a class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a>) (<a id="flags:60" class="idref" href="#flags:60"><span class="id" title="binder">flags</span></a>:<a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
<br/>
&nbsp;&nbsp;| <a id="OpNearCall" class="idref" href="#OpNearCall"><span class="id" title="constructor">OpNearCall</span></a>    (<a id="arg:61" class="idref" href="#arg:61"><span class="id" title="binder">arg</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>) (<a id="dest:62" class="idref" href="#dest:62"><span class="id" title="binder">dest</span></a>: <a class="idref" href="#imm_in"><span class="id" title="inductive">imm_in</span></a>) (<a id="handler:63" class="idref" href="#handler:63"><span class="id" title="binder">handler</span></a>: <a class="idref" href="#imm_in"><span class="id" title="inductive">imm_in</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpFarCall" class="idref" href="#OpFarCall"><span class="id" title="constructor">OpFarCall</span></a>     (<a id="enc:64" class="idref" href="#enc:64"><span class="id" title="binder">enc</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>) (<a id="dest:65" class="idref" href="#dest:65"><span class="id" title="binder">dest</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>) (<a id="handler:66" class="idref" href="#handler:66"><span class="id" title="binder">handler</span></a>: <a class="idref" href="#imm_in"><span class="id" title="inductive">imm_in</span></a>) (<a id="is_static:67" class="idref" href="#is_static:67"><span class="id" title="binder">is_static</span></a>:<a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>) (<a id="is_shard_provided:68" class="idref" href="#is_shard_provided:68"><span class="id" title="binder">is_shard_provided</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpMimicCall" class="idref" href="#OpMimicCall"><span class="id" title="constructor">OpMimicCall</span></a>   (<a id="enc:69" class="idref" href="#enc:69"><span class="id" title="binder">enc</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>) (<a id="dest:70" class="idref" href="#dest:70"><span class="id" title="binder">dest</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>) (<a id="handler:71" class="idref" href="#handler:71"><span class="id" title="binder">handler</span></a>: <a class="idref" href="#imm_in"><span class="id" title="inductive">imm_in</span></a>) (<a id="is_static:72" class="idref" href="#is_static:72"><span class="id" title="binder">is_static</span></a>:<a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>) (<a id="is_shard_provided:73" class="idref" href="#is_shard_provided:73"><span class="id" title="binder">is_shard_provided</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpDelegateCall" class="idref" href="#OpDelegateCall"><span class="id" title="constructor">OpDelegateCall</span></a>(<a id="enc:74" class="idref" href="#enc:74"><span class="id" title="binder">enc</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>) (<a id="dest:75" class="idref" href="#dest:75"><span class="id" title="binder">dest</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>) (<a id="handler:76" class="idref" href="#handler:76"><span class="id" title="binder">handler</span></a>: <a class="idref" href="#imm_in"><span class="id" title="inductive">imm_in</span></a>) (<a id="is_static:77" class="idref" href="#is_static:77"><span class="id" title="binder">is_static</span></a>:<a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>) (<a id="is_shard_provided:78" class="idref" href="#is_shard_provided:78"><span class="id" title="binder">is_shard_provided</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
<br/>
&nbsp;&nbsp;| <a id="OpNearRetTo" class="idref" href="#OpNearRetTo"><span class="id" title="constructor">OpNearRetTo</span></a>   (<a id="dest:79" class="idref" href="#dest:79"><span class="id" title="binder">dest</span></a>: <a class="idref" href="#imm_in"><span class="id" title="inductive">imm_in</span></a>)<br/>
<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FarRet&nbsp;(args:&nbsp;reg)&nbsp;and&nbsp;NearRet&nbsp;are&nbsp;merged&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a id="OpRet" class="idref" href="#OpRet"><span class="id" title="constructor">OpRet</span></a>          (<a id="args:80" class="idref" href="#args:80"><span class="id" title="binder">args</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)<br/>
<br/>
&nbsp;&nbsp;| <a id="OpNearRevertTo" class="idref" href="#OpNearRevertTo"><span class="id" title="constructor">OpNearRevertTo</span></a> (<a id="dest:81" class="idref" href="#dest:81"><span class="id" title="binder">dest</span></a>: <a class="idref" href="#imm_in"><span class="id" title="inductive">imm_in</span></a>)<br/>
<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FarRevert&nbsp;(args:&nbsp;reg)&nbsp;and&nbsp;NearRevert&nbsp;are&nbsp;merged&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a id="OpRevert" class="idref" href="#OpRevert"><span class="id" title="constructor">OpRevert</span></a>       (<a id="args:82" class="idref" href="#args:82"><span class="id" title="binder">args</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpNearPanicTo" class="idref" href="#OpNearPanicTo"><span class="id" title="constructor">OpNearPanicTo</span></a>  (<a id="dest:83" class="idref" href="#dest:83"><span class="id" title="binder">dest</span></a>: <a class="idref" href="#imm_in"><span class="id" title="inductive">imm_in</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpPanic" class="idref" href="#OpPanic"><span class="id" title="constructor">OpPanic</span></a><br/>
<br/>
&nbsp;&nbsp;| <a id="OpPtrAdd" class="idref" href="#OpPtrAdd"><span class="id" title="constructor">OpPtrAdd</span></a>      (<a id="in1:84" class="idref" href="#in1:84"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) (<a id="in2:85" class="idref" href="#in2:85"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)  (<a id="out:86" class="idref" href="#out:86"><span class="id" title="binder">out</span></a>: <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a>) (<a id="swap:87" class="idref" href="#swap:87"><span class="id" title="binder">swap</span></a>:<a class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpPtrSub" class="idref" href="#OpPtrSub"><span class="id" title="constructor">OpPtrSub</span></a>      (<a id="in1:88" class="idref" href="#in1:88"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) (<a id="in2:89" class="idref" href="#in2:89"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)  (<a id="out:90" class="idref" href="#out:90"><span class="id" title="binder">out</span></a>: <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a>) (<a id="swap:91" class="idref" href="#swap:91"><span class="id" title="binder">swap</span></a>:<a class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpPtrShrink" class="idref" href="#OpPtrShrink"><span class="id" title="constructor">OpPtrShrink</span></a>   (<a id="in1:92" class="idref" href="#in1:92"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) (<a id="in2:93" class="idref" href="#in2:93"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)  (<a id="out:94" class="idref" href="#out:94"><span class="id" title="binder">out</span></a>: <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a>) (<a id="swap:95" class="idref" href="#swap:95"><span class="id" title="binder">swap</span></a>:<a class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpPtrPack" class="idref" href="#OpPtrPack"><span class="id" title="constructor">OpPtrPack</span></a>     (<a id="in1:96" class="idref" href="#in1:96"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) (<a id="in2:97" class="idref" href="#in2:97"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)  (<a id="out:98" class="idref" href="#out:98"><span class="id" title="binder">out</span></a>: <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a>) (<a id="swap:99" class="idref" href="#swap:99"><span class="id" title="binder">swap</span></a>:<a class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a>)<br/>
<br/>
<br/>
&nbsp;&nbsp;| <a id="OpLoad" class="idref" href="#OpLoad"><span class="id" title="constructor">OpLoad</span></a>        (<a id="ptr:100" class="idref" href="#ptr:100"><span class="id" title="binder">ptr</span></a>: <a class="idref" href="#in_regimm"><span class="id" title="inductive">in_regimm</span></a>) (<a id="res:101" class="idref" href="#res:101"><span class="id" title="binder">res</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>) (<a id="mem:102" class="idref" href="#mem:102"><span class="id" title="binder">mem</span></a>:<a class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpLoadInc" class="idref" href="#OpLoadInc"><span class="id" title="constructor">OpLoadInc</span></a>     (<a id="ptr:103" class="idref" href="#ptr:103"><span class="id" title="binder">ptr</span></a>: <a class="idref" href="#in_regimm"><span class="id" title="inductive">in_regimm</span></a>) (<a id="res:104" class="idref" href="#res:104"><span class="id" title="binder">res</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>) (<a id="mem:105" class="idref" href="#mem:105"><span class="id" title="binder">mem</span></a>:<a class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a>) (<a id="inc_ptr:106" class="idref" href="#inc_ptr:106"><span class="id" title="binder">inc_ptr</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpStore" class="idref" href="#OpStore"><span class="id" title="constructor">OpStore</span></a>       (<a id="ptr:107" class="idref" href="#ptr:107"><span class="id" title="binder">ptr</span></a>: <a class="idref" href="#in_regimm"><span class="id" title="inductive">in_regimm</span></a>) (<a id="val:108" class="idref" href="#val:108"><span class="id" title="binder">val</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)  (<a id="mem:109" class="idref" href="#mem:109"><span class="id" title="binder">mem</span></a>:<a class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpStoreInc" class="idref" href="#OpStoreInc"><span class="id" title="constructor">OpStoreInc</span></a>    (<a id="ptr:110" class="idref" href="#ptr:110"><span class="id" title="binder">ptr</span></a>: <a class="idref" href="#in_regimm"><span class="id" title="inductive">in_regimm</span></a>) (<a id="val:111" class="idref" href="#val:111"><span class="id" title="binder">val</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)  (<a id="mem:112" class="idref" href="#mem:112"><span class="id" title="binder">mem</span></a>:<a class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a>) (<a id="inc_ptr:113" class="idref" href="#inc_ptr:113"><span class="id" title="binder">inc_ptr</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>)<br/>
<br/>
<br/>
&nbsp;&nbsp;| <a id="OpLoadPointer" class="idref" href="#OpLoadPointer"><span class="id" title="constructor">OpLoadPointer</span></a>     (<a id="ptr:114" class="idref" href="#ptr:114"><span class="id" title="binder">ptr</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)  (<a id="res:115" class="idref" href="#res:115"><span class="id" title="binder">res</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpLoadPointerInc" class="idref" href="#OpLoadPointerInc"><span class="id" title="constructor">OpLoadPointerInc</span></a>  (<a id="ptr:116" class="idref" href="#ptr:116"><span class="id" title="binder">ptr</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)  (<a id="res:117" class="idref" href="#res:117"><span class="id" title="binder">res</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>) (<a id="inc_ptr:118" class="idref" href="#inc_ptr:118"><span class="id" title="binder">inc_ptr</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>)<br/>
<br/>
<br/>
&nbsp;&nbsp;| <a id="OpContractThis" class="idref" href="#OpContractThis"><span class="id" title="constructor">OpContractThis</span></a>                 (<a id="out:119" class="idref" href="#out:119"><span class="id" title="binder">out</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpContractCaller" class="idref" href="#OpContractCaller"><span class="id" title="constructor">OpContractCaller</span></a>               (<a id="out:120" class="idref" href="#out:120"><span class="id" title="binder">out</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpContractCodeAddress" class="idref" href="#OpContractCodeAddress"><span class="id" title="constructor">OpContractCodeAddress</span></a>          (<a id="out:121" class="idref" href="#out:121"><span class="id" title="binder">out</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpVMMeta" class="idref" href="#OpVMMeta"><span class="id" title="constructor">OpVMMeta</span></a>                       (<a id="out:122" class="idref" href="#out:122"><span class="id" title="binder">out</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpVMErgsLeft" class="idref" href="#OpVMErgsLeft"><span class="id" title="constructor">OpVMErgsLeft</span></a>                   (<a id="out:123" class="idref" href="#out:123"><span class="id" title="binder">out</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpVMSP" class="idref" href="#OpVMSP"><span class="id" title="constructor">OpVMSP</span></a>                         (<a id="out:124" class="idref" href="#out:124"><span class="id" title="binder">out</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpGetCapturedContext" class="idref" href="#OpGetCapturedContext"><span class="id" title="constructor">OpGetCapturedContext</span></a>           (<a id="out:125" class="idref" href="#out:125"><span class="id" title="binder">out</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpSetContextReg" class="idref" href="#OpSetContextReg"><span class="id" title="constructor">OpSetContextReg</span></a>                (<a id="in1:126" class="idref" href="#in1:126"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Removed&nbsp;in&nbsp;VM&nbsp;1.5.0<br/>
|&nbsp;OpContextSetErgsPerPubdataByte&nbsp;(in1:&nbsp;in_reg)<br/>
&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a id="OpIncrementTxNumber" class="idref" href="#OpIncrementTxNumber"><span class="id" title="constructor">OpIncrementTxNumber</span></a><br/>
&nbsp;&nbsp;| <a id="OpAuxMutating" class="idref" href="#OpAuxMutating"><span class="id" title="constructor">OpAuxMutating</span></a>    (<a id="in1:127" class="idref" href="#in1:127"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)<br/>
<br/>
&nbsp;&nbsp;| <a id="OpSLoad" class="idref" href="#OpSLoad"><span class="id" title="constructor">OpSLoad</span></a>          (<a id="in1:128" class="idref" href="#in1:128"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)                  (<a id="out:129" class="idref" href="#out:129"><span class="id" title="binder">out</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpSStore" class="idref" href="#OpSStore"><span class="id" title="constructor">OpSStore</span></a>         (<a id="in1:130" class="idref" href="#in1:130"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>) (<a id="in2:131" class="idref" href="#in2:131"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)<br/>
<br/>
&nbsp;&nbsp;| <a id="OpPrecompileCall" class="idref" href="#OpPrecompileCall"><span class="id" title="constructor">OpPrecompileCall</span></a> (<a id="in1:132" class="idref" href="#in1:132"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>) (<a id="in2:133" class="idref" href="#in2:133"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)    (<a id="out:134" class="idref" href="#out:134"><span class="id" title="binder">out</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>)<br/>
<br/>
&nbsp;&nbsp;| <a id="OpEvent" class="idref" href="#OpEvent"><span class="id" title="constructor">OpEvent</span></a>          (<a id="in1:135" class="idref" href="#in1:135"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>) (<a id="in2:136" class="idref" href="#in2:136"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)                   (<a id="is_first:137" class="idref" href="#is_first:137"><span class="id" title="binder">is_first</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpToL1Message" class="idref" href="#OpToL1Message"><span class="id" title="constructor">OpToL1Message</span></a>    (<a id="in1:138" class="idref" href="#in1:138"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>) (<a id="in2:139" class="idref" href="#in2:139"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)                   (<a id="is_first:140" class="idref" href="#is_first:140"><span class="id" title="binder">is_first</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Since&nbsp;VM&nbsp;1.5.0&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a id="OpTransientStore" class="idref" href="#OpTransientStore"><span class="id" title="constructor">OpTransientStore</span></a> (<a id="in1:141" class="idref" href="#in1:141"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>) (<a id="in2:142" class="idref" href="#in2:142"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Since&nbsp;VM&nbsp;1.5.0&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a id="OpTransientLoad" class="idref" href="#OpTransientLoad"><span class="id" title="constructor">OpTransientLoad</span></a>  (<a id="in1:143" class="idref" href="#in1:143"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)                   (<a id="out:144" class="idref" href="#out:144"><span class="id" title="binder">out</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Since&nbsp;VM&nbsp;1.5.0&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a id="OpStaticRead" class="idref" href="#OpStaticRead"><span class="id" title="constructor">OpStaticRead</span></a>     (<a id="in1:145" class="idref" href="#in1:145"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_regimm"><span class="id" title="inductive">in_regimm</span></a>)                (<a id="out:146" class="idref" href="#out:146"><span class="id" title="binder">out</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Since&nbsp;VM&nbsp;1.5.0&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a id="OpStaticReadInc" class="idref" href="#OpStaticReadInc"><span class="id" title="constructor">OpStaticReadInc</span></a>  (<a id="in1:147" class="idref" href="#in1:147"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_regimm"><span class="id" title="inductive">in_regimm</span></a>)                (<a id="out1:148" class="idref" href="#out1:148"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>) (<a id="out2:149" class="idref" href="#out2:149"><span class="id" title="binder">out2</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Since&nbsp;VM&nbsp;1.5.0&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a id="OpStaticWrite" class="idref" href="#OpStaticWrite"><span class="id" title="constructor">OpStaticWrite</span></a>    (<a id="in1:150" class="idref" href="#in1:150"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_regimm"><span class="id" title="inductive">in_regimm</span></a>) (<a id="in2:151" class="idref" href="#in2:151"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Since&nbsp;VM&nbsp;1.5.0&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a id="OpStaticWriteInc" class="idref" href="#OpStaticWriteInc"><span class="id" title="constructor">OpStaticWriteInc</span></a> (<a id="in1:152" class="idref" href="#in1:152"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_regimm"><span class="id" title="inductive">in_regimm</span></a>) (<a id="in2:153" class="idref" href="#in2:153"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)  (<a id="out:154" class="idref" href="#out:154"><span class="id" title="binder">out</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Since&nbsp;VM&nbsp;1.5.0&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a id="OpDecommit" class="idref" href="#OpDecommit"><span class="id" title="constructor">OpDecommit</span></a>       (<a id="in1:155" class="idref" href="#in1:155"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)    (<a id="in2:156" class="idref" href="#in2:156"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#in_reg"><span class="id" title="definition">in_reg</span></a>)  (<a id="out:157" class="idref" href="#out:157"><span class="id" title="binder">out</span></a>: <a class="idref" href="#out_reg"><span class="id" title="definition">out_reg</span></a>)<br/>
&nbsp;&nbsp;.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#AssemblyInstructionSet"><span class="id" title="section">AssemblyInstructionSet</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.isa.CoreSet</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Addressing</span></a> <a class="idref" href="#"><span class="id" title="library">isa.Modifiers</span></a> <a class="idref" href="#"><span class="id" title="library">Pointer</span></a> <a class="idref" href="#"><span class="id" title="library">Predication</span></a> <a class="idref" href="#"><span class="id" title="library">TransientMemory</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Addressing</span></a> <a class="idref" href="#"><span class="id" title="module">Modifiers</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a> <a class="idref" href="#"><span class="id" title="module">Predication</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="CoreInstructionSet" class="idref" href="#CoreInstructionSet"><span class="id" title="section">CoreInstructionSet</span></a>.<br/>
</div>

<div class="doc"><h1 id="core-instruction-set">Core instruction set</h1>
<p>This section describes a schema <span
class="inlinecode"><a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span> of a
simplified instruction set appearing in semantic definitions for <span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span>. The
meaning of “schema” here is that <span
class="inlinecode"><a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span> needs to be
specialized with a proper instance of <span
class="inlinecode"><a class="idref" href="#descr"><span
class="id" title="record">descr</span></a></span> record to describe an
instruction at different stages of its execution.</p>
<p>The schema <span
class="inlinecode"><a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span> is
parameterized with types of various instruction operands.
Conventionally, their names reflect the following information:</p>
<ul>
<li>the prefix is <code>src_</code> for source operands and
<code>dest_</code> for output operands.</li>
<li>the suffix shows the type of data fetched or stored from
register/memory.</li>
</ul>
<p>For example:</p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#src_pv"><span
class="id" title="projection">src_pv</span></a></span> means “a source
operand with a meaning of a <span
class="inlinecode"><a class="idref" href="#primitive_value"><span
class="id" title="record">primitive_value</span></a></span>”;</li>
<li><span
class="inlinecode"><a class="idref" href="#src_fat_ptr"><span
class="id" title="projection">src_fat_ptr</span></a></span> means “a
source operand which will be decoded to a <span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span>”;</li>
<li><span
class="inlinecode"><a class="idref" href="#dest_heap_ptr"><span
class="id" title="projection">dest_heap_ptr</span></a></span> means “a
destination operand with a meaning of <span
class="inlinecode"><a class="idref" href="#heap_ptr"><span
class="id" title="record">heap_ptr</span></a></span>; such pointer will
be encoded and written to memory”.</li>
</ul>
<p>Therefore, the exact definitions of instructions should be
specialized with an instance of <span
class="inlinecode"><a class="idref" href="#descr"><span
class="id" title="record">descr</span></a></span> to give precise
meaning to instruction operands. Currently, two such instances are
used:</p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span> <span
class="inlinecode"><a class="idref" href="#decoded"><span
class="id" title="definition">decoded</span></a></span> is decoded from
<span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span>.</li>
<li><span
class="inlinecode"><a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span> <span
class="inlinecode"><a class="idref" href="#bound"><span
class="id" title="definition">bound</span></a></span> is an instruction
where operands have been bound to their source/destination locations in
memory; at this stage, reads, writes, encoding and decodings (parts of
ABI) are accounted for.</li>
</ul>
<p>Having <span
class="inlinecode"><a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span> <span
class="inlinecode"><a class="idref" href="#bound"><span
class="id" title="definition">bound</span></a></span> allows attributing
semantic in a more concise way. See <span
class="inlinecode"><a class="idref" href="#OperandBinding"><span
class="id" title="section">OperandBinding</span></a></span>. For
additional versatility, the definitions may bind both the decoded values
and their representations as primitive values; see <span
class="inlinecode"><a class="idref" href="#bound"><span
class="id" title="definition">bound</span></a></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Structure</span> <a id="descr" class="idref" href="#descr"><span class="id" title="record">descr</span></a>: <span class="id" title="keyword">Type</span> := {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="src_pv" class="idref" href="#src_pv"><span class="id" title="projection">src_pv</span></a>: <span class="id" title="keyword">Type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="src_fat_ptr" class="idref" href="#src_fat_ptr"><span class="id" title="projection">src_fat_ptr</span></a>: <span class="id" title="keyword">Type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="src_heap_ptr" class="idref" href="#src_heap_ptr"><span class="id" title="projection">src_heap_ptr</span></a>: <span class="id" title="keyword">Type</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="src_farcall_params" class="idref" href="#src_farcall_params"><span class="id" title="projection">src_farcall_params</span></a>: <span class="id" title="keyword">Type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="src_nearcall_params" class="idref" href="#src_nearcall_params"><span class="id" title="projection">src_nearcall_params</span></a>: <span class="id" title="keyword">Type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="src_ret_params" class="idref" href="#src_ret_params"><span class="id" title="projection">src_ret_params</span></a>: <span class="id" title="keyword">Type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="src_precompile_params" class="idref" href="#src_precompile_params"><span class="id" title="projection">src_precompile_params</span></a>: <span class="id" title="keyword">Type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="dest_pv" class="idref" href="#dest_pv"><span class="id" title="projection">dest_pv</span></a>: <span class="id" title="keyword">Type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="dest_heap_ptr" class="idref" href="#dest_heap_ptr"><span class="id" title="projection">dest_heap_ptr</span></a>: <span class="id" title="keyword">Type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="dest_fat_ptr" class="idref" href="#dest_fat_ptr"><span class="id" title="projection">dest_fat_ptr</span></a>: <span class="id" title="keyword">Type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="dest_meta_params" class="idref" href="#dest_meta_params"><span class="id" title="projection">dest_meta_params</span></a>: <span class="id" title="keyword">Type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="d:13" class="idref" href="#d:13"><span class="id" title="binder">d</span></a>: <a class="idref" href="#descr"><span class="id" title="record">descr</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="src_pv:14" class="idref" href="#src_pv:14"><span class="id" title="binder">src_pv</span></a>:= <a class="idref" href="#src_pv"><span class="id" title="projection">src_pv</span></a> <a class="idref" href="#d:13"><span class="id" title="variable">d</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="src_fat_ptr:15" class="idref" href="#src_fat_ptr:15"><span class="id" title="binder">src_fat_ptr</span></a>:= <a class="idref" href="#src_fat_ptr"><span class="id" title="projection">src_fat_ptr</span></a> <a class="idref" href="#d:13"><span class="id" title="variable">d</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="src_heap_ptr:16" class="idref" href="#src_heap_ptr:16"><span class="id" title="binder">src_heap_ptr</span></a>:= <a class="idref" href="#src_heap_ptr"><span class="id" title="projection">src_heap_ptr</span></a> <a class="idref" href="#d:13"><span class="id" title="variable">d</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="src_farcall_params:17" class="idref" href="#src_farcall_params:17"><span class="id" title="binder">src_farcall_params</span></a>:= <a class="idref" href="#src_farcall_params"><span class="id" title="projection">src_farcall_params</span></a> <a class="idref" href="#d:13"><span class="id" title="variable">d</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="src_nearcall_params:18" class="idref" href="#src_nearcall_params:18"><span class="id" title="binder">src_nearcall_params</span></a>:= <a class="idref" href="#src_nearcall_params"><span class="id" title="projection">src_nearcall_params</span></a> <a class="idref" href="#d:13"><span class="id" title="variable">d</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="src_ret_params:19" class="idref" href="#src_ret_params:19"><span class="id" title="binder">src_ret_params</span></a>:= <a class="idref" href="#src_ret_params"><span class="id" title="projection">src_ret_params</span></a> <a class="idref" href="#d:13"><span class="id" title="variable">d</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="src_precompile_params:20" class="idref" href="#src_precompile_params:20"><span class="id" title="binder">src_precompile_params</span></a>:= <a class="idref" href="#src_precompile_params"><span class="id" title="projection">src_precompile_params</span></a> <a class="idref" href="#d:13"><span class="id" title="variable">d</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="dest_pv:21" class="idref" href="#dest_pv:21"><span class="id" title="binder">dest_pv</span></a>:= <a class="idref" href="#dest_pv"><span class="id" title="projection">dest_pv</span></a> <a class="idref" href="#d:13"><span class="id" title="variable">d</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="dest_heap_ptr:22" class="idref" href="#dest_heap_ptr:22"><span class="id" title="binder">dest_heap_ptr</span></a>:= <a class="idref" href="#dest_heap_ptr"><span class="id" title="projection">dest_heap_ptr</span></a> <a class="idref" href="#d:13"><span class="id" title="variable">d</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="dest_fat_ptr:23" class="idref" href="#dest_fat_ptr:23"><span class="id" title="binder">dest_fat_ptr</span></a>:= <a class="idref" href="#dest_fat_ptr"><span class="id" title="projection">dest_fat_ptr</span></a> <a class="idref" href="#d:13"><span class="id" title="variable">d</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="dest_meta_params:24" class="idref" href="#dest_meta_params:24"><span class="id" title="binder">dest_meta_params</span></a>:= <a class="idref" href="#dest_meta_params"><span class="id" title="projection">dest_meta_params</span></a> <a class="idref" href="#d:13"><span class="id" title="variable">d</span></a>)<br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="instruction" class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a>: <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <a id="OpInvalid" class="idref" href="#OpInvalid"><span class="id" title="constructor">OpInvalid</span></a><br/>
&nbsp;&nbsp;| <a id="OpNoOp" class="idref" href="#OpNoOp"><span class="id" title="constructor">OpNoOp</span></a><br/>
&nbsp;&nbsp;| <a id="OpSpAdd" class="idref" href="#OpSpAdd"><span class="id" title="constructor">OpSpAdd</span></a>       (<a id="in1:27" class="idref" href="#in1:27"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>) (<a id="ofs:28" class="idref" href="#ofs:28"><span class="id" title="binder">ofs</span></a>: <a class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a>)  <span class="comment">(*&nbsp;encoded&nbsp;as&nbsp;NoOp&nbsp;with&nbsp;$out_1$&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a id="OpSpSub" class="idref" href="#OpSpSub"><span class="id" title="constructor">OpSpSub</span></a>       (<a id="in1:29" class="idref" href="#in1:29"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>) (<a id="ofs:30" class="idref" href="#ofs:30"><span class="id" title="binder">ofs</span></a>: <a class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a>) <span class="comment">(*&nbsp;encoded&nbsp;as&nbsp;NoOp&nbsp;with&nbsp;$in_1$&nbsp;*)</span><br/>
<br/>
&nbsp;&nbsp;| <a id="OpJump" class="idref" href="#OpJump"><span class="id" title="constructor">OpJump</span></a>        (<a id="dest:31" class="idref" href="#dest:31"><span class="id" title="binder">dest</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>) (<a id="out1:32" class="idref" href="#out1:32"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpAnd" class="idref" href="#OpAnd"><span class="id" title="constructor">OpAnd</span></a>         (<a id="in1:33" class="idref" href="#in1:33"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>) (<a id="in2:34" class="idref" href="#in2:34"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)  (<a id="out1:35" class="idref" href="#out1:35"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>) (<a id="flags:36" class="idref" href="#flags:36"><span class="id" title="binder">flags</span></a>:<a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpOr" class="idref" href="#OpOr"><span class="id" title="constructor">OpOr</span></a>          (<a id="in1:37" class="idref" href="#in1:37"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>) (<a id="in2:38" class="idref" href="#in2:38"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)  (<a id="out1:39" class="idref" href="#out1:39"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>) (<a id="flags:40" class="idref" href="#flags:40"><span class="id" title="binder">flags</span></a>:<a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpXor" class="idref" href="#OpXor"><span class="id" title="constructor">OpXor</span></a>         (<a id="in1:41" class="idref" href="#in1:41"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>) (<a id="in2:42" class="idref" href="#in2:42"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)  (<a id="out1:43" class="idref" href="#out1:43"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>) (<a id="flags:44" class="idref" href="#flags:44"><span class="id" title="binder">flags</span></a>:<a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpAdd" class="idref" href="#OpAdd"><span class="id" title="constructor">OpAdd</span></a>         (<a id="in1:45" class="idref" href="#in1:45"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>) (<a id="in2:46" class="idref" href="#in2:46"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)  (<a id="out1:47" class="idref" href="#out1:47"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>) (<a id="flags:48" class="idref" href="#flags:48"><span class="id" title="binder">flags</span></a>:<a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpSub" class="idref" href="#OpSub"><span class="id" title="constructor">OpSub</span></a>         (<a id="in1:49" class="idref" href="#in1:49"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>) (<a id="in2:50" class="idref" href="#in2:50"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)  (<a id="out1:51" class="idref" href="#out1:51"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>) (<a id="flags:52" class="idref" href="#flags:52"><span class="id" title="binder">flags</span></a>:<a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
<br/>
&nbsp;&nbsp;| <a id="OpShl" class="idref" href="#OpShl"><span class="id" title="constructor">OpShl</span></a>         (<a id="in1:53" class="idref" href="#in1:53"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>) (<a id="in2:54" class="idref" href="#in2:54"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)  (<a id="out1:55" class="idref" href="#out1:55"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>) (<a id="flags:56" class="idref" href="#flags:56"><span class="id" title="binder">flags</span></a>:<a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpShr" class="idref" href="#OpShr"><span class="id" title="constructor">OpShr</span></a>         (<a id="in1:57" class="idref" href="#in1:57"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>) (<a id="in2:58" class="idref" href="#in2:58"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)  (<a id="out1:59" class="idref" href="#out1:59"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>) (<a id="flags:60" class="idref" href="#flags:60"><span class="id" title="binder">flags</span></a>:<a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpRol" class="idref" href="#OpRol"><span class="id" title="constructor">OpRol</span></a>         (<a id="in1:61" class="idref" href="#in1:61"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>) (<a id="in2:62" class="idref" href="#in2:62"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)  (<a id="out1:63" class="idref" href="#out1:63"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>) (<a id="flags:64" class="idref" href="#flags:64"><span class="id" title="binder">flags</span></a>:<a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpRor" class="idref" href="#OpRor"><span class="id" title="constructor">OpRor</span></a>         (<a id="in1:65" class="idref" href="#in1:65"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>) (<a id="in2:66" class="idref" href="#in2:66"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)  (<a id="out1:67" class="idref" href="#out1:67"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>) (<a id="flags:68" class="idref" href="#flags:68"><span class="id" title="binder">flags</span></a>:<a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
<br/>
&nbsp;&nbsp;| <a id="OpMul" class="idref" href="#OpMul"><span class="id" title="constructor">OpMul</span></a>         (<a id="in1:69" class="idref" href="#in1:69"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>) (<a id="in2:70" class="idref" href="#in2:70"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)  (<a id="out1:71" class="idref" href="#out1:71"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>) (<a id="out2:72" class="idref" href="#out2:72"><span class="id" title="binder">out2</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>) (<a id="flags:73" class="idref" href="#flags:73"><span class="id" title="binder">flags</span></a>:<a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpDiv" class="idref" href="#OpDiv"><span class="id" title="constructor">OpDiv</span></a>         (<a id="in1:74" class="idref" href="#in1:74"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>) (<a id="in2:75" class="idref" href="#in2:75"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)  (<a id="out1:76" class="idref" href="#out1:76"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>) (<a id="out2:77" class="idref" href="#out2:77"><span class="id" title="binder">out2</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>) (<a id="flags:78" class="idref" href="#flags:78"><span class="id" title="binder">flags</span></a>:<a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpNearCall" class="idref" href="#OpNearCall"><span class="id" title="constructor">OpNearCall</span></a>    (<a id="in1:79" class="idref" href="#in1:79"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_nearcall_params"><span class="id" title="variable">src_nearcall_params</span></a>) (<a id="dest:80" class="idref" href="#dest:80"><span class="id" title="binder">dest</span></a>: <a class="idref" href="#code_address"><span class="id" title="definition">code_address</span></a>) (<a id="handler:81" class="idref" href="#handler:81"><span class="id" title="binder">handler</span></a>: <a class="idref" href="#code_address"><span class="id" title="definition">code_address</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpFarCall" class="idref" href="#OpFarCall"><span class="id" title="constructor">OpFarCall</span></a>     (<a id="enc:82" class="idref" href="#enc:82"><span class="id" title="binder">enc</span></a>: <a class="idref" href="#CoreInstructionSet.src_farcall_params"><span class="id" title="variable">src_farcall_params</span></a>) (<a id="dest:83" class="idref" href="#dest:83"><span class="id" title="binder">dest</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>) (<a id="handler:84" class="idref" href="#handler:84"><span class="id" title="binder">handler</span></a>: <a class="idref" href="#code_address"><span class="id" title="definition">code_address</span></a>) (<a id="is_static:85" class="idref" href="#is_static:85"><span class="id" title="binder">is_static</span></a>:<a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>) (<a id="is_shard_provided:86" class="idref" href="#is_shard_provided:86"><span class="id" title="binder">is_shard_provided</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpMimicCall" class="idref" href="#OpMimicCall"><span class="id" title="constructor">OpMimicCall</span></a>   (<a id="enc:87" class="idref" href="#enc:87"><span class="id" title="binder">enc</span></a>: <a class="idref" href="#CoreInstructionSet.src_farcall_params"><span class="id" title="variable">src_farcall_params</span></a>) (<a id="dest:88" class="idref" href="#dest:88"><span class="id" title="binder">dest</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>) (<a id="handler:89" class="idref" href="#handler:89"><span class="id" title="binder">handler</span></a>: <a class="idref" href="#code_address"><span class="id" title="definition">code_address</span></a>) (<a id="is_static:90" class="idref" href="#is_static:90"><span class="id" title="binder">is_static</span></a>:<a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>) (<a id="is_shard_provided:91" class="idref" href="#is_shard_provided:91"><span class="id" title="binder">is_shard_provided</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpDelegateCall" class="idref" href="#OpDelegateCall"><span class="id" title="constructor">OpDelegateCall</span></a>(<a id="enc:92" class="idref" href="#enc:92"><span class="id" title="binder">enc</span></a>: <a class="idref" href="#CoreInstructionSet.src_farcall_params"><span class="id" title="variable">src_farcall_params</span></a>) (<a id="dest:93" class="idref" href="#dest:93"><span class="id" title="binder">dest</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>) (<a id="handler:94" class="idref" href="#handler:94"><span class="id" title="binder">handler</span></a>: <a class="idref" href="#code_address"><span class="id" title="definition">code_address</span></a>) (<a id="is_static:95" class="idref" href="#is_static:95"><span class="id" title="binder">is_static</span></a>:<a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>) (<a id="is_shard_provided:96" class="idref" href="#is_shard_provided:96"><span class="id" title="binder">is_shard_provided</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
<br/>
&nbsp;&nbsp;| <a id="OpNearRetTo" class="idref" href="#OpNearRetTo"><span class="id" title="constructor">OpNearRetTo</span></a>   (<a id="label:97" class="idref" href="#label:97"><span class="id" title="binder">label</span></a>: <a class="idref" href="#code_address"><span class="id" title="definition">code_address</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpRet" class="idref" href="#OpRet"><span class="id" title="constructor">OpRet</span></a>         (<a id="args:98" class="idref" href="#args:98"><span class="id" title="binder">args</span></a>: <a class="idref" href="#CoreInstructionSet.src_ret_params"><span class="id" title="variable">src_ret_params</span></a>)<br/>
<br/>
&nbsp;&nbsp;| <a id="OpNearRevertTo" class="idref" href="#OpNearRevertTo"><span class="id" title="constructor">OpNearRevertTo</span></a> (<a id="label:99" class="idref" href="#label:99"><span class="id" title="binder">label</span></a>: <a class="idref" href="#code_address"><span class="id" title="definition">code_address</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpRevert" class="idref" href="#OpRevert"><span class="id" title="constructor">OpRevert</span></a>       (<a id="args:100" class="idref" href="#args:100"><span class="id" title="binder">args</span></a>: <a class="idref" href="#CoreInstructionSet.src_ret_params"><span class="id" title="variable">src_ret_params</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpNearPanicTo" class="idref" href="#OpNearPanicTo"><span class="id" title="constructor">OpNearPanicTo</span></a>  (<a id="label:101" class="idref" href="#label:101"><span class="id" title="binder">label</span></a>: <a class="idref" href="#code_address"><span class="id" title="definition">code_address</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpPanic" class="idref" href="#OpPanic"><span class="id" title="constructor">OpPanic</span></a><br/>
<br/>
&nbsp;&nbsp;| <a id="OpPtrAdd" class="idref" href="#OpPtrAdd"><span class="id" title="constructor">OpPtrAdd</span></a>      (<a id="in1:102" class="idref" href="#in1:102"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_fat_ptr"><span class="id" title="variable">src_fat_ptr</span></a>) (<a id="in2:103" class="idref" href="#in2:103"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)  (<a id="out:104" class="idref" href="#out:104"><span class="id" title="binder">out</span></a>: <a class="idref" href="#CoreInstructionSet.dest_fat_ptr"><span class="id" title="variable">dest_fat_ptr</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpPtrSub" class="idref" href="#OpPtrSub"><span class="id" title="constructor">OpPtrSub</span></a>      (<a id="in1:105" class="idref" href="#in1:105"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_fat_ptr"><span class="id" title="variable">src_fat_ptr</span></a>) (<a id="in2:106" class="idref" href="#in2:106"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)  (<a id="out:107" class="idref" href="#out:107"><span class="id" title="binder">out</span></a>: <a class="idref" href="#CoreInstructionSet.dest_fat_ptr"><span class="id" title="variable">dest_fat_ptr</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpPtrShrink" class="idref" href="#OpPtrShrink"><span class="id" title="constructor">OpPtrShrink</span></a>   (<a id="in1:108" class="idref" href="#in1:108"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_fat_ptr"><span class="id" title="variable">src_fat_ptr</span></a>) (<a id="in2:109" class="idref" href="#in2:109"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)  (<a id="out:110" class="idref" href="#out:110"><span class="id" title="binder">out</span></a>: <a class="idref" href="#CoreInstructionSet.dest_fat_ptr"><span class="id" title="variable">dest_fat_ptr</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpPtrPack" class="idref" href="#OpPtrPack"><span class="id" title="constructor">OpPtrPack</span></a>     (<a id="in1:111" class="idref" href="#in1:111"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_fat_ptr"><span class="id" title="variable">src_fat_ptr</span></a>) (<a id="in2:112" class="idref" href="#in2:112"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)  (<a id="out:113" class="idref" href="#out:113"><span class="id" title="binder">out</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>)<br/>
<br/>
<br/>
&nbsp;&nbsp;| <a id="OpLoad" class="idref" href="#OpLoad"><span class="id" title="constructor">OpLoad</span></a>        (<a id="ptr:114" class="idref" href="#ptr:114"><span class="id" title="binder">ptr</span></a>: <a class="idref" href="#CoreInstructionSet.src_heap_ptr"><span class="id" title="variable">src_heap_ptr</span></a>) (<a id="res:115" class="idref" href="#res:115"><span class="id" title="binder">res</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>) (<a id="mem:116" class="idref" href="#mem:116"><span class="id" title="binder">mem</span></a>:<a class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpLoadInc" class="idref" href="#OpLoadInc"><span class="id" title="constructor">OpLoadInc</span></a>     (<a id="ptr:117" class="idref" href="#ptr:117"><span class="id" title="binder">ptr</span></a>: <a class="idref" href="#CoreInstructionSet.src_heap_ptr"><span class="id" title="variable">src_heap_ptr</span></a>) (<a id="res:118" class="idref" href="#res:118"><span class="id" title="binder">res</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>) (<a id="mem:119" class="idref" href="#mem:119"><span class="id" title="binder">mem</span></a>:<a class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a>) (<a id="inc_ptr:120" class="idref" href="#inc_ptr:120"><span class="id" title="binder">inc_ptr</span></a>: <a class="idref" href="#CoreInstructionSet.dest_heap_ptr"><span class="id" title="variable">dest_heap_ptr</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpStore" class="idref" href="#OpStore"><span class="id" title="constructor">OpStore</span></a>       (<a id="ptr:121" class="idref" href="#ptr:121"><span class="id" title="binder">ptr</span></a>: <a class="idref" href="#CoreInstructionSet.src_heap_ptr"><span class="id" title="variable">src_heap_ptr</span></a>) (<a id="val:122" class="idref" href="#val:122"><span class="id" title="binder">val</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)  (<a id="mem:123" class="idref" href="#mem:123"><span class="id" title="binder">mem</span></a>:<a class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpStoreInc" class="idref" href="#OpStoreInc"><span class="id" title="constructor">OpStoreInc</span></a>    (<a id="ptr:124" class="idref" href="#ptr:124"><span class="id" title="binder">ptr</span></a>: <a class="idref" href="#CoreInstructionSet.src_heap_ptr"><span class="id" title="variable">src_heap_ptr</span></a>) (<a id="val:125" class="idref" href="#val:125"><span class="id" title="binder">val</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)  (<a id="mem:126" class="idref" href="#mem:126"><span class="id" title="binder">mem</span></a>:<a class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a>) (<a id="inc_ptr:127" class="idref" href="#inc_ptr:127"><span class="id" title="binder">inc_ptr</span></a>: <a class="idref" href="#CoreInstructionSet.dest_heap_ptr"><span class="id" title="variable">dest_heap_ptr</span></a>)<br/>
<br/>
<br/>
&nbsp;&nbsp;| <a id="OpLoadPointer" class="idref" href="#OpLoadPointer"><span class="id" title="constructor">OpLoadPointer</span></a>     (<a id="ptr:128" class="idref" href="#ptr:128"><span class="id" title="binder">ptr</span></a>: <a class="idref" href="#CoreInstructionSet.src_fat_ptr"><span class="id" title="variable">src_fat_ptr</span></a>)  (<a id="res:129" class="idref" href="#res:129"><span class="id" title="binder">res</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpLoadPointerInc" class="idref" href="#OpLoadPointerInc"><span class="id" title="constructor">OpLoadPointerInc</span></a>  (<a id="ptr:130" class="idref" href="#ptr:130"><span class="id" title="binder">ptr</span></a>: <a class="idref" href="#CoreInstructionSet.src_fat_ptr"><span class="id" title="variable">src_fat_ptr</span></a>)  (<a id="res:131" class="idref" href="#res:131"><span class="id" title="binder">res</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>) (<a id="inc_ptr:132" class="idref" href="#inc_ptr:132"><span class="id" title="binder">inc_ptr</span></a>: <a class="idref" href="#CoreInstructionSet.dest_fat_ptr"><span class="id" title="variable">dest_fat_ptr</span></a>)<br/>
<br/>
<br/>
&nbsp;&nbsp;| <a id="OpContractThis" class="idref" href="#OpContractThis"><span class="id" title="constructor">OpContractThis</span></a>        (<a id="out:133" class="idref" href="#out:133"><span class="id" title="binder">out</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpContractCaller" class="idref" href="#OpContractCaller"><span class="id" title="constructor">OpContractCaller</span></a>      (<a id="out:134" class="idref" href="#out:134"><span class="id" title="binder">out</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpContractCodeAddress" class="idref" href="#OpContractCodeAddress"><span class="id" title="constructor">OpContractCodeAddress</span></a> (<a id="out:135" class="idref" href="#out:135"><span class="id" title="binder">out</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>)<br/>
<br/>
&nbsp;&nbsp;| <a id="OpVMMeta" class="idref" href="#OpVMMeta"><span class="id" title="constructor">OpVMMeta</span></a>              (<a id="out:136" class="idref" href="#out:136"><span class="id" title="binder">out</span></a>: <a class="idref" href="#CoreInstructionSet.dest_meta_params"><span class="id" title="variable">dest_meta_params</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpVMErgsLeft" class="idref" href="#OpVMErgsLeft"><span class="id" title="constructor">OpVMErgsLeft</span></a>          (<a id="out:137" class="idref" href="#out:137"><span class="id" title="binder">out</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpVMSP" class="idref" href="#OpVMSP"><span class="id" title="constructor">OpVMSP</span></a>                (<a id="out:138" class="idref" href="#out:138"><span class="id" title="binder">out</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>)<br/>
<br/>
&nbsp;&nbsp;| <a id="OpGetCapturedContext" class="idref" href="#OpGetCapturedContext"><span class="id" title="constructor">OpGetCapturedContext</span></a>  (<a id="out:139" class="idref" href="#out:139"><span class="id" title="binder">out</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpSetContextReg" class="idref" href="#OpSetContextReg"><span class="id" title="constructor">OpSetContextReg</span></a>       (<a id="in1:140" class="idref" href="#in1:140"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Removed&nbsp;in&nbsp;VM&nbsp;1.5.0<br/>
|&nbsp;OpContextSetErgsPerPubdataByte&nbsp;(in1:&nbsp;src_pv)<br/>
&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a id="OpIncrementTxNumber" class="idref" href="#OpIncrementTxNumber"><span class="id" title="constructor">OpIncrementTxNumber</span></a><br/>
<br/>
<br/>
&nbsp;&nbsp;| <a id="OpSLoad" class="idref" href="#OpSLoad"><span class="id" title="constructor">OpSLoad</span></a>          (<a id="in1:141" class="idref" href="#in1:141"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)                  (<a id="out:142" class="idref" href="#out:142"><span class="id" title="binder">out</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpSStore" class="idref" href="#OpSStore"><span class="id" title="constructor">OpSStore</span></a>         (<a id="in1:143" class="idref" href="#in1:143"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>) (<a id="in2:144" class="idref" href="#in2:144"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpToL1Message" class="idref" href="#OpToL1Message"><span class="id" title="constructor">OpToL1Message</span></a>    (<a id="in1:145" class="idref" href="#in1:145"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>) (<a id="in2:146" class="idref" href="#in2:146"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)                   (<a id="is_first:147" class="idref" href="#is_first:147"><span class="id" title="binder">is_first</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpEvent" class="idref" href="#OpEvent"><span class="id" title="constructor">OpEvent</span></a>          (<a id="in1:148" class="idref" href="#in1:148"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>) (<a id="in2:149" class="idref" href="#in2:149"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)                   (<a id="is_first:150" class="idref" href="#is_first:150"><span class="id" title="binder">is_first</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
&nbsp;&nbsp;| <a id="OpPrecompileCall" class="idref" href="#OpPrecompileCall"><span class="id" title="constructor">OpPrecompileCall</span></a> (<a id="in1:151" class="idref" href="#in1:151"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_precompile_params"><span class="id" title="variable">src_precompile_params</span></a>) (<a id="ergs:152" class="idref" href="#ergs:152"><span class="id" title="binder">ergs</span></a>:<a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)    (<a id="out:153" class="idref" href="#out:153"><span class="id" title="binder">out</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>)<br/>
<br/>
&nbsp;&nbsp;| <a id="OpTransientStore" class="idref" href="#OpTransientStore"><span class="id" title="constructor">OpTransientStore</span></a> (<a id="in1:154" class="idref" href="#in1:154"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>) (<a id="in2:155" class="idref" href="#in2:155"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Since&nbsp;VM&nbsp;1.5.0&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a id="OpTransientLoad" class="idref" href="#OpTransientLoad"><span class="id" title="constructor">OpTransientLoad</span></a>  (<a id="in1:156" class="idref" href="#in1:156"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>) (<a id="out:157" class="idref" href="#out:157"><span class="id" title="binder">out</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Since&nbsp;VM&nbsp;1.5.0&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a id="OpStaticRead" class="idref" href="#OpStaticRead"><span class="id" title="constructor">OpStaticRead</span></a>     (<a id="in1:158" class="idref" href="#in1:158"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_heap_ptr"><span class="id" title="variable">src_heap_ptr</span></a>) (<a id="out:159" class="idref" href="#out:159"><span class="id" title="binder">out</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Since&nbsp;VM&nbsp;1.5.0&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a id="OpStaticReadInc" class="idref" href="#OpStaticReadInc"><span class="id" title="constructor">OpStaticReadInc</span></a>  (<a id="in1:160" class="idref" href="#in1:160"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_heap_ptr"><span class="id" title="variable">src_heap_ptr</span></a>) (<a id="out1:161" class="idref" href="#out1:161"><span class="id" title="binder">out1</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>) (<a id="out2:162" class="idref" href="#out2:162"><span class="id" title="binder">out2</span></a>: <a class="idref" href="#CoreInstructionSet.dest_heap_ptr"><span class="id" title="variable">dest_heap_ptr</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Since&nbsp;VM&nbsp;1.5.0&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a id="OpStaticWrite" class="idref" href="#OpStaticWrite"><span class="id" title="constructor">OpStaticWrite</span></a>    (<a id="in1:163" class="idref" href="#in1:163"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_heap_ptr"><span class="id" title="variable">src_heap_ptr</span></a>) (<a id="in2:164" class="idref" href="#in2:164"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Since&nbsp;VM&nbsp;1.5.0&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a id="OpStaticWriteInc" class="idref" href="#OpStaticWriteInc"><span class="id" title="constructor">OpStaticWriteInc</span></a> (<a id="in1:165" class="idref" href="#in1:165"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_heap_ptr"><span class="id" title="variable">src_heap_ptr</span></a>) (<a id="in2:166" class="idref" href="#in2:166"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)  (<a id="out:167" class="idref" href="#out:167"><span class="id" title="binder">out</span></a>: <a class="idref" href="#CoreInstructionSet.dest_heap_ptr"><span class="id" title="variable">dest_heap_ptr</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Since&nbsp;VM&nbsp;1.5.0&nbsp;*)</span><br/>
&nbsp;&nbsp;|  <a id="OpDecommit" class="idref" href="#OpDecommit"><span class="id" title="constructor">OpDecommit</span></a>       (<a id="in1:168" class="idref" href="#in1:168"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)  (<a id="in2:169" class="idref" href="#in2:169"><span class="id" title="binder">in2</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)  (<a id="out:170" class="idref" href="#out:170"><span class="id" title="binder">out</span></a>: <a class="idref" href="#CoreInstructionSet.dest_pv"><span class="id" title="variable">dest_pv</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Since&nbsp;VM&nbsp;1.5.0&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a id="OpAuxMutating" class="idref" href="#OpAuxMutating"><span class="id" title="constructor">OpAuxMutating</span></a>     (<a id="in1:171" class="idref" href="#in1:171"><span class="id" title="binder">in1</span></a>: <a class="idref" href="#CoreInstructionSet.src_pv"><span class="id" title="variable">src_pv</span></a>)<br/>
&nbsp;&nbsp;.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#CoreInstructionSet"><span class="id" title="section">CoreInstructionSet</span></a>.<br/>

<br/>
#[<span class="id" title="var">global</span>]<br/>
&nbsp;&nbsp;<span class="id" title="var">Canonical</span> <span class="id" title="keyword">Structure</span> <a id="decoded" class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a>: <a class="idref" href="#descr"><span class="id" title="record">descr</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="src:172" class="idref" href="#src:172"><span class="id" title="binder">src</span></a> := <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="dest:173" class="idref" href="#dest:173"><span class="id" title="binder">dest</span></a> := <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#src_pv"><span class="id" title="projection">src_pv</span></a> := <a class="idref" href="#src:172"><span class="id" title="variable">src</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#src_fat_ptr"><span class="id" title="projection">src_fat_ptr</span></a> :=<a class="idref" href="#src:172"><span class="id" title="variable">src</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#src_heap_ptr"><span class="id" title="projection">src_heap_ptr</span></a> :=<a class="idref" href="#src:172"><span class="id" title="variable">src</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#src_farcall_params"><span class="id" title="projection">src_farcall_params</span></a> := <a class="idref" href="#src:172"><span class="id" title="variable">src</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#src_nearcall_params"><span class="id" title="projection">src_nearcall_params</span></a> := <a class="idref" href="#src:172"><span class="id" title="variable">src</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#src_ret_params"><span class="id" title="projection">src_ret_params</span></a> := <a class="idref" href="#src:172"><span class="id" title="variable">src</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#src_precompile_params"><span class="id" title="projection">src_precompile_params</span></a> := <a class="idref" href="#src:172"><span class="id" title="variable">src</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#dest_pv"><span class="id" title="projection">dest_pv</span></a> := <a class="idref" href="#dest:173"><span class="id" title="variable">dest</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#dest_heap_ptr"><span class="id" title="projection">dest_heap_ptr</span></a> := <a class="idref" href="#dest:173"><span class="id" title="variable">dest</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#dest_fat_ptr"><span class="id" title="projection">dest_fat_ptr</span></a> := <a class="idref" href="#dest:173"><span class="id" title="variable">dest</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#dest_meta_params"><span class="id" title="projection">dest_meta_params</span></a> := <a class="idref" href="#dest:173"><span class="id" title="variable">dest</span></a>;<br/>
&nbsp;&nbsp;|}.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="InstructionMapper" class="idref" href="#InstructionMapper"><span class="id" title="section">InstructionMapper</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <a id="state_rel" class="idref" href="#state_rel"><span class="id" title="abbreviation">state_rel</span></a> <span class="id" title="var">S</span> <span class="id" title="var">OP</span> <span class="id" title="var">V</span> := (<span class="id" title="var">S</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="var">S</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="var">OP</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="var">V</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="relate_st" class="idref" href="#relate_st"><span class="id" title="record">relate_st</span></a> {<a id="S:174" class="idref" href="#S:174"><span class="id" title="binder">S</span></a>} {<a id="A:175" class="idref" href="#A:175"><span class="id" title="binder">A</span></a> <a id="B:176" class="idref" href="#B:176"><span class="id" title="binder">B</span></a>: <a class="idref" href="#descr"><span class="id" title="record">descr</span></a>}: <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="mf_src_pv" class="idref" href="#mf_src_pv"><span class="id" title="projection">mf_src_pv</span></a> : <a class="idref" href="#state_rel"><span class="id" title="abbreviation">state_rel</span></a> <a class="idref" href="#S:174"><span class="id" title="variable">S</span></a> (<a class="idref" href="#src_pv"><span class="id" title="projection">src_pv</span></a> <a class="idref" href="#A:175"><span class="id" title="variable">A</span></a>) (<a class="idref" href="#src_pv"><span class="id" title="projection">src_pv</span></a> <a class="idref" href="#B:176"><span class="id" title="variable">B</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="mf_src_fat_ptr" class="idref" href="#mf_src_fat_ptr"><span class="id" title="projection">mf_src_fat_ptr</span></a>: <a class="idref" href="#state_rel"><span class="id" title="abbreviation">state_rel</span></a> <a class="idref" href="#S:174"><span class="id" title="variable">S</span></a> (<a class="idref" href="#src_fat_ptr"><span class="id" title="projection">src_fat_ptr</span></a> <a class="idref" href="#A:175"><span class="id" title="variable">A</span></a>) (<a class="idref" href="#src_fat_ptr"><span class="id" title="projection">src_fat_ptr</span></a> <a class="idref" href="#B:176"><span class="id" title="variable">B</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="mf_src_heap_ptr" class="idref" href="#mf_src_heap_ptr"><span class="id" title="projection">mf_src_heap_ptr</span></a>: <a class="idref" href="#state_rel"><span class="id" title="abbreviation">state_rel</span></a> <a class="idref" href="#S:174"><span class="id" title="variable">S</span></a> (<a class="idref" href="#src_heap_ptr"><span class="id" title="projection">src_heap_ptr</span></a> <a class="idref" href="#A:175"><span class="id" title="variable">A</span></a>) (<a class="idref" href="#src_heap_ptr"><span class="id" title="projection">src_heap_ptr</span></a> <a class="idref" href="#B:176"><span class="id" title="variable">B</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="mf_src_farcall_params" class="idref" href="#mf_src_farcall_params"><span class="id" title="projection">mf_src_farcall_params</span></a>: <a class="idref" href="#state_rel"><span class="id" title="abbreviation">state_rel</span></a> <a class="idref" href="#S:174"><span class="id" title="variable">S</span></a> (<a class="idref" href="#src_farcall_params"><span class="id" title="projection">src_farcall_params</span></a> <a class="idref" href="#A:175"><span class="id" title="variable">A</span></a>) (<a class="idref" href="#src_farcall_params"><span class="id" title="projection">src_farcall_params</span></a> <a class="idref" href="#B:176"><span class="id" title="variable">B</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="mf_src_nearcall_params" class="idref" href="#mf_src_nearcall_params"><span class="id" title="projection">mf_src_nearcall_params</span></a>: <a class="idref" href="#state_rel"><span class="id" title="abbreviation">state_rel</span></a> <a class="idref" href="#S:174"><span class="id" title="variable">S</span></a> (<a class="idref" href="#src_nearcall_params"><span class="id" title="projection">src_nearcall_params</span></a> <a class="idref" href="#A:175"><span class="id" title="variable">A</span></a>) (<a class="idref" href="#src_nearcall_params"><span class="id" title="projection">src_nearcall_params</span></a> <a class="idref" href="#B:176"><span class="id" title="variable">B</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="mf_src_ret_params" class="idref" href="#mf_src_ret_params"><span class="id" title="projection">mf_src_ret_params</span></a>: <a class="idref" href="#state_rel"><span class="id" title="abbreviation">state_rel</span></a> <a class="idref" href="#S:174"><span class="id" title="variable">S</span></a> (<a class="idref" href="#src_ret_params"><span class="id" title="projection">src_ret_params</span></a> <a class="idref" href="#A:175"><span class="id" title="variable">A</span></a>) (<a class="idref" href="#src_ret_params"><span class="id" title="projection">src_ret_params</span></a> <a class="idref" href="#B:176"><span class="id" title="variable">B</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="mf_src_precompile_params" class="idref" href="#mf_src_precompile_params"><span class="id" title="projection">mf_src_precompile_params</span></a>: <a class="idref" href="#state_rel"><span class="id" title="abbreviation">state_rel</span></a> <a class="idref" href="#S:174"><span class="id" title="variable">S</span></a> (<a class="idref" href="#src_precompile_params"><span class="id" title="projection">src_precompile_params</span></a> <a class="idref" href="#A:175"><span class="id" title="variable">A</span></a>) (<a class="idref" href="#src_precompile_params"><span class="id" title="projection">src_precompile_params</span></a> <a class="idref" href="#B:176"><span class="id" title="variable">B</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="mf_dest_pv" class="idref" href="#mf_dest_pv"><span class="id" title="projection">mf_dest_pv</span></a>: <a class="idref" href="#state_rel"><span class="id" title="abbreviation">state_rel</span></a> <a class="idref" href="#S:174"><span class="id" title="variable">S</span></a> (<a class="idref" href="#dest_pv"><span class="id" title="projection">dest_pv</span></a> <a class="idref" href="#A:175"><span class="id" title="variable">A</span></a>) (<a class="idref" href="#dest_pv"><span class="id" title="projection">dest_pv</span></a> <a class="idref" href="#B:176"><span class="id" title="variable">B</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="mf_dest_heap_ptr" class="idref" href="#mf_dest_heap_ptr"><span class="id" title="projection">mf_dest_heap_ptr</span></a>: <a class="idref" href="#state_rel"><span class="id" title="abbreviation">state_rel</span></a> <a class="idref" href="#S:174"><span class="id" title="variable">S</span></a> (<a class="idref" href="#dest_heap_ptr"><span class="id" title="projection">dest_heap_ptr</span></a> <a class="idref" href="#A:175"><span class="id" title="variable">A</span></a>) (<a class="idref" href="#dest_heap_ptr"><span class="id" title="projection">dest_heap_ptr</span></a> <a class="idref" href="#B:176"><span class="id" title="variable">B</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="mf_dest_fat_ptr" class="idref" href="#mf_dest_fat_ptr"><span class="id" title="projection">mf_dest_fat_ptr</span></a> : <a class="idref" href="#state_rel"><span class="id" title="abbreviation">state_rel</span></a> <a class="idref" href="#S:174"><span class="id" title="variable">S</span></a> (<a class="idref" href="#dest_fat_ptr"><span class="id" title="projection">dest_fat_ptr</span></a>  <a class="idref" href="#A:175"><span class="id" title="variable">A</span></a>) (<a class="idref" href="#dest_fat_ptr"><span class="id" title="projection">dest_fat_ptr</span></a>  <a class="idref" href="#B:176"><span class="id" title="variable">B</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="mf_dest_meta_params" class="idref" href="#mf_dest_meta_params"><span class="id" title="projection">mf_dest_meta_params</span></a>: <a class="idref" href="#state_rel"><span class="id" title="abbreviation">state_rel</span></a> <a class="idref" href="#S:174"><span class="id" title="variable">S</span></a> (<a class="idref" href="#dest_meta_params"><span class="id" title="projection">dest_meta_params</span></a> <a class="idref" href="#A:175"><span class="id" title="variable">A</span></a>) (<a class="idref" href="#dest_meta_params"><span class="id" title="projection">dest_meta_params</span></a> <a class="idref" href="#B:176"><span class="id" title="variable">B</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable Variables</span> <span class="id" title="var">s</span> <span class="id" title="var">i</span> <span class="id" title="var">o</span> <span class="id" title="var">imm</span> <span class="id" title="var">fs</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="S:189" class="idref" href="#S:189"><span class="id" title="binder">S</span></a> <a id="A:190" class="idref" href="#A:190"><span class="id" title="binder">A</span></a> <a id="B:191" class="idref" href="#B:191"><span class="id" title="binder">B</span></a>} (<a id="m:192" class="idref" href="#m:192"><span class="id" title="binder">m</span></a>:@<a class="idref" href="#relate_st"><span class="id" title="record">relate_st</span></a> <a class="idref" href="#S:189"><span class="id" title="variable">S</span></a> <a class="idref" href="#A:190"><span class="id" title="variable">A</span></a> <a class="idref" href="#B:191"><span class="id" title="variable">B</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="mf_src_pv:193" class="idref" href="#mf_src_pv:193"><span class="id" title="binder">mf_src_pv</span></a> := <a class="idref" href="#mf_src_pv"><span class="id" title="projection">mf_src_pv</span></a> <a class="idref" href="#m:192"><span class="id" title="variable">m</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="mf_src_fat_ptr:194" class="idref" href="#mf_src_fat_ptr:194"><span class="id" title="binder">mf_src_fat_ptr</span></a> := <a class="idref" href="#mf_src_fat_ptr"><span class="id" title="projection">mf_src_fat_ptr</span></a> <a class="idref" href="#m:192"><span class="id" title="variable">m</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="mf_src_heap_ptr:195" class="idref" href="#mf_src_heap_ptr:195"><span class="id" title="binder">mf_src_heap_ptr</span></a> := <a class="idref" href="#mf_src_heap_ptr"><span class="id" title="projection">mf_src_heap_ptr</span></a> <a class="idref" href="#m:192"><span class="id" title="variable">m</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="mf_src_farcall_params:196" class="idref" href="#mf_src_farcall_params:196"><span class="id" title="binder">mf_src_farcall_params</span></a> := <a class="idref" href="#mf_src_farcall_params"><span class="id" title="projection">mf_src_farcall_params</span></a> <a class="idref" href="#m:192"><span class="id" title="variable">m</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="mf_src_nearcall_params:197" class="idref" href="#mf_src_nearcall_params:197"><span class="id" title="binder">mf_src_nearcall_params</span></a> := <a class="idref" href="#mf_src_nearcall_params"><span class="id" title="projection">mf_src_nearcall_params</span></a> <a class="idref" href="#m:192"><span class="id" title="variable">m</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="mf_src_ret_params:198" class="idref" href="#mf_src_ret_params:198"><span class="id" title="binder">mf_src_ret_params</span></a> := <a class="idref" href="#mf_src_ret_params"><span class="id" title="projection">mf_src_ret_params</span></a> <a class="idref" href="#m:192"><span class="id" title="variable">m</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="mf_src_precompile_params:199" class="idref" href="#mf_src_precompile_params:199"><span class="id" title="binder">mf_src_precompile_params</span></a> := <a class="idref" href="#mf_src_precompile_params"><span class="id" title="projection">mf_src_precompile_params</span></a> <a class="idref" href="#m:192"><span class="id" title="variable">m</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="mf_dest_pv:200" class="idref" href="#mf_dest_pv:200"><span class="id" title="binder">mf_dest_pv</span></a> := <a class="idref" href="#mf_dest_pv"><span class="id" title="projection">mf_dest_pv</span></a> <a class="idref" href="#m:192"><span class="id" title="variable">m</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="mf_dest_heap_ptr:201" class="idref" href="#mf_dest_heap_ptr:201"><span class="id" title="binder">mf_dest_heap_ptr</span></a> := <a class="idref" href="#mf_dest_heap_ptr"><span class="id" title="projection">mf_dest_heap_ptr</span></a> <a class="idref" href="#m:192"><span class="id" title="variable">m</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="mf_dest_fat_ptr:202" class="idref" href="#mf_dest_fat_ptr:202"><span class="id" title="binder">mf_dest_fat_ptr</span></a> := <a class="idref" href="#mf_dest_fat_ptr"><span class="id" title="projection">mf_dest_fat_ptr</span></a> <a class="idref" href="#m:192"><span class="id" title="variable">m</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="mf_dest_meta_params:203" class="idref" href="#mf_dest_meta_params:203"><span class="id" title="binder">mf_dest_meta_params</span></a> := <a class="idref" href="#mf_dest_meta_params"><span class="id" title="projection">mf_dest_meta_params</span></a> <a class="idref" href="#m:192"><span class="id" title="variable">m</span></a>)<br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="ins_srelate" class="idref" href="#ins_srelate"><span class="id" title="inductive">ins_srelate</span></a> :  <a class="idref" href="#InstructionMapper.S"><span class="id" title="variable">S</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#InstructionMapper.S"><span class="id" title="variable">S</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#InstructionMapper.A"><span class="id" title="variable">A</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#InstructionMapper.B"><span class="id" title="variable">B</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;|<a id="sim_noop" class="idref" href="#sim_noop"><span class="id" title="constructor">sim_noop</span></a>: <span class="id" title="keyword">∀</span> <a id="s:206" class="idref" href="#s:206"><span class="id" title="binder">s</span></a>, <a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <a class="idref" href="#s:206"><span class="id" title="variable">s</span></a> <a class="idref" href="#s:206"><span class="id" title="variable">s</span></a> <a class="idref" href="#OpNoOp"><span class="id" title="constructor">OpNoOp</span></a> <a class="idref" href="#OpNoOp"><span class="id" title="constructor">OpNoOp</span></a><br/>
&nbsp;&nbsp;|<a id="sim_invalid" class="idref" href="#sim_invalid"><span class="id" title="constructor">sim_invalid</span></a>: <span class="id" title="keyword">∀</span> <a id="s:207" class="idref" href="#s:207"><span class="id" title="binder">s</span></a>, <a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <a class="idref" href="#s:207"><span class="id" title="variable">s</span></a> <a class="idref" href="#s:207"><span class="id" title="variable">s</span></a> <a class="idref" href="#OpInvalid"><span class="id" title="constructor">OpInvalid</span></a> <a class="idref" href="#OpInvalid"><span class="id" title="constructor">OpInvalid</span></a><br/>
&nbsp;&nbsp;|<a id="sim_sp_add" class="idref" href="#sim_sp_add"><span class="id" title="constructor">sim_sp_add</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> (<a class="idref" href="#OpSpAdd"><span class="id" title="constructor">OpSpAdd</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">imm1</span>) (<a class="idref" href="#OpSpAdd"><span class="id" title="constructor">OpSpAdd</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">imm1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_sp_sub" class="idref" href="#sim_sp_sub"><span class="id" title="constructor">sim_sp_sub</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> (<a class="idref" href="#OpSpSub"><span class="id" title="constructor">OpSpSub</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">imm1</span>) (<a class="idref" href="#OpSpSub"><span class="id" title="constructor">OpSpSub</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">imm1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_jump" class="idref" href="#sim_jump"><span class="id" title="constructor">sim_jump</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> (<a class="idref" href="#OpJump"><span class="id" title="constructor">OpJump</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">o1</span>) (<a class="idref" href="#OpJump"><span class="id" title="constructor">OpJump</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">o1'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_and" class="idref" href="#sim_and"><span class="id" title="constructor">sim_and</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s3</span> (<a class="idref" href="#OpAnd"><span class="id" title="constructor">OpAnd</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">o1</span> <span class="id" title="var">fs</span>) (<a class="idref" href="#OpAnd"><span class="id" title="constructor">OpAnd</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <span class="id" title="var">o1'</span>  <span class="id" title="var">fs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_or" class="idref" href="#sim_or"><span class="id" title="constructor">sim_or</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s3</span> (<a class="idref" href="#OpOr"><span class="id" title="constructor">OpOr</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">o1</span>  <span class="id" title="var">fs</span>) (<a class="idref" href="#OpOr"><span class="id" title="constructor">OpOr</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <span class="id" title="var">o1'</span>  <span class="id" title="var">fs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_xor" class="idref" href="#sim_xor"><span class="id" title="constructor">sim_xor</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s3</span> (<a class="idref" href="#OpXor"><span class="id" title="constructor">OpXor</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">o1</span>  <span class="id" title="var">fs</span>) (<a class="idref" href="#OpXor"><span class="id" title="constructor">OpXor</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <span class="id" title="var">o1'</span>  <span class="id" title="var">fs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_add" class="idref" href="#sim_add"><span class="id" title="constructor">sim_add</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s3</span> (<a class="idref" href="#OpAdd"><span class="id" title="constructor">OpAdd</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">o1</span>  <span class="id" title="var">fs</span>) (<a class="idref" href="#OpAdd"><span class="id" title="constructor">OpAdd</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <span class="id" title="var">o1'</span>  <span class="id" title="var">fs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_sub" class="idref" href="#sim_sub"><span class="id" title="constructor">sim_sub</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s3</span> (<a class="idref" href="#OpSub"><span class="id" title="constructor">OpSub</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">o1</span>  <span class="id" title="var">fs</span>) (<a class="idref" href="#OpSub"><span class="id" title="constructor">OpSub</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <span class="id" title="var">o1'</span>  <span class="id" title="var">fs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_shl" class="idref" href="#sim_shl"><span class="id" title="constructor">sim_shl</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s3</span> (<a class="idref" href="#OpShl"><span class="id" title="constructor">OpShl</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">o1</span> <span class="id" title="var">fs</span>) (<a class="idref" href="#OpShl"><span class="id" title="constructor">OpShl</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <span class="id" title="var">o1'</span> <span class="id" title="var">fs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_shr" class="idref" href="#sim_shr"><span class="id" title="constructor">sim_shr</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s3</span> (<a class="idref" href="#OpShr"><span class="id" title="constructor">OpShr</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">o1</span> <span class="id" title="var">fs</span>) (<a class="idref" href="#OpShr"><span class="id" title="constructor">OpShr</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <span class="id" title="var">o1'</span> <span class="id" title="var">fs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_rol" class="idref" href="#sim_rol"><span class="id" title="constructor">sim_rol</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s3</span> (<a class="idref" href="#OpRol"><span class="id" title="constructor">OpRol</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">o1</span> <span class="id" title="var">fs</span>) (<a class="idref" href="#OpRol"><span class="id" title="constructor">OpRol</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <span class="id" title="var">o1'</span> <span class="id" title="var">fs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_ror" class="idref" href="#sim_ror"><span class="id" title="constructor">sim_ror</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s3</span> (<a class="idref" href="#OpRor"><span class="id" title="constructor">OpRor</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">o1</span> <span class="id" title="var">fs</span>) (<a class="idref" href="#OpRor"><span class="id" title="constructor">OpRor</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <span class="id" title="var">o1'</span> <span class="id" title="var">fs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_PtrAdd" class="idref" href="#sim_PtrAdd"><span class="id" title="constructor">sim_PtrAdd</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_fat_ptr"><span class="id" title="variable">mf_src_fat_ptr</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_fat_ptr"><span class="id" title="variable">mf_dest_fat_ptr</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s3</span> (<a class="idref" href="#OpPtrAdd"><span class="id" title="constructor">OpPtrAdd</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">o1</span>) (<a class="idref" href="#OpPtrAdd"><span class="id" title="constructor">OpPtrAdd</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <span class="id" title="var">o1'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_PtrSub" class="idref" href="#sim_PtrSub"><span class="id" title="constructor">sim_PtrSub</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_fat_ptr"><span class="id" title="variable">mf_src_fat_ptr</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_fat_ptr"><span class="id" title="variable">mf_dest_fat_ptr</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s3</span> (<a class="idref" href="#OpPtrSub"><span class="id" title="constructor">OpPtrSub</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">o1</span>) (<a class="idref" href="#OpPtrSub"><span class="id" title="constructor">OpPtrSub</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <span class="id" title="var">o1'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_PtrShrink" class="idref" href="#sim_PtrShrink"><span class="id" title="constructor">sim_PtrShrink</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_fat_ptr"><span class="id" title="variable">mf_src_fat_ptr</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_fat_ptr"><span class="id" title="variable">mf_dest_fat_ptr</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s3</span> (<a class="idref" href="#OpPtrShrink"><span class="id" title="constructor">OpPtrShrink</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">o1</span>) (<a class="idref" href="#OpPtrShrink"><span class="id" title="constructor">OpPtrShrink</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <span class="id" title="var">o1'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_PtrPack" class="idref" href="#sim_PtrPack"><span class="id" title="constructor">sim_PtrPack</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_fat_ptr"><span class="id" title="variable">mf_src_fat_ptr</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s3</span> (<a class="idref" href="#OpPtrPack"><span class="id" title="constructor">OpPtrPack</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">o1</span>) (<a class="idref" href="#OpPtrPack"><span class="id" title="constructor">OpPtrPack</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <span class="id" title="var">o1'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_mul" class="idref" href="#sim_mul"><span class="id" title="constructor">sim_mul</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s3</span> <span class="id" title="var">s4</span> <span class="id" title="var">o2</span> <span class="id" title="var">o2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s4</span> (<a class="idref" href="#OpMul"><span class="id" title="constructor">OpMul</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">o1</span> <span class="id" title="var">o2</span>  <span class="id" title="var">fs</span>) (<a class="idref" href="#OpMul"><span class="id" title="constructor">OpMul</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <span class="id" title="var">o1'</span> <span class="id" title="var">o2'</span> <span class="id" title="var">fs</span> )<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_div" class="idref" href="#sim_div"><span class="id" title="constructor">sim_div</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s3</span> <span class="id" title="var">s4</span> <span class="id" title="var">o2</span> <span class="id" title="var">o2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s4</span> (<a class="idref" href="#OpDiv"><span class="id" title="constructor">OpDiv</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">o1</span> <span class="id" title="var">o2</span>  <span class="id" title="var">fs</span>) (<a class="idref" href="#OpDiv"><span class="id" title="constructor">OpDiv</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <span class="id" title="var">o1'</span> <span class="id" title="var">o2'</span>  <span class="id" title="var">fs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_nearcall" class="idref" href="#sim_nearcall"><span class="id" title="constructor">sim_nearcall</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="dest:391" class="idref" href="#dest:391"><span class="id" title="binder">dest</span></a> <a id="handler:392" class="idref" href="#handler:392"><span class="id" title="binder">handler</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_nearcall_params"><span class="id" title="variable">mf_src_nearcall_params</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> (<a class="idref" href="#OpNearCall"><span class="id" title="constructor">OpNearCall</span></a> <span class="id" title="var">i1</span> <a class="idref" href="#dest:391"><span class="id" title="variable">dest</span></a> <a class="idref" href="#handler:392"><span class="id" title="variable">handler</span></a>) (<a class="idref" href="#OpNearCall"><span class="id" title="constructor">OpNearCall</span></a> <span class="id" title="var">i1'</span> <a class="idref" href="#dest:391"><span class="id" title="variable">dest</span></a> <a class="idref" href="#handler:392"><span class="id" title="variable">handler</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_farcall" class="idref" href="#sim_farcall"><span class="id" title="constructor">sim_farcall</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="handler:397" class="idref" href="#handler:397"><span class="id" title="binder">handler</span></a> <a id="static:398" class="idref" href="#static:398"><span class="id" title="binder">static</span></a> <a id="shard:399" class="idref" href="#shard:399"><span class="id" title="binder">shard</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_farcall_params"><span class="id" title="variable">mf_src_farcall_params</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s2</span> (<a class="idref" href="#OpFarCall"><span class="id" title="constructor">OpFarCall</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <a class="idref" href="#handler:397"><span class="id" title="variable">handler</span></a> <a class="idref" href="#static:398"><span class="id" title="variable">static</span></a> <a class="idref" href="#shard:399"><span class="id" title="variable">shard</span></a>) (<a class="idref" href="#OpFarCall"><span class="id" title="constructor">OpFarCall</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <a class="idref" href="#handler:397"><span class="id" title="variable">handler</span></a> <a class="idref" href="#static:398"><span class="id" title="variable">static</span></a> <a class="idref" href="#shard:399"><span class="id" title="variable">shard</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_mimiccall" class="idref" href="#sim_mimiccall"><span class="id" title="constructor">sim_mimiccall</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="handler:407" class="idref" href="#handler:407"><span class="id" title="binder">handler</span></a> <a id="static:408" class="idref" href="#static:408"><span class="id" title="binder">static</span></a> <a id="shard:409" class="idref" href="#shard:409"><span class="id" title="binder">shard</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_farcall_params"><span class="id" title="variable">mf_src_farcall_params</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s2</span> (<a class="idref" href="#OpMimicCall"><span class="id" title="constructor">OpMimicCall</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <a class="idref" href="#handler:407"><span class="id" title="variable">handler</span></a> <a class="idref" href="#static:408"><span class="id" title="variable">static</span></a> <a class="idref" href="#shard:409"><span class="id" title="variable">shard</span></a>) (<a class="idref" href="#OpMimicCall"><span class="id" title="constructor">OpMimicCall</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <a class="idref" href="#handler:407"><span class="id" title="variable">handler</span></a> <a class="idref" href="#static:408"><span class="id" title="variable">static</span></a> <a class="idref" href="#shard:409"><span class="id" title="variable">shard</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_delegatecall" class="idref" href="#sim_delegatecall"><span class="id" title="constructor">sim_delegatecall</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="handler:417" class="idref" href="#handler:417"><span class="id" title="binder">handler</span></a> <a id="static:418" class="idref" href="#static:418"><span class="id" title="binder">static</span></a> <a id="shard:419" class="idref" href="#shard:419"><span class="id" title="binder">shard</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_farcall_params"><span class="id" title="variable">mf_src_farcall_params</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s2</span>(<a class="idref" href="#OpDelegateCall"><span class="id" title="constructor">OpDelegateCall</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <a class="idref" href="#handler:417"><span class="id" title="variable">handler</span></a> <a class="idref" href="#static:418"><span class="id" title="variable">static</span></a> <a class="idref" href="#shard:419"><span class="id" title="variable">shard</span></a>) (<a class="idref" href="#OpDelegateCall"><span class="id" title="constructor">OpDelegateCall</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <a class="idref" href="#handler:417"><span class="id" title="variable">handler</span></a> <a class="idref" href="#static:418"><span class="id" title="variable">static</span></a> <a class="idref" href="#shard:419"><span class="id" title="variable">shard</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_nearpanic" class="idref" href="#sim_nearpanic"><span class="id" title="constructor">sim_nearpanic</span></a>: <span class="id" title="keyword">∀</span> <a id="s:427" class="idref" href="#s:427"><span class="id" title="binder">s</span></a>, <a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <a class="idref" href="#s:427"><span class="id" title="variable">s</span></a> <a class="idref" href="#s:427"><span class="id" title="variable">s</span></a> <a class="idref" href="#OpPanic"><span class="id" title="constructor">OpPanic</span></a> <a class="idref" href="#OpPanic"><span class="id" title="constructor">OpPanic</span></a><br/>
&nbsp;&nbsp;|<a id="sim_nearretto" class="idref" href="#sim_nearretto"><span class="id" title="constructor">sim_nearretto</span></a>: <span class="id" title="keyword">∀</span> <a id="s:428" class="idref" href="#s:428"><span class="id" title="binder">s</span></a> <a id="l:429" class="idref" href="#l:429"><span class="id" title="binder">l</span></a>, <a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <a class="idref" href="#s:428"><span class="id" title="variable">s</span></a> <a class="idref" href="#s:428"><span class="id" title="variable">s</span></a> (<a class="idref" href="#OpNearRetTo"><span class="id" title="constructor">OpNearRetTo</span></a> <a class="idref" href="#l:429"><span class="id" title="variable">l</span></a>) (<a class="idref" href="#OpNearRetTo"><span class="id" title="constructor">OpNearRetTo</span></a> <a class="idref" href="#l:429"><span class="id" title="variable">l</span></a>)<br/>
&nbsp;&nbsp;|<a id="sim_nearrevertto" class="idref" href="#sim_nearrevertto"><span class="id" title="constructor">sim_nearrevertto</span></a>: <span class="id" title="keyword">∀</span> <a id="s:430" class="idref" href="#s:430"><span class="id" title="binder">s</span></a> <a id="l:431" class="idref" href="#l:431"><span class="id" title="binder">l</span></a>, <a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <a class="idref" href="#s:430"><span class="id" title="variable">s</span></a> <a class="idref" href="#s:430"><span class="id" title="variable">s</span></a> (<a class="idref" href="#OpNearRevertTo"><span class="id" title="constructor">OpNearRevertTo</span></a> <a class="idref" href="#l:431"><span class="id" title="variable">l</span></a>) (<a class="idref" href="#OpNearRevertTo"><span class="id" title="constructor">OpNearRevertTo</span></a> <a class="idref" href="#l:431"><span class="id" title="variable">l</span></a>)<br/>
&nbsp;&nbsp;|<a id="sim_nearpanicto" class="idref" href="#sim_nearpanicto"><span class="id" title="constructor">sim_nearpanicto</span></a>: <span class="id" title="keyword">∀</span> <a id="s:432" class="idref" href="#s:432"><span class="id" title="binder">s</span></a> <a id="l:433" class="idref" href="#l:433"><span class="id" title="binder">l</span></a>, <a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <a class="idref" href="#s:432"><span class="id" title="variable">s</span></a> <a class="idref" href="#s:432"><span class="id" title="variable">s</span></a> (<a class="idref" href="#OpNearPanicTo"><span class="id" title="constructor">OpNearPanicTo</span></a> <a class="idref" href="#l:433"><span class="id" title="variable">l</span></a>) (<a class="idref" href="#OpNearPanicTo"><span class="id" title="constructor">OpNearPanicTo</span></a> <a class="idref" href="#l:433"><span class="id" title="variable">l</span></a>)<br/>
&nbsp;&nbsp;|<a id="sim_ret" class="idref" href="#sim_ret"><span class="id" title="constructor">sim_ret</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_ret_params"><span class="id" title="variable">mf_src_ret_params</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> (<a class="idref" href="#OpRet"><span class="id" title="constructor">OpRet</span></a> <span class="id" title="var">i1</span>) (<a class="idref" href="#OpRet"><span class="id" title="constructor">OpRet</span></a> <span class="id" title="var">i1'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_revert" class="idref" href="#sim_revert"><span class="id" title="constructor">sim_revert</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_ret_params"><span class="id" title="variable">mf_src_ret_params</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> (<a class="idref" href="#OpRevert"><span class="id" title="constructor">OpRevert</span></a> <span class="id" title="var">i1</span>) (<a class="idref" href="#OpRevert"><span class="id" title="constructor">OpRevert</span></a> <span class="id" title="var">i1'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_load" class="idref" href="#sim_load"><span class="id" title="constructor">sim_load</span></a>:`( <span class="id" title="keyword">∀</span> <a id="type:442" class="idref" href="#type:442"><span class="id" title="binder">type</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_heap_ptr"><span class="id" title="variable">mf_src_heap_ptr</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s2</span> (<a class="idref" href="#OpLoad"><span class="id" title="constructor">OpLoad</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">o1</span> <a class="idref" href="#type:442"><span class="id" title="variable">type</span></a>) (<a class="idref" href="#OpLoad"><span class="id" title="constructor">OpLoad</span></a>  <span class="id" title="var">i1'</span> <span class="id" title="var">o1'</span> <a class="idref" href="#type:442"><span class="id" title="variable">type</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_loadptr" class="idref" href="#sim_loadptr"><span class="id" title="constructor">sim_loadptr</span></a>:`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_fat_ptr"><span class="id" title="variable">mf_src_fat_ptr</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s2</span> (<a class="idref" href="#OpLoadPointer"><span class="id" title="constructor">OpLoadPointer</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">o1</span>) (<a class="idref" href="#OpLoadPointer"><span class="id" title="constructor">OpLoadPointer</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">o1'</span> )<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_loadinc" class="idref" href="#sim_loadinc"><span class="id" title="constructor">sim_loadinc</span></a>:`( <span class="id" title="keyword">∀</span> <a id="type:457" class="idref" href="#type:457"><span class="id" title="binder">type</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_heap_ptr"><span class="id" title="variable">mf_src_heap_ptr</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_heap_ptr"><span class="id" title="variable">mf_dest_heap_ptr</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o2</span> <span class="id" title="var">o2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s3</span> (<a class="idref" href="#OpLoadInc"><span class="id" title="constructor">OpLoadInc</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">o1</span> <a class="idref" href="#type:457"><span class="id" title="variable">type</span></a> <span class="id" title="var">o2</span>) (<a class="idref" href="#OpLoadInc"><span class="id" title="constructor">OpLoadInc</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">o1'</span> <a class="idref" href="#type:457"><span class="id" title="variable">type</span></a> <span class="id" title="var">o2'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_loadptrinc" class="idref" href="#sim_loadptrinc"><span class="id" title="constructor">sim_loadptrinc</span></a>:`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_fat_ptr"><span class="id" title="variable">mf_src_fat_ptr</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_fat_ptr"><span class="id" title="variable">mf_dest_fat_ptr</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o2</span> <span class="id" title="var">o2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s3</span> (<a class="idref" href="#OpLoadPointerInc"><span class="id" title="constructor">OpLoadPointerInc</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">o1</span> <span class="id" title="var">o2</span>) (<a class="idref" href="#OpLoadPointerInc"><span class="id" title="constructor">OpLoadPointerInc</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">o1'</span> <span class="id" title="var">o2'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_store" class="idref" href="#sim_store"><span class="id" title="constructor">sim_store</span></a>:`( <span class="id" title="keyword">∀</span> <a id="type:478" class="idref" href="#type:478"><span class="id" title="binder">type</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_heap_ptr"><span class="id" title="variable">mf_src_heap_ptr</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s3</span> (<a class="idref" href="#OpStore"><span class="id" title="constructor">OpStore</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <a class="idref" href="#type:478"><span class="id" title="variable">type</span></a>) (<a class="idref" href="#OpStore"><span class="id" title="constructor">OpStore</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <a class="idref" href="#type:478"><span class="id" title="variable">type</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_storeinc" class="idref" href="#sim_storeinc"><span class="id" title="constructor">sim_storeinc</span></a>:`( <span class="id" title="keyword">∀</span> <a id="type:489" class="idref" href="#type:489"><span class="id" title="binder">type</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_heap_ptr"><span class="id" title="variable">mf_src_heap_ptr</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_heap_ptr"><span class="id" title="variable">mf_dest_heap_ptr</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s3</span> (<a class="idref" href="#OpStoreInc"><span class="id" title="constructor">OpStoreInc</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <a class="idref" href="#type:489"><span class="id" title="variable">type</span></a> <span class="id" title="var">o1</span>) (<a class="idref" href="#OpStoreInc"><span class="id" title="constructor">OpStoreInc</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <a class="idref" href="#type:489"><span class="id" title="variable">type</span></a> <span class="id" title="var">o1'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_OpContextThis" class="idref" href="#sim_OpContextThis"><span class="id" title="constructor">sim_OpContextThis</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> (<a class="idref" href="#OpContractThis"><span class="id" title="constructor">OpContractThis</span></a> <span class="id" title="var">o1</span>) (<a class="idref" href="#OpContractThis"><span class="id" title="constructor">OpContractThis</span></a> <span class="id" title="var">o1'</span>))<br/>
&nbsp;&nbsp;|<a id="sim_OpContractCaller" class="idref" href="#sim_OpContractCaller"><span class="id" title="constructor">sim_OpContractCaller</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> (<a class="idref" href="#OpContractCaller"><span class="id" title="constructor">OpContractCaller</span></a> <span class="id" title="var">o1</span>) (<a class="idref" href="#OpContractCaller"><span class="id" title="constructor">OpContractCaller</span></a> <span class="id" title="var">o1'</span>))<br/>
&nbsp;&nbsp;|<a id="sim_OpContractCodeAddress" class="idref" href="#sim_OpContractCodeAddress"><span class="id" title="constructor">sim_OpContractCodeAddress</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> (<a class="idref" href="#OpContractCodeAddress"><span class="id" title="constructor">OpContractCodeAddress</span></a> <span class="id" title="var">o1</span>) (<a class="idref" href="#OpContractCodeAddress"><span class="id" title="constructor">OpContractCodeAddress</span></a> <span class="id" title="var">o1'</span>))<br/>
&nbsp;&nbsp;|<a id="sim_OpContextMeta" class="idref" href="#sim_OpContextMeta"><span class="id" title="constructor">sim_OpContextMeta</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_meta_params"><span class="id" title="variable">mf_dest_meta_params</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> (<a class="idref" href="#OpVMMeta"><span class="id" title="constructor">OpVMMeta</span></a> <span class="id" title="var">o1</span>) (<a class="idref" href="#OpVMMeta"><span class="id" title="constructor">OpVMMeta</span></a> <span class="id" title="var">o1'</span>))<br/>
&nbsp;&nbsp;|<a id="sim_OpVMErgsLeft" class="idref" href="#sim_OpVMErgsLeft"><span class="id" title="constructor">sim_OpVMErgsLeft</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> (<a class="idref" href="#OpVMErgsLeft"><span class="id" title="constructor">OpVMErgsLeft</span></a> <span class="id" title="var">o1</span>) (<a class="idref" href="#OpVMErgsLeft"><span class="id" title="constructor">OpVMErgsLeft</span></a> <span class="id" title="var">o1'</span>))<br/>
&nbsp;&nbsp;|<a id="sim_OpVMSp" class="idref" href="#sim_OpVMSp"><span class="id" title="constructor">sim_OpVMSp</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> (<a class="idref" href="#OpVMSP"><span class="id" title="constructor">OpVMSP</span></a> <span class="id" title="var">o1</span>) (<a class="idref" href="#OpVMSP"><span class="id" title="constructor">OpVMSP</span></a> <span class="id" title="var">o1'</span>))<br/>
&nbsp;&nbsp;|<a id="sim_OpVMGetVMU128" class="idref" href="#sim_OpVMGetVMU128"><span class="id" title="constructor">sim_OpVMGetVMU128</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> (<a class="idref" href="#OpGetCapturedContext"><span class="id" title="constructor">OpGetCapturedContext</span></a> <span class="id" title="var">o1</span>) (<a class="idref" href="#OpGetCapturedContext"><span class="id" title="constructor">OpGetCapturedContext</span></a> <span class="id" title="var">o1'</span>))<br/>
&nbsp;&nbsp;|<a id="sim_OpContextSetContextU128" class="idref" href="#sim_OpContextSetContextU128"><span class="id" title="constructor">sim_OpContextSetContextU128</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> (<a class="idref" href="#OpSetContextReg"><span class="id" title="constructor">OpSetContextReg</span></a> <span class="id" title="var">i1</span>) (<a class="idref" href="#OpSetContextReg"><span class="id" title="constructor">OpSetContextReg</span></a> <span class="id" title="var">i1'</span>))<br/>
&nbsp;&nbsp;|<a id="sim_OpContextIncrementTxNumber" class="idref" href="#sim_OpContextIncrementTxNumber"><span class="id" title="constructor">sim_OpContextIncrementTxNumber</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> (<a class="idref" href="#OpIncrementTxNumber"><span class="id" title="constructor">OpIncrementTxNumber</span></a> ) (<a class="idref" href="#OpIncrementTxNumber"><span class="id" title="constructor">OpIncrementTxNumber</span></a> ))<br/>
&nbsp;&nbsp;|<a id="sim_OpSLoad" class="idref" href="#sim_OpSLoad"><span class="id" title="constructor">sim_OpSLoad</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s2</span> (<a class="idref" href="#OpSLoad"><span class="id" title="constructor">OpSLoad</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">o1</span>) (<a class="idref" href="#OpSLoad"><span class="id" title="constructor">OpSLoad</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">o1'</span>))<br/>
&nbsp;&nbsp;|<a id="sim_OpSStore" class="idref" href="#sim_OpSStore"><span class="id" title="constructor">sim_OpSStore</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s2</span> (<a class="idref" href="#OpSStore"><span class="id" title="constructor">OpSStore</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span>) (<a class="idref" href="#OpSStore"><span class="id" title="constructor">OpSStore</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span>))<br/>
&nbsp;&nbsp;|<a id="sim_OpToL1Message" class="idref" href="#sim_OpToL1Message"><span class="id" title="constructor">sim_OpToL1Message</span></a>: `(<span class="id" title="keyword">∀</span> <a id="first:550" class="idref" href="#first:550"><span class="id" title="binder">first</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s2</span> (<a class="idref" href="#OpToL1Message"><span class="id" title="constructor">OpToL1Message</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <a class="idref" href="#first:550"><span class="id" title="variable">first</span></a>) (<a class="idref" href="#OpToL1Message"><span class="id" title="constructor">OpToL1Message</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <a class="idref" href="#first:550"><span class="id" title="variable">first</span></a>))<br/>
&nbsp;&nbsp;|<a id="sim_OpEvent" class="idref" href="#sim_OpEvent"><span class="id" title="constructor">sim_OpEvent</span></a>: `(<span class="id" title="keyword">∀</span> <a id="first:558" class="idref" href="#first:558"><span class="id" title="binder">first</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s2</span> (<a class="idref" href="#OpEvent"><span class="id" title="constructor">OpEvent</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <a class="idref" href="#first:558"><span class="id" title="variable">first</span></a>) (<a class="idref" href="#OpEvent"><span class="id" title="constructor">OpEvent</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <a class="idref" href="#first:558"><span class="id" title="variable">first</span></a>))<br/>
&nbsp;&nbsp;|<a id="sim_OpPrecompileCall" class="idref" href="#sim_OpPrecompileCall"><span class="id" title="constructor">sim_OpPrecompileCall</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_precompile_params"><span class="id" title="variable">mf_src_precompile_params</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s3</span> (<a class="idref" href="#OpPrecompileCall"><span class="id" title="constructor">OpPrecompileCall</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">o1</span>) (<a class="idref" href="#OpPrecompileCall"><span class="id" title="constructor">OpPrecompileCall</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <span class="id" title="var">o1'</span>))<br/>
&nbsp;&nbsp;|<a id="sim_OpDecommit" class="idref" href="#sim_OpDecommit"><span class="id" title="constructor">sim_OpDecommit</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s3</span> (<a class="idref" href="#OpDecommit"><span class="id" title="constructor">OpDecommit</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">o1</span>) (<a class="idref" href="#OpDecommit"><span class="id" title="constructor">OpDecommit</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <span class="id" title="var">o1'</span>))<br/>
&nbsp;&nbsp;|<a id="sim_OpTransientLoad" class="idref" href="#sim_OpTransientLoad"><span class="id" title="constructor">sim_OpTransientLoad</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s2</span> (<a class="idref" href="#OpTransientLoad"><span class="id" title="constructor">OpTransientLoad</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">o1</span>) (<a class="idref" href="#OpTransientLoad"><span class="id" title="constructor">OpTransientLoad</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">o1'</span>))<br/>
&nbsp;&nbsp;|<a id="sim_OpTransientStore" class="idref" href="#sim_OpTransientStore"><span class="id" title="constructor">sim_OpTransientStore</span></a>: `(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s2</span> (<a class="idref" href="#OpTransientStore"><span class="id" title="constructor">OpTransientStore</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span>) (<a class="idref" href="#OpTransientStore"><span class="id" title="constructor">OpTransientStore</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span>))<br/>
<br/>
&nbsp;&nbsp;|<a id="sim_static_store" class="idref" href="#sim_static_store"><span class="id" title="constructor">sim_static_store</span></a>:`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_heap_ptr"><span class="id" title="variable">mf_src_heap_ptr</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s3</span> (<a class="idref" href="#OpStaticWrite"><span class="id" title="constructor">OpStaticWrite</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> ) (<a class="idref" href="#OpStaticWrite"><span class="id" title="constructor">OpStaticWrite</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_static_store_inc" class="idref" href="#sim_static_store_inc"><span class="id" title="constructor">sim_static_store_inc</span></a>:`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_heap_ptr"><span class="id" title="variable">mf_src_heap_ptr</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_pv"><span class="id" title="variable">mf_src_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">i2</span> <span class="id" title="var">i2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_heap_ptr"><span class="id" title="variable">mf_dest_heap_ptr</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s3</span> (<a class="idref" href="#OpStaticWriteInc"><span class="id" title="constructor">OpStaticWriteInc</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">o1</span>) (<a class="idref" href="#OpStaticWriteInc"><span class="id" title="constructor">OpStaticWriteInc</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">i2'</span> <span class="id" title="var">o1'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
<br/>
&nbsp;&nbsp;|<a id="sim_static_load" class="idref" href="#sim_static_load"><span class="id" title="constructor">sim_static_load</span></a>:`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_heap_ptr"><span class="id" title="variable">mf_src_heap_ptr</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s2</span> (<a class="idref" href="#OpStaticRead"><span class="id" title="constructor">OpStaticRead</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">o1</span>) (<a class="idref" href="#OpStaticRead"><span class="id" title="constructor">OpStaticRead</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">o1'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;|<a id="sim_static_load_inc" class="idref" href="#sim_static_load_inc"><span class="id" title="constructor">sim_static_load_inc</span></a>:`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_src_heap_ptr"><span class="id" title="variable">mf_src_heap_ptr</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_pv"><span class="id" title="variable">mf_dest_pv</span></a> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">o1</span> <span class="id" title="var">o1'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#InstructionMapper.mf_dest_heap_ptr"><span class="id" title="variable">mf_dest_heap_ptr</span></a> <span class="id" title="var">s2</span> <span class="id" title="var">s3</span> <span class="id" title="var">o2</span> <span class="id" title="var">o2'</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins_srelate:204"><span class="id" title="inductive">ins_srelate</span></a> <span class="id" title="var">s0</span> <span class="id" title="var">s3</span> (<a class="idref" href="#OpStaticReadInc"><span class="id" title="constructor">OpStaticReadInc</span></a> <span class="id" title="var">i1</span> <span class="id" title="var">o1</span> <span class="id" title="var">o2</span>) (<a class="idref" href="#OpStaticReadInc"><span class="id" title="constructor">OpStaticReadInc</span></a> <span class="id" title="var">i1'</span> <span class="id" title="var">o1'</span> <span class="id" title="var">o2'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable No Variables</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#InstructionMapper"><span class="id" title="section">InstructionMapper</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.isa.GeneratedMachISA</h1>

<div class="code">
<span class="comment">(*&nbsp;GENERATED&nbsp;FILE,&nbsp;DO&nbsp;NOT&nbsp;EDIT&nbsp;MANUALLY.&nbsp;*)</span><br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">isa.Modifiers</span></a> <a class="idref" href="#"><span class="id" title="library">isa.Assembly</span></a> <a class="idref" href="#"><span class="id" title="library">Predication</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Types</span></a> <a class="idref" href="#"><span class="id" title="module">Modifiers</span></a> <a class="idref" href="#"><span class="id" title="module">Predication</span></a>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <a id="src_mode" class="idref" href="#src_mode"><span class="id" title="inductive">src_mode</span></a> :=<br/>
| <a id="SrcReg" class="idref" href="#SrcReg"><span class="id" title="constructor">SrcReg</span></a><br/>
| <a id="SrcSpRelativePop" class="idref" href="#SrcSpRelativePop"><span class="id" title="constructor">SrcSpRelativePop</span></a><br/>
| <a id="SrcSpRelative" class="idref" href="#SrcSpRelative"><span class="id" title="constructor">SrcSpRelative</span></a><br/>
| <a id="SrcStackAbsolute" class="idref" href="#SrcStackAbsolute"><span class="id" title="constructor">SrcStackAbsolute</span></a><br/>
| <a id="SrcImm" class="idref" href="#SrcImm"><span class="id" title="constructor">SrcImm</span></a><br/>
| <a id="SrcCodeAddr" class="idref" href="#SrcCodeAddr"><span class="id" title="constructor">SrcCodeAddr</span></a><br/>
.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <a id="src_special_mode" class="idref" href="#src_special_mode"><span class="id" title="inductive">src_special_mode</span></a> := | <a id="SrcSpecialReg" class="idref" href="#SrcSpecialReg"><span class="id" title="constructor">SrcSpecialReg</span></a> | <a id="SrcSpecialImm" class="idref" href="#SrcSpecialImm"><span class="id" title="constructor">SrcSpecialImm</span></a>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <a id="dst_mode" class="idref" href="#dst_mode"><span class="id" title="inductive">dst_mode</span></a> :=<br/>
| <a id="DstReg" class="idref" href="#DstReg"><span class="id" title="constructor">DstReg</span></a><br/>
| <a id="DstSpRelativePush" class="idref" href="#DstSpRelativePush"><span class="id" title="constructor">DstSpRelativePush</span></a><br/>
| <a id="DstSpRelative" class="idref" href="#DstSpRelative"><span class="id" title="constructor">DstSpRelative</span></a><br/>
| <a id="DstStackAbsolute" class="idref" href="#DstStackAbsolute"><span class="id" title="constructor">DstStackAbsolute</span></a><br/>
.<br/>
<span class="id" title="keyword">Inductive</span> <a id="mod_context" class="idref" href="#mod_context"><span class="id" title="inductive">mod_context</span></a>: <span class="id" title="keyword">Set</span> := <br/>
&nbsp;&nbsp;| <a id="This" class="idref" href="#This"><span class="id" title="constructor">This</span></a><br/>
&nbsp;&nbsp;| <a id="Caller" class="idref" href="#Caller"><span class="id" title="constructor">Caller</span></a><br/>
&nbsp;&nbsp;| <a id="CodeAddress" class="idref" href="#CodeAddress"><span class="id" title="constructor">CodeAddress</span></a><br/>
&nbsp;&nbsp;| <a id="Meta" class="idref" href="#Meta"><span class="id" title="constructor">Meta</span></a><br/>
&nbsp;&nbsp;| <a id="ErgsLeft" class="idref" href="#ErgsLeft"><span class="id" title="constructor">ErgsLeft</span></a><br/>
&nbsp;&nbsp;| <a id="Sp" class="idref" href="#Sp"><span class="id" title="constructor">Sp</span></a><br/>
&nbsp;&nbsp;| <a id="GetContextU128" class="idref" href="#GetContextU128"><span class="id" title="constructor">GetContextU128</span></a><br/>
&nbsp;&nbsp;| <a id="SetContextU128" class="idref" href="#SetContextU128"><span class="id" title="constructor">SetContextU128</span></a><br/>
&nbsp;&nbsp;| <a id="PubdataSpent" class="idref" href="#PubdataSpent"><span class="id" title="constructor">PubdataSpent</span></a><br/>
&nbsp;&nbsp;| <a id="IncrementTx" class="idref" href="#IncrementTx"><span class="id" title="constructor">IncrementTx</span></a><br/>
<br/>
.<br/>
<span class="id" title="keyword">Inductive</span> <a id="mach_opcode" class="idref" href="#mach_opcode"><span class="id" title="inductive">mach_opcode</span></a> : <span class="id" title="keyword">Type</span> := <br/>
| <a id="OpLoadPtr" class="idref" href="#OpLoadPtr"><span class="id" title="constructor">OpLoadPtr</span></a>  (<a id="inc:11" class="idref" href="#inc:11"><span class="id" title="binder">inc</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
| <a id="OpJump" class="idref" href="#OpJump"><span class="id" title="constructor">OpJump</span></a>  (<a id="src0_mode:12" class="idref" href="#src0_mode:12"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_mode"><span class="id" title="inductive">src_mode</span></a>)<br/>
| <a id="OpMimicCall" class="idref" href="#OpMimicCall"><span class="id" title="constructor">OpMimicCall</span></a>  (<a id="is_shard:13" class="idref" href="#is_shard:13"><span class="id" title="binder">is_shard</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>) (<a id="is_static:14" class="idref" href="#is_static:14"><span class="id" title="binder">is_static</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
| <a id="OpVMMeta" class="idref" href="#OpVMMeta"><span class="id" title="constructor">OpVMMeta</span></a> <br/>
| <a id="OpDiv" class="idref" href="#OpDiv"><span class="id" title="constructor">OpDiv</span></a>  (<a id="src0_mode:15" class="idref" href="#src0_mode:15"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_mode"><span class="id" title="inductive">src_mode</span></a>) (<a id="dst0_mode:16" class="idref" href="#dst0_mode:16"><span class="id" title="binder">dst0_mode</span></a>: <a class="idref" href="#dst_mode"><span class="id" title="inductive">dst_mode</span></a>) (<a id="swap:17" class="idref" href="#swap:17"><span class="id" title="binder">swap</span></a>: <a class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a>) (<a id="set_flags:18" class="idref" href="#set_flags:18"><span class="id" title="binder">set_flags</span></a>: <a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
| <a id="OpSLoad" class="idref" href="#OpSLoad"><span class="id" title="constructor">OpSLoad</span></a> <br/>
| <a id="OpAnd" class="idref" href="#OpAnd"><span class="id" title="constructor">OpAnd</span></a>  (<a id="src0_mode:19" class="idref" href="#src0_mode:19"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_mode"><span class="id" title="inductive">src_mode</span></a>) (<a id="dst0_mode:20" class="idref" href="#dst0_mode:20"><span class="id" title="binder">dst0_mode</span></a>: <a class="idref" href="#dst_mode"><span class="id" title="inductive">dst_mode</span></a>) (<a id="set_flags:21" class="idref" href="#set_flags:21"><span class="id" title="binder">set_flags</span></a>: <a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
| <a id="OpContractThis" class="idref" href="#OpContractThis"><span class="id" title="constructor">OpContractThis</span></a> <br/>
| <a id="OpInvalid" class="idref" href="#OpInvalid"><span class="id" title="constructor">OpInvalid</span></a> <br/>
| <a id="OpSub" class="idref" href="#OpSub"><span class="id" title="constructor">OpSub</span></a>  (<a id="src0_mode:22" class="idref" href="#src0_mode:22"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_mode"><span class="id" title="inductive">src_mode</span></a>) (<a id="dst0_mode:23" class="idref" href="#dst0_mode:23"><span class="id" title="binder">dst0_mode</span></a>: <a class="idref" href="#dst_mode"><span class="id" title="inductive">dst_mode</span></a>) (<a id="swap:24" class="idref" href="#swap:24"><span class="id" title="binder">swap</span></a>: <a class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a>) (<a id="set_flags:25" class="idref" href="#set_flags:25"><span class="id" title="binder">set_flags</span></a>: <a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
| <a id="OpNoOp" class="idref" href="#OpNoOp"><span class="id" title="constructor">OpNoOp</span></a>  (<a id="src0_mode:26" class="idref" href="#src0_mode:26"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_mode"><span class="id" title="inductive">src_mode</span></a>) (<a id="dst0_mode:27" class="idref" href="#dst0_mode:27"><span class="id" title="binder">dst0_mode</span></a>: <a class="idref" href="#dst_mode"><span class="id" title="inductive">dst_mode</span></a>)<br/>
| <a id="OpIncrementTxNumber" class="idref" href="#OpIncrementTxNumber"><span class="id" title="constructor">OpIncrementTxNumber</span></a> <br/>
| <a id="OpRol" class="idref" href="#OpRol"><span class="id" title="constructor">OpRol</span></a>  (<a id="src0_mode:28" class="idref" href="#src0_mode:28"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_mode"><span class="id" title="inductive">src_mode</span></a>) (<a id="dst0_mode:29" class="idref" href="#dst0_mode:29"><span class="id" title="binder">dst0_mode</span></a>: <a class="idref" href="#dst_mode"><span class="id" title="inductive">dst_mode</span></a>) (<a id="swap:30" class="idref" href="#swap:30"><span class="id" title="binder">swap</span></a>: <a class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a>) (<a id="set_flags:31" class="idref" href="#set_flags:31"><span class="id" title="binder">set_flags</span></a>: <a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
| <a id="OpMul" class="idref" href="#OpMul"><span class="id" title="constructor">OpMul</span></a>  (<a id="src0_mode:32" class="idref" href="#src0_mode:32"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_mode"><span class="id" title="inductive">src_mode</span></a>) (<a id="dst0_mode:33" class="idref" href="#dst0_mode:33"><span class="id" title="binder">dst0_mode</span></a>: <a class="idref" href="#dst_mode"><span class="id" title="inductive">dst_mode</span></a>) (<a id="set_flags:34" class="idref" href="#set_flags:34"><span class="id" title="binder">set_flags</span></a>: <a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
| <a id="OpSetContextReg" class="idref" href="#OpSetContextReg"><span class="id" title="constructor">OpSetContextReg</span></a> <br/>
| <a id="OpDelegateCall" class="idref" href="#OpDelegateCall"><span class="id" title="constructor">OpDelegateCall</span></a>  (<a id="is_shard:35" class="idref" href="#is_shard:35"><span class="id" title="binder">is_shard</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>) (<a id="is_static:36" class="idref" href="#is_static:36"><span class="id" title="binder">is_static</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
| <a id="OpRet" class="idref" href="#OpRet"><span class="id" title="constructor">OpRet</span></a>  (<a id="to_label:37" class="idref" href="#to_label:37"><span class="id" title="binder">to_label</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
| <a id="OpEvent" class="idref" href="#OpEvent"><span class="id" title="constructor">OpEvent</span></a>  (<a id="is_first:38" class="idref" href="#is_first:38"><span class="id" title="binder">is_first</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
| <a id="OpPrecompileCall" class="idref" href="#OpPrecompileCall"><span class="id" title="constructor">OpPrecompileCall</span></a> <br/>
| <a id="OpStoreHeap" class="idref" href="#OpStoreHeap"><span class="id" title="constructor">OpStoreHeap</span></a>  (<a id="src0_mode:39" class="idref" href="#src0_mode:39"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_special_mode"><span class="id" title="inductive">src_special_mode</span></a>) (<a id="inc:40" class="idref" href="#inc:40"><span class="id" title="binder">inc</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
| <a id="OpShr" class="idref" href="#OpShr"><span class="id" title="constructor">OpShr</span></a>  (<a id="src0_mode:41" class="idref" href="#src0_mode:41"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_mode"><span class="id" title="inductive">src_mode</span></a>) (<a id="dst0_mode:42" class="idref" href="#dst0_mode:42"><span class="id" title="binder">dst0_mode</span></a>: <a class="idref" href="#dst_mode"><span class="id" title="inductive">dst_mode</span></a>) (<a id="swap:43" class="idref" href="#swap:43"><span class="id" title="binder">swap</span></a>: <a class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a>) (<a id="set_flags:44" class="idref" href="#set_flags:44"><span class="id" title="binder">set_flags</span></a>: <a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
| <a id="OpPanic" class="idref" href="#OpPanic"><span class="id" title="constructor">OpPanic</span></a>  (<a id="to_label:45" class="idref" href="#to_label:45"><span class="id" title="binder">to_label</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
| <a id="OpContractCodeAddress" class="idref" href="#OpContractCodeAddress"><span class="id" title="constructor">OpContractCodeAddress</span></a> <br/>
| <a id="OpSStore" class="idref" href="#OpSStore"><span class="id" title="constructor">OpSStore</span></a> <br/>
| <a id="OpPtrSub" class="idref" href="#OpPtrSub"><span class="id" title="constructor">OpPtrSub</span></a>  (<a id="src0_mode:46" class="idref" href="#src0_mode:46"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_mode"><span class="id" title="inductive">src_mode</span></a>) (<a id="dst0_mode:47" class="idref" href="#dst0_mode:47"><span class="id" title="binder">dst0_mode</span></a>: <a class="idref" href="#dst_mode"><span class="id" title="inductive">dst_mode</span></a>) (<a id="swap:48" class="idref" href="#swap:48"><span class="id" title="binder">swap</span></a>: <a class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a>)<br/>
| <a id="OpToL1Message" class="idref" href="#OpToL1Message"><span class="id" title="constructor">OpToL1Message</span></a>  (<a id="is_first:49" class="idref" href="#is_first:49"><span class="id" title="binder">is_first</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
| <a id="OpAuxMutating" class="idref" href="#OpAuxMutating"><span class="id" title="constructor">OpAuxMutating</span></a> <br/>
| <a id="OpPtrAdd" class="idref" href="#OpPtrAdd"><span class="id" title="constructor">OpPtrAdd</span></a>  (<a id="src0_mode:50" class="idref" href="#src0_mode:50"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_mode"><span class="id" title="inductive">src_mode</span></a>) (<a id="dst0_mode:51" class="idref" href="#dst0_mode:51"><span class="id" title="binder">dst0_mode</span></a>: <a class="idref" href="#dst_mode"><span class="id" title="inductive">dst_mode</span></a>) (<a id="swap:52" class="idref" href="#swap:52"><span class="id" title="binder">swap</span></a>: <a class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a>)<br/>
| <a id="OpNearCall" class="idref" href="#OpNearCall"><span class="id" title="constructor">OpNearCall</span></a> <br/>
| <a id="OpLoadHeap" class="idref" href="#OpLoadHeap"><span class="id" title="constructor">OpLoadHeap</span></a>  (<a id="src0_mode:53" class="idref" href="#src0_mode:53"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_special_mode"><span class="id" title="inductive">src_special_mode</span></a>) (<a id="inc:54" class="idref" href="#inc:54"><span class="id" title="binder">inc</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
| <a id="OpStoreAuxHeap" class="idref" href="#OpStoreAuxHeap"><span class="id" title="constructor">OpStoreAuxHeap</span></a>  (<a id="src0_mode:55" class="idref" href="#src0_mode:55"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_special_mode"><span class="id" title="inductive">src_special_mode</span></a>) (<a id="inc:56" class="idref" href="#inc:56"><span class="id" title="binder">inc</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
| <a id="OpXor" class="idref" href="#OpXor"><span class="id" title="constructor">OpXor</span></a>  (<a id="src0_mode:57" class="idref" href="#src0_mode:57"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_mode"><span class="id" title="inductive">src_mode</span></a>) (<a id="dst0_mode:58" class="idref" href="#dst0_mode:58"><span class="id" title="binder">dst0_mode</span></a>: <a class="idref" href="#dst_mode"><span class="id" title="inductive">dst_mode</span></a>) (<a id="set_flags:59" class="idref" href="#set_flags:59"><span class="id" title="binder">set_flags</span></a>: <a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
| <a id="OpStaticRead" class="idref" href="#OpStaticRead"><span class="id" title="constructor">OpStaticRead</span></a>  (<a id="src0_mode:60" class="idref" href="#src0_mode:60"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_special_mode"><span class="id" title="inductive">src_special_mode</span></a>) (<a id="inc:61" class="idref" href="#inc:61"><span class="id" title="binder">inc</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
| <a id="OpFarCall" class="idref" href="#OpFarCall"><span class="id" title="constructor">OpFarCall</span></a>  (<a id="is_shard:62" class="idref" href="#is_shard:62"><span class="id" title="binder">is_shard</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>) (<a id="is_static:63" class="idref" href="#is_static:63"><span class="id" title="binder">is_static</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
| <a id="OpGetCapturedContext" class="idref" href="#OpGetCapturedContext"><span class="id" title="constructor">OpGetCapturedContext</span></a> <br/>
| <a id="OpOr" class="idref" href="#OpOr"><span class="id" title="constructor">OpOr</span></a>  (<a id="src0_mode:64" class="idref" href="#src0_mode:64"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_mode"><span class="id" title="inductive">src_mode</span></a>) (<a id="dst0_mode:65" class="idref" href="#dst0_mode:65"><span class="id" title="binder">dst0_mode</span></a>: <a class="idref" href="#dst_mode"><span class="id" title="inductive">dst_mode</span></a>) (<a id="set_flags:66" class="idref" href="#set_flags:66"><span class="id" title="binder">set_flags</span></a>: <a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
| <a id="OpPtrPack" class="idref" href="#OpPtrPack"><span class="id" title="constructor">OpPtrPack</span></a>  (<a id="src0_mode:67" class="idref" href="#src0_mode:67"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_mode"><span class="id" title="inductive">src_mode</span></a>) (<a id="dst0_mode:68" class="idref" href="#dst0_mode:68"><span class="id" title="binder">dst0_mode</span></a>: <a class="idref" href="#dst_mode"><span class="id" title="inductive">dst_mode</span></a>) (<a id="swap:69" class="idref" href="#swap:69"><span class="id" title="binder">swap</span></a>: <a class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a>)<br/>
| <a id="OpVMErgsLeft" class="idref" href="#OpVMErgsLeft"><span class="id" title="constructor">OpVMErgsLeft</span></a> <br/>
| <a id="OpVMSp" class="idref" href="#OpVMSp"><span class="id" title="constructor">OpVMSp</span></a> <br/>
| <a id="OpLoadAuxHeap" class="idref" href="#OpLoadAuxHeap"><span class="id" title="constructor">OpLoadAuxHeap</span></a>  (<a id="src0_mode:70" class="idref" href="#src0_mode:70"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_special_mode"><span class="id" title="inductive">src_special_mode</span></a>) (<a id="inc:71" class="idref" href="#inc:71"><span class="id" title="binder">inc</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
| <a id="OpTransientStore" class="idref" href="#OpTransientStore"><span class="id" title="constructor">OpTransientStore</span></a> <br/>
| <a id="OpDecommit" class="idref" href="#OpDecommit"><span class="id" title="constructor">OpDecommit</span></a> <br/>
| <a id="OpPtrShrink" class="idref" href="#OpPtrShrink"><span class="id" title="constructor">OpPtrShrink</span></a>  (<a id="src0_mode:72" class="idref" href="#src0_mode:72"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_mode"><span class="id" title="inductive">src_mode</span></a>) (<a id="dst0_mode:73" class="idref" href="#dst0_mode:73"><span class="id" title="binder">dst0_mode</span></a>: <a class="idref" href="#dst_mode"><span class="id" title="inductive">dst_mode</span></a>) (<a id="swap:74" class="idref" href="#swap:74"><span class="id" title="binder">swap</span></a>: <a class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a>)<br/>
| <a id="OpRevert" class="idref" href="#OpRevert"><span class="id" title="constructor">OpRevert</span></a>  (<a id="to_label:75" class="idref" href="#to_label:75"><span class="id" title="binder">to_label</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
| <a id="OpStaticWrite" class="idref" href="#OpStaticWrite"><span class="id" title="constructor">OpStaticWrite</span></a>  (<a id="src0_mode:76" class="idref" href="#src0_mode:76"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_special_mode"><span class="id" title="inductive">src_special_mode</span></a>) (<a id="inc:77" class="idref" href="#inc:77"><span class="id" title="binder">inc</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
| <a id="OpTransientLoad" class="idref" href="#OpTransientLoad"><span class="id" title="constructor">OpTransientLoad</span></a> <br/>
| <a id="OpShl" class="idref" href="#OpShl"><span class="id" title="constructor">OpShl</span></a>  (<a id="src0_mode:78" class="idref" href="#src0_mode:78"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_mode"><span class="id" title="inductive">src_mode</span></a>) (<a id="dst0_mode:79" class="idref" href="#dst0_mode:79"><span class="id" title="binder">dst0_mode</span></a>: <a class="idref" href="#dst_mode"><span class="id" title="inductive">dst_mode</span></a>) (<a id="swap:80" class="idref" href="#swap:80"><span class="id" title="binder">swap</span></a>: <a class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a>) (<a id="set_flags:81" class="idref" href="#set_flags:81"><span class="id" title="binder">set_flags</span></a>: <a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
| <a id="OpRor" class="idref" href="#OpRor"><span class="id" title="constructor">OpRor</span></a>  (<a id="src0_mode:82" class="idref" href="#src0_mode:82"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_mode"><span class="id" title="inductive">src_mode</span></a>) (<a id="dst0_mode:83" class="idref" href="#dst0_mode:83"><span class="id" title="binder">dst0_mode</span></a>: <a class="idref" href="#dst_mode"><span class="id" title="inductive">dst_mode</span></a>) (<a id="swap:84" class="idref" href="#swap:84"><span class="id" title="binder">swap</span></a>: <a class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a>) (<a id="set_flags:85" class="idref" href="#set_flags:85"><span class="id" title="binder">set_flags</span></a>: <a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
| <a id="OpContractCaller" class="idref" href="#OpContractCaller"><span class="id" title="constructor">OpContractCaller</span></a> <br/>
| <a id="OpAdd" class="idref" href="#OpAdd"><span class="id" title="constructor">OpAdd</span></a>  (<a id="src0_mode:86" class="idref" href="#src0_mode:86"><span class="id" title="binder">src0_mode</span></a>: <a class="idref" href="#src_mode"><span class="id" title="inductive">src_mode</span></a>) (<a id="dst0_mode:87" class="idref" href="#dst0_mode:87"><span class="id" title="binder">dst0_mode</span></a>: <a class="idref" href="#dst_mode"><span class="id" title="inductive">dst_mode</span></a>) (<a id="set_flags:88" class="idref" href="#set_flags:88"><span class="id" title="binder">set_flags</span></a>: <a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>)<br/>
.<br/>

<br/>
</div>

<div class="doc"><p>The definition <span
class="inlinecode"><a class="idref" href="#mach_instruction"><span
class="id" title="record">mach_instruction</span></a></span> showcases
the layout of instruction fields. This layout is applied against the
instruction’s binary representation.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Section</span> <a id="MachInstructionDefinition" class="idref" href="#MachInstructionDefinition"><span class="id" title="section">MachInstructionDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="reg_type:89" class="idref" href="#reg_type:89"><span class="id" title="binder">reg_type</span></a> <a id="imm_type:90" class="idref" href="#imm_type:90"><span class="id" title="binder">imm_type</span></a>: <span class="id" title="keyword">Type</span>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="mach_instruction" class="idref" href="#mach_instruction"><span class="id" title="record">mach_instruction</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mk_ins</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="op_code" class="idref" href="#op_code"><span class="id" title="projection">op_code</span></a>: <a class="idref" href="#mach_opcode"><span class="id" title="inductive">mach_opcode</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="op_predicate" class="idref" href="#op_predicate"><span class="id" title="projection">op_predicate</span></a>: <a class="idref" href="#predicate"><span class="id" title="inductive">predicate</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="op_src0" class="idref" href="#op_src0"><span class="id" title="projection">op_src0</span></a>: <a class="idref" href="#MachInstructionDefinition.reg_type"><span class="id" title="variable">reg_type</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="op_src1" class="idref" href="#op_src1"><span class="id" title="projection">op_src1</span></a>: <a class="idref" href="#MachInstructionDefinition.reg_type"><span class="id" title="variable">reg_type</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="op_dst0" class="idref" href="#op_dst0"><span class="id" title="projection">op_dst0</span></a>: <a class="idref" href="#MachInstructionDefinition.reg_type"><span class="id" title="variable">reg_type</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="op_dst1" class="idref" href="#op_dst1"><span class="id" title="projection">op_dst1</span></a>: <a class="idref" href="#MachInstructionDefinition.reg_type"><span class="id" title="variable">reg_type</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="op_imm0" class="idref" href="#op_imm0"><span class="id" title="projection">op_imm0</span></a>: <a class="idref" href="#MachInstructionDefinition.imm_type"><span class="id" title="variable">imm_type</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="op_imm1" class="idref" href="#op_imm1"><span class="id" title="projection">op_imm1</span></a>: <a class="idref" href="#MachInstructionDefinition.imm_type"><span class="id" title="variable">imm_type</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
&nbsp;&nbsp;#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Instance</span> <a id="etaIns" class="idref" href="#etaIns"><span class="id" title="instance">etaIns</span></a> : <span class="id" title="class">Settable</span> <span class="id" title="var">_</span> := <span class="id" title="notation">settable</span><span class="id" title="notation">!</span> <a class="idref" href="#mk_ins"><span class="id" title="constructor">mk_ins</span></a> <span class="id" title="notation"><</span> <a class="idref" href="#op_code"><span class="id" title="projection">op_code</span></a><span class="id" title="notation">;</span> <a class="idref" href="#op_predicate"><span class="id" title="projection">op_predicate</span></a><span class="id" title="notation">;</span> <a class="idref" href="#op_src0"><span class="id" title="projection">op_src0</span></a><span class="id" title="notation">;</span> <a class="idref" href="#op_src1"><span class="id" title="projection">op_src1</span></a><span class="id" title="notation">;</span> <a class="idref" href="#op_dst0"><span class="id" title="projection">op_dst0</span></a><span class="id" title="notation">;</span> <a class="idref" href="#op_dst1"><span class="id" title="projection">op_dst1</span></a><span class="id" title="notation">;</span> <a class="idref" href="#op_imm0"><span class="id" title="projection">op_imm0</span></a><span class="id" title="notation">;</span> <a class="idref" href="#op_imm1"><span class="id" title="projection">op_imm1</span></a><span class="id" title="notation">></span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#MachInstructionDefinition"><span class="id" title="section">MachInstructionDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.isa.AssemblyToCore</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Addressing</span></a> <a class="idref" href="#"><span class="id" title="library">Assembly</span></a> <a class="idref" href="#"><span class="id" title="library">isa.Modifiers</span></a> <a class="idref" href="#"><span class="id" title="library">CoreSet</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Addressing</span></a> <a class="idref" href="#"><span class="id" title="module">isa.Modifiers</span></a> <a class="idref" href="#"><span class="id" title="module">CoreSet</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#Coercions"><span class="id" title="module">Addressing.Coercions</span></a>.<br/>
<span class="id" title="keyword">Section</span> <a id="AssemblyToCore" class="idref" href="#AssemblyToCore"><span class="id" title="section">AssemblyToCore</span></a>.<br/>
</div>

<div class="doc"><p>Syntactically translate <span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span> to a core
<span
class="inlinecode"><a class="idref" href="#instruction"><span
class="id" title="inductive">instruction</span></a></span>, preceding
execution:</p>
<ol type="1">
<li>apply <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span> modifier to
instructions where applicable;</li>
<li>remove the restrictions on operand types e.g. in assembly <span
class="inlinecode"><a class="idref" href="#OpAdd"><span
class="id" title="constructor">OpAdd</span></a></span> may accept the
first argument in memory and the second argument only in register, but
in core set both arguments can be fetched from either memory or
registers. This simplifies attributing semantic to instructions.</li>
</ol>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="to_core" class="idref" href="#to_core"><span class="id" title="definition">to_core</span></a> (<a id="input:1" class="idref" href="#input:1"><span class="id" title="binder">input</span></a>: <a class="idref" href="#asm_instruction"><span class="id" title="inductive">Assembly.asm_instruction</span></a>) : @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#input:1"><span class="id" title="variable">input</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpInvalid"><span class="id" title="constructor">Assembly.OpInvalid</span></a> ⇒ <a class="idref" href="#OpInvalid"><span class="id" title="constructor">OpInvalid</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpNoOp"><span class="id" title="constructor">Assembly.OpNoOp</span></a> ⇒ <a class="idref" href="#OpNoOp"><span class="id" title="constructor">OpNoOp</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpSpAdd"><span class="id" title="constructor">Assembly.OpSpAdd</span></a> <span class="id" title="var">in1</span> (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <span class="id" title="var">ofs</span>) ⇒ @<a class="idref" href="#OpSpAdd"><span class="id" title="constructor">OpSpAdd</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">ofs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpSpSub"><span class="id" title="constructor">Assembly.OpSpSub</span></a> <span class="id" title="var">in1</span> (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <span class="id" title="var">ofs</span>) ⇒ @<a class="idref" href="#OpSpSub"><span class="id" title="constructor">OpSpSub</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">ofs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpJump"><span class="id" title="constructor">Assembly.OpJump</span></a> <span class="id" title="var">dest</span> <span class="id" title="var">ret_addr</span> ⇒ @<a class="idref" href="#OpJump"><span class="id" title="constructor">OpJump</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">dest</span> <span class="id" title="var">ret_addr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpAnd"><span class="id" title="constructor">Assembly.OpAnd</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out1</span> <span class="id" title="var">flags</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpAnd"><span class="id" title="constructor">OpAnd</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out1</span> <span class="id" title="var">flags</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpOr"><span class="id" title="constructor">Assembly.OpOr</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out1</span> <span class="id" title="var">flags</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpOr"><span class="id" title="constructor">OpOr</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out1</span> <span class="id" title="var">flags</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpXor"><span class="id" title="constructor">Assembly.OpXor</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out1</span> <span class="id" title="var">flags</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpXor"><span class="id" title="constructor">OpXor</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out1</span> <span class="id" title="var">flags</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpAdd"><span class="id" title="constructor">Assembly.OpAdd</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out1</span> <span class="id" title="var">flags</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpAdd"><span class="id" title="constructor">OpAdd</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out1</span> <span class="id" title="var">flags</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpSub"><span class="id" title="constructor">Assembly.OpSub</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out1</span> <span class="id" title="var">swap</span> <span class="id" title="var">flags</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<a id="in1':3" class="idref" href="#in1':3"><span class="id" title="binder">in1'</span></a>, <a id="in2':4" class="idref" href="#in2':4"><span class="id" title="binder">in2'</span></a>) := <a class="idref" href="#apply_swap"><span class="id" title="definition">apply_swap</span></a> <span class="id" title="var">swap</span> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpSub"><span class="id" title="constructor">OpSub</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <a class="idref" href="#in1':3"><span class="id" title="variable">in1'</span></a> <a class="idref" href="#in2':4"><span class="id" title="variable">in2'</span></a> <span class="id" title="var">out1</span> <span class="id" title="var">flags</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpShl"><span class="id" title="constructor">Assembly.OpShl</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out1</span> <span class="id" title="var">swap</span> <span class="id" title="var">flags</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<a id="in1':5" class="idref" href="#in1':5"><span class="id" title="binder">in1'</span></a>, <a id="in2':6" class="idref" href="#in2':6"><span class="id" title="binder">in2'</span></a>) := <a class="idref" href="#apply_swap"><span class="id" title="definition">apply_swap</span></a> <span class="id" title="var">swap</span> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpShl"><span class="id" title="constructor">OpShl</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <a class="idref" href="#in1':5"><span class="id" title="variable">in1'</span></a> <a class="idref" href="#in2':6"><span class="id" title="variable">in2'</span></a> <span class="id" title="var">out1</span> <span class="id" title="var">flags</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpShr"><span class="id" title="constructor">Assembly.OpShr</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out1</span> <span class="id" title="var">swap</span> <span class="id" title="var">flags</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<a id="in1':7" class="idref" href="#in1':7"><span class="id" title="binder">in1'</span></a>, <a id="in2':8" class="idref" href="#in2':8"><span class="id" title="binder">in2'</span></a>) := <a class="idref" href="#apply_swap"><span class="id" title="definition">apply_swap</span></a> <span class="id" title="var">swap</span> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpShr"><span class="id" title="constructor">OpShr</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <a class="idref" href="#in1':7"><span class="id" title="variable">in1'</span></a> <a class="idref" href="#in2':8"><span class="id" title="variable">in2'</span></a> <span class="id" title="var">out1</span> <span class="id" title="var">flags</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpRol"><span class="id" title="constructor">Assembly.OpRol</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out1</span> <span class="id" title="var">swap</span> <span class="id" title="var">flags</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<a id="in1':9" class="idref" href="#in1':9"><span class="id" title="binder">in1'</span></a>, <a id="in2':10" class="idref" href="#in2':10"><span class="id" title="binder">in2'</span></a>) := <a class="idref" href="#apply_swap"><span class="id" title="definition">apply_swap</span></a> <span class="id" title="var">swap</span> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpRol"><span class="id" title="constructor">OpRol</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <a class="idref" href="#in1':9"><span class="id" title="variable">in1'</span></a> <a class="idref" href="#in2':10"><span class="id" title="variable">in2'</span></a> <span class="id" title="var">out1</span> <span class="id" title="var">flags</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpRor"><span class="id" title="constructor">Assembly.OpRor</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out1</span> <span class="id" title="var">swap</span> <span class="id" title="var">flags</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<a id="in1':11" class="idref" href="#in1':11"><span class="id" title="binder">in1'</span></a>, <a id="in2':12" class="idref" href="#in2':12"><span class="id" title="binder">in2'</span></a>) := <a class="idref" href="#apply_swap"><span class="id" title="definition">apply_swap</span></a> <span class="id" title="var">swap</span> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpRor"><span class="id" title="constructor">OpRor</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <a class="idref" href="#in1':11"><span class="id" title="variable">in1'</span></a> <a class="idref" href="#in2':12"><span class="id" title="variable">in2'</span></a> <span class="id" title="var">out1</span> <span class="id" title="var">flags</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpMul"><span class="id" title="constructor">Assembly.OpMul</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out1</span> <span class="id" title="var">out2</span> <span class="id" title="var">flags</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpMul"><span class="id" title="constructor">OpMul</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out1</span> <span class="id" title="var">out2</span> <span class="id" title="var">flags</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpDiv"><span class="id" title="constructor">Assembly.OpDiv</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out1</span> <span class="id" title="var">out2</span> <span class="id" title="var">swap</span> <span class="id" title="var">flags</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<a id="in1':13" class="idref" href="#in1':13"><span class="id" title="binder">in1'</span></a>, <a id="in2':14" class="idref" href="#in2':14"><span class="id" title="binder">in2'</span></a>) := <a class="idref" href="#apply_swap"><span class="id" title="definition">apply_swap</span></a> <span class="id" title="var">swap</span> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpDiv"><span class="id" title="constructor">OpDiv</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <a class="idref" href="#in1':13"><span class="id" title="variable">in1'</span></a> <a class="idref" href="#in2':14"><span class="id" title="variable">in2'</span></a> <span class="id" title="var">out1</span> <span class="id" title="var">out2</span> <span class="id" title="var">flags</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpPtrAdd"><span class="id" title="constructor">Assembly.OpPtrAdd</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out</span> <span class="id" title="var">swap</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<a id="in1':15" class="idref" href="#in1':15"><span class="id" title="binder">in1'</span></a>, <a id="in2':16" class="idref" href="#in2':16"><span class="id" title="binder">in2'</span></a>) := <a class="idref" href="#apply_swap"><span class="id" title="definition">apply_swap</span></a> <span class="id" title="var">swap</span> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpPtrAdd"><span class="id" title="constructor">OpPtrAdd</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <a class="idref" href="#in1':15"><span class="id" title="variable">in1'</span></a> <a class="idref" href="#in2':16"><span class="id" title="variable">in2'</span></a> <span class="id" title="var">out</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpPtrSub"><span class="id" title="constructor">Assembly.OpPtrSub</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out</span> <span class="id" title="var">swap</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<a id="in1':17" class="idref" href="#in1':17"><span class="id" title="binder">in1'</span></a>, <a id="in2':18" class="idref" href="#in2':18"><span class="id" title="binder">in2'</span></a>) := <a class="idref" href="#apply_swap"><span class="id" title="definition">apply_swap</span></a> <span class="id" title="var">swap</span> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpPtrSub"><span class="id" title="constructor">OpPtrSub</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <a class="idref" href="#in1':17"><span class="id" title="variable">in1'</span></a> <a class="idref" href="#in2':18"><span class="id" title="variable">in2'</span></a> <span class="id" title="var">out</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpPtrShrink"><span class="id" title="constructor">Assembly.OpPtrShrink</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out</span> <span class="id" title="var">swap</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<a id="in1':19" class="idref" href="#in1':19"><span class="id" title="binder">in1'</span></a>, <a id="in2':20" class="idref" href="#in2':20"><span class="id" title="binder">in2'</span></a>) := <a class="idref" href="#apply_swap"><span class="id" title="definition">apply_swap</span></a> <span class="id" title="var">swap</span> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpPtrShrink"><span class="id" title="constructor">OpPtrShrink</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <a class="idref" href="#in1':19"><span class="id" title="variable">in1'</span></a> <a class="idref" href="#in2':20"><span class="id" title="variable">in2'</span></a> <span class="id" title="var">out</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpPtrPack"><span class="id" title="constructor">Assembly.OpPtrPack</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out</span> <span class="id" title="var">swap</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<a id="in1':21" class="idref" href="#in1':21"><span class="id" title="binder">in1'</span></a>, <a id="in2':22" class="idref" href="#in2':22"><span class="id" title="binder">in2'</span></a>) := <a class="idref" href="#apply_swap"><span class="id" title="definition">apply_swap</span></a> <span class="id" title="var">swap</span> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpPtrPack"><span class="id" title="constructor">OpPtrPack</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <a class="idref" href="#in1':21"><span class="id" title="variable">in1'</span></a> <a class="idref" href="#in2':22"><span class="id" title="variable">in2'</span></a> <span class="id" title="var">out</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpStore"><span class="id" title="constructor">Assembly.OpStore</span></a> <span class="id" title="var">ptr</span> <span class="id" title="var">val</span> <span class="id" title="var">mem</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpStore"><span class="id" title="constructor">OpStore</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">ptr</span> <span class="id" title="var">val</span> <span class="id" title="var">mem</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpNearCall"><span class="id" title="constructor">Assembly.OpNearCall</span></a> <span class="id" title="var">in1</span> (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <span class="id" title="var">dest</span>) (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <span class="id" title="var">handler</span>) ⇒ @<a class="idref" href="#OpNearCall"><span class="id" title="constructor">OpNearCall</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">dest</span> <span class="id" title="var">handler</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpFarCall"><span class="id" title="constructor">Assembly.OpFarCall</span></a> <span class="id" title="var">enc</span> <span class="id" title="var">dest</span> (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <span class="id" title="var">handler</span>) <span class="id" title="var">is_static</span> <span class="id" title="var">is_shard_provided</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpFarCall"><span class="id" title="constructor">OpFarCall</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">enc</span> <span class="id" title="var">dest</span> <span class="id" title="var">handler</span> <span class="id" title="var">is_static</span> <span class="id" title="var">is_shard_provided</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpMimicCall"><span class="id" title="constructor">Assembly.OpMimicCall</span></a> <span class="id" title="var">enc</span> <span class="id" title="var">dest</span> (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <span class="id" title="var">handler</span>) <span class="id" title="var">is_static</span> <span class="id" title="var">is_shard_provided</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpMimicCall"><span class="id" title="constructor">OpMimicCall</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">enc</span> <span class="id" title="var">dest</span> <span class="id" title="var">handler</span> <span class="id" title="var">is_static</span> <span class="id" title="var">is_shard_provided</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpDelegateCall"><span class="id" title="constructor">Assembly.OpDelegateCall</span></a> <span class="id" title="var">enc</span> <span class="id" title="var">dest</span> (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <span class="id" title="var">handler</span>) <span class="id" title="var">is_static</span> <span class="id" title="var">is_shard_provided</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpDelegateCall"><span class="id" title="constructor">OpDelegateCall</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">enc</span> <span class="id" title="var">dest</span> <span class="id" title="var">handler</span> <span class="id" title="var">is_static</span> <span class="id" title="var">is_shard_provided</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpNearRetTo"><span class="id" title="constructor">Assembly.OpNearRetTo</span></a> (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <span class="id" title="var">dest</span>) ⇒ <a class="idref" href="#OpNearRetTo"><span class="id" title="constructor">OpNearRetTo</span></a> <span class="id" title="var">dest</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpRet"><span class="id" title="constructor">Assembly.OpRet</span></a> <span class="id" title="var">args</span>  ⇒ @<a class="idref" href="#OpRet"><span class="id" title="constructor">OpRet</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a>  <span class="id" title="var">args</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpNearRevertTo"><span class="id" title="constructor">Assembly.OpNearRevertTo</span></a> (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <span class="id" title="var">dest</span>) ⇒ @<a class="idref" href="#OpNearRevertTo"><span class="id" title="constructor">OpNearRevertTo</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">dest</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpRevert"><span class="id" title="constructor">Assembly.OpRevert</span></a> <span class="id" title="var">args</span>  ⇒ @<a class="idref" href="#OpRevert"><span class="id" title="constructor">OpRevert</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a>  <span class="id" title="var">args</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpNearPanicTo"><span class="id" title="constructor">Assembly.OpNearPanicTo</span></a> (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <span class="id" title="var">label</span>) ⇒ @<a class="idref" href="#OpNearPanicTo"><span class="id" title="constructor">OpNearPanicTo</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">label</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpPanic"><span class="id" title="constructor">Assembly.OpPanic</span></a>  ⇒ @<a class="idref" href="#OpPanic"><span class="id" title="constructor">OpPanic</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpLoad"><span class="id" title="constructor">Assembly.OpLoad</span></a> <span class="id" title="var">ptr</span> <span class="id" title="var">res</span> <span class="id" title="var">mem</span>  ⇒ @<a class="idref" href="#OpLoad"><span class="id" title="constructor">OpLoad</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a>  <span class="id" title="var">ptr</span> <span class="id" title="var">res</span> <span class="id" title="var">mem</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpLoadInc"><span class="id" title="constructor">Assembly.OpLoadInc</span></a> <span class="id" title="var">ptr</span> <span class="id" title="var">res</span> <span class="id" title="var">mem</span> <span class="id" title="var">inc_ptr</span> ⇒ @<a class="idref" href="#OpLoadInc"><span class="id" title="constructor">OpLoadInc</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a>  <span class="id" title="var">ptr</span> <span class="id" title="var">res</span> <span class="id" title="var">mem</span> <span class="id" title="var">inc_ptr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpStoreInc"><span class="id" title="constructor">Assembly.OpStoreInc</span></a> <span class="id" title="var">ptr</span> <span class="id" title="var">val</span> <span class="id" title="var">mem</span> <span class="id" title="var">inc_ptr</span> ⇒ @<a class="idref" href="#OpStoreInc"><span class="id" title="constructor">OpStoreInc</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">ptr</span> <span class="id" title="var">val</span> <span class="id" title="var">mem</span> <span class="id" title="var">inc_ptr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpLoadPointer"><span class="id" title="constructor">Assembly.OpLoadPointer</span></a> <span class="id" title="var">ptr</span> <span class="id" title="var">res</span>  ⇒ @<a class="idref" href="#OpLoadPointer"><span class="id" title="constructor">OpLoadPointer</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a>  <span class="id" title="var">ptr</span> <span class="id" title="var">res</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpLoadPointerInc"><span class="id" title="constructor">Assembly.OpLoadPointerInc</span></a> <span class="id" title="var">ptr</span> <span class="id" title="var">res</span> <span class="id" title="var">inc_ptr</span>  ⇒ @<a class="idref" href="#OpLoadPointerInc"><span class="id" title="constructor">OpLoadPointerInc</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a>  <span class="id" title="var">ptr</span> <span class="id" title="var">res</span> <span class="id" title="var">inc_ptr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpContractThis"><span class="id" title="constructor">Assembly.OpContractThis</span></a> <span class="id" title="var">out</span>  ⇒ @<a class="idref" href="#OpContractThis"><span class="id" title="constructor">OpContractThis</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a>  <span class="id" title="var">out</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpContractCaller"><span class="id" title="constructor">Assembly.OpContractCaller</span></a> <span class="id" title="var">out</span>  ⇒ @<a class="idref" href="#OpContractCaller"><span class="id" title="constructor">OpContractCaller</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a>  <span class="id" title="var">out</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpContractCodeAddress"><span class="id" title="constructor">Assembly.OpContractCodeAddress</span></a> <span class="id" title="var">out</span>  ⇒ @<a class="idref" href="#OpContractCodeAddress"><span class="id" title="constructor">OpContractCodeAddress</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a>  <span class="id" title="var">out</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpVMMeta"><span class="id" title="constructor">Assembly.OpVMMeta</span></a> <span class="id" title="var">out</span>  ⇒ @<a class="idref" href="#OpVMMeta"><span class="id" title="constructor">OpVMMeta</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a>  <span class="id" title="var">out</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpVMErgsLeft"><span class="id" title="constructor">Assembly.OpVMErgsLeft</span></a> <span class="id" title="var">out</span>  ⇒ @<a class="idref" href="#OpVMErgsLeft"><span class="id" title="constructor">OpVMErgsLeft</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a>  <span class="id" title="var">out</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpVMSP"><span class="id" title="constructor">Assembly.OpVMSP</span></a> <span class="id" title="var">out</span>  ⇒ @<a class="idref" href="#OpVMSP"><span class="id" title="constructor">OpVMSP</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a>  <span class="id" title="var">out</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpGetCapturedContext"><span class="id" title="constructor">Assembly.OpGetCapturedContext</span></a> <span class="id" title="var">out</span>  ⇒ @<a class="idref" href="#OpGetCapturedContext"><span class="id" title="constructor">OpGetCapturedContext</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a>  <span class="id" title="var">out</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpSetContextReg"><span class="id" title="constructor">Assembly.OpSetContextReg</span></a> <span class="id" title="var">in1</span>  ⇒ @<a class="idref" href="#OpSetContextReg"><span class="id" title="constructor">OpSetContextReg</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a>  <span class="id" title="var">in1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpIncrementTxNumber"><span class="id" title="constructor">Assembly.OpIncrementTxNumber</span></a>  ⇒ @<a class="idref" href="#OpIncrementTxNumber"><span class="id" title="constructor">OpIncrementTxNumber</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpSLoad"><span class="id" title="constructor">Assembly.OpSLoad</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">out</span>  ⇒ @<a class="idref" href="#OpSLoad"><span class="id" title="constructor">OpSLoad</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a>  <span class="id" title="var">in1</span> <span class="id" title="var">out</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpSStore"><span class="id" title="constructor">Assembly.OpSStore</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpSStore"><span class="id" title="constructor">OpSStore</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpToL1Message"><span class="id" title="constructor">Assembly.OpToL1Message</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">is_first</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpToL1Message"><span class="id" title="constructor">OpToL1Message</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a>  <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">is_first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpEvent"><span class="id" title="constructor">Assembly.OpEvent</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">is_first</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpEvent"><span class="id" title="constructor">OpEvent</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a>  <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">is_first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpPrecompileCall"><span class="id" title="constructor">Assembly.OpPrecompileCall</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#OpPrecompileCall"><span class="id" title="constructor">OpPrecompileCall</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a>  <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;TODO:&nbsp;the&nbsp;following&nbsp;is&nbsp;not&nbsp;implemented&nbsp;yet&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpAuxMutating"><span class="id" title="constructor">Assembly.OpAuxMutating</span></a> <span class="id" title="var">in1</span> ⇒ @<a class="idref" href="#OpAuxMutating"><span class="id" title="constructor">OpAuxMutating</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">in1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpTransientStore"><span class="id" title="constructor">Assembly.OpTransientStore</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> ⇒ @<a class="idref" href="#OpTransientStore"><span class="id" title="constructor">OpTransientStore</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpTransientLoad"><span class="id" title="constructor">Assembly.OpTransientLoad</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">out1</span> ⇒ @<a class="idref" href="#OpTransientLoad"><span class="id" title="constructor">OpTransientLoad</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">out1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpDecommit"><span class="id" title="constructor">Assembly.OpDecommit</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out1</span> ⇒ @<a class="idref" href="#OpDecommit"><span class="id" title="constructor">OpDecommit</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpStaticWrite"><span class="id" title="constructor">Assembly.OpStaticWrite</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span>  ⇒ @<a class="idref" href="#OpStaticWrite"><span class="id" title="constructor">OpStaticWrite</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpStaticWriteInc"><span class="id" title="constructor">Assembly.OpStaticWriteInc</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out1</span> ⇒ @<a class="idref" href="#OpStaticWriteInc"><span class="id" title="constructor">OpStaticWriteInc</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">in2</span> <span class="id" title="var">out1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpStaticRead"><span class="id" title="constructor">Assembly.OpStaticRead</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">out1</span> ⇒ @<a class="idref" href="#OpStaticRead"><span class="id" title="constructor">OpStaticRead</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">out1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpStaticReadInc"><span class="id" title="constructor">Assembly.OpStaticReadInc</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">out1</span> <span class="id" title="var">out2</span> ⇒ @<a class="idref" href="#OpStaticReadInc"><span class="id" title="constructor">OpStaticReadInc</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <span class="id" title="var">in1</span> <span class="id" title="var">out1</span> <span class="id" title="var">out2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#AssemblyToCore"><span class="id" title="section">AssemblyToCore</span></a>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <a id="Coercions" class="idref" href="#Coercions"><span class="id" title="module">Coercions</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Coercion</span> <a class="idref" href="#to_core"><span class="id" title="definition">to_core</span></a><a class="idref" href="#to_core"><span class="id" title="definition">:</span></a> <a class="idref" href="#to_core"><span class="id" title="definition">Assembly.asm_instruction</span></a> <a class="idref" href="#to_core"><span class="id" title="definition">>-></span></a> <a class="idref" href="#to_core"><span class="id" title="definition">CoreSet.instruction</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Coercions"><span class="id" title="module">Coercions</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.isa.AssemblyToMach</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">GeneratedMachISA</span></a>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Addressing</span></a> <a class="idref" href="#"><span class="id" title="library">isa.Modifiers</span></a> <a class="idref" href="#"><span class="id" title="library">isa.Assembly</span></a> <a class="idref" href="#"><span class="id" title="library">Predication</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">RecordSetNotations</span>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Assembly</span></a> <a class="idref" href="#"><span class="id" title="module">Addressing</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">GeneratedMachISA</span></a> <a class="idref" href="#"><span class="id" title="module">Modifiers</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a> <a class="idref" href="#"><span class="id" title="module">Predication</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#Coercions"><span class="id" title="module">Addressing.Coercions</span></a>.<br/>

<br/>
</div>

<div class="doc"><h1
id="encoding-of-asm_instruction-to-the-universal-instruction-layout">Encoding
of <span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span> to the
universal instruction layout</h1>
<p>In the lowest level, all instructions are encoded to a uniform 64-bit
format; its fields are described by <span
class="inlinecode"><a class="idref" href="#mach_instruction"><span
class="id" title="record">mach_instruction</span></a></span>.</p>
<p>This file details the encoding of <span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span> to <span
class="inlinecode"><a class="idref" href="#mach_instruction"><span
class="id" title="record">mach_instruction</span></a></span>.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Definition</span> <a id="src_mode_of" class="idref" href="#src_mode_of"><span class="id" title="definition">src_mode_of</span></a> (<a id="op:1" class="idref" href="#op:1"><span class="id" title="binder">op</span></a>:<a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#op:1"><span class="id" title="variable">op</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#InReg"><span class="id" title="constructor">InReg</span></a> <span class="id" title="var">x</span> ⇒ <a class="idref" href="#SrcReg"><span class="id" title="constructor">SrcReg</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#InImm"><span class="id" title="constructor">InImm</span></a> <span class="id" title="var">x</span> ⇒ <a class="idref" href="#SrcImm"><span class="id" title="constructor">SrcImm</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#InStack"><span class="id" title="constructor">InStack</span></a> (<a class="idref" href="#StackInOnly"><span class="id" title="constructor">StackInOnly</span></a> (<a class="idref" href="#RelSpPop"><span class="id" title="constructor">RelSpPop</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) ⇒ <a class="idref" href="#SrcSpRelativePop"><span class="id" title="constructor">SrcSpRelativePop</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#InStack"><span class="id" title="constructor">InStack</span></a> (<a class="idref" href="#StackInAny"><span class="id" title="constructor">StackInAny</span></a> (<a class="idref" href="#Absolute"><span class="id" title="constructor">Absolute</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) ⇒ <a class="idref" href="#SrcStackAbsolute"><span class="id" title="constructor">SrcStackAbsolute</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#InStack"><span class="id" title="constructor">InStack</span></a> (<a class="idref" href="#StackInAny"><span class="id" title="constructor">StackInAny</span></a> (<a class="idref" href="#RelSP"><span class="id" title="constructor">RelSP</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) ⇒ <a class="idref" href="#SrcSpRelative"><span class="id" title="constructor">SrcSpRelative</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#InCode"><span class="id" title="constructor">InCode</span></a> <span class="id" title="var">x</span> ⇒ <a class="idref" href="#SrcCodeAddr"><span class="id" title="constructor">SrcCodeAddr</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#InConst"><span class="id" title="constructor">InConst</span></a> <span class="id" title="var">x</span> ⇒ <a class="idref" href="#SrcCodeAddr"><span class="id" title="constructor">SrcCodeAddr</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
.<br/>
<span class="id" title="keyword">Definition</span> <a id="src_special_mode_of" class="idref" href="#src_special_mode_of"><span class="id" title="definition">src_special_mode_of</span></a> (<a id="op:3" class="idref" href="#op:3"><span class="id" title="binder">op</span></a>:<a class="idref" href="#in_regimm"><span class="id" title="inductive">in_regimm</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#op:3"><span class="id" title="variable">op</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#RegImmR"><span class="id" title="constructor">RegImmR</span></a> <span class="id" title="var">x</span> ⇒ <a class="idref" href="#SrcSpecialReg"><span class="id" title="constructor">SrcSpecialReg</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#RegImmI"><span class="id" title="constructor">RegImmI</span></a> <span class="id" title="var">x</span> ⇒ <a class="idref" href="#SrcSpecialImm"><span class="id" title="constructor">SrcSpecialImm</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
.<br/>
<span class="id" title="keyword">Definition</span> <a id="dst_mode_of" class="idref" href="#dst_mode_of"><span class="id" title="definition">dst_mode_of</span></a> (<a id="op:5" class="idref" href="#op:5"><span class="id" title="binder">op</span></a>:<a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#op:5"><span class="id" title="variable">op</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OutReg"><span class="id" title="constructor">OutReg</span></a> <span class="id" title="var">x</span> ⇒ <a class="idref" href="#DstReg"><span class="id" title="constructor">DstReg</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OutStack"><span class="id" title="constructor">OutStack</span></a> (<a class="idref" href="#StackOutOnly"><span class="id" title="constructor">StackOutOnly</span></a> (<a class="idref" href="#RelSpPush"><span class="id" title="constructor">RelSpPush</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) ⇒ <a class="idref" href="#DstSpRelativePush"><span class="id" title="constructor">DstSpRelativePush</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OutStack"><span class="id" title="constructor">OutStack</span></a> (<a class="idref" href="#StackOutAny"><span class="id" title="constructor">StackOutAny</span></a> (<a class="idref" href="#Absolute"><span class="id" title="constructor">Absolute</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) ⇒ <a class="idref" href="#DstStackAbsolute"><span class="id" title="constructor">DstStackAbsolute</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OutStack"><span class="id" title="constructor">OutStack</span></a> (<a class="idref" href="#StackOutAny"><span class="id" title="constructor">StackOutAny</span></a> (<a class="idref" href="#RelSP"><span class="id" title="constructor">RelSP</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) ⇒ <a class="idref" href="#DstSpRelative"><span class="id" title="constructor">DstSpRelative</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
.<br/>
#[<span class="id" title="var">local</span>]<br/>
&nbsp;&nbsp;<a class="idref" href="#src_mode_of"><span class="id" title="definition">Coercion</span></a> <a class="idref" href="#src_mode_of"><span class="id" title="definition">src_mode_of</span></a><a class="idref" href="#src_mode_of"><span class="id" title="definition">:</span></a>  <a class="idref" href="#src_mode_of"><span class="id" title="definition">in_any</span></a> <a class="idref" href="#src_mode_of"><span class="id" title="definition">>-></span></a> <a class="idref" href="#src_mode_of"><span class="id" title="definition">src_mode</span></a>.<br/>
#[<span class="id" title="var">local</span>]<br/>
&nbsp;&nbsp;<a class="idref" href="#src_special_mode_of"><span class="id" title="definition">Coercion</span></a> <a class="idref" href="#src_special_mode_of"><span class="id" title="definition">src_special_mode_of</span></a><a class="idref" href="#src_special_mode_of"><span class="id" title="definition">:</span></a>  <a class="idref" href="#src_special_mode_of"><span class="id" title="definition">in_regimm</span></a> <a class="idref" href="#src_special_mode_of"><span class="id" title="definition">>-></span></a> <a class="idref" href="#src_special_mode_of"><span class="id" title="definition">src_special_mode</span></a>.<br/>
#[<span class="id" title="var">local</span>]<br/>
&nbsp;&nbsp;<a class="idref" href="#dst_mode_of"><span class="id" title="definition">Coercion</span></a> <a class="idref" href="#dst_mode_of"><span class="id" title="definition">dst_mode_of</span></a><a class="idref" href="#dst_mode_of"><span class="id" title="definition">:</span></a>  <a class="idref" href="#dst_mode_of"><span class="id" title="definition">out_any</span></a> <a class="idref" href="#dst_mode_of"><span class="id" title="definition">>-></span></a> <a class="idref" href="#dst_mode_of"><span class="id" title="definition">dst_mode</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>The Opcode field includes information such as modifiers and
addressing modes.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Definition</span> <a id="opcode_of" class="idref" href="#opcode_of"><span class="id" title="definition">opcode_of</span></a> (<a id="ins:7" class="idref" href="#ins:7"><span class="id" title="binder">ins</span></a>: <a class="idref" href="#asm_instruction"><span class="id" title="inductive">asm_instruction</span></a>) : <a class="idref" href="#mach_opcode"><span class="id" title="inductive">mach_opcode</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="no_label:8" class="idref" href="#no_label:8"><span class="id" title="binder">no_label</span></a> := <a class="idref" href="#false"><span class="id" title="constructor">false</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="with_label:9" class="idref" href="#with_label:9"><span class="id" title="binder">with_label</span></a> := <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="no_inc:10" class="idref" href="#no_inc:10"><span class="id" title="binder">no_inc</span></a> := <a class="idref" href="#false"><span class="id" title="constructor">false</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="inc:11" class="idref" href="#inc:11"><span class="id" title="binder">inc</span></a> := <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#ins:7"><span class="id" title="variable">ins</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpInvalid"><span class="id" title="constructor">Assembly.OpInvalid</span></a> ⇒ <a class="idref" href="#OpInvalid"><span class="id" title="constructor">OpInvalid</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpNoOp"><span class="id" title="constructor">Assembly.OpNoOp</span></a>  ⇒ <a class="idref" href="#OpNoOp"><span class="id" title="constructor">OpNoOp</span></a> <a class="idref" href="#SrcReg"><span class="id" title="constructor">SrcReg</span></a> <a class="idref" href="#DstReg"><span class="id" title="constructor">DstReg</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpSpAdd"><span class="id" title="constructor">Assembly.OpSpAdd</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpNoOp"><span class="id" title="constructor">OpNoOp</span></a> <a class="idref" href="#SrcReg"><span class="id" title="constructor">SrcReg</span></a> <a class="idref" href="#DstSpRelativePush"><span class="id" title="constructor">DstSpRelativePush</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpSpSub"><span class="id" title="constructor">Assembly.OpSpSub</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpNoOp"><span class="id" title="constructor">OpNoOp</span></a> <a class="idref" href="#SrcSpRelativePop"><span class="id" title="constructor">SrcSpRelativePop</span></a> <a class="idref" href="#DstReg"><span class="id" title="constructor">DstReg</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpJump"><span class="id" title="constructor">Assembly.OpJump</span></a> <span class="id" title="var">dest</span> <span class="id" title="var">_ret_addr</span> ⇒ <a class="idref" href="#OpJump"><span class="id" title="constructor">OpJump</span></a> <span class="id" title="var">dest</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpAnd"><span class="id" title="constructor">Assembly.OpAnd</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">_</span> <span class="id" title="var">out</span> <span class="id" title="var">sflags</span> ⇒ <a class="idref" href="#OpAnd"><span class="id" title="constructor">OpAnd</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">out</span> <span class="id" title="var">sflags</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpOr"><span class="id" title="constructor">Assembly.OpOr</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">_</span> <span class="id" title="var">out</span> <span class="id" title="var">sflags</span> ⇒ <a class="idref" href="#OpOr"><span class="id" title="constructor">OpOr</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">out</span> <span class="id" title="var">sflags</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpXor"><span class="id" title="constructor">Assembly.OpXor</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">_</span> <span class="id" title="var">out</span> <span class="id" title="var">sflags</span> ⇒ <a class="idref" href="#OpXor"><span class="id" title="constructor">OpXor</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">out</span> <span class="id" title="var">sflags</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpAdd"><span class="id" title="constructor">Assembly.OpAdd</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">_</span> <span class="id" title="var">out</span> <span class="id" title="var">sflags</span> ⇒ <a class="idref" href="#OpAdd"><span class="id" title="constructor">OpAdd</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">out</span> <span class="id" title="var">sflags</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpSub"><span class="id" title="constructor">Assembly.OpSub</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">src1</span> <span class="id" title="var">dst</span> <span class="id" title="var">swap</span> <span class="id" title="var">sflags</span> ⇒ <a class="idref" href="#OpSub"><span class="id" title="constructor">OpSub</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">dst</span> <span class="id" title="var">swap</span> <span class="id" title="var">sflags</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpShl"><span class="id" title="constructor">Assembly.OpShl</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">src1</span> <span class="id" title="var">dst</span> <span class="id" title="var">swap</span> <span class="id" title="var">sflags</span> ⇒ <a class="idref" href="#OpShl"><span class="id" title="constructor">OpShl</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">dst</span> <span class="id" title="var">swap</span> <span class="id" title="var">sflags</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpShr"><span class="id" title="constructor">Assembly.OpShr</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">src1</span> <span class="id" title="var">dst</span> <span class="id" title="var">swap</span> <span class="id" title="var">sflags</span> ⇒ <a class="idref" href="#OpShr"><span class="id" title="constructor">OpShr</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">dst</span> <span class="id" title="var">swap</span> <span class="id" title="var">sflags</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpRol"><span class="id" title="constructor">Assembly.OpRol</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">src1</span> <span class="id" title="var">dst</span> <span class="id" title="var">swap</span> <span class="id" title="var">sflags</span> ⇒ <a class="idref" href="#OpRol"><span class="id" title="constructor">OpRol</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">dst</span> <span class="id" title="var">swap</span> <span class="id" title="var">sflags</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpRor"><span class="id" title="constructor">Assembly.OpRor</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">src1</span> <span class="id" title="var">dst</span> <span class="id" title="var">swap</span> <span class="id" title="var">sflags</span> ⇒ <a class="idref" href="#OpRor"><span class="id" title="constructor">OpRor</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">dst</span> <span class="id" title="var">swap</span> <span class="id" title="var">sflags</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpMul"><span class="id" title="constructor">Assembly.OpMul</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">_</span> <span class="id" title="var">dst0</span> <span class="id" title="var">_</span> <span class="id" title="var">sflags</span> ⇒ <a class="idref" href="#OpMul"><span class="id" title="constructor">OpMul</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">dst0</span> <span class="id" title="var">sflags</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpDiv"><span class="id" title="constructor">Assembly.OpDiv</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">_</span> <span class="id" title="var">dst0</span> <span class="id" title="var">_</span> <span class="id" title="var">swap</span> <span class="id" title="var">sflags</span> ⇒ <a class="idref" href="#OpDiv"><span class="id" title="constructor">OpDiv</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">dst0</span> <span class="id" title="var">swap</span> <span class="id" title="var">sflags</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpNearCall"><span class="id" title="constructor">Assembly.OpNearCall</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒  <a class="idref" href="#OpNearCall"><span class="id" title="constructor">OpNearCall</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpFarCall"><span class="id" title="constructor">Assembly.OpFarCall</span></a> <span class="id" title="var">enc</span> <span class="id" title="var">dest</span> <span class="id" title="var">handler</span> <span class="id" title="var">is_static</span> <span class="id" title="var">is_shard_provided</span> ⇒ <a class="idref" href="#OpFarCall"><span class="id" title="constructor">OpFarCall</span></a> <span class="id" title="var">is_static</span> <span class="id" title="var">is_shard_provided</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpMimicCall"><span class="id" title="constructor">Assembly.OpMimicCall</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">is_static</span> <span class="id" title="var">is_shard_provided</span> ⇒ <a class="idref" href="#OpMimicCall"><span class="id" title="constructor">OpMimicCall</span></a> <span class="id" title="var">is_static</span> <span class="id" title="var">is_shard_provided</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpDelegateCall"><span class="id" title="constructor">Assembly.OpDelegateCall</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">is_static</span> <span class="id" title="var">is_shard_provided</span> ⇒ <a class="idref" href="#OpDelegateCall"><span class="id" title="constructor">OpDelegateCall</span></a> <span class="id" title="var">is_static</span> <span class="id" title="var">is_shard_provided</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpRet"><span class="id" title="constructor">Assembly.OpRet</span></a> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpRet"><span class="id" title="constructor">OpRet</span></a> <a class="idref" href="#no_label:8"><span class="id" title="variable">no_label</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpNearRetTo"><span class="id" title="constructor">Assembly.OpNearRetTo</span></a> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpRet"><span class="id" title="constructor">OpRet</span></a> <a class="idref" href="#with_label:9"><span class="id" title="variable">with_label</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpNearRevertTo"><span class="id" title="constructor">Assembly.OpNearRevertTo</span></a> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpRevert"><span class="id" title="constructor">OpRevert</span></a> <a class="idref" href="#with_label:9"><span class="id" title="variable">with_label</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpRevert"><span class="id" title="constructor">Assembly.OpRevert</span></a> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpRevert"><span class="id" title="constructor">OpRevert</span></a> <a class="idref" href="#no_label:8"><span class="id" title="variable">no_label</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpNearPanicTo"><span class="id" title="constructor">Assembly.OpNearPanicTo</span></a> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpPanic"><span class="id" title="constructor">OpPanic</span></a> <a class="idref" href="#with_label:9"><span class="id" title="variable">with_label</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpPanic"><span class="id" title="constructor">Assembly.OpPanic</span></a> ⇒ <a class="idref" href="#OpPanic"><span class="id" title="constructor">OpPanic</span></a> <a class="idref" href="#no_label:8"><span class="id" title="variable">no_label</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpPtrAdd"><span class="id" title="constructor">Assembly.OpPtrAdd</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">_</span> <span class="id" title="var">dst0</span> <span class="id" title="var">swap</span> ⇒ <a class="idref" href="#OpPtrAdd"><span class="id" title="constructor">OpPtrAdd</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">dst0</span> <span class="id" title="var">swap</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpPtrSub"><span class="id" title="constructor">Assembly.OpPtrSub</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">_</span> <span class="id" title="var">dst0</span> <span class="id" title="var">swap</span> ⇒ <a class="idref" href="#OpPtrSub"><span class="id" title="constructor">OpPtrSub</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">dst0</span> <span class="id" title="var">swap</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpPtrShrink"><span class="id" title="constructor">Assembly.OpPtrShrink</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">_</span> <span class="id" title="var">dst0</span> <span class="id" title="var">swap</span> ⇒ <a class="idref" href="#OpPtrShrink"><span class="id" title="constructor">OpPtrShrink</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">dst0</span> <span class="id" title="var">swap</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpPtrPack"><span class="id" title="constructor">Assembly.OpPtrPack</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">_</span> <span class="id" title="var">dst0</span> <span class="id" title="var">swap</span> ⇒ <a class="idref" href="#OpPtrPack"><span class="id" title="constructor">OpPtrPack</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">dst0</span> <span class="id" title="var">swap</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpLoad"><span class="id" title="constructor">Assembly.OpLoad</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">dst0</span> <a class="idref" href="#Heap"><span class="id" title="constructor">Heap</span></a> ⇒ <a class="idref" href="#OpLoadHeap"><span class="id" title="constructor">OpLoadHeap</span></a> <span class="id" title="var">src0</span> <a class="idref" href="#no_inc:10"><span class="id" title="variable">no_inc</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpLoad"><span class="id" title="constructor">Assembly.OpLoad</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">dst0</span> <a class="idref" href="#AuxHeap"><span class="id" title="constructor">AuxHeap</span></a> ⇒ <a class="idref" href="#OpLoadAuxHeap"><span class="id" title="constructor">OpLoadAuxHeap</span></a> <span class="id" title="var">src0</span> <a class="idref" href="#no_inc:10"><span class="id" title="variable">no_inc</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpLoadInc"><span class="id" title="constructor">Assembly.OpLoadInc</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">dst0</span> <a class="idref" href="#Heap"><span class="id" title="constructor">Heap</span></a> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpLoadHeap"><span class="id" title="constructor">OpLoadHeap</span></a> <span class="id" title="var">src0</span> <a class="idref" href="#inc:11"><span class="id" title="variable">inc</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpLoadInc"><span class="id" title="constructor">Assembly.OpLoadInc</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">dst0</span> <a class="idref" href="#AuxHeap"><span class="id" title="constructor">AuxHeap</span></a> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpLoadAuxHeap"><span class="id" title="constructor">OpLoadAuxHeap</span></a> <span class="id" title="var">src0</span> <a class="idref" href="#inc:11"><span class="id" title="variable">inc</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpStore"><span class="id" title="constructor">Assembly.OpStore</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">_</span> <a class="idref" href="#Heap"><span class="id" title="constructor">Heap</span></a> ⇒ <a class="idref" href="#OpStoreHeap"><span class="id" title="constructor">OpStoreHeap</span></a> <span class="id" title="var">src0</span> <a class="idref" href="#no_inc:10"><span class="id" title="variable">no_inc</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpStore"><span class="id" title="constructor">Assembly.OpStore</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">_</span> <a class="idref" href="#AuxHeap"><span class="id" title="constructor">AuxHeap</span></a> ⇒ <a class="idref" href="#OpStoreAuxHeap"><span class="id" title="constructor">OpStoreAuxHeap</span></a> <span class="id" title="var">src0</span> <a class="idref" href="#no_inc:10"><span class="id" title="variable">no_inc</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpStoreInc"><span class="id" title="constructor">Assembly.OpStoreInc</span></a>  <span class="id" title="var">src0</span> <span class="id" title="var">_</span> <a class="idref" href="#Heap"><span class="id" title="constructor">Heap</span></a> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpStoreHeap"><span class="id" title="constructor">OpStoreHeap</span></a> <span class="id" title="var">src0</span> <a class="idref" href="#inc:11"><span class="id" title="variable">inc</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpStoreInc"><span class="id" title="constructor">Assembly.OpStoreInc</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">_</span> <a class="idref" href="#AuxHeap"><span class="id" title="constructor">AuxHeap</span></a> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpStoreAuxHeap"><span class="id" title="constructor">OpStoreAuxHeap</span></a> <span class="id" title="var">src0</span> <a class="idref" href="#inc:11"><span class="id" title="variable">inc</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpLoadPointer"><span class="id" title="constructor">Assembly.OpLoadPointer</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpLoadPtr"><span class="id" title="constructor">OpLoadPtr</span></a> <a class="idref" href="#no_inc:10"><span class="id" title="variable">no_inc</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpLoadPointerInc"><span class="id" title="constructor">Assembly.OpLoadPointerInc</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpLoadPtr"><span class="id" title="constructor">OpLoadPtr</span></a> <a class="idref" href="#inc:11"><span class="id" title="variable">inc</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpContractThis"><span class="id" title="constructor">Assembly.OpContractThis</span></a> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpContractThis"><span class="id" title="constructor">OpContractThis</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpContractCaller"><span class="id" title="constructor">Assembly.OpContractCaller</span></a> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpContractCaller"><span class="id" title="constructor">OpContractCaller</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpContractCodeAddress"><span class="id" title="constructor">Assembly.OpContractCodeAddress</span></a> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpContractCodeAddress"><span class="id" title="constructor">OpContractCodeAddress</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpVMMeta"><span class="id" title="constructor">Assembly.OpVMMeta</span></a> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpVMMeta"><span class="id" title="constructor">OpVMMeta</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpVMErgsLeft"><span class="id" title="constructor">Assembly.OpVMErgsLeft</span></a> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpVMErgsLeft"><span class="id" title="constructor">OpVMErgsLeft</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpVMSP"><span class="id" title="constructor">Assembly.OpVMSP</span></a> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpVMSp"><span class="id" title="constructor">OpVMSp</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpGetCapturedContext"><span class="id" title="constructor">Assembly.OpGetCapturedContext</span></a> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpGetCapturedContext"><span class="id" title="constructor">OpGetCapturedContext</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpSetContextReg"><span class="id" title="constructor">Assembly.OpSetContextReg</span></a> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpSetContextReg"><span class="id" title="constructor">OpSetContextReg</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*|&nbsp;Assembly.OpContextSetErgsPerPubdataByte&nbsp;_&nbsp;=>&nbsp;OpSetErgsPerPubdataByte*)</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpIncrementTxNumber"><span class="id" title="constructor">Assembly.OpIncrementTxNumber</span></a> ⇒ <a class="idref" href="#OpIncrementTxNumber"><span class="id" title="constructor">OpIncrementTxNumber</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpSLoad"><span class="id" title="constructor">Assembly.OpSLoad</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpSLoad"><span class="id" title="constructor">OpSLoad</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpSStore"><span class="id" title="constructor">Assembly.OpSStore</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpSStore"><span class="id" title="constructor">OpSStore</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpPrecompileCall"><span class="id" title="constructor">Assembly.OpPrecompileCall</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpPrecompileCall"><span class="id" title="constructor">OpPrecompileCall</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpEvent"><span class="id" title="constructor">Assembly.OpEvent</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">is_first</span> ⇒ <a class="idref" href="#OpEvent"><span class="id" title="constructor">OpEvent</span></a> <span class="id" title="var">is_first</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpToL1Message"><span class="id" title="constructor">Assembly.OpToL1Message</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">is_first</span> ⇒ <a class="idref" href="#OpToL1Message"><span class="id" title="constructor">OpToL1Message</span></a> <span class="id" title="var">is_first</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpAuxMutating"><span class="id" title="constructor">Assembly.OpAuxMutating</span></a> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpAuxMutating"><span class="id" title="constructor">OpAuxMutating</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpTransientStore"><span class="id" title="constructor">Assembly.OpTransientStore</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpTransientStore"><span class="id" title="constructor">OpTransientStore</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpTransientLoad"><span class="id" title="constructor">Assembly.OpTransientLoad</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpTransientLoad"><span class="id" title="constructor">OpTransientLoad</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpStaticWrite"><span class="id" title="constructor">Assembly.OpStaticWrite</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpStaticWrite"><span class="id" title="constructor">OpStaticWrite</span></a> <span class="id" title="var">src0</span> <a class="idref" href="#no_inc:10"><span class="id" title="variable">no_inc</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpStaticWriteInc"><span class="id" title="constructor">Assembly.OpStaticWriteInc</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpStaticWrite"><span class="id" title="constructor">OpStaticWrite</span></a> <span class="id" title="var">src0</span> <a class="idref" href="#inc:11"><span class="id" title="variable">inc</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpStaticRead"><span class="id" title="constructor">Assembly.OpStaticRead</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpStaticRead"><span class="id" title="constructor">OpStaticRead</span></a> <span class="id" title="var">src0</span> <a class="idref" href="#no_inc:10"><span class="id" title="variable">no_inc</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpStaticReadInc"><span class="id" title="constructor">Assembly.OpStaticReadInc</span></a> <span class="id" title="var">src0</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpStaticRead"><span class="id" title="constructor">OpStaticRead</span></a> <span class="id" title="var">src0</span> <a class="idref" href="#inc:11"><span class="id" title="variable">inc</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#OpDecommit"><span class="id" title="constructor">Assembly.OpDecommit</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#OpDecommit"><span class="id" title="constructor">OpDecommit</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
#[<span class="id" title="var">local</span>]<br/>
<span class="id" title="keyword">Definition</span> <a id="set_src0" class="idref" href="#set_src0"><span class="id" title="definition">set_src0</span></a> (<a id="src0:13" class="idref" href="#src0:13"><span class="id" title="binder">src0</span></a>: <a class="idref" href="#in_any"><span class="id" title="inductive">in_any</span></a>) : <a class="idref" href="#mach_instruction"><span class="id" title="record">mach_instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#mach_instruction"><span class="id" title="record">mach_instruction</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="ins:14" class="idref" href="#ins:14"><span class="id" title="binder">ins</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#src0:13"><span class="id" title="variable">src0</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#InReg"><span class="id" title="constructor">InReg</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">name</span>) ⇒ <a class="idref" href="#ins:14"><span class="id" title="variable">ins</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_src0"><span class="id" title="projection">op_src0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">name</span> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#InImm"><span class="id" title="constructor">InImm</span></a> (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <span class="id" title="var">val</span>) ⇒ <a class="idref" href="#ins:14"><span class="id" title="variable">ins</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_imm0"><span class="id" title="projection">op_imm0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">val</span> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#InStack"><span class="id" title="constructor">InStack</span></a> (<a class="idref" href="#StackInOnly"><span class="id" title="constructor">StackInOnly</span></a> (<a class="idref" href="#RelSpPop"><span class="id" title="constructor">RelSpPop</span></a> <span class="id" title="var">reg</span> <span class="id" title="var">ofs</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#InStack"><span class="id" title="constructor">InStack</span></a> (<a class="idref" href="#StackInAny"><span class="id" title="constructor">StackInAny</span></a> (<a class="idref" href="#Absolute"><span class="id" title="constructor">Absolute</span></a> <span class="id" title="var">reg</span> <span class="id" title="var">ofs</span>) )<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#InStack"><span class="id" title="constructor">InStack</span></a> (<a class="idref" href="#StackInAny"><span class="id" title="constructor">StackInAny</span></a> (<a class="idref" href="#RelSP"><span class="id" title="constructor">RelSP</span></a> <span class="id" title="var">reg</span> <span class="id" title="var">ofs</span>) )<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#InCode"><span class="id" title="constructor">InCode</span></a> (<a class="idref" href="#CodeAddr"><span class="id" title="constructor">CodeAddr</span></a> <span class="id" title="var">reg</span> <span class="id" title="var">ofs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#InConst"><span class="id" title="constructor">InConst</span></a> (<a class="idref" href="#ConstAddr"><span class="id" title="constructor">ConstAddr</span></a> <span class="id" title="var">reg</span> <span class="id" title="var">ofs</span>) ⇒ <a class="idref" href="#ins:14"><span class="id" title="variable">ins</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_src0"><span class="id" title="projection">op_src0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">reg</span> <span class="id" title="notation">|></span> <span class="id" title="notation"><|</span> <a class="idref" href="#op_imm0"><span class="id" title="projection">op_imm0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">ofs</span><span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
.<br/>

<br/>
#[<span class="id" title="var">local</span>]<br/>
<span class="id" title="keyword">Definition</span> <a id="set_src0_special" class="idref" href="#set_src0_special"><span class="id" title="definition">set_src0_special</span></a> (<a id="src0:16" class="idref" href="#src0:16"><span class="id" title="binder">src0</span></a>: <a class="idref" href="#in_regimm"><span class="id" title="inductive">in_regimm</span></a>) : <a class="idref" href="#mach_instruction"><span class="id" title="record">mach_instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#mach_instruction"><span class="id" title="record">mach_instruction</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="ins:17" class="idref" href="#ins:17"><span class="id" title="binder">ins</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#src0:16"><span class="id" title="variable">src0</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#RegImmR"><span class="id" title="constructor">RegImmR</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">name</span>) ⇒ <a class="idref" href="#ins:17"><span class="id" title="variable">ins</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_src0"><span class="id" title="projection">op_src0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">name</span> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#RegImmI"><span class="id" title="constructor">RegImmI</span></a> (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <span class="id" title="var">val</span>) ⇒ <a class="idref" href="#ins:17"><span class="id" title="variable">ins</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_imm0"><span class="id" title="projection">op_imm0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">val</span> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
.<br/>

<br/>
#[<span class="id" title="var">local</span>]<br/>
<span class="id" title="keyword">Definition</span> <a id="set_dst0" class="idref" href="#set_dst0"><span class="id" title="definition">set_dst0</span></a> (<a id="dst0:19" class="idref" href="#dst0:19"><span class="id" title="binder">dst0</span></a>: <a class="idref" href="#out_any"><span class="id" title="inductive">out_any</span></a>) : <a class="idref" href="#mach_instruction"><span class="id" title="record">mach_instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#mach_instruction"><span class="id" title="record">mach_instruction</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="ins:20" class="idref" href="#ins:20"><span class="id" title="binder">ins</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#dst0:19"><span class="id" title="variable">dst0</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OutReg"><span class="id" title="constructor">OutReg</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">name</span>) ⇒ <a class="idref" href="#ins:20"><span class="id" title="variable">ins</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_dst0"><span class="id" title="projection">op_dst0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">name</span> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OutStack"><span class="id" title="constructor">OutStack</span></a> (<a class="idref" href="#StackOutOnly"><span class="id" title="constructor">StackOutOnly</span></a> (<a class="idref" href="#RelSpPush"><span class="id" title="constructor">RelSpPush</span></a> <span class="id" title="var">reg</span> <span class="id" title="var">ofs</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OutStack"><span class="id" title="constructor">OutStack</span></a> (<a class="idref" href="#StackOutAny"><span class="id" title="constructor">StackOutAny</span></a> (<a class="idref" href="#Absolute"><span class="id" title="constructor">Absolute</span></a> <span class="id" title="var">reg</span> <span class="id" title="var">ofs</span>) )<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OutStack"><span class="id" title="constructor">OutStack</span></a> (<a class="idref" href="#StackOutAny"><span class="id" title="constructor">StackOutAny</span></a> (<a class="idref" href="#RelSP"><span class="id" title="constructor">RelSP</span></a> <span class="id" title="var">reg</span> <span class="id" title="var">ofs</span>) ) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ins:20"><span class="id" title="variable">ins</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_dst0"><span class="id" title="projection">op_dst0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">reg</span> <span class="id" title="notation">|></span> <span class="id" title="notation"><|</span> <a class="idref" href="#op_imm1"><span class="id" title="projection">op_imm1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">ofs</span><span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="AsmToMachConversion" class="idref" href="#AsmToMachConversion"><span class="id" title="section">AsmToMachConversion</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <span class="id" title="module">ssrfun</span>.<br/>

<br/>
</div>

<div class="doc"><p>The encoding of <span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span> to <span
class="inlinecode"><a class="idref" href="#mach_instruction"><span
class="id" title="record">mach_instruction</span></a></span> happens in
two stages:</p>
<ol type="1">
<li>Put the information in the fields of <span
class="inlinecode"><a class="idref" href="#mach_instruction"><span
class="id" title="record">mach_instruction</span></a></span> but keep
ignored fields uninitialized (equal to <span
class="inlinecode"><a class="idref" href="#None"><span
class="id" title="constructor">None</span></a></span>).</li>
<li>Flatten <span
class="inlinecode"><a class="idref" href="#mach_instruction"><span
class="id" title="record">mach_instruction</span></a></span>, erasing
difference between meaningful and ignored fields. Fields that were equal
to <span
class="inlinecode"><a class="idref" href="#None"><span
class="id" title="constructor">None</span></a></span> are assigned
default values: zero for immediates, <span
class="inlinecode"><a class="idref" href="#R0"><span
class="id" title="constructor">R0</span></a></span> for registers.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="asm_to_mach_opt" class="idref" href="#asm_to_mach_opt"><span class="id" title="definition">asm_to_mach_opt</span></a> (<a id="ins:22" class="idref" href="#ins:22"><span class="id" title="binder">ins</span></a>: <a class="idref" href="#predicated"><span class="id" title="record">predicated</span></a> <a class="idref" href="#asm_instruction"><span class="id" title="inductive">asm_instruction</span></a>) : <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (@<a class="idref" href="#mach_instruction"><span class="id" title="record">mach_instruction</span></a> (<a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#reg_name"><span class="id" title="inductive">GPR.reg_name</span></a>) (<a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a>) ):=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#ins:22"><span class="id" title="variable">ins</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Ins"><span class="id" title="constructor">Ins</span></a> <span class="id" title="var">ins</span> <a class="idref" href="#pred"><span class="id" title="definition">pred</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="mk:30" class="idref" href="#mk:30"><span class="id" title="binder">mk</span></a> <a id="src0:24" class="idref" href="#src0:24"><span class="id" title="binder">src0</span></a> <a id="src1:25" class="idref" href="#src1:25"><span class="id" title="binder">src1</span></a> <a id="dst0:26" class="idref" href="#dst0:26"><span class="id" title="binder">dst0</span></a> <a id="dst1:27" class="idref" href="#dst1:27"><span class="id" title="binder">dst1</span></a> <a id="imm0:28" class="idref" href="#imm0:28"><span class="id" title="binder">imm0</span></a> <a id="imm1:29" class="idref" href="#imm1:29"><span class="id" title="binder">imm1</span></a> := <a class="idref" href="#mk_ins"><span class="id" title="constructor">mk_ins</span></a> (<a class="idref" href="#opcode_of"><span class="id" title="definition">opcode_of</span></a> <a class="idref" href="#ins:22"><span class="id" title="variable">ins</span></a>) <span class="id" title="var">pred</span> <a class="idref" href="#src0:24"><span class="id" title="variable">src0</span></a> <a class="idref" href="#src1:25"><span class="id" title="variable">src1</span></a> <a class="idref" href="#dst0:26"><span class="id" title="variable">dst0</span></a> <a class="idref" href="#dst1:27"><span class="id" title="variable">dst1</span></a> <a class="idref" href="#imm0:28"><span class="id" title="variable">imm0</span></a> <a class="idref" href="#imm1:29"><span class="id" title="variable">imm1</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="template:31" class="idref" href="#template:31"><span class="id" title="binder">template</span></a> : <a class="idref" href="#mach_instruction"><span class="id" title="record">mach_instruction</span></a> := <a class="idref" href="#mk:30"><span class="id" title="variable">mk</span></a> <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="#None"><span class="id" title="constructor">None</span></a>  <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#ins:22"><span class="id" title="variable">ins</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpInvalid"><span class="id" title="constructor">Assembly.OpInvalid</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpNoOp"><span class="id" title="constructor">Assembly.OpNoOp</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpPanic"><span class="id" title="constructor">Assembly.OpPanic</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpIncrementTxNumber"><span class="id" title="constructor">Assembly.OpIncrementTxNumber</span></a> ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#template:31"><span class="id" title="variable">template</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpSetContextReg"><span class="id" title="constructor">Assembly.OpSetContextReg</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#template:31"><span class="id" title="variable">template</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_src0"><span class="id" title="projection">op_src0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">src0</span> <span class="id" title="notation">|></span> )<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpSpAdd"><span class="id" title="constructor">Assembly.OpSpAdd</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">reg</span>) (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <span class="id" title="var">ofs</span>) ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#template:31"><span class="id" title="variable">template</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_dst0"><span class="id" title="projection">op_dst0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">reg</span> <span class="id" title="notation">|></span> <span class="id" title="notation"><|</span> <a class="idref" href="#op_imm1"><span class="id" title="projection">op_imm1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">ofs</span> <span class="id" title="notation">|></span> )<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpSpSub"><span class="id" title="constructor">Assembly.OpSpSub</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">reg</span>) (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <span class="id" title="var">ofs</span>) ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#template:31"><span class="id" title="variable">template</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_src0"><span class="id" title="projection">op_src0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">reg</span> <span class="id" title="notation">|></span> <span class="id" title="notation"><|</span> <a class="idref" href="#op_imm0"><span class="id" title="projection">op_imm0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">ofs</span> <span class="id" title="notation">|></span> )<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpJump"><span class="id" title="constructor">Assembly.OpJump</span></a> <span class="id" title="var">dest</span> <span class="id" title="var">ret_addr</span> ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#set_src0"><span class="id" title="definition">set_src0</span></a> <span class="id" title="var">dest</span> (<a class="idref" href="#set_dst0"><span class="id" title="definition">set_dst0</span></a> <span class="id" title="var">ret_addr</span> <a class="idref" href="#template:31"><span class="id" title="variable">template</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpAdd"><span class="id" title="constructor">Assembly.OpAdd</span></a> <span class="id" title="var">src0</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src1</span>) <span class="id" title="var">dst0</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpOr"><span class="id" title="constructor">Assembly.OpOr</span></a> <span class="id" title="var">src0</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src1</span>) <span class="id" title="var">dst0</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpXor"><span class="id" title="constructor">Assembly.OpXor</span></a> <span class="id" title="var">src0</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src1</span>) <span class="id" title="var">dst0</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpAnd"><span class="id" title="constructor">Assembly.OpAnd</span></a> <span class="id" title="var">src0</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src1</span>) <span class="id" title="var">dst0</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpSub"><span class="id" title="constructor">Assembly.OpSub</span></a> <span class="id" title="var">src0</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src1</span>) <span class="id" title="var">dst0</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpShl"><span class="id" title="constructor">Assembly.OpShl</span></a> <span class="id" title="var">src0</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src1</span>) <span class="id" title="var">dst0</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpShr"><span class="id" title="constructor">Assembly.OpShr</span></a> <span class="id" title="var">src0</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src1</span>) <span class="id" title="var">dst0</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpRol"><span class="id" title="constructor">Assembly.OpRol</span></a> <span class="id" title="var">src0</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src1</span>) <span class="id" title="var">dst0</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpRor"><span class="id" title="constructor">Assembly.OpRor</span></a> <span class="id" title="var">src0</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src1</span>) <span class="id" title="var">dst0</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpPtrAdd"><span class="id" title="constructor">Assembly.OpPtrAdd</span></a> <span class="id" title="var">src0</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src1</span>) <span class="id" title="var">dst0</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpPtrSub"><span class="id" title="constructor">Assembly.OpPtrSub</span></a> <span class="id" title="var">src0</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src1</span>) <span class="id" title="var">dst0</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpPtrShrink"><span class="id" title="constructor">Assembly.OpPtrShrink</span></a> <span class="id" title="var">src0</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src1</span>) <span class="id" title="var">dst0</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpPtrPack"><span class="id" title="constructor">Assembly.OpPtrPack</span></a> <span class="id" title="var">src0</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src1</span>) <span class="id" title="var">dst0</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#set_src0"><span class="id" title="definition">set_src0</span></a> <span class="id" title="var">src0</span> (<a class="idref" href="#set_dst0"><span class="id" title="definition">set_dst0</span></a> <span class="id" title="var">dst0</span> (<a class="idref" href="#template:31"><span class="id" title="variable">template</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_src1"><span class="id" title="projection">op_src1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">src1</span> <span class="id" title="notation">|></span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpMul"><span class="id" title="constructor">Assembly.OpMul</span></a> <span class="id" title="var">src0</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src1</span>) <span class="id" title="var">dst0</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">dst1</span>) <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpDiv"><span class="id" title="constructor">Assembly.OpDiv</span></a> <span class="id" title="var">src0</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src1</span>) <span class="id" title="var">dst0</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">dst1</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#set_src0"><span class="id" title="definition">set_src0</span></a> <span class="id" title="var">src0</span> (<a class="idref" href="#set_dst0"><span class="id" title="definition">set_dst0</span></a> <span class="id" title="var">dst0</span> (<a class="idref" href="#template:31"><span class="id" title="variable">template</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_src1"><span class="id" title="projection">op_src1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">src1</span> <span class="id" title="notation">|></span> <span class="id" title="notation"><|</span> <a class="idref" href="#op_dst1"><span class="id" title="projection">op_dst1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">dst1</span> <span class="id" title="notation">|></span>)))<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpNearCall"><span class="id" title="constructor">Assembly.OpNearCall</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">arg</span>) (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <span class="id" title="var">dest</span>) (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <span class="id" title="var">handler</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> ({|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#op_code"><span class="id" title="projection">op_code</span></a> := <a class="idref" href="#opcode_of"><span class="id" title="definition">opcode_of</span></a> <a class="idref" href="#ins:22"><span class="id" title="variable">ins</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#op_predicate"><span class="id" title="projection">op_predicate</span></a> := <span class="id" title="var">pred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#op_src0"><span class="id" title="projection">op_src0</span></a> := <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">arg</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#op_src1"><span class="id" title="projection">op_src1</span></a> := <a class="idref" href="#None"><span class="id" title="constructor">None</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#op_dst0"><span class="id" title="projection">op_dst0</span></a> := <a class="idref" href="#None"><span class="id" title="constructor">None</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#op_dst1"><span class="id" title="projection">op_dst1</span></a> := <a class="idref" href="#None"><span class="id" title="constructor">None</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#op_imm0"><span class="id" title="projection">op_imm0</span></a> := <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">dest</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#op_imm1"><span class="id" title="projection">op_imm1</span></a> := <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">handler</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpNearRetTo"><span class="id" title="constructor">Assembly.OpNearRetTo</span></a> (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <span class="id" title="var">dest</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpNearPanicTo"><span class="id" title="constructor">Assembly.OpNearPanicTo</span></a> (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <span class="id" title="var">dest</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpNearRevertTo"><span class="id" title="constructor">Assembly.OpNearRevertTo</span></a> (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <span class="id" title="var">dest</span>) ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#template:31"><span class="id" title="variable">template</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_imm0"><span class="id" title="projection">op_imm0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">dest</span> <span class="id" title="notation">|></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpRet"><span class="id" title="constructor">Assembly.OpRet</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">args</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpRevert"><span class="id" title="constructor">Assembly.OpRevert</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">args</span>) ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#template:31"><span class="id" title="variable">template</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_src0"><span class="id" title="projection">op_src0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">args</span> <span class="id" title="notation">|></span>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpSStore"><span class="id" title="constructor">Assembly.OpSStore</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src0</span>) (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpEvent"><span class="id" title="constructor">Assembly.OpEvent</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src0</span>) (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src1</span>) <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpTransientStore"><span class="id" title="constructor">Assembly.OpTransientStore</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src0</span>) (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpToL1Message"><span class="id" title="constructor">Assembly.OpToL1Message</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src0</span>) (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src1</span>) <span class="id" title="var">_</span>  ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#template:31"><span class="id" title="variable">template</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_src0"><span class="id" title="projection">op_src0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">src0</span> <span class="id" title="notation">|></span> <span class="id" title="notation"><|</span> <a class="idref" href="#op_src1"><span class="id" title="projection">op_src1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">src1</span> <span class="id" title="notation">|></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpSLoad"><span class="id" title="constructor">Assembly.OpSLoad</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src0</span>) (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">dst0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpTransientLoad"><span class="id" title="constructor">Assembly.OpTransientLoad</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src0</span>) (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">dst0</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#template:31"><span class="id" title="variable">template</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_src0"><span class="id" title="projection">op_src0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">src0</span> <span class="id" title="notation">|></span> <span class="id" title="notation"><|</span> <a class="idref" href="#op_dst0"><span class="id" title="projection">op_dst0</span></a><span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">dst0</span><span class="id" title="notation">|></span>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpContractThis"><span class="id" title="constructor">Assembly.OpContractThis</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">dst0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpContractCaller"><span class="id" title="constructor">Assembly.OpContractCaller</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">dst0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpContractCodeAddress"><span class="id" title="constructor">Assembly.OpContractCodeAddress</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">dst0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpVMMeta"><span class="id" title="constructor">Assembly.OpVMMeta</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">dst0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpVMErgsLeft"><span class="id" title="constructor">Assembly.OpVMErgsLeft</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">dst0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpVMSP"><span class="id" title="constructor">Assembly.OpVMSP</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">dst0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpGetCapturedContext"><span class="id" title="constructor">Assembly.OpGetCapturedContext</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">dst0</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#template:31"><span class="id" title="variable">template</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_dst0"><span class="id" title="projection">op_dst0</span></a><span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">dst0</span><span class="id" title="notation">|></span>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpPrecompileCall"><span class="id" title="constructor">Assembly.OpPrecompileCall</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src0</span>) (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src1</span>) (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">dst0</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#template:31"><span class="id" title="variable">template</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_dst0"><span class="id" title="projection">op_dst0</span></a><span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">dst0</span><span class="id" title="notation">|></span>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpFarCall"><span class="id" title="constructor">Assembly.OpFarCall</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">params</span>) (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">dest</span>) (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <span class="id" title="var">handler</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpMimicCall"><span class="id" title="constructor">Assembly.OpMimicCall</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">params</span>) (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">dest</span>) (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <span class="id" title="var">handler</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpDelegateCall"><span class="id" title="constructor">Assembly.OpDelegateCall</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">params</span>) (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">dest</span>) (<a class="idref" href="#Imm"><span class="id" title="constructor">Imm</span></a> <span class="id" title="var">handler</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#template:31"><span class="id" title="variable">template</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#op_src0"><span class="id" title="projection">op_src0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">params</span> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#op_src1"><span class="id" title="projection">op_src1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">dest</span> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#op_imm0"><span class="id" title="projection">op_imm0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">handler</span> <span class="id" title="notation">|></span> )<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpLoad"><span class="id" title="constructor">Assembly.OpLoad</span></a> <span class="id" title="var">ptr</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">res</span>) <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpStaticRead"><span class="id" title="constructor">Assembly.OpStaticRead</span></a> <span class="id" title="var">ptr</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">res</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#set_src0_special"><span class="id" title="definition">set_src0_special</span></a> <span class="id" title="var">ptr</span> (<a class="idref" href="#template:31"><span class="id" title="variable">template</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_dst0"><span class="id" title="projection">op_dst0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">res</span><span class="id" title="notation">|></span> ))<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpStore"><span class="id" title="constructor">Assembly.OpStore</span></a> <span class="id" title="var">ptr</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">val</span>) <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpStaticWrite"><span class="id" title="constructor">Assembly.OpStaticWrite</span></a> <span class="id" title="var">ptr</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">val</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#set_src0_special"><span class="id" title="definition">set_src0_special</span></a> <span class="id" title="var">ptr</span> (<a class="idref" href="#template:31"><span class="id" title="variable">template</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_src1"><span class="id" title="projection">op_src1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">val</span><span class="id" title="notation">|></span> ))<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpLoadPointer"><span class="id" title="constructor">Assembly.OpLoadPointer</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">name</span>) (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">res</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#template:31"><span class="id" title="variable">template</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_src0"><span class="id" title="projection">op_src0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">name</span> <span class="id" title="notation">|></span> <span class="id" title="notation"><|</span> <a class="idref" href="#op_dst0"><span class="id" title="projection">op_dst0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">res</span><span class="id" title="notation">|></span> )<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpLoadInc"><span class="id" title="constructor">Assembly.OpLoadInc</span></a> <span class="id" title="var">ptr</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">res</span>) <span class="id" title="var">_</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">inc_ptr</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#set_src0_special"><span class="id" title="definition">set_src0_special</span></a> <span class="id" title="var">ptr</span> <a class="idref" href="#template:31"><span class="id" title="variable">template</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_dst0"><span class="id" title="projection">op_dst0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">res</span><span class="id" title="notation">|></span> <span class="id" title="notation"><|</span> <a class="idref" href="#op_dst1"><span class="id" title="projection">op_dst1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">inc_ptr</span> <span class="id" title="notation">|></span> )<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpStaticReadInc"><span class="id" title="constructor">Assembly.OpStaticReadInc</span></a> <span class="id" title="var">ptr</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">res</span>) (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">inc_ptr</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#set_src0_special"><span class="id" title="definition">set_src0_special</span></a> <span class="id" title="var">ptr</span> (<a class="idref" href="#template:31"><span class="id" title="variable">template</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_dst0"><span class="id" title="projection">op_dst0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">res</span><span class="id" title="notation">|></span> <span class="id" title="notation"><|</span> <a class="idref" href="#op_dst1"><span class="id" title="projection">op_dst1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">inc_ptr</span> <span class="id" title="notation">|></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpStoreInc"><span class="id" title="constructor">Assembly.OpStoreInc</span></a> <span class="id" title="var">ptr</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">val</span>) <span class="id" title="var">_</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">inc_ptr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpStaticWriteInc"><span class="id" title="constructor">Assembly.OpStaticWriteInc</span></a> <span class="id" title="var">ptr</span> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">val</span>) (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">inc_ptr</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#set_src0_special"><span class="id" title="definition">set_src0_special</span></a> <span class="id" title="var">ptr</span> (<a class="idref" href="#template:31"><span class="id" title="variable">template</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_src1"><span class="id" title="projection">op_src1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">val</span> <span class="id" title="notation">|></span> <span class="id" title="notation"><|</span> <a class="idref" href="#op_dst1"><span class="id" title="projection">op_dst1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">inc_ptr</span> <span class="id" title="notation">|></span>))<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpLoadPointerInc"><span class="id" title="constructor">Assembly.OpLoadPointerInc</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">ptr</span>) (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">res</span>) (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">inc_ptr</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#template:31"><span class="id" title="variable">template</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_src0"><span class="id" title="projection">op_src0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">ptr</span> <span class="id" title="notation">|></span> <span class="id" title="notation"><|</span> <a class="idref" href="#op_dst0"><span class="id" title="projection">op_dst0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">res</span><span class="id" title="notation">|></span> <span class="id" title="notation"><|</span> <a class="idref" href="#op_dst1"><span class="id" title="projection">op_dst1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">inc_ptr</span> <span class="id" title="notation">|></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpDecommit"><span class="id" title="constructor">Assembly.OpDecommit</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src0</span>) (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">src1</span>) (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">dst0</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#template:31"><span class="id" title="variable">template</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_src0"><span class="id" title="projection">op_src0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">src0</span> <span class="id" title="notation">|></span>  <span class="id" title="notation"><|</span> <a class="idref" href="#op_src1"><span class="id" title="projection">op_src1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">src1</span> <span class="id" title="notation">|></span> <span class="id" title="notation"><|</span> <a class="idref" href="#op_dst1"><span class="id" title="projection">op_dst1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">dst0</span> <span class="id" title="notation">|></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpAuxMutating"><span class="id" title="constructor">Assembly.OpAuxMutating</span></a> (<a class="idref" href="#Reg"><span class="id" title="constructor">Reg</span></a> <span class="id" title="var">ptr</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#template:31"><span class="id" title="variable">template</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#op_src0"><span class="id" title="projection">op_src0</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">ptr</span> <span class="id" title="notation">|></span> )<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="mach_flatten" class="idref" href="#mach_flatten"><span class="id" title="definition">mach_flatten</span></a> (<a id="i:33" class="idref" href="#i:33"><span class="id" title="binder">i</span></a>:@<a class="idref" href="#mach_instruction"><span class="id" title="record">mach_instruction</span></a> (<a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#reg_name"><span class="id" title="inductive">GPR.reg_name</span></a>) (<a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a>)) : @<a class="idref" href="#mach_instruction"><span class="id" title="record">mach_instruction</span></a> <a class="idref" href="#reg_name"><span class="id" title="inductive">GPR.reg_name</span></a> <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="or_r0:34" class="idref" href="#or_r0:34"><span class="id" title="binder">or_r0</span></a> := <a class="idref" href="#Option.default"><span class="id" title="definition">Option.default</span></a> <a class="idref" href="#R0"><span class="id" title="constructor">GPR.R0</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="or_zero:35" class="idref" href="#or_zero:35"><span class="id" title="binder">or_zero</span></a> := <a class="idref" href="#Option.default"><span class="id" title="definition">Option.default</span></a> <a class="idref" href="#zero16"><span class="id" title="definition">zero16</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#i:33"><span class="id" title="variable">i</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_ins"><span class="id" title="constructor">mk_ins</span></a> <a class="idref" href="#op_code"><span class="id" title="projection">op_code</span></a> <a class="idref" href="#op_predicate"><span class="id" title="projection">op_predicate</span></a> <a class="idref" href="#op_src0"><span class="id" title="projection">op_src0</span></a> <a class="idref" href="#op_src1"><span class="id" title="projection">op_src1</span></a> <a class="idref" href="#op_dst0"><span class="id" title="projection">op_dst0</span></a> <a class="idref" href="#op_dst1"><span class="id" title="projection">op_dst1</span></a> <a class="idref" href="#op_imm0"><span class="id" title="projection">op_imm0</span></a> <a class="idref" href="#op_imm1"><span class="id" title="projection">op_imm1</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mk_ins"><span class="id" title="constructor">mk_ins</span></a> <span class="id" title="var">op_code</span> <span class="id" title="var">op_predicate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#or_r0:34"><span class="id" title="variable">or_r0</span></a> <span class="id" title="var">op_src0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#or_r0:34"><span class="id" title="variable">or_r0</span></a> <span class="id" title="var">op_src1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#or_r0:34"><span class="id" title="variable">or_r0</span></a> <span class="id" title="var">op_dst0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#or_r0:34"><span class="id" title="variable">or_r0</span></a> <span class="id" title="var">op_dst1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#or_zero:35"><span class="id" title="variable">or_zero</span></a> <span class="id" title="var">op_imm0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#or_zero:35"><span class="id" title="variable">or_zero</span></a> <span class="id" title="var">op_imm1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="asm_to_mach" class="idref" href="#asm_to_mach"><span class="id" title="definition">asm_to_mach</span></a> (<a id="asm_ins:37" class="idref" href="#asm_ins:37"><span class="id" title="binder">asm_ins</span></a>: <a class="idref" href="#predicated"><span class="id" title="record">predicated</span></a> <a class="idref" href="#asm_instruction"><span class="id" title="inductive">asm_instruction</span></a>) : <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#mach_instruction"><span class="id" title="record">mach_instruction</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="#option_map"><span class="id" title="definition">option_map</span></a> <a class="idref" href="#mach_flatten"><span class="id" title="definition">mach_flatten</span></a> (<a class="idref" href="#asm_to_mach_opt"><span class="id" title="definition">asm_to_mach_opt</span></a> <a class="idref" href="#asm_ins:37"><span class="id" title="variable">asm_ins</span></a>).<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#AsmToMachConversion"><span class="id" title="section">AsmToMachConversion</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.Ergs</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Common</span></a> <a class="idref" href="#"><span class="id" title="library">isa.Assembly</span></a> <a class="idref" href="#"><span class="id" title="library">TransientMemory</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Assembly</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">ZArith</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Ergs" class="idref" href="#Ergs"><span class="id" title="section">Ergs</span></a>.<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z_scope</span>.<br/>

<br/>
</div>

<div class="doc"><h1 id="ergs">Ergs</h1>
<p><strong>Ergs</strong> is the resource spent on executing actions in
EraVM.</p>
<p>The most common action consuming ergs is executing an instruction.
Instructions have a fixed <span
class="inlinecode"><a class="idref" href="#base_cost"><span
class="id" title="definition">base_cost</span></a></span>, failure to
pay this cost results in panic.</p>
<p>In EraVM, the instructions are <span
class="inlinecode"><a class="idref" href="#predicated"><span
class="id" title="record">predicated</span></a></span>. If an
instruction is not executed because of mismatch between their predicate
<span
class="inlinecode"><a class="idref" href="#ins_cond"><span
class="id" title="projection">ins_cond</span></a></span> with the
current <span
class="inlinecode"><a class="idref" href="#gs_flags"><span
class="id" title="projection">gs_flags</span></a></span>, its base cost
is still paid. Therefore, it is cheaper to jump over expensive
instructions like <span
class="inlinecode"><a class="idref" href="#OpFarCall"><span
class="id" title="constructor">OpFarCall</span></a></span> than to
predicate them so that they are not executed.</p>
<p>Additionally, actions like decommitting code for execution, accessing
contract storage, or growing memory bounds, also cost ergs.</p>
<p>Internally, ergs are 32-bit unsigned numbers.</p>
</div>
<div class="code">
<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="ergs_bits" class="idref" href="#ergs_bits"><span class="id" title="definition">ergs_bits</span></a> := 32%<span class="id" title="var">nat</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="ergs" class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a> := <span class="id" title="definition">BITS</span> <a class="idref" href="#ergs_bits"><span class="id" title="definition">ergs_bits</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a id="ergs_of" class="idref" href="#ergs_of"><span class="id" title="definition">ergs_of</span></a> : <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a> := <span class="id" title="definition">fromZ</span>.<br/>

<br/>
</div>

<div class="doc"><h2 id="ergs-and-callstack">Ergs and callstack</h2>
<p>Every frame in <span
class="inlinecode"><a class="idref" href="#callstack"><span
class="id" title="inductive">callstack</span></a></span>, whether
external or internal, keeps its associated ergs in the field <span
class="inlinecode"><a class="idref" href="#cf_ergs_remaining"><span
class="id" title="projection">cf_ergs_remaining</span></a></span>.
Spending ergs decreases this value <span
class="inlinecode"><a class="idref" href="#cf_ergs_remaining"><span
class="id" title="projection">cf_ergs_remaining</span></a></span>.</p>
<h3 id="calls">Calls</h3>
<p>Calling functions/contracts requires passing ergs to the new calling
frame, so that the callee’s code would be able to operate and spend ergs
(see e.g. <span
class="inlinecode"><a class="idref" href="#step_nearcall"><span
class="id" title="inductive">step_nearcall</span></a></span>).</p>
<p>For far calls, it is not possible to pass more than <span
class="inlinecode"><a class="idref" href="#max_passable"><span
class="id" title="definition">max_passable</span></a></span> ergs
(currently 63/64 of ergs available in current frame). For near calls,
passing 0 ergs leads to passing all ergs in the current frame.</p>
<h3 id="returns">Returns</h3>
<p>If a function returns without panic, the remaining ergs are returned
to its parent frame i.e. added to the parent frame’s <span
class="inlinecode"><a class="idref" href="#cf_ergs_remaining"><span
class="id" title="projection">cf_ergs_remaining</span></a></span>.</p>
<p>If a function panics, all its ergs are burned (see <span
class="inlinecode"><span class="id"
title="var">sem.Panic.step_panic</span></span>). Panic does not burn
ergs of parent frames.</p>
<p>The following return instructions lead to returning remaining ergs to
the caller:</p>
<ul>
<li><span class="inlinecode"><span class="id"
title="var">OpNearRet</span></span></li>
<li><span
class="inlinecode"><a class="idref" href="#OpNearRetTo"><span
class="id" title="constructor">OpNearRetTo</span></a></span></li>
<li><span
class="inlinecode"><a class="idref" href="#OpRet"><span
class="id" title="constructor">OpRet</span></a></span></li>
<li><span
class="inlinecode"><a class="idref" href="#OpRevert"><span
class="id" title="constructor">OpRevert</span></a></span></li>
<li><span class="inlinecode"><span class="id"
title="var">OpRevertTo</span></span></li>
<li><span
class="inlinecode"><a class="idref" href="#OpNearPanicTo"><span
class="id" title="constructor">OpNearPanicTo</span></a></span></li>
</ul>
<h2 id="actions-consuming-ergs">Actions consuming ergs</h2>
<p>Each instruction has a fixed based cost that gets deducted before
executing it (see <span
class="inlinecode"><a class="idref" href="#base_cost"><span
class="id" title="definition">base_cost</span></a></span>).</p>
<p>Additionally, the following actions lead to spending ergs:</p>
<ol type="1">
<li>Decommitting contract code. Performing far call to a contract which
was not called during the construction of the current block costs ergs
per each word of contract code. See <span
class="inlinecode"><a class="idref" href="#Decommitter"><span
class="id" title="section">Decommitter</span></a></span>, <span
class="inlinecode"><span class="id"
title="var">FarCall</span></span>.</li>
<li>TODO Accessing storage</li>
<li>Memory growth. Data pages holding heap variants are bounded, and
only accesses to addresses within these bounds are free. Reading or
writing to these pages outside bounds forces the <strong>memory
growth</strong> with bound adjustment. The number of bytes by which the
bounded area has grown has to be paid; see <span
class="inlinecode"><span class="id"
title="var">grow_and_pay</span></span>.</li>
<li>Passing messages to L1 by <span
class="inlinecode"><a class="idref" href="#OpToL1Message"><span
class="id" title="constructor">OpToL1Message</span></a></span>.</li>
</ol>
<h2 id="burning-ergs">Burning ergs</h2>
<p>Burning ergs refers to a situation of panic, when the topmost <span
class="inlinecode"><a class="idref" href="#callstack"><span
class="id" title="inductive">callstack</span></a></span> frame is
destroyed with its allocated ergs. The general rule is: if some
invariant of execution breaks, VM panics, burning all ergs in the
current frame. This is a fail-fast behavior in case of irrecoverable
errors. Some examples are:</p>
<ul>
<li>using an integer value where pointer value is expected</li>
<li>executing kernel-only instruction in user mode</li>
<li>call stack overflow</li>
</ul>
<p>Some situations that provoke panic are:</p>
<ul>
<li>having not enough ergs to pay, e.g. for memory growth;</li>
<li>attempting to execute an instruction with an invalid encoding;</li>
<li>attempting to execute kernel-only instruction in user mode.</li>
</ul>
<p>See section <span
class="inlinecode"><a class="idref" href="#Panics"><span
class="id" title="section">Panics</span></a></span> for the full
description.</p>
<h2 id="parameters">Parameters</h2>
<p>The following definitions are used to derive the costs of
instructions and other actions.</p>
</div>
<div class="code">
<br/>

<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="VM_CYCLE_COST_IN_ERGS" class="idref" href="#VM_CYCLE_COST_IN_ERGS"><span class="id" title="definition">VM_CYCLE_COST_IN_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 4.<br/>
<span class="id" title="keyword">Definition</span> <a id="RAM_PERMUTATION_COST_IN_ERGS" class="idref" href="#RAM_PERMUTATION_COST_IN_ERGS"><span class="id" title="definition">RAM_PERMUTATION_COST_IN_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 1.<br/>
<span class="id" title="keyword">Definition</span> <a id="CODE_DECOMMITMENT_COST_PER_WORD_IN_ERGS" class="idref" href="#CODE_DECOMMITMENT_COST_PER_WORD_IN_ERGS"><span class="id" title="definition">CODE_DECOMMITMENT_COST_PER_WORD_IN_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 4.<br/>
<span class="id" title="keyword">Definition</span> <a id="STORAGE_APPLICATION_COST_IN_ERGS" class="idref" href="#STORAGE_APPLICATION_COST_IN_ERGS"><span class="id" title="definition">STORAGE_APPLICATION_COST_IN_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 678.<br/>
<span class="id" title="keyword">Definition</span> <a id="CODE_DECOMMITTER_SORTER_COST_IN_ERGS" class="idref" href="#CODE_DECOMMITTER_SORTER_COST_IN_ERGS"><span class="id" title="definition">CODE_DECOMMITTER_SORTER_COST_IN_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 1.<br/>
<span class="id" title="keyword">Definition</span> <a id="LOG_DEMUXER_COST_IN_ERGS" class="idref" href="#LOG_DEMUXER_COST_IN_ERGS"><span class="id" title="definition">LOG_DEMUXER_COST_IN_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 1.<br/>
<span class="id" title="keyword">Definition</span> <a id="STORAGE_SORTER_COST_IN_ERGS" class="idref" href="#STORAGE_SORTER_COST_IN_ERGS"><span class="id" title="definition">STORAGE_SORTER_COST_IN_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 2.<br/>
<span class="id" title="keyword">Definition</span> <a id="EVENTS_OR_L1_MESSAGES_SORTER_COST_IN_ERGS" class="idref" href="#EVENTS_OR_L1_MESSAGES_SORTER_COST_IN_ERGS"><span class="id" title="definition">EVENTS_OR_L1_MESSAGES_SORTER_COST_IN_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 1.<br/>
<span class="id" title="keyword">Definition</span> <a id="INITIAL_WRITES_PUBDATA_HASHER_COST_IN_ERGS" class="idref" href="#INITIAL_WRITES_PUBDATA_HASHER_COST_IN_ERGS"><span class="id" title="definition">INITIAL_WRITES_PUBDATA_HASHER_COST_IN_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 18.<br/>
<span class="id" title="keyword">Definition</span> <a id="REPEATED_WRITES_PUBDATA_HASHER_COST_IN_ERGS" class="idref" href="#REPEATED_WRITES_PUBDATA_HASHER_COST_IN_ERGS"><span class="id" title="definition">REPEATED_WRITES_PUBDATA_HASHER_COST_IN_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 11.<br/>
<span class="id" title="keyword">Definition</span> <a id="CODE_DECOMMITMENT_SORTER_COST_IN_ERGS" class="idref" href="#CODE_DECOMMITMENT_SORTER_COST_IN_ERGS"><span class="id" title="definition">CODE_DECOMMITMENT_SORTER_COST_IN_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 1.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="L1_MESSAGE_MIN_COST_IN_ERGS" class="idref" href="#L1_MESSAGE_MIN_COST_IN_ERGS"><span class="id" title="definition">L1_MESSAGE_MIN_COST_IN_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 156250.<br/>
<span class="id" title="keyword">Definition</span> <a id="INITIAL_WRITES_PUBDATA_HASHER_MIN_COST_IN_ERGS" class="idref" href="#INITIAL_WRITES_PUBDATA_HASHER_MIN_COST_IN_ERGS"><span class="id" title="definition">INITIAL_WRITES_PUBDATA_HASHER_MIN_COST_IN_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 0.<br/>
<span class="id" title="keyword">Definition</span> <a id="REPEATED_WRITES_PUBDATA_HASHER_MIN_COST_IN_ERGS" class="idref" href="#REPEATED_WRITES_PUBDATA_HASHER_MIN_COST_IN_ERGS"><span class="id" title="definition">REPEATED_WRITES_PUBDATA_HASHER_MIN_COST_IN_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 0.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="STORAGE_WRITE_HASHER_MIN_COST_IN_ERGS" class="idref" href="#STORAGE_WRITE_HASHER_MIN_COST_IN_ERGS"><span class="id" title="definition">STORAGE_WRITE_HASHER_MIN_COST_IN_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 0.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="KECCAK256_CIRCUIT_COST_IN_ERGS" class="idref" href="#KECCAK256_CIRCUIT_COST_IN_ERGS"><span class="id" title="definition">KECCAK256_CIRCUIT_COST_IN_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 40.<br/>
<span class="id" title="keyword">Definition</span> <a id="SHA256_CIRCUIT_COST_IN_ERGS" class="idref" href="#SHA256_CIRCUIT_COST_IN_ERGS"><span class="id" title="definition">SHA256_CIRCUIT_COST_IN_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 7.<br/>
<span class="id" title="keyword">Definition</span> <a id="ECRECOVER_CIRCUIT_COST_IN_ERGS" class="idref" href="#ECRECOVER_CIRCUIT_COST_IN_ERGS"><span class="id" title="definition">ECRECOVER_CIRCUIT_COST_IN_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 1112.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="MAX_TX_ERGS_LIMIT" class="idref" href="#MAX_TX_ERGS_LIMIT"><span class="id" title="definition">MAX_TX_ERGS_LIMIT</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 80000000.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="VM_INITIAL_FRAME_ERGS" class="idref" href="#VM_INITIAL_FRAME_ERGS"><span class="id" title="definition">VM_INITIAL_FRAME_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := <a class="idref" href="#unsigned_max"><span class="id" title="definition">unsigned_max</span></a> 32.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="EVM_SIMULATOR_STIPEND" class="idref" href="#EVM_SIMULATOR_STIPEND"><span class="id" title="definition">EVM_SIMULATOR_STIPEND</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 2<a class="idref" href="#14ef112b66e341f773bd1e9d05816f43"><span class="id" title="notation">^</span></a>30.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="ERGS_PER_CIRCUIT" class="idref" href="#ERGS_PER_CIRCUIT"><span class="id" title="definition">ERGS_PER_CIRCUIT</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 80000.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="INVALID_OPCODE_ERGS" class="idref" href="#INVALID_OPCODE_ERGS"><span class="id" title="definition">INVALID_OPCODE_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := <a class="idref" href="#unsigned_max"><span class="id" title="definition">unsigned_max</span></a> 32.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="RICH_ADDRESSING_OPCODE_ERGS" class="idref" href="#RICH_ADDRESSING_OPCODE_ERGS"><span class="id" title="definition">RICH_ADDRESSING_OPCODE_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#VM_CYCLE_COST_IN_ERGS"><span class="id" title="definition">VM_CYCLE_COST_IN_ERGS</span></a> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <a class="idref" href="#RAM_PERMUTATION_COST_IN_ERGS"><span class="id" title="definition">RAM_PERMUTATION_COST_IN_ERGS</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a id="AVERAGE_OPCODE_ERGS" class="idref" href="#AVERAGE_OPCODE_ERGS"><span class="id" title="definition">AVERAGE_OPCODE_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := <a class="idref" href="#VM_CYCLE_COST_IN_ERGS"><span class="id" title="definition">VM_CYCLE_COST_IN_ERGS</span></a> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#RAM_PERMUTATION_COST_IN_ERGS"><span class="id" title="definition">RAM_PERMUTATION_COST_IN_ERGS</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="STORAGE_READ_IO_PRICE" class="idref" href="#STORAGE_READ_IO_PRICE"><span class="id" title="definition">STORAGE_READ_IO_PRICE</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 150.<br/>
<span class="id" title="keyword">Definition</span> <a id="STORAGE_WRITE_IO_PRICE" class="idref" href="#STORAGE_WRITE_IO_PRICE"><span class="id" title="definition">STORAGE_WRITE_IO_PRICE</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 250.<br/>
<span class="id" title="keyword">Definition</span> <a id="EVENT_IO_PRICE" class="idref" href="#EVENT_IO_PRICE"><span class="id" title="definition">EVENT_IO_PRICE</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 25.<br/>
<span class="id" title="keyword">Definition</span> <a id="L1_MESSAGE_IO_PRICE" class="idref" href="#L1_MESSAGE_IO_PRICE"><span class="id" title="definition">L1_MESSAGE_IO_PRICE</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 100.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="CALL_LIKE_ERGS_COST" class="idref" href="#CALL_LIKE_ERGS_COST"><span class="id" title="definition">CALL_LIKE_ERGS_COST</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 20.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="ERGS_PER_CODE_WORD_DECOMMITTMENT" class="idref" href="#ERGS_PER_CODE_WORD_DECOMMITTMENT"><span class="id" title="definition">ERGS_PER_CODE_WORD_DECOMMITTMENT</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := <a class="idref" href="#CODE_DECOMMITMENT_COST_PER_WORD_IN_ERGS"><span class="id" title="definition">CODE_DECOMMITMENT_COST_PER_WORD_IN_ERGS</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="VM_MAX_STACK_DEPTH" class="idref" href="#VM_MAX_STACK_DEPTH"><span class="id" title="definition">VM_MAX_STACK_DEPTH</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := <a class="idref" href="#VM_INITIAL_FRAME_ERGS"><span class="id" title="definition">VM_INITIAL_FRAME_ERGS</span></a> <a class="idref" href="#d3c2652250c7a120d67ccc0e8f58ae75"><span class="id" title="notation">/</span></a> <a class="idref" href="#CALL_LIKE_ERGS_COST"><span class="id" title="definition">CALL_LIKE_ERGS_COST</span></a> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 80.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="INITIAL_FRAME_SUCCESSFUL_EXIT_PC" class="idref" href="#INITIAL_FRAME_SUCCESSFUL_EXIT_PC"><span class="id" title="definition">INITIAL_FRAME_SUCCESSFUL_EXIT_PC</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 0.<br/>
<span class="id" title="keyword">Definition</span> <a id="INITIAL_FRAME_FORMAL_EH_LOCATION" class="idref" href="#INITIAL_FRAME_FORMAL_EH_LOCATION"><span class="id" title="definition">INITIAL_FRAME_FORMAL_EH_LOCATION</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := <a class="idref" href="#unsigned_max"><span class="id" title="definition">unsigned_max</span></a> 16.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="SYSTEM_CONTRACTS_OFFSET_ADDRESS" class="idref" href="#SYSTEM_CONTRACTS_OFFSET_ADDRESS"><span class="id" title="definition">SYSTEM_CONTRACTS_OFFSET_ADDRESS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 2 <a class="idref" href="#14ef112b66e341f773bd1e9d05816f43"><span class="id" title="notation">^</span></a> 15.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="KECCAK256_ROUND_FUNCTION_PRECOMPILE_ADDRESS" class="idref" href="#KECCAK256_ROUND_FUNCTION_PRECOMPILE_ADDRESS"><span class="id" title="definition">KECCAK256_ROUND_FUNCTION_PRECOMPILE_ADDRESS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := <a class="idref" href="#SYSTEM_CONTRACTS_OFFSET_ADDRESS"><span class="id" title="definition">SYSTEM_CONTRACTS_OFFSET_ADDRESS</span></a> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 0<span class="id" title="var">x10</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="SHA256_ROUND_FUNCTION_PRECOMPILE_ADDRESS" class="idref" href="#SHA256_ROUND_FUNCTION_PRECOMPILE_ADDRESS"><span class="id" title="definition">SHA256_ROUND_FUNCTION_PRECOMPILE_ADDRESS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 0<span class="id" title="var">x02</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="ECRECOVER_INNER_FUNCTION_PRECOMPILE_ADDRESS" class="idref" href="#ECRECOVER_INNER_FUNCTION_PRECOMPILE_ADDRESS"><span class="id" title="definition">ECRECOVER_INNER_FUNCTION_PRECOMPILE_ADDRESS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 0<span class="id" title="var">x01</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="SECP256R1_VERIFY_PRECOMPILE_ADDRESS" class="idref" href="#SECP256R1_VERIFY_PRECOMPILE_ADDRESS"><span class="id" title="definition">SECP256R1_VERIFY_PRECOMPILE_ADDRESS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 0<span class="id" title="var">x100</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="MAX_PUBDATA_COST_PER_QUERY" class="idref" href="#MAX_PUBDATA_COST_PER_QUERY"><span class="id" title="definition">MAX_PUBDATA_COST_PER_QUERY</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 65.<br/>
<span class="id" title="keyword">Definition</span> <a id="INITIAL_STORAGE_WRITE_PUBDATA_BYTES" class="idref" href="#INITIAL_STORAGE_WRITE_PUBDATA_BYTES"><span class="id" title="definition">INITIAL_STORAGE_WRITE_PUBDATA_BYTES</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 64.<br/>
<span class="id" title="keyword">Definition</span> <a id="REPEATED_STORAGE_WRITE_PUBDATA_BYTES" class="idref" href="#REPEATED_STORAGE_WRITE_PUBDATA_BYTES"><span class="id" title="definition">REPEATED_STORAGE_WRITE_PUBDATA_BYTES</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 40.<br/>
<span class="id" title="keyword">Definition</span> <a id="L1_MESSAGE_PUBDATA_BYTES" class="idref" href="#L1_MESSAGE_PUBDATA_BYTES"><span class="id" title="definition">L1_MESSAGE_PUBDATA_BYTES</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 1 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 20 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 32 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 32.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="MAX_PUBDATA_PER_BLOCK" class="idref" href="#MAX_PUBDATA_PER_BLOCK"><span class="id" title="definition">MAX_PUBDATA_PER_BLOCK</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 110000.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="STORAGE_AUX_BYTE" class="idref" href="#STORAGE_AUX_BYTE"><span class="id" title="definition">STORAGE_AUX_BYTE</span></a>: <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a> := <span class="id" title="definition">fromZ</span> 0.<br/>
<span class="id" title="keyword">Definition</span> <a id="EVENT_AUX_BYTE" class="idref" href="#EVENT_AUX_BYTE"><span class="id" title="definition">EVENT_AUX_BYTE</span></a>: <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a> := <span class="id" title="definition">fromZ</span> 1.<br/>
<span class="id" title="keyword">Definition</span> <a id="L1_MESSAGE_AUX_BYTE" class="idref" href="#L1_MESSAGE_AUX_BYTE"><span class="id" title="definition">L1_MESSAGE_AUX_BYTE</span></a>: <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a> := <span class="id" title="definition">fromZ</span> 2.<br/>
<span class="id" title="keyword">Definition</span> <a id="PRECOMPILE_AUX_BYTE" class="idref" href="#PRECOMPILE_AUX_BYTE"><span class="id" title="definition">PRECOMPILE_AUX_BYTE</span></a>: <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a> := <span class="id" title="definition">fromZ</span> 3.<br/>
<span class="id" title="keyword">Definition</span> <a id="TRANSIENT_STORAGE_AUX_BYTE" class="idref" href="#TRANSIENT_STORAGE_AUX_BYTE"><span class="id" title="definition">TRANSIENT_STORAGE_AUX_BYTE</span></a>: <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a> := <span class="id" title="definition">fromZ</span> 4.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="BOOTLOADER_FORMAL_ADDRESS_LOW" class="idref" href="#BOOTLOADER_FORMAL_ADDRESS_LOW"><span class="id" title="definition">BOOTLOADER_FORMAL_ADDRESS_LOW</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := <a class="idref" href="#SYSTEM_CONTRACTS_OFFSET_ADDRESS"><span class="id" title="definition">SYSTEM_CONTRACTS_OFFSET_ADDRESS</span></a> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 0<span class="id" title="var">x01</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="DEPLOYER_SYSTEM_CONTRACT_ADDRESS_LOW" class="idref" href="#DEPLOYER_SYSTEM_CONTRACT_ADDRESS_LOW"><span class="id" title="definition">DEPLOYER_SYSTEM_CONTRACT_ADDRESS_LOW</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := <a class="idref" href="#SYSTEM_CONTRACTS_OFFSET_ADDRESS"><span class="id" title="definition">SYSTEM_CONTRACTS_OFFSET_ADDRESS</span></a> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 0<span class="id" title="var">x02</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="ADDRESS_UNRESTRICTED_SPACE" class="idref" href="#ADDRESS_UNRESTRICTED_SPACE"><span class="id" title="definition">ADDRESS_UNRESTRICTED_SPACE</span></a>: <a class="idref" href="#u64"><span class="id" title="definition">u64</span></a> := <span class="id" title="definition">fromZ</span> (2<a class="idref" href="#14ef112b66e341f773bd1e9d05816f43"><span class="id" title="notation">^</span></a>16).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="ADDRESS_ECRECOVER" class="idref" href="#ADDRESS_ECRECOVER"><span class="id" title="definition">ADDRESS_ECRECOVER</span></a>: <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> := <span class="id" title="definition">fromZ</span> 0<span class="id" title="var">x0001</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="ADDRESS_SHA256" class="idref" href="#ADDRESS_SHA256"><span class="id" title="definition">ADDRESS_SHA256</span></a>: <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> := <span class="id" title="definition">fromZ</span> 0<span class="id" title="var">x0002</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="ADDRESS_RIPEMD160" class="idref" href="#ADDRESS_RIPEMD160"><span class="id" title="definition">ADDRESS_RIPEMD160</span></a>: <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> := <span class="id" title="definition">fromZ</span> 0<span class="id" title="var">x0003</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="ADDRESS_IDENTITY" class="idref" href="#ADDRESS_IDENTITY"><span class="id" title="definition">ADDRESS_IDENTITY</span></a>: <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> := <span class="id" title="definition">fromZ</span> 0<span class="id" title="var">x0004</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="ADDRESS_BOOTLOADER" class="idref" href="#ADDRESS_BOOTLOADER"><span class="id" title="definition">ADDRESS_BOOTLOADER</span></a>: <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> := <span class="id" title="definition">fromZ</span> 0<span class="id" title="var">x8001</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="ADDRESS_ACCOUNT_CODE_STORAGE" class="idref" href="#ADDRESS_ACCOUNT_CODE_STORAGE"><span class="id" title="definition">ADDRESS_ACCOUNT_CODE_STORAGE</span></a>: <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> := <span class="id" title="definition">fromZ</span> 0<span class="id" title="var">x8002</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="ADDRESS_NONCE_HOLDER" class="idref" href="#ADDRESS_NONCE_HOLDER"><span class="id" title="definition">ADDRESS_NONCE_HOLDER</span></a>: <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> := <span class="id" title="definition">fromZ</span> 0<span class="id" title="var">x8003</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="ADDRESS_KNOWN_CODES_STORAGE" class="idref" href="#ADDRESS_KNOWN_CODES_STORAGE"><span class="id" title="definition">ADDRESS_KNOWN_CODES_STORAGE</span></a>: <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> := <span class="id" title="definition">fromZ</span> 0<span class="id" title="var">x8004</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="ADDRESS_IMMUTABLE_SIMULATOR" class="idref" href="#ADDRESS_IMMUTABLE_SIMULATOR"><span class="id" title="definition">ADDRESS_IMMUTABLE_SIMULATOR</span></a>: <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> := <span class="id" title="definition">fromZ</span> 0<span class="id" title="var">x8005</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="ADDRESS_CONTRACT_DEPLOYER" class="idref" href="#ADDRESS_CONTRACT_DEPLOYER"><span class="id" title="definition">ADDRESS_CONTRACT_DEPLOYER</span></a>: <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> := <span class="id" title="definition">fromZ</span> 0<span class="id" title="var">x8006</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="ADDRESS_FORCE_DEPLOYER" class="idref" href="#ADDRESS_FORCE_DEPLOYER"><span class="id" title="definition">ADDRESS_FORCE_DEPLOYER</span></a>: <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> := <span class="id" title="definition">fromZ</span> 0<span class="id" title="var">x8007</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="ADDRESS_L1_MESSENGER" class="idref" href="#ADDRESS_L1_MESSENGER"><span class="id" title="definition">ADDRESS_L1_MESSENGER</span></a>: <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> := <span class="id" title="definition">fromZ</span> 0<span class="id" title="var">x8008</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="ADDRESS_MSG_VALUE" class="idref" href="#ADDRESS_MSG_VALUE"><span class="id" title="definition">ADDRESS_MSG_VALUE</span></a>: <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> := <span class="id" title="definition">fromZ</span> 0<span class="id" title="var">x8009</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="ADDRESS_ETH_TOKEN" class="idref" href="#ADDRESS_ETH_TOKEN"><span class="id" title="definition">ADDRESS_ETH_TOKEN</span></a>: <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> := <span class="id" title="definition">fromZ</span> 0<span class="id" title="var">x800A</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="ADDRESS_SYSTEM_CONTEXT" class="idref" href="#ADDRESS_SYSTEM_CONTEXT"><span class="id" title="definition">ADDRESS_SYSTEM_CONTEXT</span></a>: <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> := <span class="id" title="definition">fromZ</span> 0<span class="id" title="var">x800B</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="ADDRESS_BOOTLOADER_UTILITIES" class="idref" href="#ADDRESS_BOOTLOADER_UTILITIES"><span class="id" title="definition">ADDRESS_BOOTLOADER_UTILITIES</span></a>: <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> := <span class="id" title="definition">fromZ</span> 0<span class="id" title="var">x800C</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="ADDRESS_EVENT_WRITER" class="idref" href="#ADDRESS_EVENT_WRITER"><span class="id" title="definition">ADDRESS_EVENT_WRITER</span></a>: <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> := <span class="id" title="definition">fromZ</span> 0<span class="id" title="var">x800D</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="ADDRESS_KECCAK256" class="idref" href="#ADDRESS_KECCAK256"><span class="id" title="definition">ADDRESS_KECCAK256</span></a>: <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a> := <span class="id" title="definition">fromZ</span> 0<span class="id" title="var">x8010</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="BOOTLOADER_MAX_MEMORY" class="idref" href="#BOOTLOADER_MAX_MEMORY"><span class="id" title="definition">BOOTLOADER_MAX_MEMORY</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := <a class="idref" href="#unsigned_max"><span class="id" title="definition">unsigned_max</span></a> 32.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="NEW_FRAME_MEMORY_STIPEND" class="idref" href="#NEW_FRAME_MEMORY_STIPEND"><span class="id" title="definition">NEW_FRAME_MEMORY_STIPEND</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 2<a class="idref" href="#14ef112b66e341f773bd1e9d05816f43"><span class="id" title="notation">^</span></a>12.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="NEW_KERNEL_FRAME_MEMORY_STIPEND" class="idref" href="#NEW_KERNEL_FRAME_MEMORY_STIPEND"><span class="id" title="definition">NEW_KERNEL_FRAME_MEMORY_STIPEND</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 2<a class="idref" href="#14ef112b66e341f773bd1e9d05816f43"><span class="id" title="notation">^</span></a>21.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="INTERNAL_ERGS_TO_VISIBLE_ERGS_CONVERSION_CONSTANT" class="idref" href="#INTERNAL_ERGS_TO_VISIBLE_ERGS_CONVERSION_CONSTANT"><span class="id" title="definition">INTERNAL_ERGS_TO_VISIBLE_ERGS_CONVERSION_CONSTANT</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 1.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="MAX_AUTOMATICALLY_SUPPORTED_MSG_VALUE_BYTECODE" class="idref" href="#MAX_AUTOMATICALLY_SUPPORTED_MSG_VALUE_BYTECODE"><span class="id" title="definition">MAX_AUTOMATICALLY_SUPPORTED_MSG_VALUE_BYTECODE</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 100000.<br/>
<span class="id" title="keyword">Definition</span> <a id="DECOMMITMENT_MSG_VALUE_SIMULATOR_OVERHEAD" class="idref" href="#DECOMMITMENT_MSG_VALUE_SIMULATOR_OVERHEAD"><span class="id" title="definition">DECOMMITMENT_MSG_VALUE_SIMULATOR_OVERHEAD</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ERGS_PER_CODE_WORD_DECOMMITTMENT"><span class="id" title="definition">ERGS_PER_CODE_WORD_DECOMMITTMENT</span></a> <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <a class="idref" href="#MAX_AUTOMATICALLY_SUPPORTED_MSG_VALUE_BYTECODE"><span class="id" title="definition">MAX_AUTOMATICALLY_SUPPORTED_MSG_VALUE_BYTECODE</span></a> <a class="idref" href="#d3c2652250c7a120d67ccc0e8f58ae75"><span class="id" title="notation">/</span></a> 32.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="MSG_VALUE_SIMULATOR_ADDITIVE_COST" class="idref" href="#MSG_VALUE_SIMULATOR_ADDITIVE_COST"><span class="id" title="definition">MSG_VALUE_SIMULATOR_ADDITIVE_COST</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;14500 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#DECOMMITMENT_MSG_VALUE_SIMULATOR_OVERHEAD"><span class="id" title="definition">DECOMMITMENT_MSG_VALUE_SIMULATOR_OVERHEAD</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="MIN_STORAGE_WRITE_PRICE_FOR_REENTRANCY_PROTECTION" class="idref" href="#MIN_STORAGE_WRITE_PRICE_FOR_REENTRANCY_PROTECTION"><span class="id" title="definition">MIN_STORAGE_WRITE_PRICE_FOR_REENTRANCY_PROTECTION</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 2300 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="MIN_STORAGE_WRITE_COST" class="idref" href="#MIN_STORAGE_WRITE_COST"><span class="id" title="definition">MIN_STORAGE_WRITE_COST</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := <a class="idref" href="#Z.max"><span class="id" title="definition">Z.max</span></a> <a class="idref" href="#MIN_STORAGE_WRITE_PRICE_FOR_REENTRANCY_PROTECTION"><span class="id" title="definition">MIN_STORAGE_WRITE_PRICE_FOR_REENTRANCY_PROTECTION</span></a> <a class="idref" href="#STORAGE_WRITE_HASHER_MIN_COST_IN_ERGS"><span class="id" title="definition">STORAGE_WRITE_HASHER_MIN_COST_IN_ERGS</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="STORAGE_ACCESS_COLD_READ_COST" class="idref" href="#STORAGE_ACCESS_COLD_READ_COST"><span class="id" title="definition">STORAGE_ACCESS_COLD_READ_COST</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 2000.<br/>
<span class="id" title="keyword">Definition</span> <a id="STORAGE_ACCESS_COLD_WRITE_COST" class="idref" href="#STORAGE_ACCESS_COLD_WRITE_COST"><span class="id" title="definition">STORAGE_ACCESS_COLD_WRITE_COST</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := <a class="idref" href="#Z.max"><span class="id" title="definition">Z.max</span></a> <a class="idref" href="#MIN_STORAGE_WRITE_COST"><span class="id" title="definition">MIN_STORAGE_WRITE_COST</span></a> 5500.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="MSG_VALUE_SIMULATOR_MIN_USED_ERGS" class="idref" href="#MSG_VALUE_SIMULATOR_MIN_USED_ERGS"><span class="id" title="definition">MSG_VALUE_SIMULATOR_MIN_USED_ERGS</span></a>: <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 8000 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#DECOMMITMENT_MSG_VALUE_SIMULATOR_OVERHEAD"><span class="id" title="definition">DECOMMITMENT_MSG_VALUE_SIMULATOR_OVERHEAD</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="growth_cost" class="idref" href="#growth_cost"><span class="id" title="definition">growth_cost</span></a> (<a id="diff:1" class="idref" href="#diff:1"><span class="id" title="binder">diff</span></a>:<a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>) : <a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a> := <a class="idref" href="#diff:1"><span class="id" title="variable">diff</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Ergs"><span class="id" title="section">Ergs</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Costs" class="idref" href="#Costs"><span class="id" title="section">Costs</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z_scope</span>.<br/>
</div>

<div class="doc"><h1 id="costs">Costs</h1>
<p>Basic costs of all instructions. They are paid when the instruction
starts executing; see <span class="inlinecode"><span class="id"
title="var">Semantics.step</span></span>.</p>
<p>Instructions may also impose additional costs e.g. far returns and
far calls may grow heap; far calls also may induce code <span
class="inlinecode"><a class="idref" href="#decommitment_cost"><span
class="id" title="inductive">decommitment_cost</span></a></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="base_cost" class="idref" href="#base_cost"><span class="id" title="definition">base_cost</span></a> (<a id="ins:2" class="idref" href="#ins:2"><span class="id" title="binder">ins</span></a>:<a class="idref" href="#asm_instruction"><span class="id" title="inductive">asm_instruction</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">match</span> <a class="idref" href="#ins:2"><span class="id" title="variable">ins</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpInvalid"><span class="id" title="constructor">OpInvalid</span></a> ⇒ <a class="idref" href="#INVALID_OPCODE_ERGS"><span class="id" title="definition">INVALID_OPCODE_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpNoOp"><span class="id" title="constructor">OpNoOp</span></a> | <a class="idref" href="#OpSpAdd"><span class="id" title="constructor">OpSpAdd</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> | <a class="idref" href="#OpSpSub"><span class="id" title="constructor">OpSpSub</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#RICH_ADDRESSING_OPCODE_ERGS"><span class="id" title="definition">RICH_ADDRESSING_OPCODE_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpJump"><span class="id" title="constructor">OpJump</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#RICH_ADDRESSING_OPCODE_ERGS"><span class="id" title="definition">RICH_ADDRESSING_OPCODE_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpAnd"><span class="id" title="constructor">OpAnd</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#RICH_ADDRESSING_OPCODE_ERGS"><span class="id" title="definition">RICH_ADDRESSING_OPCODE_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpOr"><span class="id" title="constructor">OpOr</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#RICH_ADDRESSING_OPCODE_ERGS"><span class="id" title="definition">RICH_ADDRESSING_OPCODE_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpXor"><span class="id" title="constructor">OpXor</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#RICH_ADDRESSING_OPCODE_ERGS"><span class="id" title="definition">RICH_ADDRESSING_OPCODE_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpAdd"><span class="id" title="constructor">OpAdd</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#RICH_ADDRESSING_OPCODE_ERGS"><span class="id" title="definition">RICH_ADDRESSING_OPCODE_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpSub"><span class="id" title="constructor">OpSub</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#RICH_ADDRESSING_OPCODE_ERGS"><span class="id" title="definition">RICH_ADDRESSING_OPCODE_ERGS</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpShl"><span class="id" title="constructor">OpShl</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#RICH_ADDRESSING_OPCODE_ERGS"><span class="id" title="definition">RICH_ADDRESSING_OPCODE_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpShr"><span class="id" title="constructor">OpShr</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#RICH_ADDRESSING_OPCODE_ERGS"><span class="id" title="definition">RICH_ADDRESSING_OPCODE_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpRol"><span class="id" title="constructor">OpRol</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#RICH_ADDRESSING_OPCODE_ERGS"><span class="id" title="definition">RICH_ADDRESSING_OPCODE_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpRor"><span class="id" title="constructor">OpRor</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#RICH_ADDRESSING_OPCODE_ERGS"><span class="id" title="definition">RICH_ADDRESSING_OPCODE_ERGS</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpMul"><span class="id" title="constructor">OpMul</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#RICH_ADDRESSING_OPCODE_ERGS"><span class="id" title="definition">RICH_ADDRESSING_OPCODE_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpDiv"><span class="id" title="constructor">OpDiv</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#RICH_ADDRESSING_OPCODE_ERGS"><span class="id" title="definition">RICH_ADDRESSING_OPCODE_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpNearCall"><span class="id" title="constructor">OpNearCall</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#AVERAGE_OPCODE_ERGS"><span class="id" title="definition">AVERAGE_OPCODE_ERGS</span></a> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#CALL_LIKE_ERGS_COST"><span class="id" title="definition">CALL_LIKE_ERGS_COST</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpFarCall"><span class="id" title="constructor">OpFarCall</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpDelegateCall"><span class="id" title="constructor">OpDelegateCall</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpMimicCall"><span class="id" title="constructor">OpMimicCall</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <a class="idref" href="#VM_CYCLE_COST_IN_ERGS"><span class="id" title="definition">VM_CYCLE_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#RAM_PERMUTATION_COST_IN_ERGS"><span class="id" title="definition">RAM_PERMUTATION_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#STORAGE_READ_IO_PRICE"><span class="id" title="definition">STORAGE_READ_IO_PRICE</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#CALL_LIKE_ERGS_COST"><span class="id" title="definition">CALL_LIKE_ERGS_COST</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#STORAGE_SORTER_COST_IN_ERGS"><span class="id" title="definition">STORAGE_SORTER_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#CODE_DECOMMITMENT_SORTER_COST_IN_ERGS"><span class="id" title="definition">CODE_DECOMMITMENT_SORTER_COST_IN_ERGS</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpNearRetTo"><span class="id" title="constructor">OpNearRetTo</span></a> <span class="id" title="var">_</span> | <a class="idref" href="#OpNearRevertTo"><span class="id" title="constructor">OpNearRevertTo</span></a> <span class="id" title="var">_</span> | <a class="idref" href="#OpNearPanicTo"><span class="id" title="constructor">OpNearPanicTo</span></a> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpRet"><span class="id" title="constructor">OpRet</span></a> <span class="id" title="var">_</span> | <a class="idref" href="#OpRevert"><span class="id" title="constructor">OpRevert</span></a> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpPanic"><span class="id" title="constructor">OpPanic</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ <a class="idref" href="#AVERAGE_OPCODE_ERGS"><span class="id" title="definition">AVERAGE_OPCODE_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpPtrAdd"><span class="id" title="constructor">OpPtrAdd</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpPtrSub"><span class="id" title="constructor">OpPtrSub</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpPtrShrink"><span class="id" title="constructor">OpPtrShrink</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpPtrPack"><span class="id" title="constructor">OpPtrPack</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#RICH_ADDRESSING_OPCODE_ERGS"><span class="id" title="definition">RICH_ADDRESSING_OPCODE_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#OpStore"><span class="id" title="constructor">OpStore</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpStoreInc"><span class="id" title="constructor">OpStoreInc</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpStaticWrite"><span class="id" title="constructor">OpStaticWrite</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpStaticWriteInc"><span class="id" title="constructor">OpStaticWriteInc</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <a class="idref" href="#VM_CYCLE_COST_IN_ERGS"><span class="id" title="definition">VM_CYCLE_COST_IN_ERGS</span></a> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 5 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <a class="idref" href="#RAM_PERMUTATION_COST_IN_ERGS"><span class="id" title="definition">RAM_PERMUTATION_COST_IN_ERGS</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpLoad"><span class="id" title="constructor">OpLoad</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpLoadInc"><span class="id" title="constructor">OpLoadInc</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpLoadPointer"><span class="id" title="constructor">OpLoadPointer</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpLoadPointerInc"><span class="id" title="constructor">OpLoadPointerInc</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpStaticRead"><span class="id" title="constructor">OpStaticRead</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpStaticReadInc"><span class="id" title="constructor">OpStaticReadInc</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ <a class="idref" href="#VM_CYCLE_COST_IN_ERGS"><span class="id" title="definition">VM_CYCLE_COST_IN_ERGS</span></a> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 3 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <a class="idref" href="#RAM_PERMUTATION_COST_IN_ERGS"><span class="id" title="definition">RAM_PERMUTATION_COST_IN_ERGS</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpContractThis"><span class="id" title="constructor">OpContractThis</span></a> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpContractCaller"><span class="id" title="constructor">OpContractCaller</span></a> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpContractCodeAddress"><span class="id" title="constructor">OpContractCodeAddress</span></a> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpVMMeta"><span class="id" title="constructor">OpVMMeta</span></a> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpVMErgsLeft"><span class="id" title="constructor">OpVMErgsLeft</span></a> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpVMSP"><span class="id" title="constructor">OpVMSP</span></a> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpGetCapturedContext"><span class="id" title="constructor">OpGetCapturedContext</span></a> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpSetContextReg"><span class="id" title="constructor">OpSetContextReg</span></a> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpAuxMutating"><span class="id" title="constructor">OpAuxMutating</span></a> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpIncrementTxNumber"><span class="id" title="constructor">OpIncrementTxNumber</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ <a class="idref" href="#AVERAGE_OPCODE_ERGS"><span class="id" title="definition">AVERAGE_OPCODE_ERGS</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpSLoad"><span class="id" title="constructor">OpSLoad</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>⇒ <a class="idref" href="#VM_CYCLE_COST_IN_ERGS"><span class="id" title="definition">VM_CYCLE_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#RAM_PERMUTATION_COST_IN_ERGS"><span class="id" title="definition">RAM_PERMUTATION_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#LOG_DEMUXER_COST_IN_ERGS"><span class="id" title="definition">LOG_DEMUXER_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#STORAGE_SORTER_COST_IN_ERGS"><span class="id" title="definition">STORAGE_SORTER_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#STORAGE_ACCESS_COLD_READ_COST"><span class="id" title="definition">STORAGE_ACCESS_COLD_READ_COST</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpSStore"><span class="id" title="constructor">OpSStore</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#VM_CYCLE_COST_IN_ERGS"><span class="id" title="definition">VM_CYCLE_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#RAM_PERMUTATION_COST_IN_ERGS"><span class="id" title="definition">RAM_PERMUTATION_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <a class="idref" href="#LOG_DEMUXER_COST_IN_ERGS"><span class="id" title="definition">LOG_DEMUXER_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <a class="idref" href="#STORAGE_SORTER_COST_IN_ERGS"><span class="id" title="definition">STORAGE_SORTER_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#STORAGE_ACCESS_COLD_WRITE_COST"><span class="id" title="definition">STORAGE_ACCESS_COLD_WRITE_COST</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpToL1Message"><span class="id" title="constructor">OpToL1Message</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#L1_MESSAGE_IO_PRICE"><span class="id" title="definition">L1_MESSAGE_IO_PRICE</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#VM_CYCLE_COST_IN_ERGS"><span class="id" title="definition">VM_CYCLE_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#RAM_PERMUTATION_COST_IN_ERGS"><span class="id" title="definition">RAM_PERMUTATION_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <a class="idref" href="#LOG_DEMUXER_COST_IN_ERGS"><span class="id" title="definition">LOG_DEMUXER_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <a class="idref" href="#EVENTS_OR_L1_MESSAGES_SORTER_COST_IN_ERGS"><span class="id" title="definition">EVENTS_OR_L1_MESSAGES_SORTER_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpEvent"><span class="id" title="constructor">OpEvent</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="#EVENT_IO_PRICE"><span class="id" title="definition">EVENT_IO_PRICE</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#VM_CYCLE_COST_IN_ERGS"><span class="id" title="definition">VM_CYCLE_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#RAM_PERMUTATION_COST_IN_ERGS"><span class="id" title="definition">RAM_PERMUTATION_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <a class="idref" href="#LOG_DEMUXER_COST_IN_ERGS"><span class="id" title="definition">LOG_DEMUXER_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <a class="idref" href="#EVENTS_OR_L1_MESSAGES_SORTER_COST_IN_ERGS"><span class="id" title="definition">EVENTS_OR_L1_MESSAGES_SORTER_COST_IN_ERGS</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpPrecompileCall"><span class="id" title="constructor">OpPrecompileCall</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpDecommit"><span class="id" title="constructor">OpDecommit</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#VM_CYCLE_COST_IN_ERGS"><span class="id" title="definition">VM_CYCLE_COST_IN_ERGS</span></a> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#RAM_PERMUTATION_COST_IN_ERGS"><span class="id" title="definition">RAM_PERMUTATION_COST_IN_ERGS</span></a> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#LOG_DEMUXER_COST_IN_ERGS"><span class="id" title="definition">LOG_DEMUXER_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpTransientLoad"><span class="id" title="constructor">OpTransientLoad</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#VM_CYCLE_COST_IN_ERGS"><span class="id" title="definition">VM_CYCLE_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#RAM_PERMUTATION_COST_IN_ERGS"><span class="id" title="definition">RAM_PERMUTATION_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#LOG_DEMUXER_COST_IN_ERGS"><span class="id" title="definition">LOG_DEMUXER_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#STORAGE_SORTER_COST_IN_ERGS"><span class="id" title="definition">STORAGE_SORTER_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpTransientStore"><span class="id" title="constructor">OpTransientStore</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#VM_CYCLE_COST_IN_ERGS"><span class="id" title="definition">VM_CYCLE_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="#RAM_PERMUTATION_COST_IN_ERGS"><span class="id" title="definition">RAM_PERMUTATION_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <a class="idref" href="#LOG_DEMUXER_COST_IN_ERGS"><span class="id" title="definition">LOG_DEMUXER_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <a class="idref" href="#STORAGE_SORTER_COST_IN_ERGS"><span class="id" title="definition">STORAGE_SORTER_COST_IN_ERGS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>)%<span class="id" title="var">Z</span>.<br/>

<br/>
</div>

<div class="doc"><p>Implementation note: Coq allows partially evaluating <span
class="inlinecode"><a class="idref" href="#base_cost"><span
class="id" title="definition">base_cost</span></a></span> to get the
absolute erg costs for each instruction:</p>
<pre><code>Compute base_costs.</code></pre>
<p>Current costs are:</p>
<pre><code>| Invalid =&gt; 4294967295
| NearCall =&gt; 25
| FarCall
| MimicCall
| DelegateCall =&gt; 182
| NearRet
| NearRetTo
| FarRet
| NearRevert
| NearRevertTo
| FarRevert
| NearPanicTo
| Panic
| ContractThis
| ContractCaller
| ContractCodeAddress
| VMMeta
| VMErgsLeft
| VMSp
| GetCapturedContext
| SetContextReg
| IncrementTxNumber
| AuxMutating =&gt; 5
| SLoad =&gt; 2008
| SStore =&gt; 5511
| Event =&gt; 34
| ToL1Message =&gt; 109
| TransientWrite =&gt; 11
| TransientRead =&gt; 8
| Load
| LoadInc
| LoadPointer
| LoadPointerInc
| StaticRead
| StaticReadInc =&gt; 7
| Store
| StoreInc
| StaticWrite
| StaticWriteInc =&gt; 13
| &lt;otherwise&gt; =&gt; 6</code></pre>
</div>
<div class="code">
<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Costs"><span class="id" title="section">Costs</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.KernelMode</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="library">memory.Depot</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">memory.Depot</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="KernelMode" class="idref" href="#KernelMode"><span class="id" title="section">KernelMode</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">ZArith</span></a> <a class="idref" href="#"><span class="id" title="module">Arith</span></a> <span class="id" title="module">spec</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="descr:1" class="idref" href="#descr:1"><span class="id" title="binder">descr</span></a>: <a class="idref" href="#descr"><span class="id" title="record">CoreSet.descr</span></a>}.<br/>
</div>

<div class="doc"><h1 id="kernel-mode">Kernel Mode</h1>
<p>EraVM operates either in <strong>kernel</strong> or in <strong>user
mode</strong>. Some instructions (see <span
class="inlinecode"><a class="idref" href="#requires_kernel"><span
class="id" title="definition">requires_kernel</span></a></span> are only
allowed in kernel mode; executing them in user mode results in
panic.</p>
<p>Current mode is determined by the address of the currently executed
contract <span class="math inline">C</span>:</p>
<ul>
<li>if <span class="math inline">C &lt;</span> <span
class="inlinecode"><a class="idref" href="#KERNEL_MODE_MAXADDR_LIMIT"><span
class="id"
title="definition">KERNEL_MODE_MAXADDR_LIMIT</span></a></span>, EraVM is
in kernel mode;</li>
<li>otherwise, EraVM is in user mode.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="KERNEL_MODE_MAXADDR_LIMIT" class="idref" href="#KERNEL_MODE_MAXADDR_LIMIT"><span class="id" title="definition">KERNEL_MODE_MAXADDR_LIMIT</span></a> : <a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a> := <span class="id" title="definition">fromZ</span> (2<a class="idref" href="#14ef112b66e341f773bd1e9d05816f43"><span class="id" title="notation">^</span></a>16).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="addr_is_kernel" class="idref" href="#addr_is_kernel"><span class="id" title="definition">addr_is_kernel</span></a> (<a id="addr:2" class="idref" href="#addr:2"><span class="id" title="binder">addr</span></a>:<a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a>) : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#addr:2"><span class="id" title="variable">addr</span></a> <a class="idref" href="#::ZMod_scope:x_'<'_x"><span class="id" title="notation"><</span></a> <a class="idref" href="#KERNEL_MODE_MAXADDR_LIMIT"><span class="id" title="definition">KERNEL_MODE_MAXADDR_LIMIT</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>Current contract’s address can be obtained from the active external
frame in <span
class="inlinecode"><a class="idref" href="#callstack"><span
class="id" title="inductive">callstack</span></a></span>. Topmost
external frame (active frame) is obtained through <span
class="inlinecode"><a class="idref" href="#active_extframe"><span
class="id" title="definition">active_extframe</span></a></span>, it
contains the current contract’s address in its field <span
class="inlinecode"><a class="idref" href="#ecf_this_address"><span
class="id" title="projection">ecf_this_address</span></a></span>.</p>
<p>The list of instructions requiring kernel mode is encoded by the
definition <span
class="inlinecode"><a class="idref" href="#requires_kernel"><span
class="id" title="definition">requires_kernel</span></a></span>. If
<span
class="inlinecode"><a class="idref" href="#requires_kernel"><span
class="id" title="definition">requires_kernel</span></a></span> <span
class="inlinecode"><span class="id" title="var">ins</span></span> <span
class="inlinecode">==</span> <span
class="inlinecode"><a class="idref" href="#true"><span
class="id" title="constructor">true</span></a></span>, the instruction
<span class="inlinecode"><span class="id" title="var">ins</span></span>
is only allowed in kernel mode.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="requires_kernel" class="idref" href="#requires_kernel"><span class="id" title="definition">requires_kernel</span></a> (<a id="ins:3" class="idref" href="#ins:3"><span class="id" title="binder">ins</span></a>: @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#KernelMode.descr"><span class="id" title="variable">descr</span></a>) : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#ins:3"><span class="id" title="variable">ins</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpMimicCall"><span class="id" title="constructor">OpMimicCall</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpSetContextReg"><span class="id" title="constructor">OpSetContextReg</span></a> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpAuxMutating"><span class="id" title="constructor">OpAuxMutating</span></a> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpIncrementTxNumber"><span class="id" title="constructor">OpIncrementTxNumber</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpEvent"><span class="id" title="constructor">OpEvent</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpToL1Message"><span class="id" title="constructor">OpToL1Message</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpPrecompileCall"><span class="id" title="constructor">OpPrecompileCall</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpDecommit"><span class="id" title="constructor">OpDecommit</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpStaticRead"><span class="id" title="constructor">OpStaticRead</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpStaticWrite"><span class="id" title="constructor">OpStaticWrite</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ <a class="idref" href="#true"><span class="id" title="constructor">true</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <a class="idref" href="#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc"><p>Function <span
class="inlinecode"><a class="idref" href="#check_requires_kernel"><span
class="id" title="definition">check_requires_kernel</span></a></span>
returns <span
class="inlinecode"><a class="idref" href="#false"><span
class="id" title="constructor">false</span></a></span> if:</p>
<ul>
<li>an instruction <span class="inlinecode"><span class="id"
title="var">ins</span></span> requires kernel mode, and</li>
<li>VM is not in kernel mode, as indicated by <span
class="inlinecode"><span class="id"
title="var">in_kernel</span></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="check_requires_kernel" class="idref" href="#check_requires_kernel"><span class="id" title="definition">check_requires_kernel</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="ins:5" class="idref" href="#ins:5"><span class="id" title="binder">ins</span></a>: @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#KernelMode.descr"><span class="id" title="variable">descr</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="in_kernel:6" class="idref" href="#in_kernel:6"><span class="id" title="binder">in_kernel</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>) : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">(</span></a><a class="idref" href="#negb"><span class="id" title="definition">negb</span></a> <a class="idref" href="#in_kernel:6"><span class="id" title="variable">in_kernel</span></a><a class="idref" href="#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">)</span></a> <a class="idref" href="#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">||</span></a> <a class="idref" href="#in_kernel:6"><span class="id" title="variable">in_kernel</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#KernelMode"><span class="id" title="section">KernelMode</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.StaticMode</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">isa.CoreSet</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">Addressing</span></a> <a class="idref" href="#"><span class="id" title="module">GPR</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a>.<br/>
<span class="id" title="keyword">Section</span> <a id="StaticMode" class="idref" href="#StaticMode"><span class="id" title="section">StaticMode</span></a>.<br/>

<br/>
</div>

<div class="doc"><h1 id="static-mode">Static mode</h1>
<p><strong>Static mode</strong> is a mode of execution.</p>
<p>Intuitively, executing code in static mode aims at limiting its
effects on the global state, similar to executing pure functions.</p>
<p>If VM is in static mode, attempting to execute instructions affecting
global system state results in panic with reason <span
class="inlinecode"><a class="idref" href="#ForbiddenInStaticMode"><span
class="id" title="constructor">ForbiddenInStaticMode</span></a></span>.
Refer to <span
class="inlinecode"><a class="idref" href="#forbidden_static"><span
class="id" title="definition">forbidden_static</span></a></span> for a
full list of instructions forbidden in static mode.</p>
<p>Current mode is determined by the flag <span
class="inlinecode"><a class="idref" href="#ecf_is_static"><span
class="id" title="projection">ecf_is_static</span></a></span> in the
<span
class="inlinecode"><a class="idref" href="#active_extframe"><span
class="id" title="definition">active_extframe</span></a></span> in <span
class="inlinecode"><a class="idref" href="#gs_callstack"><span
class="id" title="projection">gs_callstack</span></a></span>.</p>
<h2 id="entering-static-mode">Entering static mode</h2>
<p>To execute the code of a contract in static mode, use one of far call
instructions with a static modifier, for example:</p>
<pre><code>OpFarCall (Reg R1) (Reg R2) (Imm zero16) true false
                                         ^ is_static</code></pre>
<p>The same applies to <span
class="inlinecode"><a class="idref" href="#OpMimicCall"><span
class="id" title="constructor">OpMimicCall</span></a></span> and <span
class="inlinecode"><a class="idref" href="#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span>.</p>
<h2 id="exiting-static-mode">Exiting static mode</h2>
<p>If VM executes a contract <span class="math inline">C</span> in
static mode, the mode will persist until the end of execution of <span
class="math inline">C</span>. If <span class="math inline">C</span>
calls itself or other contracts, these calls will be automatically
marked as static, even if the far call instruction was not explicit
about it.</p>
<p>There is no other way to exit the static mode.</p>
<h2 id="usage">Usage</h2>
<p>Static mode is unrelated and orthogonal to kernel mode.</p>
<p>Executing a contract <span class="math inline">C</span> in static
mode restricts the changes to the state produced by <span
class="math inline">C</span> or any other code that it might call.</p>
<p>Static calls are guaranteed to preserve the state of storage, will
not emit events, or modify the <span
class="inlinecode"><a class="idref" href="#gs_context_u128"><span
class="id" title="projection">gs_context_u128</span></a></span>
register.</p>
</div>
<div class="code">
<br/>

<br/>
</div>

<div class="doc"><p>Function <span
class="inlinecode"><a class="idref" href="#forbidden_static"><span
class="id" title="definition">forbidden_static</span></a></span> returns
<span
class="inlinecode"><a class="idref" href="#true"><span
class="id" title="constructor">true</span></a></span> if instruction
<span class="inlinecode"><span class="id" title="var">ins</span></span>
is forbidden in static mode.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="forbidden:1" class="idref" href="#forbidden:1"><span class="id" title="binder">forbidden</span></a> := <a class="idref" href="#true"><span class="id" title="constructor">true</span></a>) (<a id="allowed:2" class="idref" href="#allowed:2"><span class="id" title="binder">allowed</span></a> := <a class="idref" href="#false"><span class="id" title="constructor">false</span></a>) {<a id="descr:3" class="idref" href="#descr:3"><span class="id" title="binder">descr</span></a>:<a class="idref" href="#descr"><span class="id" title="record">descr</span></a>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="forbidden_static" class="idref" href="#forbidden_static"><span class="id" title="definition">forbidden_static</span></a> (<a id="ins:4" class="idref" href="#ins:4"><span class="id" title="binder">ins</span></a>:@<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#StaticMode.descr"><span class="id" title="variable">descr</span></a>) : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#ins:4"><span class="id" title="variable">ins</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpSetContextReg"><span class="id" title="constructor">OpSetContextReg</span></a> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpIncrementTxNumber"><span class="id" title="constructor">OpIncrementTxNumber</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpSStore"><span class="id" title="constructor">OpSStore</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpTransientStore"><span class="id" title="constructor">OpTransientStore</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpEvent"><span class="id" title="constructor">OpEvent</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpToL1Message"><span class="id" title="constructor">OpToL1Message</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#OpAuxMutating"><span class="id" title="constructor">OpAuxMutating</span></a> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ <a class="idref" href="#StaticMode.forbidden"><span class="id" title="variable">forbidden</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <a class="idref" href="#StaticMode.allowed"><span class="id" title="variable">allowed</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc"><p>Function <span
class="inlinecode"><a class="idref" href="#check_forbidden_static"><span
class="id" title="definition">check_forbidden_static</span></a></span>
returns <span
class="inlinecode"><a class="idref" href="#false"><span
class="id" title="constructor">false</span></a></span> if:</p>
<ul>
<li>an instruction <span class="inlinecode"><span class="id"
title="var">ins</span></span> is not allowed in static mode, and</li>
<li>the current mode is static, as indicated by <span
class="inlinecode"><span class="id"
title="var">static_mode_active</span></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="check_forbidden_static" class="idref" href="#check_forbidden_static"><span class="id" title="definition">check_forbidden_static</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="ins:6" class="idref" href="#ins:6"><span class="id" title="binder">ins</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="static_mode_active:7" class="idref" href="#static_mode_active:7"><span class="id" title="binder">static_mode_active</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>) : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#static_mode_active:7"><span class="id" title="variable">static_mode_active</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="#negb"><span class="id" title="definition">negb</span></a> (<a class="idref" href="#forbidden_static"><span class="id" title="definition">forbidden_static</span></a> <a class="idref" href="#ins:6"><span class="id" title="variable">ins</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#StaticMode"><span class="id" title="section">StaticMode</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.Steps</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">Flags</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">isa.CoreSet</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">KernelMode</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">State</span></a>.<br/>
<span class="id" title="keyword">Import</span><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Flags</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">KernelMode</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="module">RecordSetNotations</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">State</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>A type of a small step relation, in style of structural operational
semantics.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Definition</span> <a id="smallstep" class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> := <a class="idref" href="#state"><span class="id" title="record">state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#state"><span class="id" title="record">state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> .<br/>
<span class="id" title="keyword">Definition</span> <a id="tsmallstep" class="idref" href="#tsmallstep"><span class="id" title="definition">tsmallstep</span></a> := <a class="idref" href="#transient_state"><span class="id" title="record">transient_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#transient_state"><span class="id" title="record">transient_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="flags_tsmallstep" class="idref" href="#flags_tsmallstep"><span class="id" title="definition">flags_tsmallstep</span></a> := <a class="idref" href="#flags_state"><span class="id" title="record">flags_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#flags_state"><span class="id" title="record">flags_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="callstack_smallstep" class="idref" href="#callstack_smallstep"><span class="id" title="definition">callstack_smallstep</span></a> := <a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>.<br/>

<br/>
</div>

<div class="doc"><p>Relations <span
class="inlinecode"><a class="idref" href="#step_transient_only"><span
class="id" title="inductive">step_transient_only</span></a></span> and
<span
class="inlinecode"><a class="idref" href="#step_transient"><span
class="id" title="inductive">step_transient</span></a></span> define the
type of small steps only affecting <span
class="inlinecode"><a class="idref" href="#gs_transient"><span
class="id" title="projection">gs_transient</span></a></span> part.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Inductive</span> <a id="step_transient_only" class="idref" href="#step_transient_only"><span class="id" title="inductive">step_transient_only</span></a> (<a id="xs1:1" class="idref" href="#xs1:1"><span class="id" title="binder">xs1</span></a> <a id="xs2:2" class="idref" href="#xs2:2"><span class="id" title="binder">xs2</span></a>:<a class="idref" href="#transient_state"><span class="id" title="record">transient_state</span></a>) : <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
| <a id="stransient_oapply" class="idref" href="#stransient_oapply"><span class="id" title="constructor">stransient_oapply</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="gs:5" class="idref" href="#gs:5"><span class="id" title="binder">gs</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_transient_only:3"><span class="id" title="inductive">step_transient_only</span></a> <a class="idref" href="#xs1:1"><span class="id" title="variable">xs1</span></a> <a class="idref" href="#xs2:2"><span class="id" title="variable">xs2</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a>       := <a class="idref" href="#xs1:1"><span class="id" title="variable">xs1</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>       := <a class="idref" href="#gs:5"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a>       := <a class="idref" href="#xs2:2"><span class="id" title="variable">xs2</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>       := <a class="idref" href="#gs:5"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <a id="step_transient" class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (<a id="S:6" class="idref" href="#S:6"><span class="id" title="binder">S</span></a>: <a class="idref" href="#transient_state"><span class="id" title="record">transient_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#transient_state"><span class="id" title="record">transient_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>) : <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
| <a id="stransient_apply" class="idref" href="#stransient_apply"><span class="id" title="constructor">stransient_apply</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="xs1:9" class="idref" href="#xs1:9"><span class="id" title="binder">xs1</span></a> <a id="xs2:10" class="idref" href="#xs2:10"><span class="id" title="binder">xs2</span></a> <a id="s1:11" class="idref" href="#s1:11"><span class="id" title="binder">s1</span></a> <a id="s2:12" class="idref" href="#s2:12"><span class="id" title="binder">s2</span></a> ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#S:6"><span class="id" title="variable">S</span></a> <a class="idref" href="#xs1:9"><span class="id" title="variable">xs1</span></a> <a class="idref" href="#xs2:10"><span class="id" title="variable">xs2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_transient_only"><span class="id" title="inductive">step_transient_only</span></a> <a class="idref" href="#xs1:9"><span class="id" title="variable">xs1</span></a> <a class="idref" href="#xs2:10"><span class="id" title="variable">xs2</span></a> <a class="idref" href="#s1:11"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:12"><span class="id" title="variable">s2</span></a><a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_transient:7"><span class="id" title="inductive">step_transient</span></a> <a class="idref" href="#S:6"><span class="id" title="variable">S</span></a> <a class="idref" href="#s1:11"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:12"><span class="id" title="variable">s2</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>Relations <span
class="inlinecode"><a class="idref" href="#tstep_flags"><span
class="id" title="definition">tstep_flags</span></a></span> and <span
class="inlinecode"><a class="idref" href="#step_transient_callstack"><span
class="id" title="inductive">step_transient_callstack</span></a></span>
help defining smallstep relations where only flags or callstack are
changing.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Definition</span> <a id="tstep_flags" class="idref" href="#tstep_flags"><span class="id" title="definition">tstep_flags</span></a> {<a id="descr:13" class="idref" href="#descr:13"><span class="id" title="binder">descr</span></a>:<a class="idref" href="#descr"><span class="id" title="record">CoreSet.descr</span></a>} (<a id="P:14" class="idref" href="#P:14"><span class="id" title="binder">P</span></a>: @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#descr:13"><span class="id" title="variable">descr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#flags_tsmallstep"><span class="id" title="definition">flags_tsmallstep</span></a>): @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#descr:13"><span class="id" title="variable">descr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#tsmallstep"><span class="id" title="definition">tsmallstep</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:15" class="idref" href="#i:15"><span class="id" title="binder">i</span></a> <a id="xs:16" class="idref" href="#xs:16"><span class="id" title="binder">xs</span></a> <a id="xs':17" class="idref" href="#xs':17"><span class="id" title="binder">xs'</span></a> ⇒ <span class="id" title="keyword">∀</span> <a id="f2:18" class="idref" href="#f2:18"><span class="id" title="binder">f2</span></a>, <a class="idref" href="#P:14"><span class="id" title="variable">P</span></a> <a class="idref" href="#i:15"><span class="id" title="variable">i</span></a> (<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a> <a class="idref" href="#xs:16"><span class="id" title="variable">xs</span></a>) <a class="idref" href="#f2:18"><span class="id" title="variable">f2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#xs':17"><span class="id" title="variable">xs'</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#xs:16"><span class="id" title="variable">xs</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#f2:18"><span class="id" title="variable">f2</span></a> <span class="id" title="notation">|></span>.<br/>

<br/>
</div>

<div class="doc"><p>Relations <span
class="inlinecode"><a class="idref" href="#step_transient_callstack"><span
class="id" title="inductive">step_transient_callstack</span></a></span>
and help defining smallstep relations where only callstack is
changing.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Inductive</span> <a id="step_transient_callstack" class="idref" href="#step_transient_callstack"><span class="id" title="inductive">step_transient_callstack</span></a> (<a id="S:19" class="idref" href="#S:19"><span class="id" title="binder">S</span></a>: <a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>) : <a class="idref" href="#transient_state"><span class="id" title="record">transient_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#transient_state"><span class="id" title="record">transient_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
| <a id="scs_apply" class="idref" href="#scs_apply"><span class="id" title="constructor">scs_apply</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="flags:22" class="idref" href="#flags:22"><span class="id" title="binder">flags</span></a> <a id="regs:23" class="idref" href="#regs:23"><span class="id" title="binder">regs</span></a> <a id="pages:24" class="idref" href="#pages:24"><span class="id" title="binder">pages</span></a> <a id="ctx:25" class="idref" href="#ctx:25"><span class="id" title="binder">ctx</span></a> <a id="cs1:26" class="idref" href="#cs1:26"><span class="id" title="binder">cs1</span></a> <a id="cs2:27" class="idref" href="#cs2:27"><span class="id" title="binder">cs2</span></a> <a id="xs1:28" class="idref" href="#xs1:28"><span class="id" title="binder">xs1</span></a> <a id="xs2:29" class="idref" href="#xs2:29"><span class="id" title="binder">xs2</span></a> <a id="status:30" class="idref" href="#status:30"><span class="id" title="binder">status</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#S:19"><span class="id" title="variable">S</span></a> <a class="idref" href="#cs1:26"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#cs2:27"><span class="id" title="variable">cs2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#xs1:28"><span class="id" title="variable">xs1</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">{|</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#cs1:26"><span class="id" title="variable">cs1</span></a>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags:22"><span class="id" title="variable">flags</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#regs:23"><span class="id" title="variable">regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:24"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#ctx:25"><span class="id" title="variable">ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#status:30"><span class="id" title="variable">status</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">|}</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#xs2:29"><span class="id" title="variable">xs2</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">{|</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#cs2:27"><span class="id" title="variable">cs2</span></a>;<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags:22"><span class="id" title="variable">flags</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#regs:23"><span class="id" title="variable">regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:24"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#ctx:25"><span class="id" title="variable">ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#status:30"><span class="id" title="variable">status</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">|}</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_transient_callstack:20"><span class="id" title="inductive">step_transient_callstack</span></a> <a class="idref" href="#S:19"><span class="id" title="variable">S</span></a> <a class="idref" href="#xs1:28"><span class="id" title="variable">xs1</span></a> <a class="idref" href="#xs2:29"><span class="id" title="variable">xs2</span></a>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <a id="step_callstack" class="idref" href="#step_callstack"><span class="id" title="inductive">step_callstack</span></a> (<a id="S:31" class="idref" href="#S:31"><span class="id" title="binder">S</span></a>: <a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>) : <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
| <a id="sc_apply" class="idref" href="#sc_apply"><span class="id" title="constructor">sc_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="xs1:34" class="idref" href="#xs1:34"><span class="id" title="binder">xs1</span></a> <a id="xs2:35" class="idref" href="#xs2:35"><span class="id" title="binder">xs2</span></a> <a id="s1:36" class="idref" href="#s1:36"><span class="id" title="binder">s1</span></a> <a id="s2:37" class="idref" href="#s2:37"><span class="id" title="binder">s2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_transient_callstack"><span class="id" title="inductive">step_transient_callstack</span></a> <a class="idref" href="#S:31"><span class="id" title="variable">S</span></a> <a class="idref" href="#xs1:34"><span class="id" title="variable">xs1</span></a> <a class="idref" href="#xs2:35"><span class="id" title="variable">xs2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_transient_only"><span class="id" title="inductive">step_transient_only</span></a> <a class="idref" href="#xs1:34"><span class="id" title="variable">xs1</span></a> <a class="idref" href="#xs2:35"><span class="id" title="variable">xs2</span></a> <a class="idref" href="#s1:36"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:37"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_callstack:32"><span class="id" title="inductive">step_callstack</span></a> <a class="idref" href="#S:31"><span class="id" title="variable">S</span></a> <a class="idref" href="#s1:36"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:37"><span class="id" title="variable">s2</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.Semantics</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">VMPanic</span></a> <a class="idref" href="#"><span class="id" title="library">StaticMode</span></a> <a class="idref" href="#"><span class="id" title="library">isa.AssemblyToCore</span></a> <a class="idref" href="#"><span class="id" title="library">sem.SemanticCommon</span></a>.<br/>

<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="VMParameters" class="idref" href="#VMParameters"><span class="id" title="section">VMParameters</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="VM_INITIAL_FRAME_ERGS" class="idref" href="#VM_INITIAL_FRAME_ERGS"><span class="id" title="definition">VM_INITIAL_FRAME_ERGS</span></a>: <a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a> := <a class="idref" href="#Z.to_nat"><span class="id" title="definition">Z.to_nat</span></a> (<a class="idref" href="#unsigned_max"><span class="id" title="definition">unsigned_max</span></a> <a class="idref" href="#ergs_bits"><span class="id" title="definition">ergs_bits</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="CALL_LIKE_ERGS_COST:1" class="idref" href="#CALL_LIKE_ERGS_COST:1"><span class="id" title="binder">CALL_LIKE_ERGS_COST</span></a>  := <a class="idref" href="#Z.to_nat"><span class="id" title="definition">Z.to_nat</span></a> <a class="idref" href="#CALL_LIKE_ERGS_COST"><span class="id" title="definition">CALL_LIKE_ERGS_COST</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="VM_MAX_STACK_DEPTH" class="idref" href="#VM_MAX_STACK_DEPTH"><span class="id" title="definition">VM_MAX_STACK_DEPTH</span></a>: <a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a> := <a class="idref" href="#VM_INITIAL_FRAME_ERGS"><span class="id" title="definition">VM_INITIAL_FRAME_ERGS</span></a> <a class="idref" href="#2e0d8202c5a48097752d760d3a1db6a7"><span class="id" title="notation">/</span></a> <a class="idref" href="#VMParameters.CALL_LIKE_ERGS_COST"><span class="id" title="variable">CALL_LIKE_ERGS_COST</span></a> <span class="id" title="notation">+</span> 80.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#VMParameters"><span class="id" title="section">VMParameters</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="SmallStep" class="idref" href="#SmallStep"><span class="id" title="section">SmallStep</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="ins:2" class="idref" href="#ins:2"><span class="id" title="binder">ins</span></a> := @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#bound"><span class="id" title="definition">bound</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="update_pc_regular" class="idref" href="#update_pc_regular"><span class="id" title="definition">update_pc_regular</span></a> : <a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pc_map"><span class="id" title="definition">pc_map</span></a> (<span class="id" title="keyword">fun</span> <a id="x:3" class="idref" href="#x:3"><span class="id" title="binder">x</span></a> ⇒ <a class="idref" href="#uadd_wrap"><span class="id" title="definition">uadd_wrap</span></a> <a class="idref" href="#x:3"><span class="id" title="variable">x</span></a> <span class="id" title="notation">#</span> 1).<br/>

<br/>
</div>

<div class="doc"><p>Every instruction is either executed, skipped, or triggers panic
instantly. Panic can also be triggered later during the execution.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="action" class="idref" href="#action"><span class="id" title="inductive">action</span></a>: <span class="id" title="keyword">Type</span> := <a id="Execute" class="idref" href="#Execute"><span class="id" title="constructor">Execute</span></a> | <a id="Skip" class="idref" href="#Skip"><span class="id" title="constructor">Skip</span></a> | <a id="Panic" class="idref" href="#Panic"><span class="id" title="constructor">Panic</span></a> : <a class="idref" href="#reason"><span class="id" title="inductive">reason</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#action:4"><span class="id" title="inductive">action</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>After the instruction is selected, panic is immediately
triggered:</p>
<ul>
<li>on call stack overflow;</li>
<li>if the <span
class="inlinecode"><a class="idref" href="#base_cost"><span
class="id" title="definition">base_cost</span></a></span> of instruction
is unaffordable;</li>
<li>if the instruction is not allowed in user mode, and VM is in user
mode;</li>
<li>if the instruction is not allowed in static mode, and VM is in
static mode.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="chose_action" class="idref" href="#chose_action"><span class="id" title="definition">chose_action</span></a> (<a id="s:6" class="idref" href="#s:6"><span class="id" title="binder">s</span></a>:<a class="idref" href="#transient_state"><span class="id" title="record">transient_state</span></a>) (<a id="i:7" class="idref" href="#i:7"><span class="id" title="binder">i</span></a>:@<a class="idref" href="#predicated"><span class="id" title="record">predicated</span></a> <a class="idref" href="#asm_instruction"><span class="id" title="inductive">asm_instruction</span></a>) : <a class="idref" href="#action"><span class="id" title="inductive">action</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#stack_overflow"><span class="id" title="definition">stack_overflow</span></a> <a class="idref" href="#VM_MAX_STACK_DEPTH"><span class="id" title="definition">VM_MAX_STACK_DEPTH</span></a> (<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s:6"><span class="id" title="variable">s</span></a>) <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Panic"><span class="id" title="constructor">Panic</span></a> <a class="idref" href="#CallStackOverflow"><span class="id" title="constructor">CallStackOverflow</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#negb"><span class="id" title="definition">negb</span></a> (<a class="idref" href="#check_requires_kernel"><span class="id" title="definition">check_requires_kernel</span></a> <a class="idref" href="#i:7"><span class="id" title="variable">i</span></a>.(<a class="idref" href="#ins_spec"><span class="id" title="projection">ins_spec</span></a> <span class="id" title="var">_</span>) (<a class="idref" href="#in_kernel_mode"><span class="id" title="definition">in_kernel_mode</span></a> (<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s:6"><span class="id" title="variable">s</span></a>))) <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Panic"><span class="id" title="constructor">Panic</span></a> <a class="idref" href="#NotInKernelMode"><span class="id" title="constructor">NotInKernelMode</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#negb"><span class="id" title="definition">negb</span></a> (<a class="idref" href="#check_forbidden_static"><span class="id" title="definition">check_forbidden_static</span></a> <a class="idref" href="#i:7"><span class="id" title="variable">i</span></a>.(<a class="idref" href="#ins_spec"><span class="id" title="projection">ins_spec</span></a> <span class="id" title="var">_</span>) (<a class="idref" href="#active_extframe"><span class="id" title="definition">active_extframe</span></a> (<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s:6"><span class="id" title="variable">s</span></a>)).(<a class="idref" href="#ecf_is_static"><span class="id" title="projection">ecf_is_static</span></a>)) <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Panic"><span class="id" title="constructor">Panic</span></a> <a class="idref" href="#ForbiddenInStaticMode"><span class="id" title="constructor">ForbiddenInStaticMode</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#ergs_of"><span class="id" title="definition">ergs_of</span></a> (<a class="idref" href="#base_cost"><span class="id" title="definition">base_cost</span></a> <a class="idref" href="#i:7"><span class="id" title="variable">i</span></a>.(<a class="idref" href="#ins_spec"><span class="id" title="projection">ins_spec</span></a> <span class="id" title="var">_</span>)) <a class="idref" href="#::ZMod_scope:x_'>'_x"><span class="id" title="notation">></span></a> <a class="idref" href="#ergs_remaining"><span class="id" title="definition">ergs_remaining</span></a> (<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s:6"><span class="id" title="variable">s</span></a>) <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Panic"><span class="id" title="constructor">Panic</span></a> <a class="idref" href="#NotEnoughErgsToPayBaseCost"><span class="id" title="constructor">NotEnoughErgsToPayBaseCost</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#negb"><span class="id" title="definition">negb</span></a> (<a class="idref" href="#predicate_holds"><span class="id" title="definition">predicate_holds</span></a> <a class="idref" href="#i:7"><span class="id" title="variable">i</span></a>.(<a class="idref" href="#ins_cond"><span class="id" title="projection">ins_cond</span></a> <span class="id" title="var">_</span>) (<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a> <a class="idref" href="#s:6"><span class="id" title="variable">s</span></a>)) <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Skip"><span class="id" title="constructor">Skip</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="#Execute"><span class="id" title="constructor">Execute</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>The definition <span
class="inlinecode"><a class="idref" href="#smallsteps"><span
class="id" title="definition">smallsteps</span></a></span> gathers the
references to all the small step predicates for various <span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span>s.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="smallsteps" class="idref" href="#smallsteps"><span class="id" title="definition">smallsteps</span></a> : <a class="idref" href="#list"><span class="id" title="inductive">list</span></a> (@<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">[</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_nop"><span class="id" title="inductive">step_nop</span></a>                  <a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:8" class="idref" href="#i:8"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (<a class="idref" href="#tstep_flags"><span class="id" title="definition">tstep_flags</span></a>     <a class="idref" href="#step_add"><span class="id" title="inductive">step_add</span></a>                <a class="idref" href="#i:8"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:9" class="idref" href="#i:9"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (<a class="idref" href="#tstep_flags"><span class="id" title="definition">tstep_flags</span></a>     <a class="idref" href="#step_sub"><span class="id" title="inductive">step_sub</span></a>                <a class="idref" href="#i:9"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:10" class="idref" href="#i:10"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (<a class="idref" href="#tstep_flags"><span class="id" title="definition">tstep_flags</span></a>     <a class="idref" href="#step_and"><span class="id" title="inductive">step_and</span></a>                <a class="idref" href="#i:10"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_context"><span class="id" title="inductive">step_context</span></a><a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:11" class="idref" href="#i:11"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (<a class="idref" href="#tstep_flags"><span class="id" title="definition">tstep_flags</span></a>     <a class="idref" href="#step_mul"><span class="id" title="inductive">step_mul</span></a>                <a class="idref" href="#i:11"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:12" class="idref" href="#i:12"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (<a class="idref" href="#tstep_flags"><span class="id" title="definition">tstep_flags</span></a>     <a class="idref" href="#step_div"><span class="id" title="inductive">step_div</span></a>                <a class="idref" href="#i:12"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:13" class="idref" href="#i:13"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (                <a class="idref" href="#step_farret"><span class="id" title="inductive">step_farret</span></a>             <a class="idref" href="#i:13"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_farrevert"><span class="id" title="inductive">step_farrevert</span></a>            <a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_farcall"><span class="id" title="inductive">step_farcall</span></a>              <a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_jump"><span class="id" title="inductive">step_jump</span></a><a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:14" class="idref" href="#i:14"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (                <a class="idref" href="#step_load"><span class="id" title="inductive">step_load</span></a>               <a class="idref" href="#i:14"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:15" class="idref" href="#i:15"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (                <a class="idref" href="#step_load_inc"><span class="id" title="inductive">step_load_inc</span></a>           <a class="idref" href="#i:15"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:16" class="idref" href="#i:16"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (                <a class="idref" href="#step_load_ptr"><span class="id" title="inductive">step_load_ptr</span></a>           <a class="idref" href="#i:16"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:17" class="idref" href="#i:17"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (                <a class="idref" href="#step_load_ptr_inc"><span class="id" title="inductive">step_load_ptr_inc</span></a>       <a class="idref" href="#i:17"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:18" class="idref" href="#i:18"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (                <a class="idref" href="#step_static_read"><span class="id" title="inductive">step_static_read</span></a>        <a class="idref" href="#i:18"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:19" class="idref" href="#i:19"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (                <a class="idref" href="#step_static_read_inc"><span class="id" title="inductive">step_static_read_inc</span></a>    <a class="idref" href="#i:19"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:20" class="idref" href="#i:20"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (<a class="idref" href="#tstep_flags"><span class="id" title="definition">tstep_flags</span></a>     <a class="idref" href="#step_mul"><span class="id" title="inductive">step_mul</span></a>                <a class="idref" href="#i:20"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:21" class="idref" href="#i:21"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_callstack"><span class="id" title="inductive">step_callstack</span></a> (                <a class="idref" href="#step_sp_add"><span class="id" title="inductive">step_sp_add</span></a>             <a class="idref" href="#i:21"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:22" class="idref" href="#i:22"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_callstack"><span class="id" title="inductive">step_callstack</span></a> (                <a class="idref" href="#step_sp_sub"><span class="id" title="inductive">step_sp_sub</span></a>             <a class="idref" href="#i:22"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_nearcall"><span class="id" title="inductive">step_nearcall</span></a>             <a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panicto"><span class="id" title="inductive">step_panicto</span></a>              <a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:23" class="idref" href="#i:23"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (                <a class="idref" href="#step_nearret"><span class="id" title="inductive">step_nearret</span></a>            <a class="idref" href="#i:23"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:24" class="idref" href="#i:24"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (                <a class="idref" href="#step_nearretto"><span class="id" title="inductive">step_nearretto</span></a>          <a class="idref" href="#i:24"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_nearrevert"><span class="id" title="inductive">step_nearrevert</span></a>           <a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_nearrevertto"><span class="id" title="inductive">step_nearrevertto</span></a>         <a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_event"><span class="id" title="inductive">step_event</span></a>                <a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:25" class="idref" href="#i:25"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (<a class="idref" href="#tstep_flags"><span class="id" title="definition">tstep_flags</span></a>     <a class="idref" href="#step_or"><span class="id" title="inductive">step_or</span></a>                 <a class="idref" href="#i:25"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_oppanic"><span class="id" title="inductive">step_oppanic</span></a>              <a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_precompile"><span class="id" title="inductive">step_precompile</span></a>           <a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ptradd"><span class="id" title="inductive">step_ptradd</span></a>               <a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ptrsub"><span class="id" title="inductive">step_ptrsub</span></a>               <a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ptrshrink"><span class="id" title="inductive">step_ptrshrink</span></a>            <a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ptrpack"><span class="id" title="inductive">step_ptrpack</span></a>              <a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:26" class="idref" href="#i:26"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (<a class="idref" href="#tstep_flags"><span class="id" title="definition">tstep_flags</span></a>     <a class="idref" href="#step_rol"><span class="id" title="inductive">step_rol</span></a>                <a class="idref" href="#i:26"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:27" class="idref" href="#i:27"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (<a class="idref" href="#tstep_flags"><span class="id" title="definition">tstep_flags</span></a>     <a class="idref" href="#step_ror"><span class="id" title="inductive">step_ror</span></a>                <a class="idref" href="#i:27"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_sload"><span class="id" title="inductive">step_sload</span></a>                <a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_sstore"><span class="id" title="inductive">step_sstore</span></a>               <a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_tload"><span class="id" title="inductive">step_tload</span></a>                <a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_tstore"><span class="id" title="inductive">step_tstore</span></a>               <a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:28" class="idref" href="#i:28"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (<a class="idref" href="#tstep_flags"><span class="id" title="definition">tstep_flags</span></a>     <a class="idref" href="#step_shl"><span class="id" title="inductive">step_shl</span></a>                <a class="idref" href="#i:28"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:29" class="idref" href="#i:29"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (<a class="idref" href="#tstep_flags"><span class="id" title="definition">tstep_flags</span></a>     <a class="idref" href="#step_shr"><span class="id" title="inductive">step_shr</span></a>                <a class="idref" href="#i:29"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:30" class="idref" href="#i:30"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (                <a class="idref" href="#step_store"><span class="id" title="inductive">step_store</span></a>              <a class="idref" href="#i:30"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:31" class="idref" href="#i:31"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (                <a class="idref" href="#step_storeinc"><span class="id" title="inductive">step_storeinc</span></a>           <a class="idref" href="#i:31"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:32" class="idref" href="#i:32"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (                <a class="idref" href="#step_static_write"><span class="id" title="inductive">step_static_write</span></a>       <a class="idref" href="#i:32"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:33" class="idref" href="#i:33"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (                <a class="idref" href="#step_static_write_inc"><span class="id" title="inductive">step_static_write_inc</span></a>    <a class="idref" href="#i:33"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_tol1"><span class="id" title="inductive">step_tol1</span></a>                 <a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="i:34" class="idref" href="#i:34"><span class="id" title="binder">i</span></a> ⇒ <a class="idref" href="#step_transient"><span class="id" title="inductive">step_transient</span></a> (<a class="idref" href="#tstep_flags"><span class="id" title="definition">tstep_flags</span></a>     <a class="idref" href="#step_xor"><span class="id" title="inductive">step_xor</span></a>                <a class="idref" href="#i:34"><span class="id" title="variable">i</span></a>)<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_increment_tx"><span class="id" title="inductive">step_increment_tx</span></a><br/>
<br/>
&nbsp;&nbsp;<a class="idref" href="#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">]</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="dispatch" class="idref" href="#dispatch"><span class="id" title="inductive">dispatch</span></a>: @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
&nbsp;&nbsp;| <a id="dispatch_apply" class="idref" href="#dispatch_apply"><span class="id" title="constructor">dispatch_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="s1:37" class="idref" href="#s1:37"><span class="id" title="binder">s1</span></a> <a id="s2:38" class="idref" href="#s2:38"><span class="id" title="binder">s2</span></a> <a id="ins:39" class="idref" href="#ins:39"><span class="id" title="binder">ins</span></a> <a id="S:40" class="idref" href="#S:40"><span class="id" title="binder">S</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#In"><span class="id" title="definition">In</span></a> <a class="idref" href="#S:40"><span class="id" title="variable">S</span></a> <a class="idref" href="#smallsteps"><span class="id" title="definition">smallsteps</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#S:40"><span class="id" title="variable">S</span></a> <a class="idref" href="#ins:39"><span class="id" title="variable">ins</span></a> <a class="idref" href="#s1:37"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:38"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#dispatch:35"><span class="id" title="inductive">dispatch</span></a> <a class="idref" href="#ins:39"><span class="id" title="variable">ins</span></a> <a class="idref" href="#s1:37"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:38"><span class="id" title="variable">s2</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable Variables</span> <span class="id" title="var">cs</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="execute_action" class="idref" href="#execute_action"><span class="id" title="inductive">execute_action</span></a>: <a class="idref" href="#action"><span class="id" title="inductive">action</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
&nbsp;&nbsp;| <a id="ea_execute" class="idref" href="#ea_execute"><span class="id" title="constructor">ea_execute</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;`(<span class="id" title="keyword">∀</span> <a id="instr:43" class="idref" href="#instr:43"><span class="id" title="binder">instr</span></a> <a id="gs:44" class="idref" href="#gs:44"><span class="id" title="binder">gs</span></a> <a id="instr_bound:45" class="idref" href="#instr_bound:45"><span class="id" title="binder">instr_bound</span></a> <a id="new_s:46" class="idref" href="#new_s:46"><span class="id" title="binder">new_s</span></a> <a id="xs0:47" class="idref" href="#xs0:47"><span class="id" title="binder">xs0</span></a> <a id="xs1:48" class="idref" href="#xs1:48"><span class="id" title="binder">xs1</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cs0</span> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#xs0:47"><span class="id" title="variable">xs0</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cs1</span> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#update_pc_regular"><span class="id" title="definition">update_pc_regular</span></a> <span class="id" title="var">cs0</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pay"><span class="id" title="inductive">pay</span></a> (<a class="idref" href="#ergs_of"><span class="id" title="definition">ergs_of</span></a> (<a class="idref" href="#base_cost"><span class="id" title="definition">base_cost</span></a> <a class="idref" href="#instr:43"><span class="id" title="variable">instr</span></a>)) <span class="id" title="var">cs1</span> <span class="id" title="var">cs2</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bind_operands"><span class="id" title="definition">bind_operands</span></a> (<a class="idref" href="#xs0:47"><span class="id" title="variable">xs0</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <span class="id" title="notation">:=</span> <span class="id" title="var">cs2</span> <span class="id" title="notation">|></span>) <a class="idref" href="#xs1:48"><span class="id" title="variable">xs1</span></a> <a class="idref" href="#instr:43"><span class="id" title="variable">instr</span></a> <a class="idref" href="#instr_bound:45"><span class="id" title="variable">instr_bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="s1:49" class="idref" href="#s1:49"><span class="id" title="binder">s1</span></a> := <a class="idref" href="#mk_state"><span class="id" title="constructor">mk_state</span></a> <a class="idref" href="#xs1:48"><span class="id" title="variable">xs1</span></a> <a class="idref" href="#gs:44"><span class="id" title="variable">gs</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#dispatch"><span class="id" title="inductive">dispatch</span></a> <a class="idref" href="#instr_bound:45"><span class="id" title="variable">instr_bound</span></a> <a class="idref" href="#s1:49"><span class="id" title="variable">s1</span></a> <a class="idref" href="#new_s:46"><span class="id" title="variable">new_s</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#execute_action:41"><span class="id" title="inductive">execute_action</span></a> <a class="idref" href="#Execute"><span class="id" title="constructor">Execute</span></a> <a class="idref" href="#instr:43"><span class="id" title="variable">instr</span></a> (<a class="idref" href="#mk_state"><span class="id" title="constructor">mk_state</span></a> <a class="idref" href="#xs0:47"><span class="id" title="variable">xs0</span></a> <a class="idref" href="#gs:44"><span class="id" title="variable">gs</span></a>) <a class="idref" href="#new_s:46"><span class="id" title="variable">new_s</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;| <a id="ea_skip" class="idref" href="#ea_skip"><span class="id" title="constructor">ea_skip</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;`(<span class="id" title="keyword">∀</span> <a id="instr:53" class="idref" href="#instr:53"><span class="id" title="binder">instr</span></a> <a id="gs:54" class="idref" href="#gs:54"><span class="id" title="binder">gs</span></a> <a id="xs0:55" class="idref" href="#xs0:55"><span class="id" title="binder">xs0</span></a> <a id="xs1:56" class="idref" href="#xs1:56"><span class="id" title="binder">xs1</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cs0</span> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#xs0:55"><span class="id" title="variable">xs0</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cs1</span> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#update_pc_regular"><span class="id" title="definition">update_pc_regular</span></a> <span class="id" title="var">cs0</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pay"><span class="id" title="inductive">pay</span></a> (<a class="idref" href="#ergs_of"><span class="id" title="definition">ergs_of</span></a> (<a class="idref" href="#base_cost"><span class="id" title="definition">base_cost</span></a> <a class="idref" href="#instr:53"><span class="id" title="variable">instr</span></a>)) <span class="id" title="var">cs1</span> <span class="id" title="var">cs2</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_s:57" class="idref" href="#new_s:57"><span class="id" title="binder">new_s</span></a> := <a class="idref" href="#mk_state"><span class="id" title="constructor">mk_state</span></a> <a class="idref" href="#xs1:56"><span class="id" title="variable">xs1</span></a> <a class="idref" href="#gs:54"><span class="id" title="variable">gs</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#execute_action:41"><span class="id" title="inductive">execute_action</span></a> <a class="idref" href="#Skip"><span class="id" title="constructor">Skip</span></a> <a class="idref" href="#instr:53"><span class="id" title="variable">instr</span></a> (<a class="idref" href="#mk_state"><span class="id" title="constructor">mk_state</span></a> <a class="idref" href="#xs0:55"><span class="id" title="variable">xs0</span></a> <a class="idref" href="#gs:54"><span class="id" title="variable">gs</span></a>) <a class="idref" href="#new_s:57"><span class="id" title="variable">new_s</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;| <a id="ea_panic" class="idref" href="#ea_panic"><span class="id" title="constructor">ea_panic</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="reason:61" class="idref" href="#reason:61"><span class="id" title="binder">reason</span></a> <a id="s:62" class="idref" href="#s:62"><span class="id" title="binder">s</span></a> <a id="new_s:63" class="idref" href="#new_s:63"><span class="id" title="binder">new_s</span></a> <a id="instr:64" class="idref" href="#instr:64"><span class="id" title="binder">instr</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#reason:61"><span class="id" title="variable">reason</span></a> <a class="idref" href="#s:62"><span class="id" title="variable">s</span></a> <a class="idref" href="#new_s:63"><span class="id" title="variable">new_s</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#execute_action:41"><span class="id" title="inductive">execute_action</span></a> (<a class="idref" href="#Panic"><span class="id" title="constructor">Panic</span></a> <a class="idref" href="#reason:61"><span class="id" title="variable">reason</span></a>) <a class="idref" href="#instr:64"><span class="id" title="variable">instr</span></a> <a class="idref" href="#s:62"><span class="id" title="variable">s</span></a> <a class="idref" href="#new_s:63"><span class="id" title="variable">new_s</span></a><br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable No Variables</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="fetch_predicated_instruction" class="idref" href="#fetch_predicated_instruction"><span class="id" title="definition">fetch_predicated_instruction</span></a> (<a id="s:65" class="idref" href="#s:65"><span class="id" title="binder">s</span></a>: <a class="idref" href="#transient_state"><span class="id" title="record">transient_state</span></a>) <a id="ins:66" class="idref" href="#ins:66"><span class="id" title="binder">ins</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#fetch_instr"><span class="id" title="definition">fetch_instr</span></a> <span class="id" title="var">_</span> <a class="idref" href="#instruction_invalid"><span class="id" title="definition">instruction_invalid</span></a> <span class="id" title="var">_</span> (<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a> <a class="idref" href="#s:65"><span class="id" title="variable">s</span></a>) (<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s:65"><span class="id" title="variable">s</span></a>) (<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a> <a class="idref" href="#s:65"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(@<a class="idref" href="#FetchIns"><span class="id" title="constructor">FetchIns</span></a> (<a class="idref" href="#predicated"><span class="id" title="record">predicated</span></a> <a class="idref" href="#asm_instruction"><span class="id" title="inductive">asm_instruction</span></a>) <a class="idref" href="#ins:66"><span class="id" title="variable">ins</span></a>).<br/>

<br/>
</div>

<div class="doc"><p><span
class="inlinecode"><a class="idref" href="#step"><span
class="id" title="inductive">step</span></a></span> is the main
predicate defining a VM transition in a small step structural
operational style.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step" class="idref" href="#step"><span class="id" title="inductive">step</span></a>: <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
&nbsp;&nbsp;| <a id="step_correct" class="idref" href="#step_correct"><span class="id" title="constructor">step_correct</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="s:69" class="idref" href="#s:69"><span class="id" title="binder">s</span></a> <a id="new_s:70" class="idref" href="#new_s:70"><span class="id" title="binder">new_s</span></a> : <a class="idref" href="#state"><span class="id" title="record">state</span></a>) <a id="cond:71" class="idref" href="#cond:71"><span class="id" title="binder">cond</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="instr:72" class="idref" href="#instr:72"><span class="id" title="binder">instr</span></a>:<a class="idref" href="#asm_instruction"><span class="id" title="inductive">asm_instruction</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="ins_bound:73" class="idref" href="#ins_bound:73"><span class="id" title="binder">ins_bound</span></a>:@<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#bound"><span class="id" title="definition">bound</span></a>),<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fetch_predicated_instruction"><span class="id" title="definition">fetch_predicated_instruction</span></a>  <a class="idref" href="#s:69"><span class="id" title="variable">s</span></a> (<a class="idref" href="#Ins"><span class="id" title="constructor">Ins</span></a> <span class="id" title="var">_</span> <a class="idref" href="#instr:72"><span class="id" title="variable">instr</span></a> <a class="idref" href="#cond:71"><span class="id" title="variable">cond</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#execute_action"><span class="id" title="inductive">execute_action</span></a> (<a class="idref" href="#chose_action"><span class="id" title="definition">chose_action</span></a> <a class="idref" href="#s:69"><span class="id" title="variable">s</span></a> (<a class="idref" href="#Ins"><span class="id" title="constructor">Ins</span></a> <span class="id" title="var">_</span> <a class="idref" href="#instr:72"><span class="id" title="variable">instr</span></a> <a class="idref" href="#cond:71"><span class="id" title="variable">cond</span></a>)) <a class="idref" href="#instr:72"><span class="id" title="variable">instr</span></a> <a class="idref" href="#s:69"><span class="id" title="variable">s</span></a> <a class="idref" href="#new_s:70"><span class="id" title="variable">new_s</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step:67"><span class="id" title="inductive">step</span></a> <a class="idref" href="#s:69"><span class="id" title="variable">s</span></a> <a class="idref" href="#new_s:70"><span class="id" title="variable">new_s</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#SmallStep"><span class="id" title="section">SmallStep</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.VMPanic</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Common</span></a> <a class="idref" href="#"><span class="id" title="library">isa.CoreSet</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Panics" class="idref" href="#Panics"><span class="id" title="section">Panics</span></a>.<br/>
</div>

<div class="doc"><h1 id="panic">Panic</h1>
<p><strong>Panic</strong> refers to a situation of irrecoverable error.
It can occur for one of the following reasons:</p>
<ul>
<li>There are not enough ergs to execute an action.</li>
<li>Executing an instruction requiring kernel mode in user mode.</li>
<li>Executing an instruction mutating global state in static mode.</li>
<li>Violation of one of VM inner invariants.</li>
<li>Overflow of callstack.</li>
<li>Attempt to execute an invalid instruction.</li>
<li>Providing an integer value (with the tag cleared) instead of a
pointer value (with the tag set) to an instruction that expects a tagged
fat pointer value, e.g. <span
class="inlinecode"><a class="idref" href="#OpPtrAdd"><span
class="id" title="constructor">OpPtrAdd</span></a></span>.</li>
</ul>
<h2 id="complete-list-of-panic-reasons">Complete list of panic
reasons</h2>
<p>The type <span
class="inlinecode"><a class="idref" href="#reason"><span
class="id" title="inductive">reason</span></a></span> describes all
situations where EraVM panics.</p>
<p><strong>Note</strong> this is an exhaustive list! If there is a panic
situation which does not match to any condition described by <span
class="inlinecode"><a class="idref" href="#reason"><span
class="id" title="inductive">reason</span></a></span>, please, report it
to Igor <code>iz@matterlabs.dev</code>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="reason" class="idref" href="#reason"><span class="id" title="inductive">reason</span></a> :=<br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>See <span
class="inlinecode"><a class="idref" href="#step_RetExt_ForwardFatPointer_requires_ptrtag"><span
class="id"
title="constructor">step_RetExt_ForwardFatPointer_requires_ptrtag</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="RetABIExistingFatPointerWithoutTag" class="idref" href="#RetABIExistingFatPointerWithoutTag"><span class="id" title="constructor">RetABIExistingFatPointerWithoutTag</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>See <span
class="inlinecode"><a class="idref" href="#step_RetExt_ForwardFatPointer_returning_older_pointer"><span
class="id"
title="constructor">step_RetExt_ForwardFatPointer_returning_older_pointer</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="RetABIReturnsPointerCreatedByCaller" class="idref" href="#RetABIReturnsPointerCreatedByCaller"><span class="id" title="constructor">RetABIReturnsPointerCreatedByCaller</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>Malformed <span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span> is such that <span
class="inlinecode"><a class="idref" href="#validate"><span
class="id" title="definition">validate</span></a></span> returns <span
class="inlinecode"><a class="idref" href="#false"><span
class="id" title="constructor">false</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="FatPointerMalformed" class="idref" href="#FatPointerMalformed"><span class="id" title="constructor">FatPointerMalformed</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>See <span
class="inlinecode"><a class="idref" href="#step_PtrAdd_overflow"><span
class="id" title="constructor">step_PtrAdd_overflow</span></a></span>
and <span
class="inlinecode"><a class="idref" href="#step_PtrSub_underflow"><span
class="id"
title="constructor">step_PtrSub_underflow</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="FatPointerOverflow" class="idref" href="#FatPointerOverflow"><span class="id" title="constructor">FatPointerOverflow</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>See <span
class="inlinecode"><a class="idref" href="#step_PtrAdd_diff_too_large"><span
class="id"
title="constructor">step_PtrAdd_diff_too_large</span></a></span> and
<span
class="inlinecode"><a class="idref" href="#step_PtrSub_diff_too_large"><span
class="id"
title="constructor">step_PtrSub_diff_too_large</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="FatPointerDeltaTooLarge" class="idref" href="#FatPointerDeltaTooLarge"><span class="id" title="constructor">FatPointerDeltaTooLarge</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>See e.g. <span
class="inlinecode"><a class="idref" href="#step_RetExt_heapvar_growth_unaffordable"><span
class="id"
title="constructor">step_RetExt_heapvar_growth_unaffordable</span></a></span></li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="FatPointerCreationUnaffordable" class="idref" href="#FatPointerCreationUnaffordable"><span class="id" title="constructor">FatPointerCreationUnaffordable</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>See <span
class="inlinecode"><a class="idref" href="#chose_action"><span
class="id" title="definition">chose_action</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="NotInKernelMode" class="idref" href="#NotInKernelMode"><span class="id" title="constructor">NotInKernelMode</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>See <span
class="inlinecode"><a class="idref" href="#chose_action"><span
class="id" title="definition">chose_action</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="ForbiddenInStaticMode" class="idref" href="#ForbiddenInStaticMode"><span class="id" title="constructor">ForbiddenInStaticMode</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>See <span
class="inlinecode"><a class="idref" href="#chose_action"><span
class="id" title="definition">chose_action</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="CallStackOverflow" class="idref" href="#CallStackOverflow"><span class="id" title="constructor">CallStackOverflow</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>See <span
class="inlinecode"><a class="idref" href="#step_PtrPack_notzero"><span
class="id"
title="constructor">step_PtrPack_notzero</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="PtrPackExpectsOp2Low128BitsZero" class="idref" href="#PtrPackExpectsOp2Low128BitsZero"><span class="id" title="constructor">PtrPackExpectsOp2Low128BitsZero</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>Instruction expects a tagged <span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span>, e.g. <span
class="inlinecode"><a class="idref" href="#step_PtrAdd_in1_not_ptr"><span
class="id"
title="constructor">step_PtrAdd_in1_not_ptr</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="ExpectedFatPointer" class="idref" href="#ExpectedFatPointer"><span class="id" title="constructor">ExpectedFatPointer</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>Instruction expects a non-tagged primitive value, e.g. <span
class="inlinecode"><a class="idref" href="#step_PtrAdd_in2_ptr"><span
class="id"
title="constructor">step_PtrAdd_in2_ptr</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="ExpectedInteger" class="idref" href="#ExpectedInteger"><span class="id" title="constructor">ExpectedInteger</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>Executing <span
class="inlinecode"><a class="idref" href="#OpPanic"><span
class="id" title="constructor">OpPanic</span></a></span> or <span
class="inlinecode"><a class="idref" href="#OpNearPanicTo"><span
class="id" title="constructor">OpNearPanicTo</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="TriggeredExplicitly" class="idref" href="#TriggeredExplicitly"><span class="id" title="constructor">TriggeredExplicitly</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>Attempt to dereference a pointer past <span
class="inlinecode"><a class="idref" href="#MAX_OFFSET_TO_DEREF_LOW_U32"><span
class="id"
title="definition">MAX_OFFSET_TO_DEREF_LOW_U32</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="HeapPtrOffsetTooLarge" class="idref" href="#HeapPtrOffsetTooLarge"><span class="id" title="constructor">HeapPtrOffsetTooLarge</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>Not enough ergs to pay for growing heap beyound the current
bound.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="HeapGrowthUnaffordable" class="idref" href="#HeapGrowthUnaffordable"><span class="id" title="constructor">HeapGrowthUnaffordable</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>Incrementing a heap pointer by executing <span
class="inlinecode"><a class="idref" href="#OpLoadInc"><span
class="id" title="constructor">OpLoadInc</span></a></span> or <span
class="inlinecode"><a class="idref" href="#OpStoreInc"><span
class="id" title="constructor">OpStoreInc</span></a></span> results in
overflow.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="HeapPtrIncOverflow" class="idref" href="#HeapPtrIncOverflow"><span class="id" title="constructor">HeapPtrIncOverflow</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>Incrementing a fat pointer by executing <span
class="inlinecode"><span class="id"
title="var">OpLoadPtrInc</span></span> results in overflow.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="FatPtrIncOverflow" class="idref" href="#FatPtrIncOverflow"><span class="id" title="constructor">FatPtrIncOverflow</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>Instructions e.g. <span
class="inlinecode"><a class="idref" href="#OpLoad"><span
class="id" title="constructor">OpLoad</span></a></span> expect a heap
pointer with a <span
class="inlinecode"><a class="idref" href="#is_ptr"><span
class="id" title="projection">is_ptr</span></a></span> tag reset, not a
fat pointer with a set tag.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="ExpectedHeapPointer" class="idref" href="#ExpectedHeapPointer"><span class="id" title="constructor">ExpectedHeapPointer</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>Not enough ergs to pay <span
class="inlinecode"><a class="idref" href="#base_cost"><span
class="id" title="definition">base_cost</span></a></span> of
instruction. Reminder: the cost is paid even if instruction is skipped
by predication.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="NotEnoughErgsToPayBaseCost" class="idref" href="#NotEnoughErgsToPayBaseCost"><span class="id" title="constructor">NotEnoughErgsToPayBaseCost</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>Far call expects to return an existing <span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span> but the provided
value is not tagged as pointer.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="FarCallInputIsNotPointerWhenExpected" class="idref" href="#FarCallInputIsNotPointerWhenExpected"><span class="id" title="constructor">FarCallInputIsNotPointerWhenExpected</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>Far call expects the storage of <span
class="inlinecode"><a class="idref" href="#DEPLOYER_SYSTEM_CONTRACT_ADDRESS"><span
class="id"
title="definition">DEPLOYER_SYSTEM_CONTRACT_ADDRESS</span></a></span> to
hold a valid <span
class="inlinecode"><a class="idref" href="#versioned_hash"><span
class="id" title="record">versioned_hash</span></a></span> for the
callee contract, but the hash for the callee contract is malformed.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="FarCallInvalidCodeHashFormat" class="idref" href="#FarCallInvalidCodeHashFormat"><span class="id" title="constructor">FarCallInvalidCodeHashFormat</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>In a far call, not enough ergs to pay for code decommitment.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="FarCallNotEnoughErgsToDecommit" class="idref" href="#FarCallNotEnoughErgsToDecommit"><span class="id" title="constructor">FarCallNotEnoughErgsToDecommit</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>In a far call, attempt to return a new <span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span> but it requires
growing heap and there are not enough ergs to pay for this growth.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="FarCallNotEnoughErgsToGrowMemory" class="idref" href="#FarCallNotEnoughErgsToGrowMemory"><span class="id" title="constructor">FarCallNotEnoughErgsToGrowMemory</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>Trying to far call a contract whose code is not yet deployed.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="FarCallCallInNowConstructedSystemContract" class="idref" href="#FarCallCallInNowConstructedSystemContract"><span class="id" title="constructor">FarCallCallInNowConstructedSystemContract</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ul>
<li>Attempt to write to a storage by executing <span
class="inlinecode"><a class="idref" href="#OpSStore"><span
class="id" title="constructor">OpSStore</span></a></span> but not enough
ergs to pay the associated cost. See <span
class="inlinecode"><a class="idref" href="#step_SStore_unaffordable"><span
class="id"
title="constructor">step_SStore_unaffordable</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="StorageWriteUnaffordable" class="idref" href="#StorageWriteUnaffordable"><span class="id" title="constructor">StorageWriteUnaffordable</span></a><br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="status" class="idref" href="#status"><span class="id" title="inductive">status</span></a> :=<br/>
&nbsp;&nbsp;| <a id="NoPanic" class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a><br/>
&nbsp;&nbsp;| <a id="Panic" class="idref" href="#Panic"><span class="id" title="constructor">Panic</span></a> : <a class="idref" href="#reason"><span class="id" title="inductive">reason</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#status:3"><span class="id" title="inductive">status</span></a><br/>
&nbsp;&nbsp;.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Panics"><span class="id" title="section">Panics</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.SemanticCommon</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span><br/>
<a class="idref" href="#"><span class="id" title="library">ABI</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">Addressing</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">Binding</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">CallStack</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">Common</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">Flags</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">KernelMode</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">MemoryContext</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">MemoryOps</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">State</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">Steps</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">TransientMemory</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">VMPanic</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">sem.StepPanic</span></a><br/>
.<br/>

<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect</span> <span class="id" title="module">ssrfun</span> <span class="id" title="module">ssrbool</span> <span class="id" title="module">eqtype</span> <span class="id" title="module">ssreflect.tuple</span>.<br/>

<br/>
<span class="id" title="keyword">Import</span><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Addressing</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Bool</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Common</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Coder</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Core</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Flags</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">CallStack</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Decommitter</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Ergs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">GPR</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">List</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ListNotations"><span class="id" title="module">ListNotations</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">KernelMode</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">MemoryContext</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">memory.Depot</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">MemoryBase</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">MemoryOps</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Pointer</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="module">RecordSetNotations</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">State</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">ZArith</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">ZBits</span></a>.<br/>
<span class="id" title="keyword">Export</span> <a class="idref" href="#"><span class="id" title="module">Steps</span></a> <a class="idref" href="#"><span class="id" title="module">Binding</span></a> <a class="idref" href="#"><span class="id" title="module">VMPanic</span></a> <a class="idref" href="#"><span class="id" title="module">StepPanic</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Params" class="idref" href="#Params"><span class="id" title="section">Params</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="MAX_OFFSET_TO_DEREF_LOW_U32" class="idref" href="#MAX_OFFSET_TO_DEREF_LOW_U32"><span class="id" title="definition">MAX_OFFSET_TO_DEREF_LOW_U32</span></a>: <a class="idref" href="#u32"><span class="id" title="definition">u32</span></a> := <span class="id" title="definition">fromZ</span> (2<a class="idref" href="#14ef112b66e341f773bd1e9d05816f43"><span class="id" title="notation">^</span></a>32 <a class="idref" href="#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 33)%<span class="id" title="var">Z</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="MAX_OFFSET_FOR_ADD_SUB" class="idref" href="#MAX_OFFSET_FOR_ADD_SUB"><span class="id" title="definition">MAX_OFFSET_FOR_ADD_SUB</span></a>: <a class="idref" href="#u256"><span class="id" title="definition">u256</span></a> := <span class="id" title="definition">fromZ</span> (2<a class="idref" href="#14ef112b66e341f773bd1e9d05816f43"><span class="id" title="notation">^</span></a>32)%<span class="id" title="var">Z</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Params"><span class="id" title="section">Params</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Depot" class="idref" href="#Depot"><span class="id" title="section">Depot</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="is_rollup" class="idref" href="#is_rollup"><span class="id" title="definition">is_rollup</span></a> (<a id="xstack:1" class="idref" href="#xstack:1"><span class="id" title="binder">xstack</span></a>: <a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a>) : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> := <a class="idref" href="#zero8"><span class="id" title="definition">zero8</span></a> <span class="id" title="notation">==</span> <a class="idref" href="#current_shard"><span class="id" title="definition">current_shard</span></a> <a class="idref" href="#xstack:1"><span class="id" title="variable">xstack</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="net_pubdata" class="idref" href="#net_pubdata"><span class="id" title="definition">net_pubdata</span></a> <a id="cs:2" class="idref" href="#cs:2"><span class="id" title="binder">cs</span></a> : <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#is_rollup"><span class="id" title="definition">is_rollup</span></a> <a class="idref" href="#cs:2"><span class="id" title="variable">cs</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="#INITIAL_STORAGE_WRITE_PUBDATA_BYTES"><span class="id" title="definition">INITIAL_STORAGE_WRITE_PUBDATA_BYTES</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> 0%<span class="id" title="var">Z</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Depot"><span class="id" title="section">Depot</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="current_storage_fqa" class="idref" href="#current_storage_fqa"><span class="id" title="definition">current_storage_fqa</span></a> (<a id="xstack:3" class="idref" href="#xstack:3"><span class="id" title="binder">xstack</span></a>:<a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a>) : <a class="idref" href="#fqa_storage"><span class="id" title="record">fqa_storage</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="#mk_fqa_storage"><span class="id" title="constructor">mk_fqa_storage</span></a> (<a class="idref" href="#current_shard"><span class="id" title="definition">current_shard</span></a> <a class="idref" href="#xstack:3"><span class="id" title="variable">xstack</span></a>) (<a class="idref" href="#current_contract"><span class="id" title="definition">current_contract</span></a> <a class="idref" href="#xstack:3"><span class="id" title="variable">xstack</span></a>).<br/>

<br/>
<span class="comment">(*&nbsp;FIXME&nbsp;*)</span><br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="bitwise_flags" class="idref" href="#bitwise_flags"><span class="id" title="definition">bitwise_flags</span></a> (<a id="result:4" class="idref" href="#result:4"><span class="id" title="binder">result</span></a>: <a class="idref" href="#word"><span class="id" title="definition">Core.word</span></a>) : <a class="idref" href="#flags_state"><span class="id" title="record">Flags.flags_state</span></a> := <a class="idref" href="#bflags"><span class="id" title="definition">Flags.bflags</span></a> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a> (<a class="idref" href="#result:4"><span class="id" title="variable">result</span></a> <span class="id" title="notation">==</span> <a class="idref" href="#zero256"><span class="id" title="definition">zero256</span></a>) <a class="idref" href="#false"><span class="id" title="constructor">false</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="topmost_128_bits_match" class="idref" href="#topmost_128_bits_match"><span class="id" title="definition">topmost_128_bits_match</span></a> (<a id="x:5" class="idref" href="#x:5"><span class="id" title="binder">x</span></a> <a id="y:6" class="idref" href="#y:6"><span class="id" title="binder">y</span></a> : <a class="idref" href="#word"><span class="id" title="definition">Core.word</span></a>) : <span class="id" title="keyword">Prop</span> := @<span class="id" title="definition">high</span> 128 128 <a class="idref" href="#x:5"><span class="id" title="variable">x</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> @<span class="id" title="definition">high</span> 128 128 <a class="idref" href="#y:6"><span class="id" title="variable">y</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.Nop</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="NoOpDefinition" class="idref" href="#NoOpDefinition"><span class="id" title="section">NoOpDefinition</span></a>.<br/>
</div>

<div class="doc"><h1 id="opnoop">OpNoOp</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpNoOp"><span
class="id" title="constructor">OpNoOp</span></a></span></p>
<h2 id="syntax">Syntax</h2>
<p><code>nop</code></p>
<h2 id="summary">Summary</h2>
<p>Do nothing.</p>
<h2 id="semantic">Semantic</h2>
<p>Do nothing.</p>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<h2 id="related-instructions">Related instructions</h2>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#OpNoOp"><span
class="id" title="constructor">OpNoOp</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpSpAdd"><span
class="id" title="constructor">OpSpAdd</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpSpSub"><span
class="id" title="constructor">OpSpSub</span></a></span> are encoded as
the same instruction.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_nop" class="idref" href="#step_nop"><span class="id" title="inductive">step_nop</span></a>: @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
&nbsp;&nbsp;| <a id="step_NoOp" class="idref" href="#step_NoOp"><span class="id" title="constructor">step_NoOp</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s:3" class="idref" href="#s:3"><span class="id" title="binder">s</span></a>, <a class="idref" href="#step_nop:1"><span class="id" title="inductive">step_nop</span></a> <a class="idref" href="#OpNoOp"><span class="id" title="constructor">OpNoOp</span></a> <a class="idref" href="#s:3"><span class="id" title="variable">s</span></a> <a class="idref" href="#s:3"><span class="id" title="variable">s</span></a><br/>
&nbsp;&nbsp;.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#NoOpDefinition"><span class="id" title="section">NoOpDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.SpAdd</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Arith</span></a> <a class="idref" href="#"><span class="id" title="module">Addressing</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">Resolution</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <span class="id" title="module">spec</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="SpAddDefinition" class="idref" href="#SpAddDefinition"><span class="id" title="section">SpAddDefinition</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_sp_add" class="idref" href="#step_sp_add"><span class="id" title="inductive">step_sp_add</span></a> : <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#callstack_smallstep"><span class="id" title="definition">callstack_smallstep</span></a> :=<br/>
</div>

<div class="doc"><h1 id="opspadd">OpSpAdd</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpSpAdd"><span
class="id" title="constructor">OpSpAdd</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#imm_in"><span
class="id" title="inductive">imm_in</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><code>incsp reg+imm</code></li>
<li><code>incsp reg</code></li>
<li><code>incsp imm</code></li>
</ul>
<h2 id="legacy-syntax">Legacy syntax</h2>
<p><code>nop r0, r0, stack+=[reg+imm]</code></p>
<h2 id="summary">Summary</h2>
<p>Add <code>(reg + imm)</code> to SP.</p>
<h2 id="semantic">Semantic</h2>
<p><span class="math inline">\mathit{SP_{new} := SP + (reg +
imm)}</span>, but only if there was no overflow.</p>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Adjusting SP e.g. reserving space on stack.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#OpSpSub"><span
class="id" title="constructor">OpSpSub</span></a></span> subtracts a
value from SP.</li>
<li><span
class="inlinecode"><a class="idref" href="#OpNoOp"><span
class="id" title="constructor">OpNoOp</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpSpAdd"><span
class="id" title="constructor">OpSpAdd</span></a></span> and <span
class="inlinecode"><a class="idref" href="#OpSpSub"><span
class="id" title="constructor">OpSpSub</span></a></span> are encoded as
the same instruction.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_op_sp_add" class="idref" href="#step_op_sp_add"><span class="id" title="constructor">step_op_sp_add</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="cs0:3" class="idref" href="#cs0:3"><span class="id" title="binder">cs0</span></a> <a id="new_cs:4" class="idref" href="#new_cs:4"><span class="id" title="binder">new_cs</span></a>: <a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a>) (<a id="old_sp:5" class="idref" href="#old_sp:5"><span class="id" title="binder">old_sp</span></a> <a id="intermediate_sp:6" class="idref" href="#intermediate_sp:6"><span class="id" title="binder">intermediate_sp</span></a> <a id="new_sp:7" class="idref" href="#new_sp:7"><span class="id" title="binder">new_sp</span></a> <a id="ofs:8" class="idref" href="#ofs:8"><span class="id" title="binder">ofs</span></a>: <a class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a>) <a id="op:9" class="idref" href="#op:9"><span class="id" title="binder">op</span></a> <a id="__:10" class="idref" href="#__:10"><span class="id" title="binder">__</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#sp_get"><span class="id" title="definition">sp_get</span></a> <a class="idref" href="#cs0:3"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#old_sp:5"><span class="id" title="variable">old_sp</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#intermediate_sp:6"><span class="id" title="variable">intermediate_sp</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#old_sp:5"><span class="id" title="variable">old_sp</span></a> <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">(</span></a><span class="id" title="definition">low</span> <a class="idref" href="#stack_address_bits"><span class="id" title="definition">stack_address_bits</span></a> <a class="idref" href="#op:9"><span class="id" title="variable">op</span></a><a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#new_sp:7"><span class="id" title="variable">new_sp</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#intermediate_sp:6"><span class="id" title="variable">intermediate_sp</span></a> <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <a class="idref" href="#ofs:8"><span class="id" title="variable">ofs</span></a><a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_cs:4"><span class="id" title="variable">new_cs</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#sp_update"><span class="id" title="definition">sp_update</span></a> <a class="idref" href="#new_sp:7"><span class="id" title="variable">new_sp</span></a> <a class="idref" href="#cs0:3"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_sp_add:1"><span class="id" title="inductive">step_sp_add</span></a> (<a class="idref" href="#OpSpAdd"><span class="id" title="constructor">OpSpAdd</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#__:10"><span class="id" title="variable">__</span></a> <a class="idref" href="#op:9"><span class="id" title="variable">op</span></a>) <a class="idref" href="#ofs:8"><span class="id" title="variable">ofs</span></a>) <a class="idref" href="#cs0:3"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#new_cs:4"><span class="id" title="variable">new_cs</span></a><br/>
&nbsp;&nbsp;.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#SpAddDefinition"><span class="id" title="section">SpAddDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.SpSub</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Arith</span></a> <a class="idref" href="#"><span class="id" title="module">Addressing</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">Resolution</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <span class="id" title="module">spec</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="SpSubDefinition" class="idref" href="#SpSubDefinition"><span class="id" title="section">SpSubDefinition</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
</div>

<div class="doc"><h1 id="opspsub">OpSpSub</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpSpSub"><span
class="id" title="constructor">OpSpSub</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#imm_in"><span
class="id" title="inductive">imm_in</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><code>decsp reg+imm</code></li>
<li><code>decsp reg</code></li>
<li><code>decsp imm</code></li>
</ul>
<h2 id="legacy-syntax">Legacy syntax</h2>
<p><code>nop stack-=[reg+imm]</code></p>
<h2 id="summary">Summary</h2>
<p>Subtract <code>(reg + imm)</code> from SP.</p>
<h2 id="semantic">Semantic</h2>
<p><span class="math inline">\mathit{SP_{new} := SP - (reg +
imm)}</span>, but only if there was no overflow.</p>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Adjusting SP e.g. deallocating space on stack.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#OpSpAdd"><span
class="id" title="constructor">OpSpAdd</span></a></span> increases
SP.</li>
<li><span
class="inlinecode"><a class="idref" href="#OpNoOp"><span
class="id" title="constructor">OpNoOp</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpSpAdd"><span
class="id" title="constructor">OpSpAdd</span></a></span> and <span
class="inlinecode"><a class="idref" href="#OpSpSub"><span
class="id" title="constructor">OpSpSub</span></a></span> are encoded as
the same instruction.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_sp_sub" class="idref" href="#step_sp_sub"><span class="id" title="inductive">step_sp_sub</span></a> : <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#callstack_smallstep"><span class="id" title="definition">callstack_smallstep</span></a> :=<br/>
&nbsp;&nbsp;| <a id="step_op_sp_sub" class="idref" href="#step_op_sp_sub"><span class="id" title="constructor">step_op_sp_sub</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="cs0:3" class="idref" href="#cs0:3"><span class="id" title="binder">cs0</span></a> <a id="new_cs:4" class="idref" href="#new_cs:4"><span class="id" title="binder">new_cs</span></a>: <a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a>) (<a id="old_sp:5" class="idref" href="#old_sp:5"><span class="id" title="binder">old_sp</span></a> <a id="intermediate_sp:6" class="idref" href="#intermediate_sp:6"><span class="id" title="binder">intermediate_sp</span></a> <a id="new_sp:7" class="idref" href="#new_sp:7"><span class="id" title="binder">new_sp</span></a> <a id="ofs:8" class="idref" href="#ofs:8"><span class="id" title="binder">ofs</span></a>: <a class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a>) <a id="op:9" class="idref" href="#op:9"><span class="id" title="binder">op</span></a> <a id="__:10" class="idref" href="#__:10"><span class="id" title="binder">__</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#sp_get"><span class="id" title="definition">sp_get</span></a> <a class="idref" href="#cs0:3"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#old_sp:5"><span class="id" title="variable">old_sp</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#intermediate_sp:6"><span class="id" title="variable">intermediate_sp</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#old_sp:5"><span class="id" title="variable">old_sp</span></a> <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">(</span></a><span class="id" title="definition">low</span> <a class="idref" href="#stack_address_bits"><span class="id" title="definition">stack_address_bits</span></a> <a class="idref" href="#op:9"><span class="id" title="variable">op</span></a><a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#new_sp:7"><span class="id" title="variable">new_sp</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#intermediate_sp:6"><span class="id" title="variable">intermediate_sp</span></a> <a class="idref" href="#::ZMod_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="#ofs:8"><span class="id" title="variable">ofs</span></a><a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_cs:4"><span class="id" title="variable">new_cs</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#sp_update"><span class="id" title="definition">sp_update</span></a> <a class="idref" href="#new_sp:7"><span class="id" title="variable">new_sp</span></a> <a class="idref" href="#cs0:3"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_sp_sub:1"><span class="id" title="inductive">step_sp_sub</span></a> (<a class="idref" href="#OpSpSub"><span class="id" title="constructor">OpSpSub</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#__:10"><span class="id" title="variable">__</span></a> <a class="idref" href="#op:9"><span class="id" title="variable">op</span></a>) <a class="idref" href="#ofs:8"><span class="id" title="variable">ofs</span></a>) <a class="idref" href="#cs0:3"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#new_cs:4"><span class="id" title="variable">new_cs</span></a><br/>
&nbsp;&nbsp;.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#SpSubDefinition"><span class="id" title="section">SpSubDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.Jump</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Addressing</span></a> <a class="idref" href="#"><span class="id" title="module">Bool</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Predication</span></a> <a class="idref" href="#"><span class="id" title="module">GPR</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryOps</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <span class="id" title="module">RecordSetNotations</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="JumpDefinition" class="idref" href="#JumpDefinition"><span class="id" title="section">JumpDefinition</span></a>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <a id="step_jump_aux" class="idref" href="#step_jump_aux"><span class="id" title="inductive">step_jump_aux</span></a>: @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
</div>

<div class="doc"><h1 id="opjump">OpJump</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpJump"><span
class="id" title="constructor">OpJump</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_any"><span
class="id" title="inductive">in_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><p><code>jump in1, out1</code></p></li>
<li><p><code>jump in1</code>, alias for
<code>jump in1, r0</code></p></li>
</ul>
<h2 id="legacy-syntax">Legacy syntax</h2>
<ul>
<li><code>jmp destination, ret_addr</code></li>
<li><code>jmp destination</code>, alias for
<code>jmp destination, r0</code></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Unconditional jump (becomes conditional through predication).</p>
<p><strong>Note</strong>: Argument <code>destination</code> uses the
full addressing mode <span
class="inlinecode"><a class="idref" href="#in_any"><span
class="id" title="inductive">in_any</span></a></span>, therefore can be
immediate 16-bit value, register, a register value with an offset, and
so on.</p>
<p><strong>Note</strong>: in future (past VM 1.5) the output operand may
gain full addressing mode, i.e. its type will be <span
class="inlinecode"><a class="idref" href="#out_any"><span
class="id" title="inductive">out_any</span></a></span>.</p>
<h2 id="semantic">Semantic</h2>
<ul>
<li>Fetch a new address from operand <code>destination</code>.</li>
<li>Save the old PC (return address) to <code>return_address</code>.
This happens after PC’s increment, so this value equals is the
addrees</li>
<li>Assign to current PC the fetched value truncated to <span
class="inlinecode"><a class="idref" href="#code_address_bits"><span
class="id" title="definition">code_address_bits</span></a></span>
bits.</li>
</ul>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, because <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
<li>SP, if <code>in1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span> addressing
mode, or if <code>out1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span> addressing
mode.</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li><p>Unconditional jumps</p></li>
<li><p>In EraVM, all instructions are predicated (see <span
class="inlinecode"><span class="id"
title="var">Predication.cond</span></span>), therefore in conjunction
with a required condition type <span
class="inlinecode"><a class="idref" href="#OpJump"><span
class="id" title="constructor">OpJump</span></a></span> implements a
conditional jump instruction.</p></li>
<li><p>Currently, the compiler may emit jumps rather than <span
class="inlinecode"><a class="idref" href="#OpNearCall"><span
class="id" title="constructor">OpNearCall</span></a></span>/<span
class="inlinecode"><a class="idref" href="#OpRet"><span
class="id" title="constructor">OpRet</span></a></span> and similar
instructions when possible. It is cheaper, and most functions do not
require to install a non-default <span
class="inlinecode"><a class="idref" href="#cf_exception_handler_location"><span
class="id"
title="projection">cf_exception_handler_location</span></a></span>, nor
passing less than all available ergs.</p></li>
<li><p>Can be used to implement cheap calling convention by playing both
the role of call-like and ret-like instruction.</p></li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<ul>
<li>Calls: see <span
class="inlinecode"><a class="idref" href="#OpNearCall"><span
class="id" title="constructor">OpNearCall</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpFarCall"><span
class="id" title="constructor">OpFarCall</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpMimicCall"><span
class="id" title="constructor">OpMimicCall</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
| <a id="step_jump_apply" class="idref" href="#step_jump_apply"><span class="id" title="constructor">step_jump_apply</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="dest_val:3" class="idref" href="#dest_val:3"><span class="id" title="binder">dest_val</span></a>: <a class="idref" href="#word"><span class="id" title="definition">word</span></a>) (<a id="cs:4" class="idref" href="#cs:4"><span class="id" title="binder">cs</span></a> <a id="new_cs:5" class="idref" href="#new_cs:5"><span class="id" title="binder">new_cs</span></a>: <a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a>) <a id="tag:6" class="idref" href="#tag:6"><span class="id" title="binder">tag</span></a> (<a id="ret_addr:7" class="idref" href="#ret_addr:7"><span class="id" title="binder">ret_addr</span></a>: <a class="idref" href="#code_address"><span class="id" title="definition">code_address</span></a>) (<a id="ret_addr_w:8" class="idref" href="#ret_addr_w:8"><span class="id" title="binder">ret_addr_w</span></a>: <a class="idref" href="#word"><span class="id" title="definition">word</span></a>),<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="dest_addr:9" class="idref" href="#dest_addr:9"><span class="id" title="binder">dest_addr</span></a> := <span class="id" title="definition">low</span> <a class="idref" href="#code_address_bits"><span class="id" title="definition">code_address_bits</span></a> <a class="idref" href="#dest_val:3"><span class="id" title="variable">dest_val</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_cs:5"><span class="id" title="variable">new_cs</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#pc_set"><span class="id" title="definition">pc_set</span></a> <a class="idref" href="#dest_addr:9"><span class="id" title="variable">dest_addr</span></a> <a class="idref" href="#cs:4"><span class="id" title="variable">cs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ret_addr:7"><span class="id" title="variable">ret_addr</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#pc_get"><span class="id" title="definition">pc_get</span></a> <a class="idref" href="#cs:4"><span class="id" title="variable">cs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ret_addr_w:8"><span class="id" title="variable">ret_addr_w</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#widen"><span class="id" title="definition">widen</span></a> <a class="idref" href="#word_bits"><span class="id" title="definition">word_bits</span></a> <a class="idref" href="#ret_addr:7"><span class="id" title="variable">ret_addr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_jump_aux:1"><span class="id" title="inductive">step_jump_aux</span></a> (<a class="idref" href="#OpJump"><span class="id" title="constructor">OpJump</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#tag:6"><span class="id" title="variable">tag</span></a> <a class="idref" href="#dest_val:3"><span class="id" title="variable">dest_val</span></a>) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#ret_addr_w:8"><span class="id" title="variable">ret_addr_w</span></a>)) <a class="idref" href="#cs:4"><span class="id" title="variable">cs</span></a> <a class="idref" href="#new_cs:5"><span class="id" title="variable">new_cs</span></a>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <a id="step_jump" class="idref" href="#step_jump"><span class="id" title="inductive">step_jump</span></a>: @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
| <a id="step_Jump" class="idref" href="#step_Jump"><span class="id" title="constructor">step_Jump</span></a>: <span class="id" title="keyword">∀</span> <a id="ins:12" class="idref" href="#ins:12"><span class="id" title="binder">ins</span></a> (<a id="s1:13" class="idref" href="#s1:13"><span class="id" title="binder">s1</span></a> <a id="s2:14" class="idref" href="#s2:14"><span class="id" title="binder">s2</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_callstack"><span class="id" title="inductive">step_callstack</span></a> (<a class="idref" href="#step_jump_aux"><span class="id" title="inductive">step_jump_aux</span></a> <a class="idref" href="#ins:12"><span class="id" title="variable">ins</span></a>) <a class="idref" href="#s1:13"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:14"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_jump:10"><span class="id" title="inductive">step_jump</span></a> <a class="idref" href="#ins:12"><span class="id" title="variable">ins</span></a> <a class="idref" href="#s1:13"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:14"><span class="id" title="variable">s2</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#JumpDefinition"><span class="id" title="section">JumpDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.Add</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Bool</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Flags</span></a> <a class="idref" href="#"><span class="id" title="module">CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">Modifiers</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect.tuple</span> <span class="id" title="module">ssreflect.eqtype</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="AddDefinition" class="idref" href="#AddDefinition"><span class="id" title="section">AddDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable Variables</span> <span class="id" title="var">op</span> <span class="id" title="var">tag</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_add" class="idref" href="#step_add"><span class="id" title="inductive">step_add</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#flags_tsmallstep"><span class="id" title="definition">flags_tsmallstep</span></a> :=<br/>
&nbsp;&nbsp;</div>

<div class="doc"><h1 id="opadd">OpAdd</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpAdd"><span
class="id" title="constructor">OpAdd</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_any"><span
class="id" title="inductive">in_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_any"><span
class="id" title="inductive">out_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">sf</span>:</span> <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><p><code>add in1, in2, out1</code></p></li>
<li><p><code>add! in1, in2, out1</code> to set <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span>
modifier</p></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Unsigned overflowing addition of two numbers modulo <span
class="math inline">2^{256}</span>.</p>
<h2 id="semantic">Semantic</h2>
<ul>
<li><p>result is computed by unsigned addition of two numbers with
overflow modulo <span class="math inline">2^{256}</span>.</p>
<p><span class="math display">result := op_1 + op_2 \mod
2^{256}</span></p></li>
<li><p>flags are computed as follows:</p>
<ul>
<li><code>LT_OF</code> is set if overflow occurs, i.e. <span
class="math inline">op_1 + op_2 \geq 2^{256}</span></li>
<li><code>EQ</code> is set if <span class="math inline">result =
0</span>.</li>
<li><code>GT</code> is set if both <code>LT_OF</code> and
<code>EQ</code> are cleared.</li>
</ul></li>
</ul>
<p>Reminder: flags are affected only if <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span> is set.</p>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, if <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
<li>SP, if <code>in1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span> addressing
mode, or if <code>out1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span> addressing
mode.</li>
</ul></li>
<li>Current stack memory page, if <code>out</code> resolves to it.</li>
<li>Flags, if <code>set_flags</code> modifier is set.</li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Arithmetic operations.</li>
<li>There is no dedicated <code>mov</code> instruction, so
<code>add</code> is used to copy values around. Copying A to B is
implemented as <code>add A, r0, B</code>.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<p>Flags are computed exactly as in <code>sub</code>, but the meaning of
overflow is different for addition and subtraction.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Add" class="idref" href="#step_Add"><span class="id" title="constructor">step_Add</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="mod_sf:3" class="idref" href="#mod_sf:3"><span class="id" title="binder">mod_sf</span></a> <a id="old_flags:4" class="idref" href="#old_flags:4"><span class="id" title="binder">old_flags</span></a> <a id="new_flags:5" class="idref" href="#new_flags:5"><span class="id" title="binder">new_flags</span></a> <a id="result:6" class="idref" href="#result:6"><span class="id" title="binder">result</span></a> <a id="new_OF:7" class="idref" href="#new_OF:7"><span class="id" title="binder">new_OF</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#new_OF:7"><span class="id" title="variable">new_OF</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#result:6"><span class="id" title="variable">result</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">op1</span> <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <span class="id" title="var">op2</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_EQ:8" class="idref" href="#new_EQ:8"><span class="id" title="binder">new_EQ</span></a> := <a class="idref" href="#result:6"><span class="id" title="variable">result</span></a> <span class="id" title="notation">==</span> <a class="idref" href="#zero256"><span class="id" title="definition">zero256</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_GT:9" class="idref" href="#new_GT:9"><span class="id" title="binder">new_GT</span></a> := <a class="idref" href="#negb"><span class="id" title="definition">negb</span></a> <a class="idref" href="#new_EQ:8"><span class="id" title="variable">new_EQ</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a> <a class="idref" href="#negb"><span class="id" title="definition">negb</span></a> <a class="idref" href="#new_OF:7"><span class="id" title="variable">new_OF</span></a> <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_flags:5"><span class="id" title="variable">new_flags</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#apply_set_flags"><span class="id" title="definition">apply_set_flags</span></a> <a class="idref" href="#mod_sf:3"><span class="id" title="variable">mod_sf</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#old_flags:4"><span class="id" title="variable">old_flags</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#bflags"><span class="id" title="definition">bflags</span></a> <a class="idref" href="#new_OF:7"><span class="id" title="variable">new_OF</span></a> <a class="idref" href="#new_EQ:8"><span class="id" title="variable">new_EQ</span></a> <a class="idref" href="#new_GT:9"><span class="id" title="variable">new_GT</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_add:1"><span class="id" title="inductive">step_add</span></a> (<a class="idref" href="#OpAdd"><span class="id" title="constructor">OpAdd</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag1</span> <span class="id" title="var">op1</span>) (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag2</span> <span class="id" title="var">op2</span>) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#result:6"><span class="id" title="variable">result</span></a>) <a class="idref" href="#mod_sf:3"><span class="id" title="variable">mod_sf</span></a>) <a class="idref" href="#old_flags:4"><span class="id" title="variable">old_flags</span></a> <a class="idref" href="#new_flags:5"><span class="id" title="variable">new_flags</span></a>)<br/>
&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable No Variables</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#AddDefinition"><span class="id" title="section">AddDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.Sub</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Bool</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Flags</span></a> <a class="idref" href="#"><span class="id" title="module">CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">Modifiers</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect.tuple</span> <span class="id" title="module">ssreflect.eqtype</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="SubDefinition" class="idref" href="#SubDefinition"><span class="id" title="section">SubDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable Variables</span> <span class="id" title="var">op</span> <span class="id" title="var">tag</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_sub" class="idref" href="#step_sub"><span class="id" title="inductive">step_sub</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#flags_tsmallstep"><span class="id" title="definition">flags_tsmallstep</span></a> :=<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc"><h1 id="opsub">OpSub</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpSub"><span
class="id" title="constructor">OpSub</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_any"><span
class="id" title="inductive">in_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_any"><span
class="id" title="inductive">out_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">swap</span>:</span>
<span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">sf</span>:</span> <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><p><code>sub in1, in2, out1</code></p></li>
<li><p><code>sub! in1, in2, out1</code> to set <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span>
modifier</p></li>
<li><p><code>sub.s in1, in2, out1</code> to set <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span>
modifier</p></li>
<li><p><code>sub.s! in1, in2, out1</code> to set both <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span> and <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span>
modifier</p></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Unsigned overflowing subtraction of two numbers modulo <span
class="math inline">2^{256}</span>.</p>
<h2 id="semantic">Semantic</h2>
<p><strong>Note</strong>: In the following description the operands are
bound after taking <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span> modifier into
account.</p>
<ul>
<li><p>result is computed by unsigned subtraction of two numbers with
overflow modulo <span class="math inline">2^{256}</span>.</p>
<p><span class="math display">result := \begin{cases}op_1 - op_2 &amp; ,
\text{if}\  op_1 \geq op_2\\ 2^{256} -  (op_2 - op_1) &amp;, \text{if}\
op_1 \lt op_2\end{cases}</span></p></li>
<li><p>flags are computed as follows:</p>
<ul>
<li><code>LT_OF</code> is set if overflow occurs, i.e. <span
class="math inline">op_1 \lt op_2</span></li>
<li><code>EQ</code> is set if <span class="math inline">result =
0</span>.</li>
<li><code>GT</code> is set if both <code>LT_OF</code> and
<code>EQ</code> are cleared.</li>
</ul></li>
</ul>
<p>Reminder: flags are affected only if <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span> is set.</p>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, if <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
<li>SP, if <code>in1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span> addressing
mode, or if <code>out1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span> addressing
mode.</li>
</ul></li>
<li>Current stack memory page, if <code>out</code> resolves to it.</li>
<li>Flags, if <code>set_flags</code> modifier is set.</li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Arithmetic operations.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<p>Flags are computed exactly as in <code>add</code>, but the meaning of
overflow is different for addition and subtraction.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Sub" class="idref" href="#step_Sub"><span class="id" title="constructor">step_Sub</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="mod_sf:3" class="idref" href="#mod_sf:3"><span class="id" title="binder">mod_sf</span></a> <a id="old_flags:4" class="idref" href="#old_flags:4"><span class="id" title="binder">old_flags</span></a> <a id="new_flags:5" class="idref" href="#new_flags:5"><span class="id" title="binder">new_flags</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<a id="new_OF:6" class="idref" href="#new_OF:6"><span class="id" title="binder">new_OF</span></a>, <a id="result:7" class="idref" href="#result:7"><span class="id" title="binder">result</span></a>) := <span class="id" title="var">op1</span> <a class="idref" href="#::ZMod_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <span class="id" title="var">op2</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_EQ:8" class="idref" href="#new_EQ:8"><span class="id" title="binder">new_EQ</span></a> := <a class="idref" href="#result:7"><span class="id" title="variable">result</span></a> <span class="id" title="notation">==</span> <a class="idref" href="#zero256"><span class="id" title="definition">zero256</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_GT:9" class="idref" href="#new_GT:9"><span class="id" title="binder">new_GT</span></a> := <a class="idref" href="#negb"><span class="id" title="definition">negb</span></a> <a class="idref" href="#new_EQ:8"><span class="id" title="variable">new_EQ</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a> <a class="idref" href="#negb"><span class="id" title="definition">negb</span></a> <a class="idref" href="#new_OF:6"><span class="id" title="variable">new_OF</span></a> <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_flags:5"><span class="id" title="variable">new_flags</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#apply_set_flags"><span class="id" title="definition">apply_set_flags</span></a> <a class="idref" href="#mod_sf:3"><span class="id" title="variable">mod_sf</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#old_flags:4"><span class="id" title="variable">old_flags</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#bflags"><span class="id" title="definition">bflags</span></a> <a class="idref" href="#new_OF:6"><span class="id" title="variable">new_OF</span></a> <a class="idref" href="#new_EQ:8"><span class="id" title="variable">new_EQ</span></a> <a class="idref" href="#new_GT:9"><span class="id" title="variable">new_GT</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_sub:1"><span class="id" title="inductive">step_sub</span></a> (<a class="idref" href="#OpSub"><span class="id" title="constructor">OpSub</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag1</span> <span class="id" title="var">op1</span>) (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag2</span> <span class="id" title="var">op2</span>) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#result:7"><span class="id" title="variable">result</span></a>) <a class="idref" href="#mod_sf:3"><span class="id" title="variable">mod_sf</span></a>) <a class="idref" href="#old_flags:4"><span class="id" title="variable">old_flags</span></a> <a class="idref" href="#new_flags:5"><span class="id" title="variable">new_flags</span></a>)<br/>
&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable No Variables</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#SubDefinition"><span class="id" title="section">SubDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.Mul</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">sem.SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Bool</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Modifiers</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Flags</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryOps</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">ZArith</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="module">List</span></a> <a class="idref" href="#ListNotations"><span class="id" title="module">ListNotations</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect.eqtype</span> <span class="id" title="module">ssreflect.tuple</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="MulDefinition" class="idref" href="#MulDefinition"><span class="id" title="section">MulDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable Variables</span> <span class="id" title="var">tag</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_mul" class="idref" href="#step_mul"><span class="id" title="inductive">step_mul</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#flags_tsmallstep"><span class="id" title="definition">flags_tsmallstep</span></a> :=<br/>
</div>

<div class="doc"><h1 id="opmul">OpMul</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpMul"><span
class="id" title="constructor">OpMul</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_any"><span
class="id" title="inductive">in_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_any"><span
class="id" title="inductive">out_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">sf</span>:</span> <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><p><code>mul in1, in2, out1, out2</code></p></li>
<li><p><code>mul! in1, in2, out1, out2</code> to set <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span>
modifier</p></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Unsigned multiplication of two numbers modulo <span
class="math inline">2^{512}</span>; the high and low 256 bits of the
result are returned in two separate operands.</p>
<h2 id="semantic">Semantic</h2>
<ol type="1">
<li><p>Compute result by unsigned multiplication of <code>in1</code> by
<code>in2</code>.</p>
<p><span class="math display">\begin{cases}result_{high} := \frac{ op_1
\times op_2}{2^{256}}\\
result_{low} := op_1 \times op_2 \mod 2^{256}
\end{cases}</span></p></li>
<li><p>Flags are computed as follows:</p>
<ul>
<li><code>LT_OF</code> is set if overflow occurs, i.e. <span
class="math inline">op_1 \times op_2 \geq 2^{256}</span></li>
<li><code>EQ</code> is set if <span class="math inline">result_{low} =
0</span>.</li>
<li><code>GT</code> is set if <code>LT_OF</code> and <code>EQ</code> are
cleared.</li>
</ul></li>
</ol>
<p>Reminder: flags are affected only if <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span> is set.</p>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, if <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
<li>SP, if <code>in1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span> addressing
mode, or if <code>out1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span> addressing
mode.</li>
</ul></li>
<li>Current stack memory page, if <code>out</code> resolves to it.</li>
<li>Flags, if <code>set_flags</code> modifier is set.</li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Arithmetic operations.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<ul>
<li>See <span
class="inlinecode"><a class="idref" href="#OpDiv"><span
class="id" title="constructor">OpDiv</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Mul" class="idref" href="#step_Mul"><span class="id" title="constructor">step_Mul</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="mod_sf:3" class="idref" href="#mod_sf:3"><span class="id" title="binder">mod_sf</span></a> <a id="old_flags:4" class="idref" href="#old_flags:4"><span class="id" title="binder">old_flags</span></a> <a id="new_flags:5" class="idref" href="#new_flags:5"><span class="id" title="binder">new_flags</span></a> <a id="high:6" class="idref" href="#high:6"><span class="id" title="binder">high</span></a> <a id="low:7" class="idref" href="#low:7"><span class="id" title="binder">low</span></a> <a id="high256:8" class="idref" href="#high256:8"><span class="id" title="binder">high256</span></a> <a id="low256:9" class="idref" href="#low256:9"><span class="id" title="binder">low256</span></a> <a id="op1:10" class="idref" href="#op1:10"><span class="id" title="binder">op1</span></a> <a id="op2:11" class="idref" href="#op2:11"><span class="id" title="binder">op2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#high256:8"><span class="id" title="variable">high256</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#high:6"><span class="id" title="variable">high</span></a> 256 (<a class="idref" href="#op1:10"><span class="id" title="variable">op1</span></a><a class="idref" href="#a2b4273a2140deed386b9215048ca773"><span class="id" title="notation">×</span></a><a class="idref" href="#op2:11"><span class="id" title="variable">op2</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#low256:9"><span class="id" title="variable">low256</span></a>  <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#low:7"><span class="id" title="variable">low</span></a> 256 (<a class="idref" href="#op1:10"><span class="id" title="variable">op1</span></a><a class="idref" href="#a2b4273a2140deed386b9215048ca773"><span class="id" title="notation">×</span></a><a class="idref" href="#op2:11"><span class="id" title="variable">op2</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_EQ:12" class="idref" href="#new_EQ:12"><span class="id" title="binder">new_EQ</span></a> := <a class="idref" href="#low256:9"><span class="id" title="variable">low256</span></a>  <span class="id" title="notation">==</span> <a class="idref" href="#zero256"><span class="id" title="definition">zero256</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_OF:13" class="idref" href="#new_OF:13"><span class="id" title="binder">new_OF</span></a> := <a class="idref" href="#high256:8"><span class="id" title="variable">high256</span></a> <span class="id" title="notation">!=</span> <a class="idref" href="#zero256"><span class="id" title="definition">zero256</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_GT:14" class="idref" href="#new_GT:14"><span class="id" title="binder">new_GT</span></a> := <a class="idref" href="#negb"><span class="id" title="definition">negb</span></a> <a class="idref" href="#new_EQ:12"><span class="id" title="variable">new_EQ</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a> <a class="idref" href="#negb"><span class="id" title="definition">negb</span></a> <a class="idref" href="#new_OF:13"><span class="id" title="variable">new_OF</span></a> <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_flags:5"><span class="id" title="variable">new_flags</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#apply_set_flags"><span class="id" title="definition">apply_set_flags</span></a> <a class="idref" href="#mod_sf:3"><span class="id" title="variable">mod_sf</span></a> <a class="idref" href="#old_flags:4"><span class="id" title="variable">old_flags</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#bflags"><span class="id" title="definition">bflags</span></a> <a class="idref" href="#new_OF:13"><span class="id" title="variable">new_OF</span></a> <a class="idref" href="#new_EQ:12"><span class="id" title="variable">new_EQ</span></a> <a class="idref" href="#new_GT:14"><span class="id" title="variable">new_GT</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_mul:1"><span class="id" title="inductive">step_mul</span></a> (<a class="idref" href="#OpMul"><span class="id" title="constructor">OpMul</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag1</span> <a class="idref" href="#op1:10"><span class="id" title="variable">op1</span></a>) (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag2</span> <a class="idref" href="#op2:11"><span class="id" title="variable">op2</span></a>) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#low256:9"><span class="id" title="variable">low256</span></a>) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#high256:8"><span class="id" title="variable">high256</span></a>) <a class="idref" href="#mod_sf:3"><span class="id" title="variable">mod_sf</span></a>) <a class="idref" href="#old_flags:4"><span class="id" title="variable">old_flags</span></a> <a class="idref" href="#new_flags:5"><span class="id" title="variable">new_flags</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable No Variables</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#MulDefinition"><span class="id" title="section">MulDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.Div</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">sem.SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Addressing</span></a> <a class="idref" href="#"><span class="id" title="module">Bool</span></a> <a class="idref" href="#"><span class="id" title="module">ZArith</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Flags</span></a> <a class="idref" href="#"><span class="id" title="module">GPR</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">Modifiers</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">ZBits</span></a> <a class="idref" href="#Coercions"><span class="id" title="module">Addressing.Coercions</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="module">List</span></a> <a class="idref" href="#ListNotations"><span class="id" title="module">ListNotations</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="DivDefinition" class="idref" href="#DivDefinition"><span class="id" title="section">DivDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z_scope</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable Variables</span> <span class="id" title="var">tag</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_div" class="idref" href="#step_div"><span class="id" title="inductive">step_div</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#flags_tsmallstep"><span class="id" title="definition">flags_tsmallstep</span></a> :=<br/>
<br/>
</div>

<div class="doc"><h1 id="opdiv">OpDiv</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpDiv"><span
class="id" title="constructor">OpDiv</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_any"><span
class="id" title="inductive">in_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_any"><span
class="id" title="inductive">out_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">swap</span>:</span>
<span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">sf</span>:</span> <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><p><code>div in1, in2, out1, out2</code></p></li>
<li><p><code>div! in1, in2, out1, out2</code> to set <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span>
modifier</p></li>
<li><p><code>div.s in1, in2, out1, out2</code> to set <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span>
modifier</p></li>
<li><p><code>div.s! in1, in2, out1, out2</code> to set both <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span> and <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span>
modifier</p></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Unsigned division of <code>in1</code> by <code>in2</code>. The
quotient is returned in <code>out1</code>, the remainder is returned in
<code>out2</code>.</p>
<h2 id="semantic">Semantic</h2>
<p><strong>Note</strong>: In the following description the operands are
bound after taking <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span> modifier into
account.</p>
<ul>
<li><p>If <code>in2</code> <span class="math inline">\neq 0</span>:
<span class="math display">\begin{cases}out_1 := \frac{ op_1}{op_2} \\
out_{2} := \text{rem } op_1 \ op_2 \end{cases}</span></p>
<p>Flags are computed as follows:</p>
<ul>
<li><code>LT_OF</code> is cleared;</li>
<li><code>EQ</code> is set if the quotient is zero;</li>
<li><code>GT</code> is set if the reminder is zero.</li>
</ul></li>
<li><p>If <code>in2</code> <span class="math inline">= 0</span>: <span
class="math display">\begin{cases}out_1 := 0 \\ out_{2} := 0
\end{cases}</span></p>
<p>Flags are computed as follows:</p>
<ul>
<li><code>LT_OF</code> is set.</li>
<li><code>EQ</code> is set if <span class="math inline">result_{low} =
0</span>.</li>
<li><code>GT</code> is set if <code>LT_OF</code> and <code>EQ</code> are
cleared.</li>
</ul></li>
</ul>
<p>Reminder: flags are affected only if <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span> is set.</p>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, if <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
<li>SP, if <code>in1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span> addressing
mode, or if <code>out1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span> addressing
mode.</li>
</ul></li>
<li>Current stack memory page, if <code>out</code> resolves to it.</li>
<li>Flags, if <code>set_flags</code> modifier is set.</li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Arithmetic operations.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<ul>
<li>See <span
class="inlinecode"><a class="idref" href="#OpMul"><span
class="id" title="constructor">OpMul</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Div_no_overflow" class="idref" href="#step_Div_no_overflow"><span class="id" title="constructor">step_Div_no_overflow</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;`(<span class="id" title="keyword">∀</span> <a id="mod_sf:3" class="idref" href="#mod_sf:3"><span class="id" title="binder">mod_sf</span></a> <a id="old_flags:4" class="idref" href="#old_flags:4"><span class="id" title="binder">old_flags</span></a> <a id="new_flags:5" class="idref" href="#new_flags:5"><span class="id" title="binder">new_flags</span></a> <a id="w_quot:6" class="idref" href="#w_quot:6"><span class="id" title="binder">w_quot</span></a> <a id="w_rem:7" class="idref" href="#w_rem:7"><span class="id" title="binder">w_rem</span></a> <a id="quot:8" class="idref" href="#quot:8"><span class="id" title="binder">quot</span></a> <a id="rem:9" class="idref" href="#rem:9"><span class="id" title="binder">rem</span></a> (<a id="x:10" class="idref" href="#x:10"><span class="id" title="binder">x</span></a> <a id="y:11" class="idref" href="#y:11"><span class="id" title="binder">y</span></a>:<a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a>) <a id="op1:12" class="idref" href="#op1:12"><span class="id" title="binder">op1</span></a> <a id="op2:13" class="idref" href="#op2:13"><span class="id" title="binder">op2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#x:10"><span class="id" title="variable">x</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">toZ</span> <a class="idref" href="#op1:12"><span class="id" title="variable">op1</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#y:11"><span class="id" title="variable">y</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">toZ</span> <a class="idref" href="#op2:13"><span class="id" title="variable">op2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#y:11"><span class="id" title="variable">y</span></a> <a class="idref" href="#::type_scope:x_'<>'_x"><span class="id" title="notation">≠</span></a> 0 <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#quot:8"><span class="id" title="variable">quot</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#Z.div"><span class="id" title="definition">Z.div</span></a> <a class="idref" href="#x:10"><span class="id" title="variable">x</span></a> <a class="idref" href="#y:11"><span class="id" title="variable">y</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#rem:9"><span class="id" title="variable">rem</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#Z.rem"><span class="id" title="definition">Z.rem</span></a> <a class="idref" href="#x:10"><span class="id" title="variable">x</span></a> <a class="idref" href="#y:11"><span class="id" title="variable">y</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#w_quot:6"><span class="id" title="variable">w_quot</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#u256_of"><span class="id" title="definition">u256_of</span></a> <a class="idref" href="#quot:8"><span class="id" title="variable">quot</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#w_rem:7"><span class="id" title="variable">w_rem</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#u256_of"><span class="id" title="definition">u256_of</span></a> <a class="idref" href="#rem:9"><span class="id" title="variable">rem</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_EQ:14" class="idref" href="#new_EQ:14"><span class="id" title="binder">new_EQ</span></a> := <a class="idref" href="#quot:8"><span class="id" title="variable">quot</span></a> <a class="idref" href="#f10153ef1a81fe79ed16d848b456c79b"><span class="id" title="notation">=?</span></a> 0 <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_GT:15" class="idref" href="#new_GT:15"><span class="id" title="binder">new_GT</span></a> := <a class="idref" href="#rem:9"><span class="id" title="variable">rem</span></a> <a class="idref" href="#f10153ef1a81fe79ed16d848b456c79b"><span class="id" title="notation">=?</span></a> 0 <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_flags:5"><span class="id" title="variable">new_flags</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#apply_set_flags"><span class="id" title="definition">apply_set_flags</span></a> <a class="idref" href="#mod_sf:3"><span class="id" title="variable">mod_sf</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#old_flags:4"><span class="id" title="variable">old_flags</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#bflags"><span class="id" title="definition">bflags</span></a> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="#new_EQ:14"><span class="id" title="variable">new_EQ</span></a> <a class="idref" href="#new_GT:15"><span class="id" title="variable">new_GT</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_div:1"><span class="id" title="inductive">step_div</span></a> (<a class="idref" href="#OpDiv"><span class="id" title="constructor">OpDiv</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag1</span> <a class="idref" href="#op1:12"><span class="id" title="variable">op1</span></a>) (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag2</span> <a class="idref" href="#op2:13"><span class="id" title="variable">op2</span></a>) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#w_quot:6"><span class="id" title="variable">w_quot</span></a>) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#w_rem:7"><span class="id" title="variable">w_rem</span></a>) <a class="idref" href="#mod_sf:3"><span class="id" title="variable">mod_sf</span></a>) <a class="idref" href="#old_flags:4"><span class="id" title="variable">old_flags</span></a> <a class="idref" href="#new_flags:5"><span class="id" title="variable">new_flags</span></a>)<br/>
&nbsp;&nbsp;| <a id="step_Div_overflow" class="idref" href="#step_Div_overflow"><span class="id" title="constructor">step_Div_overflow</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="mod_sf:18" class="idref" href="#mod_sf:18"><span class="id" title="binder">mod_sf</span></a> <a id="old_flags:19" class="idref" href="#old_flags:19"><span class="id" title="binder">old_flags</span></a> <a id="new_flags:20" class="idref" href="#new_flags:20"><span class="id" title="binder">new_flags</span></a> (<a id="x:21" class="idref" href="#x:21"><span class="id" title="binder">x</span></a> <a id="y:22" class="idref" href="#y:22"><span class="id" title="binder">y</span></a>:<a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a>) <a id="op1:23" class="idref" href="#op1:23"><span class="id" title="binder">op1</span></a> <a id="op2:24" class="idref" href="#op2:24"><span class="id" title="binder">op2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#x:21"><span class="id" title="variable">x</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">toZ</span> <a class="idref" href="#op1:23"><span class="id" title="variable">op1</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#y:22"><span class="id" title="variable">y</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">toZ</span> <a class="idref" href="#op2:24"><span class="id" title="variable">op2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_flags:20"><span class="id" title="variable">new_flags</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#apply_set_flags"><span class="id" title="definition">apply_set_flags</span></a> <a class="idref" href="#mod_sf:18"><span class="id" title="variable">mod_sf</span></a> <a class="idref" href="#old_flags:19"><span class="id" title="variable">old_flags</span></a> (<a class="idref" href="#bflags"><span class="id" title="definition">bflags</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_div:1"><span class="id" title="inductive">step_div</span></a> (<a class="idref" href="#OpDiv"><span class="id" title="constructor">OpDiv</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag1</span> <a class="idref" href="#op1:23"><span class="id" title="variable">op1</span></a>) (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag2</span> <a class="idref" href="#op2:24"><span class="id" title="variable">op2</span></a>) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#zero256"><span class="id" title="definition">zero256</span></a>) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#zero256"><span class="id" title="definition">zero256</span></a>) <a class="idref" href="#mod_sf:18"><span class="id" title="variable">mod_sf</span></a>) <a class="idref" href="#old_flags:19"><span class="id" title="variable">old_flags</span></a> <a class="idref" href="#new_flags:20"><span class="id" title="variable">new_flags</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#DivDefinition"><span class="id" title="section">DivDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.And</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">Modifiers</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="AndDefinition" class="idref" href="#AndDefinition"><span class="id" title="section">AndDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable Variables</span> <span class="id" title="var">op</span> <span class="id" title="var">tag</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_and" class="idref" href="#step_and"><span class="id" title="inductive">step_and</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#flags_tsmallstep"><span class="id" title="definition">flags_tsmallstep</span></a> :=<br/>
</div>

<div class="doc"><h1 id="opand">OpAnd</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpAnd"><span
class="id" title="constructor">OpAnd</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_any"><span
class="id" title="inductive">in_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_any"><span
class="id" title="inductive">out_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">sf</span>:</span> <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><p><code>and in1, in2, out1</code></p></li>
<li><p><code>and! in1, in2, out1</code> to set <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span>
modifier</p></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Bitwise AND of two 256-bit numbers.</p>
<h2 id="semantic">Semantic</h2>
<ul>
<li><span class="math inline">result</span> is computed as a bitwise AND
of two operands.</li>
<li>flags are computed as follows:
<ul>
<li><code>EQ</code> is set if <span class="math inline">result =
0</span>.</li>
<li><code>OF_LT</code> and <code>GT</code> are cleared</li>
</ul></li>
</ul>
<p>Reminder: flags are affected only if <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span> is set.</p>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, if <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
<li>SP, if <code>in1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span> addressing
mode, or if <code>out1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span> addressing
mode.</li>
</ul></li>
<li>Current stack memory page, if <code>out</code> resolves to it.</li>
<li>Flags, if <code>set_flags</code> modifier is set.</li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Operations with bit masks.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<ul>
<li>See <span
class="inlinecode"><a class="idref" href="#OpShr"><span
class="id" title="constructor">OpShr</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpShl"><span
class="id" title="constructor">OpShl</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpRol"><span
class="id" title="constructor">OpRol</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpRor"><span
class="id" title="constructor">OpRor</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpAnd"><span
class="id" title="constructor">OpAnd</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpOr"><span
class="id" title="constructor">OpOr</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpXor"><span
class="id" title="constructor">OpXor</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
<br/>
&nbsp;&nbsp;| <a id="step_And" class="idref" href="#step_And"><span class="id" title="constructor">step_And</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="mod_sf:3" class="idref" href="#mod_sf:3"><span class="id" title="binder">mod_sf</span></a> <a id="old_flags:4" class="idref" href="#old_flags:4"><span class="id" title="binder">old_flags</span></a> <a id="new_flags:5" class="idref" href="#new_flags:5"><span class="id" title="binder">new_flags</span></a> <a id="result:6" class="idref" href="#result:6"><span class="id" title="binder">result</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#result:6"><span class="id" title="variable">result</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#bitwise_and"><span class="id" title="definition">bitwise_and</span></a> <span class="id" title="var">op1</span> <span class="id" title="var">op2</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_flags:5"><span class="id" title="variable">new_flags</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#apply_set_flags"><span class="id" title="definition">apply_set_flags</span></a> <a class="idref" href="#mod_sf:3"><span class="id" title="variable">mod_sf</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#old_flags:4"><span class="id" title="variable">old_flags</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#bitwise_flags"><span class="id" title="definition">bitwise_flags</span></a> <a class="idref" href="#result:6"><span class="id" title="variable">result</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_and:1"><span class="id" title="inductive">step_and</span></a> (<a class="idref" href="#OpAnd"><span class="id" title="constructor">OpAnd</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag1</span> <span class="id" title="var">op1</span>) (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag2</span> <span class="id" title="var">op2</span>) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#result:6"><span class="id" title="variable">result</span></a>) <a class="idref" href="#mod_sf:3"><span class="id" title="variable">mod_sf</span></a>) <a class="idref" href="#old_flags:4"><span class="id" title="variable">old_flags</span></a> <a class="idref" href="#new_flags:5"><span class="id" title="variable">new_flags</span></a>)<br/>
&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable No Variables</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#AndDefinition"><span class="id" title="section">AndDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.Or</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">Modifiers</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="OrDefinition" class="idref" href="#OrDefinition"><span class="id" title="section">OrDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable Variables</span> <span class="id" title="var">op</span> <span class="id" title="var">tag</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_or" class="idref" href="#step_or"><span class="id" title="inductive">step_or</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#flags_tsmallstep"><span class="id" title="definition">flags_tsmallstep</span></a> :=<br/>
</div>

<div class="doc"><h1 id="opor">OpOr</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpOr"><span
class="id" title="constructor">OpOr</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_any"><span
class="id" title="inductive">in_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_any"><span
class="id" title="inductive">out_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">sf</span>:</span> <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><p><code>or in1, in2, out1</code></p></li>
<li><p><code>or! in1, in2, out1</code> to set <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span>
modifier</p></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Bitwise OR of two 256-bit numbers.</p>
<h2 id="semantic">Semantic</h2>
<ul>
<li><span class="math inline">result</span> is computed as a bitwise OR
of two operands.</li>
<li>flags are computed as follows:
<ul>
<li><code>EQ</code> is set if <span class="math inline">result =
0</span>.</li>
<li><code>OF_LT</code> and <code>GT</code> are cleared</li>
</ul></li>
</ul>
<p>Reminder: flags are affected only if <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span> is set.</p>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, if <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
<li>SP, if <code>in1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span> addressing
mode, or if <code>out1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span> addressing
mode.</li>
</ul></li>
<li>Current stack memory page, if <code>out</code> resolves to it.</li>
<li>Flags, if <code>set_flags</code> modifier is set.</li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Operations with bit masks.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<ul>
<li>See <span
class="inlinecode"><a class="idref" href="#OpShr"><span
class="id" title="constructor">OpShr</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpShl"><span
class="id" title="constructor">OpShl</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpRol"><span
class="id" title="constructor">OpRol</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpRor"><span
class="id" title="constructor">OpRor</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpAnd"><span
class="id" title="constructor">OpAnd</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpOr"><span
class="id" title="constructor">OpOr</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpXor"><span
class="id" title="constructor">OpXor</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Or" class="idref" href="#step_Or"><span class="id" title="constructor">step_Or</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="mod_sf:3" class="idref" href="#mod_sf:3"><span class="id" title="binder">mod_sf</span></a> <a id="old_flags:4" class="idref" href="#old_flags:4"><span class="id" title="binder">old_flags</span></a> <a id="new_flags:5" class="idref" href="#new_flags:5"><span class="id" title="binder">new_flags</span></a> <a id="result:6" class="idref" href="#result:6"><span class="id" title="binder">result</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#result:6"><span class="id" title="variable">result</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#bitwise_or"><span class="id" title="definition">bitwise_or</span></a> <span class="id" title="var">op1</span> <span class="id" title="var">op2</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_flags:5"><span class="id" title="variable">new_flags</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#apply_set_flags"><span class="id" title="definition">apply_set_flags</span></a> <a class="idref" href="#mod_sf:3"><span class="id" title="variable">mod_sf</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#old_flags:4"><span class="id" title="variable">old_flags</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#bitwise_flags"><span class="id" title="definition">bitwise_flags</span></a> <a class="idref" href="#result:6"><span class="id" title="variable">result</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_or:1"><span class="id" title="inductive">step_or</span></a> (<a class="idref" href="#OpOr"><span class="id" title="constructor">OpOr</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag1</span> <span class="id" title="var">op1</span>) (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag2</span> <span class="id" title="var">op2</span>) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#result:6"><span class="id" title="variable">result</span></a>) <a class="idref" href="#mod_sf:3"><span class="id" title="variable">mod_sf</span></a>) <a class="idref" href="#old_flags:4"><span class="id" title="variable">old_flags</span></a> <a class="idref" href="#new_flags:5"><span class="id" title="variable">new_flags</span></a>)<br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable No Variables</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#OrDefinition"><span class="id" title="section">OrDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.Xor</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">Modifiers</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="XorDefinition" class="idref" href="#XorDefinition"><span class="id" title="section">XorDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable Variables</span> <span class="id" title="var">op</span> <span class="id" title="var">tag</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_xor" class="idref" href="#step_xor"><span class="id" title="inductive">step_xor</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#flags_tsmallstep"><span class="id" title="definition">flags_tsmallstep</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc"><h1 id="opxor">OpXor</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpXor"><span
class="id" title="constructor">OpXor</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_any"><span
class="id" title="inductive">in_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_any"><span
class="id" title="inductive">out_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">sf</span>:</span> <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><p><code>xor in1, in2, out1</code></p></li>
<li><p><code>xor! in1, in2, out1</code> to set <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span>
modifier</p></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Bitwise XOR of two 256-bit numbers.</p>
<h2 id="semantic">Semantic</h2>
<ul>
<li><span class="math inline">result</span> is computed as a bitwise XOR
of two operands.</li>
<li>flags are computed as follows:
<ul>
<li><code>EQ</code> is set if <span class="math inline">result =
0</span>.</li>
<li><code>OF_LT</code> and <code>GT</code> are cleared</li>
</ul></li>
</ul>
<p>Reminder: flags are affected only if <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span> is set.</p>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, if <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
<li>SP, if <code>in1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span> addressing
mode, or if <code>out1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span> addressing
mode.</li>
</ul></li>
<li>Current stack memory page, if <code>out</code> resolves to it.</li>
<li>Flags, if <code>set_flags</code> modifier is set.</li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Operations with bit masks.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<ul>
<li>See <span
class="inlinecode"><a class="idref" href="#OpShr"><span
class="id" title="constructor">OpShr</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpShl"><span
class="id" title="constructor">OpShl</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpRol"><span
class="id" title="constructor">OpRol</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpRor"><span
class="id" title="constructor">OpRor</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpAnd"><span
class="id" title="constructor">OpAnd</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpOr"><span
class="id" title="constructor">OpOr</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpXor"><span
class="id" title="constructor">OpXor</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
<br/>
&nbsp;&nbsp;| <a id="step_Xor" class="idref" href="#step_Xor"><span class="id" title="constructor">step_Xor</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="mod_sf:3" class="idref" href="#mod_sf:3"><span class="id" title="binder">mod_sf</span></a> <a id="old_flags:4" class="idref" href="#old_flags:4"><span class="id" title="binder">old_flags</span></a> <a id="new_flags:5" class="idref" href="#new_flags:5"><span class="id" title="binder">new_flags</span></a> <a id="result:6" class="idref" href="#result:6"><span class="id" title="binder">result</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#result:6"><span class="id" title="variable">result</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#bitwise_xor"><span class="id" title="definition">bitwise_xor</span></a> <span class="id" title="var">op1</span> <span class="id" title="var">op2</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_flags:5"><span class="id" title="variable">new_flags</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#apply_set_flags"><span class="id" title="definition">apply_set_flags</span></a> <a class="idref" href="#mod_sf:3"><span class="id" title="variable">mod_sf</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#old_flags:4"><span class="id" title="variable">old_flags</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#bitwise_flags"><span class="id" title="definition">bitwise_flags</span></a> <a class="idref" href="#result:6"><span class="id" title="variable">result</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_xor:1"><span class="id" title="inductive">step_xor</span></a> (<a class="idref" href="#OpXor"><span class="id" title="constructor">OpXor</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag1</span> <span class="id" title="var">op1</span>) (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag2</span> <span class="id" title="var">op2</span>) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#result:6"><span class="id" title="variable">result</span></a>) <a class="idref" href="#mod_sf:3"><span class="id" title="variable">mod_sf</span></a>) <a class="idref" href="#old_flags:4"><span class="id" title="variable">old_flags</span></a> <a class="idref" href="#new_flags:5"><span class="id" title="variable">new_flags</span></a>)<br/>
&nbsp;&nbsp;.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#XorDefinition"><span class="id" title="section">XorDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.Shl</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">sem.SemanticCommon</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Arith</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <span class="id" title="module">spec</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="ShlDefinition" class="idref" href="#ShlDefinition"><span class="id" title="section">ShlDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable Variables</span> <span class="id" title="var">tag</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <span class="id" title="module">operations</span> <span class="id" title="module">operations.BitsNotations</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_shl" class="idref" href="#step_shl"><span class="id" title="inductive">step_shl</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#flags_tsmallstep"><span class="id" title="definition">flags_tsmallstep</span></a> :=<br/>
<br/>
</div>

<div class="doc"><h1 id="opshl">OpShl</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpShl"><span
class="id" title="constructor">OpShl</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_any"><span
class="id" title="inductive">in_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_any"><span
class="id" title="inductive">out_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">swap</span>:</span>
<span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">sf</span>:</span> <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><p><code>shl in1, in2, out1</code></p></li>
<li><p><code>shl! in1, in2, out1</code> to set <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span>
modifier</p></li>
<li><p><code>shl.s in1, in2, out1</code> to set <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span>
modifier</p></li>
<li><p><code>shl.s! in1, in2, out1</code> to set both <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span> and <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span>
modifier</p></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Bitwise SHL of two 256-bit numbers.</p>
<h2 id="semantic">Semantic</h2>
<p><strong>Note</strong>: In the following description the operands are
bound after taking <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span> modifier into
account.</p>
<ul>
<li><code>result = in1 &lt;&lt; (in2 mod 256)</code></li>
<li>flags are computed as follows:
<ul>
<li><code>EQ</code> is set if <span class="math inline">result =
0</span>.</li>
<li>other flags are reset</li>
</ul></li>
</ul>
<p>Reminder: flags are affected only if <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span> is set.</p>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, if <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
<li>SP, if <code>in1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span> addressing
mode, or if <code>out1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span> addressing
mode.</li>
</ul></li>
<li>Current stack memory page, if <code>out</code> resolves to it.</li>
<li>Flags, if <code>set_flags</code> modifier is set.</li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Operations with bit masks.</li>
<li>Fast arithmetic.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<ul>
<li>See <span
class="inlinecode"><a class="idref" href="#OpShr"><span
class="id" title="constructor">OpShr</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpShl"><span
class="id" title="constructor">OpShl</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpRol"><span
class="id" title="constructor">OpRol</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpRor"><span
class="id" title="constructor">OpRor</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpAnd"><span
class="id" title="constructor">OpAnd</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpOr"><span
class="id" title="constructor">OpOr</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpXor"><span
class="id" title="constructor">OpXor</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Shl" class="idref" href="#step_Shl"><span class="id" title="constructor">step_Shl</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="mod_sf:3" class="idref" href="#mod_sf:3"><span class="id" title="binder">mod_sf</span></a> <a id="result:4" class="idref" href="#result:4"><span class="id" title="binder">result</span></a> <a id="op:5" class="idref" href="#op:5"><span class="id" title="binder">op</span></a> <a id="shift:6" class="idref" href="#shift:6"><span class="id" title="binder">shift</span></a> <a id="w_shift:7" class="idref" href="#w_shift:7"><span class="id" title="binder">w_shift</span></a> <a id="old_flags:8" class="idref" href="#old_flags:8"><span class="id" title="binder">old_flags</span></a> <a id="new_flags:9" class="idref" href="#new_flags:9"><span class="id" title="binder">new_flags</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<a class="idref" href="#shift:6"><span class="id" title="variable">shift</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">toNat</span> (<span class="id" title="definition">low</span> 8 <a class="idref" href="#w_shift:7"><span class="id" title="variable">w_shift</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#result:4"><span class="id" title="variable">result</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">shlBn</span> <a class="idref" href="#op:5"><span class="id" title="variable">op</span></a> <a class="idref" href="#shift:6"><span class="id" title="variable">shift</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_shl:1"><span class="id" title="inductive">step_shl</span></a> (<a class="idref" href="#OpShl"><span class="id" title="constructor">OpShl</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag1</span> <a class="idref" href="#op:5"><span class="id" title="variable">op</span></a>) (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag2</span> <a class="idref" href="#w_shift:7"><span class="id" title="variable">w_shift</span></a>) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#result:4"><span class="id" title="variable">result</span></a>) <a class="idref" href="#mod_sf:3"><span class="id" title="variable">mod_sf</span></a>) <a class="idref" href="#old_flags:8"><span class="id" title="variable">old_flags</span></a> <a class="idref" href="#new_flags:9"><span class="id" title="variable">new_flags</span></a>)<br/>
&nbsp;&nbsp;.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#ShlDefinition"><span class="id" title="section">ShlDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.Shr</h1>

<div class="code">

<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">sem.SemanticCommon</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Arith</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <span class="id" title="module">spec</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="ShrDefinition" class="idref" href="#ShrDefinition"><span class="id" title="section">ShrDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable Variables</span> <span class="id" title="var">tag</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <span class="id" title="module">operations</span> <span class="id" title="module">operations.BitsNotations</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_shr" class="idref" href="#step_shr"><span class="id" title="inductive">step_shr</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#flags_tsmallstep"><span class="id" title="definition">flags_tsmallstep</span></a> :=<br/>
&nbsp;&nbsp;</div>

<div class="doc"><h1 id="opshr">OpShr</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpShr"><span
class="id" title="constructor">OpShr</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_any"><span
class="id" title="inductive">in_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_any"><span
class="id" title="inductive">out_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">swap</span>:</span>
<span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">sf</span>:</span> <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><p><code>shr in1, in2, out1</code></p></li>
<li><p><code>shr! in1, in2, out1</code> to set <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span>
modifier</p></li>
<li><p><code>shr.s in1, in2, out1</code> to set <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span>
modifier</p></li>
<li><p><code>shr.s! in1, in2, out1</code> to set both <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span> and <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span>
modifier</p></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Bitwise SHR of two 256-bit numbers.</p>
<h2 id="semantic">Semantic</h2>
<p><strong>Note</strong>: In the following description the operands are
bound after taking <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span> modifier into
account.</p>
<ul>
<li><code>result = in1 &gt;&gt; (in2 mod 256)</code></li>
<li>flags are computed as follows:
<ul>
<li><code>EQ</code> is set if <span class="math inline">result =
0</span>.</li>
<li>other flags are reset</li>
</ul></li>
</ul>
<p>Reminder: flags are affected only if <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span> is set.</p>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, if <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
<li>SP, if <code>in1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span> addressing
mode, or if <code>out1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span> addressing
mode.</li>
</ul></li>
<li>Current stack memory page, if <code>out</code> resolves to it.</li>
<li>Flags, if <code>set_flags</code> modifier is set.</li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Operations with bit masks.</li>
<li>Fast arithmetic.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<ul>
<li>See <span
class="inlinecode"><a class="idref" href="#OpShr"><span
class="id" title="constructor">OpShr</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpShl"><span
class="id" title="constructor">OpShl</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpRol"><span
class="id" title="constructor">OpRol</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpRor"><span
class="id" title="constructor">OpRor</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpAnd"><span
class="id" title="constructor">OpAnd</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpOr"><span
class="id" title="constructor">OpOr</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpXor"><span
class="id" title="constructor">OpXor</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
<br/>
&nbsp;&nbsp;| <a id="step_Shr" class="idref" href="#step_Shr"><span class="id" title="constructor">step_Shr</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="mod_sf:3" class="idref" href="#mod_sf:3"><span class="id" title="binder">mod_sf</span></a> <a id="result:4" class="idref" href="#result:4"><span class="id" title="binder">result</span></a> <a id="op:5" class="idref" href="#op:5"><span class="id" title="binder">op</span></a> <a id="shift:6" class="idref" href="#shift:6"><span class="id" title="binder">shift</span></a> <a id="w_shift:7" class="idref" href="#w_shift:7"><span class="id" title="binder">w_shift</span></a> <a id="old_flags:8" class="idref" href="#old_flags:8"><span class="id" title="binder">old_flags</span></a> <a id="new_flags:9" class="idref" href="#new_flags:9"><span class="id" title="binder">new_flags</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<a class="idref" href="#shift:6"><span class="id" title="variable">shift</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">toNat</span> (<span class="id" title="definition">low</span> 8 <a class="idref" href="#w_shift:7"><span class="id" title="variable">w_shift</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#result:4"><span class="id" title="variable">result</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">shrBn</span> <a class="idref" href="#op:5"><span class="id" title="variable">op</span></a> <a class="idref" href="#shift:6"><span class="id" title="variable">shift</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_shr:1"><span class="id" title="inductive">step_shr</span></a> (<a class="idref" href="#OpShr"><span class="id" title="constructor">OpShr</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag1</span> <a class="idref" href="#op:5"><span class="id" title="variable">op</span></a>) (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag2</span> <a class="idref" href="#w_shift:7"><span class="id" title="variable">w_shift</span></a>) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#result:4"><span class="id" title="variable">result</span></a>) <a class="idref" href="#mod_sf:3"><span class="id" title="variable">mod_sf</span></a>) <a class="idref" href="#old_flags:8"><span class="id" title="variable">old_flags</span></a> <a class="idref" href="#new_flags:9"><span class="id" title="variable">new_flags</span></a>)<br/>
&nbsp;&nbsp;.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#ShrDefinition"><span class="id" title="section">ShrDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.Rol</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">sem.SemanticCommon</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Arith</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <span class="id" title="module">spec</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="RolDefinition" class="idref" href="#RolDefinition"><span class="id" title="section">RolDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable Variables</span> <span class="id" title="var">tag</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_rol" class="idref" href="#step_rol"><span class="id" title="inductive">step_rol</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#flags_tsmallstep"><span class="id" title="definition">flags_tsmallstep</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc"><h1 id="oprol">OpRol</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpRol"><span
class="id" title="constructor">OpRol</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_any"><span
class="id" title="inductive">in_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_any"><span
class="id" title="inductive">out_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">swap</span>:</span>
<span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">sf</span>:</span> <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><p><code>rol in1, in2, out1</code></p></li>
<li><p><code>rol! in1, in2, out1</code> to set <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span>
modifier</p></li>
<li><p><code>rol.s in1, in2, out1</code> to set <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span>
modifier</p></li>
<li><p><code>rol.s! in1, in2, out1</code> to set both <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span> and <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span>
modifier</p></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Bitwise ROL of two 256-bit numbers.</p>
<h2 id="semantic">Semantic</h2>
<p><strong>Note</strong>: In the following description the operands are
bound after taking <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span> modifier into
account.</p>
<ul>
<li><code>result = in1 &lt;&lt;&lt; (in2 mod 256)</code>, where
<code>&lt;&lt;&lt;</code> stands for left circular shift.</li>
<li>flags are computed as follows:
<ul>
<li><code>EQ</code> is set if <span class="math inline">result =
0</span>.</li>
<li>other flags are reset</li>
</ul></li>
</ul>
<p>Reminder: flags are affected only if <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span> is set.</p>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, if <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
<li>SP, if <code>in1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span> addressing
mode, or if <code>out1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span> addressing
mode.</li>
</ul></li>
<li>Current stack memory page, if <code>out</code> resolves to it.</li>
<li>Flags, if <code>set_flags</code> modifier is set.</li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Operations with bit masks.</li>
<li>Fast arithmetic.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<ul>
<li>See <span
class="inlinecode"><a class="idref" href="#OpShr"><span
class="id" title="constructor">OpShr</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpShl"><span
class="id" title="constructor">OpShl</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpRol"><span
class="id" title="constructor">OpRol</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpRor"><span
class="id" title="constructor">OpRor</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpAnd"><span
class="id" title="constructor">OpAnd</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpOr"><span
class="id" title="constructor">OpOr</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpXor"><span
class="id" title="constructor">OpXor</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Rol" class="idref" href="#step_Rol"><span class="id" title="constructor">step_Rol</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="mod_sf:3" class="idref" href="#mod_sf:3"><span class="id" title="binder">mod_sf</span></a> <a id="result:4" class="idref" href="#result:4"><span class="id" title="binder">result</span></a> <a id="op:5" class="idref" href="#op:5"><span class="id" title="binder">op</span></a> <a id="shift:6" class="idref" href="#shift:6"><span class="id" title="binder">shift</span></a> <a id="w_shift:7" class="idref" href="#w_shift:7"><span class="id" title="binder">w_shift</span></a> <a id="old_flags:8" class="idref" href="#old_flags:8"><span class="id" title="binder">old_flags</span></a> <a id="new_flags:9" class="idref" href="#new_flags:9"><span class="id" title="binder">new_flags</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<a class="idref" href="#w_shift:7"><span class="id" title="variable">w_shift</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#widen"><span class="id" title="definition">widen</span></a> <a class="idref" href="#word_bits"><span class="id" title="definition">word_bits</span></a> (<span class="id" title="definition">low</span> 8 <a class="idref" href="#shift:6"><span class="id" title="variable">shift</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#result:4"><span class="id" title="variable">result</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#rolBn"><span class="id" title="definition">rolBn</span></a> <a class="idref" href="#op:5"><span class="id" title="variable">op</span></a> (<span class="id" title="definition">toNat</span> <a class="idref" href="#w_shift:7"><span class="id" title="variable">w_shift</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_rol:1"><span class="id" title="inductive">step_rol</span></a> (<a class="idref" href="#OpRol"><span class="id" title="constructor">OpRol</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag1</span> <a class="idref" href="#op:5"><span class="id" title="variable">op</span></a>) (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag2</span> <a class="idref" href="#shift:6"><span class="id" title="variable">shift</span></a>) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#result:4"><span class="id" title="variable">result</span></a>) <a class="idref" href="#mod_sf:3"><span class="id" title="variable">mod_sf</span></a>) <a class="idref" href="#old_flags:8"><span class="id" title="variable">old_flags</span></a> <a class="idref" href="#new_flags:9"><span class="id" title="variable">new_flags</span></a>)<br/>
&nbsp;&nbsp;.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#RolDefinition"><span class="id" title="section">RolDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.Ror</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">sem.SemanticCommon</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Arith</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <span class="id" title="module">spec</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="RorDefinition" class="idref" href="#RorDefinition"><span class="id" title="section">RorDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable Variables</span> <span class="id" title="var">tag</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_ror" class="idref" href="#step_ror"><span class="id" title="inductive">step_ror</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#flags_tsmallstep"><span class="id" title="definition">flags_tsmallstep</span></a> :=<br/>
&nbsp;&nbsp;</div>

<div class="doc"><h1 id="opror">OpRor</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpRor"><span
class="id" title="constructor">OpRor</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_any"><span
class="id" title="inductive">in_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_any"><span
class="id" title="inductive">out_any</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">swap</span>:</span>
<span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">sf</span>:</span> <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><p><code>ror in1, in2, out1</code></p></li>
<li><p><code>ror! in1, in2, out1</code> to set <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span>
modifier</p></li>
<li><p><code>ror.s in1, in2, out1</code> to set <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span>
modifier</p></li>
<li><p><code>ror.s! in1, in2, out1</code> to set both <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span> and <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span>
modifier</p></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Bitwise ROR of two 256-bit numbers.</p>
<h2 id="semantic">Semantic</h2>
<p><strong>Note</strong>: In the following description the operands are
bound after taking <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span> modifier into
account.</p>
<ul>
<li><code>result = in1 &gt;&gt;&gt; (in2 mod 256)</code>, where
<code>&gt;&gt;&gt;</code> is a circular right shift.</li>
<li>flags are computed as follows:
<ul>
<li><code>EQ</code> is set if <span class="math inline">result =
0</span>.</li>
<li>other flags are reset</li>
</ul></li>
</ul>
<p>Reminder: flags are affected only if <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span> is set.</p>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, if <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
<li>SP, if <code>in1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPop"><span
class="id" title="constructor">RelSpPop</span></a></span> addressing
mode, or if <code>out1</code> uses <span
class="inlinecode"><a class="idref" href="#RelSpPush"><span
class="id" title="constructor">RelSpPush</span></a></span> addressing
mode.</li>
</ul></li>
<li>Current stack memory page, if <code>out</code> resolves to it.</li>
<li>Flags, if <code>set_flags</code> modifier is set.</li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Operations with bit masks.</li>
<li>Fast arithmetic.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<ul>
<li>See <span
class="inlinecode"><a class="idref" href="#OpShr"><span
class="id" title="constructor">OpShr</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpShl"><span
class="id" title="constructor">OpShl</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpRol"><span
class="id" title="constructor">OpRol</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpRor"><span
class="id" title="constructor">OpRor</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpAnd"><span
class="id" title="constructor">OpAnd</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpOr"><span
class="id" title="constructor">OpOr</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpXor"><span
class="id" title="constructor">OpXor</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Ror" class="idref" href="#step_Ror"><span class="id" title="constructor">step_Ror</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="mod_sf:3" class="idref" href="#mod_sf:3"><span class="id" title="binder">mod_sf</span></a> <a id="result:4" class="idref" href="#result:4"><span class="id" title="binder">result</span></a> <a id="op:5" class="idref" href="#op:5"><span class="id" title="binder">op</span></a> <a id="shift:6" class="idref" href="#shift:6"><span class="id" title="binder">shift</span></a> <a id="w_shift:7" class="idref" href="#w_shift:7"><span class="id" title="binder">w_shift</span></a> <a id="old_flags:8" class="idref" href="#old_flags:8"><span class="id" title="binder">old_flags</span></a> <a id="new_flags:9" class="idref" href="#new_flags:9"><span class="id" title="binder">new_flags</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<a class="idref" href="#w_shift:7"><span class="id" title="variable">w_shift</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#widen"><span class="id" title="definition">widen</span></a> <a class="idref" href="#word_bits"><span class="id" title="definition">word_bits</span></a> (<span class="id" title="definition">low</span> 8 <a class="idref" href="#shift:6"><span class="id" title="variable">shift</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#result:4"><span class="id" title="variable">result</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#rorBn"><span class="id" title="definition">rorBn</span></a> <a class="idref" href="#op:5"><span class="id" title="variable">op</span></a> (<span class="id" title="definition">toNat</span> <a class="idref" href="#w_shift:7"><span class="id" title="variable">w_shift</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ror:1"><span class="id" title="inductive">step_ror</span></a> (<a class="idref" href="#OpRor"><span class="id" title="constructor">OpRor</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag1</span> <a class="idref" href="#op:5"><span class="id" title="variable">op</span></a>) (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <span class="id" title="var">tag2</span> <a class="idref" href="#shift:6"><span class="id" title="variable">shift</span></a>) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#result:4"><span class="id" title="variable">result</span></a>) <a class="idref" href="#mod_sf:3"><span class="id" title="variable">mod_sf</span></a>) <a class="idref" href="#old_flags:8"><span class="id" title="variable">old_flags</span></a> <a class="idref" href="#new_flags:9"><span class="id" title="variable">new_flags</span></a>)<br/>
&nbsp;&nbsp;.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#RorDefinition"><span class="id" title="section">RorDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.NearCall</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">NearCallABI</span></a> <a class="idref" href="#"><span class="id" title="module">Addressing</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Flags</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">GPR</span></a> <a class="idref" href="#"><span class="id" title="module">Ergs</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect</span> <span class="id" title="module">ssrfun</span> <span class="id" title="module">ssrbool</span> <span class="id" title="module">eqtype</span> <span class="id" title="module">ssreflect.tuple</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="NearCallDefinition" class="idref" href="#NearCallDefinition"><span class="id" title="section">NearCallDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
</div>

<div class="doc"><h1 id="opnearcall">OpNearCall</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpNearCall"><span
class="id" title="constructor">OpNearCall</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">dest</span>:</span>
<span
class="inlinecode"><a class="idref" href="#imm_in"><span
class="id" title="inductive">imm_in</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">handler</span>:</span>
<span
class="inlinecode"><a class="idref" href="#imm_in"><span
class="id" title="inductive">imm_in</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><ul>
<li><code>call abi_reg, callee_address, exception_handler</code> as a
fully expanded form.</li>
</ul></li>
<li><code>call abi_reg, callee_address</code>
<ul>
<li>The assembler expands this variation to
<code>call abi_reg, callee_address, DEFAULT_UNWIND_DEST</code>. Here:
<ul>
<li><code>DEFAULT_UNWIND_DEST</code> is a reserved system label; the
linker will resolve it to the default exception handler.</li>
</ul></li>
</ul></li>
<li><code>call callee_address</code> is a simplified form.
<ul>
<li>Assembler expands this variation to
<code>call r0, callee_address, DEFAULT_UNWIND_DEST</code>, where:
<ul>
<li><code>DEFAULT_UNWIND_DEST</code> is a reserved system label; linker
will resolve it to the default exception handler.</li>
<li><code>R0</code> is a reserved read-only register that holds 0. This
variation passes all ergs to the callee.</li>
</ul></li>
</ul></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Reserves a portion of the currently available ergs for a new function
instance and calls the code inside the current contract space.</p>
<h2 id="semantic">Semantic</h2>
<p>Reminder: the <em>callee</em> is the function that we call; the
<em>caller</em> is the currently executing function where a call takes
place. In other words, the caller calls the callee.</p>
<ol type="1">
<li><p>Read the value of <code>abi_reg</code> and decode the following
structure from <span
class="inlinecode"><a class="idref" href="#NearCallABI"><span
class="id" title="section">NearCallABI</span></a></span> from it. The
<code>ergs_passed</code> field indicates the amount of ergs we intend to
pass, but the actual amount of ergs passed gets decided at runtime (see
step 2).</p>
<pre><code>Record params := { ergs_passed: u32; }.</code></pre>
<p>The actual amount of passed ergs is determined by <span
class="inlinecode"><a class="idref" href="#split_ergs_callee_caller"><span
class="id" title="definition">split_ergs_callee_caller</span></a></span>
based on:</p>
<ul>
<li>The ergs allocated for the caller frame.</li>
<li>The value of <code>ergs_passed</code>.</li>
</ul></li>
<li><p>Decrease the number of ergs in the caller frame.</p></li>
<li><p>Set up the new frame:</p>
<ul>
<li>new PC is assigned the instruction's <code>callee_address</code>
argument.</li>
<li>new exception handler is assigned the instruction’s
<code>handler_address</code> argument.</li>
<li>new SP is copied from the old frame as is.</li>
<li>the allocated ergs are determined by <span class="inlinecode"><span
class="id" title="var">split_ergs_caller_callee</span></span> in
(2).</li>
</ul></li>
<li><p>Clear flags.</p></li>
</ol>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
<li>Execution stack: a new frame is pushed on top of the execution
stack, and the caller frame is changed.
<ul>
<li>Caller frame:
<ul>
<li>Ergs are split between caller and callee frames. See <span
class="inlinecode"><a class="idref" href="#split_ergs_callee_caller"><span
class="id"
title="definition">split_ergs_callee_caller</span></a></span>.</li>
</ul></li>
<li>New (callee) frame:
<ul>
<li>PC is set to <code>callee_address</code></li>
<li>SP is copied to the new frame as is.</li>
<li>ergs are set to the actual amount passed. See <span
class="inlinecode"><a class="idref" href="#split_ergs_callee_caller"><span
class="id"
title="definition">split_ergs_callee_caller</span></a></span>.</li>
<li>exception handler</li>
</ul></li>
</ul></li>
<li>Flags are always cleared.</li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li><p>Set <code>ergs_passed=0</code> to pass all available ergs to
callee.</p></li>
<li><p>If the first argument is omitted, all available ergs will be
passed to callee.</p>
<p>Explanation: if the first argument is omitted, the assembler
implicitly puts <code>r0</code> in its place. The reserved register
<code>r0</code> always holds zero, therefore <code>ergs_passed</code>
will be decoded into zero as well.</p></li>
<li><p>No particular calling convention is enforced for near calls, so
it can be decided by compiler.</p></li>
<li><p>Can be used for internal system code, like bootloader. For
example, wrap a pair of AA call + fee payment in any order in such
<code>near_call</code>, and then rollback the entire frame
atomically.</p></li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<p>See <span
class="inlinecode"><a class="idref" href="#OpFarCall"><span
class="id" title="constructor">OpFarCall</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpMimicCall"><span
class="id" title="constructor">OpMimicCall</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span>. They
are used to call code in other contracts.</p>
<p>Function for <span class="inlinecode"><span class="id"
title="var">split_ergs_caller_callee</span></span> evaluates as
follows:</p>
<ul>
<li><p>if <code>ergs_passed</code> = 0, pass all available ergs to the
callee and set the <code>caller_ergs</code> to zero. Upon the callee’s
normal return, its unspent ergs are returned back to the
caller.</p></li>
<li><p>otherwise, if <code>caller_ergs</code> <span
class="math inline">\geq</span> <code>ergs_passed</code>, pass exactly
<code>ergs_passed</code>. The <code>caller_ergs</code> is set to the
unspent amount <code>ergs_passed - caller_ergs</code>.</p></li>
<li><p>otherwise, if the call is not affordable
(<code>ergs_passed</code> <span class="math inline">\gt</span>
<code>caller_ergs</code>), pass all available ergs to the
callee.</p></li>
</ul>
<p>Function <span
class="inlinecode"><a class="idref" href="#split_ergs_callee_caller"><span
class="id" title="definition">split_ergs_callee_caller</span></a></span>
returns a pair of erg values, where:</p>
<ul>
<li>the first component is the amount of ergs actually passed to the
callee;</li>
<li>the second component is the amount of ergs left to the caller.</li>
</ul>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="split_ergs_callee_caller" class="idref" href="#split_ergs_callee_caller"><span class="id" title="definition">split_ergs_callee_caller</span></a> (<a id="ergs_passed:1" class="idref" href="#ergs_passed:1"><span class="id" title="binder">ergs_passed</span></a> <a id="caller_ergs:2" class="idref" href="#caller_ergs:2"><span class="id" title="binder">caller_ergs</span></a>:<a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a>) : <a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#ergs_passed:1"><span class="id" title="variable">ergs_passed</span></a> <span class="id" title="notation">==</span> <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#caller_ergs:2"><span class="id" title="variable">caller_ergs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#caller_ergs:2"><span class="id" title="variable">caller_ergs</span></a> <a class="idref" href="#::ZMod_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="#ergs_passed:1"><span class="id" title="variable">ergs_passed</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">remaining</span><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> ⇒ <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#ergs_passed:1"><span class="id" title="variable">ergs_passed</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">remaining</span><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#true"><span class="id" title="constructor">true</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">remaining</span><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> ⇒ <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#caller_ergs:2"><span class="id" title="variable">caller_ergs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_nearcall" class="idref" href="#step_nearcall"><span class="id" title="inductive">step_nearcall</span></a>: @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
&nbsp;&nbsp;| <a id="step_NearCall_pass_some_ergs" class="idref" href="#step_NearCall_pass_some_ergs"><span class="id" title="constructor">step_NearCall_pass_some_ergs</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="expt_handler:5" class="idref" href="#expt_handler:5"><span class="id" title="binder">expt_handler</span></a> <a id="call_addr:6" class="idref" href="#call_addr:6"><span class="id" title="binder">call_addr</span></a>: <a class="idref" href="#code_address"><span class="id" title="definition">code_address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="passed_ergs:7" class="idref" href="#passed_ergs:7"><span class="id" title="binder">passed_ergs</span></a> <a id="callee_ergs:8" class="idref" href="#callee_ergs:8"><span class="id" title="binder">callee_ergs</span></a> <a id="caller_ergs:9" class="idref" href="#caller_ergs:9"><span class="id" title="binder">caller_ergs</span></a>: <a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="new_caller:10" class="idref" href="#new_caller:10"><span class="id" title="binder">new_caller</span></a>:<a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a>) (<a id="new_frame:11" class="idref" href="#new_frame:11"><span class="id" title="binder">new_frame</span></a>:<a class="idref" href="#callstack_common"><span class="id" title="record">callstack_common</span></a>) <a id="__flags:12" class="idref" href="#__flags:12"><span class="id" title="binder">__flags</span></a> (<a id="cs:13" class="idref" href="#cs:13"><span class="id" title="binder">cs</span></a>:<a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a>) <a id="high224:14" class="idref" href="#high224:14"><span class="id" title="binder">high224</span></a> <a id="regs:15" class="idref" href="#regs:15"><span class="id" title="binder">regs</span></a> <a id="ctx:16" class="idref" href="#ctx:16"><span class="id" title="binder">ctx</span></a> <a id="pages:17" class="idref" href="#pages:17"><span class="id" title="binder">pages</span></a> <a id="gs:18" class="idref" href="#gs:18"><span class="id" title="binder">gs</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#callee_ergs:8"><span class="id" title="variable">callee_ergs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#caller_ergs:9"><span class="id" title="variable">caller_ergs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#split_ergs_callee_caller"><span class="id" title="definition">split_ergs_callee_caller</span></a> <a class="idref" href="#passed_ergs:7"><span class="id" title="variable">passed_ergs</span></a> (<a class="idref" href="#ergs_remaining"><span class="id" title="definition">ergs_remaining</span></a> <a class="idref" href="#cs:13"><span class="id" title="variable">cs</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_caller:10"><span class="id" title="variable">new_caller</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ergs_set"><span class="id" title="definition">ergs_set</span></a> <a class="idref" href="#caller_ergs:9"><span class="id" title="variable">caller_ergs</span></a> <a class="idref" href="#cs:13"><span class="id" title="variable">cs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_frame:11"><span class="id" title="variable">new_frame</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#mk_cf"><span class="id" title="constructor">mk_cf</span></a> <a class="idref" href="#expt_handler:5"><span class="id" title="variable">expt_handler</span></a> (<a class="idref" href="#sp_get"><span class="id" title="definition">sp_get</span></a> <a class="idref" href="#cs:13"><span class="id" title="variable">cs</span></a>) <a class="idref" href="#call_addr:6"><span class="id" title="variable">call_addr</span></a> <a class="idref" href="#callee_ergs:8"><span class="id" title="variable">callee_ergs</span></a> (<a class="idref" href="#gs_revertable"><span class="id" title="projection">gs_revertable</span></a> <a class="idref" href="#gs:18"><span class="id" title="variable">gs</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_nearcall:3"><span class="id" title="inductive">step_nearcall</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#OpNearCall"><span class="id" title="constructor">OpNearCall</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high224:14"><span class="id" title="variable">high224</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#mk_params"><span class="id" title="constructor">mk_params</span></a> <a class="idref" href="#passed_ergs:7"><span class="id" title="variable">passed_ergs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)) <a class="idref" href="#call_addr:6"><span class="id" title="variable">call_addr</span></a> <a class="idref" href="#expt_handler:5"><span class="id" title="variable">expt_handler</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#__flags:12"><span class="id" title="variable">__flags</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#cs:13"><span class="id" title="variable">cs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#regs:15"><span class="id" title="variable">regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#ctx:16"><span class="id" title="variable">ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:17"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>       := <a class="idref" href="#gs:18"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags_clear"><span class="id" title="definition">flags_clear</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="#new_frame:11"><span class="id" title="variable">new_frame</span></a> <a class="idref" href="#new_caller:10"><span class="id" title="variable">new_caller</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#regs:15"><span class="id" title="variable">regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#ctx:16"><span class="id" title="variable">ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:17"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>       := <a class="idref" href="#gs:18"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#NearCallDefinition"><span class="id" title="section">NearCallDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.NearRet</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Flags</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="NearRetDefinition" class="idref" href="#NearRetDefinition"><span class="id" title="section">NearRetDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable Variables</span> <span class="id" title="var">__</span> <span class="id" title="var">regs</span> <span class="id" title="var">pages</span> <span class="id" title="var">ctx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_nearret" class="idref" href="#step_nearret"><span class="id" title="inductive">step_nearret</span></a>: @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#tsmallstep"><span class="id" title="definition">tsmallstep</span></a> :=<br/>
</div>

<div class="doc"><h1 id="ret">Ret</h1>
<p>The near return and far return share the same syntax, but their
runtime semantic is different:</p>
<ul>
<li>if the topmost frame in callstack is <span
class="inlinecode"><a class="idref" href="#ExternalCall"><span
class="id" title="constructor">ExternalCall</span></a></span>, the far
return semantic is selected (see <span
class="inlinecode"><a class="idref" href="#FarRetDefinition"><span
class="id" title="section">FarRetDefinition</span></a></span>);</li>
<li>if the topmost frame in callstack is <span
class="inlinecode"><a class="idref" href="#InternalCall"><span
class="id" title="constructor">InternalCall</span></a></span>, the near
return semantic is selected (see <span
class="inlinecode"><a class="idref" href="#NearRetDefinition"><span
class="id" title="section">NearRetDefinition</span></a></span>).</li>
</ul>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span class="inlinecode"><span class="id"
title="var">Ret</span></span> <span class="inlinecode">(<span class="id"
title="var">in1</span>:</span> <span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>ret in1</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<ul>
<li><code>ret in1</code></li>
<li><code>ret</code> is an alias for <code>ret r1</code></li>
<li><code>ret.ok in1</code> aliased as <code>ret in1</code></li>
</ul>
<h2 id="summary">Summary</h2>
<p>A normal return from a <strong>near</strong> call. Will pop up
current callframe, give back unspent ergs and continue execution from
the saved return address (from where the call had taken place).</p>
<h2 id="semantic">Semantic</h2>
<ol type="1">
<li>Pass all ergs from the current frame to the parent frame.</li>
<li>Drop current frame.</li>
<li>Clear flags.</li>
</ol>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
<li>Execution stack:
<ul>
<li>Current frame is dropped.</li>
<li>Caller frame:
<ul>
<li>Unspent ergs are given back to caller (but memory growth is paid
first).</li>
</ul></li>
</ul></li>
<li>Flags are cleared.</li>
</ul>
<h2 id="usage">Usage</h2>
<p>Normal return from functions.</p>
<h2 id="related-instructions">Related instructions</h2>
<p>See <span
class="inlinecode"><a class="idref" href="#OpRet"><span
class="id" title="constructor">OpRet</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpNearPanicTo"><span
class="id" title="constructor">OpNearPanicTo</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpNearRevertTo"><span
class="id" title="constructor">OpNearRevertTo</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpNearRetTo"><span
class="id" title="constructor">OpNearRetTo</span></a></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_NearRet" class="idref" href="#step_NearRet"><span class="id" title="constructor">step_NearRet</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cf:3" class="idref" href="#cf:3"><span class="id" title="binder">cf</span></a> <a id="caller_stack:4" class="idref" href="#caller_stack:4"><span class="id" title="binder">caller_stack</span></a> <a id="new_caller:5" class="idref" href="#new_caller:5"><span class="id" title="binder">new_caller</span></a> <a id="pages:6" class="idref" href="#pages:6"><span class="id" title="binder">pages</span></a> <a id="_ignore_arg:7" class="idref" href="#_ignore_arg:7"><span class="id" title="binder">_ignore_arg</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_return_caller_and_drop"><span class="id" title="inductive">ergs_return_caller_and_drop</span></a> (<a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="#cf:3"><span class="id" title="variable">cf</span></a> <a class="idref" href="#caller_stack:4"><span class="id" title="variable">caller_stack</span></a>) <a class="idref" href="#new_caller:5"><span class="id" title="variable">new_caller</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_nearret:1"><span class="id" title="inductive">step_nearret</span></a> (<a class="idref" href="#OpRet"><span class="id" title="constructor">OpRet</span></a> <a class="idref" href="#_ignore_arg:7"><span class="id" title="variable">_ignore_arg</span></a>) {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <span class="id" title="var">__</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="#cf:3"><span class="id" title="variable">cf</span></a> <a class="idref" href="#caller_stack:4"><span class="id" title="variable">caller_stack</span></a>;<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <span class="id" title="var">regs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:6"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <span class="id" title="var">ctx</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags_clear"><span class="id" title="definition">flags_clear</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#new_caller:5"><span class="id" title="variable">new_caller</span></a>;<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <span class="id" title="var">regs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:6"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <span class="id" title="var">ctx</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable No Variables</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#NearRetDefinition"><span class="id" title="section">NearRetDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.NearRevert</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Flags</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">GPR</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="NearRevertDefinition" class="idref" href="#NearRevertDefinition"><span class="id" title="section">NearRevertDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable Variables</span> <span class="id" title="var">regs</span> <span class="id" title="var">__</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_nearrevert" class="idref" href="#step_nearrevert"><span class="id" title="inductive">step_nearrevert</span></a>: @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
</div>

<div class="doc"><h1 id="oprevert-case-of-near-revert">OpRevert (case of near
revert)</h1>
<p>The near revert and far revert share the same syntax, but their
runtime semantic is different:</p>
<ul>
<li>if the topmost frame in callstack is <span
class="inlinecode"><a class="idref" href="#ExternalCall"><span
class="id" title="constructor">ExternalCall</span></a></span>, the far
revert semantic is selected (see <span
class="inlinecode"><a class="idref" href="#FarRevertDefinition"><span
class="id" title="section">FarRevertDefinition</span></a></span>);</li>
<li>if the topmost frame in callstack is <span
class="inlinecode"><a class="idref" href="#InternalCall"><span
class="id" title="constructor">InternalCall</span></a></span>, the near
revert semantic is selected (see <span
class="inlinecode"><a class="idref" href="#NearRevertDefinition"><span
class="id" title="section">NearRevertDefinition</span></a></span>).</li>
</ul>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpRevert"><span
class="id" title="constructor">OpRevert</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>rev in1</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<ul>
<li><code>revert</code> is an alias for <code>revert r1</code></li>
<li><code>ret.revert in1</code></li>
</ul>
<h2 id="summary">Summary</h2>
<p>An erroneous return from a <strong>near</strong> call, executes an
exception handler. Will revert all changes in <span
class="inlinecode"><a class="idref" href="#global_state"><span
class="id" title="record">global_state</span></a></span> produced in the
current frame, pop up current frame, give back unspent ergs, and proceed
to execute exception handler.</p>
<p>The assembler expands <code>revert</code> to <code>revert r1</code>,
but <code>r1</code> is ignored by returns from near calls.</p>
<h2 id="semantic">Semantic</h2>
<ol type="1">
<li>Perform a <span
class="inlinecode"><a class="idref" href="#rollback"><span
class="id" title="inductive">rollback</span></a></span>.</li>
<li>Retrieve an exception handler <span class="math inline">E</span>
from the current frame.</li>
<li>Pass all ergs from the topmost frame to the parent frame.</li>
<li>Drop topmost frame.</li>
<li>Clear flags</li>
<li>Proceed with executing <span class="math inline">E</span>.</li>
</ol>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
<li>Flags are cleared.</li>
<li>Execution stack:
<ul>
<li>Current frame is dropped.</li>
<li>Caller frame:
<ul>
<li>Unspent ergs are given back to caller (but memory growth is paid
first).</li>
<li>Program counter is overwritten with the exception handler address of
the dead frame.</li>
</ul></li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<p>Return from a recoverable error, fail-safe.</p>
<h2 id="related-instructions">Related instructions</h2>
<p>See <span
class="inlinecode"><a class="idref" href="#OpRet"><span
class="id" title="constructor">OpRet</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpNearPanicTo"><span
class="id" title="constructor">OpNearPanicTo</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpNearRevertTo"><span
class="id" title="constructor">OpNearRevertTo</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpNearRetTo"><span
class="id" title="constructor">OpNearRetTo</span></a></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_NearRevert" class="idref" href="#step_NearRevert"><span class="id" title="constructor">step_NearRevert</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cf:3" class="idref" href="#cf:3"><span class="id" title="binder">cf</span></a> <a id="caller_stack:4" class="idref" href="#caller_stack:4"><span class="id" title="binder">caller_stack</span></a> <a id="new_caller:5" class="idref" href="#new_caller:5"><span class="id" title="binder">new_caller</span></a> <a id="new_cs:6" class="idref" href="#new_cs:6"><span class="id" title="binder">new_cs</span></a> <a id="_eh:7" class="idref" href="#_eh:7"><span class="id" title="binder">_eh</span></a> <a id="_sp:8" class="idref" href="#_sp:8"><span class="id" title="binder">_sp</span></a> <a id="_pc:9" class="idref" href="#_pc:9"><span class="id" title="binder">_pc</span></a> <a id="_ergs:10" class="idref" href="#_ergs:10"><span class="id" title="binder">_ergs</span></a> <a id="saved:11" class="idref" href="#saved:11"><span class="id" title="binder">saved</span></a> <a id="ctx:12" class="idref" href="#ctx:12"><span class="id" title="binder">ctx</span></a> <a id="gs:13" class="idref" href="#gs:13"><span class="id" title="binder">gs</span></a> <a id="new_gs:14" class="idref" href="#new_gs:14"><span class="id" title="binder">new_gs</span></a> <a id="pages:15" class="idref" href="#pages:15"><span class="id" title="binder">pages</span></a> <a id="_ignore_arg:16" class="idref" href="#_ignore_arg:16"><span class="id" title="binder">_ignore_arg</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cs:17" class="idref" href="#cs:17"><span class="id" title="binder">cs</span></a> := <a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> (<a class="idref" href="#mk_cf"><span class="id" title="constructor">mk_cf</span></a> <a class="idref" href="#_eh:7"><span class="id" title="variable">_eh</span></a> <a class="idref" href="#_sp:8"><span class="id" title="variable">_sp</span></a> <a class="idref" href="#_pc:9"><span class="id" title="variable">_pc</span></a> <a class="idref" href="#_ergs:10"><span class="id" title="variable">_ergs</span></a> <a class="idref" href="#saved:11"><span class="id" title="variable">saved</span></a>) <a class="idref" href="#caller_stack:4"><span class="id" title="variable">caller_stack</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="handler:18" class="idref" href="#handler:18"><span class="id" title="binder">handler</span></a> := <a class="idref" href="#active_exception_handler"><span class="id" title="definition">active_exception_handler</span></a> <a class="idref" href="#cs:17"><span class="id" title="variable">cs</span></a> <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_return_caller_and_drop"><span class="id" title="inductive">ergs_return_caller_and_drop</span></a> <a class="idref" href="#cs:17"><span class="id" title="variable">cs</span></a> <a class="idref" href="#new_caller:5"><span class="id" title="variable">new_caller</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#rollback"><span class="id" title="inductive">rollback</span></a> <a class="idref" href="#saved:11"><span class="id" title="variable">saved</span></a> <a class="idref" href="#gs:13"><span class="id" title="variable">gs</span></a> <a class="idref" href="#new_gs:14"><span class="id" title="variable">new_gs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_cs:6"><span class="id" title="variable">new_cs</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#pc_set"><span class="id" title="definition">pc_set</span></a> <a class="idref" href="#handler:18"><span class="id" title="variable">handler</span></a> <a class="idref" href="#new_caller:5"><span class="id" title="variable">new_caller</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_nearrevert:1"><span class="id" title="inductive">step_nearrevert</span></a> (<a class="idref" href="#OpRevert"><span class="id" title="constructor">OpRevert</span></a> <a class="idref" href="#_ignore_arg:16"><span class="id" title="variable">_ignore_arg</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <span class="id" title="var">__</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="#cf:3"><span class="id" title="variable">cf</span></a> <a class="idref" href="#caller_stack:4"><span class="id" title="variable">caller_stack</span></a>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <span class="id" title="var">regs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:15"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#ctx:12"><span class="id" title="variable">ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a> := <a class="idref" href="#gs:13"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags_clear"><span class="id" title="definition">flags_clear</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#new_cs:6"><span class="id" title="variable">new_cs</span></a>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <span class="id" title="var">regs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:15"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#ctx:12"><span class="id" title="variable">ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a> := <a class="idref" href="#new_gs:14"><span class="id" title="variable">new_gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable No Variables</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#NearRevertDefinition"><span class="id" title="section">NearRevertDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.NearRetTo</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Flags</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="NearRetToDefinition" class="idref" href="#NearRetToDefinition"><span class="id" title="section">NearRetToDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable Variables</span> <span class="id" title="var">__</span> <span class="id" title="var">regs</span> <span class="id" title="var">pages</span> <span class="id" title="var">ctx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_nearretto" class="idref" href="#step_nearretto"><span class="id" title="inductive">step_nearretto</span></a>: @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#tsmallstep"><span class="id" title="definition">tsmallstep</span></a> :=<br/>
</div>

<div class="doc"><h1 id="opnearretto">OpNearRetTo</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpNearRetTo"><span
class="id" title="constructor">OpNearRetTo</span></a></span> <span
class="inlinecode">(<span class="id" title="var">label</span>:</span>
<span
class="inlinecode"><a class="idref" href="#imm_in"><span
class="id" title="inductive">imm_in</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>retl label</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<p><code>ret.ok.to_label label</code></p>
<h2 id="summary">Summary</h2>
<p>A normal return from a <strong>near</strong> call. Will pop up
current callframe, give back unspent ergs and continue execution from an
explicitly provided label.</p>
<h2 id="semantic">Semantic</h2>
<ol type="1">
<li>Pass all ergs from the current frame to the parent frame.</li>
<li>Drop current frame.</li>
<li>Clear flags</li>
<li>Set PC to the label value.</li>
</ol>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
<li>Flags are cleared.</li>
<li>Execution stack:
<ul>
<li>Current frame is dropped.</li>
<li>Caller frame:
<ul>
<li>Unspent ergs are given back to caller (but memory growth is paid
first).</li>
<li>program counter is assigned the label.</li>
</ul></li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<p>A combination of a normal return and jump.</p>
<h2 id="related-instructions">Related instructions</h2>
<p>See <span
class="inlinecode"><a class="idref" href="#OpRet"><span
class="id" title="constructor">OpRet</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpNearPanicTo"><span
class="id" title="constructor">OpNearPanicTo</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpNearRevertTo"><span
class="id" title="constructor">OpNearRevertTo</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpNearRetTo"><span
class="id" title="constructor">OpNearRetTo</span></a></span>.</p>
</div>
<div class="code">
<br/>
<br/>
&nbsp;&nbsp;| <a id="step_NearRetTo" class="idref" href="#step_NearRetTo"><span class="id" title="constructor">step_NearRetTo</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cf:3" class="idref" href="#cf:3"><span class="id" title="binder">cf</span></a> <a id="caller_stack:4" class="idref" href="#caller_stack:4"><span class="id" title="binder">caller_stack</span></a> <a id="new_caller:5" class="idref" href="#new_caller:5"><span class="id" title="binder">new_caller</span></a> <a id="label:6" class="idref" href="#label:6"><span class="id" title="binder">label</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_return_caller_and_drop"><span class="id" title="inductive">ergs_return_caller_and_drop</span></a> (<a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="#cf:3"><span class="id" title="variable">cf</span></a> <a class="idref" href="#caller_stack:4"><span class="id" title="variable">caller_stack</span></a>) <a class="idref" href="#new_caller:5"><span class="id" title="variable">new_caller</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_nearretto:1"><span class="id" title="inductive">step_nearretto</span></a> (<a class="idref" href="#OpNearRetTo"><span class="id" title="constructor">OpNearRetTo</span></a> <a class="idref" href="#label:6"><span class="id" title="variable">label</span></a>) {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <span class="id" title="var">__</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="#cf:3"><span class="id" title="variable">cf</span></a> <a class="idref" href="#caller_stack:4"><span class="id" title="variable">caller_stack</span></a>;<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <span class="id" title="var">regs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <span class="id" title="var">pages</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <span class="id" title="var">ctx</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags_clear"><span class="id" title="definition">flags_clear</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#pc_set"><span class="id" title="definition">pc_set</span></a> <a class="idref" href="#label:6"><span class="id" title="variable">label</span></a> <a class="idref" href="#new_caller:5"><span class="id" title="variable">new_caller</span></a>;<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <span class="id" title="var">regs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <span class="id" title="var">pages</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <span class="id" title="var">ctx</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable No Variables</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#NearRetToDefinition"><span class="id" title="section">NearRetToDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.NearRevertTo</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Flags</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">GPR</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="NearRevert" class="idref" href="#NearRevert"><span class="id" title="section">NearRevert</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable Variables</span> <span class="id" title="var">regs</span> <span class="id" title="var">pages</span> <span class="id" title="var">__</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_nearrevertto" class="idref" href="#step_nearrevertto"><span class="id" title="inductive">step_nearrevertto</span></a>: @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
</div>

<div class="doc"><h1 id="opnearrevertto">OpNearRevertTo</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpNearRevertTo"><span
class="id" title="constructor">OpNearRevertTo</span></a></span> <span
class="inlinecode">(<span class="id" title="var">label</span>:</span>
<span
class="inlinecode"><a class="idref" href="#imm_in"><span
class="id" title="inductive">imm_in</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>revl label</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<p><code>ret.revert.to_label label</code></p>
<h2 id="summary">Summary</h2>
<p>An erroneous return from a <strong>near</strong> call to a specified
label. Will revert all changes in <span
class="inlinecode"><a class="idref" href="#global_state"><span
class="id" title="record">global_state</span></a></span> produced in the
current frame, pop up current frame, give back unspent ergs, and proceed
to execute exception handler.</p>
<h2 id="semantic">Semantic</h2>
<ol type="1">
<li>Perform a <span
class="inlinecode"><a class="idref" href="#rollback"><span
class="id" title="inductive">rollback</span></a></span>.</li>
<li>Pass all ergs from the topmost frame to the parent frame.</li>
<li>Drop topmost frame.</li>
<li>Clear flags</li>
<li>Proceed with executing <span class="inlinecode"><span class="id"
title="var">label</span></span>, i.e. replace program counter with the
label’s value.</li>
</ol>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
<li>Flags are cleared.</li>
<li>Execution stack:
<ul>
<li>Current frame is dropped.</li>
<li>Caller frame:
<ul>
<li>Unspent ergs are given back to caller (but memory growth is paid
first).</li>
<li>Program counter is overwritten with the label.</li>
</ul></li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<p>Return from a recoverable error, fail-safe.</p>
<h2 id="related-instructions">Related instructions</h2>
<p>See <span
class="inlinecode"><a class="idref" href="#OpRet"><span
class="id" title="constructor">OpRet</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpNearPanicTo"><span
class="id" title="constructor">OpNearPanicTo</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpNearRevertTo"><span
class="id" title="constructor">OpNearRevertTo</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpNearRetTo"><span
class="id" title="constructor">OpNearRetTo</span></a></span></p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_NearRevert" class="idref" href="#step_NearRevert"><span class="id" title="constructor">step_NearRevert</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cf:3" class="idref" href="#cf:3"><span class="id" title="binder">cf</span></a> <a id="caller_stack:4" class="idref" href="#caller_stack:4"><span class="id" title="binder">caller_stack</span></a> <a id="new_caller:5" class="idref" href="#new_caller:5"><span class="id" title="binder">new_caller</span></a> <a id="_eh:6" class="idref" href="#_eh:6"><span class="id" title="binder">_eh</span></a> <a id="_sp:7" class="idref" href="#_sp:7"><span class="id" title="binder">_sp</span></a> <a id="_pc:8" class="idref" href="#_pc:8"><span class="id" title="binder">_pc</span></a> <a id="_ergs:9" class="idref" href="#_ergs:9"><span class="id" title="binder">_ergs</span></a> <a id="saved:10" class="idref" href="#saved:10"><span class="id" title="binder">saved</span></a> <a id="ctx:11" class="idref" href="#ctx:11"><span class="id" title="binder">ctx</span></a> <a id="label:12" class="idref" href="#label:12"><span class="id" title="binder">label</span></a> <a id="gs:13" class="idref" href="#gs:13"><span class="id" title="binder">gs</span></a> <a id="new_gs:14" class="idref" href="#new_gs:14"><span class="id" title="binder">new_gs</span></a> <a id="pages:15" class="idref" href="#pages:15"><span class="id" title="binder">pages</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cs:16" class="idref" href="#cs:16"><span class="id" title="binder">cs</span></a> := <a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> (<a class="idref" href="#mk_cf"><span class="id" title="constructor">mk_cf</span></a> <a class="idref" href="#_eh:6"><span class="id" title="variable">_eh</span></a> <a class="idref" href="#_sp:7"><span class="id" title="variable">_sp</span></a> <a class="idref" href="#_pc:8"><span class="id" title="variable">_pc</span></a> <a class="idref" href="#_ergs:9"><span class="id" title="variable">_ergs</span></a> <a class="idref" href="#saved:10"><span class="id" title="variable">saved</span></a>) <a class="idref" href="#caller_stack:4"><span class="id" title="variable">caller_stack</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="handler:17" class="idref" href="#handler:17"><span class="id" title="binder">handler</span></a> := <a class="idref" href="#active_exception_handler"><span class="id" title="definition">active_exception_handler</span></a> <a class="idref" href="#cs:16"><span class="id" title="variable">cs</span></a> <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_return_caller_and_drop"><span class="id" title="inductive">ergs_return_caller_and_drop</span></a> <a class="idref" href="#cs:16"><span class="id" title="variable">cs</span></a> <a class="idref" href="#new_caller:5"><span class="id" title="variable">new_caller</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#rollback"><span class="id" title="inductive">rollback</span></a> <a class="idref" href="#saved:10"><span class="id" title="variable">saved</span></a> <a class="idref" href="#gs:13"><span class="id" title="variable">gs</span></a> <a class="idref" href="#new_gs:14"><span class="id" title="variable">new_gs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_nearrevertto:1"><span class="id" title="inductive">step_nearrevertto</span></a> (<a class="idref" href="#OpNearRevertTo"><span class="id" title="constructor">OpNearRevertTo</span></a> <a class="idref" href="#label:12"><span class="id" title="variable">label</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <span class="id" title="var">__</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="#cf:3"><span class="id" title="variable">cf</span></a> <a class="idref" href="#caller_stack:4"><span class="id" title="variable">caller_stack</span></a>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <span class="id" title="var">regs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:15"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#ctx:11"><span class="id" title="variable">ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a> := <a class="idref" href="#gs:13"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags_clear"><span class="id" title="definition">flags_clear</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#pc_set"><span class="id" title="definition">pc_set</span></a> <a class="idref" href="#label:12"><span class="id" title="variable">label</span></a> <a class="idref" href="#new_caller:5"><span class="id" title="variable">new_caller</span></a>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <span class="id" title="var">regs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:15"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#ctx:11"><span class="id" title="variable">ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a> := <a class="idref" href="#new_gs:14"><span class="id" title="variable">new_gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#NearRevert"><span class="id" title="section">NearRevert</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.StepPanic</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Addressing</span></a> <a class="idref" href="#"><span class="id" title="library">CallStack</span></a> <a class="idref" href="#"><span class="id" title="library">Common</span></a> <a class="idref" href="#"><span class="id" title="library">GPR</span></a> <a class="idref" href="#"><span class="id" title="library">Flags</span></a> <a class="idref" href="#"><span class="id" title="library">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="library">State</span></a> <a class="idref" href="#"><span class="id" title="library">Steps</span></a> <a class="idref" href="#"><span class="id" title="library">VMPanic</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Addressing</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">GPR</span></a> <a class="idref" href="#"><span class="id" title="module">Flags</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a> <a class="idref" href="#"><span class="id" title="module">Steps</span></a> <a class="idref" href="#"><span class="id" title="module">VMPanic</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">RecordSetNotations</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="StepPanic" class="idref" href="#StepPanic"><span class="id" title="section">StepPanic</span></a>.<br/>
</div>

<div class="doc"><h1 id="handling-panics">Handling panics</h1>
<p>EraVM handles the panic situation as follows:</p>
<ul>
<li>return from the current function signaling an error;</li>
<li>execute exception handler;</li>
<li>burn all ergs in current frame;</li>
<li>set OF flag;</li>
<li>restore depot and event queues to the state before external call
(see <span
class="inlinecode"><a class="idref" href="#gs_revertable"><span
class="id" title="projection">gs_revertable</span></a></span>).</li>
<li>when returning from a far call, return no data.</li>
</ul>
<h2 id="case-1-panic-from-near-call">Case 1: <code>panic</code> from
near call</h2>
<ol type="1">
<li>Perform a <span
class="inlinecode"><a class="idref" href="#rollback"><span
class="id" title="inductive">rollback</span></a></span>.</li>
<li>Drop current frame with its ergs.</li>
<li>Set PC to the exception handler of the dropped frame.</li>
<li>Clear flags, and set OF.</li>
<li>Clears the context register.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_panic" class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a id="reason:1" class="idref" href="#reason:1"><span class="id" title="binder">reason</span></a>: <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
&nbsp;&nbsp;| <a id="step_PanicLocal_nolabel" class="idref" href="#step_PanicLocal_nolabel"><span class="id" title="constructor">step_PanicLocal_nolabel</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="flags:4" class="idref" href="#flags:4"><span class="id" title="binder">flags</span></a> <a id="pages:5" class="idref" href="#pages:5"><span class="id" title="binder">pages</span></a> <a id="cf:6" class="idref" href="#cf:6"><span class="id" title="binder">cf</span></a> <a id="caller_stack:7" class="idref" href="#caller_stack:7"><span class="id" title="binder">caller_stack</span></a> <a id="regs:8" class="idref" href="#regs:8"><span class="id" title="binder">regs</span></a> <a id="gs:9" class="idref" href="#gs:9"><span class="id" title="binder">gs</span></a> <a id="gs':10" class="idref" href="#gs':10"><span class="id" title="binder">gs'</span></a> <a id="__:11" class="idref" href="#__:11"><span class="id" title="binder">__</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="handler:12" class="idref" href="#handler:12"><span class="id" title="binder">handler</span></a> := <a class="idref" href="#active_exception_handler"><span class="id" title="definition">active_exception_handler</span></a> (<a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="#cf:6"><span class="id" title="variable">cf</span></a> <a class="idref" href="#caller_stack:7"><span class="id" title="variable">caller_stack</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#rollback"><span class="id" title="inductive">rollback</span></a> (<a class="idref" href="#cf_saved_checkpoint"><span class="id" title="projection">cf_saved_checkpoint</span></a> <a class="idref" href="#cf:6"><span class="id" title="variable">cf</span></a>) <a class="idref" href="#gs:9"><span class="id" title="variable">gs</span></a> <a class="idref" href="#gs':10"><span class="id" title="variable">gs'</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic:2"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#reason:1"><span class="id" title="variable">reason</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a>:= {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags:4"><span class="id" title="variable">flags</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#InternalCall"><span class="id" title="constructor">InternalCall</span></a> <a class="idref" href="#cf:6"><span class="id" title="variable">cf</span></a> <a class="idref" href="#caller_stack:7"><span class="id" title="variable">caller_stack</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#regs:8"><span class="id" title="variable">regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#__:11"><span class="id" title="variable">__</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#Panic"><span class="id" title="constructor">Panic</span></a> <a class="idref" href="#reason:1"><span class="id" title="variable">reason</span></a>;<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:5"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>       := <a class="idref" href="#gs:9"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a>:= {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#set_overflow"><span class="id" title="definition">set_overflow</span></a> <a class="idref" href="#flags_clear"><span class="id" title="definition">flags_clear</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#regs:8"><span class="id" title="variable">regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#pc_set"><span class="id" title="definition">pc_set</span></a> <a class="idref" href="#cf:6"><span class="id" title="variable">cf</span></a>.(<a class="idref" href="#cf_exception_handler_location"><span class="id" title="projection">cf_exception_handler_location</span></a>) <a class="idref" href="#caller_stack:7"><span class="id" title="variable">caller_stack</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#zero128"><span class="id" title="definition">zero128</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:5"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>       := <a class="idref" href="#gs':10"><span class="id" title="variable">gs'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;</div>

<div class="doc"><h2 id="case-2-panic-from-external-call">Case 2: <code>panic</code> from
external call</h2>
<p>Performs all the same actions as a panic from internal call: 1.
Perform a <span
class="inlinecode"><a class="idref" href="#rollback"><span
class="id" title="inductive">rollback</span></a></span>. 2. Drop current
frame and its ergs 3. Clear flags and set OF. 4. Clear context register.
5. Set PC to the exception handler address of a dropped frame..</p>
<p>In addition to that: 6. Put an encoded zero-pointer into
<code>R1</code> and tag <code>R1</code> as a pointer. All other
registers are zeroed. Registers <code>R2</code>, <code>R3</code> and
<code>R4</code> are reserved and may gain a special meaning in newer
versions of EraVM.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_PanicExt" class="idref" href="#step_PanicExt"><span class="id" title="constructor">step_PanicExt</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="flags:13" class="idref" href="#flags:13"><span class="id" title="binder">flags</span></a> <a id="pages:14" class="idref" href="#pages:14"><span class="id" title="binder">pages</span></a> <a id="cf:15" class="idref" href="#cf:15"><span class="id" title="binder">cf</span></a> <a id="caller_stack:16" class="idref" href="#caller_stack:16"><span class="id" title="binder">caller_stack</span></a> <a id="__:17" class="idref" href="#__:17"><span class="id" title="binder">__</span></a> <a id="regs:18" class="idref" href="#regs:18"><span class="id" title="binder">regs</span></a> <a id="gs:19" class="idref" href="#gs:19"><span class="id" title="binder">gs</span></a> <a id="gs':20" class="idref" href="#gs':20"><span class="id" title="binder">gs'</span></a> <a id="new_regs:21" class="idref" href="#new_regs:21"><span class="id" title="binder">new_regs</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cs0:22" class="idref" href="#cs0:22"><span class="id" title="binder">cs0</span></a> := <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="#cf:15"><span class="id" title="variable">cf</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#caller_stack:16"><span class="id" title="variable">caller_stack</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#rollback"><span class="id" title="inductive">rollback</span></a> (<a class="idref" href="#cf_saved_checkpoint"><span class="id" title="projection">cf_saved_checkpoint</span></a> <a class="idref" href="#cf:15"><span class="id" title="variable">cf</span></a>) <a class="idref" href="#gs:19"><span class="id" title="variable">gs</span></a> <a class="idref" href="#gs':20"><span class="id" title="variable">gs'</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_regs:21"><span class="id" title="variable">new_regs</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#regs_state_zero"><span class="id" title="definition">regs_state_zero</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#r1"><span class="id" title="projection">r1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#zero256"><span class="id" title="definition">zero256</span></a> <span class="id" title="notation">|></span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic:2"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#reason:1"><span class="id" title="variable">reason</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags:13"><span class="id" title="variable">flags</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#cs0:22"><span class="id" title="variable">cs0</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#regs:18"><span class="id" title="variable">regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#__:17"><span class="id" title="variable">__</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#Panic"><span class="id" title="constructor">Panic</span></a> <a class="idref" href="#reason:1"><span class="id" title="variable">reason</span></a>;<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:14"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>       := <a class="idref" href="#gs:19"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#set_overflow"><span class="id" title="definition">set_overflow</span></a> <a class="idref" href="#flags_clear"><span class="id" title="definition">flags_clear</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#new_regs:21"><span class="id" title="variable">new_regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#pc_set"><span class="id" title="definition">pc_set</span></a> (<a class="idref" href="#active_exception_handler"><span class="id" title="definition">active_exception_handler</span></a> <a class="idref" href="#cs0:22"><span class="id" title="variable">cs0</span></a>) <a class="idref" href="#caller_stack:16"><span class="id" title="variable">caller_stack</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#zero128"><span class="id" title="definition">zero128</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:14"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>       := <a class="idref" href="#gs':20"><span class="id" title="variable">gs'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#StepPanic"><span class="id" title="section">StepPanic</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.Panic</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="library">VMPanic</span></a> <a class="idref" href="#"><span class="id" title="library">StepPanic</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="module">VMPanic</span></a> <a class="idref" href="#"><span class="id" title="module">StepPanic</span></a>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <a id="step_oppanic" class="idref" href="#step_oppanic"><span class="id" title="inductive">step_oppanic</span></a>: @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
&nbsp;&nbsp;</div>

<div class="doc"><h1
id="oppanic-irrecoverable-error-not-normal-returnnot-return-from-recoverable-error">OpPanic
(irrecoverable error, not normal return/not return from recoverable
error)</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpPanic"><span
class="id" title="constructor">OpPanic</span></a></span></p>
<h2 id="syntax">Syntax</h2>
<p><code>pnc</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<p><code>ret.panic</code> aliased as <code>panic</code></p>
<h2 id="summary">Summary</h2>
<p>Return from a function/contract signaling an error; execute exception
handler, return unspent ergs to the parent, set OF flag, return nothing,
perform <span
class="inlinecode"><a class="idref" href="#rollback"><span
class="id" title="inductive">rollback</span></a></span>.</p>
<h2 id="semantic">Semantic</h2>
<p>An abnormal return from a near or far call. Will drop current
callframe, burn all ergs and pass control to the current exception
handler, setting OF flag.</p>
<p>Additionally, restore storage, transient storage, and event queues to
the state before external call.</p>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
<li>Flags are cleared, then OF is set.</li>
<li>Context register is zeroed (only returns from far calls).</li>
<li>Registers are cleared (only returns from far calls).</li>
<li>Execution stack:
<ul>
<li>Current frame is dropped.</li>
<li>Caller frame:
<ul>
<li>if a label is explicitly provided, and current frame is internal
(near call), then caller’s PC is overwritten with the label. Returns
from external calls ignore label, even if it is explicitly
provided.</li>
<li>Unspent ergs are given back to caller (but memory growth is paid
first).</li>
</ul></li>
</ul></li>
<li>Storage changes are reverted.</li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Abnormal returns from near/far calls when an irrecoverable error has
happened. Use <span
class="inlinecode"><a class="idref" href="#OpRevert"><span
class="id" title="constructor">OpRevert</span></a></span> for
recoverable errors.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<p>See <span
class="inlinecode"><a class="idref" href="#OpRet"><span
class="id" title="constructor">OpRet</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpNearPanicTo"><span
class="id" title="constructor">OpNearPanicTo</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpNearRevertTo"><span
class="id" title="constructor">OpNearRevertTo</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpNearRetTo"><span
class="id" title="constructor">OpNearRetTo</span></a></span>.</p>
</div>
<div class="code">
<br/>
<br/>
| <a id="step_trigger_panic" class="idref" href="#step_trigger_panic"><span class="id" title="constructor">step_trigger_panic</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s:3" class="idref" href="#s:3"><span class="id" title="binder">s</span></a> <a id="s':4" class="idref" href="#s':4"><span class="id" title="binder">s'</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#TriggeredExplicitly"><span class="id" title="constructor">TriggeredExplicitly</span></a> <a class="idref" href="#s:3"><span class="id" title="variable">s</span></a> <a class="idref" href="#s':4"><span class="id" title="variable">s'</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_oppanic:1"><span class="id" title="inductive">step_oppanic</span></a> <a class="idref" href="#OpPanic"><span class="id" title="constructor">OpPanic</span></a> <a class="idref" href="#s:3"><span class="id" title="variable">s</span></a> <a class="idref" href="#s':4"><span class="id" title="variable">s'</span></a>.<br/>

<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.NearPanicTo</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="library">StepPanic</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Flags</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">GPR</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="module">VMPanic</span></a> <span class="id" title="module">RecordSetNotations</span> <a class="idref" href="#"><span class="id" title="module">StepPanic</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="NearPanicToDefinition" class="idref" href="#NearPanicToDefinition"><span class="id" title="section">NearPanicToDefinition</span></a>.<br/>
<span class="id" title="keyword">Inductive</span> <a id="step_panicto" class="idref" href="#step_panicto"><span class="id" title="inductive">step_panicto</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
</div>

<div class="doc"><h1 id="opnearpanicto">OpNearPanicTo</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpNearPanicTo"><span
class="id" title="constructor">OpNearPanicTo</span></a></span> <span
class="inlinecode">(<span class="id" title="var">label</span>:</span>
<span
class="inlinecode"><a class="idref" href="#imm_in"><span
class="id" title="inductive">imm_in</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>pncl label</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<p><code>ret.panic label</code> aliased as <code>panic label</code></p>
<h2 id="summary">Summary</h2>
<p>An erroneous return from a <strong>near</strong> call to a specified
label. Will revert all changes in <span
class="inlinecode"><a class="idref" href="#global_state"><span
class="id" title="record">global_state</span></a></span> produced in the
current frame, drop the current frame, give back unspent ergs, and
proceed to execute exception handler.</p>
<h2 id="semantic">Semantic</h2>
<ol type="1">
<li>Perform a <span
class="inlinecode"><a class="idref" href="#rollback"><span
class="id" title="inductive">rollback</span></a></span>.</li>
<li>Drop topmost frame. Its ergs are burned (lost).</li>
<li>Set flag <span
class="inlinecode"><a class="idref" href="#OF_LT"><span
class="id" title="inductive">OF_LT</span></a></span>, clear all other
flags.</li>
<li>Proceed with executing <span class="inlinecode"><span class="id"
title="var">label</span></span>, i.e. replace program counter with the
label’s value.</li>
</ol>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
<li>Execution stack:
<ul>
<li>Current frame is dropped.</li>
<li>Caller frame:
<ul>
<li>Unspent ergs are given back to caller (but memory growth is paid
first).</li>
<li>Program counter is overwritten with the exception handler address of
the dead frame.</li>
</ul></li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<p>Return from an irrecoverable error, fail-fast.</p>
<h2 id="related-instructions">Related instructions</h2>
<p>See <span
class="inlinecode"><a class="idref" href="#OpRet"><span
class="id" title="constructor">OpRet</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpNearPanicTo"><span
class="id" title="constructor">OpNearPanicTo</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpNearRevertTo"><span
class="id" title="constructor">OpNearRevertTo</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpNearRetTo"><span
class="id" title="constructor">OpNearRetTo</span></a></span>.</p>
</div>
<div class="code">
<br/>
| <a id="step_NearPanic" class="idref" href="#step_NearPanic"><span class="id" title="constructor">step_NearPanic</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="label:3" class="idref" href="#label:3"><span class="id" title="binder">label</span></a> <a id="s1:4" class="idref" href="#s1:4"><span class="id" title="binder">s1</span></a> <a id="s2:5" class="idref" href="#s2:5"><span class="id" title="binder">s2</span></a> <a id="s3:6" class="idref" href="#s3:6"><span class="id" title="binder">s3</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#TriggeredExplicitly"><span class="id" title="constructor">TriggeredExplicitly</span></a> <a class="idref" href="#s1:4"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:5"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#s3:6"><span class="id" title="variable">s3</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#s2:5"><span class="id" title="variable">s2</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> <span class="id" title="notation">::=</span> <span class="id" title="keyword">fun</span> <a id="ts:7" class="idref" href="#ts:7"><span class="id" title="binder">ts</span></a> ⇒ <a class="idref" href="#ts:7"><span class="id" title="variable">ts</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="#pc_set"><span class="id" title="definition">pc_set</span></a> <a class="idref" href="#label:3"><span class="id" title="variable">label</span></a>  <span class="id" title="notation">|></span> <span class="id" title="notation">|></span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panicto:1"><span class="id" title="inductive">step_panicto</span></a> (@<a class="idref" href="#OpNearPanicTo"><span class="id" title="constructor">OpNearPanicTo</span></a> <a class="idref" href="#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="#label:3"><span class="id" title="variable">label</span></a>) <a class="idref" href="#s1:4"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s3:6"><span class="id" title="variable">s3</span></a><br/>
.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#NearPanicToDefinition"><span class="id" title="section">NearPanicToDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.Farcall</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span><br/>
<a class="idref" href="#"><span class="id" title="library">ABI</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">CallStack</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">Common</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">Decommitter</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">Ergs</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">MemoryManagement</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">MemoryOps</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">Pointer</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">State</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">TransientMemory</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">isa.CoreSet</span></a><br/>
.<br/>

<br/>
<span class="id" title="keyword">Import</span><br/>
&nbsp;&nbsp;<a class="idref" href="#Z"><span class="id" title="module">BinIntDef.Z</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Bool</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">List</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ListNotations"><span class="id" title="module">ListNotations</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">ZArith</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">ABI</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">FarCallABI</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">FatPointerABI</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">CallStack</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Coder</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Common</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Core</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Decommitter</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Ergs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Flags</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">GPR</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">KernelMode</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">memory.Depot</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">MemoryBase</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">MemoryContext</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">MemoryManagement</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">MemoryOps</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="module">RecordSetNotations</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">State</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">VersionedHash</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Addressing</span></a><br/>
.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#Coercions"><span class="id" title="module">Addressing.Coercions</span></a>.<br/>

<br/>
<span class="id" title="keyword">Local Coercion</span> <a class="idref" href="#Z.b2z"><span class="id" title="definition">Z.b2z</span></a><a class="idref" href="#Z.b2z"><span class="id" title="definition">:</span></a> <a class="idref" href="#Z.b2z"><span class="id" title="definition">bool</span></a> <a class="idref" href="#Z.b2z"><span class="id" title="definition">>-></span></a> <a class="idref" href="#Z.b2z"><span class="id" title="definition">Z</span></a>.<br/>
<span class="id" title="keyword">Section</span> <a id="FarCalls" class="idref" href="#FarCalls"><span class="id" title="section">FarCalls</span></a>.<br/>
</div>

<div class="doc"><h1 id="far-calls">Far calls</h1>
<p>Far calls are calls to the code outside the current contract space.
This section describes three instructions to perform far calls:</p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#OpFarCall"><span
class="id" title="constructor">OpFarCall</span></a></span></li>
<li><span
class="inlinecode"><a class="idref" href="#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span></li>
<li><span
class="inlinecode"><a class="idref" href="#OpMimicCall"><span
class="id" title="constructor">OpMimicCall</span></a></span> (available
only in kernel mode)</li>
</ul>
<p>These instructions differ in the way they construct new frame.</p>
<p>The far call instructions have rich semantics; their full effect on
the VM state is described through the following machinery:</p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#SmallStep"><span
class="id" title="section">SmallStep</span></a></span></li>
<li><span
class="inlinecode"><a class="idref" href="#step"><span
class="id" title="inductive">step</span></a></span></li>
<li><span
class="inlinecode"><a class="idref" href="#farcall"><span
class="id" title="inductive">farcall</span></a></span></li>
</ul>
<p>If you know about fetching operands for instructions and the
instruction fetching described in <span class="inlinecode"><span
class="id" title="var">Semantics.step</span></span>, start investigating
farcalls from the <span
class="inlinecode"><a class="idref" href="#farcall"><span
class="id" title="inductive">farcall</span></a></span> predicate.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Section</span> <a id="FarCalls.Parameters" class="idref" href="#FarCalls.Parameters"><span class="id" title="section">Parameters</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
</div>

<div class="doc"><h2 id="global-farcall-parameters">Global farcall parameters</h2>
<ol type="1">
<li><p>Initial preallocated stack space.</p>
<p>A far call creates a new context with a new stack page (and other
pages, see <span
class="inlinecode"><a class="idref" href="#page_alloc"><span
class="id" title="definition">page_alloc</span></a></span>). The initial
SP value after a far call is set to <span
class="inlinecode"><a class="idref" href="#INITIAL_SP_ON_FAR_CALL"><span
class="id"
title="definition">INITIAL_SP_ON_FAR_CALL</span></a></span>.</p>
<p>Therefore, addresses in range from 0 inclusive to <span
class="inlinecode"><a class="idref" href="#INITIAL_SP_ON_FAR_CALL"><span
class="id" title="definition">INITIAL_SP_ON_FAR_CALL</span></a></span>
exclusive can be used as a scratch space.</p></li>
</ol>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="INITIAL_SP_ON_FAR_CALL" class="idref" href="#INITIAL_SP_ON_FAR_CALL"><span class="id" title="definition">INITIAL_SP_ON_FAR_CALL</span></a> : <a class="idref" href="#stack_address"><span class="id" title="definition">stack_address</span></a> := <span class="id" title="definition">fromZ</span> 1024.<br/>

<br/>
</div>

<div class="doc"><ol start="2" type="1">
<li><p>Initial heap and auxheap pages bound.</p>
<p>The heap and auxheap pages start with <span
class="inlinecode"><a class="idref" href="#NEW_FRAME_MEMORY_STIPEND"><span
class="id" title="definition">NEW_FRAME_MEMORY_STIPEND</span></a></span>
bound. Growing them beyond this bound costs ergs.</p></li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="NEW_FRAME_MEMORY_STIPEND" class="idref" href="#NEW_FRAME_MEMORY_STIPEND"><span class="id" title="definition">NEW_FRAME_MEMORY_STIPEND</span></a> : <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a> := <span class="id" title="definition">fromZ</span> 1024.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#FarCalls.Parameters"><span class="id" title="section">Parameters</span></a>.<br/>

<br/>
</div>

<div class="doc"><ol start="3" type="1">
<li><p>Maximal fraction of ergs allowed to pass.</p>
<p>It is not allowed to pass more than 63/64th of your remaining ergs to
a far call.</p></li>
</ol>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Definition</span> <a id="max_passable" class="idref" href="#max_passable"><span class="id" title="definition">max_passable</span></a> (<a id="remaining:1" class="idref" href="#remaining:1"><span class="id" title="binder">remaining</span></a>:<a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a>) : <a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a> := <span class="id" title="definition">fromZ</span> (<span class="id" title="definition">toZ</span> <a class="idref" href="#remaining:1"><span class="id" title="variable">remaining</span></a> <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> 63 <a class="idref" href="#d3c2652250c7a120d67ccc0e8f58ae75"><span class="id" title="notation">/</span></a> 64 ) %<span class="id" title="var">Z</span>.<br/>
<span class="id" title="keyword">Inductive</span> <a id="pass_allowed_ergs" class="idref" href="#pass_allowed_ergs"><span class="id" title="inductive">pass_allowed_ergs</span></a> : <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">(</span></a><a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">)-></span></a> <a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
| <a id="pae_apply" class="idref" href="#pae_apply"><span class="id" title="constructor">pae_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="cs1:4" class="idref" href="#cs1:4"><span class="id" title="binder">cs1</span></a> <a id="cs2:5" class="idref" href="#cs2:5"><span class="id" title="binder">cs2</span></a> <a id="pass_ergs_query:6" class="idref" href="#pass_ergs_query:6"><span class="id" title="binder">pass_ergs_query</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="pass_ergs_actual:7" class="idref" href="#pass_ergs_actual:7"><span class="id" title="binder">pass_ergs_actual</span></a> := <a class="idref" href="#min"><span class="id" title="definition">min</span></a> (<a class="idref" href="#max_passable"><span class="id" title="definition">max_passable</span></a> (<a class="idref" href="#ergs_remaining"><span class="id" title="definition">ergs_remaining</span></a> <a class="idref" href="#cs1:4"><span class="id" title="variable">cs1</span></a>)) <a class="idref" href="#pass_ergs_query:6"><span class="id" title="variable">pass_ergs_query</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pay"><span class="id" title="inductive">pay</span></a> <a class="idref" href="#pass_ergs_actual:7"><span class="id" title="variable">pass_ergs_actual</span></a> <a class="idref" href="#cs1:4"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#cs2:5"><span class="id" title="variable">cs2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pass_ergs_query:6"><span class="id" title="variable">pass_ergs_query</span></a> <a class="idref" href="#::type_scope:x_'<>'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pass_allowed_ergs:2"><span class="id" title="inductive">pass_allowed_ergs</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#pass_ergs_query:6"><span class="id" title="variable">pass_ergs_query</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#cs1:4"><span class="id" title="variable">cs1</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#pass_ergs_actual:7"><span class="id" title="variable">pass_ergs_actual</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#cs2:5"><span class="id" title="variable">cs2</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
| <a id="pae_zero" class="idref" href="#pae_zero"><span class="id" title="constructor">pae_zero</span></a>: <span class="id" title="keyword">∀</span> <a id="cs1:8" class="idref" href="#cs1:8"><span class="id" title="binder">cs1</span></a> <a id="cs2:9" class="idref" href="#cs2:9"><span class="id" title="binder">cs2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="pass_ergs_actual:10" class="idref" href="#pass_ergs_actual:10"><span class="id" title="binder">pass_ergs_actual</span></a> := <a class="idref" href="#max_passable"><span class="id" title="definition">max_passable</span></a> (<a class="idref" href="#ergs_remaining"><span class="id" title="definition">ergs_remaining</span></a> <a class="idref" href="#cs1:8"><span class="id" title="variable">cs1</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pay"><span class="id" title="inductive">pay</span></a> <a class="idref" href="#pass_ergs_actual:10"><span class="id" title="variable">pass_ergs_actual</span></a> <a class="idref" href="#cs1:8"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#cs2:9"><span class="id" title="variable">cs2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pass_allowed_ergs:2"><span class="id" title="inductive">pass_allowed_ergs</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#cs1:8"><span class="id" title="variable">cs1</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#pass_ergs_actual:10"><span class="id" title="variable">pass_ergs_actual</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#cs2:9"><span class="id" title="variable">cs2</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc"><h2 id="helpers">Helpers</h2>
<p>Far call creates a new execution context with new pages for:</p>
<ul>
<li>code</li>
<li>const (in the current implementation, const and code pages are the
same page).</li>
<li>stack</li>
<li>heap</li>
<li>auxheap</li>
</ul>
<p>The initial bounds for the new heap and auxheap pages are set to
<span
class="inlinecode"><a class="idref" href="#NEW_FRAME_MEMORY_STIPEND"><span
class="id"
title="definition">NEW_FRAME_MEMORY_STIPEND</span></a></span>.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Inductive</span> <a id="alloc_pages_extframe" class="idref" href="#alloc_pages_extframe"><span class="id" title="inductive">alloc_pages_extframe</span></a>:  <a class="idref" href="#pages"><span class="id" title="definition">pages</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#mem_ctx"><span class="id" title="record">mem_ctx</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#code_page"><span class="id" title="definition">code_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#const_page"><span class="id" title="definition">const_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#pages"><span class="id" title="definition">pages</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#mem_ctx"><span class="id" title="record">mem_ctx</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
| <a id="ape_alloc" class="idref" href="#ape_alloc"><span class="id" title="constructor">ape_alloc</span></a>: <span class="id" title="keyword">∀</span> <a id="code:13" class="idref" href="#code:13"><span class="id" title="binder">code</span></a> <a id="const:14" class="idref" href="#const:14"><span class="id" title="binder">const</span></a> (<a id="mm:15" class="idref" href="#mm:15"><span class="id" title="binder">mm</span></a>:<a class="idref" href="#pages"><span class="id" title="definition">pages</span></a>) <a id="ctx:16" class="idref" href="#ctx:16"><span class="id" title="binder">ctx</span></a> <a id="code_id:17" class="idref" href="#code_id:17"><span class="id" title="binder">code_id</span></a> <a id="const_id:18" class="idref" href="#const_id:18"><span class="id" title="binder">const_id</span></a> <a id="stack_id:19" class="idref" href="#stack_id:19"><span class="id" title="binder">stack_id</span></a> <a id="heap_id:20" class="idref" href="#heap_id:20"><span class="id" title="binder">heap_id</span></a> <a id="heap_aux_id:21" class="idref" href="#heap_aux_id:21"><span class="id" title="binder">heap_aux_id</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#code_id:17"><span class="id" title="variable">code_id</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#length"><span class="id" title="abbreviation">List.length</span></a> <a class="idref" href="#mm:15"><span class="id" title="variable">mm</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#const_id:18"><span class="id" title="variable">const_id</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#code_id:17"><span class="id" title="variable">code_id</span></a> <span class="id" title="notation">+</span> 1)%<span class="id" title="var">nat</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#stack_id:19"><span class="id" title="variable">stack_id</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#code_id:17"><span class="id" title="variable">code_id</span></a> <span class="id" title="notation">+</span> 2)%<span class="id" title="var">nat</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#heap_id:20"><span class="id" title="variable">heap_id</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#code_id:17"><span class="id" title="variable">code_id</span></a> <span class="id" title="notation">+</span> 3)%<span class="id" title="var">nat</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#heap_aux_id:21"><span class="id" title="variable">heap_aux_id</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#code_id:17"><span class="id" title="variable">code_id</span></a> <span class="id" title="notation">+</span> 4)%<span class="id" title="var">nat</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#alloc_pages_extframe:11"><span class="id" title="inductive">alloc_pages_extframe</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#mm:15"><span class="id" title="variable">mm</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#ctx:16"><span class="id" title="variable">ctx</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#code:13"><span class="id" title="variable">code</span></a> <a class="idref" href="#const:14"><span class="id" title="variable">const</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#heap_aux_id:21"><span class="id" title="variable">heap_aux_id</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="#DataPage"><span class="id" title="constructor">DataPage</span></a> (<a class="idref" href="#empty"><span class="id" title="definition">empty</span></a> <a class="idref" href="#data_page_params"><span class="id" title="definition">data_page_params</span></a>))<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><span class="id" title="notation">::</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#heap_id:20"><span class="id" title="variable">heap_id</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="#DataPage"><span class="id" title="constructor">DataPage</span></a> (<a class="idref" href="#empty"><span class="id" title="definition">empty</span></a> <span class="id" title="var">_</span>))<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><span class="id" title="notation">::</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#stack_id:19"><span class="id" title="variable">stack_id</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="#StackPage"><span class="id" title="constructor">StackPage</span></a> (<a class="idref" href="#empty"><span class="id" title="definition">empty</span></a> <a class="idref" href="#stack_page_params"><span class="id" title="definition">stack_page_params</span></a>))<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><span class="id" title="notation">::</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#const_id:18"><span class="id" title="variable">const_id</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,(</span></a><a class="idref" href="#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="#ConstPage"><span class="id" title="constructor">ConstPage</span></a> <a class="idref" href="#const:14"><span class="id" title="variable">const</span></a>)<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><span class="id" title="notation">::</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#code_id:17"><span class="id" title="variable">code_id</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="#CodePage"><span class="id" title="constructor">CodePage</span></a> <a class="idref" href="#code:13"><span class="id" title="variable">code</span></a>)<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><span class="id" title="notation">::</span><a class="idref" href="#mm:15"><span class="id" title="variable">mm</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">{|</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ctx_code_page_id"><span class="id" title="projection">ctx_code_page_id</span></a> := <a class="idref" href="#code_id:17"><span class="id" title="variable">code_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ctx_const_page_id"><span class="id" title="projection">ctx_const_page_id</span></a> := <a class="idref" href="#const_id:18"><span class="id" title="variable">const_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ctx_stack_page_id"><span class="id" title="projection">ctx_stack_page_id</span></a> := <a class="idref" href="#stack_id:19"><span class="id" title="variable">stack_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ctx_heap_page_id"><span class="id" title="projection">ctx_heap_page_id</span></a> := <a class="idref" href="#heap_id:20"><span class="id" title="variable">heap_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ctx_auxheap_page_id"><span class="id" title="projection">ctx_auxheap_page_id</span></a> := <a class="idref" href="#heap_aux_id:21"><span class="id" title="variable">heap_aux_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ctx_heap_bound"><span class="id" title="projection">ctx_heap_bound</span></a> := <a class="idref" href="#NEW_FRAME_MEMORY_STIPEND"><span class="id" title="definition">NEW_FRAME_MEMORY_STIPEND</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ctx_auxheap_bound"><span class="id" title="projection">ctx_auxheap_bound</span></a> := <a class="idref" href="#NEW_FRAME_MEMORY_STIPEND"><span class="id" title="definition">NEW_FRAME_MEMORY_STIPEND</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">|}</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <a id="alloc_mem_extframe" class="idref" href="#alloc_mem_extframe"><span class="id" title="inductive">alloc_mem_extframe</span></a>: <a class="idref" href="#memory"><span class="id" title="definition">memory</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#mem_ctx"><span class="id" title="record">mem_ctx</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#code_page"><span class="id" title="definition">code_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#const_page"><span class="id" title="definition">const_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#memory"><span class="id" title="definition">memory</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#mem_ctx"><span class="id" title="record">mem_ctx</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
| <a id="ame_apply" class="idref" href="#ame_apply"><span class="id" title="constructor">ame_apply</span></a>: <span class="id" title="keyword">∀</span> <a id="p:24" class="idref" href="#p:24"><span class="id" title="binder">p</span></a> <a id="c:25" class="idref" href="#c:25"><span class="id" title="binder">c</span></a> <a id="p':26" class="idref" href="#p':26"><span class="id" title="binder">p'</span></a> <a id="c':27" class="idref" href="#c':27"><span class="id" title="binder">c'</span></a> <a id="code:28" class="idref" href="#code:28"><span class="id" title="binder">code</span></a> <a id="const:29" class="idref" href="#const:29"><span class="id" title="binder">const</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#alloc_pages_extframe"><span class="id" title="inductive">alloc_pages_extframe</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#p:24"><span class="id" title="variable">p</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#c:25"><span class="id" title="variable">c</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#code:28"><span class="id" title="variable">code</span></a> <a class="idref" href="#const:29"><span class="id" title="variable">const</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#p':26"><span class="id" title="variable">p'</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#c':27"><span class="id" title="variable">c'</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#alloc_mem_extframe:22"><span class="id" title="inductive">alloc_mem_extframe</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#mk_pages"><span class="id" title="constructor">mk_pages</span></a> <a class="idref" href="#p:24"><span class="id" title="variable">p</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#c:25"><span class="id" title="variable">c</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#code:28"><span class="id" title="variable">code</span></a> <a class="idref" href="#const:29"><span class="id" title="variable">const</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#mk_pages"><span class="id" title="constructor">mk_pages</span></a> <a class="idref" href="#p':26"><span class="id" title="variable">p'</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#c':27"><span class="id" title="variable">c'</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>Fetch code and pay the associated cost. If <span
class="inlinecode"><span class="id"
title="var">masking_allowed</span></span> is true and there is no code
associated with a given contract address, then the default AA code will
be fetched. See <span
class="inlinecode"><a class="idref" href="#code_fetch"><span
class="id" title="inductive">code_fetch</span></a></span>.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Inductive</span> <a id="paid_code_fetch_result" class="idref" href="#paid_code_fetch_result"><span class="id" title="inductive">paid_code_fetch_result</span></a> :=<br/>
| <a id="Fetched" class="idref" href="#Fetched"><span class="id" title="constructor">Fetched</span></a> : <a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#code_page"><span class="id" title="definition">code_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#const_page"><span class="id" title="definition">const_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#paid_code_fetch_result:30"><span class="id" title="inductive">paid_code_fetch_result</span></a><br/>
| <a id="CodeFetchInvalidVerisonedHashFormat" class="idref" href="#CodeFetchInvalidVerisonedHashFormat"><span class="id" title="constructor">CodeFetchInvalidVerisonedHashFormat</span></a> (<span class="id" title="var">_</span>:<a class="idref" href="#versioned_hash"><span class="id" title="record">versioned_hash</span></a>)<br/>
| <a id="CodeFetchUnaffordable" class="idref" href="#CodeFetchUnaffordable"><span class="id" title="constructor">CodeFetchUnaffordable</span></a> (<a id="cost:32" class="idref" href="#cost:32"><span class="id" title="binder">cost</span></a>:<a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a>)<br/>
.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <a id="paid_code_fetch" class="idref" href="#paid_code_fetch"><span class="id" title="inductive">paid_code_fetch</span></a> <a id="masking_allowed:33" class="idref" href="#masking_allowed:33"><span class="id" title="binder">masking_allowed</span></a> <a id="sid:34" class="idref" href="#sid:34"><span class="id" title="binder">sid</span></a>: <a class="idref" href="#depot"><span class="id" title="definition">depot</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#decommitter"><span class="id" title="definition">decommitter</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#callstack"><span class="id" title="definition">callstack</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#paid_code_fetch_result"><span class="id" title="inductive">paid_code_fetch_result</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><span class="id" title="keyword">Prop</span> :=<br/>
| <a id="cfp_fetched" class="idref" href="#cfp_fetched"><span class="id" title="constructor">cfp_fetched</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="depot:37" class="idref" href="#depot:37"><span class="id" title="binder">depot</span></a> (<a id="codes:38" class="idref" href="#codes:38"><span class="id" title="binder">codes</span></a>:<a class="idref" href="#decommitter"><span class="id" title="definition">decommitter</span></a>) (<a id="dest_addr:39" class="idref" href="#dest_addr:39"><span class="id" title="binder">dest_addr</span></a>: <a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a>) <a id="vhash:40" class="idref" href="#vhash:40"><span class="id" title="binder">vhash</span></a> <a id="dest_addr:41" class="idref" href="#dest_addr:41"><span class="id" title="binder">dest_addr</span></a> <a id="new_code_page:42" class="idref" href="#new_code_page:42"><span class="id" title="binder">new_code_page</span></a> <a id="new_const_page:43" class="idref" href="#new_const_page:43"><span class="id" title="binder">new_const_page</span></a> <a id="code_length:44" class="idref" href="#code_length:44"><span class="id" title="binder">code_length</span></a> <a id="cost__decomm:45" class="idref" href="#cost__decomm:45"><span class="id" title="binder">cost__decomm</span></a> <a id="cs0:46" class="idref" href="#cs0:46"><span class="id" title="binder">cs0</span></a> <a id="cs1:47" class="idref" href="#cs1:47"><span class="id" title="binder">cs1</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#code_fetch"><span class="id" title="inductive">code_fetch</span></a> <span class="id" title="var">_</span> <a class="idref" href="#depot:37"><span class="id" title="variable">depot</span></a> <a class="idref" href="#codes:38"><span class="id" title="variable">codes</span></a>.(<a class="idref" href="#cm_storage"><span class="id" title="projection">cm_storage</span></a> <span class="id" title="var">_</span>) <a class="idref" href="#sid:34"><span class="id" title="variable">sid</span></a> <a class="idref" href="#dest_addr:41"><span class="id" title="variable">dest_addr</span></a> <a class="idref" href="#masking_allowed:33"><span class="id" title="variable">masking_allowed</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#vhash:40"><span class="id" title="variable">vhash</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#new_code_page:42"><span class="id" title="variable">new_code_page</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#new_const_page:43"><span class="id" title="variable">new_const_page</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">),</span></a> <a class="idref" href="#code_length:44"><span class="id" title="variable">code_length</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#decommitment_cost"><span class="id" title="inductive">decommitment_cost</span></a> <span class="id" title="var">_</span> <a class="idref" href="#codes:38"><span class="id" title="variable">codes</span></a> <a class="idref" href="#vhash:40"><span class="id" title="variable">vhash</span></a> <a class="idref" href="#code_length:44"><span class="id" title="variable">code_length</span></a> <a class="idref" href="#cost__decomm:45"><span class="id" title="variable">cost__decomm</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pay"><span class="id" title="inductive">pay</span></a> <a class="idref" href="#cost__decomm:45"><span class="id" title="variable">cost__decomm</span></a> <a class="idref" href="#cs0:46"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#cs1:47"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#paid_code_fetch:35"><span class="id" title="inductive">paid_code_fetch</span></a> <a class="idref" href="#masking_allowed:33"><span class="id" title="variable">masking_allowed</span></a> <a class="idref" href="#sid:34"><span class="id" title="variable">sid</span></a> <a class="idref" href="#depot:37"><span class="id" title="variable">depot</span></a> <a class="idref" href="#codes:38"><span class="id" title="variable">codes</span></a> <a class="idref" href="#dest_addr:41"><span class="id" title="variable">dest_addr</span></a> <a class="idref" href="#cs0:46"><span class="id" title="variable">cs0</span></a> (<a class="idref" href="#Fetched"><span class="id" title="constructor">Fetched</span></a> <a class="idref" href="#cs1:47"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#new_code_page:42"><span class="id" title="variable">new_code_page</span></a> <a class="idref" href="#new_const_page:43"><span class="id" title="variable">new_const_page</span></a>)<br/>
| <a id="cfp_unaffordable" class="idref" href="#cfp_unaffordable"><span class="id" title="constructor">cfp_unaffordable</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="depot:48" class="idref" href="#depot:48"><span class="id" title="binder">depot</span></a> (<a id="codes:49" class="idref" href="#codes:49"><span class="id" title="binder">codes</span></a>:<a class="idref" href="#decommitter"><span class="id" title="definition">decommitter</span></a>) (<a id="dest_addr:50" class="idref" href="#dest_addr:50"><span class="id" title="binder">dest_addr</span></a>: <a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a>) <a id="vhash:51" class="idref" href="#vhash:51"><span class="id" title="binder">vhash</span></a> <a id="dest_addr:52" class="idref" href="#dest_addr:52"><span class="id" title="binder">dest_addr</span></a> <a id="new_code_page:53" class="idref" href="#new_code_page:53"><span class="id" title="binder">new_code_page</span></a> <a id="new_const_page:54" class="idref" href="#new_const_page:54"><span class="id" title="binder">new_const_page</span></a> <a id="code_length:55" class="idref" href="#code_length:55"><span class="id" title="binder">code_length</span></a> <a id="cost__decomm:56" class="idref" href="#cost__decomm:56"><span class="id" title="binder">cost__decomm</span></a> <a id="cs0:57" class="idref" href="#cs0:57"><span class="id" title="binder">cs0</span></a> ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#code_fetch"><span class="id" title="inductive">code_fetch</span></a> <span class="id" title="var">_</span> <a class="idref" href="#depot:48"><span class="id" title="variable">depot</span></a> <a class="idref" href="#codes:49"><span class="id" title="variable">codes</span></a>.(<a class="idref" href="#cm_storage"><span class="id" title="projection">cm_storage</span></a> <span class="id" title="var">_</span>) <a class="idref" href="#sid:34"><span class="id" title="variable">sid</span></a> <a class="idref" href="#dest_addr:52"><span class="id" title="variable">dest_addr</span></a> <a class="idref" href="#masking_allowed:33"><span class="id" title="variable">masking_allowed</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#vhash:51"><span class="id" title="variable">vhash</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#new_code_page:53"><span class="id" title="variable">new_code_page</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#new_const_page:54"><span class="id" title="variable">new_const_page</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">),</span></a> <a class="idref" href="#code_length:55"><span class="id" title="variable">code_length</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#decommitment_cost"><span class="id" title="inductive">decommitment_cost</span></a> <span class="id" title="var">_</span> <a class="idref" href="#codes:49"><span class="id" title="variable">codes</span></a> <a class="idref" href="#vhash:51"><span class="id" title="variable">vhash</span></a> <a class="idref" href="#code_length:55"><span class="id" title="variable">code_length</span></a> <a class="idref" href="#cost__decomm:56"><span class="id" title="variable">cost__decomm</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#affordable"><span class="id" title="definition">affordable</span></a> <a class="idref" href="#cs0:57"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#cost__decomm:56"><span class="id" title="variable">cost__decomm</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#paid_code_fetch:35"><span class="id" title="inductive">paid_code_fetch</span></a> <a class="idref" href="#masking_allowed:33"><span class="id" title="variable">masking_allowed</span></a> <a class="idref" href="#sid:34"><span class="id" title="variable">sid</span></a> <a class="idref" href="#depot:48"><span class="id" title="variable">depot</span></a> <a class="idref" href="#codes:49"><span class="id" title="variable">codes</span></a> <a class="idref" href="#dest_addr:52"><span class="id" title="variable">dest_addr</span></a> <a class="idref" href="#cs0:57"><span class="id" title="variable">cs0</span></a> (<a class="idref" href="#CodeFetchUnaffordable"><span class="id" title="constructor">CodeFetchUnaffordable</span></a> <a class="idref" href="#cost__decomm:56"><span class="id" title="variable">cost__decomm</span></a>)<br/>
<br/>
| <a id="cfp_invalid_hash" class="idref" href="#cfp_invalid_hash"><span class="id" title="constructor">cfp_invalid_hash</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="depot:58" class="idref" href="#depot:58"><span class="id" title="binder">depot</span></a> (<a id="codes:59" class="idref" href="#codes:59"><span class="id" title="binder">codes</span></a>:<a class="idref" href="#decommitter"><span class="id" title="definition">decommitter</span></a>) (<a id="dest_addr:60" class="idref" href="#dest_addr:60"><span class="id" title="binder">dest_addr</span></a>: <a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a>) <a id="vhash:61" class="idref" href="#vhash:61"><span class="id" title="binder">vhash</span></a> <a id="dest_addr:62" class="idref" href="#dest_addr:62"><span class="id" title="binder">dest_addr</span></a> <a id="new_code_page:63" class="idref" href="#new_code_page:63"><span class="id" title="binder">new_code_page</span></a> <a id="new_const_page:64" class="idref" href="#new_const_page:64"><span class="id" title="binder">new_const_page</span></a> <a id="code_length:65" class="idref" href="#code_length:65"><span class="id" title="binder">code_length</span></a> <a id="cs0:66" class="idref" href="#cs0:66"><span class="id" title="binder">cs0</span></a> ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#code_fetch"><span class="id" title="inductive">code_fetch</span></a> <span class="id" title="var">_</span> <a class="idref" href="#depot:58"><span class="id" title="variable">depot</span></a> <a class="idref" href="#codes:59"><span class="id" title="variable">codes</span></a>.(<a class="idref" href="#cm_storage"><span class="id" title="projection">cm_storage</span></a> <span class="id" title="var">_</span>) <a class="idref" href="#sid:34"><span class="id" title="variable">sid</span></a> <a class="idref" href="#dest_addr:62"><span class="id" title="variable">dest_addr</span></a> <a class="idref" href="#masking_allowed:33"><span class="id" title="variable">masking_allowed</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#vhash:61"><span class="id" title="variable">vhash</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#new_code_page:63"><span class="id" title="variable">new_code_page</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#new_const_page:64"><span class="id" title="variable">new_const_page</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">),</span></a> <a class="idref" href="#code_length:65"><span class="id" title="variable">code_length</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#marker_valid"><span class="id" title="definition">marker_valid</span></a> (<a class="idref" href="#extra_marker"><span class="id" title="projection">extra_marker</span></a> <a class="idref" href="#vhash:61"><span class="id" title="variable">vhash</span></a>) <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#paid_code_fetch:35"><span class="id" title="inductive">paid_code_fetch</span></a> <a class="idref" href="#masking_allowed:33"><span class="id" title="variable">masking_allowed</span></a> <a class="idref" href="#sid:34"><span class="id" title="variable">sid</span></a> <a class="idref" href="#depot:58"><span class="id" title="variable">depot</span></a> <a class="idref" href="#codes:59"><span class="id" title="variable">codes</span></a> <a class="idref" href="#dest_addr:62"><span class="id" title="variable">dest_addr</span></a> <a class="idref" href="#cs0:66"><span class="id" title="variable">cs0</span></a> (<a class="idref" href="#CodeFetchInvalidVerisonedHashFormat"><span class="id" title="constructor">CodeFetchInvalidVerisonedHashFormat</span></a> <a class="idref" href="#vhash:61"><span class="id" title="variable">vhash</span></a>)<br/>
.<br/>

<br/>
</div>

<div class="doc"><h2 id="system-calls">System calls</h2>
<p>A system call is a far call that satisfies the following
conditions:</p>
<ul>
<li>The destination is a kernel address.</li>
<li>The field <code>is_system</code> of <span class="inlinecode"><span
class="id" title="var">FarCall.params</span></span> passed through an
operand is set to 1.</li>
</ul>
</div>
<div class="code">
<br/>

<br/>
</div>

<div class="doc"><h1 id="far-call-instructions">Far call instructions</h1>
<h2 id="summary">Summary</h2>
<ul>
<li><p>Far calls are calls to the code outside the current contract
space.</p></li>
<li><p>Mimic calls are a kernel-only variation of far calls allowing to
mimic a call from any contract by impersonating an arbitrary caller and
putting an arbitrary address into the new callframe’s <span
class="inlinecode"><a class="idref" href="#ecf_msg_sender"><span
class="id" title="projection">ecf_msg_sender</span></a></span>
field.</p></li>
<li><p>Delegate calls are a variation of far calls allowing to call a
contract with the current storage space.</p>
<p><strong>Example</strong>: Suppose we have contracts A,B,C. Contract A
called contract B normally, then contract B delegated to contract C.
Then C’s code will be executed in a context of B’s storage, as if
contract A called contract C. If contract C returns normally, the
execution will proceed from the next instruction of B after delegate
call. In case of <code>revert</code> or <code>panic</code> in C, all the
usual rules apply.</p></li>
</ul>
<h2 id="abstract-and-concrete-syntax">Abstract and concrete syntax</h2>
<ul>
<li><p><span
class="inlinecode"><a class="idref" href="#OpFarCall"><span
class="id" title="constructor">OpFarCall</span></a></span> <span
class="inlinecode">(<span class="id"
title="var">abi_params</span>:</span> <span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id"
title="var">dest_address</span>:<a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id"
title="var">handler</span>:<a class="idref" href="#imm_in"><span
class="id" title="inductive">imm_in</span></a>)</span> <span
class="inlinecode">(<span class="id"
title="var">is_static</span>:<a class="idref" href="#bool"><span
class="id" title="inductive">bool</span></a>)</span> <span
class="inlinecode">(<span class="id"
title="var">is_shard</span>:<a class="idref" href="#bool"><span
class="id" title="inductive">bool</span></a>)</span></p>
<ul>
<li><code>callf          abi_reg, dest_addr, handler</code></li>
<li><code>callf.st       abi_reg, dest_addr, handler</code></li>
<li><code>callf.sh       abi_reg, dest_addr, handler</code></li>
<li><code>callf.{st,sh}  abi_reg, dest_addr, handler</code></li>
</ul></li>
<li><p><span
class="inlinecode"><a class="idref" href="#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span> <span
class="inlinecode">(<span class="id"
title="var">abi_params</span>:</span> <span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id"
title="var">dest_address</span>:<a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id"
title="var">handler</span>:<a class="idref" href="#imm_in"><span
class="id" title="inductive">imm_in</span></a>)</span> <span
class="inlinecode">(<span class="id"
title="var">is_static</span>:<a class="idref" href="#bool"><span
class="id" title="inductive">bool</span></a>)</span> <span
class="inlinecode">(<span class="id"
title="var">is_shard</span>:<a class="idref" href="#bool"><span
class="id" title="inductive">bool</span></a>)</span></p>
<ul>
<li><code>calld          abi_reg, dest_addr, handler</code></li>
<li><code>calld.st       abi_reg, dest_addr, handler</code></li>
<li><code>calld.sh       abi_reg, dest_addr, handler</code></li>
<li><code>calld.{st,sh}  abi_reg, dest_addr, handler</code></li>
</ul></li>
<li><p><span
class="inlinecode"><a class="idref" href="#OpMimicCall"><span
class="id" title="constructor">OpMimicCall</span></a></span> <span
class="inlinecode">(<span class="id"
title="var">abi_params</span>:</span> <span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id"
title="var">dest_address</span>:<a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id"
title="var">handler</span>:<a class="idref" href="#imm_in"><span
class="id" title="inductive">imm_in</span></a>)</span> <span
class="inlinecode">(<span class="id"
title="var">is_static</span>:<a class="idref" href="#bool"><span
class="id" title="inductive">bool</span></a>)</span> <span
class="inlinecode">(<span class="id"
title="var">is_shard</span>:<a class="idref" href="#bool"><span
class="id" title="inductive">bool</span></a>)</span></p>
<ul>
<li><code>callm          abi_reg, dest_addr, handler</code></li>
<li><code>callm.st       abi_reg, dest_addr, handler</code></li>
<li><code>callm.sh       abi_reg, dest_addr, handler</code></li>
<li><code>callm.{st,sh}  abi_reg, dest_addr, handler</code></li>
</ul></li>
<li><p><strong>static</strong> (<code>st</code>) modifier marks the new
execution stack frame as ‘static’, preventing some instructions from
being executed. Calls from a static calls are automatically marked
static.</p></li>
<li><p><strong>shard</strong> (<code>sh</code>) modifier allows calling
code from other shards. The shard ID will be taken from
<code>abi_reg</code>.</p></li>
</ul>
<h2 id="legacy-syntax">Legacy syntax</h2>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#OpFarCall"><span
class="id" title="constructor">OpFarCall</span></a></span>
<code>abi_params address handler is_static</code>
<ul>
<li><code>far_call        abi_reg, dest_addr, handler</code></li>
<li><code>far_call.static abi_reg, dest_addr, handler</code></li>
<li><code>far_call.shard  abi_reg, dest_addr, handler</code></li>
</ul></li>
<li><span
class="inlinecode"><a class="idref" href="#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span>
abi_params address handler is_static`
<ul>
<li><code>far_call.delegate        abi_reg, dest_addr, handler</code></li>
<li><code>far_call.delegate.static abi_reg, dest_addr, handler</code></li>
<li><code>far_call.delegate.shard  abi_reg, dest_addr, handler</code></li>
</ul></li>
<li><span
class="inlinecode"><a class="idref" href="#OpMimicCall"><span
class="id" title="constructor">OpMimicCall</span></a></span>
<code>abi_params address handler is_static</code>
<ul>
<li><code>far_call.mimic        abi_reg, dest_addr</code></li>
<li><code>far_call.mimic        abi_reg, dest_addr, handler</code></li>
<li><code>far_call.mimic.static abi_reg, dest_addr</code></li>
<li><code>far_call.mimic.static abi_reg, dest_addr, handler</code></li>
<li><code>far_call.mimic.shard  abi_reg, dest_addr</code></li>
<li><code>far_call.mimic.shard  abi_reg, dest_addr, handler</code></li>
</ul></li>
</ul>
<h2 id="semantic">Semantic</h2>
<ol type="1">
<li>Decode the structure <code>params</code> from
<code>abi_reg</code>:</li>
</ol>
<pre><code>   Inductive fwd_memory :=
     ForwardFatPointer (p:fat_ptr)
   | ForwardNewFatPointer (heap_var: data_page_type) (s:span).


  Record params :=
    mk_params {
        fwd_memory: fwd_memory;
        ergs_passed: ergs;
        shard_id: shard_id;
        constructor_call: bool;
        to_system: bool;
      }.</code></pre>
<ol start="3" type="1">
<li><p>Decommit code of the callee contract (formalized by <span
class="inlinecode"><a class="idref" href="#paid_code_fetch"><span
class="id" title="inductive">paid_code_fetch</span></a></span>):</p>
<ul>
<li><p>load the <span
class="inlinecode"><a class="idref" href="#versioned_hash"><span
class="id" title="record">versioned_hash</span></a></span> of the called
code from the storage of a special contract located at <span
class="inlinecode"><a class="idref" href="#DEPLOYER_SYSTEM_CONTRACT_ADDRESS"><span
class="id"
title="definition">DEPLOYER_SYSTEM_CONTRACT_ADDRESS</span></a></span>.</p>
<pre><code>Inductive marker := CODE_AT_REST | YET_CONSTRUCTED | INVALID.

Record versioned_hash := mk_vhash {
                          code_length_in_words: u16;
                          extra_marker: marker;
                          partial_hash: BITS (28*bits_in_byte)%nat
                        }.</code></pre></li>
<li><p>for non-system calls, if there is no code stored for a provided
hash value, mask it into <span class="inlinecode"><span class="id"
title="var">VersionedHash.DEFAULT_AA_VHASH</span></span> and execute
<span class="inlinecode"><span class="id"
title="var">VersionedHash.DEFAULT_AA_CODE</span></span>.</p></li>
<li><p>if the code with such hash has not been accessed in the current
block, pay for decommitment.</p></li>
</ul></li>
<li><p>Forward data to the new frame (formalized by <span
class="inlinecode"><span class="id"
title="var">paid_forward_and_adjust_bounds</span></span>).</p>
<ul>
<li><p>If <span
class="inlinecode"><a class="idref" href="#params"><span
class="id"
title="record">params</span></a>.(<a class="idref" href="#fwd_memory"><span
class="id" title="inductive">fwd_memory</span></a>)</span> is <span
class="inlinecode"><a class="idref" href="#ForwardExistingFatPointer"><span
class="id"
title="constructor">ForwardExistingFatPointer</span></a></span> <span
class="inlinecode"><span class="id" title="var">p</span></span>, we are
forwarding an existing fat pointer.</p>
<ul>
<li>ensure that <code>abi_reg</code> is tagged as a pointer.</li>
<li>check the pointer validity;</li>
<li><span
class="inlinecode"><a class="idref" href="#fat_ptr_narrow"><span
class="id" title="definition">fat_ptr_narrow</span></a></span> the
pointer;</li>
</ul></li>
<li><p>If <span
class="inlinecode"><a class="idref" href="#params"><span
class="id"
title="record">params</span></a>.(<a class="idref" href="#fwd_memory"><span
class="id" title="inductive">fwd_memory</span></a>)</span> is <span
class="inlinecode"><a class="idref" href="#ForwardNewFatPointer"><span
class="id" title="constructor">ForwardNewFatPointer</span></a></span>
<span class="inlinecode"><span class="id"
title="var">variant</span></span> <span
class="inlinecode"><a class="idref" href="#span"><span
class="id" title="record">span</span></a></span>, a new <span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span> is created. This
pointer refers to the provided <span
class="inlinecode"><a class="idref" href="#span"><span
class="id" title="record">span</span></a></span> of specified heap
<code>variant</code>.</p>
<p>Note the decoding of <span
class="inlinecode"><a class="idref" href="#ForwardNewFatPointer"><span
class="id" title="constructor">ForwardNewFatPointer</span></a></span> in
<span
class="inlinecode"><a class="idref" href="#fwd_memory_adapter"><span
class="id" title="definition">fwd_memory_adapter</span></a></span> and
especially <span
class="inlinecode"><a class="idref" href="#span_of"><span
class="id" title="definition">span_of</span></a></span>.</p></li>
</ul></li>
<li><p>Allocate new pages for code, constants, stack, heap and auxheap
(formalized by <span
class="inlinecode"><a class="idref" href="#alloc_pages_extframe"><span
class="id"
title="inductive">alloc_pages_extframe</span></a></span>).</p></li>
<li><p>Reserve ergs for the new external frame (formalized by <span
class="inlinecode"><a class="idref" href="#pass_allowed_ergs"><span
class="id" title="inductive">pass_allowed_ergs</span></a></span>).</p>
<ul>
<li>Maximum amount of ergs passed to an external call is 63/64 of ergs
allocated for the caller.</li>
<li>Attempting to pass more ergs will result in only passing the maximum
amount allowed.</li>
<li>Trying to pass 0 ergs will result in passing maximum amount of ergs
allowed.</li>
</ul></li>
<li><p>Clear the context register.</p></li>
<li><p>Clear flags.</p></li>
<li><p>Modify GPRs depending on the call being system or not (formalized
by <span
class="inlinecode"><a class="idref" href="#regs_effect"><span
class="id" title="definition">regs_effect</span></a></span>):</p>
<ul>
<li>Effect of a non-system call:
<ul>
<li>All registers are cleared.</li>
<li>Register <code>r1</code> is assigned a fat pointer to forward data
to the far call. See <span class="inlinecode"><span class="id"
title="var">paid_forward</span></span>.</li>
</ul></li>
<li>Effect of a system call:
<ul>
<li>Register <code>r1</code> is assigned a fat pointer to forward data
to the far call. See <span class="inlinecode"><span class="id"
title="var">paid_forward</span></span>.</li>
<li>Register <code>r2</code> is assigned a bit-value:
<ul>
<li>bit 1 indicates “this is a system call”</li>
<li>bit 0 indicates “this is a constructor call”</li>
</ul></li>
<li>Registers <code>r3</code>, <code>r4</code>, …, <code>r15</code> are
reserved; their pointer tags are cleared, but their values are
unchanged.</li>
<li>Registers <code>r14</code> and <code>r15</code> are cleared.</li>
</ul></li>
</ul></li>
</ol>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Definition</span> <a id="regs_effect" class="idref" href="#regs_effect"><span class="id" title="definition">regs_effect</span></a> <a id="regs:67" class="idref" href="#regs:67"><span class="id" title="binder">regs</span></a> (<a id="is_system:68" class="idref" href="#is_system:68"><span class="id" title="binder">is_system</span></a> <a id="is_ctor:69" class="idref" href="#is_ctor:69"><span class="id" title="binder">is_ctor</span></a>:<a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>) <a id="ptr:70" class="idref" href="#ptr:70"><span class="id" title="binder">ptr</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="far_call_r2:74" class="idref" href="#far_call_r2:74"><span class="id" title="binder">far_call_r2</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="is_system_bit:71" class="idref" href="#is_system_bit:71"><span class="id" title="binder">is_system_bit</span></a> := <a class="idref" href="#Z.shiftl"><span class="id" title="definition">Z.shiftl</span></a> <a class="idref" href="#is_system:68"><span class="id" title="variable">is_system</span></a> 1 <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="is_ctor_bit:72" class="idref" href="#is_ctor_bit:72"><span class="id" title="binder">is_ctor_bit</span></a> := <a class="idref" href="#Z.shiftl"><span class="id" title="definition">Z.shiftl</span></a> <a class="idref" href="#is_ctor:69"><span class="id" title="variable">is_ctor</span></a> 0 <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="bits:73" class="idref" href="#bits:73"><span class="id" title="binder">bits</span></a> := <a class="idref" href="#Z.lor"><span class="id" title="definition">Z.lor</span></a> <a class="idref" href="#is_system_bit:71"><span class="id" title="variable">is_system_bit</span></a> <a class="idref" href="#is_ctor_bit:72"><span class="id" title="variable">is_ctor_bit</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> (<span class="id" title="definition">fromZ</span> <a class="idref" href="#bits:73"><span class="id" title="variable">bits</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#encode_fat_ptr_word"><span class="id" title="definition">encode_fat_ptr_word</span></a> <a class="idref" href="#zero128"><span class="id" title="definition">zero128</span></a> <a class="idref" href="#ptr:70"><span class="id" title="variable">ptr</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">enc_ptr</span> ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#is_system:68"><span class="id" title="variable">is_system</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#regs:67"><span class="id" title="variable">regs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#r1"><span class="id" title="projection">r1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <span class="id" title="var">enc_ptr</span> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#r2"><span class="id" title="projection">r2</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#far_call_r2:74"><span class="id" title="variable">far_call_r2</span></a>      <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;system&nbsp;calls,&nbsp;preserve&nbsp;values&nbsp;in&nbsp;r3-r13&nbsp;but&nbsp;clear&nbsp;ptr&nbsp;tags&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#r3"><span class="id" title="projection">r3</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#r4"><span class="id" title="projection">r4</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#r5"><span class="id" title="projection">r5</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#r6"><span class="id" title="projection">r6</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#r7"><span class="id" title="projection">r7</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#r8"><span class="id" title="projection">r8</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#r9"><span class="id" title="projection">r9</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#r10"><span class="id" title="projection">r10</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#r11"><span class="id" title="projection">r11</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#r12"><span class="id" title="projection">r12</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#r13"><span class="id" title="projection">r13</span></a> <span class="id" title="notation">::=</span> <a class="idref" href="#clear_pointer_tag"><span class="id" title="definition">clear_pointer_tag</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;zero&nbsp;the&nbsp;rest&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#r14"><span class="id" title="projection">r14</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#word0"><span class="id" title="definition">word0</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#r15"><span class="id" title="projection">r15</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#word0"><span class="id" title="definition">word0</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#regs_state_zero"><span class="id" title="definition">regs_state_zero</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#r1"><span class="id" title="projection">r1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <span class="id" title="var">enc_ptr</span> <span class="id" title="notation">|></span> <span class="id" title="notation"><|</span> <a class="idref" href="#r2"><span class="id" title="projection">r2</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#far_call_r2:74"><span class="id" title="variable">far_call_r2</span></a> <span class="id" title="notation">|></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <a class="idref" href="#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc"><ol start="10" type="1">
<li><p>Form a new execution stack frame:</p>
<ul>
<li>the call is static if the current call is static, or if
<code>.is_static</code> modifier is applied to instruction;</li>
<li>set exception handler to <code>handler</code> address provided in
the instruction;</li>
<li>it is a checkpoint that saves all storage states;</li>
<li>start PC at 0;</li>
<li>start SP at <span
class="inlinecode"><a class="idref" href="#INITIAL_SP_ON_FAR_CALL"><span
class="id"
title="definition">INITIAL_SP_ON_FAR_CALL</span></a></span>;</li>
<li><code>this_address</code>,<code>msg_sender</code> and
<code>context</code> fields are affected by the <span
class="inlinecode"><a class="idref" href="#farcall_type"><span
class="id" title="inductive">farcall_type</span></a></span> as follows:
<ul>
<li>Normal far call sets:
<ul>
<li><code>this_address</code> &lt;- destination address;</li>
<li><code>msg_sender</code> &lt;- caller address;</li>
<li><code>context</code> &lt;- value of context register <span
class="inlinecode"><a class="idref" href="#gs_context_u128"><span
class="id" title="projection">gs_context_u128</span></a></span>.</li>
</ul></li>
<li>Delegate call sets:
<ul>
<li><code>this_address</code> &lt;- <span class="inlinecode"><span
class="id" title="var">this_address</span></span> of the current
frame;</li>
<li><code>msg_sender</code> &lt;- <span class="inlinecode"><span
class="id" title="var">msg_sender</span></span> of the current
frame;</li>
<li><code>context</code> &lt;- <span class="inlinecode"><span class="id"
title="var">context_u128</span></span> of the current frame.</li>
</ul></li>
<li>Mimic call sets:
<ul>
<li><code>this_address</code> &lt;- destination address;</li>
<li><code>msg_sender</code> &lt;- value of <code>r15</code>;</li>
<li><code>context</code> &lt;- value of context register <span
class="inlinecode"><a class="idref" href="#gs_context_u128"><span
class="id" title="projection">gs_context_u128</span></a></span>.</li>
</ul></li>
</ul></li>
</ul></li>
</ol>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Definition</span> <a id="CALL_IMPLICIT_PARAMETER_REG" class="idref" href="#CALL_IMPLICIT_PARAMETER_REG"><span class="id" title="definition">CALL_IMPLICIT_PARAMETER_REG</span></a> := <a class="idref" href="#R15"><span class="id" title="constructor">R15</span></a>.<br/>
<span class="id" title="keyword">Inductive</span> <a id="farcall_type" class="idref" href="#farcall_type"><span class="id" title="inductive">farcall_type</span></a> : <span class="id" title="keyword">Set</span> := <a id="Normal" class="idref" href="#Normal"><span class="id" title="constructor">Normal</span></a> | <a id="Mimic" class="idref" href="#Mimic"><span class="id" title="constructor">Mimic</span></a> | <a id="Delegate" class="idref" href="#Delegate"><span class="id" title="constructor">Delegate</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a id="select_this_address" class="idref" href="#select_this_address"><span class="id" title="definition">select_this_address</span></a> <a id="type:77" class="idref" href="#type:77"><span class="id" title="binder">type</span></a> (<a id="caller:78" class="idref" href="#caller:78"><span class="id" title="binder">caller</span></a> <a id="dest:79" class="idref" href="#dest:79"><span class="id" title="binder">dest</span></a>: <a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#type:77"><span class="id" title="variable">type</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#Normal"><span class="id" title="constructor">Normal</span></a> ⇒ <a class="idref" href="#dest:79"><span class="id" title="variable">dest</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#Mimic"><span class="id" title="constructor">Mimic</span></a> ⇒ <a class="idref" href="#dest:79"><span class="id" title="variable">dest</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#Delegate"><span class="id" title="constructor">Delegate</span></a> ⇒ <a class="idref" href="#caller:78"><span class="id" title="variable">caller</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="select_sender" class="idref" href="#select_sender"><span class="id" title="definition">select_sender</span></a> <a id="type:81" class="idref" href="#type:81"><span class="id" title="binder">type</span></a> (<a id="callers_caller:82" class="idref" href="#callers_caller:82"><span class="id" title="binder">callers_caller</span></a> <a id="caller:83" class="idref" href="#caller:83"><span class="id" title="binder">caller</span></a> : <a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a>) <a id="regs:84" class="idref" href="#regs:84"><span class="id" title="binder">regs</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#type:81"><span class="id" title="variable">type</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#Normal"><span class="id" title="constructor">Normal</span></a> ⇒ <a class="idref" href="#caller:83"><span class="id" title="variable">caller</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#Delegate"><span class="id" title="constructor">Delegate</span></a> ⇒ <a class="idref" href="#callers_caller:82"><span class="id" title="variable">callers_caller</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#Mimic"><span class="id" title="constructor">Mimic</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="r15_value:86" class="idref" href="#r15_value:86"><span class="id" title="binder">r15_value</span></a> := (<a class="idref" href="#fetch_gpr"><span class="id" title="definition">fetch_gpr</span></a> <a class="idref" href="#regs:84"><span class="id" title="variable">regs</span></a> <a class="idref" href="#CALL_IMPLICIT_PARAMETER_REG"><span class="id" title="definition">CALL_IMPLICIT_PARAMETER_REG</span></a>).(<a class="idref" href="#value"><span class="id" title="projection">value</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">low</span> <a class="idref" href="#contract_address_bits"><span class="id" title="definition">contract_address_bits</span></a> <a class="idref" href="#r15_value:86"><span class="id" title="variable">r15_value</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="select_associated_contracts" class="idref" href="#select_associated_contracts"><span class="id" title="definition">select_associated_contracts</span></a> <a id="type:87" class="idref" href="#type:87"><span class="id" title="binder">type</span></a> <a id="regs:88" class="idref" href="#regs:88"><span class="id" title="binder">regs</span></a> (<a id="ac:89" class="idref" href="#ac:89"><span class="id" title="binder">ac</span></a>:<a class="idref" href="#associated_contracts"><span class="id" title="record">associated_contracts</span></a>) (<a id="call_dest:90" class="idref" href="#call_dest:90"><span class="id" title="binder">call_dest</span></a>: <a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a>): <a class="idref" href="#associated_contracts"><span class="id" title="record">associated_contracts</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#ac:89"><span class="id" title="variable">ac</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#mk_assoc_contracts"><span class="id" title="constructor">mk_assoc_contracts</span></a> <span class="id" title="var">this_address</span> <span class="id" title="var">msg_sender</span> <a class="idref" href="#code_address"><span class="id" title="definition">code_address</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ecf_this_address"><span class="id" title="projection">ecf_this_address</span></a> := <a class="idref" href="#select_this_address"><span class="id" title="definition">select_this_address</span></a> <a class="idref" href="#type:87"><span class="id" title="variable">type</span></a> <span class="id" title="var">this_address</span> <a class="idref" href="#call_dest:90"><span class="id" title="variable">call_dest</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ecf_msg_sender"><span class="id" title="projection">ecf_msg_sender</span></a> := <a class="idref" href="#select_sender"><span class="id" title="definition">select_sender</span></a> <a class="idref" href="#type:87"><span class="id" title="variable">type</span></a> <a class="idref" href="#ac:89"><span class="id" title="variable">ac</span></a>.(<a class="idref" href="#ecf_msg_sender"><span class="id" title="projection">ecf_msg_sender</span></a>) <span class="id" title="var">this_address</span> <a class="idref" href="#regs:88"><span class="id" title="variable">regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ecf_code_address"><span class="id" title="projection">ecf_code_address</span></a> := <a class="idref" href="#call_dest:90"><span class="id" title="variable">call_dest</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="select_ctx" class="idref" href="#select_ctx"><span class="id" title="definition">select_ctx</span></a> <a id="type:92" class="idref" href="#type:92"><span class="id" title="binder">type</span></a> (<a id="reg_ctx:93" class="idref" href="#reg_ctx:93"><span class="id" title="binder">reg_ctx</span></a> <a id="frame_ctx:94" class="idref" href="#frame_ctx:94"><span class="id" title="binder">frame_ctx</span></a>: <a class="idref" href="#u128"><span class="id" title="definition">u128</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#type:92"><span class="id" title="variable">type</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#Normal"><span class="id" title="constructor">Normal</span></a> | <a class="idref" href="#Mimic"><span class="id" title="constructor">Mimic</span></a> ⇒ <a class="idref" href="#reg_ctx:93"><span class="id" title="variable">reg_ctx</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#Delegate"><span class="id" title="constructor">Delegate</span></a> ⇒ <a class="idref" href="#frame_ctx:94"><span class="id" title="variable">frame_ctx</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="new_code_shard_id" class="idref" href="#new_code_shard_id"><span class="id" title="definition">new_code_shard_id</span></a> (<a id="is_call_shard:96" class="idref" href="#is_call_shard:96"><span class="id" title="binder">is_call_shard</span></a>:<a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>)<br/>
&nbsp;&nbsp;(<a id="provided:97" class="idref" href="#provided:97"><span class="id" title="binder">provided</span></a> <a id="current_shard:98" class="idref" href="#current_shard:98"><span class="id" title="binder">current_shard</span></a>:<a class="idref" href="#shard_id"><span class="id" title="definition">shard_id</span></a>) : <a class="idref" href="#shard_id"><span class="id" title="definition">shard_id</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#is_call_shard:96"><span class="id" title="variable">is_call_shard</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="#provided:97"><span class="id" title="variable">provided</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="#current_shard:98"><span class="id" title="variable">current_shard</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="select_shards" class="idref" href="#select_shards"><span class="id" title="definition">select_shards</span></a> (<a id="type:99" class="idref" href="#type:99"><span class="id" title="binder">type</span></a>: <a class="idref" href="#farcall_type"><span class="id" title="inductive">farcall_type</span></a>) (<a id="is_call_shard:100" class="idref" href="#is_call_shard:100"><span class="id" title="binder">is_call_shard</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>) (<a id="provided:101" class="idref" href="#provided:101"><span class="id" title="binder">provided</span></a>: <a class="idref" href="#shard_id"><span class="id" title="definition">shard_id</span></a>) (<a id="ss:102" class="idref" href="#ss:102"><span class="id" title="binder">ss</span></a>: <a class="idref" href="#active_shards"><span class="id" title="record">active_shards</span></a>) : <a class="idref" href="#active_shards"><span class="id" title="record">active_shards</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#ss:102"><span class="id" title="variable">ss</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#mk_shards"><span class="id" title="constructor">mk_shards</span></a> <span class="id" title="var">old_this</span> <span class="id" title="var">_</span> <span class="id" title="var">code</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_caller:104" class="idref" href="#new_caller:104"><span class="id" title="binder">new_caller</span></a> := <span class="id" title="var">old_this</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_code:105" class="idref" href="#new_code:105"><span class="id" title="binder">new_code</span></a> := <a class="idref" href="#new_code_shard_id"><span class="id" title="definition">new_code_shard_id</span></a> <a class="idref" href="#is_call_shard:100"><span class="id" title="variable">is_call_shard</span></a> <a class="idref" href="#provided:101"><span class="id" title="variable">provided</span></a> <a class="idref" href="#new_caller:104"><span class="id" title="variable">new_caller</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_this:107" class="idref" href="#new_this:107"><span class="id" title="binder">new_this</span></a> := <span class="id" title="keyword">match</span> <a class="idref" href="#type:99"><span class="id" title="variable">type</span></a> <span class="id" title="keyword">with</span> | <a class="idref" href="#Delegate"><span class="id" title="constructor">Delegate</span></a> ⇒ <a class="idref" href="#new_caller:104"><span class="id" title="variable">new_caller</span></a> | <span class="id" title="var">_</span> ⇒ <a class="idref" href="#new_code:105"><span class="id" title="variable">new_code</span></a> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#shard_this"><span class="id" title="projection">shard_this</span></a> := <a class="idref" href="#new_this:107"><span class="id" title="variable">new_this</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#shard_caller"><span class="id" title="projection">shard_caller</span></a> := <a class="idref" href="#new_caller:104"><span class="id" title="variable">new_caller</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#shard_code"><span class="id" title="projection">shard_code</span></a> := <a class="idref" href="#new_code:105"><span class="id" title="variable">new_code</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="FarCalls.FarCallDefinitions" class="idref" href="#FarCalls.FarCallDefinitions"><span class="id" title="section">FarCallDefinitions</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="type:108" class="idref" href="#type:108"><span class="id" title="binder">type</span></a>:<a class="idref" href="#farcall_type"><span class="id" title="inductive">farcall_type</span></a>) (<a id="is_static_call:109" class="idref" href="#is_static_call:109"><span class="id" title="binder">is_static_call</span></a> <a id="is_shard_provided:110" class="idref" href="#is_shard_provided:110"><span class="id" title="binder">is_shard_provided</span></a>:<a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>) (<a id="dest:111" class="idref" href="#dest:111"><span class="id" title="binder">dest</span></a>:<a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a>) (<a id="handler:112" class="idref" href="#handler:112"><span class="id" title="binder">handler</span></a>: <a class="idref" href="#code_address"><span class="id" title="definition">code_address</span></a>) (<a id="gs:113" class="idref" href="#gs:113"><span class="id" title="binder">gs</span></a>:<a class="idref" href="#global_state"><span class="id" title="record">global_state</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="farcall" class="idref" href="#farcall"><span class="id" title="inductive">farcall</span></a> : @<a class="idref" href="#primitive_value"><span class="id" title="record">primitive_value</span></a> <a class="idref" href="#params"><span class="id" title="record">FarCallABI.params</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#tsmallstep"><span class="id" title="definition">tsmallstep</span></a> :=<br/>
<br/>
&nbsp;&nbsp;| <a id="farcall_fwd_existing_fatptr" class="idref" href="#farcall_fwd_existing_fatptr"><span class="id" title="constructor">farcall_fwd_existing_fatptr</span></a>: <span class="id" title="keyword">∀</span> <a id="flags:116" class="idref" href="#flags:116"><span class="id" title="binder">flags</span></a> <a id="old_regs:117" class="idref" href="#old_regs:117"><span class="id" title="binder">old_regs</span></a> <a id="old_pages:118" class="idref" href="#old_pages:118"><span class="id" title="binder">old_pages</span></a> <a id="cs0:119" class="idref" href="#cs0:119"><span class="id" title="binder">cs0</span></a> <a id="cs1:120" class="idref" href="#cs1:120"><span class="id" title="binder">cs1</span></a> <a id="new_caller_stack:121" class="idref" href="#new_caller_stack:121"><span class="id" title="binder">new_caller_stack</span></a> <a id="new_stack:122" class="idref" href="#new_stack:122"><span class="id" title="binder">new_stack</span></a>  <a id="reg_context_u128:123" class="idref" href="#reg_context_u128:123"><span class="id" title="binder">reg_context_u128</span></a> <a id="new_regs:124" class="idref" href="#new_regs:124"><span class="id" title="binder">new_regs</span></a> <a id="new_pages:125" class="idref" href="#new_pages:125"><span class="id" title="binder">new_pages</span></a> <a id="new_code_page:126" class="idref" href="#new_code_page:126"><span class="id" title="binder">new_code_page</span></a> <a id="new_const_page:127" class="idref" href="#new_const_page:127"><span class="id" title="binder">new_const_page</span></a> <a id="new_mem_ctx:128" class="idref" href="#new_mem_ctx:128"><span class="id" title="binder">new_mem_ctx</span></a> (<a id="in_ptr:129" class="idref" href="#in_ptr:129"><span class="id" title="binder">in_ptr</span></a> <a id="narrowed_ptr:130" class="idref" href="#narrowed_ptr:130"><span class="id" title="binder">narrowed_ptr</span></a>: <a class="idref" href="#fat_ptr"><span class="id" title="record">fat_ptr</span></a>) <a id="abi_shard:131" class="idref" href="#abi_shard:131"><span class="id" title="binder">abi_shard</span></a> <a id="ergs_query:132" class="idref" href="#ergs_query:132"><span class="id" title="binder">ergs_query</span></a> <a id="ergs_actual:133" class="idref" href="#ergs_actual:133"><span class="id" title="binder">ergs_actual</span></a> <a id="is_syscall_query:134" class="idref" href="#is_syscall_query:134"><span class="id" title="binder">is_syscall_query</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="caller_extframe:135" class="idref" href="#caller_extframe:135"><span class="id" title="binder">caller_extframe</span></a> := <a class="idref" href="#active_extframe"><span class="id" title="definition">active_extframe</span></a> <a class="idref" href="#cs0:119"><span class="id" title="variable">cs0</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="mem_ctx0:136" class="idref" href="#mem_ctx0:136"><span class="id" title="binder">mem_ctx0</span></a> := <a class="idref" href="#ecf_mem_ctx"><span class="id" title="projection">ecf_mem_ctx</span></a> <a class="idref" href="#caller_extframe:135"><span class="id" title="variable">caller_extframe</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="is_system:137" class="idref" href="#is_system:137"><span class="id" title="binder">is_system</span></a> := <a class="idref" href="#addr_is_kernel"><span class="id" title="definition">addr_is_kernel</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a> <a class="idref" href="#is_syscall_query:134"><span class="id" title="variable">is_syscall_query</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="allow_masking:138" class="idref" href="#allow_masking:138"><span class="id" title="binder">allow_masking</span></a> := <a class="idref" href="#negb"><span class="id" title="definition">negb</span></a> <a class="idref" href="#is_system:137"><span class="id" title="variable">is_system</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="callee_shard:139" class="idref" href="#callee_shard:139"><span class="id" title="binder">callee_shard</span></a> := <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.is_shard_provided"><span class="id" title="variable">is_shard_provided</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="#abi_shard:131"><span class="id" title="variable">abi_shard</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="#current_shard"><span class="id" title="definition">current_shard</span></a> <a class="idref" href="#cs0:119"><span class="id" title="variable">cs0</span></a> <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#paid_code_fetch"><span class="id" title="inductive">paid_code_fetch</span></a> <a class="idref" href="#allow_masking:138"><span class="id" title="variable">allow_masking</span></a> <a class="idref" href="#callee_shard:139"><span class="id" title="variable">callee_shard</span></a> (<a class="idref" href="#gs_depot"><span class="id" title="projection">gs_depot</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>) (<a class="idref" href="#gs_contracts"><span class="id" title="projection">gs_contracts</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>) <a class="idref" href="#FarCalls.FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a> <a class="idref" href="#cs0:119"><span class="id" title="variable">cs0</span></a> (<a class="idref" href="#Fetched"><span class="id" title="constructor">Fetched</span></a> <a class="idref" href="#cs1:120"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#new_code_page:126"><span class="id" title="variable">new_code_page</span></a> <a class="idref" href="#new_const_page:127"><span class="id" title="variable">new_const_page</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*!*)</span><a class="idref" href="#validate"><span class="id" title="definition">validate</span></a> <a class="idref" href="#in_ptr:129"><span class="id" title="variable">in_ptr</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#no_exceptions"><span class="id" title="definition">no_exceptions</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*!*)</span><a class="idref" href="#fat_ptr_narrow"><span class="id" title="definition">fat_ptr_narrow</span></a> <a class="idref" href="#in_ptr:129"><span class="id" title="variable">in_ptr</span></a> <a class="idref" href="#narrowed_ptr:130"><span class="id" title="variable">narrowed_ptr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#alloc_pages_extframe"><span class="id" title="inductive">alloc_pages_extframe</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#old_pages:118"><span class="id" title="variable">old_pages</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#mem_ctx0:136"><span class="id" title="variable">mem_ctx0</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#new_code_page:126"><span class="id" title="variable">new_code_page</span></a> <a class="idref" href="#new_const_page:127"><span class="id" title="variable">new_const_page</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#new_pages:125"><span class="id" title="variable">new_pages</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#new_mem_ctx:128"><span class="id" title="variable">new_mem_ctx</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pass_allowed_ergs"><span class="id" title="inductive">pass_allowed_ergs</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#ergs_query:132"><span class="id" title="variable">ergs_query</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#cs1:120"><span class="id" title="variable">cs1</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#ergs_actual:133"><span class="id" title="variable">ergs_actual</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#new_caller_stack:121"><span class="id" title="variable">new_caller_stack</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_stack:122"><span class="id" title="variable">new_stack</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ecf_associated"><span class="id" title="projection">ecf_associated</span></a>         := <a class="idref" href="#select_associated_contracts"><span class="id" title="definition">select_associated_contracts</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.type"><span class="id" title="variable">type</span></a> <a class="idref" href="#old_regs:117"><span class="id" title="variable">old_regs</span></a> <a class="idref" href="#caller_extframe:135"><span class="id" title="variable">caller_extframe</span></a>.(<a class="idref" href="#ecf_associated"><span class="id" title="projection">ecf_associated</span></a>) <a class="idref" href="#FarCalls.FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ecf_context_u128_value"><span class="id" title="projection">ecf_context_u128_value</span></a> := <a class="idref" href="#select_ctx"><span class="id" title="definition">select_ctx</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.type"><span class="id" title="variable">type</span></a> <a class="idref" href="#reg_context_u128:123"><span class="id" title="variable">reg_context_u128</span></a> <a class="idref" href="#caller_extframe:135"><span class="id" title="variable">caller_extframe</span></a>.(<a class="idref" href="#ecf_context_u128_value"><span class="id" title="projection">ecf_context_u128_value</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ecf_shards"><span class="id" title="projection">ecf_shards</span></a>             := <a class="idref" href="#select_shards"><span class="id" title="definition">select_shards</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.type"><span class="id" title="variable">type</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.is_shard_provided"><span class="id" title="variable">is_shard_provided</span></a> <a class="idref" href="#abi_shard:131"><span class="id" title="variable">abi_shard</span></a> <a class="idref" href="#caller_extframe:135"><span class="id" title="variable">caller_extframe</span></a>.(<a class="idref" href="#ecf_shards"><span class="id" title="projection">ecf_shards</span></a>);<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ecf_mem_ctx"><span class="id" title="projection">ecf_mem_ctx</span></a> := <a class="idref" href="#new_mem_ctx:128"><span class="id" title="variable">new_mem_ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ecf_is_static"><span class="id" title="projection">ecf_is_static</span></a> :=  <a class="idref" href="#ecf_is_static"><span class="id" title="projection">ecf_is_static</span></a> <a class="idref" href="#caller_extframe:135"><span class="id" title="variable">caller_extframe</span></a> <a class="idref" href="#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">||</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.is_static_call"><span class="id" title="variable">is_static_call</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ecf_common"><span class="id" title="projection">ecf_common</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#cf_exception_handler_location"><span class="id" title="projection">cf_exception_handler_location</span></a> := <a class="idref" href="#FarCalls.FarCallDefinitions.handler"><span class="id" title="variable">handler</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#cf_sp"><span class="id" title="projection">cf_sp</span></a> := <a class="idref" href="#INITIAL_SP_ON_FAR_CALL"><span class="id" title="definition">INITIAL_SP_ON_FAR_CALL</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#cf_pc"><span class="id" title="projection">cf_pc</span></a> := <a class="idref" href="#zero16"><span class="id" title="definition">zero16</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#cf_ergs_remaining"><span class="id" title="projection">cf_ergs_remaining</span></a> := <a class="idref" href="#ergs_actual:133"><span class="id" title="variable">ergs_actual</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#cf_saved_checkpoint"><span class="id" title="projection">cf_saved_checkpoint</span></a> := <a class="idref" href="#FarCalls.FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>.(<a class="idref" href="#gs_revertable"><span class="id" title="projection">gs_revertable</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|} (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#new_caller_stack:121"><span class="id" title="variable">new_caller_stack</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#new_regs:124"><span class="id" title="variable">new_regs</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#regs_effect"><span class="id" title="definition">regs_effect</span></a> <a class="idref" href="#old_regs:117"><span class="id" title="variable">old_regs</span></a> <a class="idref" href="#is_system:137"><span class="id" title="variable">is_system</span></a> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a> (<a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="#narrowed_ptr:130"><span class="id" title="variable">narrowed_ptr</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#farcall:114"><span class="id" title="inductive">farcall</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> {|<br/>
<a class="idref" href="#fwd_memory"><span class="id" title="projection">FarCallABI.fwd_memory</span></a>           := <a class="idref" href="#ForwardExistingFatPointer"><span class="id" title="constructor">ForwardExistingFatPointer</span></a> (<a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="#in_ptr:129"><span class="id" title="variable">in_ptr</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_passed"><span class="id" title="projection">ergs_passed</span></a>          := <a class="idref" href="#ergs_query:132"><span class="id" title="variable">ergs_query</span></a>;<br/>
<a class="idref" href="#shard_id"><span class="id" title="projection">FarCallABI.shard_id</span></a>     := <a class="idref" href="#abi_shard:131"><span class="id" title="variable">abi_shard</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#constructor_call"><span class="id" title="projection">constructor_call</span></a>     := <a class="idref" href="#false"><span class="id" title="constructor">false</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#to_system"><span class="id" title="projection">to_system</span></a>            := <a class="idref" href="#is_syscall_query:134"><span class="id" title="variable">is_syscall_query</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags:116"><span class="id" title="variable">flags</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#old_regs:117"><span class="id" title="variable">old_regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#old_pages:118"><span class="id" title="variable">old_pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#cs0:119"><span class="id" title="variable">cs0</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#reg_context_u128:123"><span class="id" title="variable">reg_context_u128</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags_clear"><span class="id" title="definition">flags_clear</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#new_regs:124"><span class="id" title="variable">new_regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#new_pages:125"><span class="id" title="variable">new_pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#new_stack:122"><span class="id" title="variable">new_stack</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#zero128"><span class="id" title="definition">zero128</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
<br/>
&nbsp;&nbsp;| <a id="farcall_fwd_new_ptr" class="idref" href="#farcall_fwd_new_ptr"><span class="id" title="constructor">farcall_fwd_new_ptr</span></a>: <span class="id" title="keyword">∀</span> <a id="flags:140" class="idref" href="#flags:140"><span class="id" title="binder">flags</span></a> <a id="old_regs:141" class="idref" href="#old_regs:141"><span class="id" title="binder">old_regs</span></a> <a id="old_pages:142" class="idref" href="#old_pages:142"><span class="id" title="binder">old_pages</span></a> <a id="cs0:143" class="idref" href="#cs0:143"><span class="id" title="binder">cs0</span></a> <a id="cs1:144" class="idref" href="#cs1:144"><span class="id" title="binder">cs1</span></a> <a id="cs2:145" class="idref" href="#cs2:145"><span class="id" title="binder">cs2</span></a> <a id="new_regs:146" class="idref" href="#new_regs:146"><span class="id" title="binder">new_regs</span></a> <a id="new_caller_stack:147" class="idref" href="#new_caller_stack:147"><span class="id" title="binder">new_caller_stack</span></a> <a id="new_stack:148" class="idref" href="#new_stack:148"><span class="id" title="binder">new_stack</span></a> <a id="reg_context_u128:149" class="idref" href="#reg_context_u128:149"><span class="id" title="binder">reg_context_u128</span></a> <a id="new_pages:150" class="idref" href="#new_pages:150"><span class="id" title="binder">new_pages</span></a> <a id="new_code_page:151" class="idref" href="#new_code_page:151"><span class="id" title="binder">new_code_page</span></a> <a id="new_const_page:152" class="idref" href="#new_const_page:152"><span class="id" title="binder">new_const_page</span></a> <a id="new_mem_ctx:153" class="idref" href="#new_mem_ctx:153"><span class="id" title="binder">new_mem_ctx</span></a> <a id="abi_shard:154" class="idref" href="#abi_shard:154"><span class="id" title="binder">abi_shard</span></a> <a id="ergs_query:155" class="idref" href="#ergs_query:155"><span class="id" title="binder">ergs_query</span></a> <a id="ergs_actual:156" class="idref" href="#ergs_actual:156"><span class="id" title="binder">ergs_actual</span></a> <a id="is_syscall_query:157" class="idref" href="#is_syscall_query:157"><span class="id" title="binder">is_syscall_query</span></a> <a id="out_ptr:158" class="idref" href="#out_ptr:158"><span class="id" title="binder">out_ptr</span></a> <a id="in_span:159" class="idref" href="#in_span:159"><span class="id" title="binder">in_span</span></a> <a id="page_type:160" class="idref" href="#page_type:160"><span class="id" title="binder">page_type</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="is_system:161" class="idref" href="#is_system:161"><span class="id" title="binder">is_system</span></a> := <a class="idref" href="#addr_is_kernel"><span class="id" title="definition">addr_is_kernel</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a> <a class="idref" href="#is_syscall_query:157"><span class="id" title="variable">is_syscall_query</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="allow_masking:162" class="idref" href="#allow_masking:162"><span class="id" title="binder">allow_masking</span></a> := <a class="idref" href="#negb"><span class="id" title="definition">negb</span></a> <a class="idref" href="#is_system:161"><span class="id" title="variable">is_system</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="callee_shard:163" class="idref" href="#callee_shard:163"><span class="id" title="binder">callee_shard</span></a> := <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.is_shard_provided"><span class="id" title="variable">is_shard_provided</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="#abi_shard:154"><span class="id" title="variable">abi_shard</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="#current_shard"><span class="id" title="definition">current_shard</span></a> <a class="idref" href="#cs0:143"><span class="id" title="variable">cs0</span></a> <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#paid_code_fetch"><span class="id" title="inductive">paid_code_fetch</span></a> <a class="idref" href="#allow_masking:162"><span class="id" title="variable">allow_masking</span></a> <a class="idref" href="#callee_shard:163"><span class="id" title="variable">callee_shard</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#FarCalls.FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>.(<a class="idref" href="#gs_revertable"><span class="id" title="projection">gs_revertable</span></a>).(<a class="idref" href="#gs_depot"><span class="id" title="projection">gs_depot</span></a>) <a class="idref" href="#FarCalls.FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>.(<a class="idref" href="#gs_contracts"><span class="id" title="projection">gs_contracts</span></a>) <a class="idref" href="#FarCalls.FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a> <a class="idref" href="#cs0:143"><span class="id" title="variable">cs0</span></a> (<a class="idref" href="#Fetched"><span class="id" title="constructor">Fetched</span></a> <a class="idref" href="#cs1:144"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#new_code_page:151"><span class="id" title="variable">new_code_page</span></a> <a class="idref" href="#new_const_page:152"><span class="id" title="variable">new_const_page</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*!*)</span><a class="idref" href="#paid_forward_new_fat_ptr"><span class="id" title="inductive">paid_forward_new_fat_ptr</span></a> <a class="idref" href="#page_type:160"><span class="id" title="variable">page_type</span></a> <a class="idref" href="#in_span:159"><span class="id" title="variable">in_span</span></a> <a class="idref" href="#cs0:143"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#out_ptr:158"><span class="id" title="variable">out_ptr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#cs1:144"><span class="id" title="variable">cs1</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="caller_extframe:164" class="idref" href="#caller_extframe:164"><span class="id" title="binder">caller_extframe</span></a> := <a class="idref" href="#active_extframe"><span class="id" title="definition">active_extframe</span></a> <a class="idref" href="#cs2:145"><span class="id" title="variable">cs2</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="mem_ctx0:165" class="idref" href="#mem_ctx0:165"><span class="id" title="binder">mem_ctx0</span></a> := <a class="idref" href="#caller_extframe:164"><span class="id" title="variable">caller_extframe</span></a>.(<a class="idref" href="#ecf_mem_ctx"><span class="id" title="projection">ecf_mem_ctx</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#alloc_pages_extframe"><span class="id" title="inductive">alloc_pages_extframe</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#old_pages:142"><span class="id" title="variable">old_pages</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#mem_ctx0:165"><span class="id" title="variable">mem_ctx0</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#new_code_page:151"><span class="id" title="variable">new_code_page</span></a> <a class="idref" href="#new_const_page:152"><span class="id" title="variable">new_const_page</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#new_pages:150"><span class="id" title="variable">new_pages</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#new_mem_ctx:153"><span class="id" title="variable">new_mem_ctx</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pass_allowed_ergs"><span class="id" title="inductive">pass_allowed_ergs</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#ergs_query:155"><span class="id" title="variable">ergs_query</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#cs2:145"><span class="id" title="variable">cs2</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#ergs_actual:156"><span class="id" title="variable">ergs_actual</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#new_caller_stack:147"><span class="id" title="variable">new_caller_stack</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_stack:148"><span class="id" title="variable">new_stack</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ecf_associated"><span class="id" title="projection">ecf_associated</span></a>         := <a class="idref" href="#select_associated_contracts"><span class="id" title="definition">select_associated_contracts</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.type"><span class="id" title="variable">type</span></a> <a class="idref" href="#old_regs:141"><span class="id" title="variable">old_regs</span></a> <a class="idref" href="#caller_extframe:164"><span class="id" title="variable">caller_extframe</span></a>.(<a class="idref" href="#ecf_associated"><span class="id" title="projection">ecf_associated</span></a>) <a class="idref" href="#FarCalls.FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ecf_context_u128_value"><span class="id" title="projection">ecf_context_u128_value</span></a> := <a class="idref" href="#select_ctx"><span class="id" title="definition">select_ctx</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.type"><span class="id" title="variable">type</span></a> <a class="idref" href="#reg_context_u128:149"><span class="id" title="variable">reg_context_u128</span></a> <a class="idref" href="#caller_extframe:164"><span class="id" title="variable">caller_extframe</span></a>.(<a class="idref" href="#ecf_context_u128_value"><span class="id" title="projection">ecf_context_u128_value</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ecf_shards"><span class="id" title="projection">ecf_shards</span></a>             := <a class="idref" href="#select_shards"><span class="id" title="definition">select_shards</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.type"><span class="id" title="variable">type</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.is_shard_provided"><span class="id" title="variable">is_shard_provided</span></a> <a class="idref" href="#abi_shard:154"><span class="id" title="variable">abi_shard</span></a> <a class="idref" href="#caller_extframe:164"><span class="id" title="variable">caller_extframe</span></a>.(<a class="idref" href="#ecf_shards"><span class="id" title="projection">ecf_shards</span></a>);<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ecf_mem_ctx"><span class="id" title="projection">ecf_mem_ctx</span></a> := <a class="idref" href="#new_mem_ctx:153"><span class="id" title="variable">new_mem_ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ecf_is_static"><span class="id" title="projection">ecf_is_static</span></a> :=  <a class="idref" href="#ecf_is_static"><span class="id" title="projection">ecf_is_static</span></a> <a class="idref" href="#caller_extframe:164"><span class="id" title="variable">caller_extframe</span></a> <a class="idref" href="#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">||</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.is_static_call"><span class="id" title="variable">is_static_call</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ecf_common"><span class="id" title="projection">ecf_common</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#cf_exception_handler_location"><span class="id" title="projection">cf_exception_handler_location</span></a> := <a class="idref" href="#FarCalls.FarCallDefinitions.handler"><span class="id" title="variable">handler</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#cf_sp"><span class="id" title="projection">cf_sp</span></a> := <a class="idref" href="#INITIAL_SP_ON_FAR_CALL"><span class="id" title="definition">INITIAL_SP_ON_FAR_CALL</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#cf_pc"><span class="id" title="projection">cf_pc</span></a> := <a class="idref" href="#zero16"><span class="id" title="definition">zero16</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#cf_ergs_remaining"><span class="id" title="projection">cf_ergs_remaining</span></a> := <a class="idref" href="#ergs_actual:156"><span class="id" title="variable">ergs_actual</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#cf_saved_checkpoint"><span class="id" title="projection">cf_saved_checkpoint</span></a> := <a class="idref" href="#FarCalls.FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>.(<a class="idref" href="#gs_revertable"><span class="id" title="projection">gs_revertable</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|} (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#new_caller_stack:147"><span class="id" title="variable">new_caller_stack</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#new_regs:146"><span class="id" title="variable">new_regs</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#regs_effect"><span class="id" title="definition">regs_effect</span></a> <a class="idref" href="#old_regs:141"><span class="id" title="variable">old_regs</span></a> <a class="idref" href="#is_system:161"><span class="id" title="variable">is_system</span></a> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a> (<a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="#out_ptr:158"><span class="id" title="variable">out_ptr</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#farcall:114"><span class="id" title="inductive">farcall</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> {|<br/>
<a class="idref" href="#fwd_memory"><span class="id" title="projection">FarCallABI.fwd_memory</span></a>   := <a class="idref" href="#ForwardNewFatPointer"><span class="id" title="constructor">ForwardNewFatPointer</span></a> <a class="idref" href="#page_type:160"><span class="id" title="variable">page_type</span></a> <a class="idref" href="#in_span:159"><span class="id" title="variable">in_span</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_passed"><span class="id" title="projection">ergs_passed</span></a>          := <a class="idref" href="#ergs_query:155"><span class="id" title="variable">ergs_query</span></a>;<br/>
<a class="idref" href="#shard_id"><span class="id" title="projection">FarCallABI.shard_id</span></a>     := <a class="idref" href="#abi_shard:154"><span class="id" title="variable">abi_shard</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#constructor_call"><span class="id" title="projection">constructor_call</span></a>     := <a class="idref" href="#false"><span class="id" title="constructor">false</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#to_system"><span class="id" title="projection">to_system</span></a>            := <a class="idref" href="#is_syscall_query:157"><span class="id" title="variable">is_syscall_query</span></a>;<br/>
<span class="comment">(*!*)</span>   |})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags:140"><span class="id" title="variable">flags</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#old_regs:141"><span class="id" title="variable">old_regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#old_pages:142"><span class="id" title="variable">old_pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#cs0:143"><span class="id" title="variable">cs0</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#reg_context_u128:149"><span class="id" title="variable">reg_context_u128</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags_clear"><span class="id" title="definition">flags_clear</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#new_regs:146"><span class="id" title="variable">new_regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#new_pages:150"><span class="id" title="variable">new_pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#new_stack:148"><span class="id" title="variable">new_stack</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#zero128"><span class="id" title="definition">zero128</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
</div>

<div class="doc"><h2 id="affected-parts-of-vm-state">Affected parts of VM state</h2>
<ul>
<li>flags are cleared</li>
<li>registers are affected as described by <span
class="inlinecode"><a class="idref" href="#regs_effect"><span
class="id" title="definition">regs_effect</span></a></span>.</li>
<li>new pages appear as described by <span
class="inlinecode"><a class="idref" href="#alloc_pages_extframe"><span
class="id"
title="inductive">alloc_pages_extframe</span></a></span>.</li>
<li>context register is zeroed.</li>
<li>execution stack is affected in a non-trivial way (see step 10 in
description for <span
class="inlinecode"><a class="idref" href="#farcall"><span
class="id" title="inductive">farcall</span></a></span>).</li>
</ul>
<h2 id="comparison-with-near-calls">Comparison with near calls</h2>
<ul>
<li>Far calls can not accept more than <span
class="inlinecode"><a class="idref" href="#max_passable"><span
class="id" title="definition">max_passable</span></a></span> ergs, while
near calls may accept all available ergs.</li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Calling other contracts</li>
<li>Calling precompiles Usually we call a system contract with assigned
precompile. It prepares data for a precompile, performs precompile call,
and returns the result.</li>
</ul>
<h2 id="encoding">Encoding</h2>
<ul>
<li>In the encoding, <span
class="inlinecode"><a class="idref" href="#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpFarCall"><span
class="id" title="constructor">OpFarCall</span></a></span>, and <span
class="inlinecode"><a class="idref" href="#OpMimicCall"><span
class="id" title="constructor">OpMimicCall</span></a></span> share the
same opcode.</li>
</ul>
<h1 id="panics">Panics</h1>
<ol type="1">
<li>Attempting to pass an existing <span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span>, but the passed
value is not tagged as a pointer.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="farcall_fwd_existing_fatptr_notag" class="idref" href="#farcall_fwd_existing_fatptr_notag"><span class="id" title="constructor">farcall_fwd_existing_fatptr_notag</span></a>: <span class="id" title="keyword">∀</span> (<a id="ts1:166" class="idref" href="#ts1:166"><span class="id" title="binder">ts1</span></a> <a id="ts2:167" class="idref" href="#ts2:167"><span class="id" title="binder">ts2</span></a>:<a class="idref" href="#transient_state"><span class="id" title="record">transient_state</span></a>) <a id="___0:168" class="idref" href="#___0:168"><span class="id" title="binder">___0</span></a> <a id="___1:169" class="idref" href="#___1:169"><span class="id" title="binder">___1</span></a> <a id="___2:170" class="idref" href="#___2:170"><span class="id" title="binder">___2</span></a> <a id="___3:171" class="idref" href="#___3:171"><span class="id" title="binder">___3</span></a> <a id="___4:172" class="idref" href="#___4:172"><span class="id" title="binder">___4</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ts2:167"><span class="id" title="variable">ts2</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ts1:166"><span class="id" title="variable">ts1</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Panic"><span class="id" title="constructor">Panic</span></a> <a class="idref" href="#FarCallInputIsNotPointerWhenExpected"><span class="id" title="constructor">FarCallInputIsNotPointerWhenExpected</span></a> <span class="id" title="notation">|></span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#farcall:114"><span class="id" title="inductive">farcall</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fwd_memory"><span class="id" title="projection">FarCallABI.fwd_memory</span></a>   := <a class="idref" href="#ForwardExistingFatPointer"><span class="id" title="constructor">ForwardExistingFatPointer</span></a> <a class="idref" href="#___0:168"><span class="id" title="variable">___0</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_passed"><span class="id" title="projection">ergs_passed</span></a>          := <a class="idref" href="#___1:169"><span class="id" title="variable">___1</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#shard_id"><span class="id" title="projection">FarCallABI.shard_id</span></a>     := <a class="idref" href="#___2:170"><span class="id" title="variable">___2</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#constructor_call"><span class="id" title="projection">constructor_call</span></a>     := <a class="idref" href="#___3:171"><span class="id" title="variable">___3</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#to_system"><span class="id" title="projection">to_system</span></a>            := <a class="idref" href="#___4:172"><span class="id" title="variable">___4</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}) <a class="idref" href="#ts1:166"><span class="id" title="variable">ts1</span></a> <a class="idref" href="#ts2:167"><span class="id" title="variable">ts2</span></a><br/>
</div>

<div class="doc"><ol start="2" type="1">
<li>The hash for the contract code (stored in the storage of <span
class="inlinecode"><a class="idref" href="#DEPLOYER_SYSTEM_CONTRACT_ADDRESS"><span
class="id"
title="definition">DEPLOYER_SYSTEM_CONTRACT_ADDRESS</span></a></span>)
is malformed.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="farcall_malformed_decommitment_hash" class="idref" href="#farcall_malformed_decommitment_hash"><span class="id" title="constructor">farcall_malformed_decommitment_hash</span></a>:  <span class="id" title="keyword">∀</span> <a id="cs0:173" class="idref" href="#cs0:173"><span class="id" title="binder">cs0</span></a> <a id="abi_shard:174" class="idref" href="#abi_shard:174"><span class="id" title="binder">abi_shard</span></a> <a id="is_syscall_query:175" class="idref" href="#is_syscall_query:175"><span class="id" title="binder">is_syscall_query</span></a> <a id="ts1:176" class="idref" href="#ts1:176"><span class="id" title="binder">ts1</span></a> <a id="ts2:177" class="idref" href="#ts2:177"><span class="id" title="binder">ts2</span></a> <a id="___1:178" class="idref" href="#___1:178"><span class="id" title="binder">___1</span></a> <a id="___2:179" class="idref" href="#___2:179"><span class="id" title="binder">___2</span></a> <a id="___3:180" class="idref" href="#___3:180"><span class="id" title="binder">___3</span></a> <a id="___4:181" class="idref" href="#___4:181"><span class="id" title="binder">___4</span></a> <a id="_tag:182" class="idref" href="#_tag:182"><span class="id" title="binder">_tag</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="is_system:183" class="idref" href="#is_system:183"><span class="id" title="binder">is_system</span></a> := <a class="idref" href="#addr_is_kernel"><span class="id" title="definition">addr_is_kernel</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a> <a class="idref" href="#is_syscall_query:175"><span class="id" title="variable">is_syscall_query</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="allow_masking:184" class="idref" href="#allow_masking:184"><span class="id" title="binder">allow_masking</span></a> := <a class="idref" href="#negb"><span class="id" title="definition">negb</span></a> <a class="idref" href="#is_system:183"><span class="id" title="variable">is_system</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="callee_shard:185" class="idref" href="#callee_shard:185"><span class="id" title="binder">callee_shard</span></a> := <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.is_shard_provided"><span class="id" title="variable">is_shard_provided</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="#abi_shard:174"><span class="id" title="variable">abi_shard</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="#current_shard"><span class="id" title="definition">current_shard</span></a> <a class="idref" href="#cs0:173"><span class="id" title="variable">cs0</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#paid_code_fetch"><span class="id" title="inductive">paid_code_fetch</span></a> <a class="idref" href="#allow_masking:184"><span class="id" title="variable">allow_masking</span></a> <a class="idref" href="#callee_shard:185"><span class="id" title="variable">callee_shard</span></a> (<a class="idref" href="#gs_depot"><span class="id" title="projection">gs_depot</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>) (<a class="idref" href="#gs_contracts"><span class="id" title="projection">gs_contracts</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>) <a class="idref" href="#FarCalls.FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a> <a class="idref" href="#cs0:173"><span class="id" title="variable">cs0</span></a> (<a class="idref" href="#CodeFetchInvalidVerisonedHashFormat"><span class="id" title="constructor">CodeFetchInvalidVerisonedHashFormat</span></a> <a class="idref" href="#___4:181"><span class="id" title="variable">___4</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ts2:177"><span class="id" title="variable">ts2</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ts1:176"><span class="id" title="variable">ts1</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Panic"><span class="id" title="constructor">Panic</span></a> <a class="idref" href="#FarCallInvalidCodeHashFormat"><span class="id" title="constructor">FarCallInvalidCodeHashFormat</span></a> <span class="id" title="notation">|></span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#farcall:114"><span class="id" title="inductive">farcall</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#_tag:182"><span class="id" title="variable">_tag</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fwd_memory"><span class="id" title="projection">FarCallABI.fwd_memory</span></a>   := <a class="idref" href="#___1:178"><span class="id" title="variable">___1</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_passed"><span class="id" title="projection">ergs_passed</span></a>          := <a class="idref" href="#___2:179"><span class="id" title="variable">___2</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#shard_id"><span class="id" title="projection">FarCallABI.shard_id</span></a>     := <a class="idref" href="#abi_shard:174"><span class="id" title="variable">abi_shard</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#constructor_call"><span class="id" title="projection">constructor_call</span></a>     := <a class="idref" href="#___3:180"><span class="id" title="variable">___3</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#to_system"><span class="id" title="projection">to_system</span></a>            := <a class="idref" href="#is_syscall_query:175"><span class="id" title="variable">is_syscall_query</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ts1:176"><span class="id" title="variable">ts1</span></a> <a class="idref" href="#ts2:177"><span class="id" title="variable">ts2</span></a><br/>
</div>

<div class="doc"><ol start="3" type="1">
<li>Not enough ergs to pay for code decommitment.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="farcall_decommitment_unaffordable" class="idref" href="#farcall_decommitment_unaffordable"><span class="id" title="constructor">farcall_decommitment_unaffordable</span></a>:  <span class="id" title="keyword">∀</span> <a id="cs0:186" class="idref" href="#cs0:186"><span class="id" title="binder">cs0</span></a> <a id="abi_shard:187" class="idref" href="#abi_shard:187"><span class="id" title="binder">abi_shard</span></a> <a id="is_syscall_query:188" class="idref" href="#is_syscall_query:188"><span class="id" title="binder">is_syscall_query</span></a> <a id="ts1:189" class="idref" href="#ts1:189"><span class="id" title="binder">ts1</span></a> <a id="ts2:190" class="idref" href="#ts2:190"><span class="id" title="binder">ts2</span></a>  <a id="___1:191" class="idref" href="#___1:191"><span class="id" title="binder">___1</span></a> <a id="___2:192" class="idref" href="#___2:192"><span class="id" title="binder">___2</span></a> <a id="___3:193" class="idref" href="#___3:193"><span class="id" title="binder">___3</span></a> <a id="___4:194" class="idref" href="#___4:194"><span class="id" title="binder">___4</span></a> <a id="_tag:195" class="idref" href="#_tag:195"><span class="id" title="binder">_tag</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="is_system:196" class="idref" href="#is_system:196"><span class="id" title="binder">is_system</span></a> := <a class="idref" href="#addr_is_kernel"><span class="id" title="definition">addr_is_kernel</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a> <a class="idref" href="#is_syscall_query:188"><span class="id" title="variable">is_syscall_query</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="allow_masking:197" class="idref" href="#allow_masking:197"><span class="id" title="binder">allow_masking</span></a> := <a class="idref" href="#negb"><span class="id" title="definition">negb</span></a> <a class="idref" href="#is_system:196"><span class="id" title="variable">is_system</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="callee_shard:198" class="idref" href="#callee_shard:198"><span class="id" title="binder">callee_shard</span></a> := <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.is_shard_provided"><span class="id" title="variable">is_shard_provided</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="#abi_shard:187"><span class="id" title="variable">abi_shard</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="#current_shard"><span class="id" title="definition">current_shard</span></a> <a class="idref" href="#cs0:186"><span class="id" title="variable">cs0</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#paid_code_fetch"><span class="id" title="inductive">paid_code_fetch</span></a> <a class="idref" href="#allow_masking:197"><span class="id" title="variable">allow_masking</span></a> <a class="idref" href="#callee_shard:198"><span class="id" title="variable">callee_shard</span></a> (<a class="idref" href="#gs_depot"><span class="id" title="projection">gs_depot</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>) (<a class="idref" href="#gs_contracts"><span class="id" title="projection">gs_contracts</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>) <a class="idref" href="#FarCalls.FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a> <a class="idref" href="#cs0:186"><span class="id" title="variable">cs0</span></a> (<a class="idref" href="#CodeFetchUnaffordable"><span class="id" title="constructor">CodeFetchUnaffordable</span></a> <a class="idref" href="#___1:191"><span class="id" title="variable">___1</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#cs0:186"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#ts1:189"><span class="id" title="variable">ts1</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ts2:190"><span class="id" title="variable">ts2</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ts1:189"><span class="id" title="variable">ts1</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Panic"><span class="id" title="constructor">Panic</span></a> <a class="idref" href="#FarCallNotEnoughErgsToDecommit"><span class="id" title="constructor">FarCallNotEnoughErgsToDecommit</span></a> <span class="id" title="notation">|></span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#farcall:114"><span class="id" title="inductive">farcall</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#_tag:195"><span class="id" title="variable">_tag</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fwd_memory"><span class="id" title="projection">FarCallABI.fwd_memory</span></a>   := <a class="idref" href="#___2:192"><span class="id" title="variable">___2</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_passed"><span class="id" title="projection">ergs_passed</span></a>          := <a class="idref" href="#___3:193"><span class="id" title="variable">___3</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#shard_id"><span class="id" title="projection">FarCallABI.shard_id</span></a>     := <a class="idref" href="#abi_shard:187"><span class="id" title="variable">abi_shard</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#constructor_call"><span class="id" title="projection">constructor_call</span></a>     := <a class="idref" href="#___4:194"><span class="id" title="variable">___4</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#to_system"><span class="id" title="projection">to_system</span></a>            := <a class="idref" href="#is_syscall_query:188"><span class="id" title="variable">is_syscall_query</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ts1:189"><span class="id" title="variable">ts1</span></a> <a class="idref" href="#ts2:190"><span class="id" title="variable">ts2</span></a><br/>
</div>

<div class="doc"><ol start="4" type="1">
<li>Paid for decommitment; Returning a new fat pointer, but not enough
ergs to pay for memory growth.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="farcall_fwd_new_ptr_growth_unaffordable" class="idref" href="#farcall_fwd_new_ptr_growth_unaffordable"><span class="id" title="constructor">farcall_fwd_new_ptr_growth_unaffordable</span></a>: <span class="id" title="keyword">∀</span> <a id="cs0:199" class="idref" href="#cs0:199"><span class="id" title="binder">cs0</span></a> <a id="cs1:200" class="idref" href="#cs1:200"><span class="id" title="binder">cs1</span></a> <a id="___1:201" class="idref" href="#___1:201"><span class="id" title="binder">___1</span></a> <a id="___2:202" class="idref" href="#___2:202"><span class="id" title="binder">___2</span></a> <a id="abi_shard:203" class="idref" href="#abi_shard:203"><span class="id" title="binder">abi_shard</span></a> <a id="ergs_query:204" class="idref" href="#ergs_query:204"><span class="id" title="binder">ergs_query</span></a> <a id="is_syscall_query:205" class="idref" href="#is_syscall_query:205"><span class="id" title="binder">is_syscall_query</span></a> <a id="in_span:206" class="idref" href="#in_span:206"><span class="id" title="binder">in_span</span></a> <a id="page_type:207" class="idref" href="#page_type:207"><span class="id" title="binder">page_type</span></a> <a id="bound:208" class="idref" href="#bound:208"><span class="id" title="binder">bound</span></a> <a id="growth_query:209" class="idref" href="#growth_query:209"><span class="id" title="binder">growth_query</span></a> <a id="ts1:210" class="idref" href="#ts1:210"><span class="id" title="binder">ts1</span></a> <a id="ts2:211" class="idref" href="#ts2:211"><span class="id" title="binder">ts2</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="is_system:212" class="idref" href="#is_system:212"><span class="id" title="binder">is_system</span></a> := <a class="idref" href="#addr_is_kernel"><span class="id" title="definition">addr_is_kernel</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a> <a class="idref" href="#is_syscall_query:205"><span class="id" title="variable">is_syscall_query</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="allow_masking:213" class="idref" href="#allow_masking:213"><span class="id" title="binder">allow_masking</span></a> := <a class="idref" href="#negb"><span class="id" title="definition">negb</span></a> <a class="idref" href="#is_system:212"><span class="id" title="variable">is_system</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="callee_shard:214" class="idref" href="#callee_shard:214"><span class="id" title="binder">callee_shard</span></a> := <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#FarCalls.FarCallDefinitions.is_shard_provided"><span class="id" title="variable">is_shard_provided</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="#abi_shard:203"><span class="id" title="variable">abi_shard</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="#current_shard"><span class="id" title="definition">current_shard</span></a> <a class="idref" href="#cs0:199"><span class="id" title="variable">cs0</span></a> <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#paid_code_fetch"><span class="id" title="inductive">paid_code_fetch</span></a> <a class="idref" href="#allow_masking:213"><span class="id" title="variable">allow_masking</span></a> <a class="idref" href="#callee_shard:214"><span class="id" title="variable">callee_shard</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#FarCalls.FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>.(<a class="idref" href="#gs_revertable"><span class="id" title="projection">gs_revertable</span></a>).(<a class="idref" href="#gs_depot"><span class="id" title="projection">gs_depot</span></a>) <a class="idref" href="#FarCalls.FarCallDefinitions.gs"><span class="id" title="variable">gs</span></a>.(<a class="idref" href="#gs_contracts"><span class="id" title="projection">gs_contracts</span></a>) <a class="idref" href="#FarCalls.FarCallDefinitions.dest"><span class="id" title="variable">dest</span></a> <a class="idref" href="#cs0:199"><span class="id" title="variable">cs0</span></a> (<a class="idref" href="#Fetched"><span class="id" title="constructor">Fetched</span></a> <a class="idref" href="#cs1:200"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#___1:201"><span class="id" title="variable">___1</span></a> <a class="idref" href="#___2:202"><span class="id" title="variable">___2</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bound_of_span"><span class="id" title="inductive">bound_of_span</span></a> <a class="idref" href="#in_span:206"><span class="id" title="variable">in_span</span></a> <a class="idref" href="#page_type:207"><span class="id" title="variable">page_type</span></a> <a class="idref" href="#bound:208"><span class="id" title="variable">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#growth_to_bound"><span class="id" title="inductive">growth_to_bound</span></a> <a class="idref" href="#bound:208"><span class="id" title="variable">bound</span></a> <a class="idref" href="#cs1:200"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#growth_query:209"><span class="id" title="variable">growth_query</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#affordable"><span class="id" title="definition">affordable</span></a> <a class="idref" href="#cs1:200"><span class="id" title="variable">cs1</span></a> (<a class="idref" href="#cost_of_growth"><span class="id" title="definition">cost_of_growth</span></a> <a class="idref" href="#growth_query:209"><span class="id" title="variable">growth_query</span></a>) <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#cs0:199"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#ts1:210"><span class="id" title="variable">ts1</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ts2:211"><span class="id" title="variable">ts2</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ts1:210"><span class="id" title="variable">ts1</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Panic"><span class="id" title="constructor">Panic</span></a> <a class="idref" href="#FarCallNotEnoughErgsToGrowMemory"><span class="id" title="constructor">FarCallNotEnoughErgsToGrowMemory</span></a> <span class="id" title="notation">|></span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#farcall:114"><span class="id" title="inductive">farcall</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fwd_memory"><span class="id" title="projection">FarCallABI.fwd_memory</span></a>   := <a class="idref" href="#ForwardNewFatPointer"><span class="id" title="constructor">ForwardNewFatPointer</span></a> <a class="idref" href="#page_type:207"><span class="id" title="variable">page_type</span></a> <a class="idref" href="#in_span:206"><span class="id" title="variable">in_span</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_passed"><span class="id" title="projection">ergs_passed</span></a>          := <a class="idref" href="#ergs_query:204"><span class="id" title="variable">ergs_query</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#shard_id"><span class="id" title="projection">FarCallABI.shard_id</span></a>     := <a class="idref" href="#abi_shard:203"><span class="id" title="variable">abi_shard</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#constructor_call"><span class="id" title="projection">constructor_call</span></a>     := <a class="idref" href="#false"><span class="id" title="constructor">false</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#to_system"><span class="id" title="projection">to_system</span></a>            := <a class="idref" href="#is_syscall_query:205"><span class="id" title="variable">is_syscall_query</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ts1:210"><span class="id" title="variable">ts1</span></a> <a class="idref" href="#ts2:211"><span class="id" title="variable">ts2</span></a><br/>
&nbsp;&nbsp;.<br/>
</div>

<div class="doc"><h2 id="not-formalized">Not formalized</h2>
<ul>
<li>system contracts + constructor calls + “call in now constructed
system contract” exception</li>
</ul>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#FarCalls.FarCallDefinitions"><span class="id" title="section">FarCallDefinitions</span></a>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <a id="step_farcall" class="idref" href="#step_farcall"><span class="id" title="inductive">step_farcall</span></a> : <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
<br/>
| <a id="step_farcall_normal" class="idref" href="#step_farcall_normal"><span class="id" title="constructor">step_farcall_normal</span></a>: <span class="id" title="keyword">∀</span> <a id="handler:217" class="idref" href="#handler:217"><span class="id" title="binder">handler</span></a> <a id="pv_abi:218" class="idref" href="#pv_abi:218"><span class="id" title="binder">pv_abi</span></a> (<a id="dest:219" class="idref" href="#dest:219"><span class="id" title="binder">dest</span></a>:<a class="idref" href="#word"><span class="id" title="definition">word</span></a>) <a id="call_shard:220" class="idref" href="#call_shard:220"><span class="id" title="binder">call_shard</span></a> <a id="call_as_static:221" class="idref" href="#call_as_static:221"><span class="id" title="binder">call_as_static</span></a> <a id="s1:222" class="idref" href="#s1:222"><span class="id" title="binder">s1</span></a> <a id="s2:223" class="idref" href="#s2:223"><span class="id" title="binder">s2</span></a> <a id="ts1:224" class="idref" href="#ts1:224"><span class="id" title="binder">ts1</span></a> <a id="ts2:225" class="idref" href="#ts2:225"><span class="id" title="binder">ts2</span></a> (<a id="__:226" class="idref" href="#__:226"><span class="id" title="binder">__</span></a>:<a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>),<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="dest_addr:227" class="idref" href="#dest_addr:227"><span class="id" title="binder">dest_addr</span></a> := <span class="id" title="definition">low</span> <a class="idref" href="#contract_address_bits"><span class="id" title="definition">contract_address_bits</span></a> <a class="idref" href="#dest:219"><span class="id" title="variable">dest</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="handler_code_addr:228" class="idref" href="#handler_code_addr:228"><span class="id" title="binder">handler_code_addr</span></a> := <span class="id" title="definition">low</span> <a class="idref" href="#code_address_bits"><span class="id" title="definition">code_address_bits</span></a> <a class="idref" href="#handler:217"><span class="id" title="variable">handler</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#farcall"><span class="id" title="inductive">farcall</span></a> <a class="idref" href="#Normal"><span class="id" title="constructor">Normal</span></a> <a class="idref" href="#call_as_static:221"><span class="id" title="variable">call_as_static</span></a> <a class="idref" href="#call_shard:220"><span class="id" title="variable">call_shard</span></a> <a class="idref" href="#dest_addr:227"><span class="id" title="variable">dest_addr</span></a> <a class="idref" href="#handler_code_addr:228"><span class="id" title="variable">handler_code_addr</span></a> <a class="idref" href="#s1:222"><span class="id" title="variable">s1</span></a>.(<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>) <a class="idref" href="#pv_abi:218"><span class="id" title="variable">pv_abi</span></a> <a class="idref" href="#ts1:224"><span class="id" title="variable">ts1</span></a> <a class="idref" href="#ts2:225"><span class="id" title="variable">ts2</span></a>  <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_transient_only"><span class="id" title="inductive">step_transient_only</span></a> <a class="idref" href="#ts1:224"><span class="id" title="variable">ts1</span></a> <a class="idref" href="#ts2:225"><span class="id" title="variable">ts2</span></a> <a class="idref" href="#s1:222"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:223"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_farcall:215"><span class="id" title="inductive">step_farcall</span></a> (<a class="idref" href="#OpFarCall"><span class="id" title="constructor">OpFarCall</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#pv_abi:218"><span class="id" title="variable">pv_abi</span></a>) (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#__:226"><span class="id" title="variable">__</span></a> <a class="idref" href="#dest:219"><span class="id" title="variable">dest</span></a>) <a class="idref" href="#handler:217"><span class="id" title="variable">handler</span></a> <a class="idref" href="#call_shard:220"><span class="id" title="variable">call_shard</span></a> <a class="idref" href="#call_as_static:221"><span class="id" title="variable">call_as_static</span></a>) <a class="idref" href="#s1:222"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:223"><span class="id" title="variable">s2</span></a><br/>
| <a id="step_farcall_mimic" class="idref" href="#step_farcall_mimic"><span class="id" title="constructor">step_farcall_mimic</span></a>: <span class="id" title="keyword">∀</span> <a id="handler:229" class="idref" href="#handler:229"><span class="id" title="binder">handler</span></a> <a id="pv_abi:230" class="idref" href="#pv_abi:230"><span class="id" title="binder">pv_abi</span></a> (<a id="dest:231" class="idref" href="#dest:231"><span class="id" title="binder">dest</span></a>:<a class="idref" href="#word"><span class="id" title="definition">word</span></a>) <a id="call_shard:232" class="idref" href="#call_shard:232"><span class="id" title="binder">call_shard</span></a> <a id="call_as_static:233" class="idref" href="#call_as_static:233"><span class="id" title="binder">call_as_static</span></a> <a id="s1:234" class="idref" href="#s1:234"><span class="id" title="binder">s1</span></a> <a id="s2:235" class="idref" href="#s2:235"><span class="id" title="binder">s2</span></a> <a id="ts1:236" class="idref" href="#ts1:236"><span class="id" title="binder">ts1</span></a> <a id="ts2:237" class="idref" href="#ts2:237"><span class="id" title="binder">ts2</span></a> (<a id="__:238" class="idref" href="#__:238"><span class="id" title="binder">__</span></a>:<a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>),<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="dest_addr:239" class="idref" href="#dest_addr:239"><span class="id" title="binder">dest_addr</span></a> := <span class="id" title="definition">low</span> <a class="idref" href="#contract_address_bits"><span class="id" title="definition">contract_address_bits</span></a> <a class="idref" href="#dest:231"><span class="id" title="variable">dest</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="handler_code_addr:240" class="idref" href="#handler_code_addr:240"><span class="id" title="binder">handler_code_addr</span></a> := <span class="id" title="definition">low</span> <a class="idref" href="#code_address_bits"><span class="id" title="definition">code_address_bits</span></a> <a class="idref" href="#handler:229"><span class="id" title="variable">handler</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#farcall"><span class="id" title="inductive">farcall</span></a> <a class="idref" href="#Mimic"><span class="id" title="constructor">Mimic</span></a> <a class="idref" href="#call_as_static:233"><span class="id" title="variable">call_as_static</span></a> <a class="idref" href="#call_shard:232"><span class="id" title="variable">call_shard</span></a> <a class="idref" href="#dest_addr:239"><span class="id" title="variable">dest_addr</span></a> <a class="idref" href="#handler_code_addr:240"><span class="id" title="variable">handler_code_addr</span></a> <a class="idref" href="#s1:234"><span class="id" title="variable">s1</span></a>.(<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>) <a class="idref" href="#pv_abi:230"><span class="id" title="variable">pv_abi</span></a> <a class="idref" href="#ts1:236"><span class="id" title="variable">ts1</span></a> <a class="idref" href="#ts2:237"><span class="id" title="variable">ts2</span></a>  <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_transient_only"><span class="id" title="inductive">step_transient_only</span></a> <a class="idref" href="#ts1:236"><span class="id" title="variable">ts1</span></a> <a class="idref" href="#ts2:237"><span class="id" title="variable">ts2</span></a> <a class="idref" href="#s1:234"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:235"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_farcall:215"><span class="id" title="inductive">step_farcall</span></a> (<a class="idref" href="#OpMimicCall"><span class="id" title="constructor">OpMimicCall</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#pv_abi:230"><span class="id" title="variable">pv_abi</span></a>) (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#__:238"><span class="id" title="variable">__</span></a> <a class="idref" href="#dest:231"><span class="id" title="variable">dest</span></a>) <a class="idref" href="#handler:229"><span class="id" title="variable">handler</span></a> <a class="idref" href="#call_shard:232"><span class="id" title="variable">call_shard</span></a> <a class="idref" href="#call_as_static:233"><span class="id" title="variable">call_as_static</span></a>) <a class="idref" href="#s1:234"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:235"><span class="id" title="variable">s2</span></a><br/>
| <a id="step_farcall_delegate" class="idref" href="#step_farcall_delegate"><span class="id" title="constructor">step_farcall_delegate</span></a>: <span class="id" title="keyword">∀</span> <a id="handler:241" class="idref" href="#handler:241"><span class="id" title="binder">handler</span></a> <a id="pv_abi:242" class="idref" href="#pv_abi:242"><span class="id" title="binder">pv_abi</span></a> (<a id="dest:243" class="idref" href="#dest:243"><span class="id" title="binder">dest</span></a>:<a class="idref" href="#word"><span class="id" title="definition">word</span></a>) <a id="call_shard:244" class="idref" href="#call_shard:244"><span class="id" title="binder">call_shard</span></a> <a id="call_as_static:245" class="idref" href="#call_as_static:245"><span class="id" title="binder">call_as_static</span></a> <a id="s1:246" class="idref" href="#s1:246"><span class="id" title="binder">s1</span></a> <a id="s2:247" class="idref" href="#s2:247"><span class="id" title="binder">s2</span></a> <a id="ts1:248" class="idref" href="#ts1:248"><span class="id" title="binder">ts1</span></a> <a id="ts2:249" class="idref" href="#ts2:249"><span class="id" title="binder">ts2</span></a> (<a id="__:250" class="idref" href="#__:250"><span class="id" title="binder">__</span></a>:<a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>),<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="dest_addr:251" class="idref" href="#dest_addr:251"><span class="id" title="binder">dest_addr</span></a> := <span class="id" title="definition">low</span> <a class="idref" href="#contract_address_bits"><span class="id" title="definition">contract_address_bits</span></a> <a class="idref" href="#dest:243"><span class="id" title="variable">dest</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="handler_code_addr:252" class="idref" href="#handler_code_addr:252"><span class="id" title="binder">handler_code_addr</span></a> := <span class="id" title="definition">low</span> <a class="idref" href="#code_address_bits"><span class="id" title="definition">code_address_bits</span></a> <a class="idref" href="#handler:241"><span class="id" title="variable">handler</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#farcall"><span class="id" title="inductive">farcall</span></a> <a class="idref" href="#Delegate"><span class="id" title="constructor">Delegate</span></a> <a class="idref" href="#call_as_static:245"><span class="id" title="variable">call_as_static</span></a> <a class="idref" href="#call_shard:244"><span class="id" title="variable">call_shard</span></a> <a class="idref" href="#dest_addr:251"><span class="id" title="variable">dest_addr</span></a> <a class="idref" href="#handler_code_addr:252"><span class="id" title="variable">handler_code_addr</span></a> <a class="idref" href="#s1:246"><span class="id" title="variable">s1</span></a>.(<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>) <a class="idref" href="#pv_abi:242"><span class="id" title="variable">pv_abi</span></a> <a class="idref" href="#ts1:248"><span class="id" title="variable">ts1</span></a> <a class="idref" href="#ts2:249"><span class="id" title="variable">ts2</span></a>  <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_transient_only"><span class="id" title="inductive">step_transient_only</span></a> <a class="idref" href="#ts1:248"><span class="id" title="variable">ts1</span></a> <a class="idref" href="#ts2:249"><span class="id" title="variable">ts2</span></a> <a class="idref" href="#s1:246"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:247"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_farcall:215"><span class="id" title="inductive">step_farcall</span></a> (<a class="idref" href="#OpDelegateCall"><span class="id" title="constructor">OpDelegateCall</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#pv_abi:242"><span class="id" title="variable">pv_abi</span></a>) (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#__:250"><span class="id" title="variable">__</span></a> <a class="idref" href="#dest:243"><span class="id" title="variable">dest</span></a>) <a class="idref" href="#handler:241"><span class="id" title="variable">handler</span></a> <a class="idref" href="#call_shard:244"><span class="id" title="variable">call_shard</span></a> <a class="idref" href="#call_as_static:245"><span class="id" title="variable">call_as_static</span></a>) <a class="idref" href="#s1:246"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:247"><span class="id" title="variable">s2</span></a><br/>
.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#FarCalls"><span class="id" title="section">FarCalls</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.FarRet</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span><br/>
<a class="idref" href="#"><span class="id" title="library">ABI</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">Bool</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">CallStack</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">Coder</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">Common</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">Flags</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">GPR</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">MemoryContext</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">MemoryManagement</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">Pointer</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">PrimitiveValue</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">State</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span><br/>
<a class="idref" href="#"><span class="id" title="module">ABI</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">FatPointerABI</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">Bool</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">CallStack</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">Coder</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">Common</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">Flags</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">GPR</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">MemoryContext</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">MemoryManagement</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">Pointer</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a><br/>
<span class="id" title="module">RecordSetNotations</span><br/>
<a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">State</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">StepPanic</span></a><br/>
.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="FarRetDefinition" class="idref" href="#FarRetDefinition"><span class="id" title="section">FarRetDefinition</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Let</span> <a id="FarRetDefinition.reserve" class="idref" href="#FarRetDefinition.reserve"><span class="id" title="variable">reserve</span></a> <a id="regs:1" class="idref" href="#regs:1"><span class="id" title="binder">regs</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="#regs:1"><span class="id" title="variable">regs</span></a>    <span class="id" title="notation"><|</span> <a class="idref" href="#r2"><span class="id" title="projection">r2</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#reserved"><span class="id" title="definition">reserved</span></a> <span class="id" title="notation">|></span> <span class="id" title="notation"><|</span> <a class="idref" href="#r3"><span class="id" title="projection">r3</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#reserved"><span class="id" title="definition">reserved</span></a> <span class="id" title="notation">|></span> <span class="id" title="notation"><|</span> <a class="idref" href="#r4"><span class="id" title="projection">r4</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#reserved"><span class="id" title="definition">reserved</span></a> <span class="id" title="notation">|></span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_farret" class="idref" href="#step_farret"><span class="id" title="inductive">step_farret</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#tsmallstep"><span class="id" title="definition">tsmallstep</span></a> :=<br/>
</div>

<div class="doc"><h1 id="opret-case-of-far-return">OpRet (case of far return)</h1>
<p>The near return and far return share the same syntax, but their
runtime semantic is different:</p>
<ul>
<li>if the topmost frame in callstack is <span
class="inlinecode"><a class="idref" href="#ExternalCall"><span
class="id" title="constructor">ExternalCall</span></a></span>, the far
return semantic is selected (see <span
class="inlinecode"><a class="idref" href="#FarRetDefinition"><span
class="id" title="section">FarRetDefinition</span></a></span>);</li>
<li>if the topmost frame in callstack is <span
class="inlinecode"><a class="idref" href="#InternalCall"><span
class="id" title="constructor">InternalCall</span></a></span>, the near
return semantic is selected (see <span
class="inlinecode"><a class="idref" href="#NearRetDefinition"><span
class="id" title="section">NearRetDefinition</span></a></span>).</li>
</ul>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpRet"><span
class="id" title="constructor">OpRet</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><p><code>ret in1</code></p></li>
<li><p><code>ret</code>, an alias to <code>ret r1</code>. Argument is
ignored for near returns.</p></li>
</ul>
<h2 id="legacy-syntax">Legacy syntax</h2>
<ul>
<li><code>ret in1</code></li>
<li><code>ret</code> is an alias for <code>ret r1</code></li>
<li><code>ret.ok in1</code> aliased as <code>ret in1</code></li>
</ul>
<h2 id="summary">Summary</h2>
<p>A normal return from a <strong>far</strong> call. Will pop up current
callframe, return unspent ergs to the caller, and continue execution
from the saved return address (from where the call had taken place). The
register <code>args</code> describes a span of memory passed to the
external caller.</p>
<h2 id="semantic">Semantic</h2>
<ol type="1">
<li><p>Fetch the value from register <code>args</code> and decode the
value of type <span
class="inlinecode"><a class="idref" href="#fwd_memory"><span
class="id" title="inductive">fwd_memory</span></a></span>:</p>
<pre><code>Inductive fwd_memory :=
  ForwardFatPointer (p:fat_ptr)
| ForwardNewFatPointer (heap_var: data_page_type) (s:span).</code></pre>
<p>The exact encoding is described by ABI.</p></li>
<li><p>Forward memory to the caller (see <span class="inlinecode"><span
class="id" title="var">paid_forward</span></span>):</p>
<ul>
<li><p>If <code>args</code> is <span
class="inlinecode"><a class="idref" href="#FarCallForwardPageType.ForwardFatPointer"><span
class="id" title="definition">ForwardFatPointer</span></a></span> <span
class="inlinecode"><span class="id" title="var">p</span></span>, an
existing <span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span> is forwarded:</p>
<ul>
<li>ensure that the register containing <code>args</code> is tagged as a
pointer.</li>
<li>ensure that the memory page of <code>p</code> does NOT refer to a
page owned by an older frame.</li>
<li><span
class="inlinecode"><a class="idref" href="#fat_ptr_narrow"><span
class="id" title="definition">fat_ptr_narrow</span></a></span> <span
class="inlinecode"><span class="id" title="var">p</span></span> so it
starts at its current offset, and the offset is reset to zero.</li>
</ul>
<p>There is no payment because the existing fat pointer has already been
paid for.</p>
<p><strong>Attention</strong>: <strong>shrinking</strong> and
<strong>narrowing</strong> far pointers are different. See <span
class="inlinecode"><a class="idref" href="#fat_ptr_shrink"><span
class="id" title="definition">fat_ptr_shrink</span></a></span> and <span
class="inlinecode"><a class="idref" href="#fat_ptr_narrow"><span
class="id" title="definition">fat_ptr_narrow</span></a></span>.</p></li>
<li><p>If <code>args</code> is <span
class="inlinecode"><a class="idref" href="#ForwardNewFatPointer"><span
class="id" title="constructor">ForwardNewFatPointer</span></a></span>
<span class="inlinecode"><span class="id"
title="var">heap_variant</span></span> <span
class="inlinecode">[<a class="idref" href="#start"><span
class="id" title="projection">start</span></a>;</span> <span
class="inlinecode"><span class="id" title="var">limit</span>)</span>, a
new <span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span> is created:</p>
<ul>
<li><p>let <span class="math inline">B</span> be the bound of the <span
class="inlinecode"><span class="id"
title="var">heap_variant</span></span> taken from <span
class="inlinecode"><a class="idref" href="#ctx_heap_bound"><span
class="id" title="projection">ctx_heap_bound</span></a></span> field of
<span
class="inlinecode"><a class="idref" href="#ecf_mem_ctx"><span
class="id" title="projection">ecf_mem_ctx</span></a></span> of the <span
class="inlinecode"><a class="idref" href="#active_extframe"><span
class="id"
title="definition">active_extframe</span></a></span>.</p></li>
<li><p>let <span class="math inline">I</span> be the page id of the
<span class="inlinecode"><span class="id"
title="var">heap_variant</span></span> taken from <span
class="inlinecode"><a class="idref" href="#ctx_heap_page_id"><span
class="id" title="projection">ctx_heap_page_id</span></a></span> field
of <span
class="inlinecode"><a class="idref" href="#ecf_mem_ctx"><span
class="id" title="projection">ecf_mem_ctx</span></a></span> of the <span
class="inlinecode"><a class="idref" href="#active_extframe"><span
class="id"
title="definition">active_extframe</span></a></span>.</p></li>
<li><p>build a fat pointer <span class="math inline">P</span> from the
span as described in <span class="inlinecode"><span class="id"
title="var">paid_forward_heap_span</span></span>.</p>
<p><span class="math display">P := (I, (\mathit{start}, \mathit{limit}),
0)</span></p></li>
<li><p>if <span class="math inline">\mathit{start} + \mathit{limit}
&gt;B</span>, pay for the growth difference (<span
class="inlinecode"><a class="idref" href="#growth_cost"><span
class="id" title="definition">growth_cost</span></a></span> <span
class="math inline">(\mathit{start} + \mathit{limit} -
B)</span>).</p></li>
</ul>
<p>Note: it is not useful to readjust the current heap/auxheap bounds
after paying for growth. The bounds are part of <span
class="inlinecode"><a class="idref" href="#mem_ctx"><span
class="id" title="record">mem_ctx</span></a></span> of the topmost
frame, which is about to be discarded.</p></li>
</ul></li>
<li><p>Return the remaining ergs from <span
class="inlinecode"><a class="idref" href="#cf_ergs_remaining"><span
class="id" title="projection">cf_ergs_remaining</span></a></span> of the
destroyed frame to the caller.</p></li>
<li><p>Clear flags.</p></li>
<li><p>Encode <span class="math inline">P</span> and store it in
register <span
class="inlinecode"><a class="idref" href="#r1"><span
class="id" title="projection">r1</span></a></span>, setting its pointer
tag.</p>
<p>All other registers are zeroed. Registers <span
class="inlinecode"><a class="idref" href="#r2"><span
class="id" title="projection">r2</span></a></span>, <span
class="inlinecode"><a class="idref" href="#r3"><span
class="id" title="projection">r3</span></a></span>, and <span
class="inlinecode"><a class="idref" href="#r4"><span
class="id" title="projection">r4</span></a></span> are reserved and may
gain a special meaning in newer versions of EraVM.</p></li>
<li><p>Clear context register.</p></li>
</ol>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
<li>Execution stack:
<ul>
<li>Current frame is dropped.</li>
<li>Caller frame:
<ul>
<li>Unspent ergs are given back to caller (but memory growth is paid
first).</li>
</ul></li>
</ul></li>
<li>Flags are cleared.</li>
<li>Context register is zeroed (only returns from far calls).</li>
<li>Registers are cleared (only returns from far calls).</li>
</ul>
<h2 id="usage">Usage</h2>
<p>Normal returns from functions (and contracts).</p>
<h2 id="related-instructions">Related instructions</h2>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#OpRevert"><span
class="id" title="constructor">OpRevert</span></a></span> executes the
current frame’s exception handler instead of returning to the
caller.</li>
<li><span
class="inlinecode"><a class="idref" href="#OpPanic"><span
class="id" title="constructor">OpPanic</span></a></span> executes the
current frame’s exception handler instead of returning to the caller,
and sets overflow flag.</li>
</ul>
</div>
<div class="code">
<br/>
| <a id="step_RetExt_heapvar" class="idref" href="#step_RetExt_heapvar"><span class="id" title="constructor">step_RetExt_heapvar</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="pages:4" class="idref" href="#pages:4"><span class="id" title="binder">pages</span></a> <a id="cf:5" class="idref" href="#cf:5"><span class="id" title="binder">cf</span></a> <a id="caller_stack:6" class="idref" href="#caller_stack:6"><span class="id" title="binder">caller_stack</span></a> <a id="cs1:7" class="idref" href="#cs1:7"><span class="id" title="binder">cs1</span></a> <a id="new_caller:8" class="idref" href="#new_caller:8"><span class="id" title="binder">new_caller</span></a> <a id="new_regs:9" class="idref" href="#new_regs:9"><span class="id" title="binder">new_regs</span></a> <a id="___1:10" class="idref" href="#___1:10"><span class="id" title="binder">___1</span></a> <a id="___2:11" class="idref" href="#___2:11"><span class="id" title="binder">___2</span></a> <a id="___3:12" class="idref" href="#___3:12"><span class="id" title="binder">___3</span></a> <a id="out_ptr:13" class="idref" href="#out_ptr:13"><span class="id" title="binder">out_ptr</span></a> <a id="heap_type:14" class="idref" href="#heap_type:14"><span class="id" title="binder">heap_type</span></a> <a id="hspan:15" class="idref" href="#hspan:15"><span class="id" title="binder">hspan</span></a> <a id="params:16" class="idref" href="#params:16"><span class="id" title="binder">params</span></a> <a id="s1:17" class="idref" href="#s1:17"><span class="id" title="binder">s1</span></a> <a id="s2:18" class="idref" href="#s2:18"><span class="id" title="binder">s2</span></a> <a id="status:19" class="idref" href="#status:19"><span class="id" title="binder">status</span></a> <a id="enc_ptr:20" class="idref" href="#enc_ptr:20"><span class="id" title="binder">enc_ptr</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cs0:21" class="idref" href="#cs0:21"><span class="id" title="binder">cs0</span></a> := <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="#cf:5"><span class="id" title="variable">cf</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#caller_stack:6"><span class="id" title="variable">caller_stack</span></a>) <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#paid_forward_new_fat_ptr"><span class="id" title="inductive">paid_forward_new_fat_ptr</span></a> <a class="idref" href="#heap_type:14"><span class="id" title="variable">heap_type</span></a> <a class="idref" href="#hspan:15"><span class="id" title="variable">hspan</span></a> <a class="idref" href="#cs0:21"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#out_ptr:13"><span class="id" title="variable">out_ptr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#cs1:7"><span class="id" title="variable">cs1</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_return_caller_and_drop"><span class="id" title="inductive">ergs_return_caller_and_drop</span></a> <a class="idref" href="#cs1:7"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#new_caller:8"><span class="id" title="variable">new_caller</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#params:16"><span class="id" title="variable">params</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#mk_params"><span class="id" title="constructor">FarRetABI.mk_params</span></a> (<a class="idref" href="#ForwardNewFatPointer"><span class="id" title="constructor">ForwardNewFatPointer</span></a> <a class="idref" href="#heap_type:14"><span class="id" title="variable">heap_type</span></a> <a class="idref" href="#hspan:15"><span class="id" title="variable">hspan</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#enc_ptr:20"><span class="id" title="variable">enc_ptr</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#encode_fat_ptr_word"><span class="id" title="definition">encode_fat_ptr_word</span></a> <a class="idref" href="#zero128"><span class="id" title="definition">zero128</span></a> (<a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="#out_ptr:13"><span class="id" title="variable">out_ptr</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_regs:9"><span class="id" title="variable">new_regs</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="notation">(</span><a class="idref" href="#FarRetDefinition.reserve"><span class="id" title="variable">reserve</span></a> <a class="idref" href="#regs_state_zero"><span class="id" title="definition">regs_state_zero</span></a><span class="id" title="notation">)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#r1"><span class="id" title="projection">r1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#enc_ptr:20"><span class="id" title="variable">enc_ptr</span></a> <span class="id" title="notation">|></span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_transient_only"><span class="id" title="inductive">step_transient_only</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#___1:10"><span class="id" title="variable">___1</span></a> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#cs0:21"><span class="id" title="variable">cs0</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#___2:11"><span class="id" title="variable">___2</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#___3:12"><span class="id" title="variable">___3</span></a>;<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:4"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#status:19"><span class="id" title="variable">status</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags_clear"><span class="id" title="definition">flags_clear</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#new_caller:8"><span class="id" title="variable">new_caller</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#new_regs:9"><span class="id" title="variable">new_regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#zero128"><span class="id" title="definition">zero128</span></a>;<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:4"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#status:19"><span class="id" title="variable">status</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|} <a class="idref" href="#s1:17"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:18"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_farret:2"><span class="id" title="inductive">step_farret</span></a> (<a class="idref" href="#OpRet"><span class="id" title="constructor">OpRet</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#params:16"><span class="id" title="variable">params</span></a>))) <a class="idref" href="#s1:17"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:18"><span class="id" title="variable">s2</span></a><br/>
<br/>
&nbsp;&nbsp;| <a id="step_RetExt_ForwardFatPointer" class="idref" href="#step_RetExt_ForwardFatPointer"><span class="id" title="constructor">step_RetExt_ForwardFatPointer</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="pages:22" class="idref" href="#pages:22"><span class="id" title="binder">pages</span></a> <a id="cf:23" class="idref" href="#cf:23"><span class="id" title="binder">cf</span></a> <a id="caller_stack:24" class="idref" href="#caller_stack:24"><span class="id" title="binder">caller_stack</span></a> <a id="cs1:25" class="idref" href="#cs1:25"><span class="id" title="binder">cs1</span></a> <a id="new_caller:26" class="idref" href="#new_caller:26"><span class="id" title="binder">new_caller</span></a> <a id="new_regs:27" class="idref" href="#new_regs:27"><span class="id" title="binder">new_regs</span></a> <a id="___1:28" class="idref" href="#___1:28"><span class="id" title="binder">___1</span></a> <a id="___2:29" class="idref" href="#___2:29"><span class="id" title="binder">___2</span></a> <a id="___3:30" class="idref" href="#___3:30"><span class="id" title="binder">___3</span></a> <a id="in_ptr:31" class="idref" href="#in_ptr:31"><span class="id" title="binder">in_ptr</span></a> <a id="out_ptr:32" class="idref" href="#out_ptr:32"><span class="id" title="binder">out_ptr</span></a> <a id="page:33" class="idref" href="#page:33"><span class="id" title="binder">page</span></a> <a id="params:34" class="idref" href="#params:34"><span class="id" title="binder">params</span></a> <a id="s1:35" class="idref" href="#s1:35"><span class="id" title="binder">s1</span></a> <a id="s2:36" class="idref" href="#s2:36"><span class="id" title="binder">s2</span></a> <a id="status:37" class="idref" href="#status:37"><span class="id" title="binder">status</span></a> <a id="enc_ptr:38" class="idref" href="#enc_ptr:38"><span class="id" title="binder">enc_ptr</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cs0:39" class="idref" href="#cs0:39"><span class="id" title="binder">cs0</span></a> := <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="#cf:23"><span class="id" title="variable">cf</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#caller_stack:24"><span class="id" title="variable">caller_stack</span></a>) <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#in_ptr:31"><span class="id" title="variable">in_ptr</span></a>.(<a class="idref" href="#fp_page"><span class="id" title="projection">fp_page</span></a>) <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#page:33"><span class="id" title="variable">page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#page_older"><span class="id" title="definition">page_older</span></a> <a class="idref" href="#page:33"><span class="id" title="variable">page</span></a> (<a class="idref" href="#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a> <a class="idref" href="#cs0:39"><span class="id" title="variable">cs0</span></a>) <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#validate"><span class="id" title="definition">validate</span></a> <a class="idref" href="#in_ptr:31"><span class="id" title="variable">in_ptr</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#no_exceptions"><span class="id" title="definition">no_exceptions</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fat_ptr_narrow"><span class="id" title="definition">fat_ptr_narrow</span></a> <a class="idref" href="#in_ptr:31"><span class="id" title="variable">in_ptr</span></a> <a class="idref" href="#out_ptr:32"><span class="id" title="variable">out_ptr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_return_caller_and_drop"><span class="id" title="inductive">ergs_return_caller_and_drop</span></a> <a class="idref" href="#cs1:25"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#new_caller:26"><span class="id" title="variable">new_caller</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#params:34"><span class="id" title="variable">params</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#mk_params"><span class="id" title="constructor">FarRetABI.mk_params</span></a> (<a class="idref" href="#ForwardExistingFatPointer"><span class="id" title="constructor">ForwardExistingFatPointer</span></a> (<a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="#in_ptr:31"><span class="id" title="variable">in_ptr</span></a>)) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#enc_ptr:38"><span class="id" title="variable">enc_ptr</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#encode_fat_ptr_word"><span class="id" title="definition">encode_fat_ptr_word</span></a> <a class="idref" href="#zero128"><span class="id" title="definition">zero128</span></a> (<a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="#out_ptr:32"><span class="id" title="variable">out_ptr</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_regs:27"><span class="id" title="variable">new_regs</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="notation">(</span><a class="idref" href="#FarRetDefinition.reserve"><span class="id" title="variable">reserve</span></a> <a class="idref" href="#regs_state_zero"><span class="id" title="definition">regs_state_zero</span></a><span class="id" title="notation">)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation"><|</span> <a class="idref" href="#r1"><span class="id" title="projection">r1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#enc_ptr:38"><span class="id" title="variable">enc_ptr</span></a> <span class="id" title="notation">|></span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_transient_only"><span class="id" title="inductive">step_transient_only</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#___1:28"><span class="id" title="variable">___1</span></a> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#cs0:39"><span class="id" title="variable">cs0</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#___2:29"><span class="id" title="variable">___2</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#___3:30"><span class="id" title="variable">___3</span></a>;<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:22"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#status:37"><span class="id" title="variable">status</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags_clear"><span class="id" title="definition">flags_clear</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#new_caller:26"><span class="id" title="variable">new_caller</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#new_regs:27"><span class="id" title="variable">new_regs</span></a>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#zero128"><span class="id" title="definition">zero128</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:22"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#status:37"><span class="id" title="variable">status</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|} <a class="idref" href="#s1:35"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:36"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_farret:2"><span class="id" title="inductive">step_farret</span></a> (<a class="idref" href="#OpRet"><span class="id" title="constructor">OpRet</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#params:34"><span class="id" title="variable">params</span></a>))) <a class="idref" href="#s1:35"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:36"><span class="id" title="variable">s2</span></a><br/>
</div>

<div class="doc"><h2 id="panics">Panics</h2>
<ol type="1">
<li>Attempt to forward an existing fat pointer, but the value holding
<span class="inlinecode"><span class="id"
title="var">RetABI</span></span> is not tagged as a pointer.</li>
</ol>
</div>
<div class="code">
<br/>
<br/>
&nbsp;&nbsp;| <a id="step_RetExt_ForwardFatPointer_requires_ptrtag" class="idref" href="#step_RetExt_ForwardFatPointer_requires_ptrtag"><span class="id" title="constructor">step_RetExt_ForwardFatPointer_requires_ptrtag</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cf:40" class="idref" href="#cf:40"><span class="id" title="binder">cf</span></a> <a id="caller_stack:41" class="idref" href="#caller_stack:41"><span class="id" title="binder">caller_stack</span></a> <a id="params:42" class="idref" href="#params:42"><span class="id" title="binder">params</span></a> <a id="___1:43" class="idref" href="#___1:43"><span class="id" title="binder">___1</span></a> <a id="___2:44" class="idref" href="#___2:44"><span class="id" title="binder">___2</span></a> (<a id="s1:45" class="idref" href="#s1:45"><span class="id" title="binder">s1</span></a> <a id="s2:46" class="idref" href="#s2:46"><span class="id" title="binder">s2</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cs0:47" class="idref" href="#cs0:47"><span class="id" title="binder">cs0</span></a> := <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="#cf:40"><span class="id" title="variable">cf</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#caller_stack:41"><span class="id" title="variable">caller_stack</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s1:45"><span class="id" title="variable">s1</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#cs0:47"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#params:42"><span class="id" title="variable">params</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#mk_params"><span class="id" title="constructor">FarRetABI.mk_params</span></a> (<a class="idref" href="#ForwardExistingFatPointer"><span class="id" title="constructor">ForwardExistingFatPointer</span></a> <a class="idref" href="#___1:43"><span class="id" title="variable">___1</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#RetABIExistingFatPointerWithoutTag"><span class="id" title="constructor">RetABIExistingFatPointerWithoutTag</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#s1:45"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:46"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_farret:2"><span class="id" title="inductive">step_farret</span></a> (<a class="idref" href="#OpRet"><span class="id" title="constructor">OpRet</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#___2:44"><span class="id" title="variable">___2</span></a>))) <a class="idref" href="#s1:45"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:46"><span class="id" title="variable">s2</span></a><br/>
<br/>
</div>

<div class="doc"><ol start="2" type="1">
<li>Attempt to return a pointer created before the current callframe. It
is forbidden to pass a pointer to a contract in a far call and return it
back. Otherwise we could create a <span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span> <span
class="math inline">P</span> to a heap page of contract <span
class="math inline">A</span>, pass it to a contract <span
class="math inline">B</span>, return it back to <span
class="math inline">A</span>, and then modify the contents on the heap
page of <span class="math inline">A</span>. This way we will also modify
the memory <span class="inlinecode"><span class="id"
title="var">slice</span></span> associated with <span
class="math inline">P</span>.</li>
</ol>
<p>In other words, this is a situation where:</p>
<ul>
<li>caller makes far call to some contract;</li>
<li>callee does return-forward <span class="citation"
data-cites="calldataptr">@calldataptr</span>;</li>
<li>caller modifies calldata corresponding heap region, that leads to
modification of returndata.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_RetExt_ForwardFatPointer_returning_older_pointer" class="idref" href="#step_RetExt_ForwardFatPointer_returning_older_pointer"><span class="id" title="constructor">step_RetExt_ForwardFatPointer_returning_older_pointer</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cf:48" class="idref" href="#cf:48"><span class="id" title="binder">cf</span></a> <a id="caller_stack:49" class="idref" href="#caller_stack:49"><span class="id" title="binder">caller_stack</span></a> <a id="in_ptr:50" class="idref" href="#in_ptr:50"><span class="id" title="binder">in_ptr</span></a> <a id="page:51" class="idref" href="#page:51"><span class="id" title="binder">page</span></a> <a id="params:52" class="idref" href="#params:52"><span class="id" title="binder">params</span></a> (<a id="s1:53" class="idref" href="#s1:53"><span class="id" title="binder">s1</span></a> <a id="s2:54" class="idref" href="#s2:54"><span class="id" title="binder">s2</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>) <a id="_tag:55" class="idref" href="#_tag:55"><span class="id" title="binder">_tag</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cs0:56" class="idref" href="#cs0:56"><span class="id" title="binder">cs0</span></a> := <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="#cf:48"><span class="id" title="variable">cf</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#caller_stack:49"><span class="id" title="variable">caller_stack</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s1:53"><span class="id" title="variable">s1</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#cs0:56"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#in_ptr:50"><span class="id" title="variable">in_ptr</span></a>.(<a class="idref" href="#fp_page"><span class="id" title="projection">fp_page</span></a>) <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#page:51"><span class="id" title="variable">page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#page_older"><span class="id" title="definition">page_older</span></a> <a class="idref" href="#page:51"><span class="id" title="variable">page</span></a> (<a class="idref" href="#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a> <a class="idref" href="#cs0:56"><span class="id" title="variable">cs0</span></a>) <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#params:52"><span class="id" title="variable">params</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#mk_params"><span class="id" title="constructor">FarRetABI.mk_params</span></a> (<a class="idref" href="#ForwardExistingFatPointer"><span class="id" title="constructor">ForwardExistingFatPointer</span></a> (<a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="#in_ptr:50"><span class="id" title="variable">in_ptr</span></a>)) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#RetABIReturnsPointerCreatedByCaller"><span class="id" title="constructor">RetABIReturnsPointerCreatedByCaller</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#s1:53"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:54"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_farret:2"><span class="id" title="inductive">step_farret</span></a> (<a class="idref" href="#OpRet"><span class="id" title="constructor">OpRet</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#_tag:55"><span class="id" title="variable">_tag</span></a> <a class="idref" href="#params:52"><span class="id" title="variable">params</span></a>))) <a class="idref" href="#s1:53"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:54"><span class="id" title="variable">s2</span></a><br/>
</div>

<div class="doc"><ol start="3" type="1">
<li>Attempt to return a malformed pointer.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_RetExt_ForwardFatPointer_returning_malformed_pointer" class="idref" href="#step_RetExt_ForwardFatPointer_returning_malformed_pointer"><span class="id" title="constructor">step_RetExt_ForwardFatPointer_returning_malformed_pointer</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cf:57" class="idref" href="#cf:57"><span class="id" title="binder">cf</span></a> <a id="caller_stack:58" class="idref" href="#caller_stack:58"><span class="id" title="binder">caller_stack</span></a> <a id="_tag:59" class="idref" href="#_tag:59"><span class="id" title="binder">_tag</span></a> (<a id="in_ptr:60" class="idref" href="#in_ptr:60"><span class="id" title="binder">in_ptr</span></a>: <a class="idref" href="#fat_ptr"><span class="id" title="record">fat_ptr</span></a>) <a id="params:61" class="idref" href="#params:61"><span class="id" title="binder">params</span></a> (<a id="s1:62" class="idref" href="#s1:62"><span class="id" title="binder">s1</span></a> <a id="s2:63" class="idref" href="#s2:63"><span class="id" title="binder">s2</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>) ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cs0:64" class="idref" href="#cs0:64"><span class="id" title="binder">cs0</span></a> := <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="#cf:57"><span class="id" title="variable">cf</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#caller_stack:58"><span class="id" title="variable">caller_stack</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s1:62"><span class="id" title="variable">s1</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#cs0:64"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#validate"><span class="id" title="definition">validate</span></a> <a class="idref" href="#in_ptr:60"><span class="id" title="variable">in_ptr</span></a> <a class="idref" href="#::type_scope:x_'<>'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="#no_exceptions"><span class="id" title="definition">no_exceptions</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#params:61"><span class="id" title="variable">params</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#mk_params"><span class="id" title="constructor">FarRetABI.mk_params</span></a> (<a class="idref" href="#ForwardExistingFatPointer"><span class="id" title="constructor">ForwardExistingFatPointer</span></a> (<a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="#in_ptr:60"><span class="id" title="variable">in_ptr</span></a>)) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#FatPointerMalformed"><span class="id" title="constructor">FatPointerMalformed</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#s1:62"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:63"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_farret:2"><span class="id" title="inductive">step_farret</span></a> (<a class="idref" href="#OpRet"><span class="id" title="constructor">OpRet</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#_tag:59"><span class="id" title="variable">_tag</span></a> <a class="idref" href="#params:61"><span class="id" title="variable">params</span></a>))) <a class="idref" href="#s1:62"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:63"><span class="id" title="variable">s2</span></a><br/>
</div>

<div class="doc"><ol start="4" type="1">
<li>Attempt to return a new pointer but unable to pay for memory
growth.</li>
</ol>
</div>
<div class="code">
<br/>
| <a id="step_RetExt_heapvar_growth_unaffordable" class="idref" href="#step_RetExt_heapvar_growth_unaffordable"><span class="id" title="constructor">step_RetExt_heapvar_growth_unaffordable</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cf:65" class="idref" href="#cf:65"><span class="id" title="binder">cf</span></a> <a id="caller_stack:66" class="idref" href="#caller_stack:66"><span class="id" title="binder">caller_stack</span></a> <a id="_tag:67" class="idref" href="#_tag:67"><span class="id" title="binder">_tag</span></a> <a id="heap_type:68" class="idref" href="#heap_type:68"><span class="id" title="binder">heap_type</span></a> <a id="hspan:69" class="idref" href="#hspan:69"><span class="id" title="binder">hspan</span></a> <a id="params:70" class="idref" href="#params:70"><span class="id" title="binder">params</span></a> (<a id="s1:71" class="idref" href="#s1:71"><span class="id" title="binder">s1</span></a> <a id="s2:72" class="idref" href="#s2:72"><span class="id" title="binder">s2</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cs0:73" class="idref" href="#cs0:73"><span class="id" title="binder">cs0</span></a> := <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="#cf:65"><span class="id" title="variable">cf</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#caller_stack:66"><span class="id" title="variable">caller_stack</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s1:71"><span class="id" title="variable">s1</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#cs0:73"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#params:70"><span class="id" title="variable">params</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#mk_params"><span class="id" title="constructor">FarRetABI.mk_params</span></a> (<a class="idref" href="#ForwardNewFatPointer"><span class="id" title="constructor">ForwardNewFatPointer</span></a> <a class="idref" href="#heap_type:68"><span class="id" title="variable">heap_type</span></a> <a class="idref" href="#hspan:69"><span class="id" title="variable">hspan</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#growth_to_span_unaffordable"><span class="id" title="inductive">growth_to_span_unaffordable</span></a> <a class="idref" href="#cs0:73"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#heap_type:68"><span class="id" title="variable">heap_type</span></a> <a class="idref" href="#hspan:69"><span class="id" title="variable">hspan</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#FatPointerCreationUnaffordable"><span class="id" title="constructor">FatPointerCreationUnaffordable</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#s1:71"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:72"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_farret:2"><span class="id" title="inductive">step_farret</span></a> (<a class="idref" href="#OpRet"><span class="id" title="constructor">OpRet</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#_tag:67"><span class="id" title="variable">_tag</span></a> <a class="idref" href="#params:70"><span class="id" title="variable">params</span></a>))) <a class="idref" href="#s1:71"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:72"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#FarRetDefinition"><span class="id" title="section">FarRetDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.FarRevert</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span><br/>
<a class="idref" href="#"><span class="id" title="library">ABI</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">Bool</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">CallStack</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">Coder</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">Common</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">Flags</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">GPR</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">MemoryContext</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">MemoryManagement</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">Pointer</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">PrimitiveValue</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a><br/>
<a class="idref" href="#"><span class="id" title="library">State</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span><br/>
<a class="idref" href="#"><span class="id" title="module">ABI</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">FatPointerABI</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">Bool</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">CallStack</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">Coder</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">Common</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">Flags</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">GPR</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">MemoryContext</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">MemoryManagement</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">Pointer</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a><br/>
<span class="id" title="module">RecordSetNotations</span><br/>
<a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">State</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">StepPanic</span></a><br/>
.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="FarRevertDefinition" class="idref" href="#FarRevertDefinition"><span class="id" title="section">FarRevertDefinition</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Let</span> <a id="FarRevertDefinition.reserve" class="idref" href="#FarRevertDefinition.reserve"><span class="id" title="variable">reserve</span></a> <a id="regs:1" class="idref" href="#regs:1"><span class="id" title="binder">regs</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="#regs:1"><span class="id" title="variable">regs</span></a>    <span class="id" title="notation"><|</span> <a class="idref" href="#r2"><span class="id" title="projection">r2</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#reserved"><span class="id" title="definition">reserved</span></a> <span class="id" title="notation">|></span> <span class="id" title="notation"><|</span> <a class="idref" href="#r3"><span class="id" title="projection">r3</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#reserved"><span class="id" title="definition">reserved</span></a> <span class="id" title="notation">|></span> <span class="id" title="notation"><|</span> <a class="idref" href="#r4"><span class="id" title="projection">r4</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#reserved"><span class="id" title="definition">reserved</span></a> <span class="id" title="notation">|></span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_farrevert" class="idref" href="#step_farrevert"><span class="id" title="inductive">step_farrevert</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
&nbsp;&nbsp;</div>

<div class="doc"><h1 id="oprevert-case-of-far-revert">OpRevert (case of far revert)</h1>
<p>The near revert and far revert share the same syntax, but their
runtime semantic is different:</p>
<ul>
<li>if the topmost frame in callstack is <span
class="inlinecode"><a class="idref" href="#ExternalCall"><span
class="id" title="constructor">ExternalCall</span></a></span>, the far
revert semantic is selected (see <span
class="inlinecode"><a class="idref" href="#FarRevertDefinition"><span
class="id" title="section">FarRevertDefinition</span></a></span>);</li>
<li>if the topmost frame in callstack is <span
class="inlinecode"><a class="idref" href="#InternalCall"><span
class="id" title="constructor">InternalCall</span></a></span>, the near
revert semantic is selected (see <span
class="inlinecode"><a class="idref" href="#NearRevertDefinition"><span
class="id" title="section">NearRevertDefinition</span></a></span>).</li>
</ul>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpRevert"><span
class="id" title="constructor">OpRevert</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><p><code>rev in1</code></p></li>
<li><p><code>rev</code>, an alias to <code>rev r1</code>. Argument is
ignored for near reverts.</p></li>
</ul>
<h2 id="legacy-syntax">Legacy syntax</h2>
<ul>
<li><code>revert</code> is an alias for <code>revert r1</code></li>
<li><code>ret.revert in1</code></li>
</ul>
<h2 id="summary">Summary</h2>
<p>An abnormal return from a far call. Will pop up current callframe,
give back unspent ergs and execute a currently active exception handler.
The input register describes a slice of memory passed to the external
caller.</p>
<h2 id="semantic">Semantic</h2>
<p>Restores storage to the state before external call. 1. Let <span
class="math inline">E</span> be the address of the <span
class="inlinecode"><a class="idref" href="#active_exception_handler"><span
class="id"
title="definition">active_exception_handler</span></a></span>. 2.
Perform a <span
class="inlinecode"><a class="idref" href="#rollback"><span
class="id" title="inductive">rollback</span></a></span>. 3. Proceed with
the same steps as <span class="inlinecode"><span class="id"
title="var">OpFarRetABI</span></span> (see <span
class="inlinecode"><a class="idref" href="#step_farret"><span
class="id" title="inductive">step_farret</span></a></span>). 3. Set PC
to <span class="math inline">E</span>.</p>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
<li>Execution stack:
<ul>
<li>Current frame is dropped.</li>
<li>Caller frame:
<ul>
<li>if a label is explicitly provided, and current frame is internal
(near call), then caller’s PC is overwritten with the label. Returns
from external calls ignore label, even if it is explicitly
provided.</li>
<li>Unspent ergs are given back to caller (but memory growth is paid
first).</li>
</ul></li>
</ul></li>
<li>Storage changes are reverted.</li>
<li>Flags are cleared.</li>
<li>Context register is zeroed (only reverts from far calls).</li>
<li>Registers are cleared (only reverts from far calls).</li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Abnormal returns from near/far calls when a recoverable error
happened. Use <code>panic</code> for irrecoverable errors.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#OpRet"><span
class="id" title="constructor">OpRet</span></a></span> returns to the
caller instead of executing an exception handler.</li>
<li><span
class="inlinecode"><a class="idref" href="#OpPanic"><span
class="id" title="constructor">OpPanic</span></a></span> acts similarly
to <span
class="inlinecode"><a class="idref" href="#OpRevert"><span
class="id" title="constructor">OpRevert</span></a></span> but does not
pass any data to the caller frame and sets an overflow flag.</li>
</ul>
</div>
<div class="code">
<br/>
<br/>
&nbsp;&nbsp;| <a id="step_RevertExt_heapvar" class="idref" href="#step_RevertExt_heapvar"><span class="id" title="constructor">step_RevertExt_heapvar</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="gs:4" class="idref" href="#gs:4"><span class="id" title="binder">gs</span></a> <a id="gs':5" class="idref" href="#gs':5"><span class="id" title="binder">gs'</span></a> <a id="pages:6" class="idref" href="#pages:6"><span class="id" title="binder">pages</span></a> <a id="cf:7" class="idref" href="#cf:7"><span class="id" title="binder">cf</span></a> <a id="caller_stack:8" class="idref" href="#caller_stack:8"><span class="id" title="binder">caller_stack</span></a> <a id="cs1:9" class="idref" href="#cs1:9"><span class="id" title="binder">cs1</span></a> <a id="cs2:10" class="idref" href="#cs2:10"><span class="id" title="binder">cs2</span></a> <a id="new_caller:11" class="idref" href="#new_caller:11"><span class="id" title="binder">new_caller</span></a> <a id="new_regs:12" class="idref" href="#new_regs:12"><span class="id" title="binder">new_regs</span></a> <a id="params:13" class="idref" href="#params:13"><span class="id" title="binder">params</span></a> <a id="out_ptr:14" class="idref" href="#out_ptr:14"><span class="id" title="binder">out_ptr</span></a> <a id="heap_type:15" class="idref" href="#heap_type:15"><span class="id" title="binder">heap_type</span></a> <a id="hspan:16" class="idref" href="#hspan:16"><span class="id" title="binder">hspan</span></a> <a id="___2:17" class="idref" href="#___2:17"><span class="id" title="binder">___2</span></a> <a id="___3:18" class="idref" href="#___3:18"><span class="id" title="binder">___3</span></a> <a id="___4:19" class="idref" href="#___4:19"><span class="id" title="binder">___4</span></a> <a id="_tag:20" class="idref" href="#_tag:20"><span class="id" title="binder">_tag</span></a> <a id="ptr_enc:21" class="idref" href="#ptr_enc:21"><span class="id" title="binder">ptr_enc</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cs0:22" class="idref" href="#cs0:22"><span class="id" title="binder">cs0</span></a> := <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="#cf:7"><span class="id" title="variable">cf</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#caller_stack:8"><span class="id" title="variable">caller_stack</span></a>) <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#params:13"><span class="id" title="variable">params</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ForwardNewFatPointer"><span class="id" title="constructor">ForwardNewFatPointer</span></a> <a class="idref" href="#heap_type:15"><span class="id" title="variable">heap_type</span></a> <a class="idref" href="#hspan:16"><span class="id" title="variable">hspan</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#paid_forward_new_fat_ptr"><span class="id" title="inductive">paid_forward_new_fat_ptr</span></a> <a class="idref" href="#heap_type:15"><span class="id" title="variable">heap_type</span></a> <a class="idref" href="#hspan:16"><span class="id" title="variable">hspan</span></a> <a class="idref" href="#cs0:22"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#out_ptr:14"><span class="id" title="variable">out_ptr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#cs1:9"><span class="id" title="variable">cs1</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_return_caller_and_drop"><span class="id" title="inductive">ergs_return_caller_and_drop</span></a> <a class="idref" href="#cs1:9"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#cs2:10"><span class="id" title="variable">cs2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_caller:11"><span class="id" title="variable">new_caller</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#pc_set"><span class="id" title="definition">pc_set</span></a> (<a class="idref" href="#active_exception_handler"><span class="id" title="definition">active_exception_handler</span></a> <a class="idref" href="#cs0:22"><span class="id" title="variable">cs0</span></a>) <a class="idref" href="#cs2:10"><span class="id" title="variable">cs2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#rollback"><span class="id" title="inductive">rollback</span></a> <a class="idref" href="#cf:7"><span class="id" title="variable">cf</span></a>.(<a class="idref" href="#cf_saved_checkpoint"><span class="id" title="projection">cf_saved_checkpoint</span></a>) <a class="idref" href="#gs:4"><span class="id" title="variable">gs</span></a> <a class="idref" href="#gs':5"><span class="id" title="variable">gs'</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#ptr_enc:21"><span class="id" title="variable">ptr_enc</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#encode_fat_ptr_word"><span class="id" title="definition">encode_fat_ptr_word</span></a> <a class="idref" href="#zero128"><span class="id" title="definition">zero128</span></a> (<a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="#out_ptr:14"><span class="id" title="variable">out_ptr</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_regs:12"><span class="id" title="variable">new_regs</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#FarRevertDefinition.reserve"><span class="id" title="variable">reserve</span></a> (<a class="idref" href="#regs_state_zero"><span class="id" title="definition">regs_state_zero</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#r1"><span class="id" title="projection">r1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#ptr_enc:21"><span class="id" title="variable">ptr_enc</span></a> <span class="id" title="notation">|></span> )<a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_farrevert:2"><span class="id" title="inductive">step_farrevert</span></a> (<a class="idref" href="#OpRevert"><span class="id" title="constructor">OpRevert</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#_tag:20"><span class="id" title="variable">_tag</span></a> (<a class="idref" href="#mk_params"><span class="id" title="constructor">FarRetABI.mk_params</span></a> <a class="idref" href="#params:13"><span class="id" title="variable">params</span></a>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#___2:17"><span class="id" title="variable">___2</span></a> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#cs0:22"><span class="id" title="variable">cs0</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#___3:18"><span class="id" title="variable">___3</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#___4:19"><span class="id" title="variable">___4</span></a>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:6"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>       := <a class="idref" href="#gs:4"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags_clear"><span class="id" title="definition">flags_clear</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#new_caller:11"><span class="id" title="variable">new_caller</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#new_regs:12"><span class="id" title="variable">new_regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#zero128"><span class="id" title="definition">zero128</span></a>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:6"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>       := <a class="idref" href="#gs':5"><span class="id" title="variable">gs'</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;| <a id="step_RevertExt_ForwardFatPointer" class="idref" href="#step_RevertExt_ForwardFatPointer"><span class="id" title="constructor">step_RevertExt_ForwardFatPointer</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="pages:23" class="idref" href="#pages:23"><span class="id" title="binder">pages</span></a> <a id="cf:24" class="idref" href="#cf:24"><span class="id" title="binder">cf</span></a> <a id="caller_stack:25" class="idref" href="#caller_stack:25"><span class="id" title="binder">caller_stack</span></a> <a id="cs1:26" class="idref" href="#cs1:26"><span class="id" title="binder">cs1</span></a> <a id="cs2:27" class="idref" href="#cs2:27"><span class="id" title="binder">cs2</span></a> <a id="new_caller:28" class="idref" href="#new_caller:28"><span class="id" title="binder">new_caller</span></a> <a id="new_regs:29" class="idref" href="#new_regs:29"><span class="id" title="binder">new_regs</span></a> <a id="___2:30" class="idref" href="#___2:30"><span class="id" title="binder">___2</span></a> <a id="___3:31" class="idref" href="#___3:31"><span class="id" title="binder">___3</span></a> <a id="___4:32" class="idref" href="#___4:32"><span class="id" title="binder">___4</span></a> <a id="in_ptr:33" class="idref" href="#in_ptr:33"><span class="id" title="binder">in_ptr</span></a> <a id="out_ptr:34" class="idref" href="#out_ptr:34"><span class="id" title="binder">out_ptr</span></a> <a id="page:35" class="idref" href="#page:35"><span class="id" title="binder">page</span></a> <a id="params:36" class="idref" href="#params:36"><span class="id" title="binder">params</span></a> <a id="gs:37" class="idref" href="#gs:37"><span class="id" title="binder">gs</span></a> <a id="gs':38" class="idref" href="#gs':38"><span class="id" title="binder">gs'</span></a> <a id="ptr_enc:39" class="idref" href="#ptr_enc:39"><span class="id" title="binder">ptr_enc</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cs0:40" class="idref" href="#cs0:40"><span class="id" title="binder">cs0</span></a> := <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="#cf:24"><span class="id" title="variable">cf</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#caller_stack:25"><span class="id" title="variable">caller_stack</span></a>) <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Panic&nbsp;if&nbsp;not&nbsp;a&nbsp;pointer&nbsp;*)</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#params:36"><span class="id" title="variable">params</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ForwardExistingFatPointer"><span class="id" title="constructor">ForwardExistingFatPointer</span></a> (<a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="#in_ptr:33"><span class="id" title="variable">in_ptr</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#in_ptr:33"><span class="id" title="variable">in_ptr</span></a>.(<a class="idref" href="#fp_page"><span class="id" title="projection">fp_page</span></a>) <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#page:35"><span class="id" title="variable">page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#page_older"><span class="id" title="definition">MemoryContext.page_older</span></a> <a class="idref" href="#page:35"><span class="id" title="variable">page</span></a> (<a class="idref" href="#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a> <a class="idref" href="#cs0:40"><span class="id" title="variable">cs0</span></a>) <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#validate"><span class="id" title="definition">validate</span></a> <a class="idref" href="#in_ptr:33"><span class="id" title="variable">in_ptr</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#no_exceptions"><span class="id" title="definition">no_exceptions</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fat_ptr_narrow"><span class="id" title="definition">fat_ptr_narrow</span></a> <a class="idref" href="#in_ptr:33"><span class="id" title="variable">in_ptr</span></a> <a class="idref" href="#out_ptr:34"><span class="id" title="variable">out_ptr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_return_caller_and_drop"><span class="id" title="inductive">ergs_return_caller_and_drop</span></a> <a class="idref" href="#cs1:26"><span class="id" title="variable">cs1</span></a> <a class="idref" href="#cs2:27"><span class="id" title="variable">cs2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_caller:28"><span class="id" title="variable">new_caller</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#pc_set"><span class="id" title="definition">pc_set</span></a> (<a class="idref" href="#active_exception_handler"><span class="id" title="definition">active_exception_handler</span></a> <a class="idref" href="#cs0:40"><span class="id" title="variable">cs0</span></a>) <a class="idref" href="#cs2:27"><span class="id" title="variable">cs2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#ptr_enc:39"><span class="id" title="variable">ptr_enc</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#encode_fat_ptr_word"><span class="id" title="definition">encode_fat_ptr_word</span></a> <a class="idref" href="#zero128"><span class="id" title="definition">zero128</span></a> (<a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="#out_ptr:34"><span class="id" title="variable">out_ptr</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_regs:29"><span class="id" title="variable">new_regs</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="notation">(</span><a class="idref" href="#FarRevertDefinition.reserve"><span class="id" title="variable">reserve</span></a> <a class="idref" href="#regs_state_zero"><span class="id" title="definition">regs_state_zero</span></a><span class="id" title="notation">)</span> <span class="id" title="notation"><|</span> <a class="idref" href="#r1"><span class="id" title="projection">r1</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#ptr_enc:39"><span class="id" title="variable">ptr_enc</span></a> <span class="id" title="notation">|></span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#rollback"><span class="id" title="inductive">rollback</span></a> <a class="idref" href="#cf:24"><span class="id" title="variable">cf</span></a>.(<a class="idref" href="#cf_saved_checkpoint"><span class="id" title="projection">cf_saved_checkpoint</span></a>) <a class="idref" href="#gs:37"><span class="id" title="variable">gs</span></a> <a class="idref" href="#gs':38"><span class="id" title="variable">gs'</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_farrevert:2"><span class="id" title="inductive">step_farrevert</span></a> (<a class="idref" href="#OpRevert"><span class="id" title="constructor">OpRevert</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> (<a class="idref" href="#mk_params"><span class="id" title="constructor">FarRetABI.mk_params</span></a> <a class="idref" href="#params:36"><span class="id" title="variable">params</span></a>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#___2:30"><span class="id" title="variable">___2</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#cs0:40"><span class="id" title="variable">cs0</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#___3:31"><span class="id" title="variable">___3</span></a> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#___4:32"><span class="id" title="variable">___4</span></a>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:23"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>       := <a class="idref" href="#gs:37"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags_clear"><span class="id" title="definition">flags_clear</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#new_caller:28"><span class="id" title="variable">new_caller</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#new_regs:29"><span class="id" title="variable">new_regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#zero128"><span class="id" title="definition">zero128</span></a>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:23"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>       := <a class="idref" href="#gs':38"><span class="id" title="variable">gs'</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
<br/>
</div>

<div class="doc"><h2 id="panics">Panics</h2>
<ol type="1">
<li>Attempt to forward an existing fat pointer, but the value holding
<span class="inlinecode"><span class="id"
title="var">RetABI</span></span> is not tagged as a pointer.</li>
</ol>
</div>
<div class="code">
<br/>
<br/>
&nbsp;&nbsp;| <a id="step_RevertExt_ForwardFatPointer_requires_ptrtag" class="idref" href="#step_RevertExt_ForwardFatPointer_requires_ptrtag"><span class="id" title="constructor">step_RevertExt_ForwardFatPointer_requires_ptrtag</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cf:41" class="idref" href="#cf:41"><span class="id" title="binder">cf</span></a> <a id="caller_stack:42" class="idref" href="#caller_stack:42"><span class="id" title="binder">caller_stack</span></a> <a id="__:43" class="idref" href="#__:43"><span class="id" title="binder">__</span></a> <a id="params:44" class="idref" href="#params:44"><span class="id" title="binder">params</span></a> (<a id="s1:45" class="idref" href="#s1:45"><span class="id" title="binder">s1</span></a> <a id="s2:46" class="idref" href="#s2:46"><span class="id" title="binder">s2</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cs0:47" class="idref" href="#cs0:47"><span class="id" title="binder">cs0</span></a> := <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="#cf:41"><span class="id" title="variable">cf</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#caller_stack:42"><span class="id" title="variable">caller_stack</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s1:45"><span class="id" title="variable">s1</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#cs0:47"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#params:44"><span class="id" title="variable">params</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#mk_params"><span class="id" title="constructor">FarRetABI.mk_params</span></a> (<a class="idref" href="#ForwardExistingFatPointer"><span class="id" title="constructor">ForwardExistingFatPointer</span></a> <a class="idref" href="#__:43"><span class="id" title="variable">__</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#RetABIExistingFatPointerWithoutTag"><span class="id" title="constructor">RetABIExistingFatPointerWithoutTag</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#s1:45"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:46"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_farrevert:2"><span class="id" title="inductive">step_farrevert</span></a> (<a class="idref" href="#OpRevert"><span class="id" title="constructor">OpRevert</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#params:44"><span class="id" title="variable">params</span></a>))) <a class="idref" href="#s1:45"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:46"><span class="id" title="variable">s2</span></a><br/>
<br/>
</div>

<div class="doc"><ol start="2" type="1">
<li>Attempt to return a pointer created before the current callframe. It
is forbidden to pass a pointer to a contract in a far call and return it
back. Otherwise we could create a <span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span> <span
class="math inline">P</span> to a heap page of contract <span
class="math inline">A</span>, pass it to a contract <span
class="math inline">B</span>, return it back to <span
class="math inline">A</span>, and then modify the contents on the heap
page of <span class="math inline">A</span>. This way we will also modify
the memory <span class="inlinecode"><span class="id"
title="var">slice</span></span> associated with <span
class="math inline">P</span>.</li>
</ol>
<p>In other words, this is a situation where:</p>
<ul>
<li>caller makes far call to some contract;</li>
<li>callee does return-forward <span class="citation"
data-cites="calldataptr">@calldataptr</span>;</li>
<li>caller modifies calldata corresponding heap region, that leads to
modification of returndata.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_RevertExt_ForwardFatPointer_returning_older_pointer" class="idref" href="#step_RevertExt_ForwardFatPointer_returning_older_pointer"><span class="id" title="constructor">step_RevertExt_ForwardFatPointer_returning_older_pointer</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cf:48" class="idref" href="#cf:48"><span class="id" title="binder">cf</span></a> <a id="caller_stack:49" class="idref" href="#caller_stack:49"><span class="id" title="binder">caller_stack</span></a> <a id="in_ptr:50" class="idref" href="#in_ptr:50"><span class="id" title="binder">in_ptr</span></a> <a id="page:51" class="idref" href="#page:51"><span class="id" title="binder">page</span></a> <a id="params:52" class="idref" href="#params:52"><span class="id" title="binder">params</span></a> (<a id="s1:53" class="idref" href="#s1:53"><span class="id" title="binder">s1</span></a> <a id="s2:54" class="idref" href="#s2:54"><span class="id" title="binder">s2</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>) ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cs0:55" class="idref" href="#cs0:55"><span class="id" title="binder">cs0</span></a> := <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="#cf:48"><span class="id" title="variable">cf</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#caller_stack:49"><span class="id" title="variable">caller_stack</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s1:53"><span class="id" title="variable">s1</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#cs0:55"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#in_ptr:50"><span class="id" title="variable">in_ptr</span></a>.(<a class="idref" href="#fp_page"><span class="id" title="projection">fp_page</span></a>) <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#page:51"><span class="id" title="variable">page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#page_older"><span class="id" title="definition">page_older</span></a> <a class="idref" href="#page:51"><span class="id" title="variable">page</span></a> (<a class="idref" href="#get_mem_ctx"><span class="id" title="definition">get_mem_ctx</span></a> <a class="idref" href="#cs0:55"><span class="id" title="variable">cs0</span></a>) <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#params:52"><span class="id" title="variable">params</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#mk_params"><span class="id" title="constructor">FarRetABI.mk_params</span></a> (<a class="idref" href="#ForwardExistingFatPointer"><span class="id" title="constructor">ForwardExistingFatPointer</span></a> (<a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="#in_ptr:50"><span class="id" title="variable">in_ptr</span></a>)) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#RetABIReturnsPointerCreatedByCaller"><span class="id" title="constructor">RetABIReturnsPointerCreatedByCaller</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#s1:53"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:54"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_farrevert:2"><span class="id" title="inductive">step_farrevert</span></a> (<a class="idref" href="#OpRevert"><span class="id" title="constructor">OpRevert</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#params:52"><span class="id" title="variable">params</span></a>))) <a class="idref" href="#s1:53"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:54"><span class="id" title="variable">s2</span></a><br/>
</div>

<div class="doc"><ol start="3" type="1">
<li>Attempt to return a malformed pointer.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_RevertExt_ForwardFatPointer_returning_malformed_pointer" class="idref" href="#step_RevertExt_ForwardFatPointer_returning_malformed_pointer"><span class="id" title="constructor">step_RevertExt_ForwardFatPointer_returning_malformed_pointer</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cf:56" class="idref" href="#cf:56"><span class="id" title="binder">cf</span></a> <a id="caller_stack:57" class="idref" href="#caller_stack:57"><span class="id" title="binder">caller_stack</span></a> (<a id="in_ptr:58" class="idref" href="#in_ptr:58"><span class="id" title="binder">in_ptr</span></a>: <a class="idref" href="#fat_ptr"><span class="id" title="record">fat_ptr</span></a>) <a id="params:59" class="idref" href="#params:59"><span class="id" title="binder">params</span></a> (<a id="s1:60" class="idref" href="#s1:60"><span class="id" title="binder">s1</span></a> <a id="s2:61" class="idref" href="#s2:61"><span class="id" title="binder">s2</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>) ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cs0:62" class="idref" href="#cs0:62"><span class="id" title="binder">cs0</span></a> := <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="#cf:56"><span class="id" title="variable">cf</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#caller_stack:57"><span class="id" title="variable">caller_stack</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s1:60"><span class="id" title="variable">s1</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#cs0:62"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#validate"><span class="id" title="definition">validate</span></a> <a class="idref" href="#in_ptr:58"><span class="id" title="variable">in_ptr</span></a> <a class="idref" href="#::type_scope:x_'<>'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="#no_exceptions"><span class="id" title="definition">no_exceptions</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#params:59"><span class="id" title="variable">params</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#mk_params"><span class="id" title="constructor">FarRetABI.mk_params</span></a> (<a class="idref" href="#ForwardExistingFatPointer"><span class="id" title="constructor">ForwardExistingFatPointer</span></a> (<a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="#in_ptr:58"><span class="id" title="variable">in_ptr</span></a>)) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#FatPointerMalformed"><span class="id" title="constructor">FatPointerMalformed</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#s1:60"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:61"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_farrevert:2"><span class="id" title="inductive">step_farrevert</span></a> (<a class="idref" href="#OpRevert"><span class="id" title="constructor">OpRevert</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#params:59"><span class="id" title="variable">params</span></a>))) <a class="idref" href="#s1:60"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:61"><span class="id" title="variable">s2</span></a><br/>
</div>

<div class="doc"><ol start="4" type="1">
<li>Attempt to return a new pointer but unable to pay for memory
growth.</li>
</ol>
</div>
<div class="code">
<br/>
| <a id="step_RevertExt_heapvar_growth_unaffordable" class="idref" href="#step_RevertExt_heapvar_growth_unaffordable"><span class="id" title="constructor">step_RevertExt_heapvar_growth_unaffordable</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cf:63" class="idref" href="#cf:63"><span class="id" title="binder">cf</span></a> <a id="caller_stack:64" class="idref" href="#caller_stack:64"><span class="id" title="binder">caller_stack</span></a> <a id="heap_type:65" class="idref" href="#heap_type:65"><span class="id" title="binder">heap_type</span></a> <a id="hspan:66" class="idref" href="#hspan:66"><span class="id" title="binder">hspan</span></a> <a id="params:67" class="idref" href="#params:67"><span class="id" title="binder">params</span></a> (<a id="s1:68" class="idref" href="#s1:68"><span class="id" title="binder">s1</span></a> <a id="s2:69" class="idref" href="#s2:69"><span class="id" title="binder">s2</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cs0:70" class="idref" href="#cs0:70"><span class="id" title="binder">cs0</span></a> := <a class="idref" href="#ExternalCall"><span class="id" title="constructor">ExternalCall</span></a> <a class="idref" href="#cf:63"><span class="id" title="variable">cf</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#caller_stack:64"><span class="id" title="variable">caller_stack</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s1:68"><span class="id" title="variable">s1</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#cs0:70"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#params:67"><span class="id" title="variable">params</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#mk_params"><span class="id" title="constructor">FarRetABI.mk_params</span></a> (<a class="idref" href="#ForwardNewFatPointer"><span class="id" title="constructor">ForwardNewFatPointer</span></a> <a class="idref" href="#heap_type:65"><span class="id" title="variable">heap_type</span></a> <a class="idref" href="#hspan:66"><span class="id" title="variable">hspan</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#growth_to_span_unaffordable"><span class="id" title="inductive">growth_to_span_unaffordable</span></a> <a class="idref" href="#cs0:70"><span class="id" title="variable">cs0</span></a> <a class="idref" href="#heap_type:65"><span class="id" title="variable">heap_type</span></a> <a class="idref" href="#hspan:66"><span class="id" title="variable">hspan</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#FatPointerCreationUnaffordable"><span class="id" title="constructor">FatPointerCreationUnaffordable</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#s1:68"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:69"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_farrevert:2"><span class="id" title="inductive">step_farrevert</span></a> (<a class="idref" href="#OpRevert"><span class="id" title="constructor">OpRevert</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#params:67"><span class="id" title="variable">params</span></a>))) <a class="idref" href="#s1:68"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:69"><span class="id" title="variable">s2</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#FarRevertDefinition"><span class="id" title="section">FarRevertDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.LoadPtr</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="library">Slice</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryOps</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">Slice</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="LoadPtrDefinition" class="idref" href="#LoadPtrDefinition"><span class="id" title="section">LoadPtrDefinition</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_load_ptr" class="idref" href="#step_load_ptr"><span class="id" title="inductive">step_load_ptr</span></a> : <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#tsmallstep"><span class="id" title="definition">tsmallstep</span></a> :=<br/>
<br/>
&nbsp;</div>

<div class="doc"><h1 id="oploadptr">OpLoadPtr</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpLoadPtr"><span
class="id" title="constructor">OpLoadPtr</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_regimm"><span
class="id" title="inductive">in_regimm</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>ldp in1, out1</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<ul>
<li><code>uma.fat_ptr_read in1, out</code> aliased as
<code>ld in1, out</code></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Read 32 consecutive bytes from address provided by a fat pointer
<code>ptr</code> of active <code>heap</code> or <code>aux_heap</code>
page as a 256-bit word, Big Endian. Reading bytes past the slice bound
yields zero bytes.</p>
<h2 id="semantic">Semantic</h2>
<ol type="1">
<li><p>Let <code>in_ptr = (page, start, offset, length)</code> be a
<span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span> decoded from
<code>in1</code>. Requires that <code>in1</code> is tagged as a
pointer.</p></li>
<li><p>Validate that offset is in bounds:
<code>offset &lt; length</code>.</p></li>
<li><p>Read 32 consecutive bytes as a Big Endian 256-bit word from
address <code>offset</code> in heap variant.</p>
<p>Reading bytes past <code>start + length</code> returns zero bytes.
For example, consider a pointer with:</p>
<pre><code>{|
page   := _;
start  := 0;
length := 5;
offset := 2
|}</code></pre>
<p>Reading will produce a word with 3 most significant bytes read from
memory fairly (addresses 2, 3, 4) and 29 zero bytes coming from
attempted reads past <code>fp_start + fp_length</code> bound.</p></li>
<li><p>Store the word to <code>res</code>.</p></li>
</ol>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, because <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
<li>execution stack:
<ul>
<li>ergs allocated for the current function/contract instance, if the
heap variant has to be grown;</li>
<li>heap variant bounds, if heap variant has to be grown.</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Read data from a read-only slice returned from a far call, or passed
to a far call.</li>
<li>One of few instructions that accept only reg or imm operand but do
not have full addressing mode, therefore can’t e.g. address stack. The
full list is: {INSNS_USE_REGIMM}.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<p>See <span class="inlinecode"><span class="id"
title="var">OpLoadPtrInc</span></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_LoadPointer" class="idref" href="#step_LoadPointer"><span class="id" title="constructor">step_LoadPointer</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="result:3" class="idref" href="#result:3"><span class="id" title="binder">result</span></a> <a id="_flags:4" class="idref" href="#_flags:4"><span class="id" title="binder">_flags</span></a> <a id="_regs:5" class="idref" href="#_regs:5"><span class="id" title="binder">_regs</span></a> <a id="mem:6" class="idref" href="#mem:6"><span class="id" title="binder">mem</span></a> <a id="_cs:7" class="idref" href="#_cs:7"><span class="id" title="binder">_cs</span></a> <a id="_ctx:8" class="idref" href="#_ctx:8"><span class="id" title="binder">_ctx</span></a> <a id="addr:9" class="idref" href="#addr:9"><span class="id" title="binder">addr</span></a> <a id="selected_page:10" class="idref" href="#selected_page:10"><span class="id" title="binder">selected_page</span></a> (<a id="in_ptr:11" class="idref" href="#in_ptr:11"><span class="id" title="binder">in_ptr</span></a>:<a class="idref" href="#fat_ptr"><span class="id" title="record">fat_ptr</span></a>) <a id="slice:12" class="idref" href="#slice:12"><span class="id" title="binder">slice</span></a> <a id="page_id:13" class="idref" href="#page_id:13"><span class="id" title="binder">page_id</span></a> <a id="high128:14" class="idref" href="#high128:14"><span class="id" title="binder">high128</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#validate_in_bounds"><span class="id" title="definition">validate_in_bounds</span></a> <a class="idref" href="#in_ptr:11"><span class="id" title="variable">in_ptr</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#page_id:13"><span class="id" title="variable">page_id</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#in_ptr:11"><span class="id" title="variable">in_ptr</span></a>.(<a class="idref" href="#fp_page"><span class="id" title="projection">fp_page</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#page_has_id"><span class="id" title="definition">page_has_id</span></a> <a class="idref" href="#mem:6"><span class="id" title="variable">mem</span></a> <a class="idref" href="#page_id:13"><span class="id" title="variable">page_id</span></a> (<a class="idref" href="#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="#DataPage"><span class="id" title="constructor">DataPage</span></a> <a class="idref" href="#selected_page:10"><span class="id" title="variable">selected_page</span></a>)) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#slice_page"><span class="id" title="inductive">slice_page</span></a> <a class="idref" href="#selected_page:10"><span class="id" title="variable">selected_page</span></a> <a class="idref" href="#in_ptr:11"><span class="id" title="variable">in_ptr</span></a> <a class="idref" href="#slice:12"><span class="id" title="variable">slice</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ptr_resolves_to"><span class="id" title="inductive">ptr_resolves_to</span></a> <a class="idref" href="#in_ptr:11"><span class="id" title="variable">in_ptr</span></a> <a class="idref" href="#addr:9"><span class="id" title="variable">addr</span></a>  <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mb_load_slice_result"><span class="id" title="inductive">mb_load_slice_result</span></a> <a class="idref" href="#BigEndian"><span class="id" title="constructor">BigEndian</span></a> <a class="idref" href="#slice:12"><span class="id" title="variable">slice</span></a> <a class="idref" href="#addr:9"><span class="id" title="variable">addr</span></a> <a class="idref" href="#result:3"><span class="id" title="variable">result</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_load_ptr:1"><span class="id" title="inductive">step_load_ptr</span></a> (<a class="idref" href="#OpLoadPointer"><span class="id" title="constructor">OpLoadPointer</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high128:14"><span class="id" title="variable">high128</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="#in_ptr:11"><span class="id" title="variable">in_ptr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#result:3"><span class="id" title="variable">result</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#mk_transient_state"><span class="id" title="constructor">mk_transient_state</span></a> <a class="idref" href="#_flags:4"><span class="id" title="variable">_flags</span></a> <a class="idref" href="#_regs:5"><span class="id" title="variable">_regs</span></a> <a class="idref" href="#mem:6"><span class="id" title="variable">mem</span></a> <a class="idref" href="#_cs:7"><span class="id" title="variable">_cs</span></a> <a class="idref" href="#_ctx:8"><span class="id" title="variable">_ctx</span></a> <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#mk_transient_state"><span class="id" title="constructor">mk_transient_state</span></a> <a class="idref" href="#_flags:4"><span class="id" title="variable">_flags</span></a> <a class="idref" href="#_regs:5"><span class="id" title="variable">_regs</span></a> <a class="idref" href="#mem:6"><span class="id" title="variable">mem</span></a> <a class="idref" href="#_cs:7"><span class="id" title="variable">_cs</span></a> <a class="idref" href="#_ctx:8"><span class="id" title="variable">_ctx</span></a> <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>)<br/>
</div>

<div class="doc"><h2 id="panics">Panics</h2>
<ol type="1">
<li>Argument is not a tagged pointer.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_LoadPointer_not_tagged" class="idref" href="#step_LoadPointer_not_tagged"><span class="id" title="constructor">step_LoadPointer_not_tagged</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="___:15" class="idref" href="#___:15"><span class="id" title="binder">___</span></a> <a id="____:16" class="idref" href="#____:16"><span class="id" title="binder">____</span></a> (<a id="s1:17" class="idref" href="#s1:17"><span class="id" title="binder">s1</span></a> <a id="s2:18" class="idref" href="#s2:18"><span class="id" title="binder">s2</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#ExpectedFatPointer"><span class="id" title="constructor">ExpectedFatPointer</span></a> <a class="idref" href="#s1:17"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:18"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_load_ptr:1"><span class="id" title="inductive">step_load_ptr</span></a> (<a class="idref" href="#OpLoadPointer"><span class="id" title="constructor">OpLoadPointer</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#___:15"><span class="id" title="variable">___</span></a>)) <a class="idref" href="#____:16"><span class="id" title="variable">____</span></a>) <a class="idref" href="#s1:17"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:18"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#LoadPtrDefinition"><span class="id" title="section">LoadPtrDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.LoadPtrInc</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="library">Slice</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Arith</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryOps</span></a> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">Slice</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="LoadPtrIncDefinition" class="idref" href="#LoadPtrIncDefinition"><span class="id" title="section">LoadPtrIncDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
</div>

<div class="doc"><h1 id="oploadptrinc">OpLoadPtrInc</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span class="inlinecode"><span class="id"
title="var">OpLoadPtrInc</span></span> <span class="inlinecode">(<span
class="id" title="var">in1</span>:</span> <span
class="inlinecode"><a class="idref" href="#in_regimm"><span
class="id" title="inductive">in_regimm</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>ldpi in1, out1, out2</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<ul>
<li><code>uma.fat_ptr_read.inc in1, out</code> aliased as
<code>ld.inc in1, out</code></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Read 32 consecutive bytes from address provided by a fat pointer
<code>ptr</code> of active <code>heap</code> or <code>aux_heap</code>
page as a 256-bit word, Big Endian. Reading bytes past the slice bound
yields zero bytes.</p>
<p>Additionally, store a pointer to the next word to
<code>inc_ptr</code> register.</p>
<h2 id="semantic">Semantic</h2>
<ol type="1">
<li><p>Let <code>in_ptr = (page, start, offset, length)</code> be a
<span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span> decoded from
<code>in1</code>. Requires that <code>in1</code> is tagged as a
pointer.</p></li>
<li><p>Validate that offset is in bounds:
<code>offset &lt; length</code>.</p></li>
<li><p>Read 32 consecutive bytes as a Big Endian 256-bit word from
address <code>offset</code> in heap variant.</p>
<p>Reading bytes past <code>start + length</code> returns zero bytes.
For example, consider a pointer with:</p>
<pre><code>{|
page   := _;
start  := 0;
length := 5;
offset := 2
|}</code></pre>
<p>Reading will produce a word with 3 most significant bytes read from
memory fairly (addresses 2, 3, 4) and 29 zero bytes coming from
attempted reads past <code>fp_start + fp_length</code> bound.</p></li>
<li><p>Store the word to <code>res</code>.</p></li>
<li><p>Store an encoded fat pointer to the next 32-byte word in heap
variant in <code>inc_ptr</code>. Its fields are assigned as follows:</p>
<pre><code>page := in_ptr.(fp_page);
start := in_ptr.(fp_page);
length := in_ptr.(fp_length);
offset := in_ptr.(fp_offset) + 32;</code></pre></li>
</ol>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, because <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
<li>execution stack:
<ul>
<li>ergs allocated for the current function/contract instance, if the
heap variant has to be grown;</li>
<li>heap variant bounds, if heap variant has to be grown.</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Read data from a read-only slice returned from a far call, or passed
to a far call.</li>
<li></li>
<li>One of few instructions that accept only reg or imm operand but do
not have full addressing mode, therefore can’t e.g. address stack. The
full list is: {INSNS_USE_REGIMM}.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<p>See <span class="inlinecode"><span class="id"
title="var">OpLoadPtrInc</span></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_load_ptr_inc" class="idref" href="#step_load_ptr_inc"><span class="id" title="inductive">step_load_ptr_inc</span></a> : <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#tsmallstep"><span class="id" title="definition">tsmallstep</span></a> :=<br/>
&nbsp;&nbsp;| <a id="step_LoadPointerInc" class="idref" href="#step_LoadPointerInc"><span class="id" title="constructor">step_LoadPointerInc</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="result:3" class="idref" href="#result:3"><span class="id" title="binder">result</span></a> <a id="addr:4" class="idref" href="#addr:4"><span class="id" title="binder">addr</span></a> <a id="selected_page:5" class="idref" href="#selected_page:5"><span class="id" title="binder">selected_page</span></a> (<a id="in_ptr:6" class="idref" href="#in_ptr:6"><span class="id" title="binder">in_ptr</span></a>:<a class="idref" href="#fat_ptr"><span class="id" title="record">fat_ptr</span></a>) <a id="out_ptr:7" class="idref" href="#out_ptr:7"><span class="id" title="binder">out_ptr</span></a> <a id="slice:8" class="idref" href="#slice:8"><span class="id" title="binder">slice</span></a> <a id="page_id:9" class="idref" href="#page_id:9"><span class="id" title="binder">page_id</span></a> <a id="s:10" class="idref" href="#s:10"><span class="id" title="binder">s</span></a> <a id="high128:11" class="idref" href="#high128:11"><span class="id" title="binder">high128</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#validate_in_bounds"><span class="id" title="definition">validate_in_bounds</span></a> <a class="idref" href="#in_ptr:6"><span class="id" title="variable">in_ptr</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#page_id:9"><span class="id" title="variable">page_id</span></a>  <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#in_ptr:6"><span class="id" title="variable">in_ptr</span></a>.(<a class="idref" href="#fp_page"><span class="id" title="projection">fp_page</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#page_has_id"><span class="id" title="definition">page_has_id</span></a> <a class="idref" href="#s:10"><span class="id" title="variable">s</span></a>.(<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>) <a class="idref" href="#page_id:9"><span class="id" title="variable">page_id</span></a> (<a class="idref" href="#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="#DataPage"><span class="id" title="constructor">DataPage</span></a> <a class="idref" href="#selected_page:5"><span class="id" title="variable">selected_page</span></a>)) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#slice_page"><span class="id" title="inductive">slice_page</span></a> <a class="idref" href="#selected_page:5"><span class="id" title="variable">selected_page</span></a> <a class="idref" href="#in_ptr:6"><span class="id" title="variable">in_ptr</span></a> <a class="idref" href="#slice:8"><span class="id" title="variable">slice</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ptr_resolves_to"><span class="id" title="inductive">ptr_resolves_to</span></a> <a class="idref" href="#in_ptr:6"><span class="id" title="variable">in_ptr</span></a> <a class="idref" href="#addr:4"><span class="id" title="variable">addr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mb_load_slice_result"><span class="id" title="inductive">mb_load_slice_result</span></a> <a class="idref" href="#BigEndian"><span class="id" title="constructor">BigEndian</span></a> <a class="idref" href="#slice:8"><span class="id" title="variable">slice</span></a> <a class="idref" href="#addr:4"><span class="id" title="variable">addr</span></a> <a class="idref" href="#result:3"><span class="id" title="variable">result</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fat_ptr_inc"><span class="id" title="definition">fat_ptr_inc</span></a> <a class="idref" href="#in_ptr:6"><span class="id" title="variable">in_ptr</span></a> <a class="idref" href="#out_ptr:7"><span class="id" title="variable">out_ptr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_load_ptr_inc:1"><span class="id" title="inductive">step_load_ptr_inc</span></a> (<a class="idref" href="#OpLoadPointerInc"><span class="id" title="constructor">OpLoadPointerInc</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high128:11"><span class="id" title="variable">high128</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="#in_ptr:6"><span class="id" title="variable">in_ptr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#result:3"><span class="id" title="variable">result</span></a>) (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high128:11"><span class="id" title="variable">high128</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="#out_ptr:7"><span class="id" title="variable">out_ptr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>))) <a class="idref" href="#s:10"><span class="id" title="variable">s</span></a> <a class="idref" href="#s:10"><span class="id" title="variable">s</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><h2 id="panics">Panics</h2>
<ol type="1">
<li>Argument is not a tagged pointer.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_LoadPointerInc_not_tagged" class="idref" href="#step_LoadPointerInc_not_tagged"><span class="id" title="constructor">step_LoadPointerInc_not_tagged</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="___:12" class="idref" href="#___:12"><span class="id" title="binder">___</span></a> <a id="____:13" class="idref" href="#____:13"><span class="id" title="binder">____</span></a> <a id="_____:14" class="idref" href="#_____:14"><span class="id" title="binder">_____</span></a> (<a id="s1:15" class="idref" href="#s1:15"><span class="id" title="binder">s1</span></a> <a id="s2:16" class="idref" href="#s2:16"><span class="id" title="binder">s2</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#ExpectedFatPointer"><span class="id" title="constructor">ExpectedFatPointer</span></a> <a class="idref" href="#s1:15"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:16"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_load_ptr_inc:1"><span class="id" title="inductive">step_load_ptr_inc</span></a> (<a class="idref" href="#OpLoadPointerInc"><span class="id" title="constructor">OpLoadPointerInc</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#___:12"><span class="id" title="variable">___</span></a>)) <a class="idref" href="#____:13"><span class="id" title="variable">____</span></a> <a class="idref" href="#_____:14"><span class="id" title="variable">_____</span></a>) <a class="idref" href="#s1:15"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:16"><span class="id" title="variable">s2</span></a><br/>
</div>

<div class="doc"><ol start="2" type="1">
<li>Incremented pointer overflows.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_LoadPointerInc_inc_overflow" class="idref" href="#step_LoadPointerInc_inc_overflow"><span class="id" title="constructor">step_LoadPointerInc_inc_overflow</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="in_ptr:17" class="idref" href="#in_ptr:17"><span class="id" title="binder">in_ptr</span></a> <a id="high128:18" class="idref" href="#high128:18"><span class="id" title="binder">high128</span></a> <a id="____:19" class="idref" href="#____:19"><span class="id" title="binder">____</span></a> <a id="_____:20" class="idref" href="#_____:20"><span class="id" title="binder">_____</span></a> (<a id="s1:21" class="idref" href="#s1:21"><span class="id" title="binder">s1</span></a> <a id="s2:22" class="idref" href="#s2:22"><span class="id" title="binder">s2</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fat_ptr_inc_OF"><span class="id" title="definition">fat_ptr_inc_OF</span></a> <a class="idref" href="#in_ptr:17"><span class="id" title="variable">in_ptr</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#FatPtrIncOverflow"><span class="id" title="constructor">FatPtrIncOverflow</span></a> <a class="idref" href="#s1:21"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:22"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_load_ptr_inc:1"><span class="id" title="inductive">step_load_ptr_inc</span></a> (<a class="idref" href="#OpLoadPointerInc"><span class="id" title="constructor">OpLoadPointerInc</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high128:18"><span class="id" title="variable">high128</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="#in_ptr:17"><span class="id" title="variable">in_ptr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)) <a class="idref" href="#____:19"><span class="id" title="variable">____</span></a> <a class="idref" href="#_____:20"><span class="id" title="variable">_____</span></a>) <a class="idref" href="#s1:21"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:22"><span class="id" title="variable">s2</span></a><br/>
.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#LoadPtrIncDefinition"><span class="id" title="section">LoadPtrIncDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.Load</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="library">MemoryManagement</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Arith</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryOps</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryManagement</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="LoadDefinition" class="idref" href="#LoadDefinition"><span class="id" title="section">LoadDefinition</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable Variables</span> <span class="id" title="var">cs</span> <span class="id" title="var">flags</span> <span class="id" title="var">regs</span> <span class="id" title="var">mem</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_load" class="idref" href="#step_load"><span class="id" title="inductive">step_load</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#tsmallstep"><span class="id" title="definition">tsmallstep</span></a> :=<br/>
&nbsp;&nbsp;</div>

<div class="doc"><h1 id="opload">OpLoad</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpLoad"><span
class="id" title="constructor">OpLoad</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_regimm"><span
class="id" title="inductive">in_regimm</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span> <span
class="inlinecode">(<a class="idref" href="#page_type"><span
class="id" title="inductive">page_type</span></a>:</span> <span
class="inlinecode"><a class="idref" href="#data_page_type"><span
class="id" title="inductive">data_page_type</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><p><code>ldvl in1, out1</code></p></li>
<li><p><code>ldvl.h</code> to access heap (default)</p></li>
<li><p><code>ldvl.ah</code> to access auxheap</p></li>
<li><p><code>ldvl.st</code> to access static memory page</p></li>
</ul>
<h2 id="legacy-syntax">Legacy syntax</h2>
<ul>
<li><code>uma.heap_read in1, out</code> aliased as
<code>ld.1 in1, out</code></li>
<li><code>uma.aux_heap_read in1, out</code> aliased as
<code>ld.2 in1, out</code></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Decode the heap address from <code>in1</code>, load 32 consecutive
bytes from the specified active heap variant.</p>
<h2 id="semantic">Semantic</h2>
<ol type="1">
<li><p>Decode a <span
class="inlinecode"><a class="idref" href="#heap_ptr"><span
class="id" title="record">heap_ptr</span></a></span> <span
class="math inline">\mathit{addr}</span> from <code>ptr</code>.</p></li>
<li><p>Ensure reading 32 consecutive bytes is possible; for that, check
if <span class="math inline">\mathit{addr &lt;
2^{32}-32}</span>.</p></li>
<li><p>Let <span class="math inline">B</span> be the selected heap
variant bound. If <span class="math inline">\mathit{addr + 32} &gt;
B</span>, grow heap variant bound and pay for the growth. We are aiming
at reading a 256-bit word starting from address <span
class="math inline">\mathit{addr}</span> so the heap variant bound
should contain all of it.</p></li>
<li><p>Read 32 consecutive bytes as a Big Endian 256-bit word from <span
class="math inline">\mathit{addr}</span> in the heap variant, store
result to <code>res</code>.</p></li>
</ol>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, because <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
<li>execution stack:
<ul>
<li>ergs allocated for the current function/contract instance, if the
heap variant has to be grown;</li>
<li>heap variant bounds, if heap variant has to be grown.</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Only <span
class="inlinecode"><a class="idref" href="#OpLoad"><span
class="id" title="constructor">OpLoad</span></a></span> and <span
class="inlinecode"><a class="idref" href="#OpLoadInc"><span
class="id" title="constructor">OpLoadInc</span></a></span> are capable
of reading data from heap variants.</li>
<li></li>
<li>One of few instructions that accept only reg or imm operand but do
not have full addressing mode, therefore can’t e.g. address stack. The
full list is: {INSNS_USE_REGIMM}.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Load" class="idref" href="#step_Load"><span class="id" title="constructor">step_Load</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="new_cs:3" class="idref" href="#new_cs:3"><span class="id" title="binder">new_cs</span></a> <a id="heap_variant:4" class="idref" href="#heap_variant:4"><span class="id" title="binder">heap_variant</span></a> <a id="ctx:5" class="idref" href="#ctx:5"><span class="id" title="binder">ctx</span></a> <a id="result:6" class="idref" href="#result:6"><span class="id" title="binder">result</span></a> <a id="mem:7" class="idref" href="#mem:7"><span class="id" title="binder">mem</span></a> <a id="selected_page:8" class="idref" href="#selected_page:8"><span class="id" title="binder">selected_page</span></a> <a id="bound:9" class="idref" href="#bound:9"><span class="id" title="binder">bound</span></a> <a id="addr:10" class="idref" href="#addr:10"><span class="id" title="binder">addr</span></a> <a id="high224:11" class="idref" href="#high224:11"><span class="id" title="binder">high224</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#addr:10"><span class="id" title="variable">addr</span></a> <a class="idref" href="#14c765d8614826944bc2b2afe356aa2c"><span class="id" title="notation">≤</span></a> <a class="idref" href="#MAX_OFFSET_TO_DEREF_LOW_U32"><span class="id" title="definition">MAX_OFFSET_TO_DEREF_LOW_U32</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#heap_variant_page"><span class="id" title="definition">heap_variant_page</span></a> <a class="idref" href="#heap_variant:4"><span class="id" title="variable">heap_variant</span></a> <span class="id" title="var">cs1</span> <a class="idref" href="#mem:7"><span class="id" title="variable">mem</span></a> <a class="idref" href="#selected_page:8"><span class="id" title="variable">selected_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mb_load_result"><span class="id" title="inductive">mb_load_result</span></a> <a class="idref" href="#BigEndian"><span class="id" title="constructor">BigEndian</span></a> <a class="idref" href="#selected_page:8"><span class="id" title="variable">selected_page</span></a> <a class="idref" href="#addr:10"><span class="id" title="variable">addr</span></a> <a class="idref" href="#result:6"><span class="id" title="variable">result</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#word_upper_bound"><span class="id" title="inductive">word_upper_bound</span></a> (<a class="idref" href="#mk_hptr"><span class="id" title="constructor">mk_hptr</span></a> <a class="idref" href="#addr:10"><span class="id" title="variable">addr</span></a>) <a class="idref" href="#bound:9"><span class="id" title="variable">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bound_grow_pay"><span class="id" title="inductive">bound_grow_pay</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#heap_variant:4"><span class="id" title="variable">heap_variant</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#bound:9"><span class="id" title="variable">bound</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <span class="id" title="var">cs0</span> <a class="idref" href="#new_cs:3"><span class="id" title="variable">new_cs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_load:1"><span class="id" title="inductive">step_load</span></a> (<a class="idref" href="#OpLoad"><span class="id" title="constructor">OpLoad</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high224:11"><span class="id" title="variable">high224</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#mk_hptr"><span class="id" title="constructor">mk_hptr</span></a> <a class="idref" href="#addr:10"><span class="id" title="variable">addr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#result:6"><span class="id" title="variable">result</span></a>) <a class="idref" href="#heap_variant:4"><span class="id" title="variable">heap_variant</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <span class="id" title="var">cs0</span>;<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <span class="id" title="var">regs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#mem:7"><span class="id" title="variable">mem</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <span class="id" title="var">flags</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#ctx:5"><span class="id" title="variable">ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#new_cs:3"><span class="id" title="variable">new_cs</span></a>;<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <span class="id" title="var">regs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#mem:7"><span class="id" title="variable">mem</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <span class="id" title="var">flags</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#ctx:5"><span class="id" title="variable">ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
</div>

<div class="doc"><h2 id="panics">Panics</h2>
<ol type="1">
<li>Accessing an address greater than <span
class="inlinecode"><a class="idref" href="#MAX_OFFSET_TO_DEREF_LOW_U32"><span
class="id"
title="definition">MAX_OFFSET_TO_DEREF_LOW_U32</span></a></span>.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Load_offset_too_large" class="idref" href="#step_Load_offset_too_large"><span class="id" title="constructor">step_Load_offset_too_large</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="heap_variant:16" class="idref" href="#heap_variant:16"><span class="id" title="binder">heap_variant</span></a> <a id="___:17" class="idref" href="#___:17"><span class="id" title="binder">___</span></a> <a id="addr:18" class="idref" href="#addr:18"><span class="id" title="binder">addr</span></a> <a id="s1:19" class="idref" href="#s1:19"><span class="id" title="binder">s1</span></a> <a id="s2:20" class="idref" href="#s2:20"><span class="id" title="binder">s2</span></a> <a id="high224:21" class="idref" href="#high224:21"><span class="id" title="binder">high224</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#addr:18"><span class="id" title="variable">addr</span></a> <a class="idref" href="#::ZMod_scope:x_'>'_x"><span class="id" title="notation">></span></a> <a class="idref" href="#MAX_OFFSET_TO_DEREF_LOW_U32"><span class="id" title="definition">MAX_OFFSET_TO_DEREF_LOW_U32</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#HeapPtrOffsetTooLarge"><span class="id" title="constructor">HeapPtrOffsetTooLarge</span></a> <a class="idref" href="#s1:19"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:20"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_load:1"><span class="id" title="inductive">step_load</span></a> (<a class="idref" href="#OpLoad"><span class="id" title="constructor">OpLoad</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high224:21"><span class="id" title="variable">high224</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#mk_hptr"><span class="id" title="constructor">mk_hptr</span></a> <a class="idref" href="#addr:18"><span class="id" title="variable">addr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)) <a class="idref" href="#___:17"><span class="id" title="variable">___</span></a> <a class="idref" href="#heap_variant:16"><span class="id" title="variable">heap_variant</span></a>) <a class="idref" href="#s1:19"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:20"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;</div>

<div class="doc"><ol start="2" type="1">
<li>Passed <span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span> instead of <span
class="inlinecode"><a class="idref" href="#heap_ptr"><span
class="id" title="record">heap_ptr</span></a></span>.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Load_expects_intvalue" class="idref" href="#step_Load_expects_intvalue"><span class="id" title="constructor">step_Load_expects_intvalue</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s1:22" class="idref" href="#s1:22"><span class="id" title="binder">s1</span></a> <a id="s2:23" class="idref" href="#s2:23"><span class="id" title="binder">s2</span></a>  <a id="___:24" class="idref" href="#___:24"><span class="id" title="binder">___</span></a> <a id="____:25" class="idref" href="#____:25"><span class="id" title="binder">____</span></a> <a id="_____:26" class="idref" href="#_____:26"><span class="id" title="binder">_____</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#ExpectedHeapPointer"><span class="id" title="constructor">ExpectedHeapPointer</span></a> <a class="idref" href="#s1:22"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:23"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_load:1"><span class="id" title="inductive">step_load</span></a> (<a class="idref" href="#OpLoad"><span class="id" title="constructor">OpLoad</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#___:24"><span class="id" title="variable">___</span></a>)) <a class="idref" href="#____:25"><span class="id" title="variable">____</span></a> <a class="idref" href="#_____:26"><span class="id" title="variable">_____</span></a>) <a class="idref" href="#s1:22"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:23"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;</div>

<div class="doc"><ol start="3" type="1">
<li>Accessing an address requires growing the bound of the corresponding
heap variant, but the growth is unaffordable.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Load_growth_unaffordable" class="idref" href="#step_Load_growth_unaffordable"><span class="id" title="constructor">step_Load_growth_unaffordable</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="s1:27" class="idref" href="#s1:27"><span class="id" title="binder">s1</span></a> <a id="s2:28" class="idref" href="#s2:28"><span class="id" title="binder">s2</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>) <a id="cs:29" class="idref" href="#cs:29"><span class="id" title="binder">cs</span></a> <a id="ptr:30" class="idref" href="#ptr:30"><span class="id" title="binder">ptr</span></a> <a id="bound:31" class="idref" href="#bound:31"><span class="id" title="binder">bound</span></a> <a id="heap_variant:32" class="idref" href="#heap_variant:32"><span class="id" title="binder">heap_variant</span></a> <a id="___:33" class="idref" href="#___:33"><span class="id" title="binder">___</span></a> <a id="high224:34" class="idref" href="#high224:34"><span class="id" title="binder">high224</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#word_upper_bound"><span class="id" title="inductive">word_upper_bound</span></a> <a class="idref" href="#ptr:30"><span class="id" title="variable">ptr</span></a> <a class="idref" href="#bound:31"><span class="id" title="variable">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#growth_to_bound_unaffordable"><span class="id" title="inductive">growth_to_bound_unaffordable</span></a> <a class="idref" href="#cs:29"><span class="id" title="variable">cs</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#heap_variant:32"><span class="id" title="variable">heap_variant</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#bound:31"><span class="id" title="variable">bound</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s1:27"><span class="id" title="variable">s1</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#cs:29"><span class="id" title="variable">cs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#HeapGrowthUnaffordable"><span class="id" title="constructor">HeapGrowthUnaffordable</span></a> <a class="idref" href="#s1:27"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:28"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_load:1"><span class="id" title="inductive">step_load</span></a> (<a class="idref" href="#OpLoad"><span class="id" title="constructor">OpLoad</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high224:34"><span class="id" title="variable">high224</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#ptr:30"><span class="id" title="variable">ptr</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)) <a class="idref" href="#___:33"><span class="id" title="variable">___</span></a> <a class="idref" href="#heap_variant:32"><span class="id" title="variable">heap_variant</span></a>) <a class="idref" href="#s1:27"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:28"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#LoadDefinition"><span class="id" title="section">LoadDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.LoadInc</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="library">MemoryManagement</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Arith</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryOps</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryManagement</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="LoadIncDefinition" class="idref" href="#LoadIncDefinition"><span class="id" title="section">LoadIncDefinition</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable Variables</span> <span class="id" title="var">cs</span> <span class="id" title="var">flags</span> <span class="id" title="var">regs</span> <span class="id" title="var">mem</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_load_inc" class="idref" href="#step_load_inc"><span class="id" title="inductive">step_load_inc</span></a> : <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#tsmallstep"><span class="id" title="definition">tsmallstep</span></a> :=<br/>
</div>

<div class="doc"><h1 id="oploadinc">OpLoadInc</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpLoadInc"><span
class="id" title="constructor">OpLoadInc</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_regimm"><span
class="id" title="inductive">in_regimm</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span> <span
class="inlinecode">(<a class="idref" href="#page_type"><span
class="id" title="inductive">page_type</span></a>:</span> <span
class="inlinecode"><a class="idref" href="#data_page_type"><span
class="id" title="inductive">data_page_type</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><p><code>ldvli in1, out1, out2</code></p></li>
<li><p><code>ldvli.h</code> to access heap (default)</p></li>
<li><p><code>ldvli.ah</code> to access auxheap</p></li>
<li><p><code>ldvli.st</code> to access static memory page</p></li>
</ul>
<h2 id="legacy-syntax">Legacy syntax</h2>
<ul>
<li><code>uma.inc.heap_read in1, out1, out2</code> aliased as
<code>ld.1.inc in1, out1, out2</code></li>
<li><code>uma.inc.aux_heap_read in1, out1, out2</code> aliased as
<code>ld.2.inc in1, out1, out2</code></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Decode the heap address from <code>in1</code>, load 32 consecutive
bytes from the specified active heap variant. Additionally, store a
pointer to the next word to <code>inc_ptr</code> register.</p>
<h2 id="semantic">Semantic</h2>
<ol type="1">
<li><p>Decode a <span
class="inlinecode"><a class="idref" href="#heap_ptr"><span
class="id" title="record">heap_ptr</span></a></span> <span
class="math inline">\mathit{addr}</span> from <code>ptr</code>.</p></li>
<li><p>Ensure reading 32 consecutive bytes is possible; for that, check
if <span class="math inline">\mathit{addr &lt;
2^{32}-32}</span>.</p></li>
<li><p>Let <span class="math inline">B</span> be the selected heap
variant bound. If <span class="math inline">\mathit{addr + 32} &gt;
B</span>, grow heap variant bound and pay for the growth. We are aiming
at reading a 256-bit word starting from address <span
class="math inline">\mathit{addr}</span> so the heap variant bound
should contain all of it.</p></li>
<li><p>Read 32 consecutive bytes as a Big Endian 256-bit word from <span
class="math inline">\mathit{addr}</span> in the heap variant, store
result to <code>res</code>.</p></li>
<li><p>Store an encoded <span
class="inlinecode"><a class="idref" href="#heap_ptr"><span
class="id" title="record">heap_ptr</span></a></span> <span
class="math inline">\mathit{addr+32}</span> to the next 32-byte word in
the heap variant in <code>inc_ptr</code>.</p></li>
</ol>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, because <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
<li>execution stack:
<ul>
<li>ergs allocated for the current function/contract instance, if the
heap variant has to be grown;</li>
<li>heap variant bounds, if heap variant has to be grown.</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Only <span
class="inlinecode"><a class="idref" href="#OpLoad"><span
class="id" title="constructor">OpLoad</span></a></span> and <span
class="inlinecode"><a class="idref" href="#OpLoadInc"><span
class="id" title="constructor">OpLoadInc</span></a></span> are capable
of reading data from heap variants.</li>
<li></li>
<li>One of few instructions that accept only reg or imm operand but do
not have full addressing mode, therefore can’t e.g. address stack. The
full list is: {INSNS_USE_REGIMM}.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<p>See <span
class="inlinecode"><a class="idref" href="#OpLoad"><span
class="id" title="constructor">OpLoad</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpLoadInc"><span
class="id" title="constructor">OpLoadInc</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpStore"><span
class="id" title="constructor">OpStore</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpStoreInc"><span
class="id" title="constructor">OpStoreInc</span></a></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_LoadInc" class="idref" href="#step_LoadInc"><span class="id" title="constructor">step_LoadInc</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="heap_variant:3" class="idref" href="#heap_variant:3"><span class="id" title="binder">heap_variant</span></a> <a id="result:4" class="idref" href="#result:4"><span class="id" title="binder">result</span></a> <a id="new_regs:5" class="idref" href="#new_regs:5"><span class="id" title="binder">new_regs</span></a> <a id="selected_page:6" class="idref" href="#selected_page:6"><span class="id" title="binder">selected_page</span></a> <a id="high224:7" class="idref" href="#high224:7"><span class="id" title="binder">high224</span></a> <a id="ptr_inc:8" class="idref" href="#ptr_inc:8"><span class="id" title="binder">ptr_inc</span></a> <a id="bound:9" class="idref" href="#bound:9"><span class="id" title="binder">bound</span></a> <a id="new_cs:10" class="idref" href="#new_cs:10"><span class="id" title="binder">new_cs</span></a> <a id="addr:11" class="idref" href="#addr:11"><span class="id" title="binder">addr</span></a> <a id="ctx:12" class="idref" href="#ctx:12"><span class="id" title="binder">ctx</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="hptr:13" class="idref" href="#hptr:13"><span class="id" title="binder">hptr</span></a> := <a class="idref" href="#mk_hptr"><span class="id" title="constructor">mk_hptr</span></a> <a class="idref" href="#addr:11"><span class="id" title="variable">addr</span></a> <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#addr:11"><span class="id" title="variable">addr</span></a> <a class="idref" href="#14c765d8614826944bc2b2afe356aa2c"><span class="id" title="notation">≤</span></a> <a class="idref" href="#MAX_OFFSET_TO_DEREF_LOW_U32"><span class="id" title="definition">MAX_OFFSET_TO_DEREF_LOW_U32</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#heap_variant_page"><span class="id" title="definition">heap_variant_page</span></a> <a class="idref" href="#heap_variant:3"><span class="id" title="variable">heap_variant</span></a> <span class="id" title="var">cs0</span> <span class="id" title="var">mem</span> <a class="idref" href="#selected_page:6"><span class="id" title="variable">selected_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mb_load_result"><span class="id" title="inductive">mb_load_result</span></a> <a class="idref" href="#BigEndian"><span class="id" title="constructor">BigEndian</span></a> <a class="idref" href="#selected_page:6"><span class="id" title="variable">selected_page</span></a> <a class="idref" href="#addr:11"><span class="id" title="variable">addr</span></a> <a class="idref" href="#result:4"><span class="id" title="variable">result</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#word_upper_bound"><span class="id" title="inductive">word_upper_bound</span></a> <a class="idref" href="#hptr:13"><span class="id" title="variable">hptr</span></a> <a class="idref" href="#bound:9"><span class="id" title="variable">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bound_grow_pay"><span class="id" title="inductive">bound_grow_pay</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#heap_variant:3"><span class="id" title="variable">heap_variant</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#bound:9"><span class="id" title="variable">bound</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <span class="id" title="var">cs0</span> <a class="idref" href="#new_cs:10"><span class="id" title="variable">new_cs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#hp_inc"><span class="id" title="inductive">hp_inc</span></a> <a class="idref" href="#hptr:13"><span class="id" title="variable">hptr</span></a> <a class="idref" href="#ptr_inc:8"><span class="id" title="variable">ptr_inc</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_load_inc:1"><span class="id" title="inductive">step_load_inc</span></a> (<a class="idref" href="#OpLoadInc"><span class="id" title="constructor">OpLoadInc</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high224:7"><span class="id" title="variable">high224</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#hptr:13"><span class="id" title="variable">hptr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#result:4"><span class="id" title="variable">result</span></a>) <a class="idref" href="#heap_variant:3"><span class="id" title="variable">heap_variant</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high224:7"><span class="id" title="variable">high224</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#ptr_inc:8"><span class="id" title="variable">ptr_inc</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#mk_transient_state"><span class="id" title="constructor">mk_transient_state</span></a> <span class="id" title="var">flags</span> <span class="id" title="var">regs</span> <span class="id" title="var">mem</span> <span class="id" title="var">cs0</span> <a class="idref" href="#ctx:12"><span class="id" title="variable">ctx</span></a> <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#mk_transient_state"><span class="id" title="constructor">mk_transient_state</span></a> <span class="id" title="var">flags</span> <a class="idref" href="#new_regs:5"><span class="id" title="variable">new_regs</span></a> <span class="id" title="var">mem</span> <a class="idref" href="#new_cs:10"><span class="id" title="variable">new_cs</span></a> <a class="idref" href="#ctx:12"><span class="id" title="variable">ctx</span></a> <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
<br/>
</div>

<div class="doc"><h2 id="panics">Panics</h2>
<ol type="1">
<li>Accessing an address greater than <span
class="inlinecode"><a class="idref" href="#MAX_OFFSET_TO_DEREF_LOW_U32"><span
class="id"
title="definition">MAX_OFFSET_TO_DEREF_LOW_U32</span></a></span>.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Load_offset_too_large" class="idref" href="#step_Load_offset_too_large"><span class="id" title="constructor">step_Load_offset_too_large</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="heap_variant:18" class="idref" href="#heap_variant:18"><span class="id" title="binder">heap_variant</span></a> <a id="___:19" class="idref" href="#___:19"><span class="id" title="binder">___</span></a> <a id="____:20" class="idref" href="#____:20"><span class="id" title="binder">____</span></a> <a id="addr:21" class="idref" href="#addr:21"><span class="id" title="binder">addr</span></a> <a id="s1:22" class="idref" href="#s1:22"><span class="id" title="binder">s1</span></a> <a id="s2:23" class="idref" href="#s2:23"><span class="id" title="binder">s2</span></a> <a id="high224:24" class="idref" href="#high224:24"><span class="id" title="binder">high224</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#addr:21"><span class="id" title="variable">addr</span></a> <a class="idref" href="#::ZMod_scope:x_'>'_x"><span class="id" title="notation">></span></a> <a class="idref" href="#MAX_OFFSET_TO_DEREF_LOW_U32"><span class="id" title="definition">MAX_OFFSET_TO_DEREF_LOW_U32</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#HeapPtrOffsetTooLarge"><span class="id" title="constructor">HeapPtrOffsetTooLarge</span></a> <a class="idref" href="#s1:22"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:23"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_load_inc:1"><span class="id" title="inductive">step_load_inc</span></a> (<a class="idref" href="#OpLoadInc"><span class="id" title="constructor">OpLoadInc</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high224:24"><span class="id" title="variable">high224</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#mk_hptr"><span class="id" title="constructor">mk_hptr</span></a> <a class="idref" href="#addr:21"><span class="id" title="variable">addr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)) <a class="idref" href="#___:19"><span class="id" title="variable">___</span></a> <a class="idref" href="#heap_variant:18"><span class="id" title="variable">heap_variant</span></a> <a class="idref" href="#____:20"><span class="id" title="variable">____</span></a>) <a class="idref" href="#s1:22"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:23"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;</div>

<div class="doc"><ol start="2" type="1">
<li>Passed <span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span> instead of <span
class="inlinecode"><a class="idref" href="#heap_ptr"><span
class="id" title="record">heap_ptr</span></a></span>.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Load_expects_intvalue" class="idref" href="#step_Load_expects_intvalue"><span class="id" title="constructor">step_Load_expects_intvalue</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s1:25" class="idref" href="#s1:25"><span class="id" title="binder">s1</span></a> <a id="s2:26" class="idref" href="#s2:26"><span class="id" title="binder">s2</span></a> <a id="___:27" class="idref" href="#___:27"><span class="id" title="binder">___</span></a> <a id="____:28" class="idref" href="#____:28"><span class="id" title="binder">____</span></a> <a id="_____:29" class="idref" href="#_____:29"><span class="id" title="binder">_____</span></a> <a id="______:30" class="idref" href="#______:30"><span class="id" title="binder">______</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#ExpectedHeapPointer"><span class="id" title="constructor">ExpectedHeapPointer</span></a> <a class="idref" href="#s1:25"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:26"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_load_inc:1"><span class="id" title="inductive">step_load_inc</span></a> (<a class="idref" href="#OpLoadInc"><span class="id" title="constructor">OpLoadInc</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#___:27"><span class="id" title="variable">___</span></a>)) <a class="idref" href="#____:28"><span class="id" title="variable">____</span></a> <a class="idref" href="#_____:29"><span class="id" title="variable">_____</span></a> <a class="idref" href="#______:30"><span class="id" title="variable">______</span></a>) <a class="idref" href="#s1:25"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:26"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;</div>

<div class="doc"><ol start="3" type="1">
<li>Accessing an address requires growing the bound of the corresponding
heap variant, but the growth is unaffordable.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Load_growth_unaffordable" class="idref" href="#step_Load_growth_unaffordable"><span class="id" title="constructor">step_Load_growth_unaffordable</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="s1:31" class="idref" href="#s1:31"><span class="id" title="binder">s1</span></a> <a id="s2:32" class="idref" href="#s2:32"><span class="id" title="binder">s2</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>) <a id="cs:33" class="idref" href="#cs:33"><span class="id" title="binder">cs</span></a> <a id="ptr:34" class="idref" href="#ptr:34"><span class="id" title="binder">ptr</span></a> <a id="bound:35" class="idref" href="#bound:35"><span class="id" title="binder">bound</span></a> <a id="heap_variant:36" class="idref" href="#heap_variant:36"><span class="id" title="binder">heap_variant</span></a> <a id="___:37" class="idref" href="#___:37"><span class="id" title="binder">___</span></a> <a id="____:38" class="idref" href="#____:38"><span class="id" title="binder">____</span></a> <a id="high224:39" class="idref" href="#high224:39"><span class="id" title="binder">high224</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#word_upper_bound"><span class="id" title="inductive">word_upper_bound</span></a> <a class="idref" href="#ptr:34"><span class="id" title="variable">ptr</span></a> <a class="idref" href="#bound:35"><span class="id" title="variable">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#growth_to_bound_unaffordable"><span class="id" title="inductive">growth_to_bound_unaffordable</span></a> <a class="idref" href="#cs:33"><span class="id" title="variable">cs</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#heap_variant:36"><span class="id" title="variable">heap_variant</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#bound:35"><span class="id" title="variable">bound</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s1:31"><span class="id" title="variable">s1</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#cs:33"><span class="id" title="variable">cs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#HeapGrowthUnaffordable"><span class="id" title="constructor">HeapGrowthUnaffordable</span></a> <a class="idref" href="#s1:31"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:32"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_load_inc:1"><span class="id" title="inductive">step_load_inc</span></a> (<a class="idref" href="#OpLoadInc"><span class="id" title="constructor">OpLoadInc</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high224:39"><span class="id" title="variable">high224</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#ptr:34"><span class="id" title="variable">ptr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)) <a class="idref" href="#___:37"><span class="id" title="variable">___</span></a> <a class="idref" href="#heap_variant:36"><span class="id" title="variable">heap_variant</span></a> <a class="idref" href="#____:38"><span class="id" title="variable">____</span></a>) <a class="idref" href="#s1:31"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:32"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;</div>

<div class="doc"><ol start="4" type="1">
<li>Incremented pointer overflows.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_LoadInc_inc_overflow" class="idref" href="#step_LoadInc_inc_overflow"><span class="id" title="constructor">step_LoadInc_inc_overflow</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="s1:40" class="idref" href="#s1:40"><span class="id" title="binder">s1</span></a> <a id="s2:41" class="idref" href="#s2:41"><span class="id" title="binder">s2</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>) <a id="heap_variant:42" class="idref" href="#heap_variant:42"><span class="id" title="binder">heap_variant</span></a> <a id="result:43" class="idref" href="#result:43"><span class="id" title="binder">result</span></a> <a id="hptr:44" class="idref" href="#hptr:44"><span class="id" title="binder">hptr</span></a> <a id="___:45" class="idref" href="#___:45"><span class="id" title="binder">___</span></a> <a id="high224:46" class="idref" href="#high224:46"><span class="id" title="binder">high224</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#hp_inc_OF"><span class="id" title="definition">hp_inc_OF</span></a> <a class="idref" href="#hptr:44"><span class="id" title="variable">hptr</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#HeapPtrIncOverflow"><span class="id" title="constructor">HeapPtrIncOverflow</span></a> <a class="idref" href="#s1:40"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:41"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_load_inc:1"><span class="id" title="inductive">step_load_inc</span></a> (<a class="idref" href="#OpLoadInc"><span class="id" title="constructor">OpLoadInc</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high224:46"><span class="id" title="variable">high224</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#hptr:44"><span class="id" title="variable">hptr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#result:43"><span class="id" title="variable">result</span></a>) <a class="idref" href="#heap_variant:42"><span class="id" title="variable">heap_variant</span></a> <a class="idref" href="#___:45"><span class="id" title="variable">___</span></a>) <a class="idref" href="#s1:40"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:41"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#LoadIncDefinition"><span class="id" title="section">LoadIncDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.Store</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="library">MemoryManagement</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryOps</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryManagement</span></a>  <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="StoreDefinition" class="idref" href="#StoreDefinition"><span class="id" title="section">StoreDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_store" class="idref" href="#step_store"><span class="id" title="inductive">step_store</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#tsmallstep"><span class="id" title="definition">tsmallstep</span></a> :=<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc"><h1 id="opstore">OpStore</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpStore"><span
class="id" title="constructor">OpStore</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_regimm"><span
class="id" title="inductive">in_regimm</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<a class="idref" href="#page_type"><span
class="id" title="inductive">page_type</span></a>:</span> <span
class="inlinecode"><a class="idref" href="#data_page_type"><span
class="id" title="inductive">data_page_type</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><p><code>stm in1, in2</code></p></li>
<li><p><code>stm.h</code> to access heap (default)</p></li>
<li><p><code>stm.ah</code> to access auxheap</p></li>
<li><p><code>stm.st</code> to access static memory page</p></li>
</ul>
<h2 id="legacy-syntax">Legacy syntax</h2>
<ul>
<li><code>uma.heap_write in1, in2</code> aliased as
<code>st.1.inc in1, out</code></li>
<li><code>uma.aux_heap_write in1, in2</code> aliased as
<code>st.2.inc in1, out</code></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Decode the heap address from <code>in1</code>, store 32 consecutive
bytes to the specified active heap variant.</p>
<h2 id="semantic">Semantic</h2>
<ol type="1">
<li><p>Decode a <span
class="inlinecode"><a class="idref" href="#heap_ptr"><span
class="id" title="record">heap_ptr</span></a></span> <span
class="math inline">\mathit{addr}</span> from <code>ptr</code>.</p></li>
<li><p>Ensure storing 32 consecutive bytes is possible; for that, check
if <span class="math inline">\mathit{addr &lt;
2^{32}-32}</span>.</p></li>
<li><p>Let <span class="math inline">B</span> be the selected heap
variant bound. If <span class="math inline">\mathit{addr + 32} &gt;
B</span>, grow heap variant bound and pay for the growth. We are aiming
at reading a 256-bit word starting from address <span
class="math inline">\mathit{addr}</span> so the heap variant bound
should contain all of it.</p></li>
<li><p>Store 32 consecutive bytes as a Big Endian 256-bit word from
<code>val</code> to <span class="math inline">\mathit{addr}</span> in
the heap variant.</p></li>
</ol>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
<li>execution stack:
<ul>
<li>allocated ergs if the heap variant has to be grown;</li>
<li>heap bounds, if heap variant has to be grown.</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<h2 id="related-instructions">Related instructions</h2>
<ul>
<li>Only <span
class="inlinecode"><a class="idref" href="#OpStore"><span
class="id" title="constructor">OpStore</span></a></span> and <span
class="inlinecode"><a class="idref" href="#OpStoreInc"><span
class="id" title="constructor">OpStoreInc</span></a></span> are capable
of reading data from heap variants.</li>
<li></li>
<li>One of few instructions that accept only reg or imm operand but do
not have full addressing mode, therefore can’t e.g. address stack. The
full list is: {INSNS_USE_REGIMM}.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Store" class="idref" href="#step_Store"><span class="id" title="constructor">step_Store</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="high224:3" class="idref" href="#high224:3"><span class="id" title="binder">high224</span></a> <a id="result:4" class="idref" href="#result:4"><span class="id" title="binder">result</span></a> <a id="flags:5" class="idref" href="#flags:5"><span class="id" title="binder">flags</span></a> <a id="new_cs:6" class="idref" href="#new_cs:6"><span class="id" title="binder">new_cs</span></a> <a id="heap_variant:7" class="idref" href="#heap_variant:7"><span class="id" title="binder">heap_variant</span></a> <a id="value:8" class="idref" href="#value:8"><span class="id" title="binder">value</span></a> <a id="new_mem:9" class="idref" href="#new_mem:9"><span class="id" title="binder">new_mem</span></a> <a id="selected_page:10" class="idref" href="#selected_page:10"><span class="id" title="binder">selected_page</span></a> <a id="bound:11" class="idref" href="#bound:11"><span class="id" title="binder">bound</span></a> <a id="modified_page:12" class="idref" href="#modified_page:12"><span class="id" title="binder">modified_page</span></a> <a id="cs:13" class="idref" href="#cs:13"><span class="id" title="binder">cs</span></a> <a id="regs:14" class="idref" href="#regs:14"><span class="id" title="binder">regs</span></a> <a id="mem:15" class="idref" href="#mem:15"><span class="id" title="binder">mem</span></a> <a id="addr:16" class="idref" href="#addr:16"><span class="id" title="binder">addr</span></a> <a id="ctx:17" class="idref" href="#ctx:17"><span class="id" title="binder">ctx</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="selected_page_id:18" class="idref" href="#selected_page_id:18"><span class="id" title="binder">selected_page_id</span></a> := <a class="idref" href="#heap_variant_id"><span class="id" title="definition">heap_variant_id</span></a> <a class="idref" href="#heap_variant:7"><span class="id" title="variable">heap_variant</span></a> <a class="idref" href="#cs:13"><span class="id" title="variable">cs</span></a> <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#addr:16"><span class="id" title="variable">addr</span></a> <a class="idref" href="#14c765d8614826944bc2b2afe356aa2c"><span class="id" title="notation">≤</span></a> <a class="idref" href="#MAX_OFFSET_TO_DEREF_LOW_U32"><span class="id" title="definition">MAX_OFFSET_TO_DEREF_LOW_U32</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#heap_variant_page"><span class="id" title="definition">heap_variant_page</span></a> <a class="idref" href="#heap_variant:7"><span class="id" title="variable">heap_variant</span></a> <a class="idref" href="#cs:13"><span class="id" title="variable">cs</span></a> <a class="idref" href="#mem:15"><span class="id" title="variable">mem</span></a> <a class="idref" href="#selected_page:10"><span class="id" title="variable">selected_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#word_upper_bound"><span class="id" title="inductive">word_upper_bound</span></a> (<a class="idref" href="#mk_hptr"><span class="id" title="constructor">mk_hptr</span></a> <a class="idref" href="#addr:16"><span class="id" title="variable">addr</span></a>) <a class="idref" href="#bound:11"><span class="id" title="variable">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bound_grow_pay"><span class="id" title="inductive">bound_grow_pay</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#heap_variant:7"><span class="id" title="variable">heap_variant</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#bound:11"><span class="id" title="variable">bound</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#cs:13"><span class="id" title="variable">cs</span></a> <a class="idref" href="#new_cs:6"><span class="id" title="variable">new_cs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mb_store_word_result"><span class="id" title="inductive">mb_store_word_result</span></a> <a class="idref" href="#BigEndian"><span class="id" title="constructor">BigEndian</span></a> <a class="idref" href="#selected_page:10"><span class="id" title="variable">selected_page</span></a> <a class="idref" href="#addr:16"><span class="id" title="variable">addr</span></a> <a class="idref" href="#value:8"><span class="id" title="variable">value</span></a> <a class="idref" href="#modified_page:12"><span class="id" title="variable">modified_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#page_replace"><span class="id" title="inductive">page_replace</span></a> <a class="idref" href="#selected_page_id:18"><span class="id" title="variable">selected_page_id</span></a> (<a class="idref" href="#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="#DataPage"><span class="id" title="constructor">DataPage</span></a> <a class="idref" href="#modified_page:12"><span class="id" title="variable">modified_page</span></a>)) <a class="idref" href="#mem:15"><span class="id" title="variable">mem</span></a> <a class="idref" href="#new_mem:9"><span class="id" title="variable">new_mem</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_store:1"><span class="id" title="inductive">step_store</span></a> (<a class="idref" href="#OpStore"><span class="id" title="constructor">OpStore</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high224:3"><span class="id" title="variable">high224</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#mk_hptr"><span class="id" title="constructor">mk_hptr</span></a> <a class="idref" href="#addr:16"><span class="id" title="variable">addr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#result:4"><span class="id" title="variable">result</span></a>) <a class="idref" href="#heap_variant:7"><span class="id" title="variable">heap_variant</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#cs:13"><span class="id" title="variable">cs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#mem:15"><span class="id" title="variable">mem</span></a>;<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#regs:14"><span class="id" title="variable">regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags:5"><span class="id" title="variable">flags</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#ctx:17"><span class="id" title="variable">ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#new_cs:6"><span class="id" title="variable">new_cs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#new_mem:9"><span class="id" title="variable">new_mem</span></a>;<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#regs:14"><span class="id" title="variable">regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags:5"><span class="id" title="variable">flags</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#ctx:17"><span class="id" title="variable">ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
<br/>
</div>

<div class="doc"><h2 id="affected-parts-of-vm-state">Affected parts of VM state</h2>
<h2 id="panics">Panics</h2>
<ol type="1">
<li>Accessing an address greater than <span
class="inlinecode"><a class="idref" href="#MAX_OFFSET_TO_DEREF_LOW_U32"><span
class="id"
title="definition">MAX_OFFSET_TO_DEREF_LOW_U32</span></a></span>.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Store_offset_too_large" class="idref" href="#step_Store_offset_too_large"><span class="id" title="constructor">step_Store_offset_too_large</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="heap_variant:19" class="idref" href="#heap_variant:19"><span class="id" title="binder">heap_variant</span></a> <a id="___1:20" class="idref" href="#___1:20"><span class="id" title="binder">___1</span></a> <a id="addr:21" class="idref" href="#addr:21"><span class="id" title="binder">addr</span></a> <a id="high224:22" class="idref" href="#high224:22"><span class="id" title="binder">high224</span></a> <a id="s1:23" class="idref" href="#s1:23"><span class="id" title="binder">s1</span></a> <a id="s2:24" class="idref" href="#s2:24"><span class="id" title="binder">s2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#addr:21"><span class="id" title="variable">addr</span></a> <a class="idref" href="#::ZMod_scope:x_'>'_x"><span class="id" title="notation">></span></a> <a class="idref" href="#MAX_OFFSET_TO_DEREF_LOW_U32"><span class="id" title="definition">MAX_OFFSET_TO_DEREF_LOW_U32</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#HeapPtrOffsetTooLarge"><span class="id" title="constructor">HeapPtrOffsetTooLarge</span></a> <a class="idref" href="#s1:23"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:24"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_store:1"><span class="id" title="inductive">step_store</span></a> (<a class="idref" href="#OpStore"><span class="id" title="constructor">OpStore</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high224:22"><span class="id" title="variable">high224</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#mk_hptr"><span class="id" title="constructor">mk_hptr</span></a> <a class="idref" href="#addr:21"><span class="id" title="variable">addr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)) <a class="idref" href="#___1:20"><span class="id" title="variable">___1</span></a> <a class="idref" href="#heap_variant:19"><span class="id" title="variable">heap_variant</span></a>) <a class="idref" href="#s1:23"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:24"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;</div>

<div class="doc"><ol start="2" type="1">
<li>Fat pointer provided where heap pointer is expected.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Store_expects_intvalue" class="idref" href="#step_Store_expects_intvalue"><span class="id" title="constructor">step_Store_expects_intvalue</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s1:25" class="idref" href="#s1:25"><span class="id" title="binder">s1</span></a> <a id="s2:26" class="idref" href="#s2:26"><span class="id" title="binder">s2</span></a> <a id="___1:27" class="idref" href="#___1:27"><span class="id" title="binder">___1</span></a> <a id="___2:28" class="idref" href="#___2:28"><span class="id" title="binder">___2</span></a> <a id="___3:29" class="idref" href="#___3:29"><span class="id" title="binder">___3</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#ExpectedHeapPointer"><span class="id" title="constructor">ExpectedHeapPointer</span></a>  <a class="idref" href="#s1:25"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:26"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_store:1"><span class="id" title="inductive">step_store</span></a> (<a class="idref" href="#OpStore"><span class="id" title="constructor">OpStore</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#___1:27"><span class="id" title="variable">___1</span></a>)) <a class="idref" href="#___2:28"><span class="id" title="variable">___2</span></a> <a class="idref" href="#___3:29"><span class="id" title="variable">___3</span></a>) <a class="idref" href="#s1:25"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:26"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;</div>

<div class="doc"><ol start="3" type="1">
<li>Accessing an address requires growing the bound of the corresponding
heap variant, but the growth is unaffordable.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Store_growth_unaffordable" class="idref" href="#step_Store_growth_unaffordable"><span class="id" title="constructor">step_Store_growth_unaffordable</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="s1:30" class="idref" href="#s1:30"><span class="id" title="binder">s1</span></a> <a id="s2:31" class="idref" href="#s2:31"><span class="id" title="binder">s2</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>) <a id="high224:32" class="idref" href="#high224:32"><span class="id" title="binder">high224</span></a> <a id="cs:33" class="idref" href="#cs:33"><span class="id" title="binder">cs</span></a> <a id="ptr:34" class="idref" href="#ptr:34"><span class="id" title="binder">ptr</span></a> <a id="bound:35" class="idref" href="#bound:35"><span class="id" title="binder">bound</span></a> <a id="heap_variant:36" class="idref" href="#heap_variant:36"><span class="id" title="binder">heap_variant</span></a> <a id="___1:37" class="idref" href="#___1:37"><span class="id" title="binder">___1</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#word_upper_bound"><span class="id" title="inductive">word_upper_bound</span></a> <a class="idref" href="#ptr:34"><span class="id" title="variable">ptr</span></a> <a class="idref" href="#bound:35"><span class="id" title="variable">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#growth_to_bound_unaffordable"><span class="id" title="inductive">growth_to_bound_unaffordable</span></a> <a class="idref" href="#cs:33"><span class="id" title="variable">cs</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#heap_variant:36"><span class="id" title="variable">heap_variant</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#bound:35"><span class="id" title="variable">bound</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s1:30"><span class="id" title="variable">s1</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#cs:33"><span class="id" title="variable">cs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#HeapGrowthUnaffordable"><span class="id" title="constructor">HeapGrowthUnaffordable</span></a> <a class="idref" href="#s1:30"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:31"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_store:1"><span class="id" title="inductive">step_store</span></a> (<a class="idref" href="#OpStore"><span class="id" title="constructor">OpStore</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high224:32"><span class="id" title="variable">high224</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#ptr:34"><span class="id" title="variable">ptr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)) <a class="idref" href="#___1:37"><span class="id" title="variable">___1</span></a> <a class="idref" href="#heap_variant:36"><span class="id" title="variable">heap_variant</span></a>) <a class="idref" href="#s1:30"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:31"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#StoreDefinition"><span class="id" title="section">StoreDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.StoreInc</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="library">MemoryManagement</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryOps</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryManagement</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="StoreIncDefinition" class="idref" href="#StoreIncDefinition"><span class="id" title="section">StoreIncDefinition</span></a>.<br/>
&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_storeinc" class="idref" href="#step_storeinc"><span class="id" title="inductive">step_storeinc</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#tsmallstep"><span class="id" title="definition">tsmallstep</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;</div>

<div class="doc"><h1 id="opstoreinc">OpStoreInc</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpStoreInc"><span
class="id" title="constructor">OpStoreInc</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_regimm"><span
class="id" title="inductive">in_regimm</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span> <span
class="inlinecode">(<a class="idref" href="#page_type"><span
class="id" title="inductive">page_type</span></a>:</span> <span
class="inlinecode"><a class="idref" href="#data_page_type"><span
class="id" title="inductive">data_page_type</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><p><code>stmi in1, in2, out1</code></p></li>
<li><p><code>stmi.h</code> to access heap (default)</p></li>
<li><p><code>stmi.ah</code> to access auxheap</p></li>
<li><p><code>stmi.st</code> to access static memory page</p></li>
</ul>
<h2 id="legacy-syntax">Legacy syntax</h2>
<ul>
<li><code>uma.inc.heap_write in1, in2</code> aliased as
<code>st.1.inc in1, out</code></li>
<li><code>uma.inc.aux_heap_write in1, in2</code> aliased as
<code>st.2.inc in1, out</code></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Decode the heap address from <code>in1</code>, store 32 consecutive
bytes to the specified active heap variant.</p>
<p>Additionally, store a pointer to the next word to <code>out1</code>
register.</p>
<h2 id="semantic">Semantic</h2>
<ol type="1">
<li><p>Decode a <span
class="inlinecode"><a class="idref" href="#heap_ptr"><span
class="id" title="record">heap_ptr</span></a></span> <span
class="math inline">\mathit{addr}</span> from <code>ptr</code>.</p></li>
<li><p>Ensure storing 32 consecutive bytes is possible; for that, check
if <span class="math inline">\mathit{addr &lt;
2^{32}-32}</span>.</p></li>
<li><p>Let <span class="math inline">B</span> be the selected heap
variant bound. If <span class="math inline">\mathit{addr + 32} &gt;
B</span>, grow heap variant bound and pay for the growth. We are aiming
at reading a 256-bit word starting from address <span
class="math inline">\mathit{addr}</span> so the heap variant bound
should contain all of it.</p></li>
<li><p>Store 32 consecutive bytes as a Big Endian 256-bit word from
<code>val</code> to <span class="math inline">\mathit{addr}</span> in
the heap variant.</p></li>
<li><p>Store an encoded <span
class="inlinecode"><a class="idref" href="#heap_ptr"><span
class="id" title="record">heap_ptr</span></a></span> <span
class="math inline">\mathit{addr+32}</span> to the next 32-byte word in
the heap variant in <code>inc_ptr</code>.</p></li>
</ol>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, because <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
<li>execution stack:
<ul>
<li>allocated ergs if the heap variant has to be grown;</li>
<li>heap bounds, if heap variant has to be grown.</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<h2 id="related-instructions">Related instructions</h2>
<ul>
<li>Only <span
class="inlinecode"><a class="idref" href="#OpStore"><span
class="id" title="constructor">OpStore</span></a></span> and <span
class="inlinecode"><a class="idref" href="#OpStoreInc"><span
class="id" title="constructor">OpStoreInc</span></a></span> are capable
of reading data from heap variants.</li>
<li></li>
<li>One of few instructions that accept only reg or imm operand but do
not have full addressing mode, therefore can’t e.g. address stack. The
full list is: {INSNS_USE_REGIMM}.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_StoreInc" class="idref" href="#step_StoreInc"><span class="id" title="constructor">step_StoreInc</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="hptr:3" class="idref" href="#hptr:3"><span class="id" title="binder">hptr</span></a> <a id="flags:4" class="idref" href="#flags:4"><span class="id" title="binder">flags</span></a> <a id="new_cs:5" class="idref" href="#new_cs:5"><span class="id" title="binder">new_cs</span></a> <a id="heap_variant:6" class="idref" href="#heap_variant:6"><span class="id" title="binder">heap_variant</span></a> <a id="value:7" class="idref" href="#value:7"><span class="id" title="binder">value</span></a> <a id="new_mem:8" class="idref" href="#new_mem:8"><span class="id" title="binder">new_mem</span></a> <a id="selected_page:9" class="idref" href="#selected_page:9"><span class="id" title="binder">selected_page</span></a> <a id="bound:10" class="idref" href="#bound:10"><span class="id" title="binder">bound</span></a> <a id="modified_page:11" class="idref" href="#modified_page:11"><span class="id" title="binder">modified_page</span></a> <a id="cs:12" class="idref" href="#cs:12"><span class="id" title="binder">cs</span></a> <a id="regs:13" class="idref" href="#regs:13"><span class="id" title="binder">regs</span></a> <a id="mem:14" class="idref" href="#mem:14"><span class="id" title="binder">mem</span></a> <a id="___1:15" class="idref" href="#___1:15"><span class="id" title="binder">___1</span></a> <a id="addr:16" class="idref" href="#addr:16"><span class="id" title="binder">addr</span></a> <a id="hptr_mod:17" class="idref" href="#hptr_mod:17"><span class="id" title="binder">hptr_mod</span></a> <a id="ctx:18" class="idref" href="#ctx:18"><span class="id" title="binder">ctx</span></a> <a id="high224:19" class="idref" href="#high224:19"><span class="id" title="binder">high224</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="selected_page_id:20" class="idref" href="#selected_page_id:20"><span class="id" title="binder">selected_page_id</span></a> := <a class="idref" href="#heap_variant_id"><span class="id" title="definition">heap_variant_id</span></a> <a class="idref" href="#heap_variant:6"><span class="id" title="variable">heap_variant</span></a> <a class="idref" href="#cs:12"><span class="id" title="variable">cs</span></a> <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#hptr:3"><span class="id" title="variable">hptr</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#mk_hptr"><span class="id" title="constructor">mk_hptr</span></a> <a class="idref" href="#addr:16"><span class="id" title="variable">addr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#addr:16"><span class="id" title="variable">addr</span></a> <a class="idref" href="#14c765d8614826944bc2b2afe356aa2c"><span class="id" title="notation">≤</span></a> <a class="idref" href="#MAX_OFFSET_TO_DEREF_LOW_U32"><span class="id" title="definition">MAX_OFFSET_TO_DEREF_LOW_U32</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#heap_variant_page"><span class="id" title="definition">heap_variant_page</span></a> <a class="idref" href="#heap_variant:6"><span class="id" title="variable">heap_variant</span></a> <a class="idref" href="#cs:12"><span class="id" title="variable">cs</span></a> <a class="idref" href="#mem:14"><span class="id" title="variable">mem</span></a> <a class="idref" href="#selected_page:9"><span class="id" title="variable">selected_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#word_upper_bound"><span class="id" title="inductive">word_upper_bound</span></a> <a class="idref" href="#hptr:3"><span class="id" title="variable">hptr</span></a> <a class="idref" href="#bound:10"><span class="id" title="variable">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bound_grow_pay"><span class="id" title="inductive">bound_grow_pay</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#heap_variant:6"><span class="id" title="variable">heap_variant</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#bound:10"><span class="id" title="variable">bound</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#cs:12"><span class="id" title="variable">cs</span></a> <a class="idref" href="#new_cs:5"><span class="id" title="variable">new_cs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mb_store_word_result"><span class="id" title="inductive">mb_store_word_result</span></a> <a class="idref" href="#BigEndian"><span class="id" title="constructor">BigEndian</span></a> <a class="idref" href="#selected_page:9"><span class="id" title="variable">selected_page</span></a> <a class="idref" href="#addr:16"><span class="id" title="variable">addr</span></a> <a class="idref" href="#value:7"><span class="id" title="variable">value</span></a> <a class="idref" href="#modified_page:11"><span class="id" title="variable">modified_page</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#page_replace"><span class="id" title="inductive">page_replace</span></a> <a class="idref" href="#selected_page_id:20"><span class="id" title="variable">selected_page_id</span></a> (<a class="idref" href="#mk_page"><span class="id" title="constructor">mk_page</span></a> (<a class="idref" href="#DataPage"><span class="id" title="constructor">DataPage</span></a> <a class="idref" href="#modified_page:11"><span class="id" title="variable">modified_page</span></a>)) <a class="idref" href="#mem:14"><span class="id" title="variable">mem</span></a> <a class="idref" href="#new_mem:8"><span class="id" title="variable">new_mem</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#hp_inc"><span class="id" title="inductive">hp_inc</span></a> <a class="idref" href="#hptr:3"><span class="id" title="variable">hptr</span></a> <a class="idref" href="#hptr_mod:17"><span class="id" title="variable">hptr_mod</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_storeinc:1"><span class="id" title="inductive">step_storeinc</span></a> (<a class="idref" href="#OpStoreInc"><span class="id" title="constructor">OpStoreInc</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high224:19"><span class="id" title="variable">high224</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#hptr:3"><span class="id" title="variable">hptr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)) (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#___1:15"><span class="id" title="variable">___1</span></a> <a class="idref" href="#value:7"><span class="id" title="variable">value</span></a>) <a class="idref" href="#heap_variant:6"><span class="id" title="variable">heap_variant</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high224:19"><span class="id" title="variable">high224</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#hptr_mod:17"><span class="id" title="variable">hptr_mod</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#cs:12"><span class="id" title="variable">cs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#mem:14"><span class="id" title="variable">mem</span></a>;<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#regs:13"><span class="id" title="variable">regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags:4"><span class="id" title="variable">flags</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#ctx:18"><span class="id" title="variable">ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#new_cs:5"><span class="id" title="variable">new_cs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#new_mem:8"><span class="id" title="variable">new_mem</span></a>;<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#regs:13"><span class="id" title="variable">regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags:4"><span class="id" title="variable">flags</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#ctx:18"><span class="id" title="variable">ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
</div>

<div class="doc"><h2 id="panics">Panics</h2>
<ol type="1">
<li>Accessing an address greater than <span
class="inlinecode"><a class="idref" href="#MAX_OFFSET_TO_DEREF_LOW_U32"><span
class="id"
title="definition">MAX_OFFSET_TO_DEREF_LOW_U32</span></a></span>.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Store_offset_too_large" class="idref" href="#step_Store_offset_too_large"><span class="id" title="constructor">step_Store_offset_too_large</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="heap_variant:21" class="idref" href="#heap_variant:21"><span class="id" title="binder">heap_variant</span></a> <a id="___1:22" class="idref" href="#___1:22"><span class="id" title="binder">___1</span></a> <a id="___2:23" class="idref" href="#___2:23"><span class="id" title="binder">___2</span></a> <a id="addr:24" class="idref" href="#addr:24"><span class="id" title="binder">addr</span></a> <a id="s1:25" class="idref" href="#s1:25"><span class="id" title="binder">s1</span></a> <a id="s2:26" class="idref" href="#s2:26"><span class="id" title="binder">s2</span></a> <a id="high224:27" class="idref" href="#high224:27"><span class="id" title="binder">high224</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#addr:24"><span class="id" title="variable">addr</span></a> <a class="idref" href="#::ZMod_scope:x_'>'_x"><span class="id" title="notation">></span></a> <a class="idref" href="#MAX_OFFSET_TO_DEREF_LOW_U32"><span class="id" title="definition">MAX_OFFSET_TO_DEREF_LOW_U32</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#HeapPtrOffsetTooLarge"><span class="id" title="constructor">HeapPtrOffsetTooLarge</span></a> <a class="idref" href="#s1:25"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:26"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_storeinc:1"><span class="id" title="inductive">step_storeinc</span></a> (<a class="idref" href="#OpStoreInc"><span class="id" title="constructor">OpStoreInc</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high224:27"><span class="id" title="variable">high224</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#mk_hptr"><span class="id" title="constructor">mk_hptr</span></a> <a class="idref" href="#addr:24"><span class="id" title="variable">addr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)) <a class="idref" href="#___1:22"><span class="id" title="variable">___1</span></a> <a class="idref" href="#heap_variant:21"><span class="id" title="variable">heap_variant</span></a> <a class="idref" href="#___2:23"><span class="id" title="variable">___2</span></a>) <a class="idref" href="#s1:25"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:26"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;</div>

<div class="doc"><ol start="2" type="1">
<li>Fat pointer provided where heap pointer is expected.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Store_expects_intvalue" class="idref" href="#step_Store_expects_intvalue"><span class="id" title="constructor">step_Store_expects_intvalue</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s1:28" class="idref" href="#s1:28"><span class="id" title="binder">s1</span></a> <a id="s2:29" class="idref" href="#s2:29"><span class="id" title="binder">s2</span></a> <a id="___1:30" class="idref" href="#___1:30"><span class="id" title="binder">___1</span></a> <a id="___2:31" class="idref" href="#___2:31"><span class="id" title="binder">___2</span></a> <a id="___3:32" class="idref" href="#___3:32"><span class="id" title="binder">___3</span></a> <a id="___4:33" class="idref" href="#___4:33"><span class="id" title="binder">___4</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#ExpectedHeapPointer"><span class="id" title="constructor">ExpectedHeapPointer</span></a>  <a class="idref" href="#s1:28"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:29"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_storeinc:1"><span class="id" title="inductive">step_storeinc</span></a> (<a class="idref" href="#OpStoreInc"><span class="id" title="constructor">OpStoreInc</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#___1:30"><span class="id" title="variable">___1</span></a>)) <a class="idref" href="#___2:31"><span class="id" title="variable">___2</span></a> <a class="idref" href="#___3:32"><span class="id" title="variable">___3</span></a> <a class="idref" href="#___4:33"><span class="id" title="variable">___4</span></a>) <a class="idref" href="#s1:28"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:29"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;</div>

<div class="doc"><ol start="3" type="1">
<li>Accessing an address requires growing the bound of the corresponding
heap variant, but the growth is unaffordable.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Store_growth_unaffordable" class="idref" href="#step_Store_growth_unaffordable"><span class="id" title="constructor">step_Store_growth_unaffordable</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="s1:34" class="idref" href="#s1:34"><span class="id" title="binder">s1</span></a> <a id="s2:35" class="idref" href="#s2:35"><span class="id" title="binder">s2</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>) <a id="cs:36" class="idref" href="#cs:36"><span class="id" title="binder">cs</span></a> <a id="hptr:37" class="idref" href="#hptr:37"><span class="id" title="binder">hptr</span></a> <a id="bound:38" class="idref" href="#bound:38"><span class="id" title="binder">bound</span></a> <a id="heap_variant:39" class="idref" href="#heap_variant:39"><span class="id" title="binder">heap_variant</span></a> <a id="___1:40" class="idref" href="#___1:40"><span class="id" title="binder">___1</span></a> <a id="___2:41" class="idref" href="#___2:41"><span class="id" title="binder">___2</span></a> <a id="high242:42" class="idref" href="#high242:42"><span class="id" title="binder">high242</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#word_upper_bound"><span class="id" title="inductive">word_upper_bound</span></a> <a class="idref" href="#hptr:37"><span class="id" title="variable">hptr</span></a> <a class="idref" href="#bound:38"><span class="id" title="variable">bound</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#growth_to_bound_unaffordable"><span class="id" title="inductive">growth_to_bound_unaffordable</span></a> <a class="idref" href="#cs:36"><span class="id" title="variable">cs</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#heap_variant:39"><span class="id" title="variable">heap_variant</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#bound:38"><span class="id" title="variable">bound</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s1:34"><span class="id" title="variable">s1</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#cs:36"><span class="id" title="variable">cs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#HeapGrowthUnaffordable"><span class="id" title="constructor">HeapGrowthUnaffordable</span></a> <a class="idref" href="#s1:34"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:35"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_storeinc:1"><span class="id" title="inductive">step_storeinc</span></a> (<a class="idref" href="#OpStoreInc"><span class="id" title="constructor">OpStoreInc</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high242:42"><span class="id" title="variable">high242</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#hptr:37"><span class="id" title="variable">hptr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)) <a class="idref" href="#___1:40"><span class="id" title="variable">___1</span></a> <a class="idref" href="#heap_variant:39"><span class="id" title="variable">heap_variant</span></a> <a class="idref" href="#___2:41"><span class="id" title="variable">___2</span></a>) <a class="idref" href="#s1:34"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:35"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;</div>

<div class="doc"><ol start="4" type="1">
<li>Incrementing the pointer leads to overflow.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Store_inc_overflow" class="idref" href="#step_Store_inc_overflow"><span class="id" title="constructor">step_Store_inc_overflow</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="s1:43" class="idref" href="#s1:43"><span class="id" title="binder">s1</span></a> <a id="s2:44" class="idref" href="#s2:44"><span class="id" title="binder">s2</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>) <a id="hptr:45" class="idref" href="#hptr:45"><span class="id" title="binder">hptr</span></a> <a id="___1:46" class="idref" href="#___1:46"><span class="id" title="binder">___1</span></a> <a id="___2:47" class="idref" href="#___2:47"><span class="id" title="binder">___2</span></a> <a id="___3:48" class="idref" href="#___3:48"><span class="id" title="binder">___3</span></a> <a id="high242:49" class="idref" href="#high242:49"><span class="id" title="binder">high242</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#hp_inc_OF"><span class="id" title="definition">hp_inc_OF</span></a> <a class="idref" href="#hptr:45"><span class="id" title="variable">hptr</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#HeapGrowthUnaffordable"><span class="id" title="constructor">HeapGrowthUnaffordable</span></a> <a class="idref" href="#s1:43"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:44"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_storeinc:1"><span class="id" title="inductive">step_storeinc</span></a> (<a class="idref" href="#OpStoreInc"><span class="id" title="constructor">OpStoreInc</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high242:49"><span class="id" title="variable">high242</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#hptr:45"><span class="id" title="variable">hptr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)) <a class="idref" href="#___1:46"><span class="id" title="variable">___1</span></a> <a class="idref" href="#___2:47"><span class="id" title="variable">___2</span></a> <a class="idref" href="#___3:48"><span class="id" title="variable">___3</span></a>) <a class="idref" href="#s1:43"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:44"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#StoreIncDefinition"><span class="id" title="section">StoreIncDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.PtrAdd</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Arith</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryBase</span></a> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <span class="id" title="module">spec</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="PtrAddDefinition" class="idref" href="#PtrAddDefinition"><span class="id" title="section">PtrAddDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
</div>

<div class="doc"><h1 id="opptradd">OpPtrAdd</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpPtrAdd"><span
class="id" title="constructor">OpPtrAdd</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">swap</span>:</span>
<span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><p><code>addp in1, in2, out1</code></p></li>
<li><p><code>addp.s in1, in2, out1</code> to set <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span>
modifier</p></li>
</ul>
<h2 id="legacy-syntax">Legacy syntax</h2>
<ul>
<li><code>ptr.add in1, in2, out</code></li>
<li><code>ptr.add.s in1, in2, out</code></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Takes a fat pointer from <code>in1</code> and a 32-bit unsigned
number from <code>in2</code>. Advances the fat pointer’s offset by that
number, and writes (<code>in2</code>{128…255} || incremented pointer) to
<code>out</code>.</p>
<h2 id="semantic">Semantic</h2>
<p><strong>Note</strong>: In the following description the operands are
bound after taking <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span> modifier into
account.</p>
<ol type="1">
<li><p>Fetch input operands, swap them if <code>swap</code> modifier is
set. Now operands are <span class="math inline">\mathit{op_1}</span> and
<span class="math inline">\mathit{op_2}</span>.</p></li>
<li><p>Ensure the <span class="math inline">\mathit{op_1}</span> is
tagged as a pointer, and <span class="math inline">\mathit{op_2}</span>
is not tagged as a pointer. Otherwise panic.</p></li>
<li><p>Decode fat pointer <span
class="math inline">\mathit{ptr_{in}}</span> from <span
class="math inline">\mathit{op_1}</span></p></li>
<li><p>Let <span class="math inline">\mathit{diff}</span> be <span
class="math inline">\mathit{op_2}</span> truncated to 32 bits:</p>
<p><span class="math display">\mathit{diff} := \mathit{op}_2 \mod
2^{32}</span></p>
<p>It is required that <span class="math inline">\mathit{op}_2 &lt;
\texttt{MAX\_OFFSET\_FOR\_ADD\_SUB}</span>, otherwise VM
panics.</p></li>
<li><p>Advance pointer offset of <span
class="math inline">\mathit{ptr_{in}}</span> by <span
class="math inline">\mathit{diff}</span>:</p></li>
</ol>
<p><span class="math display">\mathit{ptr_{out}} := \mathit{ptr_{in}} |
_\mathit{offset := offset + diff}</span></p>
<ol start="6" type="1">
<li>Store the result, tagged as a pointer, to <code>out</code>. The most
significant 128 bits of result are taken from <code>op1</code>, the
least significant bits hold an encoded pointer:</li>
</ol>
<p><span class="math display">result := \mathit{op_1}\{255\dots128\}
\#\# \texttt{encode}(\mathit{ptr_{out}})</span></p>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, because <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Used as a substitute for an absent MOV instruction to copy fat
pointers around.</li>
<li>Manipulating fat pointers to pass slices of memory between
functions.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<p>See <span
class="inlinecode"><a class="idref" href="#OpPtrAdd"><span
class="id" title="constructor">OpPtrAdd</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpPtrSub"><span
class="id" title="constructor">OpPtrSub</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpPtrShrink"><span
class="id" title="constructor">OpPtrShrink</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpPtrPack"><span
class="id" title="constructor">OpPtrPack</span></a></span>.</p>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_ptradd" class="idref" href="#step_ptradd"><span class="id" title="inductive">step_ptradd</span></a> : <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
&nbsp;&nbsp;| <a id="step_PtrAdd" class="idref" href="#step_PtrAdd"><span class="id" title="constructor">step_PtrAdd</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s:3" class="idref" href="#s:3"><span class="id" title="binder">s</span></a> <a id="ofs:4" class="idref" href="#ofs:4"><span class="id" title="binder">ofs</span></a> <a id="new_ofs:5" class="idref" href="#new_ofs:5"><span class="id" title="binder">new_ofs</span></a> <a id="pid:6" class="idref" href="#pid:6"><span class="id" title="binder">pid</span></a> <a id="high128:7" class="idref" href="#high128:7"><span class="id" title="binder">high128</span></a> (<a id="arg_delta:8" class="idref" href="#arg_delta:8"><span class="id" title="binder">arg_delta</span></a>:<a class="idref" href="#word"><span class="id" title="definition">word</span></a>) (<a id="mem_delta:9" class="idref" href="#mem_delta:9"><span class="id" title="binder">mem_delta</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>) <a id="span:10" class="idref" href="#span:10"><span class="id" title="binder">span</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#arg_delta:8"><span class="id" title="variable">arg_delta</span></a> <a class="idref" href="#::ZMod_scope:x_'<'_x"><span class="id" title="notation"><</span></a> <a class="idref" href="#MAX_OFFSET_FOR_ADD_SUB"><span class="id" title="definition">MAX_OFFSET_FOR_ADD_SUB</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mem_delta:9"><span class="id" title="variable">mem_delta</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">low</span> <a class="idref" href="#mem_address_bits"><span class="id" title="definition">mem_address_bits</span></a> <a class="idref" href="#arg_delta:8"><span class="id" title="variable">arg_delta</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#new_ofs:5"><span class="id" title="variable">new_ofs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ofs:4"><span class="id" title="variable">ofs</span></a> <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <a class="idref" href="#mem_delta:9"><span class="id" title="variable">mem_delta</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ptradd:1"><span class="id" title="inductive">step_ptradd</span></a> (<a class="idref" href="#OpPtrAdd"><span class="id" title="constructor">OpPtrAdd</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high128:7"><span class="id" title="variable">high128</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> (<a class="idref" href="#mk_fat_ptr"><span class="id" title="constructor">mk_fat_ptr</span></a> <a class="idref" href="#pid:6"><span class="id" title="variable">pid</span></a> (<a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> <a class="idref" href="#span:10"><span class="id" title="variable">span</span></a> <a class="idref" href="#ofs:4"><span class="id" title="variable">ofs</span></a>))<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#arg_delta:8"><span class="id" title="variable">arg_delta</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high128:7"><span class="id" title="variable">high128</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> (<a class="idref" href="#mk_fat_ptr"><span class="id" title="constructor">mk_fat_ptr</span></a> <a class="idref" href="#pid:6"><span class="id" title="variable">pid</span></a> (<a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> <a class="idref" href="#span:10"><span class="id" title="variable">span</span></a> <a class="idref" href="#new_ofs:5"><span class="id" title="variable">new_ofs</span></a>))<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#s:3"><span class="id" title="variable">s</span></a> <a class="idref" href="#s:3"><span class="id" title="variable">s</span></a><br/>
</div>

<div class="doc"><h2 id="panics">Panics</h2>
<ol type="1">
<li>First argument is not a pointer (after accounting for
<code>swap</code>).</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_PtrAdd_in1_not_ptr" class="idref" href="#step_PtrAdd_in1_not_ptr"><span class="id" title="constructor">step_PtrAdd_in1_not_ptr</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s1:11" class="idref" href="#s1:11"><span class="id" title="binder">s1</span></a> <a id="s2:12" class="idref" href="#s2:12"><span class="id" title="binder">s2</span></a> <a id="___:13" class="idref" href="#___:13"><span class="id" title="binder">___</span></a> <a id="____:14" class="idref" href="#____:14"><span class="id" title="binder">____</span></a> <a id="_____:15" class="idref" href="#_____:15"><span class="id" title="binder">_____</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#ExpectedFatPointer"><span class="id" title="constructor">ExpectedFatPointer</span></a> <a class="idref" href="#s1:11"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:12"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ptradd:1"><span class="id" title="inductive">step_ptradd</span></a> (<a class="idref" href="#OpPtrAdd"><span class="id" title="constructor">OpPtrAdd</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#___:13"><span class="id" title="variable">___</span></a>)) <a class="idref" href="#____:14"><span class="id" title="variable">____</span></a> <a class="idref" href="#_____:15"><span class="id" title="variable">_____</span></a>) <a class="idref" href="#s1:11"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:12"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ol start="2" type="1">
<li>Second argument is a pointer (after accounting for
<code>swap</code>).</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_PtrAdd_in2_ptr" class="idref" href="#step_PtrAdd_in2_ptr"><span class="id" title="constructor">step_PtrAdd_in2_ptr</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s1:16" class="idref" href="#s1:16"><span class="id" title="binder">s1</span></a> <a id="s2:17" class="idref" href="#s2:17"><span class="id" title="binder">s2</span></a> <a id="___:18" class="idref" href="#___:18"><span class="id" title="binder">___</span></a> <a id="____:19" class="idref" href="#____:19"><span class="id" title="binder">____</span></a> <a id="_____:20" class="idref" href="#_____:20"><span class="id" title="binder">_____</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#ExpectedInteger"><span class="id" title="constructor">ExpectedInteger</span></a> <a class="idref" href="#s1:16"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:17"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ptradd:1"><span class="id" title="inductive">step_ptradd</span></a> (<a class="idref" href="#OpPtrAdd"><span class="id" title="constructor">OpPtrAdd</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#___:18"><span class="id" title="variable">___</span></a>)) (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#____:19"><span class="id" title="variable">____</span></a>) <a class="idref" href="#_____:20"><span class="id" title="variable">_____</span></a>) <a class="idref" href="#s1:16"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:17"><span class="id" title="variable">s2</span></a><br/>
<br/>
&nbsp;&nbsp;</div>

<div class="doc"><ol start="3" type="1">
<li>Second argument is larger than <span
class="inlinecode"><a class="idref" href="#MAX_OFFSET_FOR_ADD_SUB"><span
class="id" title="definition">MAX_OFFSET_FOR_ADD_SUB</span></a></span>
(after accounting for <code>swap</code>).</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_PtrAdd_diff_too_large" class="idref" href="#step_PtrAdd_diff_too_large"><span class="id" title="constructor">step_PtrAdd_diff_too_large</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s1:21" class="idref" href="#s1:21"><span class="id" title="binder">s1</span></a> <a id="s2:22" class="idref" href="#s2:22"><span class="id" title="binder">s2</span></a> (<a id="arg_delta:23" class="idref" href="#arg_delta:23"><span class="id" title="binder">arg_delta</span></a>:<a class="idref" href="#word"><span class="id" title="definition">word</span></a>) (<a id="mem_delta:24" class="idref" href="#mem_delta:24"><span class="id" title="binder">mem_delta</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>) <a id="___:25" class="idref" href="#___:25"><span class="id" title="binder">___</span></a> <a id="____:26" class="idref" href="#____:26"><span class="id" title="binder">____</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#arg_delta:23"><span class="id" title="variable">arg_delta</span></a> <a class="idref" href="#e27af0fe97b7e2880e3637aac9d3abcc"><span class="id" title="notation">≥</span></a> <a class="idref" href="#MAX_OFFSET_FOR_ADD_SUB"><span class="id" title="definition">MAX_OFFSET_FOR_ADD_SUB</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#FatPointerDeltaTooLarge"><span class="id" title="constructor">FatPointerDeltaTooLarge</span></a> <a class="idref" href="#s1:21"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:22"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ptradd:1"><span class="id" title="inductive">step_ptradd</span></a> (<a class="idref" href="#OpPtrAdd"><span class="id" title="constructor">OpPtrAdd</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#___:25"><span class="id" title="variable">___</span></a>)) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#arg_delta:23"><span class="id" title="variable">arg_delta</span></a>) <a class="idref" href="#____:26"><span class="id" title="variable">____</span></a>) <a class="idref" href="#s1:21"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:22"><span class="id" title="variable">s2</span></a><br/>
<br/>
&nbsp;&nbsp;</div>

<div class="doc"><ol start="4" type="1">
<li>Addition overflows.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_PtrAdd_overflow" class="idref" href="#step_PtrAdd_overflow"><span class="id" title="constructor">step_PtrAdd_overflow</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s1:27" class="idref" href="#s1:27"><span class="id" title="binder">s1</span></a> <a id="s2:28" class="idref" href="#s2:28"><span class="id" title="binder">s2</span></a> <a id="ofs:29" class="idref" href="#ofs:29"><span class="id" title="binder">ofs</span></a> <a id="new_ofs:30" class="idref" href="#new_ofs:30"><span class="id" title="binder">new_ofs</span></a> <a id="pid:31" class="idref" href="#pid:31"><span class="id" title="binder">pid</span></a> (<a id="arg_delta:32" class="idref" href="#arg_delta:32"><span class="id" title="binder">arg_delta</span></a>:<a class="idref" href="#word"><span class="id" title="definition">word</span></a>) (<a id="mem_delta:33" class="idref" href="#mem_delta:33"><span class="id" title="binder">mem_delta</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>) <a id="span:34" class="idref" href="#span:34"><span class="id" title="binder">span</span></a> <a id="high128:35" class="idref" href="#high128:35"><span class="id" title="binder">high128</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#arg_delta:32"><span class="id" title="variable">arg_delta</span></a> <a class="idref" href="#::ZMod_scope:x_'<'_x"><span class="id" title="notation"><</span></a> <a class="idref" href="#MAX_OFFSET_FOR_ADD_SUB"><span class="id" title="definition">MAX_OFFSET_FOR_ADD_SUB</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mem_delta:33"><span class="id" title="variable">mem_delta</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">low</span> <a class="idref" href="#mem_address_bits"><span class="id" title="definition">mem_address_bits</span></a> <a class="idref" href="#arg_delta:32"><span class="id" title="variable">arg_delta</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#true"><span class="id" title="constructor">true</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#new_ofs:30"><span class="id" title="variable">new_ofs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ofs:29"><span class="id" title="variable">ofs</span></a> <a class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">+</span></a> <a class="idref" href="#mem_delta:33"><span class="id" title="variable">mem_delta</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#FatPointerOverflow"><span class="id" title="constructor">FatPointerOverflow</span></a> <a class="idref" href="#s1:27"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:28"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ptradd:1"><span class="id" title="inductive">step_ptradd</span></a> (<a class="idref" href="#OpPtrAdd"><span class="id" title="constructor">OpPtrAdd</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high128:35"><span class="id" title="variable">high128</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> (<a class="idref" href="#mk_fat_ptr"><span class="id" title="constructor">mk_fat_ptr</span></a> <a class="idref" href="#pid:31"><span class="id" title="variable">pid</span></a> (<a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> <a class="idref" href="#span:34"><span class="id" title="variable">span</span></a> <a class="idref" href="#ofs:29"><span class="id" title="variable">ofs</span></a>))<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#arg_delta:32"><span class="id" title="variable">arg_delta</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high128:35"><span class="id" title="variable">high128</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> (<a class="idref" href="#mk_fat_ptr"><span class="id" title="constructor">mk_fat_ptr</span></a> <a class="idref" href="#pid:31"><span class="id" title="variable">pid</span></a> (<a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> <a class="idref" href="#span:34"><span class="id" title="variable">span</span></a> <a class="idref" href="#new_ofs:30"><span class="id" title="variable">new_ofs</span></a>))<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#s1:27"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:28"><span class="id" title="variable">s2</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#PtrAddDefinition"><span class="id" title="section">PtrAddDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.PtrSub</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Arith</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">Core</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">MemoryBase</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">Pointer</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">State</span></a><br/>
<a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a><br/>
.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">spec</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="PtrSubDefinition" class="idref" href="#PtrSubDefinition"><span class="id" title="section">PtrSubDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
</div>

<div class="doc"><h1 id="opptrsub">OpPtrSub</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpPtrSub"><span
class="id" title="constructor">OpPtrSub</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">swap</span>:</span>
<span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><p><code>subp in1, in2, out1</code></p></li>
<li><p><code>subp.s in1, in2, out1</code> to set <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span>
modifier</p></li>
</ul>
<h2 id="legacy-syntax">Legacy syntax</h2>
<ul>
<li><code>ptr.sub in1, in2, out</code></li>
<li><code>ptr.sub.s in1, in2, out</code></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Takes a fat pointer from <code>in1</code> and a 32-bit unsigned
number from <code>in2</code>. Advances the fat pointer’s offset by that
number, and writes (<code>in2</code>{128…255} || incremented pointer) to
<code>out</code>.</p>
<h2 id="semantic">Semantic</h2>
<p><strong>Note</strong>: In the following description the operands are
bound after taking <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span> modifier into
account.</p>
<ol type="1">
<li><p>Fetch input operands, swap them if <code>swap</code> modifier is
set. Now operands are <span class="math inline">\mathit{op_1}</span> and
<span class="math inline">\mathit{op_2}</span>.</p></li>
<li><p>Ensure the <span class="math inline">\mathit{op_1}</span> is
tagged as a pointer, and <span class="math inline">\mathit{op_2}</span>
is not tagged as a pointer. Otherwise panic.</p></li>
<li><p>Decode fat pointer <span
class="math inline">\mathit{ptr_{in}}</span> from <span
class="math inline">\mathit{op_1}</span></p></li>
<li><p>Let <span class="math inline">\mathit{diff}</span> be <span
class="math inline">\mathit{op_2}</span> truncated to 32 bits:</p>
<p><span class="math display">\mathit{diff} := \mathit{op}_2 \mod
2^{32}</span></p>
<p>It is required that <span class="math inline">\mathit{op}_2&lt;
\texttt{MAX\_OFFSET\_FOR\_ADD\_SUB}</span>, otherwise VM
panics.</p></li>
<li><p>Advance pointer offset of <span
class="math inline">\mathit{ptr_{in}}</span> by <span
class="math inline">\mathit{diff}</span>:</p></li>
</ol>
<p><span class="math display">\mathit{ptr_{out}} := \mathit{ptr_{in}} |
_\mathit{offset := offset - diff}</span></p>
<ol start="6" type="1">
<li>Store the result, tagged as a pointer, to <code>out</code>. The most
significant 128 bits of result are taken from <code>op1</code>, the
least significant bits hold an encoded pointer:</li>
</ol>
<p><span class="math display">result := \mathit{op_1}\{255\dots128\}
\#\# \texttt{encode}(\mathit{ptr_{out}})</span></p>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, because <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Manipulating fat pointers to pass slices of memory between
functions.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<p>See <span
class="inlinecode"><a class="idref" href="#OpPtrAdd"><span
class="id" title="constructor">OpPtrAdd</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpPtrSub"><span
class="id" title="constructor">OpPtrSub</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpPtrShrink"><span
class="id" title="constructor">OpPtrShrink</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpPtrPack"><span
class="id" title="constructor">OpPtrPack</span></a></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_ptrsub" class="idref" href="#step_ptrsub"><span class="id" title="inductive">step_ptrsub</span></a> : <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
&nbsp;&nbsp;| <a id="step_PtrSub" class="idref" href="#step_PtrSub"><span class="id" title="constructor">step_PtrSub</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="high128:3" class="idref" href="#high128:3"><span class="id" title="binder">high128</span></a> <a id="s:4" class="idref" href="#s:4"><span class="id" title="binder">s</span></a> <a id="ofs:5" class="idref" href="#ofs:5"><span class="id" title="binder">ofs</span></a> <a id="new_ofs:6" class="idref" href="#new_ofs:6"><span class="id" title="binder">new_ofs</span></a> <a id="pid:7" class="idref" href="#pid:7"><span class="id" title="binder">pid</span></a> (<a id="arg_delta:8" class="idref" href="#arg_delta:8"><span class="id" title="binder">arg_delta</span></a>:<a class="idref" href="#word"><span class="id" title="definition">word</span></a>) (<a id="mem_delta:9" class="idref" href="#mem_delta:9"><span class="id" title="binder">mem_delta</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>) <a id="span:10" class="idref" href="#span:10"><span class="id" title="binder">span</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#arg_delta:8"><span class="id" title="variable">arg_delta</span></a> <a class="idref" href="#14c765d8614826944bc2b2afe356aa2c"><span class="id" title="notation">≤</span></a> <a class="idref" href="#MAX_OFFSET_FOR_ADD_SUB"><span class="id" title="definition">MAX_OFFSET_FOR_ADD_SUB</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a><a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mem_delta:9"><span class="id" title="variable">mem_delta</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">low</span> <a class="idref" href="#mem_address_bits"><span class="id" title="definition">mem_address_bits</span></a> <a class="idref" href="#arg_delta:8"><span class="id" title="variable">arg_delta</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#false"><span class="id" title="constructor">false</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#new_ofs:6"><span class="id" title="variable">new_ofs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ofs:5"><span class="id" title="variable">ofs</span></a> <a class="idref" href="#::ZMod_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="#mem_delta:9"><span class="id" title="variable">mem_delta</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ptrsub:1"><span class="id" title="inductive">step_ptrsub</span></a> (<a class="idref" href="#OpPtrSub"><span class="id" title="constructor">OpPtrSub</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high128:3"><span class="id" title="variable">high128</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> (<a class="idref" href="#mk_fat_ptr"><span class="id" title="constructor">mk_fat_ptr</span></a> <a class="idref" href="#pid:7"><span class="id" title="variable">pid</span></a> (<a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> <a class="idref" href="#span:10"><span class="id" title="variable">span</span></a> <a class="idref" href="#ofs:5"><span class="id" title="variable">ofs</span></a>))<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#arg_delta:8"><span class="id" title="variable">arg_delta</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high128:3"><span class="id" title="variable">high128</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> (<a class="idref" href="#mk_fat_ptr"><span class="id" title="constructor">mk_fat_ptr</span></a> <a class="idref" href="#pid:7"><span class="id" title="variable">pid</span></a> (<a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> <a class="idref" href="#span:10"><span class="id" title="variable">span</span></a> <a class="idref" href="#new_ofs:6"><span class="id" title="variable">new_ofs</span></a>))<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#s:4"><span class="id" title="variable">s</span></a> <a class="idref" href="#s:4"><span class="id" title="variable">s</span></a><br/>
</div>

<div class="doc"><h2 id="panics">Panics</h2>
<ol type="1">
<li>First argument is not a pointer (after accounting for
<code>swap</code>).</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_PtrSub_in1_not_ptr" class="idref" href="#step_PtrSub_in1_not_ptr"><span class="id" title="constructor">step_PtrSub_in1_not_ptr</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s1:11" class="idref" href="#s1:11"><span class="id" title="binder">s1</span></a> <a id="s2:12" class="idref" href="#s2:12"><span class="id" title="binder">s2</span></a> <a id="___:13" class="idref" href="#___:13"><span class="id" title="binder">___</span></a> <a id="____:14" class="idref" href="#____:14"><span class="id" title="binder">____</span></a> <a id="_____:15" class="idref" href="#_____:15"><span class="id" title="binder">_____</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#ExpectedFatPointer"><span class="id" title="constructor">ExpectedFatPointer</span></a> <a class="idref" href="#s1:11"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:12"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ptrsub:1"><span class="id" title="inductive">step_ptrsub</span></a> (<a class="idref" href="#OpPtrSub"><span class="id" title="constructor">OpPtrSub</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#___:13"><span class="id" title="variable">___</span></a>)) <a class="idref" href="#____:14"><span class="id" title="variable">____</span></a> <a class="idref" href="#_____:15"><span class="id" title="variable">_____</span></a>) <a class="idref" href="#s1:11"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:12"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ol start="2" type="1">
<li>Second argument is a pointer (after accounting for
<code>swap</code>).</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_PtrSub_in2_ptr" class="idref" href="#step_PtrSub_in2_ptr"><span class="id" title="constructor">step_PtrSub_in2_ptr</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s1:16" class="idref" href="#s1:16"><span class="id" title="binder">s1</span></a> <a id="s2:17" class="idref" href="#s2:17"><span class="id" title="binder">s2</span></a> <a id="__:18" class="idref" href="#__:18"><span class="id" title="binder">__</span></a> <a id="____:19" class="idref" href="#____:19"><span class="id" title="binder">____</span></a> <a id="_____:20" class="idref" href="#_____:20"><span class="id" title="binder">_____</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#ExpectedFatPointer"><span class="id" title="constructor">ExpectedFatPointer</span></a> <a class="idref" href="#s1:16"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:17"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ptrsub:1"><span class="id" title="inductive">step_ptrsub</span></a> (<a class="idref" href="#OpPtrSub"><span class="id" title="constructor">OpPtrSub</span></a> <a class="idref" href="#__:18"><span class="id" title="variable">__</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#____:19"><span class="id" title="variable">____</span></a>) <a class="idref" href="#_____:20"><span class="id" title="variable">_____</span></a>) <a class="idref" href="#s1:16"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:17"><span class="id" title="variable">s2</span></a><br/>
<br/>
&nbsp;&nbsp;</div>

<div class="doc"><ol start="3" type="1">
<li>Second argument is larger than <span class="inlinecode"><span
class="id" title="var">MAX_OFFSET_FOR_SUB_SUB</span></span> (after
accounting for <code>swap</code>).</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_PtrSub_diff_too_large" class="idref" href="#step_PtrSub_diff_too_large"><span class="id" title="constructor">step_PtrSub_diff_too_large</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s1:21" class="idref" href="#s1:21"><span class="id" title="binder">s1</span></a> <a id="s2:22" class="idref" href="#s2:22"><span class="id" title="binder">s2</span></a> (<a id="arg_delta:23" class="idref" href="#arg_delta:23"><span class="id" title="binder">arg_delta</span></a>:<a class="idref" href="#word"><span class="id" title="definition">word</span></a>) (<a id="mem_delta:24" class="idref" href="#mem_delta:24"><span class="id" title="binder">mem_delta</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>) <a id="___:25" class="idref" href="#___:25"><span class="id" title="binder">___</span></a> <a id="____:26" class="idref" href="#____:26"><span class="id" title="binder">____</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#arg_delta:23"><span class="id" title="variable">arg_delta</span></a> <a class="idref" href="#e27af0fe97b7e2880e3637aac9d3abcc"><span class="id" title="notation">≥</span></a> <a class="idref" href="#MAX_OFFSET_FOR_ADD_SUB"><span class="id" title="definition">MAX_OFFSET_FOR_ADD_SUB</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#FatPointerDeltaTooLarge"><span class="id" title="constructor">FatPointerDeltaTooLarge</span></a> <a class="idref" href="#s1:21"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:22"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ptrsub:1"><span class="id" title="inductive">step_ptrsub</span></a> (<a class="idref" href="#OpPtrSub"><span class="id" title="constructor">OpPtrSub</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#___:25"><span class="id" title="variable">___</span></a>)) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#arg_delta:23"><span class="id" title="variable">arg_delta</span></a>) <a class="idref" href="#____:26"><span class="id" title="variable">____</span></a>) <a class="idref" href="#s1:21"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:22"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ol start="4" type="1">
<li>Subtraction underflows.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_PtrSub_underflow" class="idref" href="#step_PtrSub_underflow"><span class="id" title="constructor">step_PtrSub_underflow</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="high128:27" class="idref" href="#high128:27"><span class="id" title="binder">high128</span></a> <a id="s1:28" class="idref" href="#s1:28"><span class="id" title="binder">s1</span></a> <a id="s2:29" class="idref" href="#s2:29"><span class="id" title="binder">s2</span></a> <a id="ofs:30" class="idref" href="#ofs:30"><span class="id" title="binder">ofs</span></a> <a id="new_ofs:31" class="idref" href="#new_ofs:31"><span class="id" title="binder">new_ofs</span></a> <a id="pid:32" class="idref" href="#pid:32"><span class="id" title="binder">pid</span></a> (<a id="arg_delta:33" class="idref" href="#arg_delta:33"><span class="id" title="binder">arg_delta</span></a>:<a class="idref" href="#word"><span class="id" title="definition">word</span></a>) (<a id="mem_delta:34" class="idref" href="#mem_delta:34"><span class="id" title="binder">mem_delta</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>) <a id="span:35" class="idref" href="#span:35"><span class="id" title="binder">span</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#arg_delta:33"><span class="id" title="variable">arg_delta</span></a> <a class="idref" href="#::ZMod_scope:x_'<'_x"><span class="id" title="notation"><</span></a> <a class="idref" href="#MAX_OFFSET_FOR_ADD_SUB"><span class="id" title="definition">MAX_OFFSET_FOR_ADD_SUB</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mem_delta:34"><span class="id" title="variable">mem_delta</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">low</span> <a class="idref" href="#mem_address_bits"><span class="id" title="definition">mem_address_bits</span></a> <a class="idref" href="#arg_delta:33"><span class="id" title="variable">arg_delta</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#true"><span class="id" title="constructor">true</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#new_ofs:31"><span class="id" title="variable">new_ofs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ofs:30"><span class="id" title="variable">ofs</span></a> <a class="idref" href="#::ZMod_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="#mem_delta:34"><span class="id" title="variable">mem_delta</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#FatPointerOverflow"><span class="id" title="constructor">FatPointerOverflow</span></a> <a class="idref" href="#s1:28"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:29"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ptrsub:1"><span class="id" title="inductive">step_ptrsub</span></a> (<a class="idref" href="#OpPtrSub"><span class="id" title="constructor">OpPtrSub</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high128:27"><span class="id" title="variable">high128</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> (<a class="idref" href="#mk_fat_ptr"><span class="id" title="constructor">mk_fat_ptr</span></a> <a class="idref" href="#pid:32"><span class="id" title="variable">pid</span></a> (<a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> <a class="idref" href="#span:35"><span class="id" title="variable">span</span></a> <a class="idref" href="#ofs:30"><span class="id" title="variable">ofs</span></a>))<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#arg_delta:33"><span class="id" title="variable">arg_delta</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high128:27"><span class="id" title="variable">high128</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> (<a class="idref" href="#mk_fat_ptr"><span class="id" title="constructor">mk_fat_ptr</span></a> <a class="idref" href="#pid:32"><span class="id" title="variable">pid</span></a> (<a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> <a class="idref" href="#span:35"><span class="id" title="variable">span</span></a> <a class="idref" href="#new_ofs:31"><span class="id" title="variable">new_ofs</span></a>))<a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)))<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#s1:28"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:29"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#PtrSubDefinition"><span class="id" title="section">PtrSubDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.PtrShrink</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">Pointer</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="module">ZArith</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="PtrShrinkDefinition" class="idref" href="#PtrShrinkDefinition"><span class="id" title="section">PtrShrinkDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_ptrshrink" class="idref" href="#step_ptrshrink"><span class="id" title="inductive">step_ptrshrink</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
&nbsp;&nbsp;</div>

<div class="doc"><h1 id="opptrshrink">OpPtrShrink</h1>
<p><strong>Attention</strong>: <strong>shrinking</strong> and
<strong>narrowing</strong> far pointers are different. See <span
class="inlinecode"><a class="idref" href="#fat_ptr_shrink"><span
class="id" title="definition">fat_ptr_shrink</span></a></span> and <span
class="inlinecode"><a class="idref" href="#fat_ptr_narrow"><span
class="id" title="definition">fat_ptr_narrow</span></a></span>.</p>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpPtrShrink"><span
class="id" title="constructor">OpPtrShrink</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">swap</span>:</span>
<span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><p><code>shrnk in1, in2, out1</code></p></li>
<li><p><code>shrnk.s in1, in2, out1</code> to set <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span>
modifier</p></li>
</ul>
<h2 id="legacy-syntax">Legacy syntax</h2>
<ul>
<li><code>ptr.shrink in1, in2, out</code></li>
<li><code>ptr.shrink.s in1, in2, out</code>, for setting the swap
modifier.</li>
</ul>
<h2 id="summary">Summary</h2>
<p><strong>Shrink</strong> the fat pointer, decreasing its length.</p>
<h2 id="semantic">Semantic</h2>
<p><strong>Note</strong>: In the following description the operands are
bound after taking <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span> modifier into
account.</p>
<ol type="1">
<li>Fetch input operands, swap them if <code>swap</code> modifier is
set. Now operands are <span class="math inline">\mathit{op_1}</span> and
<span class="math inline">\mathit{op_2}</span>.</li>
<li>Ensure the <span class="math inline">\mathit{op_1}</span> is tagged
as a pointer, and <span class="math inline">\mathit{op_2}</span> is not
tagged as a pointer. Otherwise panic.</li>
<li>Decode fat pointer <span
class="math inline">\mathit{ptr_{in}}</span> from <span
class="math inline">\mathit{op_1}</span></li>
<li>Let <span class="math inline">\mathit{diff}</span> be <span
class="math inline">\mathit{op_2}</span> truncated to 32 bits:</li>
</ol>
<p><span class="math display">\mathit{diff} := \mathit{op}_2 \mod
2^{32}</span></p>
<ol start="5" type="1">
<li>Rewind pointer length of <span
class="math inline">\mathit{ptr_{in}}</span> by <span
class="math inline">\mathit{diff}</span>:</li>
</ol>
<p><span class="math display">\mathit{ptr_{out}} := \mathit{ptr_{in}} |
_\mathit{length := length - diff}</span></p>
<ol start="6" type="1">
<li>Store the result, tagged as a pointer, to <code>out</code>:</li>
</ol>
<p><span class="math display">result := \mathit{op_1}\{255\dots128\}
\#\# \texttt{encode}(\mathit{ptr_{out}})</span></p>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, because <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Instead of copying a fragment of a memory region defined by a fat
pointer to pass it to some other contract, we may shrink the pointer and
cheaply pass a sub-fragment to another contract without copying.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<p>See <span
class="inlinecode"><a class="idref" href="#OpPtrAdd"><span
class="id" title="constructor">OpPtrAdd</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpPtrSub"><span
class="id" title="constructor">OpPtrSub</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpPtrShrink"><span
class="id" title="constructor">OpPtrShrink</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpPtrPack"><span
class="id" title="constructor">OpPtrPack</span></a></span>.</p>
</div>
<div class="code">
<br/>
<br/>
&nbsp;&nbsp;| <a id="step_PtrShrink" class="idref" href="#step_PtrShrink"><span class="id" title="constructor">step_PtrShrink</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span>  <a id="s:3" class="idref" href="#s:3"><span class="id" title="binder">s</span></a> <a id="high128:4" class="idref" href="#high128:4"><span class="id" title="binder">high128</span></a> <a id="ptr_in:5" class="idref" href="#ptr_in:5"><span class="id" title="binder">ptr_in</span></a> <a id="ptr_out:6" class="idref" href="#ptr_out:6"><span class="id" title="binder">ptr_out</span></a> <a id="delta:7" class="idref" href="#delta:7"><span class="id" title="binder">delta</span></a> ,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="diff:8" class="idref" href="#diff:8"><span class="id" title="binder">diff</span></a> := <span class="id" title="definition">low</span> <a class="idref" href="#mem_address_bits"><span class="id" title="definition">mem_address_bits</span></a> <a class="idref" href="#delta:7"><span class="id" title="variable">delta</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fat_ptr_shrink"><span class="id" title="definition">fat_ptr_shrink</span></a> <a class="idref" href="#diff:8"><span class="id" title="variable">diff</span></a> <a class="idref" href="#ptr_in:5"><span class="id" title="variable">ptr_in</span></a> <a class="idref" href="#ptr_out:6"><span class="id" title="variable">ptr_out</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ptrshrink:1"><span class="id" title="inductive">step_ptrshrink</span></a> (<a class="idref" href="#OpPtrShrink"><span class="id" title="constructor">OpPtrShrink</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high128:4"><span class="id" title="variable">high128</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="#ptr_in:5"><span class="id" title="variable">ptr_in</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#delta:7"><span class="id" title="variable">delta</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high128:4"><span class="id" title="variable">high128</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="#ptr_out:6"><span class="id" title="variable">ptr_out</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#s:3"><span class="id" title="variable">s</span></a> <a class="idref" href="#s:3"><span class="id" title="variable">s</span></a><br/>
</div>

<div class="doc"><h2 id="panics">Panics</h2>
<ol type="1">
<li>First argument is not a pointer (after accounting for
<code>swap</code>).</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_PtrShrink_in1_not_ptr" class="idref" href="#step_PtrShrink_in1_not_ptr"><span class="id" title="constructor">step_PtrShrink_in1_not_ptr</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s1:9" class="idref" href="#s1:9"><span class="id" title="binder">s1</span></a> <a id="s2:10" class="idref" href="#s2:10"><span class="id" title="binder">s2</span></a> <a id="___2:11" class="idref" href="#___2:11"><span class="id" title="binder">___2</span></a> <a id="___3:12" class="idref" href="#___3:12"><span class="id" title="binder">___3</span></a> <a id="___4:13" class="idref" href="#___4:13"><span class="id" title="binder">___4</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#ExpectedFatPointer"><span class="id" title="constructor">ExpectedFatPointer</span></a> <a class="idref" href="#s1:9"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:10"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ptrshrink:1"><span class="id" title="inductive">step_ptrshrink</span></a> (<a class="idref" href="#OpPtrShrink"><span class="id" title="constructor">OpPtrShrink</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#___2:11"><span class="id" title="variable">___2</span></a>)) <a class="idref" href="#___3:12"><span class="id" title="variable">___3</span></a> <a class="idref" href="#___4:13"><span class="id" title="variable">___4</span></a>) <a class="idref" href="#s1:9"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:10"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ol start="2" type="1">
<li>Second argument is a pointer (after accounting for
<code>swap</code>).</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_PtrShrink_in2_ptr" class="idref" href="#step_PtrShrink_in2_ptr"><span class="id" title="constructor">step_PtrShrink_in2_ptr</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s1:14" class="idref" href="#s1:14"><span class="id" title="binder">s1</span></a> <a id="s2:15" class="idref" href="#s2:15"><span class="id" title="binder">s2</span></a> <a id="___1:16" class="idref" href="#___1:16"><span class="id" title="binder">___1</span></a> <a id="___3:17" class="idref" href="#___3:17"><span class="id" title="binder">___3</span></a> <a id="___4:18" class="idref" href="#___4:18"><span class="id" title="binder">___4</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#ExpectedFatPointer"><span class="id" title="constructor">ExpectedFatPointer</span></a> <a class="idref" href="#s1:14"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:15"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ptrshrink:1"><span class="id" title="inductive">step_ptrshrink</span></a> (<a class="idref" href="#OpPtrShrink"><span class="id" title="constructor">OpPtrShrink</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#___1:16"><span class="id" title="variable">___1</span></a>) (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#___3:17"><span class="id" title="variable">___3</span></a>) <a class="idref" href="#___4:18"><span class="id" title="variable">___4</span></a>) <a class="idref" href="#s1:14"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:15"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ol start="3" type="1">
<li>Shrinking underflows.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_PtrShrink_underflow" class="idref" href="#step_PtrShrink_underflow"><span class="id" title="constructor">step_PtrShrink_underflow</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s1:19" class="idref" href="#s1:19"><span class="id" title="binder">s1</span></a> <a id="s2:20" class="idref" href="#s2:20"><span class="id" title="binder">s2</span></a> <a id="high128:21" class="idref" href="#high128:21"><span class="id" title="binder">high128</span></a> <a id="ptr_in:22" class="idref" href="#ptr_in:22"><span class="id" title="binder">ptr_in</span></a> <a id="ptr_out:23" class="idref" href="#ptr_out:23"><span class="id" title="binder">ptr_out</span></a> <a id="delta:24" class="idref" href="#delta:24"><span class="id" title="binder">delta</span></a> ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="diff:25" class="idref" href="#diff:25"><span class="id" title="binder">diff</span></a> := <span class="id" title="definition">low</span> <a class="idref" href="#mem_address_bits"><span class="id" title="definition">mem_address_bits</span></a> <a class="idref" href="#delta:24"><span class="id" title="variable">delta</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fat_ptr_shrink_OF"><span class="id" title="definition">fat_ptr_shrink_OF</span></a> <a class="idref" href="#diff:25"><span class="id" title="variable">diff</span></a> <a class="idref" href="#ptr_in:22"><span class="id" title="variable">ptr_in</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ptrshrink:1"><span class="id" title="inductive">step_ptrshrink</span></a> (<a class="idref" href="#OpPtrShrink"><span class="id" title="constructor">OpPtrShrink</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high128:21"><span class="id" title="variable">high128</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="#ptr_in:22"><span class="id" title="variable">ptr_in</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#delta:24"><span class="id" title="variable">delta</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high128:21"><span class="id" title="variable">high128</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> <a class="idref" href="#ptr_out:23"><span class="id" title="variable">ptr_out</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#s1:19"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:20"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#PtrShrinkDefinition"><span class="id" title="section">PtrShrinkDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.PtrPack</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">ZArith</span></a> <a class="idref" href="#"><span class="id" title="module">FatPointerABI</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="PtrPackDefinition" class="idref" href="#PtrPackDefinition"><span class="id" title="section">PtrPackDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_ptrpack" class="idref" href="#step_ptrpack"><span class="id" title="inductive">step_ptrpack</span></a> : <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
&nbsp;&nbsp;</div>

<div class="doc"><h1 id="opptrpack">OpPtrPack</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpPtrPack"><span
class="id" title="constructor">OpPtrPack</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">swap</span>:</span>
<span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<ul>
<li><p><code>pack in1, in2, out1</code></p></li>
<li><p><code>pack.s in1, in2, out1</code> to set <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span>
modifier</p></li>
</ul>
<h2 id="legacy-syntax">Legacy syntax</h2>
<ul>
<li><code>ptr.pack in1, in2, out</code></li>
<li><code>ptr.pack.s in1, in2, out</code>, for setting the swap
modifier.</li>
</ul>
<h2 id="summary">Summary</h2>
<p>Concatenates the lower 128 bit of <code>in1</code> and the higher 128
bits of <code>in2</code>, writes result to <code>out</code>.
<code>in1</code> should hold a <span
class="inlinecode"><a class="idref" href="#fat_ptr"><span
class="id" title="record">fat_ptr</span></a></span>.</p>
<h2 id="semantic">Semantic</h2>
<p><strong>Note</strong>: In the following description the operands are
bound after taking <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span> modifier into
account.</p>
<ol type="1">
<li>Fetch input operands, swap them if <code>swap</code> modifier is
set. Now operands are <span class="math inline">\mathit{op_1}</span> and
<span class="math inline">\mathit{op_2}</span>.</li>
<li>Ensure the <span class="math inline">\mathit{op_1}</span> is tagged
as a pointer, and <span class="math inline">\mathit{op_2}</span> is not
tagged as a pointer. Otherwise panic.</li>
<li>Ensure that the lower 128 bits of <span
class="math inline">\mathit{op}_2</span> are zero. Otherwise panic.</li>
<li>Store the result, tagged as a pointer, to <code>out</code>:</li>
</ol>
<p><span class="math display">result := \mathit{op_2}\{255\dots128\}
\#\# \mathit{op_1}\{128\dots 0\}</span></p>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, because <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li><p>fat pointer in <span class="math inline">in_1</span> spans across
bits <span class="math inline">in_1{0\dots127}</span>, and the bits
<span class="math inline">in_1{128\dots255}</span> are therefore
available to put other data. This is used by for memory forwarding to
far calls when we need to forward an existing fat pointer.</p>
<p>To pass a fat pointer <code>P</code> to far call, it is necessary to
encode an instance of <span
class="inlinecode"><a class="idref" href="#FarCallABI"><span
class="id" title="section">FarCallABI</span></a></span> with <span
class="inlinecode"><a class="idref" href="#fwd_memory"><span
class="id" title="inductive">fwd_memory</span></a></span> <span
class="inlinecode">:=</span> <span
class="inlinecode"><a class="idref" href="#FarCallForwardPageType.ForwardFatPointer"><span
class="id" title="definition">ForwardFatPointer</span></a></span> <span
class="inlinecode"><span class="id" title="var">P</span></span> into a
<span
class="inlinecode"><a class="idref" href="#PtrValue"><span
class="id" title="abbreviation">PtrValue</span></a></span>.</p>
<pre><code>Module ABI.FarCall.

Record params :=
  mk_params {
      fwd_memory: fwd_memory;
      ergs_passed: ergs;
      shard_id: shard_id;
      constructor_call: bool;
      to_system: bool;
    }.</code></pre>
<p>The compound type of <span
class="inlinecode"><a class="idref" href="#FarCallABI"><span
class="id" title="section">FarCallABI</span></a></span> is serialized to
a <span
class="inlinecode"><a class="idref" href="#word"><span
class="id" title="definition">word</span></a></span> in such a way that
the pointer takes up the lower 128 bits of memory. This matches the
layout of any fat pointer: serialized pointers occupy the lower 128 bit
of a word.</p>
<p>Therefore, encoding an instance of <span
class="inlinecode"><a class="idref" href="#FarCallABI"><span
class="id" title="section">FarCallABI</span></a></span> can be done as
follows:</p>
<ul>
<li>take an existing <span
class="inlinecode"><a class="idref" href="#PtrValue"><span
class="id" title="abbreviation">PtrValue</span></a></span> <span
class="inlinecode"><span class="id" title="var">P</span></span></li>
<li>form a value <code>A</code> encoding <span
class="inlinecode"><a class="idref" href="#ergs_passed"><span
class="id" title="projection">ergs_passed</span></a></span>, <span
class="inlinecode"><a class="idref" href="#shard_id"><span
class="id" title="projection">shard_id</span></a></span> and other
fields of <span
class="inlinecode"><a class="idref" href="#FarCallABI"><span
class="id" title="section">FarCallABI</span></a></span> in
A{128…255}.</li>
<li>invoke <span
class="inlinecode"><a class="idref" href="#OpPtrPack"><span
class="id" title="constructor">OpPtrPack</span></a></span> <span
class="inlinecode"><span class="id" title="var">P</span></span> <span
class="inlinecode"><span class="id" title="var">A</span></span> <span
class="inlinecode"><span class="id" title="var">B</span></span>. Now
<code>B</code> stores an encoded instance of <span
class="inlinecode"><a class="idref" href="#FarCallABI"><span
class="id" title="section">FarCallABI</span></a></span> and can be
passed to one of far call instructions.</li>
</ul></li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<p>See <span
class="inlinecode"><a class="idref" href="#OpPtrAdd"><span
class="id" title="constructor">OpPtrAdd</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpPtrSub"><span
class="id" title="constructor">OpPtrSub</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpPtrShrink"><span
class="id" title="constructor">OpPtrShrink</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpPtrPack"><span
class="id" title="constructor">OpPtrPack</span></a></span>.</p>
</div>
<div class="code">
<br/>
<br/>
&nbsp;&nbsp;| <a id="step_PtrPack" class="idref" href="#step_PtrPack"><span class="id" title="constructor">step_PtrPack</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="op1_high128:3" class="idref" href="#op1_high128:3"><span class="id" title="binder">op1_high128</span></a> <a id="ptr:4" class="idref" href="#ptr:4"><span class="id" title="binder">ptr</span></a> (<a id="op2:5" class="idref" href="#op2:5"><span class="id" title="binder">op2</span></a>:<a class="idref" href="#word"><span class="id" title="definition">word</span></a>) (<a id="s:6" class="idref" href="#s:6"><span class="id" title="binder">s</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>) <a id="encoded:7" class="idref" href="#encoded:7"><span class="id" title="binder">encoded</span></a> <a id="result:8" class="idref" href="#result:8"><span class="id" title="binder">result</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">low</span> 128 <a class="idref" href="#op2:5"><span class="id" title="variable">op2</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#zero128"><span class="id" title="definition">zero128</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#encoded:7"><span class="id" title="variable">encoded</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#encode_fat_ptr"><span class="id" title="definition">encode_fat_ptr</span></a> <a class="idref" href="#ptr:4"><span class="id" title="variable">ptr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#result:8"><span class="id" title="variable">result</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="notation">(</span>@<span class="id" title="definition">high</span> 128 128 <a class="idref" href="#op2:5"><span class="id" title="variable">op2</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">##</span> <a class="idref" href="#encoded:7"><span class="id" title="variable">encoded</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ptrpack:1"><span class="id" title="inductive">step_ptrpack</span></a> (@<a class="idref" href="#OpPtrPack"><span class="id" title="constructor">OpPtrPack</span></a> <a class="idref" href="#bound"><span class="id" title="definition">bound</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#op1_high128:3"><span class="id" title="variable">op1_high128</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#ptr:4"><span class="id" title="variable">ptr</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#op2:5"><span class="id" title="variable">op2</span></a>) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#result:8"><span class="id" title="variable">result</span></a>)) <a class="idref" href="#s:6"><span class="id" title="variable">s</span></a> <a class="idref" href="#s:6"><span class="id" title="variable">s</span></a><br/>
</div>

<div class="doc"><h2 id="panics">Panics</h2>
<ol type="1">
<li>First argument is not a pointer (after accounting for
<code>swap</code>).</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_PtrPack_in1_not_ptr" class="idref" href="#step_PtrPack_in1_not_ptr"><span class="id" title="constructor">step_PtrPack_in1_not_ptr</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s1:9" class="idref" href="#s1:9"><span class="id" title="binder">s1</span></a> <a id="s2:10" class="idref" href="#s2:10"><span class="id" title="binder">s2</span></a> <a id="___1:11" class="idref" href="#___1:11"><span class="id" title="binder">___1</span></a> <a id="___2:12" class="idref" href="#___2:12"><span class="id" title="binder">___2</span></a> <a id="___3:13" class="idref" href="#___3:13"><span class="id" title="binder">___3</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#ExpectedFatPointer"><span class="id" title="constructor">ExpectedFatPointer</span></a> <a class="idref" href="#s1:9"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:10"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ptrpack:1"><span class="id" title="inductive">step_ptrpack</span></a> (<a class="idref" href="#OpPtrPack"><span class="id" title="constructor">OpPtrPack</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#___1:11"><span class="id" title="variable">___1</span></a>)) <a class="idref" href="#___2:12"><span class="id" title="variable">___2</span></a> <a class="idref" href="#___3:13"><span class="id" title="variable">___3</span></a>) <a class="idref" href="#s1:9"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:10"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ol start="2" type="1">
<li>Second argument is a pointer (after accounting for
<code>swap</code>).</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_PtrPack_in2_ptr" class="idref" href="#step_PtrPack_in2_ptr"><span class="id" title="constructor">step_PtrPack_in2_ptr</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s1:14" class="idref" href="#s1:14"><span class="id" title="binder">s1</span></a> <a id="s2:15" class="idref" href="#s2:15"><span class="id" title="binder">s2</span></a> <a id="___1:16" class="idref" href="#___1:16"><span class="id" title="binder">___1</span></a> <a id="___2:17" class="idref" href="#___2:17"><span class="id" title="binder">___2</span></a> <a id="___3:18" class="idref" href="#___3:18"><span class="id" title="binder">___3</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#ExpectedFatPointer"><span class="id" title="constructor">ExpectedFatPointer</span></a> <a class="idref" href="#s1:14"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:15"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ptrpack:1"><span class="id" title="inductive">step_ptrpack</span></a> (<a class="idref" href="#OpPtrPack"><span class="id" title="constructor">OpPtrPack</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#___1:16"><span class="id" title="variable">___1</span></a>) (<a class="idref" href="#PtrValue"><span class="id" title="abbreviation">PtrValue</span></a> <a class="idref" href="#___2:17"><span class="id" title="variable">___2</span></a>) <a class="idref" href="#___3:18"><span class="id" title="variable">___3</span></a>) <a class="idref" href="#s1:14"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:15"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc"><ol start="3" type="1">
<li>Low 128 bits of the second operand are not zero (after accounting
for <code>swap</code>).</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_PtrPack_notzero" class="idref" href="#step_PtrPack_notzero"><span class="id" title="constructor">step_PtrPack_notzero</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s1:19" class="idref" href="#s1:19"><span class="id" title="binder">s1</span></a> <a id="s2:20" class="idref" href="#s2:20"><span class="id" title="binder">s2</span></a> <a id="op2:21" class="idref" href="#op2:21"><span class="id" title="binder">op2</span></a> <a id="___1:22" class="idref" href="#___1:22"><span class="id" title="binder">___1</span></a> <a id="___2:23" class="idref" href="#___2:23"><span class="id" title="binder">___2</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">low</span> 128 <a class="idref" href="#op2:21"><span class="id" title="variable">op2</span></a> <a class="idref" href="#::type_scope:x_'<>'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="#zero128"><span class="id" title="definition">zero128</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_panic"><span class="id" title="inductive">step_panic</span></a> <a class="idref" href="#PtrPackExpectsOp2Low128BitsZero"><span class="id" title="constructor">PtrPackExpectsOp2Low128BitsZero</span></a> <a class="idref" href="#s1:19"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:20"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_ptrpack:1"><span class="id" title="inductive">step_ptrpack</span></a> (@<a class="idref" href="#OpPtrPack"><span class="id" title="constructor">OpPtrPack</span></a> <a class="idref" href="#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="#___1:22"><span class="id" title="variable">___1</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#op2:21"><span class="id" title="variable">op2</span></a>) <a class="idref" href="#___2:23"><span class="id" title="variable">___2</span></a>) <a class="idref" href="#s1:19"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:20"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#PtrPackDefinition"><span class="id" title="section">PtrPackDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.SStore</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Predication</span></a> <a class="idref" href="#"><span class="id" title="module">Ergs</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">Event</span></a> <a class="idref" href="#"><span class="id" title="module">memory.Depot</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryOps</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="module">ZArith</span></a> <span class="id" title="module">RecordSetNotations</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="SStoreDefinition" class="idref" href="#SStoreDefinition"><span class="id" title="section">SStoreDefinition</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="sstore_cost" class="idref" href="#sstore_cost"><span class="id" title="definition">sstore_cost</span></a> <a id="cs:1" class="idref" href="#cs:1"><span class="id" title="binder">cs</span></a> : <a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="pubdata:2" class="idref" href="#pubdata:2"><span class="id" title="binder">pubdata</span></a> :=  (<a class="idref" href="#net_pubdata"><span class="id" title="definition">net_pubdata</span></a> <a class="idref" href="#cs:1"><span class="id" title="variable">cs</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_of"><span class="id" title="definition">ergs_of</span></a> (<a class="idref" href="#pubdata:2"><span class="id" title="variable">pubdata</span></a> <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <a class="idref" href="#Z.of_nat"><span class="id" title="definition">Z.of_nat</span></a> <a class="idref" href="#bytes_in_word"><span class="id" title="definition">bytes_in_word</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_sstore" class="idref" href="#step_sstore"><span class="id" title="inductive">step_sstore</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
&nbsp;&nbsp;</div>

<div class="doc"><h1 id="optransientstore">OpTransientStore</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpTransientStore"><span
class="id" title="constructor">OpTransientStore</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>stt in1, in2</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<p><code>log.swrite in1, in2</code> aliased as
<code>sstore in1, in2</code></p>
<h2 id="summary">Summary</h2>
<p>Store word in the storage of the active contract by key.</p>
<h2 id="semantic">Semantic</h2>
<ul>
<li>Store word in current shard’s, and current contract’s storage by key
<code>key</code>. Current contract is identified by the field <span
class="inlinecode"><a class="idref" href="#ecf_this_address"><span
class="id" title="projection">ecf_this_address</span></a></span> of the
active external frame.</li>
<li>Pay for transient storage write.</li>
</ul>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
<li>Depot of the current shard.</li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Only <span
class="inlinecode"><a class="idref" href="#OpTransientStore"><span
class="id" title="constructor">OpTransientStore</span></a></span> is
capable to write data to storage.</li>
<li><span
class="inlinecode"><a class="idref" href="#OpTransientStore"><span
class="id" title="constructor">OpTransientStore</span></a></span> is
rolled back if the current frame ended by <span
class="inlinecode"><a class="idref" href="#OpPanic"><span
class="id" title="constructor">OpPanic</span></a></span> or <span
class="inlinecode"><a class="idref" href="#OpRevert"><span
class="id" title="constructor">OpRevert</span></a></span>.</li>
<li>Transient storage is reset after the transaction ends.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;</div>

<div class="doc">
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_SStore" class="idref" href="#step_SStore"><span class="id" title="constructor">step_SStore</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cs:5" class="idref" href="#cs:5"><span class="id" title="binder">cs</span></a> <a id="new_cs:6" class="idref" href="#new_cs:6"><span class="id" title="binder">new_cs</span></a> <a id="key:7" class="idref" href="#key:7"><span class="id" title="binder">key</span></a> <a id="new_depot:8" class="idref" href="#new_depot:8"><span class="id" title="binder">new_depot</span></a> <a id="write_value:9" class="idref" href="#write_value:9"><span class="id" title="binder">write_value</span></a> <a id="gs:10" class="idref" href="#gs:10"><span class="id" title="binder">gs</span></a> <a id="new_gs:11" class="idref" href="#new_gs:11"><span class="id" title="binder">new_gs</span></a> <a id="ts1:12" class="idref" href="#ts1:12"><span class="id" title="binder">ts1</span></a> <a id="ts2:13" class="idref" href="#ts2:13"><span class="id" title="binder">ts2</span></a> <a id="__:14" class="idref" href="#__:14"><span class="id" title="binder">__</span></a> ,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;there&nbsp;are&nbsp;currently&nbsp;no&nbsp;refunds&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#cs:5"><span class="id" title="variable">cs</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#ts1:12"><span class="id" title="variable">ts1</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="fqa_storage:15" class="idref" href="#fqa_storage:15"><span class="id" title="binder">fqa_storage</span></a> := <a class="idref" href="#mk_fqa_key"><span class="id" title="constructor">mk_fqa_key</span></a> (<a class="idref" href="#current_storage_fqa"><span class="id" title="definition">current_storage_fqa</span></a> <a class="idref" href="#cs:5"><span class="id" title="variable">cs</span></a>) <a class="idref" href="#key:7"><span class="id" title="variable">key</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="old_depot:16" class="idref" href="#old_depot:16"><span class="id" title="binder">old_depot</span></a> := <a class="idref" href="#gs:10"><span class="id" title="variable">gs</span></a>.(<a class="idref" href="#gs_revertable"><span class="id" title="projection">gs_revertable</span></a>).(<a class="idref" href="#gs_depot"><span class="id" title="projection">gs_depot</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#storage_write"><span class="id" title="inductive">storage_write</span></a> <a class="idref" href="#old_depot:16"><span class="id" title="variable">old_depot</span></a> <a class="idref" href="#fqa_storage:15"><span class="id" title="variable">fqa_storage</span></a> <a class="idref" href="#write_value:9"><span class="id" title="variable">write_value</span></a> <a class="idref" href="#new_depot:8"><span class="id" title="variable">new_depot</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#global_state_new_depot"><span class="id" title="inductive">global_state_new_depot</span></a> <a class="idref" href="#new_depot:8"><span class="id" title="variable">new_depot</span></a> <a class="idref" href="#gs:10"><span class="id" title="variable">gs</span></a> <a class="idref" href="#new_gs:11"><span class="id" title="variable">new_gs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ts2:13"><span class="id" title="variable">ts2</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ts1:12"><span class="id" title="variable">ts1</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#new_cs:6"><span class="id" title="variable">new_cs</span></a> <span class="id" title="notation">|></span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pay"><span class="id" title="inductive">pay</span></a> (<a class="idref" href="#sstore_cost"><span class="id" title="definition">sstore_cost</span></a> <a class="idref" href="#cs:5"><span class="id" title="variable">cs</span></a>) <a class="idref" href="#cs:5"><span class="id" title="variable">cs</span></a> <a class="idref" href="#new_cs:6"><span class="id" title="variable">new_cs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_sstore:3"><span class="id" title="inductive">step_sstore</span></a> (<a class="idref" href="#OpSStore"><span class="id" title="constructor">OpSStore</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#__:14"><span class="id" title="variable">__</span></a> <a class="idref" href="#key:7"><span class="id" title="variable">key</span></a>) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#write_value:9"><span class="id" title="variable">write_value</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := <a class="idref" href="#ts1:12"><span class="id" title="variable">ts1</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>    := <a class="idref" href="#gs:10"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := <a class="idref" href="#ts2:13"><span class="id" title="variable">ts2</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>    := <a class="idref" href="#new_gs:11"><span class="id" title="variable">new_gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
<br/>
</div>

<div class="doc"><h2 id="panics">Panics</h2>
<ol type="1">
<li>Not enough ergs to pay for storage write.</li>
</ol>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_SStore_unaffordable" class="idref" href="#step_SStore_unaffordable"><span class="id" title="constructor">step_SStore_unaffordable</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cs:17" class="idref" href="#cs:17"><span class="id" title="binder">cs</span></a> <a id="gs:18" class="idref" href="#gs:18"><span class="id" title="binder">gs</span></a> <a id="ts1:19" class="idref" href="#ts1:19"><span class="id" title="binder">ts1</span></a> <a id="ts2:20" class="idref" href="#ts2:20"><span class="id" title="binder">ts2</span></a> <a id="___1:21" class="idref" href="#___1:21"><span class="id" title="binder">___1</span></a> <a id="___2:22" class="idref" href="#___2:22"><span class="id" title="binder">___2</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;there&nbsp;are&nbsp;currently&nbsp;no&nbsp;refunds&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#cs:17"><span class="id" title="variable">cs</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#ts1:19"><span class="id" title="variable">ts1</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#affordable"><span class="id" title="definition">affordable</span></a> <a class="idref" href="#cs:17"><span class="id" title="variable">cs</span></a> (<a class="idref" href="#sstore_cost"><span class="id" title="definition">sstore_cost</span></a> <a class="idref" href="#cs:17"><span class="id" title="variable">cs</span></a>) <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ts2:20"><span class="id" title="variable">ts2</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ts1:19"><span class="id" title="variable">ts1</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Panic"><span class="id" title="constructor">Panic</span></a> <a class="idref" href="#StorageWriteUnaffordable"><span class="id" title="constructor">StorageWriteUnaffordable</span></a> <span class="id" title="notation">|></span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_sstore:3"><span class="id" title="inductive">step_sstore</span></a> (<a class="idref" href="#OpSLoad"><span class="id" title="constructor">OpSLoad</span></a> <a class="idref" href="#___1:21"><span class="id" title="variable">___1</span></a> <a class="idref" href="#___2:22"><span class="id" title="variable">___2</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := <a class="idref" href="#ts1:19"><span class="id" title="variable">ts1</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>    := <a class="idref" href="#gs:18"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := <a class="idref" href="#ts2:20"><span class="id" title="variable">ts2</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>    := <a class="idref" href="#gs:18"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#SStoreDefinition"><span class="id" title="section">SStoreDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.SLoad</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>
<span class="id" title="keyword">Import</span>  <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">memory.Depot</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="SLoadDefinition" class="idref" href="#SLoadDefinition"><span class="id" title="section">SLoadDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable Variable</span> <span class="id" title="var">__</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_sload" class="idref" href="#step_sload"><span class="id" title="inductive">step_sload</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
</div>

<div class="doc"><h1 id="opsload">OpSLoad</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpSLoad"><span
class="id" title="constructor">OpSLoad</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>lds in1, out1</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<p><code>log.sread in1, out</code> aliased as
<code>sload in1, out</code></p>
<h2 id="summary">Summary</h2>
<p>Access word in the storage of the active contract by key.</p>
<h2 id="semantic">Semantic</h2>
<ol type="1">
<li><p>Load word from current shard, current contract’s storage by key
<code>key</code>.</p>
<p>Current contract is identified by the field <span
class="inlinecode"><a class="idref" href="#ecf_this_address"><span
class="id" title="projection">ecf_this_address</span></a></span> of the
active external frame.</p></li>
<li><p>Store the value to <code>dest</code>.</p></li>
</ol>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, because <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Only <span
class="inlinecode"><a class="idref" href="#OpSLoad"><span
class="id" title="constructor">OpSLoad</span></a></span> is capable of
reading data from transient storage.</li>
</ul>
</div>
<div class="code">
<br/>
<br/>
&nbsp;&nbsp;| <a id="step_SLoad" class="idref" href="#step_SLoad"><span class="id" title="constructor">step_SLoad</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="read_value:3" class="idref" href="#read_value:3"><span class="id" title="binder">read_value</span></a> <a id="key:4" class="idref" href="#key:4"><span class="id" title="binder">key</span></a> (<a id="s:5" class="idref" href="#s:5"><span class="id" title="binder">s</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>) <a id="__:6" class="idref" href="#__:6"><span class="id" title="binder">__</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="fqa_storage:7" class="idref" href="#fqa_storage:7"><span class="id" title="binder">fqa_storage</span></a> := <a class="idref" href="#mk_fqa_key"><span class="id" title="constructor">mk_fqa_key</span></a> (<a class="idref" href="#current_storage_fqa"><span class="id" title="definition">current_storage_fqa</span></a> (<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s:5"><span class="id" title="variable">s</span></a>)) <a class="idref" href="#key:4"><span class="id" title="variable">key</span></a> <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#storage_read"><span class="id" title="inductive">storage_read</span></a> (<a class="idref" href="#gs_revertable"><span class="id" title="projection">gs_revertable</span></a> <a class="idref" href="#s:5"><span class="id" title="variable">s</span></a>).(<a class="idref" href="#gs_depot"><span class="id" title="projection">gs_depot</span></a>) <a class="idref" href="#fqa_storage:7"><span class="id" title="variable">fqa_storage</span></a> <a class="idref" href="#read_value:3"><span class="id" title="variable">read_value</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_sload:1"><span class="id" title="inductive">step_sload</span></a> (<a class="idref" href="#OpSLoad"><span class="id" title="constructor">OpSLoad</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#__:6"><span class="id" title="variable">__</span></a> <a class="idref" href="#key:4"><span class="id" title="variable">key</span></a>)(<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#read_value:3"><span class="id" title="variable">read_value</span></a>)) <a class="idref" href="#s:5"><span class="id" title="variable">s</span></a> <a class="idref" href="#s:5"><span class="id" title="variable">s</span></a><br/>
&nbsp;&nbsp;.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#SLoadDefinition"><span class="id" title="section">SLoadDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.TransientLoad</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>
<span class="id" title="keyword">Import</span>  <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">memory.Depot</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="TransientLoadDefinition" class="idref" href="#TransientLoadDefinition"><span class="id" title="section">TransientLoadDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Generalizable Variable</span> <span class="id" title="var">__</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_tload" class="idref" href="#step_tload"><span class="id" title="inductive">step_tload</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
</div>

<div class="doc"><h1 id="optransientload">OpTransientLoad</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpTransientLoad"><span
class="id" title="constructor">OpTransientLoad</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>ldt in1, out1</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<p><code>tload in1, out1</code></p>
<h2 id="summary">Summary</h2>
<p>Access word in the transient storage of the active contract by
key.</p>
<p>Transient contract storage of all contracts resets when <span
class="inlinecode"><a class="idref" href="#OpIncrementTxNumber"><span
class="id" title="constructor">OpIncrementTxNumber</span></a></span> is
called.</p>
<h2 id="semantic">Semantic</h2>
<ol type="1">
<li><p>Load word from current shard, current contract’s transient
storage by key <code>key</code>.</p>
<p>Current contract is identified by the field <span
class="inlinecode"><a class="idref" href="#ecf_this_address"><span
class="id" title="projection">ecf_this_address</span></a></span> of the
active external frame.</p></li>
<li><p>Store the value to <code>dest</code>.</p></li>
</ol>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, because <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Only <span
class="inlinecode"><a class="idref" href="#OpTransientLoad"><span
class="id" title="constructor">OpTransientLoad</span></a></span> is
capable of reading data from transient storage.</li>
<li>Much cheaper than storage for e.g. reentrancy locks.</li>
</ul>
</div>
<div class="code">
<br/>
<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FIXME:&nbsp;semantic&nbsp;is&nbsp;incorrect&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a id="step_TLoad" class="idref" href="#step_TLoad"><span class="id" title="constructor">step_TLoad</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="read_value:3" class="idref" href="#read_value:3"><span class="id" title="binder">read_value</span></a> <a id="key:4" class="idref" href="#key:4"><span class="id" title="binder">key</span></a> (<a id="s:5" class="idref" href="#s:5"><span class="id" title="binder">s</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>) <a id="__:6" class="idref" href="#__:6"><span class="id" title="binder">__</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="fqa_storage:7" class="idref" href="#fqa_storage:7"><span class="id" title="binder">fqa_storage</span></a> := <a class="idref" href="#mk_fqa_key"><span class="id" title="constructor">mk_fqa_key</span></a> (<a class="idref" href="#current_storage_fqa"><span class="id" title="definition">current_storage_fqa</span></a> (<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s:5"><span class="id" title="variable">s</span></a>)) <a class="idref" href="#key:4"><span class="id" title="variable">key</span></a> <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#storage_read"><span class="id" title="inductive">storage_read</span></a> (<a class="idref" href="#gs_revertable"><span class="id" title="projection">gs_revertable</span></a> <a class="idref" href="#s:5"><span class="id" title="variable">s</span></a>).(<a class="idref" href="#gs_depot"><span class="id" title="projection">gs_depot</span></a>) <a class="idref" href="#fqa_storage:7"><span class="id" title="variable">fqa_storage</span></a> <a class="idref" href="#read_value:3"><span class="id" title="variable">read_value</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_tload:1"><span class="id" title="inductive">step_tload</span></a> (<a class="idref" href="#OpSLoad"><span class="id" title="constructor">OpSLoad</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#__:6"><span class="id" title="variable">__</span></a> <a class="idref" href="#key:4"><span class="id" title="variable">key</span></a>)(<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#read_value:3"><span class="id" title="variable">read_value</span></a>)) <a class="idref" href="#s:5"><span class="id" title="variable">s</span></a> <a class="idref" href="#s:5"><span class="id" title="variable">s</span></a><br/>
&nbsp;&nbsp;.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#TransientLoadDefinition"><span class="id" title="section">TransientLoadDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.TransientStore</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Predication</span></a> <a class="idref" href="#"><span class="id" title="module">Ergs</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">Event</span></a> <a class="idref" href="#"><span class="id" title="module">memory.Depot</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryOps</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="module">ZArith</span></a> <span class="id" title="module">RecordSetNotations</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="TransientStoreDefinition" class="idref" href="#TransientStoreDefinition"><span class="id" title="section">TransientStoreDefinition</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="tstore_cost" class="idref" href="#tstore_cost"><span class="id" title="definition">tstore_cost</span></a> <a id="cs:1" class="idref" href="#cs:1"><span class="id" title="binder">cs</span></a> : <a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="pubdata:2" class="idref" href="#pubdata:2"><span class="id" title="binder">pubdata</span></a> :=  (<a class="idref" href="#net_pubdata"><span class="id" title="definition">net_pubdata</span></a> <a class="idref" href="#cs:1"><span class="id" title="variable">cs</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_of"><span class="id" title="definition">ergs_of</span></a> (<a class="idref" href="#pubdata:2"><span class="id" title="variable">pubdata</span></a> <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <a class="idref" href="#Z.of_nat"><span class="id" title="definition">Z.of_nat</span></a> <a class="idref" href="#bytes_in_word"><span class="id" title="definition">bytes_in_word</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_tstore" class="idref" href="#step_tstore"><span class="id" title="inductive">step_tstore</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
&nbsp;&nbsp;</div>

<div class="doc"><h1 id="optransientstore">OpTransientStore</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpTransientStore"><span
class="id" title="constructor">OpTransientStore</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>stt in1, in2</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<p><code>tstore in1, in2</code></p>
<h2 id="summary">Summary</h2>
<p>Store word in the transient storage of the active contract by
key.</p>
<h2 id="semantic">Semantic</h2>
<ul>
<li>Store word in current shard’s, and current contract’s transient
storage by key <code>key</code>. Current contract is identified by the
field <span
class="inlinecode"><a class="idref" href="#ecf_this_address"><span
class="id" title="projection">ecf_this_address</span></a></span> of the
active external frame.</li>
<li>Pay for transient storage write.</li>
</ul>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
<li>Transient depot of the current shard.</li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Only <span
class="inlinecode"><a class="idref" href="#OpTransientStore"><span
class="id" title="constructor">OpTransientStore</span></a></span> is
capable to write data to storage.</li>
<li><span
class="inlinecode"><a class="idref" href="#OpTransientStore"><span
class="id" title="constructor">OpTransientStore</span></a></span> is
rolled back if the current frame ended by <span
class="inlinecode"><a class="idref" href="#OpPanic"><span
class="id" title="constructor">OpPanic</span></a></span> or <span
class="inlinecode"><a class="idref" href="#OpRevert"><span
class="id" title="constructor">OpRevert</span></a></span>.</li>
<li>Transient storage is reset after the transaction ends.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FIXME:&nbsp;semantic&nbsp;is&nbsp;incorrect&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a id="step_TransientStore" class="idref" href="#step_TransientStore"><span class="id" title="constructor">step_TransientStore</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cs:5" class="idref" href="#cs:5"><span class="id" title="binder">cs</span></a> <a id="new_cs:6" class="idref" href="#new_cs:6"><span class="id" title="binder">new_cs</span></a> <a id="key:7" class="idref" href="#key:7"><span class="id" title="binder">key</span></a> <a id="new_depot:8" class="idref" href="#new_depot:8"><span class="id" title="binder">new_depot</span></a> <a id="write_value:9" class="idref" href="#write_value:9"><span class="id" title="binder">write_value</span></a> <a id="gs:10" class="idref" href="#gs:10"><span class="id" title="binder">gs</span></a> <a id="new_gs:11" class="idref" href="#new_gs:11"><span class="id" title="binder">new_gs</span></a> <a id="ts1:12" class="idref" href="#ts1:12"><span class="id" title="binder">ts1</span></a> <a id="ts2:13" class="idref" href="#ts2:13"><span class="id" title="binder">ts2</span></a> <a id="__:14" class="idref" href="#__:14"><span class="id" title="binder">__</span></a> ,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;there&nbsp;are&nbsp;currently&nbsp;no&nbsp;refunds&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#cs:5"><span class="id" title="variable">cs</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#ts1:12"><span class="id" title="variable">ts1</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="fqa_storage:15" class="idref" href="#fqa_storage:15"><span class="id" title="binder">fqa_storage</span></a> := <a class="idref" href="#mk_fqa_key"><span class="id" title="constructor">mk_fqa_key</span></a> (<a class="idref" href="#current_storage_fqa"><span class="id" title="definition">current_storage_fqa</span></a> <a class="idref" href="#cs:5"><span class="id" title="variable">cs</span></a>) <a class="idref" href="#key:7"><span class="id" title="variable">key</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="old_depot:16" class="idref" href="#old_depot:16"><span class="id" title="binder">old_depot</span></a> := <a class="idref" href="#gs:10"><span class="id" title="variable">gs</span></a>.(<a class="idref" href="#gs_revertable"><span class="id" title="projection">gs_revertable</span></a>).(<a class="idref" href="#gs_depot"><span class="id" title="projection">gs_depot</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#storage_write"><span class="id" title="inductive">storage_write</span></a> <a class="idref" href="#old_depot:16"><span class="id" title="variable">old_depot</span></a> <a class="idref" href="#fqa_storage:15"><span class="id" title="variable">fqa_storage</span></a> <a class="idref" href="#write_value:9"><span class="id" title="variable">write_value</span></a> <a class="idref" href="#new_depot:8"><span class="id" title="variable">new_depot</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#global_state_new_depot"><span class="id" title="inductive">global_state_new_depot</span></a> <a class="idref" href="#new_depot:8"><span class="id" title="variable">new_depot</span></a> <a class="idref" href="#gs:10"><span class="id" title="variable">gs</span></a> <a class="idref" href="#new_gs:11"><span class="id" title="variable">new_gs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ts2:13"><span class="id" title="variable">ts2</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ts1:12"><span class="id" title="variable">ts1</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#new_cs:6"><span class="id" title="variable">new_cs</span></a> <span class="id" title="notation">|></span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pay"><span class="id" title="inductive">pay</span></a> (<a class="idref" href="#tstore_cost"><span class="id" title="definition">tstore_cost</span></a> <a class="idref" href="#cs:5"><span class="id" title="variable">cs</span></a>) <a class="idref" href="#cs:5"><span class="id" title="variable">cs</span></a> <a class="idref" href="#new_cs:6"><span class="id" title="variable">new_cs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_tstore:3"><span class="id" title="inductive">step_tstore</span></a> (<a class="idref" href="#OpTransientStore"><span class="id" title="constructor">OpTransientStore</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#__:14"><span class="id" title="variable">__</span></a> <a class="idref" href="#key:7"><span class="id" title="variable">key</span></a>) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#write_value:9"><span class="id" title="variable">write_value</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := <a class="idref" href="#ts1:12"><span class="id" title="variable">ts1</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>    := <a class="idref" href="#gs:10"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := <a class="idref" href="#ts2:13"><span class="id" title="variable">ts2</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>    := <a class="idref" href="#new_gs:11"><span class="id" title="variable">new_gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
</div>

<div class="doc"><h2 id="panics">Panics</h2>
<ol type="1">
<li>Not enough ergs to pay for storage write.</li>
</ol>
</div>
<div class="code">
<br/>
<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FIXME:&nbsp;semantic&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a id="step_TransientStore_unaffordable" class="idref" href="#step_TransientStore_unaffordable"><span class="id" title="constructor">step_TransientStore_unaffordable</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cs:17" class="idref" href="#cs:17"><span class="id" title="binder">cs</span></a> <a id="gs:18" class="idref" href="#gs:18"><span class="id" title="binder">gs</span></a> <a id="ts1:19" class="idref" href="#ts1:19"><span class="id" title="binder">ts1</span></a> <a id="ts2:20" class="idref" href="#ts2:20"><span class="id" title="binder">ts2</span></a> <a id="___1:21" class="idref" href="#___1:21"><span class="id" title="binder">___1</span></a> <a id="___2:22" class="idref" href="#___2:22"><span class="id" title="binder">___2</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;there&nbsp;are&nbsp;currently&nbsp;no&nbsp;refunds&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#cs:17"><span class="id" title="variable">cs</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#ts1:19"><span class="id" title="variable">ts1</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#affordable"><span class="id" title="definition">affordable</span></a> <a class="idref" href="#cs:17"><span class="id" title="variable">cs</span></a> (<a class="idref" href="#tstore_cost"><span class="id" title="definition">tstore_cost</span></a> <a class="idref" href="#cs:17"><span class="id" title="variable">cs</span></a>) <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ts2:20"><span class="id" title="variable">ts2</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ts1:19"><span class="id" title="variable">ts1</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#Panic"><span class="id" title="constructor">Panic</span></a> <a class="idref" href="#StorageWriteUnaffordable"><span class="id" title="constructor">StorageWriteUnaffordable</span></a> <span class="id" title="notation">|></span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_tstore:3"><span class="id" title="inductive">step_tstore</span></a> (<a class="idref" href="#OpSLoad"><span class="id" title="constructor">OpSLoad</span></a> <a class="idref" href="#___1:21"><span class="id" title="variable">___1</span></a> <a class="idref" href="#___2:22"><span class="id" title="variable">___2</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := <a class="idref" href="#ts1:19"><span class="id" title="variable">ts1</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>    := <a class="idref" href="#gs:18"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := <a class="idref" href="#ts2:20"><span class="id" title="variable">ts2</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>    := <a class="idref" href="#gs:18"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#TransientStoreDefinition"><span class="id" title="section">TransientStoreDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.OpEvent</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">Event</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect</span> <span class="id" title="module">ssrfun</span> <span class="id" title="module">ssrbool</span> <span class="id" title="module">ssreflect.eqtype</span> <span class="id" title="module">ssreflect.tuple</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="EventDefinition" class="idref" href="#EventDefinition"><span class="id" title="section">EventDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_event" class="idref" href="#step_event"><span class="id" title="inductive">step_event</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
</div>

<div class="doc"><h1 id="opevent">OpEvent</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpEvent"><span
class="id" title="constructor">OpEvent</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">is_first</span>:</span>
<span
class="inlinecode"><a class="idref" href="#bool"><span
class="id" title="inductive">bool</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>log in1, in2</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<ul>
<li><code>log.event in1, in2</code> aliased as
<code>event in1, in2</code></li>
<li><code>log.event.first in1, in2</code> aliased as
<code>event.i in1, in2</code></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Emit an event with provided key and value. See <span
class="inlinecode"><a class="idref" href="#event"><span
class="id" title="record">event</span></a></span> for more details on
events system.</p>
<ul>
<li>Requires <span
class="inlinecode"><a class="idref" href="#KernelMode"><span
class="id" title="section">KernelMode</span></a></span></li>
<li>Forbidden in <span
class="inlinecode"><a class="idref" href="#StaticMode"><span
class="id" title="section">StaticMode</span></a></span></li>
</ul>
<h2 id="semantic">Semantic</h2>
<ol type="1">
<li>Fetch key and value from <code>in1</code> and <code>in2</code>.</li>
<li>If <code>is_first</code> is <code>true</code>, mark the event as the
first in a chain of events.</li>
<li>Emit event.</li>
</ol>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
<li>Event queue.</li>
</ul>
<h2 id="usage">Usage</h2>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_Event" class="idref" href="#step_Event"><span class="id" title="constructor">step_Event</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="xs:3" class="idref" href="#xs:3"><span class="id" title="binder">xs</span></a> <a id="is_first:4" class="idref" href="#is_first:4"><span class="id" title="binder">is_first</span></a> <a id="_tag1:5" class="idref" href="#_tag1:5"><span class="id" title="binder">_tag1</span></a> <a id="_tag2:6" class="idref" href="#_tag2:6"><span class="id" title="binder">_tag2</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="key:7" class="idref" href="#key:7"><span class="id" title="binder">key</span></a> <a id="value:8" class="idref" href="#value:8"><span class="id" title="binder">value</span></a> <a id="gs:9" class="idref" href="#gs:9"><span class="id" title="binder">gs</span></a> <a id="new_gs:10" class="idref" href="#new_gs:10"><span class="id" title="binder">new_gs</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="regs:11" class="idref" href="#regs:11"><span class="id" title="binder">regs</span></a> := <a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a> <a class="idref" href="#xs:3"><span class="id" title="variable">xs</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="pages:12" class="idref" href="#pages:12"><span class="id" title="binder">pages</span></a> := <a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a> <a class="idref" href="#xs:3"><span class="id" title="variable">xs</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="xstack:13" class="idref" href="#xstack:13"><span class="id" title="binder">xstack</span></a> := <a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#xs:3"><span class="id" title="variable">xs</span></a> <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#emit_event"><span class="id" title="inductive">emit_event</span></a> (<a class="idref" href="#EventQuery"><span class="id" title="constructor">EventQuery</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ev_shard_id"><span class="id" title="projection">ev_shard_id</span></a> := <a class="idref" href="#current_shard"><span class="id" title="definition">current_shard</span></a> <a class="idref" href="#xstack:13"><span class="id" title="variable">xstack</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ev_is_first"><span class="id" title="projection">ev_is_first</span></a> := <a class="idref" href="#is_first:4"><span class="id" title="variable">is_first</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ev_tx_number_in_block"><span class="id" title="projection">ev_tx_number_in_block</span></a> := <a class="idref" href="#gs_tx_number_in_block"><span class="id" title="projection">gs_tx_number_in_block</span></a> <a class="idref" href="#gs:9"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ev_address"><span class="id" title="projection">ev_address</span></a> := <a class="idref" href="#current_contract"><span class="id" title="definition">current_contract</span></a> <a class="idref" href="#xstack:13"><span class="id" title="variable">xstack</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ev_key"><span class="id" title="projection">ev_key</span></a> := <a class="idref" href="#key:7"><span class="id" title="variable">key</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ev_value"><span class="id" title="projection">ev_value</span></a> := <a class="idref" href="#value:8"><span class="id" title="variable">value</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}) <a class="idref" href="#gs:9"><span class="id" title="variable">gs</span></a> <a class="idref" href="#new_gs:10"><span class="id" title="variable">new_gs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_event:1"><span class="id" title="inductive">step_event</span></a> (<a class="idref" href="#OpEvent"><span class="id" title="constructor">OpEvent</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#_tag1:5"><span class="id" title="variable">_tag1</span></a> <a class="idref" href="#key:7"><span class="id" title="variable">key</span></a>) (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#_tag2:6"><span class="id" title="variable">_tag2</span></a> <a class="idref" href="#value:8"><span class="id" title="variable">value</span></a>) <a class="idref" href="#is_first:4"><span class="id" title="variable">is_first</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>       := <a class="idref" href="#gs:9"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a>    := <a class="idref" href="#xs:3"><span class="id" title="variable">xs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>       := <a class="idref" href="#new_gs:10"><span class="id" title="variable">new_gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a>    := <a class="idref" href="#xs:3"><span class="id" title="variable">xs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#EventDefinition"><span class="id" title="section">EventDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.ToL1</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Arith</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Ergs</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">Event</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <span class="id" title="module">RecordSetNotations</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect.tuple</span> <span class="id" title="module">ssreflect.eqtype</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="ToL1Definition" class="idref" href="#ToL1Definition"><span class="id" title="section">ToL1Definition</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
</div>

<div class="doc"><h1 id="optol1">OpToL1</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span class="inlinecode"><span class="id"
title="var">OpToL1</span></span> <span class="inlinecode">(<span
class="id" title="var">in1</span>:</span> <span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">is_first</span>:</span>
<span
class="inlinecode"><a class="idref" href="#bool"><span
class="id" title="inductive">bool</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>logl1 in1, in2</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<ul>
<li><code>log.to_l1 in1, in2</code></li>
<li><code>log.to_l1.first in1, in2</code></li>
</ul>
<h2 id="summary">Summary</h2>
<p>Emit a message to L1 with provided key and value. See <span
class="inlinecode"><a class="idref" href="#event"><span
class="id" title="record">event</span></a></span> for more details on
events system.</p>
<ul>
<li>Requires <span
class="inlinecode"><a class="idref" href="#KernelMode"><span
class="id" title="section">KernelMode</span></a></span></li>
<li>Forbidden in <span
class="inlinecode"><a class="idref" href="#StaticMode"><span
class="id" title="section">StaticMode</span></a></span></li>
</ul>
<h2 id="semantic">Semantic</h2>
<ol type="1">
<li>Fetch key and value from <code>key</code> and
<code>value</code>.</li>
<li>If <code>is_first</code> is <code>true</code>, mark the event as the
first in a chain of events.</li>
<li>Emit L1 message event.</li>
</ol>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
<li>L1 Event queue.</li>
</ul>
<h2 id="usage">Usage</h2>
<p>Communicating with L1.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_tol1" class="idref" href="#step_tol1"><span class="id" title="inductive">step_tol1</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
<br/>
&nbsp;&nbsp;| <a id="step_ToL1" class="idref" href="#step_ToL1"><span class="id" title="constructor">step_ToL1</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="cs:3" class="idref" href="#cs:3"><span class="id" title="binder">cs</span></a> <a id="new_cs:4" class="idref" href="#new_cs:4"><span class="id" title="binder">new_cs</span></a> <a id="is_first:5" class="idref" href="#is_first:5"><span class="id" title="binder">is_first</span></a> <a id="key:6" class="idref" href="#key:6"><span class="id" title="binder">key</span></a> <a id="value:7" class="idref" href="#value:7"><span class="id" title="binder">value</span></a> <a id="gs:8" class="idref" href="#gs:8"><span class="id" title="binder">gs</span></a> <a id="new_gs:9" class="idref" href="#new_gs:9"><span class="id" title="binder">new_gs</span></a> <a id="cost:10" class="idref" href="#cost:10"><span class="id" title="binder">cost</span></a> <a id="cost_truncated:11" class="idref" href="#cost_truncated:11"><span class="id" title="binder">cost_truncated</span></a> <a id="ts1:12" class="idref" href="#ts1:12"><span class="id" title="binder">ts1</span></a> <a id="ts2:13" class="idref" href="#ts2:13"><span class="id" title="binder">ts2</span></a> <a id="__:14" class="idref" href="#__:14"><span class="id" title="binder">__</span></a> <a id="___1:15" class="idref" href="#___1:15"><span class="id" title="binder">___1</span></a>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#cost:10"><span class="id" title="variable">cost</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#gs_current_ergs_per_pubdata_byte"><span class="id" title="projection">gs_current_ergs_per_pubdata_byte</span></a> <a class="idref" href="#gs:8"><span class="id" title="variable">gs</span></a> <a class="idref" href="#a2b4273a2140deed386b9215048ca773"><span class="id" title="notation">×</span></a> <a class="idref" href="#ergs_of"><span class="id" title="definition">ergs_of</span></a> <a class="idref" href="#L1_MESSAGE_PUBDATA_BYTES"><span class="id" title="definition">L1_MESSAGE_PUBDATA_BYTES</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#cost:10"><span class="id" title="variable">cost</span></a> <a class="idref" href="#::ZMod_scope:x_'<'_x"><span class="id" title="notation"><</span></a> <a class="idref" href="#::ZMod_scope:x_'<'_x"><span class="id" title="notation">(</span></a><span class="id" title="definition">fromZ</span> (<a class="idref" href="#unsigned_max"><span class="id" title="definition">unsigned_max</span></a> <a class="idref" href="#ergs_bits"><span class="id" title="definition">ergs_bits</span></a>)<a class="idref" href="#::ZMod_scope:x_'<'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#cost_truncated:11"><span class="id" title="variable">cost_truncated</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">low</span> <a class="idref" href="#ergs_bits"><span class="id" title="definition">ergs_bits</span></a> <a class="idref" href="#cost:10"><span class="id" title="variable">cost</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pay"><span class="id" title="inductive">pay</span></a> <a class="idref" href="#cost_truncated:11"><span class="id" title="variable">cost_truncated</span></a> <a class="idref" href="#cs:3"><span class="id" title="variable">cs</span></a> <a class="idref" href="#new_cs:4"><span class="id" title="variable">new_cs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#emit_l1_msg"><span class="id" title="inductive">emit_l1_msg</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ev_shard_id"><span class="id" title="projection">ev_shard_id</span></a> := <a class="idref" href="#current_shard"><span class="id" title="definition">current_shard</span></a> <a class="idref" href="#cs:3"><span class="id" title="variable">cs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ev_is_first"><span class="id" title="projection">ev_is_first</span></a> := <a class="idref" href="#is_first:5"><span class="id" title="variable">is_first</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ev_tx_number_in_block"><span class="id" title="projection">ev_tx_number_in_block</span></a> := <a class="idref" href="#gs_tx_number_in_block"><span class="id" title="projection">gs_tx_number_in_block</span></a> <a class="idref" href="#gs:8"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ev_address"><span class="id" title="projection">ev_address</span></a> := <a class="idref" href="#current_contract"><span class="id" title="definition">current_contract</span></a> <a class="idref" href="#cs:3"><span class="id" title="variable">cs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ev_key"><span class="id" title="projection">ev_key</span></a> := <a class="idref" href="#key:6"><span class="id" title="variable">key</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ev_value"><span class="id" title="projection">ev_value</span></a> := <a class="idref" href="#value:7"><span class="id" title="variable">value</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|} <a class="idref" href="#gs:8"><span class="id" title="variable">gs</span></a> <a class="idref" href="#new_gs:9"><span class="id" title="variable">new_gs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ts2:13"><span class="id" title="variable">ts2</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ts1:12"><span class="id" title="variable">ts1</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#new_cs:4"><span class="id" title="variable">new_cs</span></a> <span class="id" title="notation">|></span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_tol1:1"><span class="id" title="inductive">step_tol1</span></a> (<a class="idref" href="#OpToL1Message"><span class="id" title="constructor">OpToL1Message</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#__:14"><span class="id" title="variable">__</span></a> <a class="idref" href="#key:6"><span class="id" title="variable">key</span></a>) (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#___1:15"><span class="id" title="variable">___1</span></a> <a class="idref" href="#value:7"><span class="id" title="variable">value</span></a>) <a class="idref" href="#is_first:5"><span class="id" title="variable">is_first</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := <a class="idref" href="#ts1:12"><span class="id" title="variable">ts1</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>    := <a class="idref" href="#gs:8"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := <a class="idref" href="#ts2:13"><span class="id" title="variable">ts2</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>    := <a class="idref" href="#new_gs:9"><span class="id" title="variable">new_gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#ToL1Definition"><span class="id" title="section">ToL1Definition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.PrecompileCall</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a> <a class="idref" href="#"><span class="id" title="library">Precompiles</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Addressing</span></a> <a class="idref" href="#"><span class="id" title="module">ABI</span></a> <a class="idref" href="#"><span class="id" title="module">Bool</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Coder</span></a> <a class="idref" href="#"><span class="id" title="module">Predication</span></a> <a class="idref" href="#"><span class="id" title="module">Ergs</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">Event</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryOps</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#Coercions"><span class="id" title="module">Addressing.Coercions</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <span class="id" title="module">RecordSetNotations</span> <a class="idref" href="#"><span class="id" title="module">PrecompileParametersABI</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="PrecompileCallDefinition" class="idref" href="#PrecompileCallDefinition"><span class="id" title="section">PrecompileCallDefinition</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect.tuple</span> <span class="id" title="module">ssreflect.eqtype</span>.<br/>
</div>

<div class="doc"><h1 id="opprecompile">OpPrecompile</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span class="inlinecode"><span class="id"
title="var">OpPrecompile</span></span> <span class="inlinecode">(<span
class="id" title="var">in1</span>:</span> <span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>callp in1, in2, out1</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<p><code>log.precompile in1, in2, out1</code></p>
<h2 id="summary">Summary</h2>
<p>A precompile call is a call to an extension of a virtual machine. The
extension operates differently depending on the currently executing
contract’s address. Only system contracts may have precompiles.</p>
<ul>
<li>Requires <span
class="inlinecode"><a class="idref" href="#KernelMode"><span
class="id" title="section">KernelMode</span></a></span></li>
</ul>
<h2 id="semantic">Semantic</h2>
<p>Attempt to pay the extra cost:</p>
<p><span class="math display">\mathit{cost_{extra}} = \mathit{in}_2 \mod
2^{32}</span></p>
<ul>
<li>If the cost is affordable:
<ul>
<li>pay <span class="math inline">\mathit{cost_{extra}}</span></li>
<li>execute the precompile logic associated to the currently executing
contract. This will emit a special event.</li>
<li>set <span class="math inline">{out}_1</span> to one.</li>
</ul></li>
<li>If the cost is unaffordable, do not pay anything beyound <span
class="inlinecode"><a class="idref" href="#base_cost"><span
class="id" title="definition">base_cost</span></a></span> of this
instruciton. Set <span class="math inline">{out}_1</span> to zero.</li>
</ul>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, because <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_precompile" class="idref" href="#step_precompile"><span class="id" title="inductive">step_precompile</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
&nbsp;&nbsp;| <a id="step_PrecompileCall_affordable" class="idref" href="#step_PrecompileCall_affordable"><span class="id" title="constructor">step_PrecompileCall_affordable</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="flags:3" class="idref" href="#flags:3"><span class="id" title="binder">flags</span></a> <a id="pages:4" class="idref" href="#pages:4"><span class="id" title="binder">pages</span></a> <a id="cs:5" class="idref" href="#cs:5"><span class="id" title="binder">cs</span></a> <a id="regs:6" class="idref" href="#regs:6"><span class="id" title="binder">regs</span></a> <a id="result:7" class="idref" href="#result:7"><span class="id" title="binder">result</span></a> <a id="new_cs:8" class="idref" href="#new_cs:8"><span class="id" title="binder">new_cs</span></a> <a id="extra_ergs:9" class="idref" href="#extra_ergs:9"><span class="id" title="binder">extra_ergs</span></a> <a id="gs:10" class="idref" href="#gs:10"><span class="id" title="binder">gs</span></a> <a id="new_gs:11" class="idref" href="#new_gs:11"><span class="id" title="binder">new_gs</span></a> <a id="ctx:12" class="idref" href="#ctx:12"><span class="id" title="binder">ctx</span></a> <a id="___1:13" class="idref" href="#___1:13"><span class="id" title="binder">___1</span></a> <a id="new_xs:14" class="idref" href="#new_xs:14"><span class="id" title="binder">new_xs</span></a> <a id="params:15" class="idref" href="#params:15"><span class="id" title="binder">params</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="heap_id:16" class="idref" href="#heap_id:16"><span class="id" title="binder">heap_id</span></a> := <a class="idref" href="#active_heap_id"><span class="id" title="definition">active_heap_id</span></a> <a class="idref" href="#cs:5"><span class="id" title="variable">cs</span></a> <span class="id" title="tactic">in</span><br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cost:17" class="idref" href="#cost:17"><span class="id" title="binder">cost</span></a> := <span class="id" title="definition">low</span> <a class="idref" href="#ergs_bits"><span class="id" title="definition">ergs_bits</span></a> <a class="idref" href="#extra_ergs:9"><span class="id" title="variable">extra_ergs</span></a> <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#pay"><span class="id" title="inductive">pay</span></a> <a class="idref" href="#cost:17"><span class="id" title="variable">cost</span></a> <a class="idref" href="#cs:5"><span class="id" title="variable">cs</span></a> <a class="idref" href="#new_cs:8"><span class="id" title="variable">new_cs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#result:7"><span class="id" title="variable">result</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#one256"><span class="id" title="definition">one256</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="xs:18" class="idref" href="#xs:18"><span class="id" title="binder">xs</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#new_cs:8"><span class="id" title="variable">new_cs</span></a>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#regs:6"><span class="id" title="variable">regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:4"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags:3"><span class="id" title="variable">flags</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#ctx:12"><span class="id" title="variable">ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|} <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#precompile_processor"><span class="id" title="axiom">Precompiles.precompile_processor</span></a> (<a class="idref" href="#current_contract"><span class="id" title="definition">current_contract</span></a> <a class="idref" href="#cs:5"><span class="id" title="variable">cs</span></a>) <a class="idref" href="#params:15"><span class="id" title="variable">params</span></a> <a class="idref" href="#xs:18"><span class="id" title="variable">xs</span></a> <a class="idref" href="#new_xs:14"><span class="id" title="variable">new_xs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#emit_event"><span class="id" title="inductive">emit_event</span></a> (<a class="idref" href="#PrecompileQuery"><span class="id" title="constructor">PrecompileQuery</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#q_contract_address"><span class="id" title="projection">q_contract_address</span></a> := <a class="idref" href="#current_contract"><span class="id" title="definition">current_contract</span></a> <a class="idref" href="#cs:5"><span class="id" title="variable">cs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#q_tx_number_in_block"><span class="id" title="projection">q_tx_number_in_block</span></a> := <a class="idref" href="#gs_tx_number_in_block"><span class="id" title="projection">gs_tx_number_in_block</span></a> <a class="idref" href="#gs:10"><span class="id" title="variable">gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#q_shard_id"><span class="id" title="projection">q_shard_id</span></a> := <a class="idref" href="#current_shard"><span class="id" title="definition">current_shard</span></a> <a class="idref" href="#cs:5"><span class="id" title="variable">cs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#q_key"><span class="id" title="projection">q_key</span></a> := <a class="idref" href="#params:15"><span class="id" title="variable">params</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}) <a class="idref" href="#gs:10"><span class="id" title="variable">gs</span></a> <a class="idref" href="#new_gs:11"><span class="id" title="variable">new_gs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_precompile:1"><span class="id" title="inductive">step_precompile</span></a> (<a class="idref" href="#OpPrecompileCall"><span class="id" title="constructor">OpPrecompileCall</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#params:15"><span class="id" title="variable">params</span></a>)) (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#___1:13"><span class="id" title="variable">___1</span></a> <a class="idref" href="#extra_ergs:9"><span class="id" title="variable">extra_ergs</span></a>) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#result:7"><span class="id" title="variable">result</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#regs:6"><span class="id" title="variable">regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:4"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#cs:5"><span class="id" title="variable">cs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags:3"><span class="id" title="variable">flags</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#ctx:12"><span class="id" title="variable">ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>       := <a class="idref" href="#gs:10"><span class="id" title="variable">gs</span></a>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_transient"><span class="id" title="projection">gs_transient</span></a>    := <a class="idref" href="#new_xs:14"><span class="id" title="variable">new_xs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_global"><span class="id" title="projection">gs_global</span></a>       := <a class="idref" href="#new_gs:11"><span class="id" title="variable">new_gs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;| <a id="step_PrecompileCall_unaffordable" class="idref" href="#step_PrecompileCall_unaffordable"><span class="id" title="constructor">step_PrecompileCall_unaffordable</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="flags:19" class="idref" href="#flags:19"><span class="id" title="binder">flags</span></a> <a id="pages:20" class="idref" href="#pages:20"><span class="id" title="binder">pages</span></a> <a id="cs:21" class="idref" href="#cs:21"><span class="id" title="binder">cs</span></a> <a id="regs:22" class="idref" href="#regs:22"><span class="id" title="binder">regs</span></a> <a id="extra_ergs:23" class="idref" href="#extra_ergs:23"><span class="id" title="binder">extra_ergs</span></a> <a id="___1:24" class="idref" href="#___1:24"><span class="id" title="binder">___1</span></a> <a id="___2:25" class="idref" href="#___2:25"><span class="id" title="binder">___2</span></a> <a id="s1:26" class="idref" href="#s1:26"><span class="id" title="binder">s1</span></a> <a id="s2:27" class="idref" href="#s2:27"><span class="id" title="binder">s2</span></a> <a id="result:28" class="idref" href="#result:28"><span class="id" title="binder">result</span></a> <a id="ctx:29" class="idref" href="#ctx:29"><span class="id" title="binder">ctx</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="cost:30" class="idref" href="#cost:30"><span class="id" title="binder">cost</span></a> := <span class="id" title="definition">low</span> <a class="idref" href="#ergs_bits"><span class="id" title="definition">ergs_bits</span></a> <a class="idref" href="#extra_ergs:23"><span class="id" title="variable">extra_ergs</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#affordable"><span class="id" title="definition">affordable</span></a> <a class="idref" href="#cs:21"><span class="id" title="variable">cs</span></a> <a class="idref" href="#cost:30"><span class="id" title="variable">cost</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#result:28"><span class="id" title="variable">result</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#zero256"><span class="id" title="definition">zero256</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_transient_only"><span class="id" title="inductive">step_transient_only</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#cs:21"><span class="id" title="variable">cs</span></a>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#regs:22"><span class="id" title="variable">regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags:19"><span class="id" title="variable">flags</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:20"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#ctx:29"><span class="id" title="variable">ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a>    := <a class="idref" href="#ergs_reset"><span class="id" title="definition">ergs_reset</span></a> <a class="idref" href="#cs:21"><span class="id" title="variable">cs</span></a>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_regs"><span class="id" title="projection">gs_regs</span></a>         := <a class="idref" href="#regs:22"><span class="id" title="variable">regs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_flags"><span class="id" title="projection">gs_flags</span></a>        := <a class="idref" href="#flags:19"><span class="id" title="variable">flags</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_pages"><span class="id" title="projection">gs_pages</span></a>        := <a class="idref" href="#pages:20"><span class="id" title="variable">pages</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> := <a class="idref" href="#ctx:29"><span class="id" title="variable">ctx</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#gs_status"><span class="id" title="projection">gs_status</span></a>       := <a class="idref" href="#NoPanic"><span class="id" title="constructor">NoPanic</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|} <a class="idref" href="#s1:26"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:27"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_precompile:1"><span class="id" title="inductive">step_precompile</span></a> (<a class="idref" href="#OpPrecompileCall"><span class="id" title="constructor">OpPrecompileCall</span></a> <a class="idref" href="#___2:25"><span class="id" title="variable">___2</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#___1:24"><span class="id" title="variable">___1</span></a> <a class="idref" href="#extra_ergs:23"><span class="id" title="variable">extra_ergs</span></a>) (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#result:28"><span class="id" title="variable">result</span></a>)) <a class="idref" href="#s1:26"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:27"><span class="id" title="variable">s2</span></a><br/>
.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#PrecompileCallDefinition"><span class="id" title="section">PrecompileCallDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.Decommit</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Addressing</span></a> <a class="idref" href="#"><span class="id" title="module">Bool</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Predication</span></a> <a class="idref" href="#"><span class="id" title="module">GPR</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryOps</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <span class="id" title="module">RecordSetNotations</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="DecommitDefinition" class="idref" href="#DecommitDefinition"><span class="id" title="section">DecommitDefinition</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_decommit" class="idref" href="#step_decommit"><span class="id" title="inductive">step_decommit</span></a>: @<a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#decoded"><span class="id" title="definition">decoded</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
</div>

<div class="doc"><h1 id="opdecommit">OpDecommit</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpDecommit"><span
class="id" title="constructor">OpDecommit</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">in2</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>dcmt in1, in2, out1</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<p><code>decommit in1, in2, out1</code></p>
<h2 id="summary">Summary</h2>
<p>Decommit code into memory.</p>
<ul>
<li>Requires <span
class="inlinecode"><a class="idref" href="#KernelMode"><span
class="id" title="section">KernelMode</span></a></span></li>
</ul>
<h2 id="semantic">Semantic</h2>
<p>FIXME</p>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, because <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Read data from a read-only slice returned from a far call, or passed
to a far call.</li>
<li>One of few instructions that accept only reg or imm operand but do
not have full addressing mode, therefore can’t e.g. address stack. The
full list is: <span
class="inlinecode"><a class="idref" href="#OpLoad"><span
class="id" title="constructor">OpLoad</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpLoadInc"><span
class="id" title="constructor">OpLoadInc</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpStore"><span
class="id" title="constructor">OpStore</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpStoreInc"><span
class="id" title="constructor">OpStoreInc</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpLoadPointer"><span
class="id" title="constructor">OpLoadPointer</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpLoadPointerInc"><span
class="id" title="constructor">OpLoadPointerInc</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;FIXME:&nbsp;no&nbsp;semantic&nbsp;yet&nbsp;*)</span><br/>
| <a id="step_decommit_apply" class="idref" href="#step_decommit_apply"><span class="id" title="constructor">step_decommit_apply</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="src0:3" class="idref" href="#src0:3"><span class="id" title="binder">src0</span></a> <a id="src1:4" class="idref" href="#src1:4"><span class="id" title="binder">src1</span></a> <a id="dst0:5" class="idref" href="#dst0:5"><span class="id" title="binder">dst0</span></a> (<a id="s:6" class="idref" href="#s:6"><span class="id" title="binder">s</span></a>: <a class="idref" href="#state"><span class="id" title="record">state</span></a>),<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_decommit:1"><span class="id" title="inductive">step_decommit</span></a> (<a class="idref" href="#OpDecommit"><span class="id" title="constructor">OpDecommit</span></a> <a class="idref" href="#src0:3"><span class="id" title="variable">src0</span></a> <a class="idref" href="#src1:4"><span class="id" title="variable">src1</span></a> <a class="idref" href="#dst0:5"><span class="id" title="variable">dst0</span></a>) <a class="idref" href="#s:6"><span class="id" title="variable">s</span></a> <a class="idref" href="#s:6"><span class="id" title="variable">s</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#DecommitDefinition"><span class="id" title="section">DecommitDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.Contract</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Addressing</span></a> <a class="idref" href="#"><span class="id" title="module">ABI</span></a> <a class="idref" href="#"><span class="id" title="module">Bool</span></a> <a class="idref" href="#"><span class="id" title="module">Coder</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Predication</span></a> <a class="idref" href="#"><span class="id" title="module">Ergs</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryOps</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#Coercions"><span class="id" title="module">Addressing.Coercions</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <span class="id" title="module">RecordSetNotations</span> <a class="idref" href="#"><span class="id" title="module">ABI.MetaParametersABI</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="ContractDefinitions" class="idref" href="#ContractDefinitions"><span class="id" title="section">ContractDefinitions</span></a>.<br/>
</div>

<div class="doc"><h1 id="opcontractthis">OpContractThis</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpContractThis"><span
class="id" title="constructor">OpContractThis</span></a></span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>this out1</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<pre><code>context.this out</code></pre>
<h2 id="summary">Summary</h2>
<p>Retrieves the address of the currently executed contract.</p>
<h2 id="semantic">Semantic</h2>
<ul>
<li>Fetch the address of the currently executed contract from the active
external frame.</li>
<li>Widen the address to <span
class="inlinecode"><a class="idref" href="#word_bits"><span
class="id" title="definition">word_bits</span></a></span>,
zero-extended, and write to register <code>out</code>.</li>
</ul>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, because <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>On <span
class="inlinecode"><a class="idref" href="#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span> this
address is preserved to be one of the caller. See <span
class="inlinecode"><a class="idref" href="#select_this_address"><span
class="id"
title="definition">select_this_address</span></a></span>.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<ul>
<li>See <span
class="inlinecode"><a class="idref" href="#OpContractCaller"><span
class="id" title="constructor">OpContractCaller</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpContractCodeAddress"><span
class="id"
title="constructor">OpContractCodeAddress</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Inductive</span> <a id="step_contract" class="idref" href="#step_contract"><span class="id" title="inductive">step_contract</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
<br/>
| <a id="step_ContractThis" class="idref" href="#step_ContractThis"><span class="id" title="constructor">step_ContractThis</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="this_addr:3" class="idref" href="#this_addr:3"><span class="id" title="binder">this_addr</span></a> (<a id="this_addr_word:4" class="idref" href="#this_addr_word:4"><span class="id" title="binder">this_addr_word</span></a>:<a class="idref" href="#word"><span class="id" title="definition">word</span></a>) (<a id="s1:5" class="idref" href="#s1:5"><span class="id" title="binder">s1</span></a> <a id="s2:6" class="idref" href="#s2:6"><span class="id" title="binder">s2</span></a>: <a class="idref" href="#state"><span class="id" title="record">state</span></a>),<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#this_addr:3"><span class="id" title="variable">this_addr</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ecf_this_address"><span class="id" title="projection">ecf_this_address</span></a> (<a class="idref" href="#active_extframe"><span class="id" title="definition">active_extframe</span></a> (<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s1:5"><span class="id" title="variable">s1</span></a>)) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#this_addr_word:4"><span class="id" title="variable">this_addr_word</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#widen"><span class="id" title="definition">widen</span></a> <a class="idref" href="#word_bits"><span class="id" title="definition">word_bits</span></a> <a class="idref" href="#this_addr:3"><span class="id" title="variable">this_addr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_contract:1"><span class="id" title="inductive">step_contract</span></a> (<a class="idref" href="#OpContractThis"><span class="id" title="constructor">OpContractThis</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#this_addr_word:4"><span class="id" title="variable">this_addr_word</span></a>)) <a class="idref" href="#s1:5"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:6"><span class="id" title="variable">s2</span></a><br/>
</div>

<div class="doc"><h1 id="opcontractcaller">OpContractCaller</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpContractCaller"><span
class="id" title="constructor">OpContractCaller</span></a></span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>par out1</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<pre><code>context.caller out</code></pre>
<h2 id="summary">Summary</h2>
<p>Retrieves the address of the contract which has called the currently
executed contract.</p>
<h2 id="semantic">Semantic</h2>
<ul>
<li>Fetch the address of the currently executed contract from the active
external frame.</li>
<li>Widen address is widened to <span
class="inlinecode"><a class="idref" href="#word_bits"><span
class="id" title="definition">word_bits</span></a></span>,
zero-extended, and written to register <code>out</code>.</li>
</ul>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, because <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<p>On <span
class="inlinecode"><a class="idref" href="#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span> this
address is preserved to be the caller of the caller. See <span
class="inlinecode"><a class="idref" href="#select_sender"><span
class="id" title="definition">select_sender</span></a></span>.</p>
<h2 id="related-instructions">Related instructions</h2>
<ul>
<li>See <span
class="inlinecode"><a class="idref" href="#OpContractThis"><span
class="id" title="constructor">OpContractThis</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpContractCodeAddress"><span
class="id"
title="constructor">OpContractCodeAddress</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
| <a id="step_ContractCaller" class="idref" href="#step_ContractCaller"><span class="id" title="constructor">step_ContractCaller</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="sender_addr:7" class="idref" href="#sender_addr:7"><span class="id" title="binder">sender_addr</span></a> <a id="sender_addr_word:8" class="idref" href="#sender_addr_word:8"><span class="id" title="binder">sender_addr_word</span></a> (<a id="s1:9" class="idref" href="#s1:9"><span class="id" title="binder">s1</span></a> <a id="s2:10" class="idref" href="#s2:10"><span class="id" title="binder">s2</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#sender_addr:7"><span class="id" title="variable">sender_addr</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> (<a class="idref" href="#active_extframe"><span class="id" title="definition">active_extframe</span></a> (<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s1:9"><span class="id" title="variable">s1</span></a>)).(<a class="idref" href="#ecf_msg_sender"><span class="id" title="projection">ecf_msg_sender</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#sender_addr_word:8"><span class="id" title="variable">sender_addr_word</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#widen"><span class="id" title="definition">widen</span></a> <a class="idref" href="#word_bits"><span class="id" title="definition">word_bits</span></a> <a class="idref" href="#sender_addr:7"><span class="id" title="variable">sender_addr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_contract:1"><span class="id" title="inductive">step_contract</span></a> (<a class="idref" href="#OpContractCaller"><span class="id" title="constructor">OpContractCaller</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#sender_addr_word:8"><span class="id" title="variable">sender_addr_word</span></a>)) <a class="idref" href="#s1:9"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:10"><span class="id" title="variable">s2</span></a><br/>
</div>

<div class="doc"><h1 id="opcontractcodeaddress">OpContractCodeAddress</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpContractCodeAddress"><span
class="id" title="constructor">OpContractCodeAddress</span></a></span>
<span class="inlinecode">(<span class="id"
title="var">out1</span>:</span> <span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>code out1</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<pre><code>context.code_source out</code></pre>
<h2 id="summary">Summary</h2>
<p>Retrieves the address of the contract code that is actually being
executed.</p>
<h2 id="semantic">Semantic</h2>
<ul>
<li>Fetch the contract address of the currently executed code from the
active external frame.</li>
<li>Widen the address to <span
class="inlinecode"><a class="idref" href="#word_bits"><span
class="id" title="definition">word_bits</span></a></span>,
zero-extended, and write to register <code>out</code>.</li>
</ul>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, because <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>In the execution frame created by <span
class="inlinecode"><a class="idref" href="#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span> this
will be the address of the contract that was called by <span
class="inlinecode"><a class="idref" href="#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span>.</li>
<li>Necessary to implement Solidity’s <code>immutable</code> under <span
class="inlinecode"><a class="idref" href="#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span>.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<ul>
<li>See <span
class="inlinecode"><a class="idref" href="#OpContractThis"><span
class="id" title="constructor">OpContractThis</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpContractCaller"><span
class="id" title="constructor">OpContractCaller</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
| <a id="step_ContractCodeAddress" class="idref" href="#step_ContractCodeAddress"><span class="id" title="constructor">step_ContractCodeAddress</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="code_addr:11" class="idref" href="#code_addr:11"><span class="id" title="binder">code_addr</span></a> <a id="code_addr_word:12" class="idref" href="#code_addr_word:12"><span class="id" title="binder">code_addr_word</span></a> (<a id="s1:13" class="idref" href="#s1:13"><span class="id" title="binder">s1</span></a> <a id="s2:14" class="idref" href="#s2:14"><span class="id" title="binder">s2</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#code_addr:11"><span class="id" title="variable">code_addr</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ecf_code_address"><span class="id" title="projection">ecf_code_address</span></a> (<a class="idref" href="#active_extframe"><span class="id" title="definition">active_extframe</span></a> (<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s1:13"><span class="id" title="variable">s1</span></a>)) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#code_addr_word:12"><span class="id" title="variable">code_addr_word</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#widen"><span class="id" title="definition">widen</span></a> <a class="idref" href="#word_bits"><span class="id" title="definition">word_bits</span></a> <a class="idref" href="#code_addr:11"><span class="id" title="variable">code_addr</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_contract:1"><span class="id" title="inductive">step_contract</span></a> (<a class="idref" href="#OpContractCodeAddress"><span class="id" title="constructor">OpContractCodeAddress</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#code_addr_word:12"><span class="id" title="variable">code_addr_word</span></a>)) <a class="idref" href="#s1:13"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:14"><span class="id" title="variable">s2</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#ContractDefinitions"><span class="id" title="section">ContractDefinitions</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.VM</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Addressing</span></a> <a class="idref" href="#"><span class="id" title="module">ABI</span></a> <a class="idref" href="#"><span class="id" title="module">Bool</span></a> <a class="idref" href="#"><span class="id" title="module">Coder</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Predication</span></a> <a class="idref" href="#"><span class="id" title="module">Ergs</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryOps</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#Coercions"><span class="id" title="module">Addressing.Coercions</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <span class="id" title="module">RecordSetNotations</span> <a class="idref" href="#"><span class="id" title="module">ABI.MetaParametersABI</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="VMDefinitions" class="idref" href="#VMDefinitions"><span class="id" title="section">VMDefinitions</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="step_vm" class="idref" href="#step_vm"><span class="id" title="inductive">step_vm</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
&nbsp;&nbsp;</div>

<div class="doc"><h1 id="opvmergsleft">OpVMErgsLeft</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpVMErgsLeft"><span
class="id" title="constructor">OpVMErgsLeft</span></a></span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>ergs out1</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<p><code>context.ergs_left out</code></p>
<h2 id="summary">Summary</h2>
<p>Retrieves the number of ergs allocated for the current frame.</p>
<h2 id="semantic">Semantic</h2>
<ul>
<li>Fetch the currently allocated ergs from the topmost frame, external
or internal. The <code>ergs</code> belonging to the parent frames are
not counted.</li>
<li>Widen the ergs number to <span
class="inlinecode"><a class="idref" href="#word_bits"><span
class="id" title="definition">word_bits</span></a></span>,
zero-extended, and write to <code>out</code>.</li>
</ul>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, because <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Check if the number of ergs is sufficient for an expensive
task.</li>
<li>Should be used before <span
class="inlinecode"><a class="idref" href="#OpPrecompileCall"><span
class="id" title="constructor">OpPrecompileCall</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_VMErgsLeft" class="idref" href="#step_VMErgsLeft"><span class="id" title="constructor">step_VMErgsLeft</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="ergs_left_word:3" class="idref" href="#ergs_left_word:3"><span class="id" title="binder">ergs_left_word</span></a> (<a id="s1:4" class="idref" href="#s1:4"><span class="id" title="binder">s1</span></a> <a id="s2:5" class="idref" href="#s2:5"><span class="id" title="binder">s2</span></a>:<a class="idref" href="#state"><span class="id" title="record">state</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_left_word:3"><span class="id" title="variable">ergs_left_word</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#widen"><span class="id" title="definition">widen</span></a> <a class="idref" href="#word_bits"><span class="id" title="definition">word_bits</span></a> (<a class="idref" href="#ergs_remaining"><span class="id" title="definition">ergs_remaining</span></a> (<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s1:4"><span class="id" title="variable">s1</span></a>)) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_vm:1"><span class="id" title="inductive">step_vm</span></a> (<a class="idref" href="#OpVMErgsLeft"><span class="id" title="constructor">OpVMErgsLeft</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#ergs_left_word:3"><span class="id" title="variable">ergs_left_word</span></a>)) <a class="idref" href="#s1:4"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:5"><span class="id" title="variable">s2</span></a><br/>
<br/>
&nbsp;&nbsp;</div>

<div class="doc"><h1 id="opvmsp">OpVMSP</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpVMSP"><span
class="id" title="constructor">OpVMSP</span></a></span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>sp out1</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<p><code>context.sp out</code></p>
<h2 id="summary">Summary</h2>
<p>Retrieves current stack pointer value.</p>
<h2 id="semantic">Semantic</h2>
<ul>
<li>Fetch the current SP from the topmost frame, external or internal.
It points past the topmost element of the stack.</li>
<li>Widen the SP value to <span
class="inlinecode"><a class="idref" href="#word_bits"><span
class="id" title="definition">word_bits</span></a></span>,
zero-extended, and write to <code>out</code>.</li>
</ul>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, because <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<h2 id="related-instructions">Related instructions</h2>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_VMSP" class="idref" href="#step_VMSP"><span class="id" title="constructor">step_VMSP</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="sp_zero_padded:6" class="idref" href="#sp_zero_padded:6"><span class="id" title="binder">sp_zero_padded</span></a> (<a id="s1:7" class="idref" href="#s1:7"><span class="id" title="binder">s1</span></a> <a id="s2:8" class="idref" href="#s2:8"><span class="id" title="binder">s2</span></a> :<a class="idref" href="#state"><span class="id" title="record">state</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#sp_zero_padded:6"><span class="id" title="variable">sp_zero_padded</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#widen"><span class="id" title="definition">widen</span></a> <a class="idref" href="#word_bits"><span class="id" title="definition">word_bits</span></a> (<a class="idref" href="#sp_get"><span class="id" title="definition">sp_get</span></a> (<a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s1:7"><span class="id" title="variable">s1</span></a>)) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_vm:1"><span class="id" title="inductive">step_vm</span></a> (<a class="idref" href="#OpVMSP"><span class="id" title="constructor">OpVMSP</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#sp_zero_padded:6"><span class="id" title="variable">sp_zero_padded</span></a>)) <a class="idref" href="#s1:7"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:8"><span class="id" title="variable">s2</span></a><br/>
<br/>
&nbsp;&nbsp;</div>

<div class="doc"><h1 id="opvmmeta">OpVMMeta</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpVMMeta"><span
class="id" title="constructor">OpVMMeta</span></a></span> <span
class="inlinecode">(<span class="id" title="var">out1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>meta out1</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<pre><code>context.meta  out</code></pre>
<h2 id="summary">Summary</h2>
<p>VM internal state introspection.</p>
<h2 id="semantic">Semantic</h2>
<ul>
<li>Stores the encoded value of <span
class="inlinecode"><a class="idref" href="#MetaParametersABI"><span
class="id" title="section">MetaParametersABI</span></a></span> in
<code>out</code>. The value is structured as follows:</li>
</ul>
<pre><code>Record params := {
      ergs_per_pubdata_byte: ergs;
      heap_size: mem_address;
      aux_heap_size: mem_address;
      this_shard_id: shard_id;
      caller_shard_id: shard_id;
      code_shard_id: shard_id;
    }.</code></pre>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, because <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;| <a id="step_VMMeta" class="idref" href="#step_VMMeta"><span class="id" title="constructor">step_VMMeta</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="params:9" class="idref" href="#params:9"><span class="id" title="binder">params</span></a> <a id="cs:10" class="idref" href="#cs:10"><span class="id" title="binder">cs</span></a> <a id="shards:11" class="idref" href="#shards:11"><span class="id" title="binder">shards</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="s1:12" class="idref" href="#s1:12"><span class="id" title="binder">s1</span></a> <a id="s2:13" class="idref" href="#s2:13"><span class="id" title="binder">s2</span></a>: <a class="idref" href="#state"><span class="id" title="record">state</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#cs:10"><span class="id" title="variable">cs</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#gs_callstack"><span class="id" title="projection">gs_callstack</span></a> <a class="idref" href="#s1:12"><span class="id" title="variable">s1</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#shards:11"><span class="id" title="variable">shards</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> (<a class="idref" href="#active_extframe"><span class="id" title="definition">active_extframe</span></a> <a class="idref" href="#cs:10"><span class="id" title="variable">cs</span></a>).(<a class="idref" href="#ecf_shards"><span class="id" title="projection">ecf_shards</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#params:9"><span class="id" title="variable">params</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">{|</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_per_pubdata_byte"><span class="id" title="projection">ergs_per_pubdata_byte</span></a> := <a class="idref" href="#gs_current_ergs_per_pubdata_byte"><span class="id" title="projection">gs_current_ergs_per_pubdata_byte</span></a> <a class="idref" href="#s1:12"><span class="id" title="variable">s1</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#heap_size"><span class="id" title="projection">heap_size</span></a> := <a class="idref" href="#heap_bound"><span class="id" title="definition">heap_bound</span></a> <a class="idref" href="#cs:10"><span class="id" title="variable">cs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#aux_heap_size"><span class="id" title="projection">aux_heap_size</span></a> := <a class="idref" href="#auxheap_bound"><span class="id" title="definition">auxheap_bound</span></a> <a class="idref" href="#cs:10"><span class="id" title="variable">cs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#this_shard_id"><span class="id" title="projection">this_shard_id</span></a> := <a class="idref" href="#shard_this"><span class="id" title="projection">shard_this</span></a> <a class="idref" href="#shards:11"><span class="id" title="variable">shards</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#caller_shard_id"><span class="id" title="projection">caller_shard_id</span></a> := <a class="idref" href="#shard_caller"><span class="id" title="projection">shard_caller</span></a> <a class="idref" href="#shards:11"><span class="id" title="variable">shards</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#code_shard_id"><span class="id" title="projection">code_shard_id</span></a> := <a class="idref" href="#shard_code"><span class="id" title="projection">shard_code</span></a> <a class="idref" href="#shards:11"><span class="id" title="variable">shards</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">|}</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_vm:1"><span class="id" title="inductive">step_vm</span></a> (<a class="idref" href="#OpVMMeta"><span class="id" title="constructor">OpVMMeta</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#params:9"><span class="id" title="variable">params</span></a>))) <a class="idref" href="#s1:12"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:13"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#VMDefinitions"><span class="id" title="section">VMDefinitions</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.sem.Context</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">SemanticCommon</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Addressing</span></a> <a class="idref" href="#"><span class="id" title="module">ABI</span></a> <a class="idref" href="#"><span class="id" title="module">Bool</span></a> <a class="idref" href="#"><span class="id" title="module">Coder</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Predication</span></a> <a class="idref" href="#"><span class="id" title="module">Ergs</span></a> <a class="idref" href="#"><span class="id" title="module">CallStack</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryOps</span></a> <a class="idref" href="#"><span class="id" title="module">isa.CoreSet</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#Coercions"><span class="id" title="module">Addressing.Coercions</span></a> <a class="idref" href="#"><span class="id" title="module">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="module">SemanticCommon</span></a> <span class="id" title="module">RecordSetNotations</span> <a class="idref" href="#"><span class="id" title="module">ABI.MetaParametersABI</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="ContextDefinitions" class="idref" href="#ContextDefinitions"><span class="id" title="section">ContextDefinitions</span></a>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <a id="step_context" class="idref" href="#step_context"><span class="id" title="inductive">step_context</span></a>: <a class="idref" href="#instruction"><span class="id" title="inductive">instruction</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#smallstep"><span class="id" title="definition">smallstep</span></a> :=<br/>
</div>

<div class="doc"><h1 id="opgetcapturedcontext">OpGetCapturedContext</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpGetCapturedContext"><span
class="id" title="constructor">OpGetCapturedContext</span></a></span>
<span class="inlinecode">(<span class="id"
title="var">out1</span>:</span> <span
class="inlinecode"><a class="idref" href="#out_reg"><span
class="id" title="definition">out_reg</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>ldvl out1</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<pre><code>context.get_context_u128 out</code></pre>
<h2 id="summary">Summary</h2>
<p>Retrieves current captured context value from the active external
frame.</p>
<p>Does not interact with the context register.</p>
<h2 id="semantic">Semantic</h2>
<ul>
<li>Fetch the current context value from the active external frame.</li>
<li>Widen the context value from 128 bits to <span
class="inlinecode"><a class="idref" href="#word_bits"><span
class="id" title="definition">word_bits</span></a></span>,
zero-extended, and write to <code>out</code>.</li>
</ul>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>GPRs, because <code>out</code> resolves to a register.</li>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>See <span
class="inlinecode"><a class="idref" href="#gs_context_u128"><span
class="id" title="projection">gs_context_u128</span></a></span>, <span
class="inlinecode"><a class="idref" href="#ecf_context_u128_value"><span
class="id"
title="projection">ecf_context_u128_value</span></a></span>.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<ul>
<li>Farcalls capture context. See <span
class="inlinecode"><a class="idref" href="#OpFarCall"><span
class="id" title="constructor">OpFarCall</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpMimicCall"><span
class="id" title="constructor">OpMimicCall</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span>.</li>
<li><span
class="inlinecode"><a class="idref" href="#OpSetContextReg"><span
class="id" title="constructor">OpSetContextReg</span></a></span> to set
context register, from where the value is captured by farcalls.</li>
</ul>
</div>
<div class="code">
<br/>
| <a id="step_GetCapturedContext" class="idref" href="#step_GetCapturedContext"><span class="id" title="constructor">step_GetCapturedContext</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="wcontext:3" class="idref" href="#wcontext:3"><span class="id" title="binder">wcontext</span></a> (<a id="s1:4" class="idref" href="#s1:4"><span class="id" title="binder">s1</span></a> <a id="s2:5" class="idref" href="#s2:5"><span class="id" title="binder">s2</span></a>: <a class="idref" href="#state"><span class="id" title="record">state</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#wcontext:3"><span class="id" title="variable">wcontext</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#widen"><span class="id" title="definition">widen</span></a> <a class="idref" href="#word_bits"><span class="id" title="definition">word_bits</span></a> (<a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> <a class="idref" href="#s1:4"><span class="id" title="variable">s1</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_context:1"><span class="id" title="inductive">step_context</span></a> (<a class="idref" href="#OpGetCapturedContext"><span class="id" title="constructor">OpGetCapturedContext</span></a> (<a class="idref" href="#IntValue"><span class="id" title="abbreviation">IntValue</span></a> <a class="idref" href="#wcontext:3"><span class="id" title="variable">wcontext</span></a>)) <a class="idref" href="#s1:4"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:5"><span class="id" title="variable">s2</span></a><br/>
</div>

<div class="doc"><h1 id="opsetcontextreg">OpSetContextReg</h1>
<h2 id="abstract-syntax">Abstract Syntax</h2>
<p><span
class="inlinecode"><a class="idref" href="#OpSetContextReg"><span
class="id" title="constructor">OpSetContextReg</span></a></span> <span
class="inlinecode">(<span class="id" title="var">in1</span>:</span>
<span
class="inlinecode"><a class="idref" href="#in_reg"><span
class="id" title="definition">in_reg</span></a>)</span></p>
<h2 id="syntax">Syntax</h2>
<p><code>stvl in1</code></p>
<h2 id="legacy-syntax">Legacy syntax</h2>
<pre><code>context.set_context_u128 in</code></pre>
<h2 id="summary">Summary</h2>
<p>Sets context register.</p>
<p>Does not interact with the captured context value in the active
external frame.</p>
<ul>
<li>Requires <span
class="inlinecode"><a class="idref" href="#KernelMode"><span
class="id" title="section">KernelMode</span></a></span></li>
<li>Forbidden in <span
class="inlinecode"><a class="idref" href="#StaticMode"><span
class="id" title="section">StaticMode</span></a></span></li>
</ul>
<h2 id="semantic">Semantic</h2>
<ul>
<li>Fetch the value from <code>out</code> and narrow it to 128
bits.</li>
<li>Store the shrunk value in the context register <span
class="inlinecode"><a class="idref" href="#gs_context_u128"><span
class="id" title="projection">gs_context_u128</span></a></span>.</li>
</ul>
<h2 id="affected-parts-of-the-state">Affected parts of the state</h2>
<ul>
<li>Execution stack:
<ul>
<li>PC, as by any instruction</li>
</ul></li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>See <span
class="inlinecode"><a class="idref" href="#gs_context_u128"><span
class="id" title="projection">gs_context_u128</span></a></span>, <span
class="inlinecode"><a class="idref" href="#ecf_context_u128_value"><span
class="id"
title="projection">ecf_context_u128_value</span></a></span>.</li>
</ul>
<h2 id="related-instructions">Related instructions</h2>
<ul>
<li>Farcalls capture context. See <span
class="inlinecode"><a class="idref" href="#OpFarCall"><span
class="id" title="constructor">OpFarCall</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpMimicCall"><span
class="id" title="constructor">OpMimicCall</span></a></span>, <span
class="inlinecode"><a class="idref" href="#OpDelegateCall"><span
class="id" title="constructor">OpDelegateCall</span></a></span>.</li>
<li><span
class="inlinecode"><a class="idref" href="#OpGetCapturedContext"><span
class="id" title="constructor">OpGetCapturedContext</span></a></span> to
retrieve a captured context value.</li>
</ul>
</div>
<div class="code">
<br/>
| <a id="step_SetContextReg" class="idref" href="#step_SetContextReg"><span class="id" title="constructor">step_SetContextReg</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="new_context256:6" class="idref" href="#new_context256:6"><span class="id" title="binder">new_context256</span></a> :<a class="idref" href="#word"><span class="id" title="definition">word</span></a>) <a id="any_tag:7" class="idref" href="#any_tag:7"><span class="id" title="binder">any_tag</span></a> (<a id="new_context_u128:8" class="idref" href="#new_context_u128:8"><span class="id" title="binder">new_context_u128</span></a>:<a class="idref" href="#u128"><span class="id" title="definition">u128</span></a>) <a id="xs1:9" class="idref" href="#xs1:9"><span class="id" title="binder">xs1</span></a> <a id="xs2:10" class="idref" href="#xs2:10"><span class="id" title="binder">xs2</span></a> <a id="s1:11" class="idref" href="#s1:11"><span class="id" title="binder">s1</span></a> <a id="s2:12" class="idref" href="#s2:12"><span class="id" title="binder">s2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#new_context_u128:8"><span class="id" title="variable">new_context_u128</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">low</span> 128 <a class="idref" href="#new_context256:6"><span class="id" title="variable">new_context256</span></a><a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#xs2:10"><span class="id" title="variable">xs2</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#xs1:9"><span class="id" title="variable">xs1</span></a> <span class="id" title="notation"><|</span> <a class="idref" href="#gs_context_u128"><span class="id" title="projection">gs_context_u128</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="#new_context_u128:8"><span class="id" title="variable">new_context_u128</span></a> <span class="id" title="notation">|></span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_transient_only"><span class="id" title="inductive">step_transient_only</span></a> <a class="idref" href="#xs1:9"><span class="id" title="variable">xs1</span></a> <a class="idref" href="#xs2:10"><span class="id" title="variable">xs2</span></a> <a class="idref" href="#s1:11"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:12"><span class="id" title="variable">s2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#step_context:1"><span class="id" title="inductive">step_context</span></a> (<a class="idref" href="#OpSetContextReg"><span class="id" title="constructor">OpSetContextReg</span></a> (<a class="idref" href="#mk_pv"><span class="id" title="constructor">mk_pv</span></a> <a class="idref" href="#any_tag:7"><span class="id" title="variable">any_tag</span></a> <a class="idref" href="#new_context256:6"><span class="id" title="variable">new_context256</span></a>)) <a class="idref" href="#s1:11"><span class="id" title="variable">s1</span></a> <a class="idref" href="#s2:12"><span class="id" title="variable">s2</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#ContextDefinitions"><span class="id" title="section">ContextDefinitions</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.Coder</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Common</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect</span> <span class="id" title="module">ssrfun</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Encoding" class="idref" href="#Encoding"><span class="id" title="section">Encoding</span></a>.<br/>

<br/>
</div>

<div class="doc"><h1 id="encoding">Encoding</h1>
<p>Application Binary Interfaces (<span
class="inlinecode"><a class="idref" href="#ABI"><span
class="id" title="definition">ABI</span></a></span>) require describing
serialization and deserialization.</p>
<ul>
<li>Serialization encodes an instance of type <span
class="inlinecode"><span class="id" title="var">T</span></span> into a
word of type <span
class="inlinecode"><a class="idref" href="#word"><span
class="id" title="definition">word</span></a></span>.</li>
<li>Deserialization tries to decode an instance of type <span
class="inlinecode"><span class="id" title="var">T</span></span> from a
word of type <span
class="inlinecode"><a class="idref" href="#word"><span
class="id" title="definition">word</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="U:1" class="idref" href="#U:1"><span class="id" title="binder">U</span></a> <a id="T:2" class="idref" href="#T:2"><span class="id" title="binder">T</span></a>:<span class="id" title="keyword">Type</span>}.<br/>

<br/>
</div>

<div class="doc"><p>The type <span
class="inlinecode"><a class="idref" href="#decoder"><span
class="id" title="definition">decoder</span></a></span> defines an
embedding of a subset of words of type <span
class="inlinecode"><a class="idref" href="#word"><span
class="id" title="definition">word</span></a></span> to a type <span
class="inlinecode"><span class="id" title="var">T</span></span>.
Decoding may fail if the input word is malformed.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="decoder" class="idref" href="#decoder"><span class="id" title="definition">decoder</span></a> := <a class="idref" href="#Encoding.U"><span class="id" title="variable">U</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#Encoding.T"><span class="id" title="variable">T</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>Definition <span
class="inlinecode"><a class="idref" href="#encoder"><span
class="id" title="definition">encoder</span></a></span> defines an
embedding of type <span class="inlinecode"><span class="id"
title="var">T</span></span> to a set of possible <span
class="inlinecode"><a class="idref" href="#word"><span
class="id" title="definition">word</span></a></span> values.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="encoder" class="idref" href="#encoder"><span class="id" title="definition">encoder</span></a> := <a class="idref" href="#Encoding.T"><span class="id" title="variable">T</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#Encoding.U"><span class="id" title="variable">U</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="revertible" class="idref" href="#revertible"><span class="id" title="definition">revertible</span></a> (<a id="decode:3" class="idref" href="#decode:3"><span class="id" title="binder">decode</span></a>:<a class="idref" href="#decoder"><span class="id" title="definition">decoder</span></a>) (<a id="encode:4" class="idref" href="#encode:4"><span class="id" title="binder">encode</span></a>:<a class="idref" href="#encoder"><span class="id" title="definition">encoder</span></a>):= <span class="id" title="keyword">∀</span> <a id="obj:5" class="idref" href="#obj:5"><span class="id" title="binder">obj</span></a> <a id="encoded:6" class="idref" href="#encoded:6"><span class="id" title="binder">encoded</span></a>, <a class="idref" href="#encode:4"><span class="id" title="variable">encode</span></a> <a class="idref" href="#obj:5"><span class="id" title="variable">obj</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#encoded:6"><span class="id" title="variable">encoded</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#decode:3"><span class="id" title="variable">decode</span></a> <a class="idref" href="#encoded:6"><span class="id" title="variable">encoded</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#obj:5"><span class="id" title="variable">obj</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>The record <span
class="inlinecode"><a class="idref" href="#coder"><span
class="id" title="definition">coder</span></a></span> connects a
specific decoder with the matching encoder, and proofs of their
properties.</p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#revertible"><span
class="id" title="definition">revertible</span></a></span> <span
class="inlinecode"><a class="idref" href="#decode"><span
class="id" title="definition">decode</span></a></span> <span
class="inlinecode"><a class="idref" href="#encode"><span
class="id" title="definition">encode</span></a></span> formalizes the
following: if we encode an element <span
class="inlinecode"><a class="idref" href="#PositiveMap.t"><span
class="id" title="definition">t</span></a></span> of type</li>
</ul>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="coder" class="idref" href="#coder"><span class="id" title="record">coder</span></a>  := <span class="id" title="var">mk_coder</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="decode" class="idref" href="#decode"><span class="id" title="projection">decode</span></a>: <a class="idref" href="#decoder"><span class="id" title="definition">decoder</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="encode" class="idref" href="#encode"><span class="id" title="projection">encode</span></a>:  <a class="idref" href="#encoder"><span class="id" title="definition">encoder</span></a>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc"><p><span
class="inlinecode"><a class="idref" href="#decode"><span
class="id" title="definition">decode</span></a></span> and <span
class="inlinecode"><a class="idref" href="#encode"><span
class="id" title="definition">encode</span></a></span> should be mutual
inverses in the following sense:</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">_</span>: <a class="idref" href="#revertible"><span class="id" title="definition">revertible</span></a> <a class="idref" href="#decode:8"><span class="id" title="method">decode</span></a> <a class="idref" href="#encode:9"><span class="id" title="method">encode</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Encoding"><span class="id" title="section">Encoding</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Properties" class="idref" href="#Properties"><span class="id" title="section">Properties</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="A:10" class="idref" href="#A:10"><span class="id" title="binder">A</span></a> <a id="B:11" class="idref" href="#B:11"><span class="id" title="binder">B</span></a> <a id="C:12" class="idref" href="#C:12"><span class="id" title="binder">C</span></a>: <span class="id" title="keyword">Type</span>}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Properties.PropertyComposition" class="idref" href="#Properties.PropertyComposition"><span class="id" title="section">PropertyComposition</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="encode1:13" class="idref" href="#encode1:13"><span class="id" title="binder">encode1</span></a>: @<a class="idref" href="#encoder"><span class="id" title="definition">encoder</span></a> <a class="idref" href="#Properties.B"><span class="id" title="variable">B</span></a> <a class="idref" href="#Properties.A"><span class="id" title="variable">A</span></a>) (<a id="decode1:14" class="idref" href="#decode1:14"><span class="id" title="binder">decode1</span></a>:@<a class="idref" href="#decoder"><span class="id" title="definition">decoder</span></a> <a class="idref" href="#Properties.B"><span class="id" title="variable">B</span></a> <a class="idref" href="#Properties.A"><span class="id" title="variable">A</span></a>) (<a id="encode2:15" class="idref" href="#encode2:15"><span class="id" title="binder">encode2</span></a>: @<a class="idref" href="#encoder"><span class="id" title="definition">encoder</span></a> <a class="idref" href="#Properties.C"><span class="id" title="variable">C</span></a> <a class="idref" href="#Properties.B"><span class="id" title="variable">B</span></a>) (<a id="decode2:16" class="idref" href="#decode2:16"><span class="id" title="binder">decode2</span></a>: @<a class="idref" href="#decoder"><span class="id" title="definition">decoder</span></a> <a class="idref" href="#Properties.C"><span class="id" title="variable">C</span></a> <a class="idref" href="#Properties.B"><span class="id" title="variable">B</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="revertible1_compose" class="idref" href="#revertible1_compose"><span class="id" title="lemma">revertible1_compose</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#revertible"><span class="id" title="definition">revertible</span></a> <a class="idref" href="#Properties.PropertyComposition.decode1"><span class="id" title="variable">decode1</span></a> <a class="idref" href="#Properties.PropertyComposition.encode1"><span class="id" title="variable">encode1</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#revertible"><span class="id" title="definition">revertible</span></a> <a class="idref" href="#Properties.PropertyComposition.decode2"><span class="id" title="variable">decode2</span></a> <a class="idref" href="#Properties.PropertyComposition.encode2"><span class="id" title="variable">encode2</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="encode3:17" class="idref" href="#encode3:17"><span class="id" title="binder">encode3</span></a> : <a class="idref" href="#Properties.A"><span class="id" title="variable">A</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#Properties.C"><span class="id" title="variable">C</span></a> := <a class="idref" href="#pcomp"><span class="id" title="definition">pcomp</span></a> <a class="idref" href="#Properties.PropertyComposition.encode2"><span class="id" title="variable">encode2</span></a> <a class="idref" href="#Properties.PropertyComposition.encode1"><span class="id" title="variable">encode1</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="decode3:18" class="idref" href="#decode3:18"><span class="id" title="binder">decode3</span></a> : <a class="idref" href="#Properties.C"><span class="id" title="variable">C</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#Properties.A"><span class="id" title="variable">A</span></a> := <a class="idref" href="#pcomp"><span class="id" title="definition">pcomp</span></a> <a class="idref" href="#Properties.PropertyComposition.decode1"><span class="id" title="variable">decode1</span></a> <a class="idref" href="#Properties.PropertyComposition.decode2"><span class="id" title="variable">decode2</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#revertible"><span class="id" title="definition">revertible</span></a> <a class="idref" href="#decode3:18"><span class="id" title="variable">decode3</span></a> <a class="idref" href="#encode3:17"><span class="id" title="variable">encode3</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="#Properties.PropertyComposition"><span class="id" title="section">PropertyComposition</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="coder_compose" class="idref" href="#coder_compose"><span class="id" title="definition">coder_compose</span></a> (<a id="c2:19" class="idref" href="#c2:19"><span class="id" title="binder">c2</span></a>: @<a class="idref" href="#coder"><span class="id" title="record">coder</span></a> <a class="idref" href="#Properties.C"><span class="id" title="variable">C</span></a> <a class="idref" href="#Properties.B"><span class="id" title="variable">B</span></a>) (<a id="c1:20" class="idref" href="#c1:20"><span class="id" title="binder">c1</span></a>: @<a class="idref" href="#coder"><span class="id" title="record">coder</span></a> <a class="idref" href="#Properties.B"><span class="id" title="variable">B</span></a> <a class="idref" href="#Properties.A"><span class="id" title="variable">A</span></a>) : @<a class="idref" href="#coder"><span class="id" title="record">coder</span></a> <a class="idref" href="#Properties.C"><span class="id" title="variable">C</span></a> <a class="idref" href="#Properties.A"><span class="id" title="variable">A</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Properties"><span class="id" title="section">Properties</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.ABI</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Coder</span></a> <a class="idref" href="#"><span class="id" title="library">Ergs</span></a> <a class="idref" href="#"><span class="id" title="library">Pointer</span></a> <a class="idref" href="#"><span class="id" title="library">GPR</span></a> <a class="idref" href="#"><span class="id" title="library">MemoryManagement</span></a> <a class="idref" href="#"><span class="id" title="library">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="library">lib.BitsExt</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect</span> <span class="id" title="module">ssreflect.ssrfun</span> <span class="id" title="module">ssreflect.ssrbool</span> <span class="id" title="module">ssreflect.eqtype</span> <span class="id" title="module">ssreflect.tuple</span> <span class="id" title="module">zmodp</span>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Coder</span></a> <a class="idref" href="#"><span class="id" title="module">Bool</span></a> <a class="idref" href="#"><span class="id" title="module">GPR</span></a> <a class="idref" href="#"><span class="id" title="module">Ergs</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryManagement</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a>.<br/>

<br/>
</div>

<div class="doc"><h1 id="application-binary-interface-abi">Application binary interface
(ABI)</h1>
<p>This section details the serialization and deserialization formats
for compound instruction arguments.</p>
<p>The description from Rust VM implementation is described here:
https://github.com/matter-labs/zkevm_opcode_defs/blob/v1.4.1/src/definitions/abi</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">ABI.FatPointerABI</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">ABI.MetaParametersABI</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">ABI.PrecompileParametersABI</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">ABI.NearCallABI</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">ABI.FarRetABI</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">ABI.FarCallABI</span></a><br/>
.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.ABI.NearCallABI</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Coder</span></a> <a class="idref" href="#"><span class="id" title="library">Ergs</span></a> <a class="idref" href="#"><span class="id" title="library">TransientMemory</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect</span>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Types</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Coder</span></a> <a class="idref" href="#"><span class="id" title="module">Ergs</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="NearCallABI" class="idref" href="#NearCallABI"><span class="id" title="section">NearCallABI</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>Near call may only accept one parameter: the amount of ergs allocated
to it.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Record</span> <a id="params" class="idref" href="#params"><span class="id" title="record">params</span></a>: <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">mk_params</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ergs_passed" class="idref" href="#ergs_passed"><span class="id" title="projection">ergs_passed</span></a>: <a class="idref" href="#u32"><span class="id" title="definition">u32</span></a>; <span class="comment">(*&nbsp;in&nbsp;low&nbsp;32&nbsp;bits&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="encode" class="idref" href="#encode"><span class="id" title="definition">encode</span></a> : <a class="idref" href="#params"><span class="id" title="record">params</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#u32"><span class="id" title="definition">u32</span></a> := <span class="id" title="keyword">fun</span> <a id="p:3" class="idref" href="#p:3"><span class="id" title="binder">p</span></a> ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#p:3"><span class="id" title="variable">p</span></a>.(<a class="idref" href="#ergs_passed"><span class="id" title="projection">ergs_passed</span></a>).<br/>
<span class="id" title="keyword">Definition</span> <a id="decode" class="idref" href="#decode"><span class="id" title="definition">decode</span></a> : <a class="idref" href="#u32"><span class="id" title="definition">u32</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#params"><span class="id" title="record">params</span></a> := <span class="id" title="keyword">fun</span> <a id="u:4" class="idref" href="#u:4"><span class="id" title="binder">u</span></a> ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#mk_params"><span class="id" title="constructor">mk_params</span></a> <a class="idref" href="#u:4"><span class="id" title="variable">u</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="encode_word" class="idref" href="#encode_word"><span class="id" title="definition">encode_word</span></a> (<a id="p:5" class="idref" href="#p:5"><span class="id" title="binder">p</span></a>:<a class="idref" href="#params"><span class="id" title="record">params</span></a>) (<a id="high224:6" class="idref" href="#high224:6"><span class="id" title="binder">high224</span></a>: <a class="idref" href="#u224"><span class="id" title="definition">u224</span></a>) : <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="#option_map"><span class="id" title="definition">option_map</span></a> (<span class="id" title="keyword">fun</span> <a id="encoded:7" class="idref" href="#encoded:7"><span class="id" title="binder">encoded</span></a> ⇒ <a class="idref" href="#high224:6"><span class="id" title="variable">high224</span></a> <span class="id" title="notation">##</span> <a class="idref" href="#encoded:7"><span class="id" title="variable">encoded</span></a>) (<a class="idref" href="#encode"><span class="id" title="definition">encode</span></a> <a class="idref" href="#p:5"><span class="id" title="variable">p</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="decode_word" class="idref" href="#decode_word"><span class="id" title="definition">decode_word</span></a> (<a id="w:8" class="idref" href="#w:8"><span class="id" title="binder">w</span></a>:<a class="idref" href="#word"><span class="id" title="definition">word</span></a>) : <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (<a class="idref" href="#u224"><span class="id" title="definition">u224</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#params"><span class="id" title="record">params</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="#option_map"><span class="id" title="definition">option_map</span></a> (<span class="id" title="keyword">fun</span> <a id="decoded:9" class="idref" href="#decoded:9"><span class="id" title="binder">decoded</span></a> ⇒ <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a>@<span class="id" title="definition">high</span> 224 32 <a class="idref" href="#w:8"><span class="id" title="variable">w</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#decoded:9"><span class="id" title="variable">decoded</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) (<a class="idref" href="#decode"><span class="id" title="definition">decode</span></a> (<span class="id" title="definition">low</span> 32 <a class="idref" href="#w:8"><span class="id" title="variable">w</span></a>)).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="coder" class="idref" href="#coder"><span class="id" title="definition">coder</span></a> : @<a class="idref" href="#coder"><span class="id" title="record">coder</span></a> <a class="idref" href="#u32"><span class="id" title="definition">u32</span></a> <a class="idref" href="#params"><span class="id" title="record">params</span></a>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#NearCallABI"><span class="id" title="section">NearCallABI</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.ABI.FatPointerABI</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Coder</span></a> <a class="idref" href="#"><span class="id" title="library">Pointer</span></a> <a class="idref" href="#"><span class="id" title="library">lib.BitsExt</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect</span> <span class="id" title="module">ssreflect.ssrfun</span> <span class="id" title="module">ssreflect.eqtype</span> <span class="id" title="module">ssreflect.tuple</span>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Coder</span></a> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a> <a class="idref" href="#"><span class="id" title="module">lib.BitsExt</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="FatPointerABI" class="idref" href="#FatPointerABI"><span class="id" title="section">FatPointerABI</span></a>.<br/>
</div>

<div class="doc"><p>Record <span
class="inlinecode"><a class="idref" href="#fat_ptr_layout"><span
class="id" title="record">fat_ptr_layout</span></a></span> displays the
memory layout of a 128-bit fat pointer.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Record</span> <a id="fat_ptr_layout" class="idref" href="#fat_ptr_layout"><span class="id" title="record">fat_ptr_layout</span></a> := <span class="id" title="var">mk_fat_ptr_layout</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="length" class="idref" href="#length"><span class="id" title="projection">length</span></a>: <a class="idref" href="#u32"><span class="id" title="definition">u32</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="start" class="idref" href="#start"><span class="id" title="projection">start</span></a>: <a class="idref" href="#u32"><span class="id" title="definition">u32</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="page" class="idref" href="#page"><span class="id" title="projection">page</span></a>: <a class="idref" href="#u32"><span class="id" title="definition">u32</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="offset" class="idref" href="#offset"><span class="id" title="projection">offset</span></a>: <a class="idref" href="#u32"><span class="id" title="definition">u32</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<span class="id" title="keyword">Definition</span> <a id="null_fat_ptr_layout" class="idref" href="#null_fat_ptr_layout"><span class="id" title="definition">null_fat_ptr_layout</span></a> := <a class="idref" href="#mk_fat_ptr_layout"><span class="id" title="constructor">mk_fat_ptr_layout</span></a> <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a> <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a> <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a> <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a>.<br/>
<span class="id" title="keyword">Section</span> <a id="FatPointerABI.LayoutCoder" class="idref" href="#FatPointerABI.LayoutCoder"><span class="id" title="section">LayoutCoder</span></a>.<br/>
</div>

<div class="doc"><p>Functions <span
class="inlinecode"><a class="idref" href="#encode_layout"><span
class="id" title="definition">encode_layout</span></a></span> and <span
class="inlinecode"><a class="idref" href="#decode_layout"><span
class="id" title="definition">decode_layout</span></a></span> formalize
the encoding of a <span
class="inlinecode"><a class="idref" href="#fat_ptr_nullable"><span
class="id" title="inductive">fat_ptr_nullable</span></a></span> to <span
class="inlinecode"><a class="idref" href="#fat_ptr_layout"><span
class="id" title="record">fat_ptr_layout</span></a></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="encode_layout" class="idref" href="#encode_layout"><span class="id" title="definition">encode_layout</span></a> : @<a class="idref" href="#encoder"><span class="id" title="definition">encoder</span></a> <a class="idref" href="#fat_ptr_layout"><span class="id" title="record">fat_ptr_layout</span></a> <a class="idref" href="#fat_ptr_nullable"><span class="id" title="inductive">fat_ptr_nullable</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="fp:6" class="idref" href="#fp:6"><span class="id" title="binder">fp</span></a> : <a class="idref" href="#fat_ptr_nullable"><span class="id" title="inductive">fat_ptr_nullable</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#fp:6"><span class="id" title="variable">fp</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#NullPtr"><span class="id" title="constructor">NullPtr</span></a> ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#null_fat_ptr_layout"><span class="id" title="definition">null_fat_ptr_layout</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> (<a class="idref" href="#mk_fat_ptr"><span class="id" title="constructor">mk_fat_ptr</span></a> <span class="id" title="var">p</span> (<a class="idref" href="#mk_ptr"><span class="id" title="constructor">mk_ptr</span></a> (<a class="idref" href="#mk_span"><span class="id" title="constructor">mk_span</span></a> <span class="id" title="var">s</span> <span class="id" title="var">l</span>) <span class="id" title="var">ofs</span>)) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">(</span></a><span class="id" title="var">p</span> <span class="id" title="notation">==</span> 0<a class="idref" href="#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">)</span></a>  <a class="idref" href="#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">||</span></a> <a class="idref" href="#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">(</span></a><span class="id" title="var">p</span> <span class="id" title="notation">≥</span> 2<span class="id" title="notation">^</span>32<a class="idref" href="#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">)</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#mk_fat_ptr_layout"><span class="id" title="constructor">mk_fat_ptr_layout</span></a> <span class="id" title="var">l</span> <span class="id" title="var">s</span> (<span class="id" title="notation">#</span> <span class="id" title="var">p</span>) <span class="id" title="var">ofs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="decode_layout" class="idref" href="#decode_layout"><span class="id" title="definition">decode_layout</span></a> : @<a class="idref" href="#decoder"><span class="id" title="definition">decoder</span></a> <a class="idref" href="#fat_ptr_layout"><span class="id" title="record">fat_ptr_layout</span></a> <a class="idref" href="#fat_ptr_nullable"><span class="id" title="inductive">fat_ptr_nullable</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="w:8" class="idref" href="#w:8"><span class="id" title="binder">w</span></a>: <a class="idref" href="#fat_ptr_layout"><span class="id" title="record">fat_ptr_layout</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#w:8"><span class="id" title="variable">w</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_fat_ptr_layout"><span class="id" title="constructor">mk_fat_ptr_layout</span></a> <a class="idref" href="#length"><span class="id" title="projection">length</span></a> <a class="idref" href="#start"><span class="id" title="projection">start</span></a> <a class="idref" href="#page"><span class="id" title="projection">page</span></a> <a class="idref" href="#offset"><span class="id" title="projection">offset</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <span class="id" title="var">page</span> <span class="id" title="notation">==</span> <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#NullPtr"><span class="id" title="constructor">NullPtr</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#NotNullPtr"><span class="id" title="constructor">NotNullPtr</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fp_page"><span class="id" title="projection">fp_page</span></a> := <span class="id" title="definition">toNat</span> <span class="id" title="var">page</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fp_ptr"><span class="id" title="projection">fp_ptr</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#p_span"><span class="id" title="projection">p_span</span></a> := <a class="idref" href="#mk_span"><span class="id" title="constructor">mk_span</span></a> <span class="id" title="var">start</span> <span class="id" title="var">length</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#p_offset"><span class="id" title="projection">p_offset</span></a> := <span class="id" title="var">offset</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="layout_coding_revertible" class="idref" href="#layout_coding_revertible"><span class="id" title="lemma">layout_coding_revertible</span></a>: <a class="idref" href="#revertible"><span class="id" title="definition">revertible</span></a> <a class="idref" href="#decode_layout"><span class="id" title="definition">decode_layout</span></a> <a class="idref" href="#encode_layout"><span class="id" title="definition">encode_layout</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="fat_ptr_layout_coder" class="idref" href="#fat_ptr_layout_coder"><span class="id" title="definition">fat_ptr_layout_coder</span></a> : @<a class="idref" href="#coder"><span class="id" title="record">Coder.coder</span></a> <a class="idref" href="#fat_ptr_layout"><span class="id" title="record">fat_ptr_layout</span></a> <a class="idref" href="#fat_ptr_nullable"><span class="id" title="inductive">fat_ptr_nullable</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <a class="idref" href="#mk_coder"><span class="id" title="constructor">mk_coder</span></a> <a class="idref" href="#decode_layout"><span class="id" title="definition">decode_layout</span></a> <a class="idref" href="#encode_layout"><span class="id" title="definition">encode_layout</span></a> <a class="idref" href="#layout_coding_revertible"><span class="id" title="lemma">layout_coding_revertible</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#FatPointerABI.LayoutCoder"><span class="id" title="section">LayoutCoder</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="FatPointerABI.BinaryCoder" class="idref" href="#FatPointerABI.BinaryCoder"><span class="id" title="section">BinaryCoder</span></a>.<br/>
&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="encode_bin" class="idref" href="#encode_bin"><span class="id" title="definition">encode_bin</span></a>: @<a class="idref" href="#encoder"><span class="id" title="definition">encoder</span></a> <a class="idref" href="#u128"><span class="id" title="definition">u128</span></a> <a class="idref" href="#fat_ptr_layout"><span class="id" title="record">fat_ptr_layout</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="fp:10" class="idref" href="#fp:10"><span class="id" title="binder">fp</span></a>: <a class="idref" href="#fat_ptr_layout"><span class="id" title="record">fat_ptr_layout</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#fp:10"><span class="id" title="variable">fp</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_fat_ptr_layout"><span class="id" title="constructor">mk_fat_ptr_layout</span></a> <a class="idref" href="#length"><span class="id" title="projection">length</span></a> <a class="idref" href="#start"><span class="id" title="projection">start</span></a> <a class="idref" href="#page"><span class="id" title="projection">page</span></a> <a class="idref" href="#offset"><span class="id" title="projection">offset</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<span class="id" title="var">length</span> <span class="id" title="notation">##</span> <span class="id" title="var">start</span> <span class="id" title="notation">##</span> <span class="id" title="var">page</span> <span class="id" title="notation">##</span> <span class="id" title="var">offset</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="decode_bin" class="idref" href="#decode_bin"><span class="id" title="definition">decode_bin</span></a> : @<a class="idref" href="#decoder"><span class="id" title="definition">decoder</span></a> <a class="idref" href="#u128"><span class="id" title="definition">u128</span></a> <a class="idref" href="#fat_ptr_layout"><span class="id" title="record">fat_ptr_layout</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="w:12" class="idref" href="#w:12"><span class="id" title="binder">w</span></a>: <a class="idref" href="#u128"><span class="id" title="definition">u128</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="length:13" class="idref" href="#length:13"><span class="id" title="binder">length</span></a> := <a class="idref" href="#w:12"><span class="id" title="variable">w</span></a> <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">{</span></a> 3<span class="id" title="notation">×</span>32<a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">,</span></a> 4<span class="id" title="notation">×</span>32 <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">}</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="start:14" class="idref" href="#start:14"><span class="id" title="binder">start</span></a>  := <a class="idref" href="#w:12"><span class="id" title="variable">w</span></a> <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">{</span></a> 2<span class="id" title="notation">×</span>32<a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">,</span></a> 3<span class="id" title="notation">×</span>32 <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">}</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="page:15" class="idref" href="#page:15"><span class="id" title="binder">page</span></a>   := <a class="idref" href="#w:12"><span class="id" title="variable">w</span></a> <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">{</span></a> 32<a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">,</span></a> 2<span class="id" title="notation">×</span>32<a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">}</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="offset:16" class="idref" href="#offset:16"><span class="id" title="binder">offset</span></a> := <a class="idref" href="#w:12"><span class="id" title="variable">w</span></a> <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">{</span></a> 0<a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">,</span></a> 32 <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">}</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#mk_fat_ptr_layout"><span class="id" title="constructor">mk_fat_ptr_layout</span></a> <a class="idref" href="#length:13"><span class="id" title="variable">length</span></a> <a class="idref" href="#start:14"><span class="id" title="variable">start</span></a> <a class="idref" href="#page:15"><span class="id" title="variable">page</span></a> <a class="idref" href="#offset:16"><span class="id" title="variable">offset</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="fat_ptr_bin_revertible" class="idref" href="#fat_ptr_bin_revertible"><span class="id" title="lemma">fat_ptr_bin_revertible</span></a>: <a class="idref" href="#revertible"><span class="id" title="definition">revertible</span></a> <a class="idref" href="#decode_bin"><span class="id" title="definition">decode_bin</span></a> <a class="idref" href="#encode_bin"><span class="id" title="definition">encode_bin</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="binary_coder" class="idref" href="#binary_coder"><span class="id" title="definition">binary_coder</span></a>: @<a class="idref" href="#coder"><span class="id" title="record">Coder.coder</span></a> <a class="idref" href="#u128"><span class="id" title="definition">u128</span></a> <a class="idref" href="#fat_ptr_layout"><span class="id" title="record">fat_ptr_layout</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mk_coder"><span class="id" title="constructor">mk_coder</span></a> <a class="idref" href="#decode_bin"><span class="id" title="definition">decode_bin</span></a> <a class="idref" href="#encode_bin"><span class="id" title="definition">encode_bin</span></a> <a class="idref" href="#fat_ptr_bin_revertible"><span class="id" title="lemma">fat_ptr_bin_revertible</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#FatPointerABI.BinaryCoder"><span class="id" title="section">BinaryCoder</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="FatPointerABI.ComposedCoder" class="idref" href="#FatPointerABI.ComposedCoder"><span class="id" title="section">ComposedCoder</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="ABI" class="idref" href="#ABI"><span class="id" title="definition">ABI</span></a> : @<a class="idref" href="#coder"><span class="id" title="record">Coder.coder</span></a> <a class="idref" href="#u128"><span class="id" title="definition">u128</span></a> <a class="idref" href="#fat_ptr_nullable"><span class="id" title="inductive">fat_ptr_nullable</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#coder_compose"><span class="id" title="definition">coder_compose</span></a> <a class="idref" href="#binary_coder"><span class="id" title="definition">binary_coder</span></a> <a class="idref" href="#fat_ptr_layout_coder"><span class="id" title="definition">fat_ptr_layout_coder</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="decode_fat_ptr" class="idref" href="#decode_fat_ptr"><span class="id" title="definition">decode_fat_ptr</span></a> (<a id="w:17" class="idref" href="#w:17"><span class="id" title="binder">w</span></a>:<a class="idref" href="#u128"><span class="id" title="definition">u128</span></a>) : <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#fat_ptr_nullable"><span class="id" title="inductive">fat_ptr_nullable</span></a> := <a class="idref" href="#ABI"><span class="id" title="definition">ABI</span></a>.(<a class="idref" href="#decode"><span class="id" title="projection">decode</span></a>) <a class="idref" href="#w:17"><span class="id" title="variable">w</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="decode_fat_ptr_word" class="idref" href="#decode_fat_ptr_word"><span class="id" title="definition">decode_fat_ptr_word</span></a> (<a id="w:18" class="idref" href="#w:18"><span class="id" title="binder">w</span></a>:<a class="idref" href="#word"><span class="id" title="definition">word</span></a>) : <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (<a class="idref" href="#u128"><span class="id" title="definition">u128</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#fat_ptr_nullable"><span class="id" title="inductive">fat_ptr_nullable</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<a id="high128:19" class="idref" href="#high128:19"><span class="id" title="binder">high128</span></a>, <a id="low128:20" class="idref" href="#low128:20"><span class="id" title="binder">low128</span></a>) := <span class="id" title="definition">split2</span> 128 128 <a class="idref" href="#w:18"><span class="id" title="variable">w</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#decode_fat_ptr"><span class="id" title="definition">decode_fat_ptr</span></a> <a class="idref" href="#low128:20"><span class="id" title="variable">low128</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">fpn</span> ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#high128:19"><span class="id" title="variable">high128</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">fpn</span><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <a class="idref" href="#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="decode_heap_ptr" class="idref" href="#decode_heap_ptr"><span class="id" title="definition">decode_heap_ptr</span></a> (<a id="w:21" class="idref" href="#w:21"><span class="id" title="binder">w</span></a>:<a class="idref" href="#word"><span class="id" title="definition">word</span></a>) : <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (<a class="idref" href="#u224"><span class="id" title="definition">u224</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#heap_ptr"><span class="id" title="record">heap_ptr</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<a id="msbs:22" class="idref" href="#msbs:22"><span class="id" title="binder">msbs</span></a>, <a id="ofs:23" class="idref" href="#ofs:23"><span class="id" title="binder">ofs</span></a>) := <span class="id" title="definition">split2</span> <span class="id" title="var">_</span> 32 <a class="idref" href="#w:21"><span class="id" title="variable">w</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#msbs:22"><span class="id" title="variable">msbs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#mk_hptr"><span class="id" title="constructor">mk_hptr</span></a> <a class="idref" href="#ofs:23"><span class="id" title="variable">ofs</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="encode_heap_ptr" class="idref" href="#encode_heap_ptr"><span class="id" title="definition">encode_heap_ptr</span></a> (<a id="h:24" class="idref" href="#h:24"><span class="id" title="binder">h</span></a>:<a class="idref" href="#heap_ptr"><span class="id" title="record">heap_ptr</span></a>) : <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#u32"><span class="id" title="definition">u32</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#hp_addr"><span class="id" title="projection">hp_addr</span></a> <a class="idref" href="#h:24"><span class="id" title="variable">h</span></a>)<br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="encode_heap_ptr_word" class="idref" href="#encode_heap_ptr_word"><span class="id" title="definition">encode_heap_ptr_word</span></a> (<a id="high224:25" class="idref" href="#high224:25"><span class="id" title="binder">high224</span></a>: <a class="idref" href="#u224"><span class="id" title="definition">u224</span></a>) (<a id="h:26" class="idref" href="#h:26"><span class="id" title="binder">h</span></a>:<a class="idref" href="#heap_ptr"><span class="id" title="record">heap_ptr</span></a>) : <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#encode_heap_ptr"><span class="id" title="definition">encode_heap_ptr</span></a> <a class="idref" href="#h:26"><span class="id" title="variable">h</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">hpenc</span> ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#high224:25"><span class="id" title="variable">high224</span></a> <span class="id" title="notation">##</span> <span class="id" title="var">hpenc</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <a class="idref" href="#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="encode_fat_ptr" class="idref" href="#encode_fat_ptr"><span class="id" title="definition">encode_fat_ptr</span></a> (<a id="fp:27" class="idref" href="#fp:27"><span class="id" title="binder">fp</span></a>: <a class="idref" href="#fat_ptr_nullable"><span class="id" title="inductive">fat_ptr_nullable</span></a>) : <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#u128"><span class="id" title="definition">u128</span></a> := <a class="idref" href="#ABI"><span class="id" title="definition">ABI</span></a>.(<a class="idref" href="#encode"><span class="id" title="projection">encode</span></a>) <a class="idref" href="#fp:27"><span class="id" title="variable">fp</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="encode_fat_ptr_word" class="idref" href="#encode_fat_ptr_word"><span class="id" title="definition">encode_fat_ptr_word</span></a> (<a id="high_bytes:28" class="idref" href="#high_bytes:28"><span class="id" title="binder">high_bytes</span></a>: <a class="idref" href="#u128"><span class="id" title="definition">u128</span></a>) (<a id="fp:29" class="idref" href="#fp:29"><span class="id" title="binder">fp</span></a>: <a class="idref" href="#fat_ptr_nullable"><span class="id" title="inductive">fat_ptr_nullable</span></a>) : <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#encode_fat_ptr"><span class="id" title="definition">encode_fat_ptr</span></a> <a class="idref" href="#fp:29"><span class="id" title="variable">fp</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">enc</span> ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#high_bytes:28"><span class="id" title="variable">high_bytes</span></a> <span class="id" title="notation">##</span> <span class="id" title="var">enc</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <a class="idref" href="#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#FatPointerABI.ComposedCoder"><span class="id" title="section">ComposedCoder</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#FatPointerABI"><span class="id" title="section">FatPointerABI</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.ABI.ForwardPageTypesABI</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Coder</span></a> <a class="idref" href="#"><span class="id" title="library">Ergs</span></a> <a class="idref" href="#"><span class="id" title="library">MemoryManagement</span></a> <a class="idref" href="#"><span class="id" title="library">Pointer</span></a> <a class="idref" href="#"><span class="id" title="library">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="library">lib.BitsExt</span></a> <a class="idref" href="#"><span class="id" title="library">ABI.FatPointerABI</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect</span> <span class="id" title="module">ssreflect.ssrfun</span> <span class="id" title="module">ssreflect.eqtype</span> <span class="id" title="module">ssreflect.tuple</span>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Arith</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Coder</span></a> <a class="idref" href="#"><span class="id" title="module">Ergs</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryManagement</span></a> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">lib.BitsExt</span></a> <a class="idref" href="#"><span class="id" title="module">FatPointerABI</span></a>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <a id="FarCallForwardPageType" class="idref" href="#FarCallForwardPageType"><span class="id" title="module">FarCallForwardPageType</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="FarCallForwardPageType.UseHeap" class="idref" href="#FarCallForwardPageType.UseHeap"><span class="id" title="definition">UseHeap</span></a> : <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a> := <span class="id" title="notation">#</span> 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="FarCallForwardPageType.ForwardFatPointer" class="idref" href="#FarCallForwardPageType.ForwardFatPointer"><span class="id" title="definition">ForwardFatPointer</span></a> : <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a> := <span class="id" title="notation">#</span> 1.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="FarCallForwardPageType.UseAuxHeap" class="idref" href="#FarCallForwardPageType.UseAuxHeap"><span class="id" title="definition">UseAuxHeap</span></a> : <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a> := <span class="id" title="notation">#</span> 2.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;other&nbsp;u8&nbsp;values&nbsp;are&nbsp;mapped&nbsp;to&nbsp;UseHeap.&nbsp;*)</span><br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#FarCallForwardPageType"><span class="id" title="module">FarCallForwardPageType</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="data_page_type_to_u8" class="idref" href="#data_page_type_to_u8"><span class="id" title="definition">data_page_type_to_u8</span></a> (<a id="t:1" class="idref" href="#t:1"><span class="id" title="binder">t</span></a>:<a class="idref" href="#data_page_type"><span class="id" title="inductive">data_page_type</span></a>) : <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#t:1"><span class="id" title="variable">t</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#Heap"><span class="id" title="constructor">Heap</span></a> ⇒ <a class="idref" href="#UseHeap"><span class="id" title="definition">FarCallForwardPageType.UseHeap</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#AuxHeap"><span class="id" title="constructor">AuxHeap</span></a> ⇒<a class="idref" href="#UseAuxHeap"><span class="id" title="definition">FarCallForwardPageType.UseAuxHeap</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="span_of" class="idref" href="#span_of"><span class="id" title="definition">span_of</span></a> (<a id="fp:3" class="idref" href="#fp:3"><span class="id" title="binder">fp</span></a>: <a class="idref" href="#fat_ptr_layout"><span class="id" title="record">fat_ptr_layout</span></a>) : <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#span"><span class="id" title="record">span</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#fp:3"><span class="id" title="variable">fp</span></a>.(<a class="idref" href="#offset"><span class="id" title="projection">offset</span></a>) <span class="id" title="notation">==</span> <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#mk_span"><span class="id" title="constructor">mk_span</span></a> <a class="idref" href="#fp:3"><span class="id" title="variable">fp</span></a>.(<a class="idref" href="#start"><span class="id" title="projection">start</span></a>) <a class="idref" href="#fp:3"><span class="id" title="variable">fp</span></a>.(<a class="idref" href="#length"><span class="id" title="projection">length</span></a>))<br/>
&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="#None"><span class="id" title="constructor">None</span></a><br/>
.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="fwd_memory_adapter" class="idref" href="#fwd_memory_adapter"><span class="id" title="definition">fwd_memory_adapter</span></a> (<a id="fwd_type:4" class="idref" href="#fwd_type:4"><span class="id" title="binder">fwd_type</span></a>: <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a>) (<a id="raw_fat_ptr_layout:5" class="idref" href="#raw_fat_ptr_layout:5"><span class="id" title="binder">raw_fat_ptr_layout</span></a>: <a class="idref" href="#fat_ptr_layout"><span class="id" title="record">fat_ptr_layout</span></a>) : <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#fwd_memory"><span class="id" title="inductive">MemoryManagement.fwd_memory</span></a>:=<br/>
&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#fwd_type:4"><span class="id" title="variable">fwd_type</span></a> <span class="id" title="notation">==</span> <a class="idref" href="#ForwardFatPointer"><span class="id" title="definition">FarCallForwardPageType.ForwardFatPointer</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#option_map"><span class="id" title="definition">option_map</span></a> <a class="idref" href="#ForwardExistingFatPointer"><span class="id" title="constructor">ForwardExistingFatPointer</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="#decode_layout"><span class="id" title="definition">FatPointerABI.decode_layout</span></a> <a class="idref" href="#raw_fat_ptr_layout:5"><span class="id" title="variable">raw_fat_ptr_layout</span></a>)<br/>
&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#span_of"><span class="id" title="definition">span_of</span></a> <a class="idref" href="#raw_fat_ptr_layout:5"><span class="id" title="variable">raw_fat_ptr_layout</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#span"><span class="id" title="record">span</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#fwd_type:4"><span class="id" title="variable">fwd_type</span></a> <span class="id" title="notation">==</span> <a class="idref" href="#UseAuxHeap"><span class="id" title="definition">FarCallForwardPageType.UseAuxHeap</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ForwardNewFatPointer"><span class="id" title="constructor">ForwardNewFatPointer</span></a> <a class="idref" href="#AuxHeap"><span class="id" title="constructor">AuxHeap</span></a> <span class="id" title="var">span</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <span class="comment">(*&nbsp;Heap&nbsp;or&nbsp;a&nbsp;default&nbsp;option&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ForwardNewFatPointer"><span class="id" title="constructor">ForwardNewFatPointer</span></a> <a class="idref" href="#Heap"><span class="id" title="constructor">Heap</span></a> <span class="id" title="var">span</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.ABI.FarCallABI</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Coder</span></a> <a class="idref" href="#"><span class="id" title="library">Ergs</span></a> <a class="idref" href="#"><span class="id" title="library">memory.Depot</span></a> <a class="idref" href="#"><span class="id" title="library">MemoryManagement</span></a> <a class="idref" href="#"><span class="id" title="library">Pointer</span></a> <a class="idref" href="#"><span class="id" title="library">lib.BitsExt</span></a> <a class="idref" href="#"><span class="id" title="library">ABI.FatPointerABI</span></a> <a class="idref" href="#"><span class="id" title="library">ABI.ForwardPageTypesABI</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect</span> <span class="id" title="module">ssreflect.ssrfun</span> <span class="id" title="module">ssreflect.eqtype</span> <span class="id" title="module">ssreflect.tuple</span>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Arith</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Coder</span></a> <a class="idref" href="#"><span class="id" title="module">Ergs</span></a> <a class="idref" href="#"><span class="id" title="module">memory.Depot</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryManagement</span></a> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">lib.BitsExt</span></a> <a class="idref" href="#"><span class="id" title="module">FatPointerABI</span></a> <a class="idref" href="#"><span class="id" title="module">ForwardPageTypesABI</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="FarCallABI" class="idref" href="#FarCallABI"><span class="id" title="section">FarCallABI</span></a>.<br/>
</div>

<div class="doc"><p>This record describes all the parameters that <span
class="inlinecode"><a class="idref" href="#FarCalls"><span
class="id" title="section">FarCalls</span></a></span> can use.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Record</span> <a id="params" class="idref" href="#params"><span class="id" title="record">params</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">mk_params</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="fwd_memory" class="idref" href="#fwd_memory"><span class="id" title="projection">fwd_memory</span></a>: <a class="idref" href="#fwd_memory"><span class="id" title="inductive">fwd_memory</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ergs_passed" class="idref" href="#ergs_passed"><span class="id" title="projection">ergs_passed</span></a>: <a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="shard_id" class="idref" href="#shard_id"><span class="id" title="projection">shard_id</span></a>: <a class="idref" href="#shard_id"><span class="id" title="definition">shard_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="constructor_call" class="idref" href="#constructor_call"><span class="id" title="projection">constructor_call</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="to_system" class="idref" href="#to_system"><span class="id" title="projection">to_system</span></a>: <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
</div>

<div class="doc"><p>This record describes the layout of 256-bit word that encodes these
parameters.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Record</span> <a id="params_layout" class="idref" href="#params_layout"><span class="id" title="record">params_layout</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">mk_params_layout</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="raw_to_system_bool" class="idref" href="#raw_to_system_bool"><span class="id" title="projection">raw_to_system_bool</span></a>: <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="raw_constructor_call_bool" class="idref" href="#raw_constructor_call_bool"><span class="id" title="projection">raw_constructor_call_bool</span></a>: <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="raw_shard_id" class="idref" href="#raw_shard_id"><span class="id" title="projection">raw_shard_id</span></a>: <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="raw_memory_forwarding_type_enum" class="idref" href="#raw_memory_forwarding_type_enum"><span class="id" title="projection">raw_memory_forwarding_type_enum</span></a> : <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="raw_ergs_passed" class="idref" href="#raw_ergs_passed"><span class="id" title="projection">raw_ergs_passed</span></a>: <a class="idref" href="#u32"><span class="id" title="definition">u32</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*raw_reserved:&nbsp;u64;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="raw_fat_ptr_layout" class="idref" href="#raw_fat_ptr_layout"><span class="id" title="projection">raw_fat_ptr_layout</span></a>: <a class="idref" href="#fat_ptr_layout"><span class="id" title="record">fat_ptr_layout</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="FarCallABI.BinaryCoder" class="idref" href="#FarCallABI.BinaryCoder"><span class="id" title="section">BinaryCoder</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="encode_bin" class="idref" href="#encode_bin"><span class="id" title="definition">encode_bin</span></a> : @<a class="idref" href="#encoder"><span class="id" title="definition">encoder</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a> <a class="idref" href="#params_layout"><span class="id" title="record">params_layout</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="params:14" class="idref" href="#params:14"><span class="id" title="binder">params</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#params:14"><span class="id" title="variable">params</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_params_layout"><span class="id" title="constructor">mk_params_layout</span></a> <span class="id" title="var">to_system8</span> <span class="id" title="var">constructor_call8</span> <span class="id" title="var">shard_id8</span> <span class="id" title="var">memory_forwarding_type8</span> <span class="id" title="var">ergs_passed32</span> <span class="comment">(*&nbsp;reserved64&nbsp;*)</span> <span class="id" title="var">fat_ptr_layout128</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#encode_bin"><span class="id" title="definition">FatPointerABI.encode_bin</span></a> <span class="id" title="var">fat_ptr_layout128</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">ptr_encoded128</span> ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">to_system8</span> <span class="id" title="notation">##</span> <span class="id" title="var">constructor_call8</span> <span class="id" title="notation">##</span> <span class="id" title="var">shard_id8</span> <span class="id" title="notation">##</span> <span class="id" title="var">memory_forwarding_type8</span> <span class="id" title="notation">##</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ergs_passed32</span> <span class="id" title="notation">##</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#zero64"><span class="id" title="definition">zero64</span></a> <span class="id" title="notation">##</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ptr_encoded128</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="decode_bin" class="idref" href="#decode_bin"><span class="id" title="definition">decode_bin</span></a> : @<a class="idref" href="#decoder"><span class="id" title="definition">decoder</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a> <a class="idref" href="#params_layout"><span class="id" title="record">params_layout</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="w:16" class="idref" href="#w:16"><span class="id" title="binder">w</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="to_system:17" class="idref" href="#to_system:17"><span class="id" title="binder">to_system</span></a> : <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a> := <a class="idref" href="#w:16"><span class="id" title="variable">w</span></a> <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">{</span></a> 256<span class="id" title="notation">-</span>8<a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">,</span></a> 256 <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">}</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="constructor_call:18" class="idref" href="#constructor_call:18"><span class="id" title="binder">constructor_call</span></a> : <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a> := <a class="idref" href="#w:16"><span class="id" title="variable">w</span></a> <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">{</span></a> 256 <span class="id" title="notation">-</span> 2<span class="id" title="notation">×</span>8<a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">,</span></a> 256 <span class="id" title="notation">-</span> 8 <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">}</span></a>  <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="shard_id:19" class="idref" href="#shard_id:19"><span class="id" title="binder">shard_id</span></a> : <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a> := <a class="idref" href="#w:16"><span class="id" title="variable">w</span></a> <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">{</span></a> 256 <span class="id" title="notation">-</span> 3<span class="id" title="notation">×</span>8<a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">,</span></a> 256 <span class="id" title="notation">-</span> 2<span class="id" title="notation">×</span>8 <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">}</span></a>  <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="memory_forwarding_type:20" class="idref" href="#memory_forwarding_type:20"><span class="id" title="binder">memory_forwarding_type</span></a> : <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a> := <a class="idref" href="#w:16"><span class="id" title="variable">w</span></a> <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">{</span></a> 256 <span class="id" title="notation">-</span> 4<span class="id" title="notation">×</span>8<a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">,</span></a> 256 <span class="id" title="notation">-</span> 3<span class="id" title="notation">×</span>8 <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">}</span></a>  <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="ergs_passed:21" class="idref" href="#ergs_passed:21"><span class="id" title="binder">ergs_passed</span></a> : <a class="idref" href="#u32"><span class="id" title="definition">u32</span></a> := <a class="idref" href="#w:16"><span class="id" title="variable">w</span></a> <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">{</span></a> 256 <span class="id" title="notation">-</span> 2<span class="id" title="notation">×</span>32<a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">,</span></a> 256 <span class="id" title="notation">-</span> 32 <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">}</span></a>  <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="ptr:22" class="idref" href="#ptr:22"><span class="id" title="binder">ptr</span></a> : <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#fat_ptr_layout"><span class="id" title="record">fat_ptr_layout</span></a> := <a class="idref" href="#decode_bin"><span class="id" title="definition">FatPointerABI.decode_bin</span></a> (<span class="id" title="definition">low</span> 128 <a class="idref" href="#w:16"><span class="id" title="variable">w</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#ptr:22"><span class="id" title="variable">ptr</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">ptr</span> ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#mk_params_layout"><span class="id" title="constructor">mk_params_layout</span></a> <a class="idref" href="#to_system:17"><span class="id" title="variable">to_system</span></a> <a class="idref" href="#constructor_call:18"><span class="id" title="variable">constructor_call</span></a> <a class="idref" href="#shard_id:19"><span class="id" title="variable">shard_id</span></a> <a class="idref" href="#memory_forwarding_type:20"><span class="id" title="variable">memory_forwarding_type</span></a> <a class="idref" href="#ergs_passed:21"><span class="id" title="variable">ergs_passed</span></a> <a class="idref" href="#ptr:22"><span class="id" title="variable">ptr</span></a> )<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="binary_coder_revertible" class="idref" href="#binary_coder_revertible"><span class="id" title="lemma">binary_coder_revertible</span></a>: <a class="idref" href="#revertible"><span class="id" title="definition">revertible</span></a> <a class="idref" href="#decode_bin"><span class="id" title="definition">decode_bin</span></a> <a class="idref" href="#encode_bin"><span class="id" title="definition">encode_bin</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="coder_binary" class="idref" href="#coder_binary"><span class="id" title="definition">coder_binary</span></a> : @<a class="idref" href="#coder"><span class="id" title="record">coder</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a> <a class="idref" href="#params_layout"><span class="id" title="record">params_layout</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mk_coder"><span class="id" title="constructor">mk_coder</span></a> <a class="idref" href="#decode_bin"><span class="id" title="definition">decode_bin</span></a> <a class="idref" href="#encode_bin"><span class="id" title="definition">encode_bin</span></a> <a class="idref" href="#binary_coder_revertible"><span class="id" title="lemma">binary_coder_revertible</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#FarCallABI.BinaryCoder"><span class="id" title="section">BinaryCoder</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="FarCallABI.LayoutCoder" class="idref" href="#FarCallABI.LayoutCoder"><span class="id" title="section">LayoutCoder</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="encode_layout" class="idref" href="#encode_layout"><span class="id" title="definition">encode_layout</span></a>: @<a class="idref" href="#encoder"><span class="id" title="definition">encoder</span></a> <a class="idref" href="#params_layout"><span class="id" title="record">params_layout</span></a> <a class="idref" href="#params"><span class="id" title="record">params</span></a> :=<br/>
<span class="id" title="keyword">fun</span> <a id="params:24" class="idref" href="#params:24"><span class="id" title="binder">params</span></a> ⇒<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#params:24"><span class="id" title="variable">params</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#mk_params"><span class="id" title="constructor">mk_params</span></a> (<a class="idref" href="#ForwardExistingFatPointer"><span class="id" title="constructor">ForwardExistingFatPointer</span></a> <span class="id" title="var">fptr</span>) <a class="idref" href="#ergs_passed"><span class="id" title="projection">ergs_passed</span></a> <a class="idref" href="#shard_id"><span class="id" title="projection">shard_id</span></a> <a class="idref" href="#constructor_call"><span class="id" title="projection">constructor_call</span></a> <a class="idref" href="#to_system"><span class="id" title="projection">to_system</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#encode_layout"><span class="id" title="definition">FatPointerABI.encode_layout</span></a> <span class="id" title="var">fptr</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">ptr_layout</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#raw_to_system_bool"><span class="id" title="projection">raw_to_system_bool</span></a>:= <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <span class="id" title="var">to_system</span> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <span class="id" title="notation">#</span> 1 <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <span class="id" title="notation">#</span> 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#raw_constructor_call_bool"><span class="id" title="projection">raw_constructor_call_bool</span></a> := <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <span class="id" title="var">constructor_call</span> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <span class="id" title="notation">#</span> 1 <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <span class="id" title="notation">#</span> 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#raw_shard_id"><span class="id" title="projection">raw_shard_id</span></a> := <span class="id" title="var">shard_id</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#raw_memory_forwarding_type_enum"><span class="id" title="projection">raw_memory_forwarding_type_enum</span></a> := <a class="idref" href="#FarCallForwardPageType.ForwardFatPointer"><span class="id" title="definition">FarCallForwardPageType.ForwardFatPointer</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#raw_ergs_passed"><span class="id" title="projection">raw_ergs_passed</span></a>:= <span class="id" title="var">ergs_passed</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*raw_reserved:&nbsp;u64;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#raw_fat_ptr_layout"><span class="id" title="projection">raw_fat_ptr_layout</span></a>:= <span class="id" title="var">ptr_layout</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#mk_params"><span class="id" title="constructor">mk_params</span></a> (<a class="idref" href="#ForwardNewFatPointer"><span class="id" title="constructor">ForwardNewFatPointer</span></a> <span class="id" title="var">heap_variant</span> <a class="idref" href="#span"><span class="id" title="record">span</span></a>) <a class="idref" href="#ergs_passed"><span class="id" title="projection">ergs_passed</span></a> <a class="idref" href="#shard_id"><span class="id" title="projection">shard_id</span></a> <a class="idref" href="#constructor_call"><span class="id" title="projection">constructor_call</span></a> <a class="idref" href="#to_system"><span class="id" title="projection">to_system</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#raw_to_system_bool"><span class="id" title="projection">raw_to_system_bool</span></a>:= <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <span class="id" title="var">to_system</span> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <span class="id" title="notation">#</span> 1 <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <span class="id" title="notation">#</span> 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#raw_constructor_call_bool"><span class="id" title="projection">raw_constructor_call_bool</span></a> := <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <span class="id" title="var">constructor_call</span> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <span class="id" title="notation">#</span> 1 <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <span class="id" title="notation">#</span> 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#raw_shard_id"><span class="id" title="projection">raw_shard_id</span></a> := <span class="id" title="var">shard_id</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#raw_memory_forwarding_type_enum"><span class="id" title="projection">raw_memory_forwarding_type_enum</span></a> := <a class="idref" href="#data_page_type_to_u8"><span class="id" title="definition">data_page_type_to_u8</span></a> <span class="id" title="var">heap_variant</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#raw_ergs_passed"><span class="id" title="projection">raw_ergs_passed</span></a> := <span class="id" title="var">ergs_passed</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*raw_reserved:&nbsp;u64;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#raw_fat_ptr_layout"><span class="id" title="projection">raw_fat_ptr_layout</span></a>:= {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#start"><span class="id" title="projection">start</span></a> := <span class="id" title="var">span</span>.(<a class="idref" href="#s_start"><span class="id" title="projection">s_start</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#length"><span class="id" title="projection">length</span></a> := <span class="id" title="var">span</span>.(<a class="idref" href="#s_length"><span class="id" title="projection">s_length</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#page"><span class="id" title="projection">page</span></a> := <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#offset"><span class="id" title="projection">offset</span></a> := <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="decode_layout" class="idref" href="#decode_layout"><span class="id" title="definition">decode_layout</span></a>: @<a class="idref" href="#decoder"><span class="id" title="definition">decoder</span></a> <a class="idref" href="#params_layout"><span class="id" title="record">params_layout</span></a> <a class="idref" href="#params"><span class="id" title="record">params</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="layout:26" class="idref" href="#layout:26"><span class="id" title="binder">layout</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#layout:26"><span class="id" title="variable">layout</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_params_layout"><span class="id" title="constructor">mk_params_layout</span></a> <a class="idref" href="#raw_to_system_bool"><span class="id" title="projection">raw_to_system_bool</span></a> <a class="idref" href="#raw_constructor_call_bool"><span class="id" title="projection">raw_constructor_call_bool</span></a> <a class="idref" href="#raw_shard_id"><span class="id" title="projection">raw_shard_id</span></a> <a class="idref" href="#raw_memory_forwarding_type_enum"><span class="id" title="projection">raw_memory_forwarding_type_enum</span></a> <a class="idref" href="#raw_ergs_passed"><span class="id" title="projection">raw_ergs_passed</span></a> <a class="idref" href="#raw_fat_ptr_layout"><span class="id" title="projection">raw_fat_ptr_layout</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#fwd_memory_adapter"><span class="id" title="definition">fwd_memory_adapter</span></a> <span class="id" title="var">raw_memory_forwarding_type_enum</span> <span class="id" title="var">raw_fat_ptr_layout</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">fwd_memory_value</span> ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#fwd_memory"><span class="id" title="projection">fwd_memory</span></a> := <span class="id" title="var">fwd_memory_value</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_passed"><span class="id" title="projection">ergs_passed</span></a> := <span class="id" title="var">raw_ergs_passed</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#shard_id"><span class="id" title="projection">shard_id</span></a> := <span class="id" title="var">raw_shard_id</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#constructor_call"><span class="id" title="projection">constructor_call</span></a> := <span class="id" title="var">raw_constructor_call_bool</span> <span class="id" title="notation">!=</span> <a class="idref" href="#zero8"><span class="id" title="definition">zero8</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#to_system"><span class="id" title="projection">to_system</span></a> := <span class="id" title="var">raw_to_system_bool</span> <span class="id" title="notation">!=</span> <a class="idref" href="#zero8"><span class="id" title="definition">zero8</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="layout_coding_revertible" class="idref" href="#layout_coding_revertible"><span class="id" title="lemma">layout_coding_revertible</span></a>: <a class="idref" href="#revertible"><span class="id" title="definition">revertible</span></a> <a class="idref" href="#decode_layout"><span class="id" title="definition">decode_layout</span></a> <a class="idref" href="#encode_layout"><span class="id" title="definition">encode_layout</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="coder_layout" class="idref" href="#coder_layout"><span class="id" title="definition">coder_layout</span></a> := <a class="idref" href="#mk_coder"><span class="id" title="constructor">mk_coder</span></a> <a class="idref" href="#decode_layout"><span class="id" title="definition">decode_layout</span></a> <a class="idref" href="#encode_layout"><span class="id" title="definition">encode_layout</span></a> <a class="idref" href="#layout_coding_revertible"><span class="id" title="lemma">layout_coding_revertible</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#FarCallABI.LayoutCoder"><span class="id" title="section">LayoutCoder</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="coder" class="idref" href="#coder"><span class="id" title="definition">coder</span></a> := <a class="idref" href="#coder_compose"><span class="id" title="definition">coder_compose</span></a> <a class="idref" href="#coder_binary"><span class="id" title="definition">coder_binary</span></a> <a class="idref" href="#coder_layout"><span class="id" title="definition">coder_layout</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#FarCallABI"><span class="id" title="section">FarCallABI</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.ABI.FarRetABI</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Coder</span></a> <a class="idref" href="#"><span class="id" title="library">Ergs</span></a> <a class="idref" href="#"><span class="id" title="library">MemoryManagement</span></a> <a class="idref" href="#"><span class="id" title="library">Pointer</span></a> <a class="idref" href="#"><span class="id" title="library">lib.BitsExt</span></a> <a class="idref" href="#"><span class="id" title="library">ABI.FatPointerABI</span></a> <a class="idref" href="#"><span class="id" title="library">ABI.ForwardPageTypesABI</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect</span> <span class="id" title="module">ssreflect.ssrfun</span> <span class="id" title="module">ssreflect.eqtype</span> <span class="id" title="module">ssreflect.tuple</span>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Arith</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Coder</span></a> <a class="idref" href="#"><span class="id" title="module">Ergs</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryManagement</span></a> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">lib.BitsExt</span></a> <a class="idref" href="#"><span class="id" title="module">FatPointerABI</span></a> <a class="idref" href="#"><span class="id" title="module">ForwardPageTypesABI</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>This record describes all the parameters that far returns can
use.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Section</span> <a id="FarRetABI" class="idref" href="#FarRetABI"><span class="id" title="section">FarRetABI</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="params" class="idref" href="#params"><span class="id" title="record">params</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">mk_params</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="fwd_memory" class="idref" href="#fwd_memory"><span class="id" title="projection">fwd_memory</span></a>: <a class="idref" href="#fwd_memory"><span class="id" title="inductive">fwd_memory</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
</div>

<div class="doc"><p>This record describes the layout of 256-bit word that encodes these
parameters.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Record</span> <a id="params_layout" class="idref" href="#params_layout"><span class="id" title="record">params_layout</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">mk_params_layout</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;reserved&nbsp;3&nbsp;bytes&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="raw_memory_forwarding_type_enum" class="idref" href="#raw_memory_forwarding_type_enum"><span class="id" title="projection">raw_memory_forwarding_type_enum</span></a> : <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;last&nbsp;16&nbsp;bytes&nbsp;contain&nbsp;the&nbsp;pointer&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="raw_fat_ptr_layout" class="idref" href="#raw_fat_ptr_layout"><span class="id" title="projection">raw_fat_ptr_layout</span></a>: <a class="idref" href="#fat_ptr_layout"><span class="id" title="record">fat_ptr_layout</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="FarRetABI.BinaryCoder" class="idref" href="#FarRetABI.BinaryCoder"><span class="id" title="section">BinaryCoder</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="encode_bin" class="idref" href="#encode_bin"><span class="id" title="definition">encode_bin</span></a> : @<a class="idref" href="#encoder"><span class="id" title="definition">encoder</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a> <a class="idref" href="#params_layout"><span class="id" title="record">params_layout</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="params:6" class="idref" href="#params:6"><span class="id" title="binder">params</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#params:6"><span class="id" title="variable">params</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_params_layout"><span class="id" title="constructor">mk_params_layout</span></a> <span class="id" title="var">memory_forwarding_type8</span> <span class="id" title="var">fat_ptr_layout128</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#encode_bin"><span class="id" title="definition">FatPointerABI.encode_bin</span></a> <span class="id" title="var">fat_ptr_layout128</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">ptr_encoded128</span> ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#zero8"><span class="id" title="definition">zero8</span></a> <span class="id" title="notation">##</span> <a class="idref" href="#zero8"><span class="id" title="definition">zero8</span></a> <span class="id" title="notation">##</span> <a class="idref" href="#zero8"><span class="id" title="definition">zero8</span></a> <span class="id" title="notation">##</span> <span class="id" title="var">memory_forwarding_type8</span> <span class="id" title="notation">##</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a> <span class="id" title="notation">##</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#zero64"><span class="id" title="definition">zero64</span></a> <span class="id" title="notation">##</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ptr_encoded128</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="decode_bin" class="idref" href="#decode_bin"><span class="id" title="definition">decode_bin</span></a> : @<a class="idref" href="#decoder"><span class="id" title="definition">decoder</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a> <a class="idref" href="#params_layout"><span class="id" title="record">params_layout</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="w:8" class="idref" href="#w:8"><span class="id" title="binder">w</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="memory_forwarding_type:9" class="idref" href="#memory_forwarding_type:9"><span class="id" title="binder">memory_forwarding_type</span></a> : <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a> := <a class="idref" href="#w:8"><span class="id" title="variable">w</span></a> <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">{</span></a> 256 <span class="id" title="notation">-</span> 4<span class="id" title="notation">×</span>8<a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">,</span></a> 256 <span class="id" title="notation">-</span> 3<span class="id" title="notation">×</span>8 <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">}</span></a>  <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="ptr:10" class="idref" href="#ptr:10"><span class="id" title="binder">ptr</span></a> : <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#fat_ptr_layout"><span class="id" title="record">fat_ptr_layout</span></a> := <a class="idref" href="#decode_bin"><span class="id" title="definition">FatPointerABI.decode_bin</span></a> (<span class="id" title="definition">low</span> 128 <a class="idref" href="#w:8"><span class="id" title="variable">w</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#ptr:10"><span class="id" title="variable">ptr</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">ptr</span> ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#mk_params_layout"><span class="id" title="constructor">mk_params_layout</span></a> <a class="idref" href="#memory_forwarding_type:9"><span class="id" title="variable">memory_forwarding_type</span></a> <a class="idref" href="#ptr:10"><span class="id" title="variable">ptr</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="binary_coder_revertible" class="idref" href="#binary_coder_revertible"><span class="id" title="lemma">binary_coder_revertible</span></a>: <a class="idref" href="#revertible"><span class="id" title="definition">revertible</span></a> <a class="idref" href="#decode_bin"><span class="id" title="definition">decode_bin</span></a> <a class="idref" href="#encode_bin"><span class="id" title="definition">encode_bin</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="coder_binary" class="idref" href="#coder_binary"><span class="id" title="definition">coder_binary</span></a> : @<a class="idref" href="#coder"><span class="id" title="record">coder</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a> <a class="idref" href="#params_layout"><span class="id" title="record">params_layout</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mk_coder"><span class="id" title="constructor">mk_coder</span></a> <a class="idref" href="#decode_bin"><span class="id" title="definition">decode_bin</span></a> <a class="idref" href="#encode_bin"><span class="id" title="definition">encode_bin</span></a> <a class="idref" href="#binary_coder_revertible"><span class="id" title="lemma">binary_coder_revertible</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#FarRetABI.BinaryCoder"><span class="id" title="section">BinaryCoder</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="FarRetABI.LayoutCoder" class="idref" href="#FarRetABI.LayoutCoder"><span class="id" title="section">LayoutCoder</span></a>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <a id="encode_layout" class="idref" href="#encode_layout"><span class="id" title="definition">encode_layout</span></a>: @<a class="idref" href="#encoder"><span class="id" title="definition">encoder</span></a> <a class="idref" href="#params_layout"><span class="id" title="record">params_layout</span></a> <a class="idref" href="#params"><span class="id" title="record">params</span></a> :=<br/>
<span class="id" title="keyword">fun</span> <a id="params:12" class="idref" href="#params:12"><span class="id" title="binder">params</span></a> ⇒<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#params:12"><span class="id" title="variable">params</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#mk_params"><span class="id" title="constructor">mk_params</span></a> (<a class="idref" href="#ForwardExistingFatPointer"><span class="id" title="constructor">ForwardExistingFatPointer</span></a> <span class="id" title="var">fptr</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#encode_layout"><span class="id" title="definition">FatPointerABI.encode_layout</span></a> <span class="id" title="var">fptr</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">ptr_layout</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#raw_memory_forwarding_type_enum"><span class="id" title="projection">raw_memory_forwarding_type_enum</span></a> := <a class="idref" href="#FarCallForwardPageType.ForwardFatPointer"><span class="id" title="definition">FarCallForwardPageType.ForwardFatPointer</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#raw_fat_ptr_layout"><span class="id" title="projection">raw_fat_ptr_layout</span></a>:= <span class="id" title="var">ptr_layout</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#mk_params"><span class="id" title="constructor">mk_params</span></a> (<a class="idref" href="#ForwardNewFatPointer"><span class="id" title="constructor">ForwardNewFatPointer</span></a> <span class="id" title="var">heap_variant</span> <a class="idref" href="#span"><span class="id" title="record">span</span></a>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#raw_memory_forwarding_type_enum"><span class="id" title="projection">raw_memory_forwarding_type_enum</span></a> := <a class="idref" href="#data_page_type_to_u8"><span class="id" title="definition">data_page_type_to_u8</span></a> <span class="id" title="var">heap_variant</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#raw_fat_ptr_layout"><span class="id" title="projection">raw_fat_ptr_layout</span></a>:= {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#start"><span class="id" title="projection">start</span></a> := <span class="id" title="var">span</span>.(<a class="idref" href="#s_start"><span class="id" title="projection">s_start</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#length"><span class="id" title="projection">length</span></a> := <span class="id" title="var">span</span>.(<a class="idref" href="#s_length"><span class="id" title="projection">s_length</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#page"><span class="id" title="projection">page</span></a> := <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#offset"><span class="id" title="projection">offset</span></a> := <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="decode_layout" class="idref" href="#decode_layout"><span class="id" title="definition">decode_layout</span></a>: @<a class="idref" href="#decoder"><span class="id" title="definition">decoder</span></a> <a class="idref" href="#params_layout"><span class="id" title="record">params_layout</span></a> <a class="idref" href="#params"><span class="id" title="record">params</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="layout:14" class="idref" href="#layout:14"><span class="id" title="binder">layout</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#layout:14"><span class="id" title="variable">layout</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_params_layout"><span class="id" title="constructor">mk_params_layout</span></a> <a class="idref" href="#raw_memory_forwarding_type_enum"><span class="id" title="projection">raw_memory_forwarding_type_enum</span></a> <a class="idref" href="#raw_fat_ptr_layout"><span class="id" title="projection">raw_fat_ptr_layout</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#fwd_memory_adapter"><span class="id" title="definition">fwd_memory_adapter</span></a> <span class="id" title="var">raw_memory_forwarding_type_enum</span> <span class="id" title="var">raw_fat_ptr_layout</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">fwd_memory_value</span> ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#mk_params"><span class="id" title="constructor">mk_params</span></a> <span class="id" title="var">fwd_memory_value</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="layout_coding_revertible" class="idref" href="#layout_coding_revertible"><span class="id" title="lemma">layout_coding_revertible</span></a>: <a class="idref" href="#revertible"><span class="id" title="definition">revertible</span></a> <a class="idref" href="#decode_layout"><span class="id" title="definition">decode_layout</span></a> <a class="idref" href="#encode_layout"><span class="id" title="definition">encode_layout</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="coder_layout" class="idref" href="#coder_layout"><span class="id" title="definition">coder_layout</span></a> := <a class="idref" href="#mk_coder"><span class="id" title="constructor">mk_coder</span></a> <a class="idref" href="#decode_layout"><span class="id" title="definition">decode_layout</span></a> <a class="idref" href="#encode_layout"><span class="id" title="definition">encode_layout</span></a> <a class="idref" href="#layout_coding_revertible"><span class="id" title="lemma">layout_coding_revertible</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#FarRetABI.LayoutCoder"><span class="id" title="section">LayoutCoder</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="coder" class="idref" href="#coder"><span class="id" title="definition">coder</span></a> := <a class="idref" href="#coder_compose"><span class="id" title="definition">coder_compose</span></a> <a class="idref" href="#coder_binary"><span class="id" title="definition">coder_binary</span></a> <a class="idref" href="#coder_layout"><span class="id" title="definition">coder_layout</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#FarRetABI"><span class="id" title="section">FarRetABI</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.ABI.MetaParametersABI</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Coder</span></a> <a class="idref" href="#"><span class="id" title="library">Ergs</span></a> <a class="idref" href="#"><span class="id" title="library">memory.Depot</span></a> <a class="idref" href="#"><span class="id" title="library">MemoryManagement</span></a> <a class="idref" href="#"><span class="id" title="library">Pointer</span></a> <a class="idref" href="#"><span class="id" title="library">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="library">lib.BitsExt</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect</span> <span class="id" title="module">ssreflect.ssrfun</span> <span class="id" title="module">ssreflect.eqtype</span> <span class="id" title="module">ssreflect.tuple</span>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Arith</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Coder</span></a> <a class="idref" href="#"><span class="id" title="module">Ergs</span></a> <a class="idref" href="#"><span class="id" title="module">memory.Depot</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryManagement</span></a> <a class="idref" href="#"><span class="id" title="module">Pointer</span></a> <a class="idref" href="#"><span class="id" title="module">lib.BitsExt</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="MetaParametersABI" class="idref" href="#MetaParametersABI"><span class="id" title="section">MetaParametersABI</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>Meta parameters are returned by <span class="inlinecode"><span
class="id" title="var">OpContextMeta</span></span>. This record shows
the data that is contained in it.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Record</span> <a id="params" class="idref" href="#params"><span class="id" title="record">params</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">mk_params</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ergs_per_pubdata_byte" class="idref" href="#ergs_per_pubdata_byte"><span class="id" title="projection">ergs_per_pubdata_byte</span></a>: <a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="heap_size" class="idref" href="#heap_size"><span class="id" title="projection">heap_size</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="aux_heap_size" class="idref" href="#aux_heap_size"><span class="id" title="projection">aux_heap_size</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="this_shard_id" class="idref" href="#this_shard_id"><span class="id" title="projection">this_shard_id</span></a>: <a class="idref" href="#shard_id"><span class="id" title="definition">shard_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="caller_shard_id" class="idref" href="#caller_shard_id"><span class="id" title="projection">caller_shard_id</span></a>: <a class="idref" href="#shard_id"><span class="id" title="definition">shard_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="code_shard_id" class="idref" href="#code_shard_id"><span class="id" title="projection">code_shard_id</span></a>: <a class="idref" href="#shard_id"><span class="id" title="definition">shard_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
</div>

<div class="doc"><p>This record describes the exact memory layout in a 256-bit word,
which holds parameters.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Record</span> <a id="params_layout" class="idref" href="#params_layout"><span class="id" title="record">params_layout</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">mk_params_layout</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;reserved:&nbsp;u8&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="l_code_shard_id" class="idref" href="#l_code_shard_id"><span class="id" title="projection">l_code_shard_id</span></a> : <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="l_caller_shard_id" class="idref" href="#l_caller_shard_id"><span class="id" title="projection">l_caller_shard_id</span></a> : <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="l_this_shard_id" class="idref" href="#l_this_shard_id"><span class="id" title="projection">l_this_shard_id</span></a> : <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;reserved:&nbsp;u96&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="l_aux_heap_size" class="idref" href="#l_aux_heap_size"><span class="id" title="projection">l_aux_heap_size</span></a> : <a class="idref" href="#u32"><span class="id" title="definition">u32</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="l_heap_size" class="idref" href="#l_heap_size"><span class="id" title="projection">l_heap_size</span></a> : <a class="idref" href="#u32"><span class="id" title="definition">u32</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;reserved:&nbsp;u32&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="l_ergs_per_pubdata_byte" class="idref" href="#l_ergs_per_pubdata_byte"><span class="id" title="projection">l_ergs_per_pubdata_byte</span></a>: <a class="idref" href="#u32"><span class="id" title="definition">u32</span></a>;<br/>
&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="MetaParametersABI.BinaryCoder" class="idref" href="#MetaParametersABI.BinaryCoder"><span class="id" title="section">BinaryCoder</span></a>.<br/>
&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="zero96:15" class="idref" href="#zero96:15"><span class="id" title="binder">zero96</span></a> : <span class="id" title="definition">BITS</span> 96 := <span class="id" title="notation">#</span> 0).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="encode_bin" class="idref" href="#encode_bin"><span class="id" title="definition">encode_bin</span></a> : @<a class="idref" href="#encoder"><span class="id" title="definition">encoder</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a> <a class="idref" href="#params_layout"><span class="id" title="record">params_layout</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="layout:16" class="idref" href="#layout:16"><span class="id" title="binder">layout</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#layout:16"><span class="id" title="variable">layout</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_params_layout"><span class="id" title="constructor">mk_params_layout</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">l_code_shard_id8</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">l_caller_shard_id8</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">l_this_shard_id8</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">l_aux_heap_size32</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">l_heap_size32</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">l_ergs_per_pubdata_byte32</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#zero8"><span class="id" title="definition">zero8</span></a> <span class="id" title="notation">##</span> <span class="id" title="var">l_code_shard_id8</span> <span class="id" title="notation">##</span> <span class="id" title="var">l_caller_shard_id8</span> <span class="id" title="notation">##</span> <span class="id" title="var">l_this_shard_id8</span> <span class="id" title="notation">##</span> <a class="idref" href="#MetaParametersABI.BinaryCoder.zero96"><span class="id" title="variable">zero96</span></a> <span class="id" title="notation">##</span> <span class="id" title="var">l_aux_heap_size32</span> <span class="id" title="notation">##</span> <span class="id" title="var">l_heap_size32</span> <span class="id" title="notation">##</span> <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a> <span class="id" title="notation">##</span> <span class="id" title="var">l_ergs_per_pubdata_byte32</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="decode_bin" class="idref" href="#decode_bin"><span class="id" title="definition">decode_bin</span></a>: @<a class="idref" href="#decoder"><span class="id" title="definition">decoder</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a> <a class="idref" href="#params_layout"><span class="id" title="record">params_layout</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="w:18" class="idref" href="#w:18"><span class="id" title="binder">w</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;reserved:&nbsp;u8&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#l_code_shard_id"><span class="id" title="projection">l_code_shard_id</span></a> := <a class="idref" href="#w:18"><span class="id" title="variable">w</span></a> <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">{</span></a> 256 <span class="id" title="notation">-</span> 2<span class="id" title="notation">×</span>8 <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">,</span></a> 256 <span class="id" title="notation">-</span> 8<a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">}</span></a> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#l_caller_shard_id"><span class="id" title="projection">l_caller_shard_id</span></a> := <a class="idref" href="#w:18"><span class="id" title="variable">w</span></a> <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">{</span></a>256 <span class="id" title="notation">-</span> 3 <span class="id" title="notation">×</span> 8<a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">,</span></a> 256 <span class="id" title="notation">-</span> 2 <span class="id" title="notation">×</span> 8<a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">}</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#l_this_shard_id"><span class="id" title="projection">l_this_shard_id</span></a> := <a class="idref" href="#w:18"><span class="id" title="variable">w</span></a> <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">{</span></a>256 <span class="id" title="notation">-</span> 4 <span class="id" title="notation">×</span> 8<a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">,</span></a> 256 <span class="id" title="notation">-</span> 3 <span class="id" title="notation">×</span> 8<a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">}</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;reserved:&nbsp;u96&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#l_aux_heap_size"><span class="id" title="projection">l_aux_heap_size</span></a> := <a class="idref" href="#w:18"><span class="id" title="variable">w</span></a> <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">{</span></a> 3 <span class="id" title="notation">×</span> 32<a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">,</span></a> 4 <span class="id" title="notation">×</span> 32 <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">}</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#l_heap_size"><span class="id" title="projection">l_heap_size</span></a> := <a class="idref" href="#w:18"><span class="id" title="variable">w</span></a> <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">{</span></a> 2 <span class="id" title="notation">×</span> 32<a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">,</span></a> 3 <span class="id" title="notation">×</span> 32 <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">}</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;reserved:&nbsp;u32&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#l_ergs_per_pubdata_byte"><span class="id" title="projection">l_ergs_per_pubdata_byte</span></a>:= <a class="idref" href="#w:18"><span class="id" title="variable">w</span></a> <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">{</span></a> 0<a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">,</span></a> 32 <a class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">}</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="binary_coder_revertible" class="idref" href="#binary_coder_revertible"><span class="id" title="lemma">binary_coder_revertible</span></a>: <a class="idref" href="#revertible"><span class="id" title="definition">revertible</span></a> <a class="idref" href="#decode_bin"><span class="id" title="definition">decode_bin</span></a> <a class="idref" href="#encode_bin"><span class="id" title="definition">encode_bin</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="binary_coder" class="idref" href="#binary_coder"><span class="id" title="definition">binary_coder</span></a> := <a class="idref" href="#mk_coder"><span class="id" title="constructor">mk_coder</span></a> <a class="idref" href="#decode_bin"><span class="id" title="definition">decode_bin</span></a> <a class="idref" href="#encode_bin"><span class="id" title="definition">encode_bin</span></a> <a class="idref" href="#binary_coder_revertible"><span class="id" title="lemma">binary_coder_revertible</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#MetaParametersABI.BinaryCoder"><span class="id" title="section">BinaryCoder</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="MetaParametersABI.LayoutCoder" class="idref" href="#MetaParametersABI.LayoutCoder"><span class="id" title="section">LayoutCoder</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="decode_layout" class="idref" href="#decode_layout"><span class="id" title="definition">decode_layout</span></a> : @<a class="idref" href="#decoder"><span class="id" title="definition">decoder</span></a> <a class="idref" href="#params_layout"><span class="id" title="record">params_layout</span></a> <a class="idref" href="#params"><span class="id" title="record">params</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="layout:19" class="idref" href="#layout:19"><span class="id" title="binder">layout</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#layout:19"><span class="id" title="variable">layout</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_params_layout"><span class="id" title="constructor">mk_params_layout</span></a> <a class="idref" href="#l_code_shard_id"><span class="id" title="projection">l_code_shard_id</span></a> <a class="idref" href="#l_caller_shard_id"><span class="id" title="projection">l_caller_shard_id</span></a> <a class="idref" href="#l_this_shard_id"><span class="id" title="projection">l_this_shard_id</span></a> <a class="idref" href="#l_aux_heap_size"><span class="id" title="projection">l_aux_heap_size</span></a> <a class="idref" href="#l_heap_size"><span class="id" title="projection">l_heap_size</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#l_ergs_per_pubdata_byte"><span class="id" title="projection">l_ergs_per_pubdata_byte</span></a> ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#ergs_per_pubdata_byte"><span class="id" title="projection">ergs_per_pubdata_byte</span></a> := <span class="id" title="var">l_ergs_per_pubdata_byte</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#heap_size"><span class="id" title="projection">heap_size</span></a> := <span class="id" title="var">l_heap_size</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#aux_heap_size"><span class="id" title="projection">aux_heap_size</span></a> := <span class="id" title="var">l_aux_heap_size</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#this_shard_id"><span class="id" title="projection">this_shard_id</span></a> := <span class="id" title="var">l_this_shard_id</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#caller_shard_id"><span class="id" title="projection">caller_shard_id</span></a> := <span class="id" title="var">l_caller_shard_id</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#code_shard_id"><span class="id" title="projection">code_shard_id</span></a> := <span class="id" title="var">l_code_shard_id</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="encode_layout" class="idref" href="#encode_layout"><span class="id" title="definition">encode_layout</span></a> : @<a class="idref" href="#encoder"><span class="id" title="definition">encoder</span></a> <a class="idref" href="#params_layout"><span class="id" title="record">params_layout</span></a> <a class="idref" href="#params"><span class="id" title="record">params</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="params:21" class="idref" href="#params:21"><span class="id" title="binder">params</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#params:21"><span class="id" title="variable">params</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_params"><span class="id" title="constructor">mk_params</span></a> <a class="idref" href="#ergs_per_pubdata_byte"><span class="id" title="projection">ergs_per_pubdata_byte</span></a> <a class="idref" href="#heap_size"><span class="id" title="projection">heap_size</span></a> <a class="idref" href="#aux_heap_size"><span class="id" title="projection">aux_heap_size</span></a> <a class="idref" href="#this_shard_id"><span class="id" title="projection">this_shard_id</span></a> <a class="idref" href="#caller_shard_id"><span class="id" title="projection">caller_shard_id</span></a> <a class="idref" href="#code_shard_id"><span class="id" title="projection">code_shard_id</span></a> ⇒ <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#l_ergs_per_pubdata_byte"><span class="id" title="projection">l_ergs_per_pubdata_byte</span></a> := <span class="id" title="var">ergs_per_pubdata_byte</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#l_heap_size"><span class="id" title="projection">l_heap_size</span></a> := <span class="id" title="var">heap_size</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#l_aux_heap_size"><span class="id" title="projection">l_aux_heap_size</span></a> := <span class="id" title="var">aux_heap_size</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#l_this_shard_id"><span class="id" title="projection">l_this_shard_id</span></a> := <span class="id" title="var">this_shard_id</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#l_caller_shard_id"><span class="id" title="projection">l_caller_shard_id</span></a> := <span class="id" title="var">caller_shard_id</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#l_code_shard_id"><span class="id" title="projection">l_code_shard_id</span></a> := <span class="id" title="var">code_shard_id</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <a id="layout_coder_revertible" class="idref" href="#layout_coder_revertible"><span class="id" title="lemma">layout_coder_revertible</span></a>: <a class="idref" href="#revertible"><span class="id" title="definition">revertible</span></a> <a class="idref" href="#decode_layout"><span class="id" title="definition">decode_layout</span></a> <a class="idref" href="#encode_layout"><span class="id" title="definition">encode_layout</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="layout_coder" class="idref" href="#layout_coder"><span class="id" title="definition">layout_coder</span></a> := <a class="idref" href="#mk_coder"><span class="id" title="constructor">mk_coder</span></a> <a class="idref" href="#decode_layout"><span class="id" title="definition">decode_layout</span></a> <a class="idref" href="#encode_layout"><span class="id" title="definition">encode_layout</span></a> <a class="idref" href="#layout_coder_revertible"><span class="id" title="lemma">layout_coder_revertible</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#MetaParametersABI.LayoutCoder"><span class="id" title="section">LayoutCoder</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="coder" class="idref" href="#coder"><span class="id" title="definition">coder</span></a> := <a class="idref" href="#coder_compose"><span class="id" title="definition">coder_compose</span></a> <a class="idref" href="#binary_coder"><span class="id" title="definition">binary_coder</span></a> <a class="idref" href="#layout_coder"><span class="id" title="definition">layout_coder</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#MetaParametersABI"><span class="id" title="section">MetaParametersABI</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.ABI.PrecompileParametersABI</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Coder</span></a> <a class="idref" href="#"><span class="id" title="library">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="library">lib.BitsExt</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">ssreflect</span> <span class="id" title="module">ssreflect.ssrfun</span> <span class="id" title="module">ssreflect.eqtype</span> <span class="id" title="module">ssreflect.tuple</span>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Coder</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">lib.BitsExt</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="PrecompileParametersABI" class="idref" href="#PrecompileParametersABI"><span class="id" title="section">PrecompileParametersABI</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="params" class="idref" href="#params"><span class="id" title="record">params</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">mk_params</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="input_memory_offset" class="idref" href="#input_memory_offset"><span class="id" title="projection">input_memory_offset</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="input_memory_length" class="idref" href="#input_memory_length"><span class="id" title="projection">input_memory_length</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="output_memory_offset" class="idref" href="#output_memory_offset"><span class="id" title="projection">output_memory_offset</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="output_memory_length" class="idref" href="#output_memory_length"><span class="id" title="projection">output_memory_length</span></a>: <a class="idref" href="#mem_address"><span class="id" title="definition">mem_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="per_precompile_interpreted" class="idref" href="#per_precompile_interpreted"><span class="id" title="projection">per_precompile_interpreted</span></a>: <a class="idref" href="#u64"><span class="id" title="definition">u64</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="memory_page_to_read" class="idref" href="#memory_page_to_read"><span class="id" title="projection">memory_page_to_read</span></a>: <a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="memory_page_to_write" class="idref" href="#memory_page_to_write"><span class="id" title="projection">memory_page_to_write</span></a>: <a class="idref" href="#page_id"><span class="id" title="definition">page_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="precompile_interpreted_data" class="idref" href="#precompile_interpreted_data"><span class="id" title="projection">precompile_interpreted_data</span></a>: <a class="idref" href="#u64"><span class="id" title="definition">u64</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
</div>
<details><summary>equality </summary><div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="params_eqn" class="idref" href="#params_eqn"><span class="id" title="definition">params_eqn</span></a> (<a id="x:10" class="idref" href="#x:10"><span class="id" title="binder">x</span></a> <a id="y:11" class="idref" href="#y:11"><span class="id" title="binder">y</span></a>: <a class="idref" href="#params"><span class="id" title="record">params</span></a>) : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><a class="idref" href="#x:10"><span class="id" title="variable">x</span></a>.(<a class="idref" href="#input_memory_offset"><span class="id" title="projection">input_memory_offset</span></a>) <span class="id" title="notation">==</span> <a class="idref" href="#y:11"><span class="id" title="variable">y</span></a>.(<a class="idref" href="#input_memory_offset"><span class="id" title="projection">input_memory_offset</span></a>)<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><a class="idref" href="#x:10"><span class="id" title="variable">x</span></a>.(<a class="idref" href="#input_memory_length"><span class="id" title="projection">input_memory_length</span></a>) <span class="id" title="notation">==</span> <a class="idref" href="#y:11"><span class="id" title="variable">y</span></a>.(<a class="idref" href="#input_memory_length"><span class="id" title="projection">input_memory_length</span></a>)<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><a class="idref" href="#x:10"><span class="id" title="variable">x</span></a>.(<a class="idref" href="#output_memory_offset"><span class="id" title="projection">output_memory_offset</span></a>) <span class="id" title="notation">==</span> <a class="idref" href="#y:11"><span class="id" title="variable">y</span></a>.(<a class="idref" href="#output_memory_offset"><span class="id" title="projection">output_memory_offset</span></a>)<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><a class="idref" href="#x:10"><span class="id" title="variable">x</span></a>.(<a class="idref" href="#output_memory_length"><span class="id" title="projection">output_memory_length</span></a>) <span class="id" title="notation">==</span> <a class="idref" href="#y:11"><span class="id" title="variable">y</span></a>.(<a class="idref" href="#output_memory_length"><span class="id" title="projection">output_memory_length</span></a>)<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><a class="idref" href="#x:10"><span class="id" title="variable">x</span></a>.(<a class="idref" href="#per_precompile_interpreted"><span class="id" title="projection">per_precompile_interpreted</span></a>) <span class="id" title="notation">==</span> <a class="idref" href="#y:11"><span class="id" title="variable">y</span></a>.(<a class="idref" href="#per_precompile_interpreted"><span class="id" title="projection">per_precompile_interpreted</span></a>)<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><a class="idref" href="#x:10"><span class="id" title="variable">x</span></a>.(<a class="idref" href="#memory_page_to_read"><span class="id" title="projection">memory_page_to_read</span></a>) <span class="id" title="notation">==</span> <a class="idref" href="#y:11"><span class="id" title="variable">y</span></a>.(<a class="idref" href="#memory_page_to_read"><span class="id" title="projection">memory_page_to_read</span></a>)<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><a class="idref" href="#x:10"><span class="id" title="variable">x</span></a>.(<a class="idref" href="#memory_page_to_write"><span class="id" title="projection">memory_page_to_write</span></a>) <span class="id" title="notation">==</span> <a class="idref" href="#y:11"><span class="id" title="variable">y</span></a>.(<a class="idref" href="#memory_page_to_write"><span class="id" title="projection">memory_page_to_write</span></a>)<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><a class="idref" href="#x:10"><span class="id" title="variable">x</span></a>.(<a class="idref" href="#precompile_interpreted_data"><span class="id" title="projection">precompile_interpreted_data</span></a>) <span class="id" title="notation">==</span> <a class="idref" href="#y:11"><span class="id" title="variable">y</span></a>.(<a class="idref" href="#precompile_interpreted_data"><span class="id" title="projection">precompile_interpreted_data</span></a>)<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="params_eqnP" class="idref" href="#params_eqnP"><span class="id" title="lemma">params_eqnP</span></a> : <span class="id" title="definition">Equality.axiom</span> <a class="idref" href="#params_eqn"><span class="id" title="definition">params_eqn</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">move</span> ⇒ <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="#params_eqn"><span class="id" title="definition">params_eqn</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>,<span class="id" title="var">y</span> =>//=.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ |- <span class="id" title="keyword">context</span> [(?<span class="id" title="var">x</span> <span class="id" title="notation">==</span> ?<span class="id" title="var">y</span>)] ] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">Hf</span> := <span class="id" title="tactic">fresh</span> "H" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">x</span> <span class="id" title="notation">==</span> <span class="id" title="var">y</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">Hf</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hf</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> =>//=; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> [ <span class="id" title="var">H</span>: <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a>?<span class="id" title="var">x</span> <span class="id" title="notation">==</span> ?<span class="id" title="var">y</span><a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> |- <span class="id" title="var">_</span>] ⇒ <span class="id" title="tactic">move</span>: <span class="id" title="var">H</span> ⇒ /<span class="id" title="lemma">eqP</span> → <span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">injection</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> [ <span class="id" title="var">H</span>: <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a>?<span class="id" title="var">x</span> <span class="id" title="notation">==</span> ?<span class="id" title="var">x</span><a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a> |- <span class="id" title="var">_</span>] ⇒ <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">eq_refl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span> <span class="id" title="keyword">end</span> =>//=.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">constructor</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Canonical</span> <a id="params_eqMixin" class="idref" href="#params_eqMixin"><span class="id" title="definition">params_eqMixin</span></a> := <span class="id" title="abbreviation">EqMixin</span> <a class="idref" href="#params_eqnP"><span class="id" title="lemma">params_eqnP</span></a>.<br/>
<span class="id" title="keyword">Canonical</span> <a id="params_eqType" class="idref" href="#params_eqType"><span class="id" title="definition">params_eqType</span></a> := <span class="id" title="keyword">Eval</span> <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="abbreviation">EqType</span> <span class="id" title="var">_</span> <a class="idref" href="#params_eqMixin"><span class="id" title="definition">params_eqMixin</span></a>.<br/>
</div>
</details><div class="code">

<br/>
<span class="id" title="keyword">Axiom</span> <a id="ABI" class="idref" href="#ABI"><span class="id" title="axiom">ABI</span></a>: @<a class="idref" href="#coder"><span class="id" title="record">coder</span></a> <a class="idref" href="#word"><span class="id" title="definition">word</span></a> <a class="idref" href="#params"><span class="id" title="record">params</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#PrecompileParametersABI"><span class="id" title="section">PrecompileParametersABI</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.encoding.EncodingUtils</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Common</span></a> <a class="idref" href="#"><span class="id" title="library">Predication</span></a> <a class="idref" href="#"><span class="id" title="library">isa.Modifiers</span></a> <a class="idref" href="#"><span class="id" title="library">isa.GeneratedMachISA</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">ZBits</span></a> <a class="idref" href="#"><span class="id" title="module">ZArith</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">GPR</span></a> <a class="idref" href="#"><span class="id" title="module">GeneratedMachISA</span></a> <a class="idref" href="#"><span class="id" title="module">Modifiers</span></a> <a class="idref" href="#"><span class="id" title="module">Predication</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="EncodingTools" class="idref" href="#EncodingTools"><span class="id" title="section">EncodingTools</span></a>.<br/>
</div>

<div class="doc"><h1 id="encoding-parts-of-instructions">Encoding parts of
instructions</h1>
<p>The encoding of <span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span> is
described in two stages:</p>
<ol type="1">
<li><span
class="inlinecode"><a class="idref" href="#asm_to_mach"><span
class="id" title="definition">asm_to_mach</span></a></span> describes
how fields <span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span> are
mapped to the EraVM machine instruction <span
class="inlinecode"><a class="idref" href="#mach_instruction"><span
class="id" title="record">mach_instruction</span></a></span>; this
describes the instruction layout.</li>
<li><span
class="inlinecode"><a class="idref" href="#encode_mach_instruction"><span
class="id" title="definition">encode_mach_instruction</span></a></span>
describes the binary encoding of <span
class="inlinecode"><a class="idref" href="#mach_instruction"><span
class="id" title="record">mach_instruction</span></a></span>.</li>
</ol>
<p>EraVM instructions <span
class="inlinecode"><a class="idref" href="#mach_instruction"><span
class="id" title="record">mach_instruction</span></a></span> are 64 bits
wide. Starting from the least significant bit, they are made of the
following parts:</p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#mach_opcode"><span
class="id" title="inductive">mach_opcode</span></a></span> (11
bits)</li>
<li>2 reserved bits</li>
<li><span
class="inlinecode"><a class="idref" href="#predicate"><span
class="id" title="inductive">predicate</span></a></span> (3 bits)</li>
<li><span
class="inlinecode"><a class="idref" href="#reg_name"><span
class="id" title="inductive">reg_name</span></a></span>s (4 x 4
bits)</li>
<li>immediate <span
class="inlinecode"><a class="idref" href="#u16"><span
class="id" title="definition">u16</span></a></span> values (2 x 16 bits,
big endian)</li>
</ul>
<p>The precise format is formalized by <span
class="inlinecode"><a class="idref" href="#encode_mach_instruction"><span
class="id"
title="definition">encode_mach_instruction</span></a></span>.</p>
<p>Their encoding is independent and happens as follows:</p>
<ol type="1">
<li>The <span
class="inlinecode"><a class="idref" href="#mach_opcode"><span
class="id" title="inductive">mach_opcode</span></a></span> packs
together the information about</li>
</ol>
<ul>
<li>the instruction meaning, e.g. is it addition, or call, or something
else;</li>
<li>its source and destination addressing modes. For example, in the
encoding of <code>add r1, r0, r3</code> the meaning of the register
<span class="inlinecode"><a class="idref" href="#R1"><span
class="id" title="constructor">R1</span></a></span> in the field <span
class="inlinecode"><a class="idref" href="#op_src0"><span
class="id" title="projection">op_src0</span></a></span> is “use the
value from register r1 as the first operand”. But in the encoding of
<code>add stack=[r1], r0, r3</code> the meaning of the register <span
class="inlinecode"><a class="idref" href="#R1"><span
class="id" title="constructor">R1</span></a></span> in the field <span
class="inlinecode"><a class="idref" href="#op_src0"><span
class="id" title="projection">op_src0</span></a></span> is “use the
value on the stack page by address R1 as the first operand”. This
difference is reflected in the <span
class="inlinecode"><a class="idref" href="#mach_opcode"><span
class="id" title="inductive">mach_opcode</span></a></span> field: the
addressing modes are encoded by <span
class="inlinecode"><a class="idref" href="#encode_src_mode"><span
class="id" title="definition">encode_src_mode</span></a></span>/<span
class="inlinecode"><a class="idref" href="#encode_src_special_mode"><span
class="id" title="definition">encode_src_special_mode</span></a></span>
(for selected instructions)/<span
class="inlinecode"><a class="idref" href="#encode_dst_mode"><span
class="id" title="definition">encode_dst_mode</span></a></span>) and
mixed in <span
class="inlinecode"><a class="idref" href="#mach_opcode"><span
class="id" title="inductive">mach_opcode</span></a></span> by <span
class="inlinecode"><a class="idref" href="#encode_opcode"><span
class="id" title="definition">encode_opcode</span></a></span>.</li>
</ul>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Definition</span> <a id="encode_src_mode" class="idref" href="#encode_src_mode"><span class="id" title="definition">encode_src_mode</span></a> (<a id="sm:1" class="idref" href="#sm:1"><span class="id" title="binder">sm</span></a>:<a class="idref" href="#src_mode"><span class="id" title="inductive">src_mode</span></a>) : <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#sm:1"><span class="id" title="variable">sm</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#SrcReg"><span class="id" title="constructor">SrcReg</span></a> ⇒ 0<br/>
&nbsp;&nbsp;| <a class="idref" href="#SrcSpRelativePop"><span class="id" title="constructor">SrcSpRelativePop</span></a> ⇒ 1<br/>
&nbsp;&nbsp;| <a class="idref" href="#SrcSpRelative"><span class="id" title="constructor">SrcSpRelative</span></a> ⇒ 2<br/>
&nbsp;&nbsp;| <a class="idref" href="#SrcStackAbsolute"><span class="id" title="constructor">SrcStackAbsolute</span></a> ⇒ 3<br/>
&nbsp;&nbsp;| <a class="idref" href="#SrcImm"><span class="id" title="constructor">SrcImm</span></a> ⇒ 4<br/>
&nbsp;&nbsp;| <a class="idref" href="#SrcCodeAddr"><span class="id" title="constructor">SrcCodeAddr</span></a> ⇒ 5<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="encode_src_special_mode" class="idref" href="#encode_src_special_mode"><span class="id" title="definition">encode_src_special_mode</span></a> (<a id="sm:3" class="idref" href="#sm:3"><span class="id" title="binder">sm</span></a>:<a class="idref" href="#src_special_mode"><span class="id" title="inductive">src_special_mode</span></a>) : <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#sm:3"><span class="id" title="variable">sm</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#SrcSpecialReg"><span class="id" title="constructor">SrcSpecialReg</span></a> ⇒ 0<br/>
&nbsp;&nbsp;| <a class="idref" href="#SrcSpecialImm"><span class="id" title="constructor">SrcSpecialImm</span></a> ⇒ 1<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="encode_dst_mode" class="idref" href="#encode_dst_mode"><span class="id" title="definition">encode_dst_mode</span></a> (<a id="sm:5" class="idref" href="#sm:5"><span class="id" title="binder">sm</span></a>:<a class="idref" href="#dst_mode"><span class="id" title="inductive">dst_mode</span></a>) : <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#sm:5"><span class="id" title="variable">sm</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#DstReg"><span class="id" title="constructor">DstReg</span></a> ⇒ 0<br/>
&nbsp;&nbsp;| <a class="idref" href="#DstSpRelativePush"><span class="id" title="constructor">DstSpRelativePush</span></a> ⇒ 1<br/>
&nbsp;&nbsp;| <a class="idref" href="#DstSpRelative"><span class="id" title="constructor">DstSpRelative</span></a> ⇒ 2<br/>
&nbsp;&nbsp;| <a class="idref" href="#DstStackAbsolute"><span class="id" title="constructor">DstStackAbsolute</span></a> ⇒ 3<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
.<br/>

<br/>
</div>

<div class="doc"><p>The definitions <span
class="inlinecode"><a class="idref" href="#encode_set_flags"><span
class="id" title="definition">encode_set_flags</span></a></span> and
<span
class="inlinecode"><a class="idref" href="#encode_swap"><span
class="id" title="definition">encode_swap</span></a></span> are encoding
the <span
class="inlinecode"><a class="idref" href="#mod_set_flags"><span
class="id" title="inductive">mod_set_flags</span></a></span> and <span
class="inlinecode"><a class="idref" href="#mod_swap"><span
class="id" title="inductive">mod_swap</span></a></span> modifier values
as one-bit numbers.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Definition</span> <a id="encode_set_flags" class="idref" href="#encode_set_flags"><span class="id" title="definition">encode_set_flags</span></a> (<a id="m:7" class="idref" href="#m:7"><span class="id" title="binder">m</span></a>: <a class="idref" href="#mod_set_flags"><span class="id" title="inductive">mod_set_flags</span></a>) : <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#m:7"><span class="id" title="variable">m</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#SetFlags"><span class="id" title="constructor">SetFlags</span></a> ⇒ 1<br/>
&nbsp;&nbsp;| <a class="idref" href="#PreserveFlags"><span class="id" title="constructor">PreserveFlags</span></a> ⇒ 0<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="encode_swap" class="idref" href="#encode_swap"><span class="id" title="definition">encode_swap</span></a>(<a id="m:9" class="idref" href="#m:9"><span class="id" title="binder">m</span></a>: <a class="idref" href="#mod_swap"><span class="id" title="inductive">mod_swap</span></a>) : <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#m:9"><span class="id" title="variable">m</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#Swap"><span class="id" title="constructor">Swap</span></a> ⇒ 1<br/>
&nbsp;&nbsp;| <a class="idref" href="#NoSwap"><span class="id" title="constructor">NoSwap</span></a> =>0<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
.<br/>

<br/>
</div>

<div class="doc"><ol start="2" type="1">
<li><span
class="inlinecode"><a class="idref" href="#encode_predicate"><span
class="id" title="definition">encode_predicate</span></a></span> maps
eight different predicates to their encodings as 3-bit binary
numbers.</li>
</ol>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Definition</span> <a id="encode_predicate" class="idref" href="#encode_predicate"><span class="id" title="definition">encode_predicate</span></a> (<a id="p:11" class="idref" href="#p:11"><span class="id" title="binder">p</span></a>:<a class="idref" href="#predicate"><span class="id" title="inductive">predicate</span></a>) : <span class="id" title="definition">BITS</span> 3 :=<br/>
&nbsp;&nbsp;<span class="id" title="notation">#</span> <span class="id" title="keyword">match</span> <a class="idref" href="#p:11"><span class="id" title="variable">p</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#IfAlways"><span class="id" title="constructor">IfAlways</span></a> ⇒ 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#IfGT"><span class="id" title="constructor">IfGT</span></a> ⇒ 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#IfLT"><span class="id" title="constructor">IfLT</span></a> ⇒ 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#IfEQ"><span class="id" title="constructor">IfEQ</span></a> ⇒ 3<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#IfGE"><span class="id" title="constructor">IfGE</span></a> ⇒ 4<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#IfLE"><span class="id" title="constructor">IfLE</span></a> ⇒ 5<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#IfNotEQ"><span class="id" title="constructor">IfNotEQ</span></a> ⇒ 6<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#IfGTOrLT"><span class="id" title="constructor">IfGTOrLT</span></a> ⇒ 7<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
.<br/>

<br/>
</div>

<div class="doc"><ol start="3" type="1">
<li>Registers are encoded by their indices as 4-bit numbers,
e.g. register <span
class="inlinecode"><a class="idref" href="#R3"><span
class="id" title="constructor">R3</span></a></span> is encoded as <span
class="math inline">3 = 0011_2</span>. The meaning of two source and two
destination registers depends on the instruction and/or addressing
modes.</li>
</ol>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Definition</span> <a id="encode_reg" class="idref" href="#encode_reg"><span class="id" title="definition">encode_reg</span></a> (<a id="name:13" class="idref" href="#name:13"><span class="id" title="binder">name</span></a>:<a class="idref" href="#reg_name"><span class="id" title="inductive">reg_name</span></a>) : <span class="id" title="definition">BITS</span> 4 :=<br/>
&nbsp;&nbsp;<span class="id" title="notation">#</span> <span class="id" title="notation">(</span><a class="idref" href="#reg_idx"><span class="id" title="definition">reg_idx</span></a> <a class="idref" href="#name:13"><span class="id" title="variable">name</span></a><span class="id" title="notation">)</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="encode_reg_opt" class="idref" href="#encode_reg_opt"><span class="id" title="definition">encode_reg_opt</span></a> (<a id="name:14" class="idref" href="#name:14"><span class="id" title="binder">name</span></a>:<a class="idref" href="#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="#reg_name"><span class="id" title="inductive">reg_name</span></a>) : <span class="id" title="definition">BITS</span> 4 :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#name:14"><span class="id" title="variable">name</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">name</span> ⇒ <a class="idref" href="#encode_reg"><span class="id" title="definition">encode_reg</span></a> <a class="idref" href="#name:14"><span class="id" title="variable">name</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> ⇒ <span class="id" title="notation">#</span> 0<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
.<br/>

<br/>
</div>

<div class="doc"><ol start="4" type="1">
<li>Immediate 16-bit values are encoded as-is.</li>
</ol>
<p>For example, the instruction <code>sub r0, r1, r2</code> will be
encoded as <code>000000000210004B</code>, which, in binary form, is:</p>
<pre><code>0000000000000000 0010 0001 0000 000 00 00001001011</code></pre>
<p>Let’s break it down:</p>
<pre><code>| 0000000000000000 -&gt; imm1
| 0000000000000000 -&gt; imm0
| 0000 -&gt; Dst1: R0 (4 bits, ignored)
| 0010 -&gt; Dst0: R2 (4 bits)
| 0001 -&gt; Src1: R1 (4 bits)
| 0000 -&gt; Src0: R0 (4 bits)
| 000 -&gt; Predicate: IfAlways (3 bits)
| 00 -&gt; Reserved (2 bits)
|  00001001011 -&gt; Opcode (11 bits)</code></pre>
<p>Another example: <code>sub stack=[r1+15], r2, stack+=[r3+63]</code>
is encoded as: <code>003f000f0321007d</code>, which, in binary form,
is:</p>
<pre><code>0000 0000 0011 1111 0000 0000 0000 1111 0000 0011 0010 0001 0000 0000 0111 1101</code></pre>
<p>Let’s break it down:</p>
<pre><code>| 0000 0000 0011 1111  -&gt; imm1: 63
| 0000 0000 0000 1111 -&gt; imm0: 15
| 0000 -&gt; dst1: R0 (4 bits, ignored)
| 0011 -&gt; dst0: R3 (4 bits)
| 0010 -&gt; src1: R2 (4 bits)
| 0001 -&gt;  src0: R1 (4 bits)
| 000 -&gt; Predicate: IfAlways (3 bits)
| 00 -&gt; Reserved (2 bits)
| 000 0111 1101 -&gt; Opcode (11 bits)</code></pre>
<p>Be careful with the big-endian byte order in multibyte numbers.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#EncodingTools"><span class="id" title="section">EncodingTools</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.encoding.GeneratedEncodeOpcode</h1>

<div class="code">
<span class="comment">(*&nbsp;GENERATED&nbsp;FILE,&nbsp;DO&nbsp;NOT&nbsp;EDIT&nbsp;MANUALLY.&nbsp;*)</span><br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">isa.Modifiers</span></a> <a class="idref" href="#"><span class="id" title="library">encoding.EncodingUtils</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">ZArith</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">GeneratedMachISA</span></a> <a class="idref" href="#"><span class="id" title="module">Modifiers</span></a> <a class="idref" href="#"><span class="id" title="module">encoding.EncodingUtils</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="OpcodeEncoderDefinition" class="idref" href="#OpcodeEncoderDefinition"><span class="id" title="section">OpcodeEncoderDefinition</span></a>.<br/>
<span class="id" title="keyword">Coercion</span> <a class="idref" href="#encode_dst_mode"><span class="id" title="definition">encode_dst_mode</span></a> <a class="idref" href="#encode_dst_mode"><span class="id" title="definition">:</span></a> <a class="idref" href="#encode_dst_mode"><span class="id" title="definition">dst_mode</span></a> <a class="idref" href="#encode_dst_mode"><span class="id" title="definition">>-></span></a> <a class="idref" href="#encode_dst_mode"><span class="id" title="definition">Z</span></a>.<br/>
<span class="id" title="keyword">Coercion</span> <a class="idref" href="#encode_src_mode"><span class="id" title="definition">encode_src_mode</span></a> <a class="idref" href="#encode_src_mode"><span class="id" title="definition">:</span></a> <a class="idref" href="#encode_src_mode"><span class="id" title="definition">src_mode</span></a> <a class="idref" href="#encode_src_mode"><span class="id" title="definition">>-></span></a> <a class="idref" href="#encode_src_mode"><span class="id" title="definition">Z</span></a>.<br/>
<span class="id" title="keyword">Coercion</span> <a class="idref" href="#encode_src_special_mode"><span class="id" title="definition">encode_src_special_mode</span></a> <a class="idref" href="#encode_src_special_mode"><span class="id" title="definition">:</span></a> <a class="idref" href="#encode_src_special_mode"><span class="id" title="definition">src_special_mode</span></a> <a class="idref" href="#encode_src_special_mode"><span class="id" title="definition">>-></span></a> <a class="idref" href="#encode_src_special_mode"><span class="id" title="definition">Z</span></a>.<br/>
<span class="id" title="keyword">Coercion</span> <a class="idref" href="#encode_swap"><span class="id" title="definition">encode_swap</span></a><a class="idref" href="#encode_swap"><span class="id" title="definition">:</span></a> <a class="idref" href="#encode_swap"><span class="id" title="definition">mod_swap</span></a> <a class="idref" href="#encode_swap"><span class="id" title="definition">>-></span></a> <a class="idref" href="#encode_swap"><span class="id" title="definition">Z</span></a>.<br/>
<span class="id" title="keyword">Coercion</span> <a class="idref" href="#encode_set_flags"><span class="id" title="definition">encode_set_flags</span></a> <a class="idref" href="#encode_set_flags"><span class="id" title="definition">:</span></a> <a class="idref" href="#encode_set_flags"><span class="id" title="definition">mod_set_flags</span></a> <a class="idref" href="#encode_set_flags"><span class="id" title="definition">>-></span></a> <a class="idref" href="#encode_set_flags"><span class="id" title="definition">Z</span></a>.<br/>
<span class="id" title="keyword">Coercion</span> <a class="idref" href="#Z.b2z"><span class="id" title="definition">Z.b2z</span></a><a class="idref" href="#Z.b2z"><span class="id" title="definition">:</span></a> <a class="idref" href="#Z.b2z"><span class="id" title="definition">bool</span></a> <a class="idref" href="#Z.b2z"><span class="id" title="definition">>-></span></a> <a class="idref" href="#Z.b2z"><span class="id" title="definition">Z</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="encode_opcode" class="idref" href="#encode_opcode"><span class="id" title="definition">encode_opcode</span></a> (<a id="op:1" class="idref" href="#op:1"><span class="id" title="binder">op</span></a>:<a class="idref" href="#mach_opcode"><span class="id" title="inductive">mach_opcode</span></a>) : <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := <br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#op:1"><span class="id" title="variable">op</span></a> <span class="id" title="keyword">with</span> <br/>
| <a class="idref" href="#OpInvalid"><span class="id" title="constructor">OpInvalid</span></a> ⇒ 0<br/>
| <a class="idref" href="#OpNoOp"><span class="id" title="constructor">OpNoOp</span></a> <span class="id" title="var">src</span> <span class="id" title="var">dst</span> ⇒ 1 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 4 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">dst</span><br/>
| <a class="idref" href="#OpAdd"><span class="id" title="constructor">OpAdd</span></a> <span class="id" title="var">src</span> <span class="id" title="var">dst</span> <span class="id" title="var">set_flags</span> ⇒ 25 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 8 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">dst</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">set_flags</span><br/>
| <a class="idref" href="#OpSub"><span class="id" title="constructor">OpSub</span></a> <span class="id" title="var">src</span> <span class="id" title="var">dst</span> <span class="id" title="var">swap</span> <span class="id" title="var">set_flags</span> ⇒ 73 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 16 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 4 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">dst</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">set_flags</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">swap</span><br/>
| <a class="idref" href="#OpMul"><span class="id" title="constructor">OpMul</span></a> <span class="id" title="var">src</span> <span class="id" title="var">dst</span> <span class="id" title="var">set_flags</span> ⇒ 169 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 8 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">dst</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">set_flags</span><br/>
| <a class="idref" href="#OpDiv"><span class="id" title="constructor">OpDiv</span></a> <span class="id" title="var">src</span> <span class="id" title="var">dst</span> <span class="id" title="var">swap</span> <span class="id" title="var">set_flags</span> ⇒ 217 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 16 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 4 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">dst</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">set_flags</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">swap</span><br/>
| <a class="idref" href="#OpJump"><span class="id" title="constructor">OpJump</span></a> <span class="id" title="var">src</span> ⇒ 313 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span><br/>
| <a class="idref" href="#OpXor"><span class="id" title="constructor">OpXor</span></a> <span class="id" title="var">src</span> <span class="id" title="var">dst</span> <span class="id" title="var">set_flags</span> ⇒ 319 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 8 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">dst</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">set_flags</span><br/>
| <a class="idref" href="#OpAnd"><span class="id" title="constructor">OpAnd</span></a> <span class="id" title="var">src</span> <span class="id" title="var">dst</span> <span class="id" title="var">set_flags</span> ⇒ 367 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 8 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">dst</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">set_flags</span><br/>
| <a class="idref" href="#OpOr"><span class="id" title="constructor">OpOr</span></a> <span class="id" title="var">src</span> <span class="id" title="var">dst</span> <span class="id" title="var">set_flags</span> ⇒ 415 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 8 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">dst</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">set_flags</span><br/>
| <a class="idref" href="#OpShl"><span class="id" title="constructor">OpShl</span></a> <span class="id" title="var">src</span> <span class="id" title="var">dst</span> <span class="id" title="var">swap</span> <span class="id" title="var">set_flags</span> ⇒ 463 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 16 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 4 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">dst</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">set_flags</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">swap</span><br/>
| <a class="idref" href="#OpShr"><span class="id" title="constructor">OpShr</span></a> <span class="id" title="var">src</span> <span class="id" title="var">dst</span> <span class="id" title="var">swap</span> <span class="id" title="var">set_flags</span> ⇒ 559 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 16 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 4 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">dst</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">set_flags</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">swap</span><br/>
| <a class="idref" href="#OpRol"><span class="id" title="constructor">OpRol</span></a> <span class="id" title="var">src</span> <span class="id" title="var">dst</span> <span class="id" title="var">swap</span> <span class="id" title="var">set_flags</span> ⇒ 655 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 16 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 4 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">dst</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">set_flags</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">swap</span><br/>
| <a class="idref" href="#OpRor"><span class="id" title="constructor">OpRor</span></a> <span class="id" title="var">src</span> <span class="id" title="var">dst</span> <span class="id" title="var">swap</span> <span class="id" title="var">set_flags</span> ⇒ 751 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 16 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 4 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">dst</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">set_flags</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">swap</span><br/>
| <a class="idref" href="#OpPtrAdd"><span class="id" title="constructor">OpPtrAdd</span></a> <span class="id" title="var">src</span> <span class="id" title="var">dst</span> <span class="id" title="var">swap</span> ⇒ 847 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 8 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">dst</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">swap</span><br/>
| <a class="idref" href="#OpPtrSub"><span class="id" title="constructor">OpPtrSub</span></a> <span class="id" title="var">src</span> <span class="id" title="var">dst</span> <span class="id" title="var">swap</span> ⇒ 895 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 8 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">dst</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">swap</span><br/>
| <a class="idref" href="#OpPtrPack"><span class="id" title="constructor">OpPtrPack</span></a> <span class="id" title="var">src</span> <span class="id" title="var">dst</span> <span class="id" title="var">swap</span> ⇒ 943 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 8 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">dst</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">swap</span><br/>
| <a class="idref" href="#OpPtrShrink"><span class="id" title="constructor">OpPtrShrink</span></a> <span class="id" title="var">src</span> <span class="id" title="var">dst</span> <span class="id" title="var">swap</span> ⇒ 991 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 8 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">dst</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">swap</span><br/>
| <a class="idref" href="#OpNearCall"><span class="id" title="constructor">OpNearCall</span></a> ⇒ 1039<br/>
| <a class="idref" href="#OpContractThis"><span class="id" title="constructor">OpContractThis</span></a> ⇒ 1040<br/>
| <a class="idref" href="#OpContractCaller"><span class="id" title="constructor">OpContractCaller</span></a> ⇒ 1041<br/>
| <a class="idref" href="#OpContractCodeAddress"><span class="id" title="constructor">OpContractCodeAddress</span></a> ⇒ 1042<br/>
| <a class="idref" href="#OpVMMeta"><span class="id" title="constructor">OpVMMeta</span></a> ⇒ 1043<br/>
| <a class="idref" href="#OpVMErgsLeft"><span class="id" title="constructor">OpVMErgsLeft</span></a> ⇒ 1044<br/>
| <a class="idref" href="#OpVMSp"><span class="id" title="constructor">OpVMSp</span></a> ⇒ 1045<br/>
| <a class="idref" href="#OpGetCapturedContext"><span class="id" title="constructor">OpGetCapturedContext</span></a> ⇒ 1046<br/>
| <a class="idref" href="#OpSetContextReg"><span class="id" title="constructor">OpSetContextReg</span></a> ⇒ 1047<br/>
| <a class="idref" href="#OpAuxMutating"><span class="id" title="constructor">OpAuxMutating</span></a> ⇒ 1048<br/>
| <a class="idref" href="#OpIncrementTxNumber"><span class="id" title="constructor">OpIncrementTxNumber</span></a> ⇒ 1049<br/>
| <a class="idref" href="#OpSLoad"><span class="id" title="constructor">OpSLoad</span></a> ⇒ 1050<br/>
| <a class="idref" href="#OpSStore"><span class="id" title="constructor">OpSStore</span></a> ⇒ 1051<br/>
| <a class="idref" href="#OpToL1Message"><span class="id" title="constructor">OpToL1Message</span></a> <span class="id" title="var">is_first</span> ⇒ 1052 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">is_first</span><br/>
| <a class="idref" href="#OpEvent"><span class="id" title="constructor">OpEvent</span></a> <span class="id" title="var">is_first</span> ⇒ 1054 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">is_first</span><br/>
| <a class="idref" href="#OpPrecompileCall"><span class="id" title="constructor">OpPrecompileCall</span></a> ⇒ 1056<br/>
| <a class="idref" href="#OpFarCall"><span class="id" title="constructor">OpFarCall</span></a> <span class="id" title="var">is_shard</span> <span class="id" title="var">is_static</span> ⇒ 1057 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">is_static</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">is_shard</span><br/>
| <a class="idref" href="#OpDelegateCall"><span class="id" title="constructor">OpDelegateCall</span></a> <span class="id" title="var">is_shard</span> <span class="id" title="var">is_static</span> ⇒ 1061 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">is_static</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">is_shard</span><br/>
| <a class="idref" href="#OpMimicCall"><span class="id" title="constructor">OpMimicCall</span></a> <span class="id" title="var">is_shard</span> <span class="id" title="var">is_static</span> ⇒ 1065 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">is_static</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">is_shard</span><br/>
| <a class="idref" href="#OpRet"><span class="id" title="constructor">OpRet</span></a> <span class="id" title="var">to_label</span> ⇒ 1069 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">to_label</span><br/>
| <a class="idref" href="#OpRevert"><span class="id" title="constructor">OpRevert</span></a> <span class="id" title="var">to_label</span> ⇒ 1071 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">to_label</span><br/>
| <a class="idref" href="#OpPanic"><span class="id" title="constructor">OpPanic</span></a> <span class="id" title="var">to_label</span> ⇒ 1073 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">to_label</span><br/>
| <a class="idref" href="#OpLoadHeap"><span class="id" title="constructor">OpLoadHeap</span></a> <span class="id" title="var">src</span> <span class="id" title="var">inc</span> ⇒ 1075 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 10 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">inc</span><br/>
| <a class="idref" href="#OpStoreHeap"><span class="id" title="constructor">OpStoreHeap</span></a> <span class="id" title="var">src</span> <span class="id" title="var">inc</span> ⇒ 1077 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 10 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">inc</span><br/>
| <a class="idref" href="#OpLoadAuxHeap"><span class="id" title="constructor">OpLoadAuxHeap</span></a> <span class="id" title="var">src</span> <span class="id" title="var">inc</span> ⇒ 1079 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 10 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">inc</span><br/>
| <a class="idref" href="#OpStoreAuxHeap"><span class="id" title="constructor">OpStoreAuxHeap</span></a> <span class="id" title="var">src</span> <span class="id" title="var">inc</span> ⇒ 1081 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 10 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">inc</span><br/>
| <a class="idref" href="#OpLoadPtr"><span class="id" title="constructor">OpLoadPtr</span></a> <span class="id" title="var">inc</span> ⇒ 1083 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">inc</span><br/>
| <a class="idref" href="#OpDecommit"><span class="id" title="constructor">OpDecommit</span></a> ⇒ 1093<br/>
| <a class="idref" href="#OpTransientLoad"><span class="id" title="constructor">OpTransientLoad</span></a> ⇒ 1094<br/>
| <a class="idref" href="#OpTransientStore"><span class="id" title="constructor">OpTransientStore</span></a> ⇒ 1095<br/>
| <a class="idref" href="#OpStaticRead"><span class="id" title="constructor">OpStaticRead</span></a> <span class="id" title="var">src</span> <span class="id" title="var">inc</span> ⇒ 1096 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">inc</span><br/>
| <a class="idref" href="#OpStaticWrite"><span class="id" title="constructor">OpStaticWrite</span></a> <span class="id" title="var">src</span> <span class="id" title="var">inc</span> ⇒ 1100 <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="#d3ea1afb7d81263dc23c4eb0da2a3c4e"><span class="id" title="notation">×</span></a> <span class="id" title="var">src</span> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">inc</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#OpcodeEncoderDefinition"><span class="id" title="section">OpcodeEncoderDefinition</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.encoding.Encoder</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">RecordSet</span>.<br/>
<span class="id" title="keyword">Require</span><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">isa.Modifiers</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">isa.GeneratedMachISA</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">isa.AssemblyToMach</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">encoding.EncodingUtils</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="#"><span class="id" title="library">encoding.GeneratedEncodeOpcode</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="MachEncoder" class="idref" href="#MachEncoder"><span class="id" title="section">MachEncoder</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">ZArith</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Assembly</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">GeneratedMachISA</span></a> <a class="idref" href="#"><span class="id" title="module">GeneratedEncodeOpcode</span></a> <a class="idref" href="#"><span class="id" title="module">isa.AssemblyToMach</span></a> <a class="idref" href="#"><span class="id" title="module">Predication</span></a> <a class="idref" href="#"><span class="id" title="module">EncodingUtils</span></a>.<br/>

<br/>
</div>

<div class="doc"><h1 id="encoding-machine-instructions">Encoding machine
instructions</h1>
<p>For an overview of instruction sets and different layers of
instructions definitions, used in this specification, refer to <span
class="inlinecode"><a class="idref" href="#InstructionSets"><span
class="id" title="section">InstructionSets</span></a></span>.</p>
<p>The binary encoding is defined for <span
class="inlinecode"><a class="idref" href="#mach_instruction"><span
class="id" title="record">mach_instruction</span></a></span>, which is a
representation of an EraVM instruction aware of its encoding and layout.
Once the <span
class="inlinecode"><a class="idref" href="#asm_instruction"><span
class="id" title="inductive">asm_instruction</span></a></span> has been
transformed into <span
class="inlinecode"><a class="idref" href="#mach_instruction"><span
class="id" title="record">mach_instruction</span></a></span> via <span
class="inlinecode"><a class="idref" href="#asm_to_mach"><span
class="id" title="definition">asm_to_mach</span></a></span>, it is
trivial to put all of <span
class="inlinecode"><a class="idref" href="#mach_instruction"><span
class="id" title="record">mach_instruction</span></a></span>’s fields in
binary form via <span
class="inlinecode"><a class="idref" href="#encode_mach_instruction"><span
class="id"
title="definition">encode_mach_instruction</span></a></span>.</p>
<p>Reminder: <code>##</code> notation stands for concatenating binary
strings; <code>a ## b</code> signifies that <code>b</code> holds less
significant bits and <code>a</code> is prepended to it, forming a more
significant part.</p>
</div>
<div class="code">
<br/>
<span class="id" title="keyword">Definition</span> <a id="encode_mach_instruction" class="idref" href="#encode_mach_instruction"><span class="id" title="definition">encode_mach_instruction</span></a> (<a id="i:1" class="idref" href="#i:1"><span class="id" title="binder">i</span></a>:@<a class="idref" href="#mach_instruction"><span class="id" title="record">mach_instruction</span></a> <a class="idref" href="#reg_name"><span class="id" title="inductive">GPR.reg_name</span></a> <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a>) : <span class="id" title="definition">BITS</span> 64 :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#i:1"><span class="id" title="variable">i</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="#mk_ins"><span class="id" title="constructor">mk_ins</span></a> <a class="idref" href="#op_code"><span class="id" title="projection">op_code</span></a> <a class="idref" href="#op_predicate"><span class="id" title="projection">op_predicate</span></a> <a class="idref" href="#op_src0"><span class="id" title="projection">op_src0</span></a> <a class="idref" href="#op_src1"><span class="id" title="projection">op_src1</span></a> <a class="idref" href="#op_dst0"><span class="id" title="projection">op_dst0</span></a> <a class="idref" href="#op_dst1"><span class="id" title="projection">op_dst1</span></a> <a class="idref" href="#op_imm0"><span class="id" title="projection">op_imm0</span></a> <a class="idref" href="#op_imm1"><span class="id" title="projection">op_imm1</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="reserved2:3" class="idref" href="#reserved2:3"><span class="id" title="binder">reserved2</span></a> := @<span class="id" title="definition">fromNat</span> 2 0 <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">op_imm1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">##</span> <span class="id" title="var">op_imm0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">##</span> <a class="idref" href="#encode_reg"><span class="id" title="definition">encode_reg</span></a> <span class="id" title="var">op_dst1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">##</span> <a class="idref" href="#encode_reg"><span class="id" title="definition">encode_reg</span></a> <span class="id" title="var">op_dst0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">##</span> <a class="idref" href="#encode_reg"><span class="id" title="definition">encode_reg</span></a> <span class="id" title="var">op_src1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">##</span> <a class="idref" href="#encode_reg"><span class="id" title="definition">encode_reg</span></a> <span class="id" title="var">op_src0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">##</span> <a class="idref" href="#encode_predicate"><span class="id" title="definition">encode_predicate</span></a> <span class="id" title="var">op_predicate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">##</span> <a class="idref" href="#reserved2:3"><span class="id" title="variable">reserved2</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">##</span> @<span class="id" title="definition">fromZ</span> 11 (<a class="idref" href="#encode_opcode"><span class="id" title="definition">encode_opcode</span></a> <span class="id" title="var">op_code</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="encode_asm" class="idref" href="#encode_asm"><span class="id" title="definition">encode_asm</span></a> (<a id="i:4" class="idref" href="#i:4"><span class="id" title="binder">i</span></a>:<a class="idref" href="#predicated"><span class="id" title="record">predicated</span></a> <a class="idref" href="#asm_instruction"><span class="id" title="inductive">asm_instruction</span></a>) : <a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (<span class="id" title="definition">BITS</span> 64) :=<br/>
&nbsp;&nbsp;<a class="idref" href="#option_map"><span class="id" title="definition">option_map</span></a> <a class="idref" href="#encode_mach_instruction"><span class="id" title="definition">encode_mach_instruction</span></a> (<a class="idref" href="#asm_to_mach"><span class="id" title="definition">asm_to_mach</span></a> <a class="idref" href="#i:4"><span class="id" title="variable">i</span></a>)<br/>
.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#MachEncoder"><span class="id" title="section">MachEncoder</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.Bootloader</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">memory.Depot</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">memory.Depot</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Bootloader" class="idref" href="#Bootloader"><span class="id" title="section">Bootloader</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">ZArith</span></a> <span class="id" title="module">spec</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z</span>.<br/>
</div>

<div class="doc"><h1 id="bootloader">Bootloader</h1>
<p>Bootloader is a system contract in charge of block construction (<a
href="https://github.com/matter-labs/system-contracts/blob/main/bootloader/bootloader.yul">sources</a>).</p>
<p>Formally, bootloader is assigned an address <span
class="inlinecode"><a class="idref" href="#BOOTLOADER_SYSTEM_CONTRACT_ADDRESS"><span
class="id"
title="definition">BOOTLOADER_SYSTEM_CONTRACT_ADDRESS</span></a></span>,
but on execution start EraVM decommits its code directly by its <span
class="inlinecode"><a class="idref" href="#versioned_hash"><span
class="id" title="record">versioned_hash</span></a></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="BOOTLOADER_SYSTEM_CONTRACT_ADDRESS" class="idref" href="#BOOTLOADER_SYSTEM_CONTRACT_ADDRESS"><span class="id" title="definition">BOOTLOADER_SYSTEM_CONTRACT_ADDRESS</span></a> : <a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a> := <span class="id" title="definition">fromZ</span> (<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">(</span></a>2<a class="idref" href="#14ef112b66e341f773bd1e9d05816f43"><span class="id" title="notation">^</span></a>15<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">)</span></a> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1).<br/>

<br/>
</div>

<div class="doc"><p>Using the bootloader <span
class="inlinecode"><a class="idref" href="#versioned_hash"><span
class="id" title="record">versioned_hash</span></a></span>, EraVM
queries the bootloader code from decommitter and starts executing
it.</p>
<p>The heap page of the bootloader is different from other pages: it
acts as an interface between server and EraVM. Server is able to modify
the contents of this page at will. Server gradually fills it with
transaction data, formatted according to an implementation-defined
convention.</p>
<p>The bootloader then acts roughly as the following code (not an actual
implementation):</p>
<pre class="solidity"><code>contract Bootloader {
    function executeBlock(
        address operatorAddress,
      Transaction[2] memory transactions
    ) {
     for(uint i = 0; i &lt; transactions.length; i++) {
        validateTransaction(transactions[i]);
        chargeFee(operatorAddress, transactions[i]);
        executeTransaction(transactions[i]);
     }
  }

    function validateTransaction(Transaction memory tx) {
    // validation logic
    }
  function chargeFee(address operatorAddress, Transaction memory tx) {
    // charge fee
    }
  function executeTransaction(Transaction memory tx) {
    // execution logic
  }
}</code></pre>
<p>The bootloader is therefore responsible for:</p>
<ul>
<li>validating transactions;</li>
<li>executing transactions to form a new block;</li>
<li>setting some of the transaction- or block-wide transaction
parameters (e.g. blockhash, tx.origin).</li>
</ul>
<p>Server makes a snapshot of EraVM state after completing every
transaction. When the bootloader encounters a malformed transaction, it
fails, and the server restarts EraVM from the most recent snapshot,
skipping this transaction. If a transaction is well-formed, EraVM may
still panic while handling it outside the bootloader code. This is a
normal situation and is handled by EraVM in a regular way, through
panics. See e.g. <span
class="inlinecode"><a class="idref" href="#OpPanic"><span
class="id" title="constructor">OpPanic</span></a></span>.</p>
<p>The exact code of the bootloader is a part of a protocol; its <span
class="inlinecode"><a class="idref" href="#versioned_hash"><span
class="id" title="record">versioned_hash</span></a></span> is included
in the block header.</p>
</div>
<div class="code">
<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Bootloader"><span class="id" title="section">Bootloader</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.Precompiles</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">memory.Depot</span></a> <a class="idref" href="#"><span class="id" title="library">ABI</span></a> <a class="idref" href="#"><span class="id" title="library">State</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">ABI</span></a> <a class="idref" href="#"><span class="id" title="module">memory.Depot</span></a> <a class="idref" href="#"><span class="id" title="module">State</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Precompiles" class="idref" href="#Precompiles"><span class="id" title="section">Precompiles</span></a>.<br/>
</div>

<div class="doc"><h1 id="precompiles">Precompiles</h1>
<p>Precompiles are extensions of VM bound to one of the system
contracts. When this contract executes an instruction <span
class="inlinecode"><a class="idref" href="#OpPrecompileCall"><span
class="id" title="constructor">OpPrecompileCall</span></a></span>, VM
executes an algorithm specific to this contract.</p>
<p>This requires preparing data for the precompiled algorithm in a
special, algorithm-dependent way.</p>
<p>Precompiles are able to change <span
class="inlinecode"><a class="idref" href="#data_page"><span
class="id" title="definition">data_page</span></a></span>s.</p>
<p>Precompiles may fail.</p>
<p>Precompiles are not revertable; their functioning is not affected by
rollbacks.</p>
<p>Currently we formalize precompiles as a black box.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Parameter</span> <a id="precompile_processor" class="idref" href="#precompile_processor"><span class="id" title="axiom">precompile_processor</span></a> : <a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#params"><span class="id" title="record">PrecompileParametersABI.params</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#transient_state"><span class="id" title="record">transient_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#transient_state"><span class="id" title="record">transient_state</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Precompiles"><span class="id" title="section">Precompiles</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.VersionedHash</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Coder</span></a> <a class="idref" href="#"><span class="id" title="library">PrimitiveValue</span></a> <a class="idref" href="#"><span class="id" title="library">TransientMemory</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="VersionedHash" class="idref" href="#VersionedHash"><span class="id" title="section">VersionedHash</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">ZArith</span></a> <span class="id" title="module">ssrbool</span> <span class="id" title="module">eqtype</span> <span class="id" title="module">ssreflect</span> <span class="id" title="module">ssrfun</span> <span class="id" title="module">ssrbool</span> <span class="id" title="module">ssreflect.eqtype</span> <span class="id" title="module">ssreflect.tuple</span> <span class="id" title="module">zmodp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Coder</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="word:1" class="idref" href="#word:1"><span class="id" title="binder">word</span></a>: <span class="id" title="keyword">Type</span>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="ins_type:2" class="idref" href="#ins_type:2"><span class="id" title="binder">ins_type</span></a>: <span class="id" title="keyword">Type</span>} (<a id="invalid_ins:3" class="idref" href="#invalid_ins:3"><span class="id" title="binder">invalid_ins</span></a>: <a class="idref" href="#ins_type:2"><span class="id" title="variable">ins_type</span></a>).<br/>

<br/>
</div>

<div class="doc"><h1 id="versioned-hash">Versioned hash</h1>
<p><span
class="inlinecode"><a class="idref" href="#versioned_hash"><span
class="id" title="record">versioned_hash</span></a></span> is a hash
augmented with additional information. It is used as a key to identify
the contract code for decommitter.</p>
<p>Additional information includes:</p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#VERSION_BYTE"><span
class="id" title="definition">VERSION_BYTE</span></a></span> (currently
1)</li>
<li><span
class="inlinecode"><a class="idref" href="#marker"><span
class="id" title="inductive">marker</span></a></span> (is the contract
being constructed or already constructed?)</li>
</ul>
<p>The hash itself is described by <span
class="inlinecode"><a class="idref" href="#partial_hash"><span
class="id" title="projection">partial_hash</span></a></span>; it is
computed as SHA256 hash modulo <span class="math inline">2^{28 \times
8}</span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="VERSION_BYTE" class="idref" href="#VERSION_BYTE"><span class="id" title="definition">VERSION_BYTE</span></a>: <a class="idref" href="#u8"><span class="id" title="definition">u8</span></a> := <span class="id" title="definition">fromZ</span> 1%<span class="id" title="var">Z</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="marker" class="idref" href="#marker"><span class="id" title="inductive">marker</span></a> := <a id="CODE_AT_REST" class="idref" href="#CODE_AT_REST"><span class="id" title="constructor">CODE_AT_REST</span></a> | <a id="YET_CONSTRUCTED" class="idref" href="#YET_CONSTRUCTED"><span class="id" title="constructor">YET_CONSTRUCTED</span></a> | <a id="INVALID" class="idref" href="#INVALID"><span class="id" title="constructor">INVALID</span></a>.<br/>

<br/>
</div>
<details><summary>decidable equality </summary><div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Scheme</span> <span class="id" title="var">Equality</span> <span class="id" title="keyword">for</span> <a class="idref" href="#marker"><span class="id" title="inductive">marker</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="marker_eqP" class="idref" href="#marker_eqP"><span class="id" title="lemma">marker_eqP</span></a> : <span class="id" title="definition">Equality.axiom</span> <a class="idref" href="#marker_beq"><span class="id" title="definition">marker_beq</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">move</span> ⇒ [] []; <span class="id" title="tactic">constructor</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Canonical</span> <a id="marker_eqMixin" class="idref" href="#marker_eqMixin"><span class="id" title="definition">marker_eqMixin</span></a> := <span class="id" title="abbreviation">EqMixin</span> <a class="idref" href="#marker_eqP"><span class="id" title="lemma">marker_eqP</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Canonical</span> <a id="marker_eqType" class="idref" href="#marker_eqType"><span class="id" title="definition">marker_eqType</span></a> := <span class="id" title="keyword">Eval</span> <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="abbreviation">EqType</span> <a class="idref" href="#marker"><span class="id" title="inductive">marker</span></a> <a class="idref" href="#marker_eqMixin"><span class="id" title="definition">marker_eqMixin</span></a>.<br/>
</div>
</details><div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="marker_valid" class="idref" href="#marker_valid"><span class="id" title="definition">marker_valid</span></a> (<a id="m:6" class="idref" href="#m:6"><span class="id" title="binder">m</span></a>: <a class="idref" href="#marker"><span class="id" title="inductive">marker</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#m:6"><span class="id" title="variable">m</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#INVALID"><span class="id" title="constructor">INVALID</span></a> ⇒ <a class="idref" href="#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <a class="idref" href="#true"><span class="id" title="constructor">true</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="versioned_hash" class="idref" href="#versioned_hash"><span class="id" title="record">versioned_hash</span></a> := <span class="id" title="var">mk_vhash</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="code_length_in_words" class="idref" href="#code_length_in_words"><span class="id" title="projection">code_length_in_words</span></a>: <a class="idref" href="#u16"><span class="id" title="definition">u16</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="extra_marker" class="idref" href="#extra_marker"><span class="id" title="projection">extra_marker</span></a>: <a class="idref" href="#marker"><span class="id" title="inductive">marker</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="partial_hash" class="idref" href="#partial_hash"><span class="id" title="projection">partial_hash</span></a>: <span class="id" title="definition">BITS</span> (28<span class="id" title="notation">×</span><a class="idref" href="#bits_in_byte"><span class="id" title="definition">bits_in_byte</span></a>)%<span class="id" title="var">nat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="hash_coder" class="idref" href="#hash_coder"><span class="id" title="axiom">hash_coder</span></a>: @<a class="idref" href="#coder"><span class="id" title="record">Coder.coder</span></a> <a class="idref" href="#VersionedHash.word"><span class="id" title="variable">word</span></a> <a class="idref" href="#versioned_hash"><span class="id" title="record">versioned_hash</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>EraVM accepts <span
class="inlinecode"><a class="idref" href="#DEFAULT_AA_VHASH"><span
class="id" title="axiom">DEFAULT_AA_VHASH</span></a></span> as a
parameter. See also <span class="inlinecode"><span class="id"
title="keyword">Parameters</span></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Parameter</span> <a id="DEFAULT_AA_VHASH" class="idref" href="#DEFAULT_AA_VHASH"><span class="id" title="axiom">DEFAULT_AA_VHASH</span></a>: <a class="idref" href="#versioned_hash"><span class="id" title="record">versioned_hash</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
</div>
<details><summary>equality on versioned hashes </summary><div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="eqn" class="idref" href="#eqn"><span class="id" title="definition">eqn</span></a> (<a id="x:14" class="idref" href="#x:14"><span class="id" title="binder">x</span></a> <a id="y:15" class="idref" href="#y:15"><span class="id" title="binder">y</span></a>:<a class="idref" href="#versioned_hash"><span class="id" title="record">versioned_hash</span></a>) : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="#x:14"><span class="id" title="variable">x</span></a>,<a class="idref" href="#y:15"><span class="id" title="variable">y</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="#mk_vhash"><span class="id" title="constructor">mk_vhash</span></a> <span class="id" title="var">l1</span> <span class="id" title="var">em1</span> <span class="id" title="var">ph1</span> , <a class="idref" href="#mk_vhash"><span class="id" title="constructor">mk_vhash</span></a> <span class="id" title="var">l2</span> <span class="id" title="var">em2</span> <span class="id" title="var">ph2</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><span class="id" title="var">l1</span> <span class="id" title="notation">==</span> <span class="id" title="var">l2</span><a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><span class="id" title="var">em1</span> <span class="id" title="notation">==</span> <span class="id" title="var">em2</span><a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">&&</span></a> <a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">(</span></a><span class="id" title="var">ph1</span> <span class="id" title="notation">==</span> <span class="id" title="var">ph2</span><a class="idref" href="#::bool_scope:x_'&&'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="eqnP" class="idref" href="#eqnP"><span class="id" title="lemma">eqnP</span></a> : <span class="id" title="definition">Equality.axiom</span> <a class="idref" href="#eqn"><span class="id" title="definition">eqn</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">move</span> ⇒ [<span class="id" title="var">l1</span> <span class="id" title="var">em1</span> <span class="id" title="var">ph1</span>] [<span class="id" title="var">l2</span> <span class="id" title="var">em2</span> <span class="id" title="var">ph2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">l1</span> <span class="id" title="notation">==</span> <span class="id" title="var">l2</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">H1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">em1</span> <span class="id" title="notation">==</span> <span class="id" title="var">em2</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">H2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">ph1</span> <span class="id" title="notation">==</span> <span class="id" title="var">ph2</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">H3</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">move</span>: (<span class="id" title="lemma">eqP</span> <span class="id" title="var">H1</span>) ⇒ ->; <span class="id" title="tactic">try</span> <span class="id" title="tactic">move</span>: (<span class="id" title="lemma">eqP</span> <span class="id" title="var">H2</span>) ⇒ ->; <span class="id" title="tactic">try</span> <span class="id" title="tactic">move</span>: (<span class="id" title="lemma">eqP</span> <span class="id" title="var">H3</span>) ⇒ ->; <span class="id" title="tactic">constructor</span> =>//.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">injection</span>. <span class="id" title="tactic">move</span> ⇒ ?; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">eq_refl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">injection</span>. <span class="id" title="tactic">move</span> ⇒ ?; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">eq_refl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">injection</span>. <span class="id" title="tactic">move</span> ⇒ ?; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">eq_refl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">injection</span>. <span class="id" title="tactic">move</span> ⇒ ?; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">eq_refl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">injection</span>. <span class="id" title="tactic">move</span> ⇒ ?; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">eq_refl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">injection</span>. <span class="id" title="tactic">move</span> ⇒ ?; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">eq_refl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">injection</span>. <span class="id" title="tactic">move</span> ⇒ ?; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">eq_refl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Canonical</span> <a id="vh_eqMixin" class="idref" href="#vh_eqMixin"><span class="id" title="definition">vh_eqMixin</span></a> := <span class="id" title="abbreviation">EqMixin</span> <a class="idref" href="#eqnP"><span class="id" title="lemma">eqnP</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Canonical</span> <a id="vh_eqType" class="idref" href="#vh_eqType"><span class="id" title="definition">vh_eqType</span></a> := <span class="id" title="keyword">Eval</span> <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="abbreviation">EqType</span> <span class="id" title="var">_</span> <a class="idref" href="#vh_eqMixin"><span class="id" title="definition">vh_eqMixin</span></a>.<br/>

<br/>
</div>
</details><div class="code">
<span class="id" title="keyword">End</span> <a class="idref" href="#VersionedHash"><span class="id" title="section">VersionedHash</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.Decommitter</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Common</span></a> <a class="idref" href="#"><span class="id" title="library">ABI</span></a> <a class="idref" href="#"><span class="id" title="library">lib.Decidability</span></a> <a class="idref" href="#"><span class="id" title="library">History</span></a> <a class="idref" href="#"><span class="id" title="library">memory.Depot</span></a> <a class="idref" href="#"><span class="id" title="library">MemoryOps</span></a> <a class="idref" href="#"><span class="id" title="library">VersionedHash</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Coder</span></a> <a class="idref" href="#"><span class="id" title="module">Core</span></a> <a class="idref" href="#"><span class="id" title="module">History</span></a> <a class="idref" href="#"><span class="id" title="module">VersionedHash</span></a> <a class="idref" href="#"><span class="id" title="module">Common</span></a> <a class="idref" href="#"><span class="id" title="module">Decidability</span></a> <a class="idref" href="#"><span class="id" title="module">Ergs</span></a> <a class="idref" href="#"><span class="id" title="module">MemoryBase</span></a> <a class="idref" href="#"><span class="id" title="module">memory.Depot</span></a> <a class="idref" href="#"><span class="id" title="module">TransientMemory</span></a> <a class="idref" href="#"><span class="id" title="module">ZArith</span></a> <a class="idref" href="#"><span class="id" title="module">ABI</span></a> <span class="id" title="module">bits</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Decommitter" class="idref" href="#Decommitter"><span class="id" title="section">Decommitter</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>
</div>

<div class="doc"><h1 id="decommitter">Decommitter</h1>
<p>Decommitter is a module external to EraVM, a key-value storage
where:</p>
<ul>
<li>key is <span
class="inlinecode"><a class="idref" href="#versioned_hash"><span
class="id" title="record">versioned_hash</span></a></span></li>
<li>value is the contract code</li>
</ul>
<p><strong>Decommitting</strong> refers to querying contract code from
the decommitter and filling new <span
class="inlinecode"><a class="idref" href="#code_page"><span
class="id" title="definition">code_page</span></a></span> and <span
class="inlinecode"><a class="idref" href="#const_page"><span
class="id" title="definition">const_page</span></a></span> with it. The
rest of the code page is filled with invalid instructions; the rest of
const page is filled with zeros.</p>
<p>The mapping <span
class="inlinecode"><a class="idref" href="#code_hash_location"><span
class="id" title="definition">code_hash_location</span></a></span>
between contract addresses and the hashes of their codes is implemented
by the storage of the contract <span
class="inlinecode"><a class="idref" href="#DEPLOYER_SYSTEM_CONTRACT_ADDRESS"><span
class="id"
title="definition">DEPLOYER_SYSTEM_CONTRACT_ADDRESS</span></a></span>.</p>
<p>Note: storage with the same contract address may differ between
shards.</p>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="DEPLOYER_SYSTEM_CONTRACT_ADDRESS" class="idref" href="#DEPLOYER_SYSTEM_CONTRACT_ADDRESS"><span class="id" title="definition">DEPLOYER_SYSTEM_CONTRACT_ADDRESS</span></a> : <a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a> := <span class="id" title="definition">fromZ</span> (<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">(</span></a>2<a class="idref" href="#14ef112b66e341f773bd1e9d05816f43"><span class="id" title="notation">^</span></a>15<a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">)</span></a> <a class="idref" href="#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 2).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="code_hash_location" class="idref" href="#code_hash_location"><span class="id" title="definition">code_hash_location</span></a> (<a id="for_contract:1" class="idref" href="#for_contract:1"><span class="id" title="binder">for_contract</span></a>: <a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a>) (<a id="sid:2" class="idref" href="#sid:2"><span class="id" title="binder">sid</span></a>:<a class="idref" href="#shard_id"><span class="id" title="definition">Depot.shard_id</span></a>): <a class="idref" href="#fqa_key"><span class="id" title="record">fqa_key</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#mk_fqa_key"><span class="id" title="constructor">mk_fqa_key</span></a> (<a class="idref" href="#mk_fqa_storage"><span class="id" title="constructor">mk_fqa_storage</span></a> <a class="idref" href="#sid:2"><span class="id" title="variable">sid</span></a> <a class="idref" href="#DEPLOYER_SYSTEM_CONTRACT_ADDRESS"><span class="id" title="definition">DEPLOYER_SYSTEM_CONTRACT_ADDRESS</span></a>) (<a class="idref" href="#widen"><span class="id" title="definition">widen</span></a> <a class="idref" href="#word_bits"><span class="id" title="definition">word_bits</span></a> <a class="idref" href="#for_contract:1"><span class="id" title="variable">for_contract</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="ins_type:3" class="idref" href="#ins_type:3"><span class="id" title="binder">ins_type</span></a>: <span class="id" title="keyword">Type</span>} (<a id="invalid_ins:4" class="idref" href="#invalid_ins:4"><span class="id" title="binder">invalid_ins</span></a>: <a class="idref" href="#ins_type:3"><span class="id" title="variable">ins_type</span></a>) (<a id="code_page:5" class="idref" href="#code_page:5"><span class="id" title="binder">code_page</span></a> := <a class="idref" href="#code_page"><span class="id" title="record">code_page</span></a> <a class="idref" href="#invalid_ins:4"><span class="id" title="variable">invalid_ins</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="empty_code:6" class="idref" href="#empty_code:6"><span class="id" title="binder">empty_code</span></a> : <a class="idref" href="#code_page:5"><span class="id" title="variable">code_page</span></a> := @<a class="idref" href="#mk_code_page"><span class="id" title="constructor">mk_code_page</span></a> <span class="id" title="var">_</span> <a class="idref" href="#invalid_ins:4"><span class="id" title="variable">invalid_ins</span></a> (<a class="idref" href="#empty"><span class="id" title="definition">empty</span></a> <span class="id" title="var">_</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="empty_const:7" class="idref" href="#empty_const:7"><span class="id" title="binder">empty_const</span></a>: <a class="idref" href="#const_page"><span class="id" title="definition">const_page</span></a> := (<a class="idref" href="#empty"><span class="id" title="definition">empty</span></a> <span class="id" title="var">_</span> )).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="code_storage_params" class="idref" href="#code_storage_params"><span class="id" title="definition">code_storage_params</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#addressable_block"><span class="id" title="projection">addressable_block</span></a> := <a class="idref" href="#Decommitter.code_page"><span class="id" title="variable">code_page</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#const_page"><span class="id" title="definition">const_page</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#address_bits"><span class="id" title="projection">address_bits</span></a> := 256;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#default_value"><span class="id" title="projection">default_value</span></a> := <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#Decommitter.empty_code"><span class="id" title="variable">empty_code</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#Decommitter.empty_const"><span class="id" title="variable">empty_const</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#writable"><span class="id" title="projection">writable</span></a> := <a class="idref" href="#false"><span class="id" title="constructor">false</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="code_storage" class="idref" href="#code_storage"><span class="id" title="definition">code_storage</span></a>: <span class="id" title="keyword">Type</span> := <a class="idref" href="#mem_parameterized"><span class="id" title="record">mem_parameterized</span></a> <a class="idref" href="#code_storage_params"><span class="id" title="definition">code_storage_params</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">VersionedHash</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="decommitter" class="idref" href="#decommitter"><span class="id" title="record">decommitter</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mk_code_mgr</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="cm_storage" class="idref" href="#cm_storage"><span class="id" title="projection">cm_storage</span></a>: <a class="idref" href="#code_storage"><span class="id" title="definition">code_storage</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="cm_accessed" class="idref" href="#cm_accessed"><span class="id" title="projection">cm_accessed</span></a>: <a class="idref" href="#history"><span class="id" title="definition">history</span></a> <a class="idref" href="#vh_eqType"><span class="id" title="definition">vh_eqType</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
</div>

<div class="doc"><p>The versioned hash is called <strong>cold</strong> if it was not
accessed during construction of the current block. Otherwise, it is
<strong>warm</strong>. See <span
class="inlinecode"><a class="idref" href="#is_first_access"><span
class="id" title="definition">is_first_access</span></a></span>.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="is_first_access" class="idref" href="#is_first_access"><span class="id" title="definition">is_first_access</span></a> <a id="cm:11" class="idref" href="#cm:11"><span class="id" title="binder">cm</span></a> <a id="vh:12" class="idref" href="#vh:12"><span class="id" title="binder">vh</span></a> := <a class="idref" href="#negb"><span class="id" title="definition">negb</span></a> (<a class="idref" href="#contains"><span class="id" title="definition">contains</span></a> <span class="id" title="var">_</span> (<a class="idref" href="#cm_accessed"><span class="id" title="projection">cm_accessed</span></a> <a class="idref" href="#cm:11"><span class="id" title="variable">cm</span></a>) <a class="idref" href="#vh:12"><span class="id" title="variable">vh</span></a>).<br/>

<br/>
</div>

<div class="doc"><p>Decommitting code by a cold versioned hash costs (<span
class="inlinecode"><a class="idref" href="#ERGS_PER_CODE_WORD_DECOMMITTMENT"><span
class="id"
title="definition">ERGS_PER_CODE_WORD_DECOMMITTMENT</span></a></span> *
(block size in words)) ergs. Decommitting warm code is free.</p>
</div>
<div class="code">
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="decommitment_cost" class="idref" href="#decommitment_cost"><span class="id" title="inductive">decommitment_cost</span></a> (<a id="cm:13" class="idref" href="#cm:13"><span class="id" title="binder">cm</span></a>:<a class="idref" href="#decommitter"><span class="id" title="record">decommitter</span></a>) <a id="vhash:14" class="idref" href="#vhash:14"><span class="id" title="binder">vhash</span></a> (<a id="code_length_in_words:15" class="idref" href="#code_length_in_words:15"><span class="id" title="binder">code_length_in_words</span></a>: <a class="idref" href="#code_length"><span class="id" title="definition">code_length</span></a>): <a class="idref" href="#ergs"><span class="id" title="definition">ergs</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;|<a id="dc_fresh" class="idref" href="#dc_fresh"><span class="id" title="constructor">dc_fresh</span></a>: <span class="id" title="keyword">∀</span> <a id="bigcost:18" class="idref" href="#bigcost:18"><span class="id" title="binder">bigcost</span></a> <a id="cost:19" class="idref" href="#cost:19"><span class="id" title="binder">cost</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#is_first_access"><span class="id" title="definition">is_first_access</span></a> <a class="idref" href="#cm:13"><span class="id" title="variable">cm</span></a> <a class="idref" href="#vhash:14"><span class="id" title="variable">vhash</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a><a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bigcost:18"><span class="id" title="variable">bigcost</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#ergs_of"><span class="id" title="definition">ergs_of</span></a> <a class="idref" href="#ERGS_PER_CODE_WORD_DECOMMITTMENT"><span class="id" title="definition">Ergs.ERGS_PER_CODE_WORD_DECOMMITTMENT</span></a> <a class="idref" href="#a2b4273a2140deed386b9215048ca773"><span class="id" title="notation">×</span></a> <a class="idref" href="#a2b4273a2140deed386b9215048ca773"><span class="id" title="notation">(</span></a><span class="id" title="definition">zeroExtend</span> (<a class="idref" href="#ergs_bits"><span class="id" title="definition">ergs_bits</span></a> <span class="id" title="notation">-</span> <a class="idref" href="#code_address_bits"><span class="id" title="definition">code_address_bits</span></a>) <a class="idref" href="#code_length_in_words:15"><span class="id" title="variable">code_length_in_words</span></a><a class="idref" href="#a2b4273a2140deed386b9215048ca773"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="definition">toZ</span> <a class="idref" href="#bigcost:18"><span class="id" title="variable">bigcost</span></a> <a class="idref" href="#306329b0eca7a2b86c198702f594ad8e"><span class="id" title="notation">≤</span></a> <a class="idref" href="#unsigned_max"><span class="id" title="definition">unsigned_max</span></a> <a class="idref" href="#ergs_bits"><span class="id" title="definition">ergs_bits</span></a>)%<span class="id" title="var">Z</span> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#cost:19"><span class="id" title="variable">cost</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">low</span> <a class="idref" href="#ergs_bits"><span class="id" title="definition">ergs_bits</span></a> <a class="idref" href="#bigcost:18"><span class="id" title="variable">bigcost</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#decommitment_cost:16"><span class="id" title="inductive">decommitment_cost</span></a> <a class="idref" href="#cm:13"><span class="id" title="variable">cm</span></a> <a class="idref" href="#vhash:14"><span class="id" title="variable">vhash</span></a> <a class="idref" href="#code_length_in_words:15"><span class="id" title="variable">code_length_in_words</span></a> <a class="idref" href="#cost:19"><span class="id" title="variable">cost</span></a><br/>
&nbsp;&nbsp;|<a id="dc_not_fresh" class="idref" href="#dc_not_fresh"><span class="id" title="constructor">dc_not_fresh</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#is_first_access"><span class="id" title="definition">is_first_access</span></a> <a class="idref" href="#cm:13"><span class="id" title="variable">cm</span></a> <a class="idref" href="#vhash:14"><span class="id" title="variable">vhash</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#decommitment_cost:16"><span class="id" title="inductive">decommitment_cost</span></a> <a class="idref" href="#cm:13"><span class="id" title="variable">cm</span></a> <a class="idref" href="#vhash:14"><span class="id" title="variable">vhash</span></a> <a class="idref" href="#code_length_in_words:15"><span class="id" title="variable">code_length_in_words</span></a> <a class="idref" href="#zero32"><span class="id" title="definition">zero32</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="code_fetch_hash" class="idref" href="#code_fetch_hash"><span class="id" title="inductive">code_fetch_hash</span></a> (<a id="d:20" class="idref" href="#d:20"><span class="id" title="binder">d</span></a>:<a class="idref" href="#depot"><span class="id" title="definition">depot</span></a>) (<a id="cs:21" class="idref" href="#cs:21"><span class="id" title="binder">cs</span></a>: <a class="idref" href="#code_storage"><span class="id" title="definition">code_storage</span></a>) (<a id="sid:22" class="idref" href="#sid:22"><span class="id" title="binder">sid</span></a>: <a class="idref" href="#shard_id"><span class="id" title="definition">Depot.shard_id</span></a>) (<a id="contract_addr:23" class="idref" href="#contract_addr:23"><span class="id" title="binder">contract_addr</span></a>: <a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#option"><span class="id" title="inductive">option</span></a> (<a class="idref" href="#versioned_hash"><span class="id" title="record">versioned_hash</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#code_length"><span class="id" title="definition">code_length</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;|<a id="cfh_found" class="idref" href="#cfh_found"><span class="id" title="constructor">cfh_found</span></a>: <span class="id" title="keyword">∀</span> <a id="hash_enc:26" class="idref" href="#hash_enc:26"><span class="id" title="binder">hash_enc</span></a> <a id="code_length_in_words:27" class="idref" href="#code_length_in_words:27"><span class="id" title="binder">code_length_in_words</span></a> <a id="extra_marker:28" class="idref" href="#extra_marker:28"><span class="id" title="binder">extra_marker</span></a> <a id="partial_hash:29" class="idref" href="#partial_hash:29"><span class="id" title="binder">partial_hash</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#storage_read"><span class="id" title="inductive">storage_read</span></a> <a class="idref" href="#d:20"><span class="id" title="variable">d</span></a> (<a class="idref" href="#code_hash_location"><span class="id" title="definition">code_hash_location</span></a> <a class="idref" href="#contract_addr:23"><span class="id" title="variable">contract_addr</span></a> <a class="idref" href="#sid:22"><span class="id" title="variable">sid</span></a>) <a class="idref" href="#hash_enc:26"><span class="id" title="variable">hash_enc</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#hash_enc:26"><span class="id" title="variable">hash_enc</span></a> <a class="idref" href="#::type_scope:x_'<>'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="#zero256"><span class="id" title="definition">zero256</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#marker_valid"><span class="id" title="definition">marker_valid</span></a> <a class="idref" href="#extra_marker:28"><span class="id" title="variable">extra_marker</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#hash_coder"><span class="id" title="axiom">hash_coder</span></a>.(<a class="idref" href="#decode"><span class="id" title="projection">Coder.decode</span></a>) <a class="idref" href="#hash_enc:26"><span class="id" title="variable">hash_enc</span></a> <a class="idref" href="#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="#mk_vhash"><span class="id" title="constructor">mk_vhash</span></a> <a class="idref" href="#code_length_in_words:27"><span class="id" title="variable">code_length_in_words</span></a> <a class="idref" href="#extra_marker:28"><span class="id" title="variable">extra_marker</span></a> <a class="idref" href="#partial_hash:29"><span class="id" title="variable">partial_hash</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#code_fetch_hash:24"><span class="id" title="inductive">code_fetch_hash</span></a> <a class="idref" href="#d:20"><span class="id" title="variable">d</span></a> <a class="idref" href="#cs:21"><span class="id" title="variable">cs</span></a> <a class="idref" href="#sid:22"><span class="id" title="variable">sid</span></a> <a class="idref" href="#contract_addr:23"><span class="id" title="variable">contract_addr</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#mk_vhash"><span class="id" title="constructor">mk_vhash</span></a> <a class="idref" href="#code_length_in_words:27"><span class="id" title="variable">code_length_in_words</span></a> <a class="idref" href="#extra_marker:28"><span class="id" title="variable">extra_marker</span></a> <a class="idref" href="#partial_hash:29"><span class="id" title="variable">partial_hash</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#code_length_in_words:27"><span class="id" title="variable">code_length_in_words</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>)<br/>
<br/>
&nbsp;&nbsp;| <a id="cfh_not_found" class="idref" href="#cfh_not_found"><span class="id" title="constructor">cfh_not_found</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#storage_read"><span class="id" title="inductive">storage_read</span></a> <a class="idref" href="#d:20"><span class="id" title="variable">d</span></a> (<a class="idref" href="#code_hash_location"><span class="id" title="definition">code_hash_location</span></a> <a class="idref" href="#contract_addr:23"><span class="id" title="variable">contract_addr</span></a> <a class="idref" href="#sid:22"><span class="id" title="variable">sid</span></a>) <a class="idref" href="#zero256"><span class="id" title="definition">zero256</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#code_fetch_hash:24"><span class="id" title="inductive">code_fetch_hash</span></a> <a class="idref" href="#d:20"><span class="id" title="variable">d</span></a> <a class="idref" href="#cs:21"><span class="id" title="variable">cs</span></a> <a class="idref" href="#sid:22"><span class="id" title="variable">sid</span></a> <a class="idref" href="#contract_addr:23"><span class="id" title="variable">contract_addr</span></a> <a class="idref" href="#None"><span class="id" title="constructor">None</span></a>.<br/>

<br/>
</div>

<div class="doc"><p>When decommitter does not have code for the requested hash, VM may
allow masking, and request the code with default versioned hash <span
class="inlinecode"><a class="idref" href="#DEFAULT_AA_VHASH"><span
class="id" title="axiom">DEFAULT_AA_VHASH</span></a></span> instead. It
is expected that:</p>
<ul>
<li><span
class="inlinecode"><a class="idref" href="#DEFAULT_AA_VHASH"><span
class="id" title="axiom">DEFAULT_AA_VHASH</span></a></span> is
well-formed (see <span
class="inlinecode"><a class="idref" href="#marker_valid"><span
class="id" title="definition">marker_valid</span></a></span>), and</li>
<li>decommitter has code matching <span
class="inlinecode"><a class="idref" href="#DEFAULT_AA_VHASH"><span
class="id" title="axiom">DEFAULT_AA_VHASH</span></a></span>.</li>
</ul>
<p>VM does not mask the code for system contracts; see <span
class="inlinecode"><span class="id"
title="var">sem.FarCall.step</span></span>.</p>
<p><span
class="inlinecode"><a class="idref" href="#DEFAULT_AA_CODE"><span
class="id" title="axiom">DEFAULT_AA_CODE</span></a></span> is the
decommitter’s answer to the query <span
class="inlinecode"><a class="idref" href="#DEFAULT_AA_VHASH"><span
class="id" title="axiom">DEFAULT_AA_VHASH</span></a></span>.</p>
</div>
<div class="code">
<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Parameter</span> <a id="DEFAULT_AA_CODE" class="idref" href="#DEFAULT_AA_CODE"><span class="id" title="axiom">DEFAULT_AA_CODE</span></a>: (<a class="idref" href="#Decommitter.code_page"><span class="id" title="variable">code_page</span></a><a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#const_page"><span class="id" title="definition">const_page</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="code_fetch" class="idref" href="#code_fetch"><span class="id" title="inductive">code_fetch</span></a>  (<a id="d:31" class="idref" href="#d:31"><span class="id" title="binder">d</span></a>:<a class="idref" href="#depot"><span class="id" title="definition">depot</span></a>) (<a id="cs:32" class="idref" href="#cs:32"><span class="id" title="binder">cs</span></a>: <a class="idref" href="#code_storage"><span class="id" title="definition">code_storage</span></a>) (<a id="sid:33" class="idref" href="#sid:33"><span class="id" title="binder">sid</span></a>: <a class="idref" href="#shard_id"><span class="id" title="definition">Depot.shard_id</span></a>) (<a id="contract_addr:34" class="idref" href="#contract_addr:34"><span class="id" title="binder">contract_addr</span></a>: <a class="idref" href="#contract_address"><span class="id" title="definition">contract_address</span></a>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">(</span></a><a class="idref" href="#versioned_hash"><span class="id" title="record">versioned_hash</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">(</span></a><a class="idref" href="#Decommitter.code_page"><span class="id" title="variable">code_page</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#const_page"><span class="id" title="definition">const_page</span></a><a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">)</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="#code_length"><span class="id" title="definition">code_length</span></a><a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="cfnm_no_masking" class="idref" href="#cfnm_no_masking"><span class="id" title="constructor">cfnm_no_masking</span></a>: <span class="id" title="keyword">∀</span> <a id="vhash:37" class="idref" href="#vhash:37"><span class="id" title="binder">vhash</span></a> (<a id="code_storage:38" class="idref" href="#code_storage:38"><span class="id" title="binder">code_storage</span></a>:<a class="idref" href="#code_storage"><span class="id" title="definition">code_storage</span></a>) <a id="code_length_in_words:39" class="idref" href="#code_length_in_words:39"><span class="id" title="binder">code_length_in_words</span></a> <a id="pages0:40" class="idref" href="#pages0:40"><span class="id" title="binder">pages0</span></a> <a id="masking:41" class="idref" href="#masking:41"><span class="id" title="binder">masking</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#code_fetch_hash"><span class="id" title="inductive">code_fetch_hash</span></a> <a class="idref" href="#d:31"><span class="id" title="variable">d</span></a> <a class="idref" href="#cs:32"><span class="id" title="variable">cs</span></a> <a class="idref" href="#sid:33"><span class="id" title="variable">sid</span></a> <a class="idref" href="#contract_addr:34"><span class="id" title="variable">contract_addr</span></a> (<a class="idref" href="#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#vhash:37"><span class="id" title="variable">vhash</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#code_length_in_words:39"><span class="id" title="variable">code_length_in_words</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#load_result"><span class="id" title="inductive">load_result</span></a> <a class="idref" href="#code_storage_params"><span class="id" title="definition">code_storage_params</span></a> (<a class="idref" href="#widen"><span class="id" title="definition">widen</span></a> 256 (<a class="idref" href="#partial_hash"><span class="id" title="projection">partial_hash</span></a> <a class="idref" href="#vhash:37"><span class="id" title="variable">vhash</span></a>)) <a class="idref" href="#code_storage:38"><span class="id" title="variable">code_storage</span></a> <a class="idref" href="#pages0:40"><span class="id" title="variable">pages0</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#code_fetch:35"><span class="id" title="inductive">code_fetch</span></a> <a class="idref" href="#d:31"><span class="id" title="variable">d</span></a> <a class="idref" href="#cs:32"><span class="id" title="variable">cs</span></a> <a class="idref" href="#sid:33"><span class="id" title="variable">sid</span></a> <a class="idref" href="#contract_addr:34"><span class="id" title="variable">contract_addr</span></a> <a class="idref" href="#masking:41"><span class="id" title="variable">masking</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#vhash:37"><span class="id" title="variable">vhash</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#pages0:40"><span class="id" title="variable">pages0</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#code_length_in_words:39"><span class="id" title="variable">code_length_in_words</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
<br/>
<br/>
&nbsp;&nbsp;| <a id="cfnm_masking" class="idref" href="#cfnm_masking"><span class="id" title="constructor">cfnm_masking</span></a>: <span class="id" title="keyword">∀</span> (<a id="code_storage:42" class="idref" href="#code_storage:42"><span class="id" title="binder">code_storage</span></a>:<a class="idref" href="#code_storage"><span class="id" title="definition">code_storage</span></a>) <a id="code_length_in_words:43" class="idref" href="#code_length_in_words:43"><span class="id" title="binder">code_length_in_words</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#code_fetch_hash"><span class="id" title="inductive">code_fetch_hash</span></a> <a class="idref" href="#d:31"><span class="id" title="variable">d</span></a> <a class="idref" href="#cs:32"><span class="id" title="variable">cs</span></a> <a class="idref" href="#sid:33"><span class="id" title="variable">sid</span></a> <a class="idref" href="#contract_addr:34"><span class="id" title="variable">contract_addr</span></a> <a class="idref" href="#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="#::type_scope:x_'->'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="#code_fetch:35"><span class="id" title="inductive">code_fetch</span></a> <a class="idref" href="#d:31"><span class="id" title="variable">d</span></a> <a class="idref" href="#cs:32"><span class="id" title="variable">cs</span></a> <a class="idref" href="#sid:33"><span class="id" title="variable">sid</span></a> <a class="idref" href="#contract_addr:34"><span class="id" title="variable">contract_addr</span></a> <a class="idref" href="#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="#DEFAULT_AA_VHASH"><span class="id" title="axiom">DEFAULT_AA_VHASH</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="#DEFAULT_AA_CODE"><span class="id" title="axiom">DEFAULT_AA_CODE</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="#code_length_in_words:43"><span class="id" title="variable">code_length_in_words</span></a><a class="idref" href="#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Decommitter"><span class="id" title="section">Decommitter</span></a>.<br/>
</div>
</div>



<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EraVM.Arith</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">mathcomp</span> <span class="id" title="keyword">Require</span> <span class="id" title="library">ssreflect</span> <span class="id" title="library">ssrfun</span> <span class="id" title="library">ssrbool</span> <span class="id" title="library">eqtype</span> <span class="id" title="library">tuple</span> <span class="id" title="library">zmodp</span>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="#"><span class="id" title="library">Types</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="#"><span class="id" title="module">Types</span></a> <span class="id" title="module">ssreflect.tuple</span> <span class="id" title="module">ssreflect.eqtype</span> <span class="id" title="module">ssrbool</span>.<br/>

<br/>
</div>

<div class="doc"><h1 id="common-project-independent-definitions">Common
project-independent definitions</h1>
</div>
<div class="code">
<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Operations" class="idref" href="#Operations"><span class="id" title="section">Operations</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <span class="id" title="module">operations</span> <a class="idref" href="#"><span class="id" title="module">ZArith</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="udiv_result" class="idref" href="#udiv_result"><span class="id" title="record">udiv_result</span></a> {<a id="n:1" class="idref" href="#n:1"><span class="id" title="binder">n</span></a>} := <span class="id" title="var">mk_divrem</span> { <a id="div" class="idref" href="#div"><span class="id" title="projection">div</span></a>: <span class="id" title="definition">BITS</span> <a class="idref" href="#n:1"><span class="id" title="variable">n</span></a>; <a id="rem" class="idref" href="#rem"><span class="id" title="projection">rem</span></a>: <span class="id" title="definition">BITS</span> <a class="idref" href="#n:1"><span class="id" title="variable">n</span></a> }.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="uadd_of" class="idref" href="#uadd_of"><span class="id" title="definition">uadd_of</span></a> {<a id="n:5" class="idref" href="#n:5"><span class="id" title="binder">n</span></a>: <a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>} (<a id="a:6" class="idref" href="#a:6"><span class="id" title="binder">a</span></a>: <span class="id" title="definition">BITS</span> <a class="idref" href="#n:5"><span class="id" title="variable">n</span></a>) (<a id="b:7" class="idref" href="#b:7"><span class="id" title="binder">b</span></a>:<span class="id" title="definition">BITS</span> <a class="idref" href="#n:5"><span class="id" title="variable">n</span></a>) : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <span class="id" title="definition">BITS</span> <a class="idref" href="#n:5"><span class="id" title="variable">n</span></a> := <span class="id" title="definition">adcB</span> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="#a:6"><span class="id" title="variable">a</span></a> <a class="idref" href="#b:7"><span class="id" title="variable">b</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="uadd_wrap" class="idref" href="#uadd_wrap"><span class="id" title="definition">uadd_wrap</span></a> {<a id="n:8" class="idref" href="#n:8"><span class="id" title="binder">n</span></a>: <a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>} (<a id="a:9" class="idref" href="#a:9"><span class="id" title="binder">a</span></a>: <span class="id" title="definition">BITS</span> <a class="idref" href="#n:8"><span class="id" title="variable">n</span></a>) (<a id="b:10" class="idref" href="#b:10"><span class="id" title="binder">b</span></a>:<span class="id" title="definition">BITS</span> <a class="idref" href="#n:8"><span class="id" title="variable">n</span></a>) : <span class="id" title="definition">BITS</span> <a class="idref" href="#n:8"><span class="id" title="variable">n</span></a> := <a class="idref" href="#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="#uadd_of"><span class="id" title="definition">uadd_of</span></a> <a class="idref" href="#a:9"><span class="id" title="variable">a</span></a> <a class="idref" href="#b:10"><span class="id" title="variable">b</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="uinc_of" class="idref" href="#uinc_of"><span class="id" title="definition">uinc_of</span></a> {<a id="n:11" class="idref" href="#n:11"><span class="id" title="binder">n</span></a>: <a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>} (<a id="a:12" class="idref" href="#a:12"><span class="id" title="binder">a</span></a>: <span class="id" title="definition">BITS</span> <a class="idref" href="#n:11"><span class="id" title="variable">n</span></a>) : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <span class="id" title="definition">BITS</span> <a class="idref" href="#n:11"><span class="id" title="variable">n</span></a> := <a class="idref" href="#uadd_of"><span class="id" title="definition">uadd_of</span></a> <a class="idref" href="#a:12"><span class="id" title="variable">a</span></a> (<span class="id" title="definition">fromZ</span> 1).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="uinc_by_32_of" class="idref" href="#uinc_by_32_of"><span class="id" title="definition">uinc_by_32_of</span></a> {<a id="n:13" class="idref" href="#n:13"><span class="id" title="binder">n</span></a>: <a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>} (<a id="a:14" class="idref" href="#a:14"><span class="id" title="binder">a</span></a>: <span class="id" title="definition">BITS</span> <a class="idref" href="#n:13"><span class="id" title="variable">n</span></a>) : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <span class="id" title="definition">BITS</span> <a class="idref" href="#n:13"><span class="id" title="variable">n</span></a> := <a class="idref" href="#uadd_of"><span class="id" title="definition">uadd_of</span></a> <a class="idref" href="#a:14"><span class="id" title="variable">a</span></a> (<span class="id" title="definition">fromZ</span> 32).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="usub_uf" class="idref" href="#usub_uf"><span class="id" title="definition">usub_uf</span></a> {<a id="n:15" class="idref" href="#n:15"><span class="id" title="binder">n</span></a>: <a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>} (<a id="a:16" class="idref" href="#a:16"><span class="id" title="binder">a</span></a>: <span class="id" title="definition">BITS</span> <a class="idref" href="#n:15"><span class="id" title="variable">n</span></a>) (<a id="b:17" class="idref" href="#b:17"><span class="id" title="binder">b</span></a>:<span class="id" title="definition">BITS</span> <a class="idref" href="#n:15"><span class="id" title="variable">n</span></a>) : <a class="idref" href="#bool"><span class="id" title="inductive">bool</span></a> <a class="idref" href="#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <span class="id" title="definition">BITS</span> <a class="idref" href="#n:15"><span class="id" title="variable">n</span></a> := <span class="id" title="definition">sbbB</span> <a class="idref" href="#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="#a:16"><span class="id" title="variable">a</span></a> <a class="idref" href="#b:17"><span class="id" title="variable">b</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="umul" class="idref" href="#umul"><span class="id" title="definition">umul</span></a> {<a id="n:18" class="idref" href="#n:18"><span class="id" title="binder">n</span></a>: <a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>} (<a id="a:19" class="idref" href="#a:19"><span class="id" title="binder">a</span></a>: <span class="id" title="definition">BITS</span> <a class="idref" href="#n:18"><span class="id" title="variable">n</span></a>) (<a id="b:20" class="idref" href="#b:20"><span class="id" title="binder">b</span></a>:<span class="id" title="definition">BITS</span> <a class="idref" href="#n:18"><span class="id" title="variable">n</span></a>) : <span class="id" title="definition">BITS</span> (<a class="idref" href="#n:18"><span class="id" title="variable">n</span></a><a class="idref" href="#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><a class="idref" href="#n:18"><span class="id" title="variable">n</span></a>) := <span class="id" title="definition">fullmulB</span> <a class="idref" href="#a:19"><span class="id" title="variable">a</span></a> <a class="idref" href="#b:20"><span class="id" title="variable">b</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="udiv" class="idref" href="#udiv"><span class="id" title="definition">udiv</span></a> {<a id="n:21" class="idref" href="#n:21"><span class="id" title="binder">n</span></a>: <a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>} (<a id="a:22" class="idref" href="#a:22"><span class="id" title="binder">a</span></a>: <span class="id" title="definition">BITS</span> (<a class="idref" href="#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="#n:21"><span class="id" title="variable">n</span></a>)) (<a id="b:23" class="idref" href="#b:23"><span class="id" title="binder">b</span></a>:<span class="id" title="definition">BITS</span> (<a class="idref" href="#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="#n:21"><span class="id" title="variable">n</span></a>)) : <a class="idref" href="#udiv_result"><span class="id" title="record">udiv_result</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="za:24" class="idref" href="#za:24"><span class="id" title="binder">za</span></a> := <span class="id" title="definition">toZ</span> <a class="idref" href="#a:22"><span class="id" title="variable">a</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="zb:25" class="idref" href="#zb:25"><span class="id" title="binder">zb</span></a> := <span class="id" title="definition">toZ</span> <a class="idref" href="#b:23"><span class="id" title="variable">b</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#mk_divrem"><span class="id" title="constructor">mk_divrem</span></a> (<a class="idref" href="#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="#n:21"><span class="id" title="variable">n</span></a>) (<span class="id" title="definition">fromZ</span> (<a class="idref" href="#Z.div"><span class="id" title="definition">BinInt.Z.div</span></a> <a class="idref" href="#za:24"><span class="id" title="variable">za</span></a> <a class="idref" href="#zb:25"><span class="id" title="variable">zb</span></a>)) (<span class="id" title="definition">fromZ</span> (<a class="idref" href="#Z.rem"><span class="id" title="definition">BinInt.Z.rem</span></a> <a class="idref" href="#za:24"><span class="id" title="variable">za</span></a> <a class="idref" href="#zb:25"><span class="id" title="variable">zb</span></a>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="lt_unsigned" class="idref" href="#lt_unsigned"><span class="id" title="definition">lt_unsigned</span></a> {<a id="n:26" class="idref" href="#n:26"><span class="id" title="binder">n</span></a>:<a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>} (<a id="a:27" class="idref" href="#a:27"><span class="id" title="binder">a</span></a> <a id="b:28" class="idref" href="#b:28"><span class="id" title="binder">b</span></a>: <span class="id" title="definition">BITS</span> <a class="idref" href="#n:26"><span class="id" title="variable">n</span></a>) := <span class="id" title="definition">ltB</span> <a class="idref" href="#a:27"><span class="id" title="variable">a</span></a> <a class="idref" href="#b:28"><span class="id" title="variable">b</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="gt_unsigned" class="idref" href="#gt_unsigned"><span class="id" title="definition">gt_unsigned</span></a> {<a id="n:29" class="idref" href="#n:29"><span class="id" title="binder">n</span></a>:<a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>} (<a id="a:30" class="idref" href="#a:30"><span class="id" title="binder">a</span></a> <a id="b:31" class="idref" href="#b:31"><span class="id" title="binder">b</span></a>: <span class="id" title="definition">BITS</span> <a class="idref" href="#n:29"><span class="id" title="variable">n</span></a>) := <a class="idref" href="#lt_unsigned"><span class="id" title="definition">lt_unsigned</span></a> <a class="idref" href="#b:31"><span class="id" title="variable">b</span></a> <a class="idref" href="#a:30"><span class="id" title="variable">a</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="le_unsigned" class="idref" href="#le_unsigned"><span class="id" title="definition">le_unsigned</span></a> {<a id="n:32" class="idref" href="#n:32"><span class="id" title="binder">n</span></a>:<a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>} (<a id="a:33" class="idref" href="#a:33"><span class="id" title="binder">a</span></a> <a id="b:34" class="idref" href="#b:34"><span class="id" title="binder">b</span></a>: <span class="id" title="definition">BITS</span> <a class="idref" href="#n:32"><span class="id" title="variable">n</span></a>) := <a class="idref" href="#lt_unsigned"><span class="id" title="definition">lt_unsigned</span></a> <a class="idref" href="#a:33"><span class="id" title="variable">a</span></a> <a class="idref" href="#b:34"><span class="id" title="variable">b</span></a> <a class="idref" href="#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">||</span></a> <a class="idref" href="#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">(</span></a><a class="idref" href="#a:33"><span class="id" title="variable">a</span></a> <span class="id" title="notation">==</span> <a class="idref" href="#b:34"><span class="id" title="variable">b</span></a><a class="idref" href="#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="ge_unsigned" class="idref" href="#ge_unsigned"><span class="id" title="definition">ge_unsigned</span></a> {<a id="n:35" class="idref" href="#n:35"><span class="id" title="binder">n</span></a>:<a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>} (<a id="a:36" class="idref" href="#a:36"><span class="id" title="binder">a</span></a> <a id="b:37" class="idref" href="#b:37"><span class="id" title="binder">b</span></a>: <span class="id" title="definition">BITS</span> <a class="idref" href="#n:35"><span class="id" title="variable">n</span></a>) := <a class="idref" href="#gt_unsigned"><span class="id" title="definition">gt_unsigned</span></a> <a class="idref" href="#a:36"><span class="id" title="variable">a</span></a> <a class="idref" href="#b:37"><span class="id" title="variable">b</span></a> <a class="idref" href="#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">||</span></a> <a class="idref" href="#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">(</span></a><a class="idref" href="#a:36"><span class="id" title="variable">a</span></a> <span class="id" title="notation">==</span> <a class="idref" href="#b:37"><span class="id" title="variable">b</span></a><a class="idref" href="#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">)</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="bitwise_xor" class="idref" href="#bitwise_xor"><span class="id" title="definition">bitwise_xor</span></a> {<a id="n:38" class="idref" href="#n:38"><span class="id" title="binder">n</span></a>} := @<span class="id" title="definition">xorB</span> <a class="idref" href="#n:38"><span class="id" title="variable">n</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="bitwise_or" class="idref" href="#bitwise_or"><span class="id" title="definition">bitwise_or</span></a>  {<a id="n:39" class="idref" href="#n:39"><span class="id" title="binder">n</span></a>} := @<span class="id" title="definition">orB</span> <a class="idref" href="#n:39"><span class="id" title="variable">n</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="bitwise_and" class="idref" href="#bitwise_and"><span class="id" title="definition">bitwise_and</span></a> {<a id="n:40" class="idref" href="#n:40"><span class="id" title="binder">n</span></a>} := @<span class="id" title="definition">andB</span> <a class="idref" href="#n:40"><span class="id" title="variable">n</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="characteristic" class="idref" href="#characteristic"><span class="id" title="definition">characteristic</span></a> (<a id="n:41" class="idref" href="#n:41"><span class="id" title="binder">n</span></a>:<a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>): <a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 2 <a class="idref" href="#14ef112b66e341f773bd1e9d05816f43"><span class="id" title="notation">^</span></a> <a class="idref" href="#14ef112b66e341f773bd1e9d05816f43"><span class="id" title="notation">(</span></a><a class="idref" href="#Z.of_nat"><span class="id" title="definition">Z.of_nat</span></a> <a class="idref" href="#n:41"><span class="id" title="variable">n</span></a><a class="idref" href="#14ef112b66e341f773bd1e9d05816f43"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="unsigned_max" class="idref" href="#unsigned_max"><span class="id" title="definition">unsigned_max</span></a> (<a id="n:42" class="idref" href="#n:42"><span class="id" title="binder">n</span></a>:<a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>) :<a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := <a class="idref" href="#characteristic"><span class="id" title="definition">characteristic</span></a> <a class="idref" href="#n:42"><span class="id" title="variable">n</span></a> <a class="idref" href="#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="unsigned_min" class="idref" href="#unsigned_min"><span class="id" title="definition">unsigned_min</span></a> :<a class="idref" href="#Z"><span class="id" title="inductive">Z</span></a> := 0.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="min" class="idref" href="#min"><span class="id" title="definition">min</span></a> {<a id="n:43" class="idref" href="#n:43"><span class="id" title="binder">n</span></a>} (<a id="a:44" class="idref" href="#a:44"><span class="id" title="binder">a</span></a> <a id="b:45" class="idref" href="#b:45"><span class="id" title="binder">b</span></a>: <span class="id" title="definition">BITS</span> <a class="idref" href="#n:43"><span class="id" title="variable">n</span></a>) : <span class="id" title="definition">BITS</span> <a class="idref" href="#n:43"><span class="id" title="variable">n</span></a> := <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#lt_unsigned"><span class="id" title="definition">lt_unsigned</span></a> <a class="idref" href="#a:44"><span class="id" title="variable">a</span></a> <a class="idref" href="#b:45"><span class="id" title="variable">b</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="#a:44"><span class="id" title="variable">a</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="#b:45"><span class="id" title="variable">b</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="max" class="idref" href="#max"><span class="id" title="definition">max</span></a> {<a id="n:46" class="idref" href="#n:46"><span class="id" title="binder">n</span></a>} (<a id="a:47" class="idref" href="#a:47"><span class="id" title="binder">a</span></a> <a id="b:48" class="idref" href="#b:48"><span class="id" title="binder">b</span></a>: <span class="id" title="definition">BITS</span> <a class="idref" href="#n:46"><span class="id" title="variable">n</span></a>) : <span class="id" title="definition">BITS</span> <a class="idref" href="#n:46"><span class="id" title="variable">n</span></a> := <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="#gt_unsigned"><span class="id" title="definition">gt_unsigned</span></a> <a class="idref" href="#a:47"><span class="id" title="variable">a</span></a> <a class="idref" href="#b:48"><span class="id" title="variable">b</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="#a:47"><span class="id" title="variable">a</span></a> <a class="idref" href="#::boolean_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="#b:48"><span class="id" title="variable">b</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="widen" class="idref" href="#widen"><span class="id" title="definition">widen</span></a> {<a id="s:49" class="idref" href="#s:49"><span class="id" title="binder">s</span></a>} (<a id="result_size:50" class="idref" href="#result_size:50"><span class="id" title="binder">result_size</span></a>: <a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>) (<a id="val:51" class="idref" href="#val:51"><span class="id" title="binder">val</span></a>: <span class="id" title="definition">BITS</span> <a class="idref" href="#s:49"><span class="id" title="variable">s</span></a>): <span class="id" title="definition">BITS</span> (<a class="idref" href="#s:49"><span class="id" title="variable">s</span></a> <a class="idref" href="#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">(</span></a><a class="idref" href="#result_size:50"><span class="id" title="variable">result_size</span></a> <a class="idref" href="#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="#s:49"><span class="id" title="variable">s</span></a><a class="idref" href="#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a>) :=  @<span class="id" title="definition">zeroExtend</span> (<a class="idref" href="#result_size:50"><span class="id" title="variable">result_size</span></a> <a class="idref" href="#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="#s:49"><span class="id" title="variable">s</span></a>)%<span class="id" title="var">nat</span> <a class="idref" href="#s:49"><span class="id" title="variable">s</span></a>  <a class="idref" href="#val:51"><span class="id" title="variable">val</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="rolBn" class="idref" href="#rolBn"><span class="id" title="definition">rolBn</span></a> {<a id="n:52" class="idref" href="#n:52"><span class="id" title="binder">n</span></a>} (<a id="p:53" class="idref" href="#p:53"><span class="id" title="binder">p</span></a>: <span class="id" title="definition">BITS</span> (<a class="idref" href="#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="#n:52"><span class="id" title="variable">n</span></a>)) (<a id="k:54" class="idref" href="#k:54"><span class="id" title="binder">k</span></a>: <a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>): <span class="id" title="definition">BITS</span> (<a class="idref" href="#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="#n:52"><span class="id" title="variable">n</span></a>) := <a class="idref" href="#Nat.iter"><span class="id" title="definition">Nat.iter</span></a> <a class="idref" href="#k:54"><span class="id" title="variable">k</span></a> <span class="id" title="definition">rolB</span> <a class="idref" href="#p:53"><span class="id" title="variable">p</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="rorBn" class="idref" href="#rorBn"><span class="id" title="definition">rorBn</span></a> {<a id="n:55" class="idref" href="#n:55"><span class="id" title="binder">n</span></a>} (<a id="p:56" class="idref" href="#p:56"><span class="id" title="binder">p</span></a>: <span class="id" title="definition">BITS</span> (<a class="idref" href="#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="#n:55"><span class="id" title="variable">n</span></a>)) (<a id="k:57" class="idref" href="#k:57"><span class="id" title="binder">k</span></a>: <a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>): <span class="id" title="definition">BITS</span> (<a class="idref" href="#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="#n:55"><span class="id" title="variable">n</span></a>) := <a class="idref" href="#Nat.iter"><span class="id" title="definition">Nat.iter</span></a> <a class="idref" href="#k:57"><span class="id" title="variable">k</span></a> <span class="id" title="definition">rorB</span> <a class="idref" href="#p:56"><span class="id" title="variable">p</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="subrange_len" class="idref" href="#subrange_len"><span class="id" title="definition">subrange_len</span></a> {<a id="skip:58" class="idref" href="#skip:58"><span class="id" title="binder">skip</span></a>} (<a id="from:59" class="idref" href="#from:59"><span class="id" title="binder">from</span></a>:<a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>) (<a id="len:60" class="idref" href="#len:60"><span class="id" title="binder">len</span></a>:<a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>) (<a id="w:61" class="idref" href="#w:61"><span class="id" title="binder">w</span></a>:<span class="id" title="definition">BITS</span> (<a class="idref" href="#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">(</span></a><a class="idref" href="#from:59"><span class="id" title="variable">from</span></a> <a class="idref" href="#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="#len:60"><span class="id" title="variable">len</span></a><a class="idref" href="#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a> <a class="idref" href="#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="#skip:58"><span class="id" title="variable">skip</span></a>))  :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(@<span class="id" title="definition">high</span> <a class="idref" href="#len:60"><span class="id" title="variable">len</span></a> <a class="idref" href="#from:59"><span class="id" title="variable">from</span></a> (@<span class="id" title="definition">low</span> <a class="idref" href="#skip:58"><span class="id" title="variable">skip</span></a> (<span class="id" title="definition">ssrnat.addn</span> <a class="idref" href="#from:59"><span class="id" title="variable">from</span></a> <a class="idref" href="#len:60"><span class="id" title="variable">len</span></a>) <a class="idref" href="#w:61"><span class="id" title="variable">w</span></a>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="subrange" class="idref" href="#subrange"><span class="id" title="definition">subrange</span></a> {<a id="skip:62" class="idref" href="#skip:62"><span class="id" title="binder">skip</span></a>} (<a id="from:63" class="idref" href="#from:63"><span class="id" title="binder">from</span></a>:<a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>) (<a id="to:64" class="idref" href="#to:64"><span class="id" title="binder">to</span></a>:<a class="idref" href="#nat"><span class="id" title="inductive">nat</span></a>) (<a id="w:65" class="idref" href="#w:65"><span class="id" title="binder">w</span></a>:<span class="id" title="definition">BITS</span> (<a class="idref" href="#from:63"><span class="id" title="variable">from</span></a> <a class="idref" href="#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">(</span></a><a class="idref" href="#to:64"><span class="id" title="variable">to</span></a><a class="idref" href="#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a><a class="idref" href="#from:63"><span class="id" title="variable">from</span></a><a class="idref" href="#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a> <a class="idref" href="#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="#skip:62"><span class="id" title="variable">skip</span></a>))  :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="#subrange_len"><span class="id" title="definition">subrange_len</span></a> <a class="idref" href="#skip:62"><span class="id" title="variable">skip</span></a> <a class="idref" href="#from:63"><span class="id" title="variable">from</span></a> (<a class="idref" href="#to:64"><span class="id" title="variable">to</span></a><a class="idref" href="#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a><a class="idref" href="#from:63"><span class="id" title="variable">from</span></a>) <a class="idref" href="#w:65"><span class="id" title="variable">w</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="#Operations"><span class="id" title="section">Operations</span></a>.<br/>

<br/>
<span class="id" title="keyword">Declare Scope</span> <span class="id" title="var">ZMod_scope</span>.<br/>

<br/>
<span class="id" title="keyword">Infix</span> <a id="7d9ad0405e299fff5d06f96450066fc0" class="idref" href="#7d9ad0405e299fff5d06f96450066fc0"><span class="id" title="notation">"</span></a>+" := (<a class="idref" href="#uadd_of"><span class="id" title="definition">uadd_of</span></a>) : <span class="id" title="var">ZMod_scope</span>.<br/>
<span class="id" title="keyword">Infix</span> <a id="::ZMod_scope:x_'-'_x" class="idref" href="#::ZMod_scope:x_'-'_x"><span class="id" title="notation">"</span></a>-" := (<a class="idref" href="#usub_uf"><span class="id" title="definition">usub_uf</span></a>) : <span class="id" title="var">ZMod_scope</span>.<br/>
<span class="id" title="keyword">Infix</span> <a id="a2b4273a2140deed386b9215048ca773" class="idref" href="#a2b4273a2140deed386b9215048ca773"><span class="id" title="notation">"</span></a>×" := (<a class="idref" href="#umul"><span class="id" title="definition">umul</span></a>) : <span class="id" title="var">ZMod_scope</span>.<br/>
<span class="id" title="keyword">Infix</span> <a id="::ZMod_scope:x_'<'_x" class="idref" href="#::ZMod_scope:x_'<'_x"><span class="id" title="notation">"</span></a><" := (<a class="idref" href="#lt_unsigned"><span class="id" title="definition">lt_unsigned</span></a> ) : <span class="id" title="var">ZMod_scope</span>.<br/>
<span class="id" title="keyword">Infix</span> <a id="::ZMod_scope:x_'>'_x" class="idref" href="#::ZMod_scope:x_'>'_x"><span class="id" title="notation">"</span></a>>" := (<a class="idref" href="#gt_unsigned"><span class="id" title="definition">gt_unsigned</span></a>) : <span class="id" title="var">ZMod_scope</span>.<br/>
<span class="id" title="keyword">Infix</span> <a id="14c765d8614826944bc2b2afe356aa2c" class="idref" href="#14c765d8614826944bc2b2afe356aa2c"><span class="id" title="notation">"</span></a>≤" := (<a class="idref" href="#le_unsigned"><span class="id" title="definition">le_unsigned</span></a>) : <span class="id" title="var">ZMod_scope</span>.<br/>
<span class="id" title="keyword">Infix</span> <a id="e27af0fe97b7e2880e3637aac9d3abcc" class="idref" href="#e27af0fe97b7e2880e3637aac9d3abcc"><span class="id" title="notation">"</span></a>≥" := (<a class="idref" href="#ge_unsigned"><span class="id" title="definition">ge_unsigned</span></a>) : <span class="id" title="var">ZMod_scope</span>.<br/>
<span class="comment">(*&nbsp;Equality&nbsp;is&nbsp;already&nbsp;provided&nbsp;by&nbsp;<span class="inlinecode"><span class="id" title="var">eqType</span></span>&nbsp;of&nbsp;ssreflect.&nbsp;&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Notation</span> <a id="a5d933b2c0c6802abf1895ee4efcc42a" class="idref" href="#a5d933b2c0c6802abf1895ee4efcc42a"><span class="id" title="notation">"</span></a>w  { from , to }" := (@<a class="idref" href="#subrange"><span class="id" title="definition">subrange</span></a> <span class="id" title="var">_</span> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">w</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 10) : <span class="id" title="var">ZMod_scope</span> .<br/>

<br/>
<span class="id" title="keyword">Bind Scope</span> <span class="id" title="var">ZMod_scope</span> <span class="id" title="keyword">with</span> <span class="id" title="var">BITS</span>.<br/>
</div>
</div>

</html>
